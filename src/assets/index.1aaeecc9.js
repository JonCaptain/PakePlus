import{d as Hr,i as V5,j as H5,k as W5,m as q5,n as $5,p as X5,q as Y5,s as j5,t as K5,v as Q5,x as Z5,y as J5,z as eH,A as tH,B as nH,C as rH,D as iH,F as aH,G as sH,H as oH,I as lH,J as uH,K as cH,L as hH,M as fH,N as dH,O as pH,P as gH,Q as vH,R as mH,T as yH,U as _H,V as xH,W as bH,X as EH,Y as TH,Z as wH,$ as SH,a0 as AH,a1 as MH,a2 as CH,a3 as RH,a4 as NH,a5 as PH,a6 as DH,a7 as LH,a8 as IH,a9 as OH,aa as FH,ab as BH,ac as UH,ad as kH,ae as GH,af as zH,ag as VH,ah as HH,ai as ea,r as Wr,aj as br,ak as WH,o as Ye,c as tt,al as ia,am as qH,an as _v,_ as Nr,b as kt,a as Ue,ao as $H,ap as Ui,aq as CS,ar as XH,as as RS,at as si,au as Og,av as $n,aw as _r,ax as Mo,u as Nt,ay as Kt,az as on,aA as Is,aB as Co,aC as YH,aD as Mi,aE as mh,f as Hn,aF as jH,aG as hi,e as zt,h as ji,aH as zm,aI as KH,aJ as bw,aK as QH,w as ZH,aL as JH,aM as du,E as yh,aN as eW,aO as tW,aP as nW,aQ as rW,g as gs,aR as iW,aS as eC,aT as tC}from"./index.e66d7253.js";import{u as Fg,S as nC,g as Vm}from"./getUUID.a44c156b.js";const aW=Hr({__name:"EchartsComponent",props:["options","expandOption","newOption","styleObj"],setup(r){V5([H5,W5,q5,$5,X5,Y5,j5,K5,Q5,Z5,J5,eH,tH,nH,rH,iH,aH,sH,oH,lH,uH,cH,hH,fH,dH,pH,gH,vH,mH,yH,_H,xH,bH,EH,TH,wH,SH,AH,MH,CH,RH,NH,PH,DH,LH,IH,OH,FH,BH,UH,kH,GH,zH,VH,HH]);const e=r,t=ea(null);let n=null;const i=Wr({options:null}),a=()=>{n=qH(t.value),s()},s=()=>{n.setOption(e.options.option),_v(()=>{n.resize()})};return br(()=>{a(),window.addEventListener("resize",()=>{n&&n.resize()})}),WH(()=>{n=null,i.options=null}),(o,l)=>(Ye(),tt("div",{ref_key:"chartComponent",ref:t,class:"chartContainer",style:ia([e.styleObj.width&&{width:e.styleObj.width},e.styleObj.height&&{height:e.styleObj.height}])},null,4))}});const sW=Nr(aW,[["__scopeId","data-v-e54e7ea7"]]),oW=Hr({__name:"index",props:["componentProps","listIdx"],setup(r){const e=r;return Wr({options:{}}),br(()=>{}),(t,n)=>(Ye(),tt("div",{class:"llmChartContainer",style:ia({width:e.componentProps.unifyWidth})},[kt(sW,{options:e.componentProps.echartsDataObj.options,expandOption:{},styleObj:{width:"100%",height:"350px"}},null,8,["options"])],4))}});const lW=Nr(oW,[["__scopeId","data-v-1473d362"]]),uW=["src"],cW=Hr({__name:"index",props:["componentProps"],setup(r){const e=r;return Wr({}),br(()=>{}),(t,n)=>(Ye(),tt("div",{class:"llmFilePreview",style:ia({width:e.componentProps.unifyWidth})},[Ue("iframe",{src:e.componentProps.fileData.url,frameborder:"0"},null,8,uW)],4))}});const hW=Nr(cW,[["__scopeId","data-v-98ee147e"]]);var ta={exports:{}},WU={exports:{}};(function(){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e={rotl:function(t,n){return t<<n|t>>>32-n},rotr:function(t,n){return t<<32-n|t>>>n},endian:function(t){if(t.constructor==Number)return e.rotl(t,8)&16711935|e.rotl(t,24)&4278255360;for(var n=0;n<t.length;n++)t[n]=e.endian(t[n]);return t},randomBytes:function(t){for(var n=[];t>0;t--)n.push(Math.floor(Math.random()*256));return n},bytesToWords:function(t){for(var n=[],i=0,a=0;i<t.length;i++,a+=8)n[a>>>5]|=t[i]<<24-a%32;return n},wordsToBytes:function(t){for(var n=[],i=0;i<t.length*32;i+=8)n.push(t[i>>>5]>>>24-i%32&255);return n},bytesToHex:function(t){for(var n=[],i=0;i<t.length;i++)n.push((t[i]>>>4).toString(16)),n.push((t[i]&15).toString(16));return n.join("")},hexToBytes:function(t){for(var n=[],i=0;i<t.length;i+=2)n.push(parseInt(t.substr(i,2),16));return n},bytesToBase64:function(t){for(var n=[],i=0;i<t.length;i+=3)for(var a=t[i]<<16|t[i+1]<<8|t[i+2],s=0;s<4;s++)i*8+s*6<=t.length*8?n.push(r.charAt(a>>>6*(3-s)&63)):n.push("=");return n.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var n=[],i=0,a=0;i<t.length;a=++i%4)a!=0&&n.push((r.indexOf(t.charAt(i-1))&Math.pow(2,-2*a+8)-1)<<a*2|r.indexOf(t.charAt(i))>>>6-a*2);return n}};WU.exports=e})();var Ew={utf8:{stringToBytes:function(r){return Ew.bin.stringToBytes(unescape(encodeURIComponent(r)))},bytesToString:function(r){return decodeURIComponent(escape(Ew.bin.bytesToString(r)))}},bin:{stringToBytes:function(r){for(var e=[],t=0;t<r.length;t++)e.push(r.charCodeAt(t)&255);return e},bytesToString:function(r){for(var e=[],t=0;t<r.length;t++)e.push(String.fromCharCode(r[t]));return e.join("")}}},rC=Ew;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var fW=function(r){return r!=null&&(qU(r)||dW(r)||!!r._isBuffer)};function qU(r){return!!r.constructor&&typeof r.constructor.isBuffer=="function"&&r.constructor.isBuffer(r)}function dW(r){return typeof r.readFloatLE=="function"&&typeof r.slice=="function"&&qU(r.slice(0,0))}(function(){var r=WU.exports,e=rC.utf8,t=fW,n=rC.bin,i=function(a,s){a.constructor==String?s&&s.encoding==="binary"?a=n.stringToBytes(a):a=e.stringToBytes(a):t(a)?a=Array.prototype.slice.call(a,0):!Array.isArray(a)&&a.constructor!==Uint8Array&&(a=a.toString());for(var o=r.bytesToWords(a),l=a.length*8,u=1732584193,c=-271733879,h=-1732584194,d=271733878,f=0;f<o.length;f++)o[f]=(o[f]<<8|o[f]>>>24)&16711935|(o[f]<<24|o[f]>>>8)&4278255360;o[l>>>5]|=128<<l%32,o[(l+64>>>9<<4)+14]=l;for(var p=i._ff,m=i._gg,v=i._hh,g=i._ii,f=0;f<o.length;f+=16){var y=u,_=c,x=h,E=d;u=p(u,c,h,d,o[f+0],7,-680876936),d=p(d,u,c,h,o[f+1],12,-389564586),h=p(h,d,u,c,o[f+2],17,606105819),c=p(c,h,d,u,o[f+3],22,-1044525330),u=p(u,c,h,d,o[f+4],7,-176418897),d=p(d,u,c,h,o[f+5],12,1200080426),h=p(h,d,u,c,o[f+6],17,-1473231341),c=p(c,h,d,u,o[f+7],22,-45705983),u=p(u,c,h,d,o[f+8],7,1770035416),d=p(d,u,c,h,o[f+9],12,-1958414417),h=p(h,d,u,c,o[f+10],17,-42063),c=p(c,h,d,u,o[f+11],22,-1990404162),u=p(u,c,h,d,o[f+12],7,1804603682),d=p(d,u,c,h,o[f+13],12,-40341101),h=p(h,d,u,c,o[f+14],17,-1502002290),c=p(c,h,d,u,o[f+15],22,1236535329),u=m(u,c,h,d,o[f+1],5,-165796510),d=m(d,u,c,h,o[f+6],9,-1069501632),h=m(h,d,u,c,o[f+11],14,643717713),c=m(c,h,d,u,o[f+0],20,-373897302),u=m(u,c,h,d,o[f+5],5,-701558691),d=m(d,u,c,h,o[f+10],9,38016083),h=m(h,d,u,c,o[f+15],14,-660478335),c=m(c,h,d,u,o[f+4],20,-405537848),u=m(u,c,h,d,o[f+9],5,568446438),d=m(d,u,c,h,o[f+14],9,-1019803690),h=m(h,d,u,c,o[f+3],14,-187363961),c=m(c,h,d,u,o[f+8],20,1163531501),u=m(u,c,h,d,o[f+13],5,-1444681467),d=m(d,u,c,h,o[f+2],9,-51403784),h=m(h,d,u,c,o[f+7],14,1735328473),c=m(c,h,d,u,o[f+12],20,-1926607734),u=v(u,c,h,d,o[f+5],4,-378558),d=v(d,u,c,h,o[f+8],11,-2022574463),h=v(h,d,u,c,o[f+11],16,1839030562),c=v(c,h,d,u,o[f+14],23,-35309556),u=v(u,c,h,d,o[f+1],4,-1530992060),d=v(d,u,c,h,o[f+4],11,1272893353),h=v(h,d,u,c,o[f+7],16,-155497632),c=v(c,h,d,u,o[f+10],23,-1094730640),u=v(u,c,h,d,o[f+13],4,681279174),d=v(d,u,c,h,o[f+0],11,-358537222),h=v(h,d,u,c,o[f+3],16,-722521979),c=v(c,h,d,u,o[f+6],23,76029189),u=v(u,c,h,d,o[f+9],4,-640364487),d=v(d,u,c,h,o[f+12],11,-421815835),h=v(h,d,u,c,o[f+15],16,530742520),c=v(c,h,d,u,o[f+2],23,-995338651),u=g(u,c,h,d,o[f+0],6,-198630844),d=g(d,u,c,h,o[f+7],10,1126891415),h=g(h,d,u,c,o[f+14],15,-1416354905),c=g(c,h,d,u,o[f+5],21,-57434055),u=g(u,c,h,d,o[f+12],6,1700485571),d=g(d,u,c,h,o[f+3],10,-1894986606),h=g(h,d,u,c,o[f+10],15,-1051523),c=g(c,h,d,u,o[f+1],21,-2054922799),u=g(u,c,h,d,o[f+8],6,1873313359),d=g(d,u,c,h,o[f+15],10,-30611744),h=g(h,d,u,c,o[f+6],15,-1560198380),c=g(c,h,d,u,o[f+13],21,1309151649),u=g(u,c,h,d,o[f+4],6,-145523070),d=g(d,u,c,h,o[f+11],10,-1120210379),h=g(h,d,u,c,o[f+2],15,718787259),c=g(c,h,d,u,o[f+9],21,-343485551),u=u+y>>>0,c=c+_>>>0,h=h+x>>>0,d=d+E>>>0}return r.endian([u,c,h,d])};i._ff=function(a,s,o,l,u,c,h){var d=a+(s&o|~s&l)+(u>>>0)+h;return(d<<c|d>>>32-c)+s},i._gg=function(a,s,o,l,u,c,h){var d=a+(s&l|o&~l)+(u>>>0)+h;return(d<<c|d>>>32-c)+s},i._hh=function(a,s,o,l,u,c,h){var d=a+(s^o^l)+(u>>>0)+h;return(d<<c|d>>>32-c)+s},i._ii=function(a,s,o,l,u,c,h){var d=a+(o^(s|~l))+(u>>>0)+h;return(d<<c|d>>>32-c)+s},i._blocksize=16,i._digestsize=16,ta.exports=function(a,s){if(a==null)throw new Error("Illegal argument "+a);var o=r.wordsToBytes(i(a,s));return s&&s.asBytes?o:s&&s.asString?n.bytesToString(o):r.bytesToHex(o)}})();function pW(r,e=[]){const t={nodes:[],edges:[]};return r.nodes.forEach(n=>{let i="class"+ta.exports(n.label);t.nodes.push({data:{id:n.id+"",uuid:n.uuid+"",name:n.name,label:n.label,properties:n.properties||null,endpoint:e.includes(String(n.id)),rootId:n.rootId?n.rootId:"",style:n.style||null,userId:n.userId},classes:(e.includes(String(n.id))?["endpoint"]:[]).concat(i).join(" ")})}),r.edges.forEach(n=>{t.edges.push({data:{id:"edges"+n.id,uuid:n.uuid+"",source:n.source+"",target:n.target+"",label:n.label,rootId:n.rootId?n.rootId:"",properties:{...n.properties}}})}),t}function gW(r,e){r.startBatch(),r.elements().removeClass("path-node").removeClass("path-edge").addClass("emphsis"),r.elements().nodes().forEach(t=>{t.removeClass("path-node"),e.includes(t.id())?(t.addClass("path-node").removeClass("emphsis"),t.neighborhood().edges().filter(n=>e.includes(n.source().id())&&e.includes(n.target().id())&&Math.abs(e.indexOf(n.source().id())-e.indexOf(n.target().id()))<=1).removeClass("emphsis").addClass("path-edge")):t.addClass("emphsis")}),r.endBatch()}function $U(r){r.startBatch(),r.elements().removeClass("emphsis").removeClass("path-node").removeClass("path-edge"),r.endBatch()}const er={singleClickFlag:!0,timer:null,fn:null,params:null};function iC(r,e){r.on("click",async t=>{er.fn=e,er.singleClickFlag=!1,er.timer=setTimeout(()=>{er.singleClickFlag=!0},300),er.params=t.target,t.target._private.group==="nodes"&&(t.target._private.data.id,t.target._private.group),t.target._private.group==="edges"&&(t.target._private.data.uuid,t.target._private.group),await $H(()=>import("./index.e66d7253.js").then(n=>n.eK),["./index.e66d7253.js","./index.d1e5caa0.css"],import.meta.url)})}function vW(r,e){r.on("dblclick",t=>{if(er.timer)for(let n=0;n<1e3;n++)clearTimeout(n);e(t.target._private.data)})}function mW(r,e){r.on("cxttapstart",t=>{if(er.timer)for(let n=0;n<1e3;n++)clearTimeout(n);e(t.target._private.data,t.target._private.group,t.renderedPosition)})}function yW(r,e){r.on("mouseup",t=>{e(t.target)})}Object.defineProperty(er,"singleClickFlag",{get:function(){return this.singleClickFlag},set:function(r){r&&(er.params._private&&er.params._private.container?er.fn([]):er.params.isNode()?er.fn([er.params.id()]):er.params.isEdge()&&er.fn([er.params.source().id(),er.params.target().id()],er.params))}});function _W(r,e,t,n){if($U(e),e.elements().style("border-width",2),r.length){if(e.startBatch(),t?e.elements().removeClass("path-node").removeClass("path-edge").addClass("emphsis"):e.elements().removeClass("path-node").removeClass("path-edge"),n)n.source().addClass("path-node").removeClass("emphsis"),n.target().addClass("path-node").removeClass("emphsis"),n.addClass("path-edge").removeClass("emphsis");else{const i=e.elements().find(a=>a.data().id==r[0]);i.style("border-width",3),i.addClass("path-node").removeClass("emphsis"),i.neighborhood().edges().forEach(a=>{a.target().id()===i.id()?a.source().addClass("path-node").removeClass("emphsis"):a.target().addClass("path-node").removeClass("emphsis"),a.addClass("path-edge").removeClass("emphsis")})}e.endBatch()}}const so=[{selector:"node",style:{label:"data(name)","font-size":12,"font-weight":"bold","background-color":"#F6D2A8","border-color":"rgba(233, 166, 89, 1)",color:"#666666","border-width":2,"text-wrap":"ellipsis","text-max-width":200,"text-valign":"bottom","text-margin-y":3,padding:3,width:20,height:20,"background-fit":"contain","background-size":"80%","background-position":"center"}},{selector:".path-node",style:{"border-width":4}},{selector:"edge",style:{label:"data(label)","curve-style":"bezier","line-color":"#939393","target-arrow-color":"#939393",color:"#939393","text-background-color":"#939393","text-border-color":"#939393","line-style":"dashed","line-dash-pattern":[3,3],width:1,"font-size":12,"target-arrow-shape":"triangle","target-arrow-fill":"fill","arrow-scale":.5}},{selector:".path-node-ctx",style:{color:"#70A6F2"}},{selector:".path-edge",style:{"line-color":"#70A6F2","target-arrow-color":"#70A6F2",color:"#70A6F2","text-background-color":"#70A6F2","text-border-color":"#70A6F2"}},{selector:".endpoint",style:{width:40,height:40}},{selector:".emphsis",style:{opacity:.2}},{selector:".opc",style:{opacity:.2}}],ol=["#F6D2A8","#ACE9C4","#ABE8EC","#A3DAF1","#A6BBF2","#EFC4BA","#97CBF0","#C7A1EC","#E1ECA1","#97B4E0","#EDB6B6","#F5DD9F","#F6A8E0","#CDEEB8","#D0C3EC","#82D9FF","#EFF0BA","#FFD2D2","#D4FFD3","#FFA4CA","#B6DFD8","#EFE6B8"],ll=["#C0751E","#2AB662","#25A4AC","#2785AC","#2C55BE","#B04B34","#2B71A5","#642F99","#819221","#2B5AA0","#A43737","#9F7D23","#A5538E","#77A858","#9A82CE","#00B4FF","#ADB007","#9E5849","#61B27D","#B41591","#66A499","#A79D6A"],aC={breadthfirst:{name:"breadthfirst",fit:!0,directed:!1,padding:0,circle:!1,Ready:()=>{},Stop:()=>{}},grid:{name:"grid",fit:!0,padding:0,Ready:()=>{},Stop:()=>{}},concentric:{name:"concentric",fit:!0,padding:0,startAngle:3/2*Math.PI,clockwise:!0,width:void 0,height:void 0,Ready:()=>{},Stop:()=>{}},circle:{name:"circle",fit:!0,padding:0,radius:void 0,clockwise:!0,Ready:()=>{},Stop:()=>{}},"d3-force":{name:"d3-force",animate:!0,fixedAfterDragging:!0,linkId:function(e){return e.id},maxSimulationTime:100,maxIterations:1,linkDistance:300,manyBodyStrength:-600,ready:function(){document.getElementById(`progress-box${jh}`).style.display="block"},stop:function(){document.getElementById(`progress-box${jh}`).style.display="none",XU.center()},tick:function(r){let e=(r*100).toFixed(1)+"%";document.getElementById(`progress-text${jh}`).innerHTML=`\u6B63\u5728\u8BA1\u7B97\u5E03\u5C40\uFF0C\u8BF7\u7A0D\u540E ${e}`,document.getElementById(`progress-bar${jh}`).style.width=e},randomize:!1,infinite:!0,fit:!1},fcose:{name:"fcose",quality:"default",randomize:!0,animate:!0,animationDuration:500,animationEasing:void 0,fit:!0,padding:0,nodeRepulsion:r=>45e3,idealEdgeLength:r=>150,edgeElasticity:r=>.45,nestingFactor:.1,numIter:2500,gravity:.25,gravityRangeCompound:1.5,gravityCompound:1,gravityRange:3.8,initialEnergyOnIncremental:.3,Ready:()=>{},Stop:()=>{}},dagre:{name:"dagre",nodeSep:void 0,edgeSep:void 0,rankSep:void 0,rankDir:void 0,align:void 0,acyclicer:void 0,ranker:void 0,minLen:function(r){return 1},edgeWeight:function(r){return 1},fit:!0,padding:30,spacingFactor:void 0,nodeDimensionsIncludeLabels:!1,animate:!1,animateFilter:function(r,e){return!0},animationDuration:500,animationEasing:void 0,boundingBox:void 0,transform:function(r,e){return e},ready:function(){},sort:void 0,stop:function(){}},random:{name:"random",fit:!0,padding:0,Ready:()=>{},Stop:()=>{}}};let jh=0,XU=null;const xW=(r,e)=>{jh=r,XU=e};function Tw(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=Array(e);t<e;t++)n[t]=r[t];return n}function bW(r){if(Array.isArray(r))return r}function EW(r){if(Array.isArray(r))return Tw(r)}function jo(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function TW(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,KU(n.key),n)}}function Ko(r,e,t){return e&&TW(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function Na(r,e){var t=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=NS(r))||e){t&&(r=t);var n=0,i=function(){};return{s:i,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a,s=!0,o=!1;return{s:function(){t=t.call(r)},n:function(){var l=t.next();return s=l.done,l},e:function(l){o=!0,a=l},f:function(){try{s||t.return==null||t.return()}finally{if(o)throw a}}}}function YU(r,e,t){return(e=KU(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function wW(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function SW(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var n,i,a,s,o=[],l=!0,u=!1;try{if(a=(t=t.call(r)).next,e===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(n=a.call(t)).done)&&(o.push(n.value),o.length!==e);l=!0);}catch(c){u=!0,i=c}finally{try{if(!l&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(u)throw i}}return o}}function AW(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MW(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vr(r,e){return bW(r)||SW(r,e)||NS(r,e)||AW()}function jU(r){return EW(r)||wW(r)||NS(r)||MW()}function CW(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function KU(r){var e=CW(r,"string");return typeof e=="symbol"?e:e+""}function sr(r){return sr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},sr(r)}function NS(r,e){if(r){if(typeof r=="string")return Tw(r,e);var t={}.toString.call(r).slice(8,-1);return t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set"?Array.from(r):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Tw(r,e):void 0}}var tr=typeof window>"u"?null:window,sC=tr?tr.navigator:null;tr&&tr.document;var RW=sr(""),QU=sr({}),NW=sr(function(){}),PW=typeof HTMLElement>"u"?"undefined":sr(HTMLElement),fd=function(e){return e&&e.instanceString&&Pn(e.instanceString)?e.instanceString():null},dt=function(e){return e!=null&&sr(e)==RW},Pn=function(e){return e!=null&&sr(e)===NW},fn=function(e){return!ki(e)&&(Array.isArray?Array.isArray(e):e!=null&&e instanceof Array)},$t=function(e){return e!=null&&sr(e)===QU&&!fn(e)&&e.constructor===Object},DW=function(e){return e!=null&&sr(e)===QU},et=function(e){return e!=null&&sr(e)===sr(1)&&!isNaN(e)},LW=function(e){return et(e)&&Math.floor(e)===e},Bg=function(e){if(PW!=="undefined")return e!=null&&e instanceof HTMLElement},ki=function(e){return dd(e)||ZU(e)},dd=function(e){return fd(e)==="collection"&&e._private.single},ZU=function(e){return fd(e)==="collection"&&!e._private.single},PS=function(e){return fd(e)==="core"},JU=function(e){return fd(e)==="stylesheet"},IW=function(e){return fd(e)==="event"},Bo=function(e){return e==null?!0:!!(e===""||e.match(/^\s+$/))},OW=function(e){return typeof HTMLElement>"u"?!1:e instanceof HTMLElement},FW=function(e){return $t(e)&&et(e.x1)&&et(e.x2)&&et(e.y1)&&et(e.y2)},BW=function(e){return DW(e)&&Pn(e.then)},UW=function(){return sC&&sC.userAgent.match(/msie|trident|edge/i)},_c=function(e,t){t||(t=function(){if(arguments.length===1)return arguments[0];if(arguments.length===0)return"undefined";for(var a=[],s=0;s<arguments.length;s++)a.push(arguments[s]);return a.join("$")});var n=function(){var a=this,s=arguments,o,l=t.apply(a,s),u=n.cache;return(o=u[l])||(o=u[l]=e.apply(a,s)),o};return n.cache={},n},DS=_c(function(r){return r.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}),xv=_c(function(r){return r.replace(/(-\w)/g,function(e){return e[1].toUpperCase()})}),ek=_c(function(r,e){return r+e[0].toUpperCase()+e.substring(1)},function(r,e){return r+"$"+e}),oC=function(e){return Bo(e)?e:e.charAt(0).toUpperCase()+e.substring(1)},nr="(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))",kW="rgb[a]?\\(("+nr+"[%]?)\\s*,\\s*("+nr+"[%]?)\\s*,\\s*("+nr+"[%]?)(?:\\s*,\\s*("+nr+"))?\\)",GW="rgb[a]?\\((?:"+nr+"[%]?)\\s*,\\s*(?:"+nr+"[%]?)\\s*,\\s*(?:"+nr+"[%]?)(?:\\s*,\\s*(?:"+nr+"))?\\)",zW="hsl[a]?\\(("+nr+")\\s*,\\s*("+nr+"[%])\\s*,\\s*("+nr+"[%])(?:\\s*,\\s*("+nr+"))?\\)",VW="hsl[a]?\\((?:"+nr+")\\s*,\\s*(?:"+nr+"[%])\\s*,\\s*(?:"+nr+"[%])(?:\\s*,\\s*(?:"+nr+"))?\\)",HW="\\#[0-9a-fA-F]{3}",WW="\\#[0-9a-fA-F]{6}",tk=function(e,t){return e<t?-1:e>t?1:0},qW=function(e,t){return-1*tk(e,t)},mt=Object.assign!=null?Object.assign.bind(Object):function(r){for(var e=arguments,t=1;t<e.length;t++){var n=e[t];if(n!=null)for(var i=Object.keys(n),a=0;a<i.length;a++){var s=i[a];r[s]=n[s]}}return r},$W=function(e){if(!(!(e.length===4||e.length===7)||e[0]!=="#")){var t=e.length===4,n,i,a,s=16;return t?(n=parseInt(e[1]+e[1],s),i=parseInt(e[2]+e[2],s),a=parseInt(e[3]+e[3],s)):(n=parseInt(e[1]+e[2],s),i=parseInt(e[3]+e[4],s),a=parseInt(e[5]+e[6],s)),[n,i,a]}},XW=function(e){var t,n,i,a,s,o,l,u;function c(p,m,v){return v<0&&(v+=1),v>1&&(v-=1),v<1/6?p+(m-p)*6*v:v<1/2?m:v<2/3?p+(m-p)*(2/3-v)*6:p}var h=new RegExp("^"+zW+"$").exec(e);if(h){if(n=parseInt(h[1]),n<0?n=(360- -1*n%360)%360:n>360&&(n=n%360),n/=360,i=parseFloat(h[2]),i<0||i>100||(i=i/100,a=parseFloat(h[3]),a<0||a>100)||(a=a/100,s=h[4],s!==void 0&&(s=parseFloat(s),s<0||s>1)))return;if(i===0)o=l=u=Math.round(a*255);else{var d=a<.5?a*(1+i):a+i-a*i,f=2*a-d;o=Math.round(255*c(f,d,n+1/3)),l=Math.round(255*c(f,d,n)),u=Math.round(255*c(f,d,n-1/3))}t=[o,l,u,s]}return t},YW=function(e){var t,n=new RegExp("^"+kW+"$").exec(e);if(n){t=[];for(var i=[],a=1;a<=3;a++){var s=n[a];if(s[s.length-1]==="%"&&(i[a]=!0),s=parseFloat(s),i[a]&&(s=s/100*255),s<0||s>255)return;t.push(Math.floor(s))}var o=i[1]||i[2]||i[3],l=i[1]&&i[2]&&i[3];if(o&&!l)return;var u=n[4];if(u!==void 0){if(u=parseFloat(u),u<0||u>1)return;t.push(u)}}return t},jW=function(e){return KW[e.toLowerCase()]},nk=function(e){return(fn(e)?e:null)||jW(e)||$W(e)||YW(e)||XW(e)},KW={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},rk=function(e){for(var t=e.map,n=e.keys,i=n.length,a=0;a<i;a++){var s=n[a];if($t(s))throw Error("Tried to set map with object key");a<n.length-1?(t[s]==null&&(t[s]={}),t=t[s]):t[s]=e.value}},ik=function(e){for(var t=e.map,n=e.keys,i=n.length,a=0;a<i;a++){var s=n[a];if($t(s))throw Error("Tried to get map with object key");if(t=t[s],t==null)return t}return t},Yd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pd(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Hm,lC;function gd(){if(lC)return Hm;lC=1;function r(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}return Hm=r,Hm}var Wm,uC;function QW(){if(uC)return Wm;uC=1;var r=typeof Yd=="object"&&Yd&&Yd.Object===Object&&Yd;return Wm=r,Wm}var qm,cC;function bv(){if(cC)return qm;cC=1;var r=QW(),e=typeof self=="object"&&self&&self.Object===Object&&self,t=r||e||Function("return this")();return qm=t,qm}var $m,hC;function ZW(){if(hC)return $m;hC=1;var r=bv(),e=function(){return r.Date.now()};return $m=e,$m}var Xm,fC;function JW(){if(fC)return Xm;fC=1;var r=/\s/;function e(t){for(var n=t.length;n--&&r.test(t.charAt(n)););return n}return Xm=e,Xm}var Ym,dC;function eq(){if(dC)return Ym;dC=1;var r=JW(),e=/^\s+/;function t(n){return n&&n.slice(0,r(n)+1).replace(e,"")}return Ym=t,Ym}var jm,pC;function LS(){if(pC)return jm;pC=1;var r=bv(),e=r.Symbol;return jm=e,jm}var Km,gC;function tq(){if(gC)return Km;gC=1;var r=LS(),e=Object.prototype,t=e.hasOwnProperty,n=e.toString,i=r?r.toStringTag:void 0;function a(s){var o=t.call(s,i),l=s[i];try{s[i]=void 0;var u=!0}catch{}var c=n.call(s);return u&&(o?s[i]=l:delete s[i]),c}return Km=a,Km}var Qm,vC;function nq(){if(vC)return Qm;vC=1;var r=Object.prototype,e=r.toString;function t(n){return e.call(n)}return Qm=t,Qm}var Zm,mC;function ak(){if(mC)return Zm;mC=1;var r=LS(),e=tq(),t=nq(),n="[object Null]",i="[object Undefined]",a=r?r.toStringTag:void 0;function s(o){return o==null?o===void 0?i:n:a&&a in Object(o)?e(o):t(o)}return Zm=s,Zm}var Jm,yC;function rq(){if(yC)return Jm;yC=1;function r(e){return e!=null&&typeof e=="object"}return Jm=r,Jm}var ey,_C;function vd(){if(_C)return ey;_C=1;var r=ak(),e=rq(),t="[object Symbol]";function n(i){return typeof i=="symbol"||e(i)&&r(i)==t}return ey=n,ey}var ty,xC;function iq(){if(xC)return ty;xC=1;var r=eq(),e=gd(),t=vd(),n=0/0,i=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,s=/^0o[0-7]+$/i,o=parseInt;function l(u){if(typeof u=="number")return u;if(t(u))return n;if(e(u)){var c=typeof u.valueOf=="function"?u.valueOf():u;u=e(c)?c+"":c}if(typeof u!="string")return u===0?u:+u;u=r(u);var h=a.test(u);return h||s.test(u)?o(u.slice(2),h?2:8):i.test(u)?n:+u}return ty=l,ty}var ny,bC;function aq(){if(bC)return ny;bC=1;var r=gd(),e=ZW(),t=iq(),n="Expected a function",i=Math.max,a=Math.min;function s(o,l,u){var c,h,d,f,p,m,v=0,g=!1,y=!1,_=!0;if(typeof o!="function")throw new TypeError(n);l=t(l)||0,r(u)&&(g=!!u.leading,y="maxWait"in u,d=y?i(t(u.maxWait)||0,l):d,_="trailing"in u?!!u.trailing:_);function x(P){var M=c,N=h;return c=h=void 0,v=P,f=o.apply(N,M),f}function E(P){return v=P,p=setTimeout(w,l),g?x(P):f}function T(P){var M=P-m,N=P-v,D=l-M;return y?a(D,d-N):D}function b(P){var M=P-m,N=P-v;return m===void 0||M>=l||M<0||y&&N>=d}function w(){var P=e();if(b(P))return A(P);p=setTimeout(w,T(P))}function A(P){return p=void 0,_&&c?x(P):(c=h=void 0,f)}function S(){p!==void 0&&clearTimeout(p),v=0,c=m=h=p=void 0}function C(){return p===void 0?f:A(e())}function R(){var P=e(),M=b(P);if(c=arguments,h=this,m=P,M){if(p===void 0)return E(m);if(y)return clearTimeout(p),p=setTimeout(w,l),x(m)}return p===void 0&&(p=setTimeout(w,l)),f}return R.cancel=S,R.flush=C,R}return ny=s,ny}var sq=aq(),md=pd(sq),ry=tr?tr.performance:null,sk=ry&&ry.now?function(){return ry.now()}:function(){return Date.now()},oq=function(){if(tr){if(tr.requestAnimationFrame)return function(r){tr.requestAnimationFrame(r)};if(tr.mozRequestAnimationFrame)return function(r){tr.mozRequestAnimationFrame(r)};if(tr.webkitRequestAnimationFrame)return function(r){tr.webkitRequestAnimationFrame(r)};if(tr.msRequestAnimationFrame)return function(r){tr.msRequestAnimationFrame(r)}}return function(r){r&&setTimeout(function(){r(sk())},1e3/60)}}(),Ug=function(e){return oq(e)},qs=sk,ju=9261,ok=65599,Kh=5381,lk=function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ju,n=t,i;i=e.next(),!i.done;)n=n*ok+i.value|0;return n},wf=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ju;return t*ok+e|0},Sf=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kh;return(t<<5)+t+e|0},lq=function(e,t){return e*2097152+t},oo=function(e){return e[0]*2097152+e[1]},jd=function(e,t){return[wf(e[0],t[0]),Sf(e[1],t[1])]},EC=function(e,t){var n={value:0,done:!1},i=0,a=e.length,s={next:function(){return i<a?n.value=e[i++]:n.done=!0,n}};return lk(s,t)},Uo=function(e,t){var n={value:0,done:!1},i=0,a=e.length,s={next:function(){return i<a?n.value=e.charCodeAt(i++):n.done=!0,n}};return lk(s,t)},uk=function(){return uq(arguments)},uq=function(e){for(var t,n=0;n<e.length;n++){var i=e[n];n===0?t=Uo(i):t=Uo(i,t)}return t},TC=!0,cq=console.warn!=null,hq=console.trace!=null,IS=Number.MAX_SAFE_INTEGER||9007199254740991,ck=function(){return!0},kg=function(){return!1},wC=function(){return 0},OS=function(){},Nn=function(e){throw new Error(e)},hk=function(e){if(e!==void 0)TC=!!e;else return TC},nn=function(e){!hk()||(cq?console.warn(e):(console.log(e),hq&&console.trace()))},fq=function(e){return mt({},e)},es=function(e){return e==null?e:fn(e)?e.slice():$t(e)?fq(e):e},dq=function(e){return e.slice()},fk=function(e,t){for(t=e="";e++<36;t+=e*51&52?(e^15?8^Math.random()*(e^20?16:4):4).toString(16):"-");return t},pq={},dk=function(){return pq},cr=function(e){var t=Object.keys(e);return function(n){for(var i={},a=0;a<t.length;a++){var s=t[a],o=n==null?void 0:n[s];i[s]=o===void 0?e[s]:o}return i}},ko=function(e,t,n){for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)},FS=function(e){e.splice(0,e.length)},gq=function(e,t){for(var n=0;n<t.length;n++){var i=t[n];e.push(i)}},Qi=function(e,t,n){return n&&(t=ek(n,t)),e[t]},Ss=function(e,t,n,i){n&&(t=ek(n,t)),e[t]=i},vq=function(){function r(){jo(this,r),this._obj={}}return Ko(r,[{key:"set",value:function(t,n){return this._obj[t]=n,this}},{key:"delete",value:function(t){return this._obj[t]=void 0,this}},{key:"clear",value:function(){this._obj={}}},{key:"has",value:function(t){return this._obj[t]!==void 0}},{key:"get",value:function(t){return this._obj[t]}}])}(),Os=typeof Map<"u"?Map:vq,mq="undefined",yq=function(){function r(e){if(jo(this,r),this._obj=Object.create(null),this.size=0,e!=null){var t;e.instanceString!=null&&e.instanceString()===this.instanceString()?t=e.toArray():t=e;for(var n=0;n<t.length;n++)this.add(t[n])}}return Ko(r,[{key:"instanceString",value:function(){return"set"}},{key:"add",value:function(t){var n=this._obj;n[t]!==1&&(n[t]=1,this.size++)}},{key:"delete",value:function(t){var n=this._obj;n[t]===1&&(n[t]=0,this.size--)}},{key:"clear",value:function(){this._obj=Object.create(null)}},{key:"has",value:function(t){return this._obj[t]===1}},{key:"toArray",value:function(){var t=this;return Object.keys(this._obj).filter(function(n){return t.has(n)})}},{key:"forEach",value:function(t,n){return this.toArray().forEach(t,n)}}])}(),jc=(typeof Set>"u"?"undefined":sr(Set))!==mq?Set:yq,Ev=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(e===void 0||t===void 0||!PS(e)){Nn("An element must have a core reference and parameters set");return}var i=t.group;if(i==null&&(t.data&&t.data.source!=null&&t.data.target!=null?i="edges":i="nodes"),i!=="nodes"&&i!=="edges"){Nn("An element must be of type `nodes` or `edges`; you specified `"+i+"`");return}this.length=1,this[0]=this;var a=this._private={cy:e,single:!0,data:t.data||{},position:t.position||{x:0,y:0},autoWidth:void 0,autoHeight:void 0,autoPadding:void 0,compoundBoundsClean:!1,listeners:[],group:i,style:{},rstyle:{},styleCxts:[],styleKeys:{},removed:!0,selected:!!t.selected,selectable:t.selectable===void 0?!0:!!t.selectable,locked:!!t.locked,grabbed:!1,grabbable:t.grabbable===void 0?!0:!!t.grabbable,pannable:t.pannable===void 0?i==="edges":!!t.pannable,active:!1,classes:new jc,animation:{current:[],queue:[]},rscratch:{},scratch:t.scratch||{},edges:[],children:[],parent:t.parent&&t.parent.isNode()?t.parent:null,traversalCache:{},backgrounding:!1,bbCache:null,bbCacheShift:{x:0,y:0},bodyBounds:null,overlayBounds:null,labelBounds:{all:null,source:null,target:null,main:null},arrowBounds:{source:null,target:null,"mid-source":null,"mid-target":null}};if(a.position.x==null&&(a.position.x=0),a.position.y==null&&(a.position.y=0),t.renderedPosition){var s=t.renderedPosition,o=e.pan(),l=e.zoom();a.position={x:(s.x-o.x)/l,y:(s.y-o.y)/l}}var u=[];fn(t.classes)?u=t.classes:dt(t.classes)&&(u=t.classes.split(/\s+/));for(var c=0,h=u.length;c<h;c++){var d=u[c];!d||d===""||a.classes.add(d)}this.createEmitter(),(n===void 0||n)&&this.restore();var f=t.style||t.css;f&&(nn("Setting a `style` bypass at element creation should be done only when absolutely necessary.  Try to use the stylesheet instead."),this.style(f))},SC=function(e){return e={bfs:e.bfs||!e.dfs,dfs:e.dfs||!e.bfs},function(n,i,a){var s;$t(n)&&!ki(n)&&(s=n,n=s.roots||s.root,i=s.visit,a=s.directed),a=arguments.length===2&&!Pn(i)?i:a,i=Pn(i)?i:function(){};for(var o=this._private.cy,l=n=dt(n)?this.filter(n):n,u=[],c=[],h={},d={},f={},p=0,m,v=this.byGroup(),g=v.nodes,y=v.edges,_=0;_<l.length;_++){var x=l[_],E=x.id();x.isNode()&&(u.unshift(x),e.bfs&&(f[E]=!0,c.push(x)),d[E]=0)}for(var T=function(){var P=e.bfs?u.shift():u.pop(),M=P.id();if(e.dfs){if(f[M])return 0;f[M]=!0,c.push(P)}var N=d[M],D=h[M],I=D!=null?D.source():null,L=D!=null?D.target():null,z=D==null?void 0:P.same(I)?L[0]:I[0],B;if(B=i(P,D,z,p++,N),B===!0)return m=P,1;if(B===!1)return 1;for(var k=P.connectedEdges().filter(function(V){return(!a||V.source().same(P))&&y.has(V)}),U=0;U<k.length;U++){var G=k[U],O=G.connectedNodes().filter(function(V){return!V.same(P)&&g.has(V)}),F=O.id();O.length!==0&&!f[F]&&(O=O[0],u.push(O),e.bfs&&(f[F]=!0,c.push(O)),h[F]=G,d[F]=d[M]+1)}},b;u.length!==0&&(b=T(),!(b!==0&&b===1)););for(var w=o.collection(),A=0;A<c.length;A++){var S=c[A],C=h[S.id()];C!=null&&w.push(C),w.push(S)}return{path:o.collection(w),found:o.collection(m)}}},Af={breadthFirstSearch:SC({bfs:!0}),depthFirstSearch:SC({dfs:!0})};Af.bfs=Af.breadthFirstSearch;Af.dfs=Af.depthFirstSearch;var hg={exports:{}},_q=hg.exports,AC;function xq(){return AC||(AC=1,function(r,e){(function(){var t,n,i,a,s,o,l,u,c,h,d,f,p,m,v;i=Math.floor,h=Math.min,n=function(g,y){return g<y?-1:g>y?1:0},c=function(g,y,_,x,E){var T;if(_==null&&(_=0),E==null&&(E=n),_<0)throw new Error("lo must be non-negative");for(x==null&&(x=g.length);_<x;)T=i((_+x)/2),E(y,g[T])<0?x=T:_=T+1;return[].splice.apply(g,[_,_-_].concat(y)),y},o=function(g,y,_){return _==null&&(_=n),g.push(y),m(g,0,g.length-1,_)},s=function(g,y){var _,x;return y==null&&(y=n),_=g.pop(),g.length?(x=g[0],g[0]=_,v(g,0,y)):x=_,x},u=function(g,y,_){var x;return _==null&&(_=n),x=g[0],g[0]=y,v(g,0,_),x},l=function(g,y,_){var x;return _==null&&(_=n),g.length&&_(g[0],y)<0&&(x=[g[0],y],y=x[0],g[0]=x[1],v(g,0,_)),y},a=function(g,y){var _,x,E,T,b,w;for(y==null&&(y=n),T=function(){w=[];for(var A=0,S=i(g.length/2);0<=S?A<S:A>S;0<=S?A++:A--)w.push(A);return w}.apply(this).reverse(),b=[],x=0,E=T.length;x<E;x++)_=T[x],b.push(v(g,_,y));return b},p=function(g,y,_){var x;if(_==null&&(_=n),x=g.indexOf(y),x!==-1)return m(g,0,x,_),v(g,x,_)},d=function(g,y,_){var x,E,T,b,w;if(_==null&&(_=n),E=g.slice(0,y),!E.length)return E;for(a(E,_),w=g.slice(y),T=0,b=w.length;T<b;T++)x=w[T],l(E,x,_);return E.sort(_).reverse()},f=function(g,y,_){var x,E,T,b,w,A,S,C,R;if(_==null&&(_=n),y*10<=g.length){if(T=g.slice(0,y).sort(_),!T.length)return T;for(E=T[T.length-1],S=g.slice(y),b=0,A=S.length;b<A;b++)x=S[b],_(x,E)<0&&(c(T,x,0,null,_),T.pop(),E=T[T.length-1]);return T}for(a(g,_),R=[],w=0,C=h(y,g.length);0<=C?w<C:w>C;0<=C?++w:--w)R.push(s(g,_));return R},m=function(g,y,_,x){var E,T,b;for(x==null&&(x=n),E=g[_];_>y;){if(b=_-1>>1,T=g[b],x(E,T)<0){g[_]=T,_=b;continue}break}return g[_]=E},v=function(g,y,_){var x,E,T,b,w;for(_==null&&(_=n),E=g.length,w=y,T=g[y],x=2*y+1;x<E;)b=x+1,b<E&&!(_(g[x],g[b])<0)&&(x=b),g[y]=g[x],y=x,x=2*y+1;return g[y]=T,m(g,w,y,_)},t=function(){g.push=o,g.pop=s,g.replace=u,g.pushpop=l,g.heapify=a,g.updateItem=p,g.nlargest=d,g.nsmallest=f;function g(y){this.cmp=y!=null?y:n,this.nodes=[]}return g.prototype.push=function(y){return o(this.nodes,y,this.cmp)},g.prototype.pop=function(){return s(this.nodes,this.cmp)},g.prototype.peek=function(){return this.nodes[0]},g.prototype.contains=function(y){return this.nodes.indexOf(y)!==-1},g.prototype.replace=function(y){return u(this.nodes,y,this.cmp)},g.prototype.pushpop=function(y){return l(this.nodes,y,this.cmp)},g.prototype.heapify=function(){return a(this.nodes,this.cmp)},g.prototype.updateItem=function(y){return p(this.nodes,y,this.cmp)},g.prototype.clear=function(){return this.nodes=[]},g.prototype.empty=function(){return this.nodes.length===0},g.prototype.size=function(){return this.nodes.length},g.prototype.clone=function(){var y;return y=new g,y.nodes=this.nodes.slice(0),y},g.prototype.toArray=function(){return this.nodes.slice(0)},g.prototype.insert=g.prototype.push,g.prototype.top=g.prototype.peek,g.prototype.front=g.prototype.peek,g.prototype.has=g.prototype.contains,g.prototype.copy=g.prototype.clone,g}(),function(g,y){return r.exports=y()}(this,function(){return t})}).call(_q)}(hg)),hg.exports}var iy,MC;function bq(){return MC||(MC=1,iy=xq()),iy}var Eq=bq(),yd=pd(Eq),Tq=cr({root:null,weight:function(e){return 1},directed:!1}),wq={dijkstra:function(e){if(!$t(e)){var t=arguments;e={root:t[0],weight:t[1],directed:t[2]}}var n=Tq(e),i=n.root,a=n.weight,s=n.directed,o=this,l=a,u=dt(i)?this.filter(i)[0]:i[0],c={},h={},d={},f=this.byGroup(),p=f.nodes,m=f.edges;m.unmergeBy(function(N){return N.isLoop()});for(var v=function(D){return c[D.id()]},g=function(D,I){c[D.id()]=I,y.updateItem(D)},y=new yd(function(N,D){return v(N)-v(D)}),_=0;_<p.length;_++){var x=p[_];c[x.id()]=x.same(u)?0:1/0,y.push(x)}for(var E=function(D,I){for(var L=(s?D.edgesTo(I):D.edgesWith(I)).intersect(m),z=1/0,B,k=0;k<L.length;k++){var U=L[k],G=l(U);(G<z||!B)&&(z=G,B=U)}return{edge:B,dist:z}};y.size()>0;){var T=y.pop(),b=v(T),w=T.id();if(d[w]=b,b!==1/0)for(var A=T.neighborhood().intersect(p),S=0;S<A.length;S++){var C=A[S],R=C.id(),P=E(T,C),M=b+P.dist;M<v(C)&&(g(C,M),h[R]={node:T,edge:P.edge})}}return{distanceTo:function(D){var I=dt(D)?p.filter(D)[0]:D[0];return d[I.id()]},pathTo:function(D){var I=dt(D)?p.filter(D)[0]:D[0],L=[],z=I,B=z.id();if(I.length>0)for(L.unshift(I);h[B];){var k=h[B];L.unshift(k.edge),L.unshift(k.node),z=k.node,B=z.id()}return o.spawn(L)}}}},Sq={kruskal:function(e){e=e||function(_){return 1};for(var t=this.byGroup(),n=t.nodes,i=t.edges,a=n.length,s=new Array(a),o=n,l=function(x){for(var E=0;E<s.length;E++){var T=s[E];if(T.has(x))return E}},u=0;u<a;u++)s[u]=this.spawn(n[u]);for(var c=i.sort(function(_,x){return e(_)-e(x)}),h=0;h<c.length;h++){var d=c[h],f=d.source()[0],p=d.target()[0],m=l(f),v=l(p),g=s[m],y=s[v];m!==v&&(o.merge(d),g.merge(y),s.splice(v,1))}return o}},Aq=cr({root:null,goal:null,weight:function(e){return 1},heuristic:function(e){return 0},directed:!1}),Mq={aStar:function(e){var t=this.cy(),n=Aq(e),i=n.root,a=n.goal,s=n.heuristic,o=n.directed,l=n.weight;i=t.collection(i)[0],a=t.collection(a)[0];var u=i.id(),c=a.id(),h={},d={},f={},p=new yd(function(B,k){return d[B.id()]-d[k.id()]}),m=new jc,v={},g={},y=function(k,U){p.push(k),m.add(U)},_,x,E=function(){_=p.pop(),x=_.id(),m.delete(x)},T=function(k){return m.has(k)};y(i,u),h[u]=0,d[u]=s(i);for(var b=0;p.size()>0;){if(E(),b++,x===c){for(var w=[],A=a,S=c,C=g[S];w.unshift(A),C!=null&&w.unshift(C),A=v[S],A!=null;)S=A.id(),C=g[S];return{found:!0,distance:h[x],path:this.spawn(w),steps:b}}f[x]=!0;for(var R=_._private.edges,P=0;P<R.length;P++){var M=R[P];if(!!this.hasElementWithId(M.id())&&!(o&&M.data("source")!==x)){var N=M.source(),D=M.target(),I=N.id()!==x?N:D,L=I.id();if(!!this.hasElementWithId(L)&&!f[L]){var z=h[x]+l(M);if(!T(L)){h[L]=z,d[L]=z+s(I),y(I,L),v[L]=_,g[L]=M;continue}z<h[L]&&(h[L]=z,d[L]=z+s(I),v[L]=_,g[L]=M)}}}}return{found:!1,distance:void 0,path:void 0,steps:b}}},Cq=cr({weight:function(e){return 1},directed:!1}),Rq={floydWarshall:function(e){for(var t=this.cy(),n=Cq(e),i=n.weight,a=n.directed,s=i,o=this.byGroup(),l=o.nodes,u=o.edges,c=l.length,h=c*c,d=function(G){return l.indexOf(G)},f=function(G){return l[G]},p=new Array(h),m=0;m<h;m++){var v=m%c,g=(m-v)/c;g===v?p[m]=0:p[m]=1/0}for(var y=new Array(h),_=new Array(h),x=0;x<u.length;x++){var E=u[x],T=E.source()[0],b=E.target()[0];if(T!==b){var w=d(T),A=d(b),S=w*c+A,C=s(E);if(p[S]>C&&(p[S]=C,y[S]=A,_[S]=E),!a){var R=A*c+w;!a&&p[R]>C&&(p[R]=C,y[R]=w,_[R]=E)}}}for(var P=0;P<c;P++)for(var M=0;M<c;M++)for(var N=M*c+P,D=0;D<c;D++){var I=M*c+D,L=P*c+D;p[N]+p[L]<p[I]&&(p[I]=p[N]+p[L],y[I]=y[N])}var z=function(G){return(dt(G)?t.filter(G):G)[0]},B=function(G){return d(z(G))},k={distance:function(G,O){var F=B(G),V=B(O);return p[F*c+V]},path:function(G,O){var F=B(G),V=B(O),$=f(F);if(F===V)return $.collection();if(y[F*c+V]==null)return t.collection();var Z=t.collection(),Y=F,X;for(Z.merge($);F!==V;)Y=F,F=y[F*c+V],X=_[Y*c+F],Z.merge(X),Z.merge(f(F));return Z}};return k}},Nq=cr({weight:function(e){return 1},directed:!1,root:null}),Pq={bellmanFord:function(e){var t=this,n=Nq(e),i=n.weight,a=n.directed,s=n.root,o=i,l=this,u=this.cy(),c=this.byGroup(),h=c.edges,d=c.nodes,f=d.length,p=new Os,m=!1,v=[];s=u.collection(s)[0],h.unmergeBy(function(we){return we.isLoop()});for(var g=h.length,y=function(pe){var Me=p.get(pe.id());return Me||(Me={},p.set(pe.id(),Me)),Me},_=function(pe){return(dt(pe)?u.$(pe):pe)[0]},x=function(pe){return y(_(pe)).dist},E=function(pe){for(var Me=arguments.length>1&&arguments[1]!==void 0?arguments[1]:s,Ae=_(pe),j=[],H=Ae;;){if(H==null)return t.spawn();var te=y(H),me=te.edge,Ee=te.pred;if(j.unshift(H[0]),H.same(Me)&&j.length>0)break;me!=null&&j.unshift(me),H=Ee}return l.spawn(j)},T=0;T<f;T++){var b=d[T],w=y(b);b.same(s)?w.dist=0:w.dist=1/0,w.pred=null,w.edge=null}for(var A=!1,S=function(pe,Me,Ae,j,H,te){var me=j.dist+te;me<H.dist&&!Ae.same(j.edge)&&(H.dist=me,H.pred=pe,H.edge=Ae,A=!0)},C=1;C<f;C++){A=!1;for(var R=0;R<g;R++){var P=h[R],M=P.source(),N=P.target(),D=o(P),I=y(M),L=y(N);S(M,N,P,I,L,D),a||S(N,M,P,L,I,D)}if(!A)break}if(A)for(var z=[],B=0;B<g;B++){var k=h[B],U=k.source(),G=k.target(),O=o(k),F=y(U).dist,V=y(G).dist;if(F+O<V||!a&&V+O<F)if(m||(nn("Graph contains a negative weight cycle for Bellman-Ford"),m=!0),e.findNegativeWeightCycles!==!1){var $=[];F+O<V&&$.push(U),!a&&V+O<F&&$.push(G);for(var Z=$.length,Y=0;Y<Z;Y++){var X=$[Y],K=[X];K.push(y(X).edge);for(var se=y(X).pred;K.indexOf(se)===-1;)K.push(se),K.push(y(se).edge),se=y(se).pred;K=K.slice(K.indexOf(se));for(var oe=K[0].id(),W=0,Ne=2;Ne<K.length;Ne+=2)K[Ne].id()<oe&&(oe=K[Ne].id(),W=Ne);K=K.slice(W).concat(K.slice(0,W)),K.push(K[0]);var Be=K.map(function(we){return we.id()}).join(",");z.indexOf(Be)===-1&&(v.push(l.spawn(K)),z.push(Be))}}else break}return{distanceTo:x,pathTo:E,hasNegativeWeightCycle:m,negativeWeightCycles:v}}},Dq=Math.sqrt(2),Lq=function(e,t,n){n.length===0&&Nn("Karger-Stein must be run on a connected (sub)graph");for(var i=n[e],a=i[1],s=i[2],o=t[a],l=t[s],u=n,c=u.length-1;c>=0;c--){var h=u[c],d=h[1],f=h[2];(t[d]===o&&t[f]===l||t[d]===l&&t[f]===o)&&u.splice(c,1)}for(var p=0;p<u.length;p++){var m=u[p];m[1]===l?(u[p]=m.slice(),u[p][1]=o):m[2]===l&&(u[p]=m.slice(),u[p][2]=o)}for(var v=0;v<t.length;v++)t[v]===l&&(t[v]=o);return u},ay=function(e,t,n,i){for(;n>i;){var a=Math.floor(Math.random()*t.length);t=Lq(a,e,t),n--}return t},Iq={kargerStein:function(){var e=this,t=this.byGroup(),n=t.nodes,i=t.edges;i.unmergeBy(function(L){return L.isLoop()});var a=n.length,s=i.length,o=Math.ceil(Math.pow(Math.log(a)/Math.LN2,2)),l=Math.floor(a/Dq);if(a<2){Nn("At least 2 nodes are required for Karger-Stein algorithm");return}for(var u=[],c=0;c<s;c++){var h=i[c];u.push([c,n.indexOf(h.source()),n.indexOf(h.target())])}for(var d=1/0,f=[],p=new Array(a),m=new Array(a),v=new Array(a),g=function(z,B){for(var k=0;k<a;k++)B[k]=z[k]},y=0;y<=o;y++){for(var _=0;_<a;_++)m[_]=_;var x=ay(m,u.slice(),a,l),E=x.slice();g(m,v);var T=ay(m,x,l,2),b=ay(v,E,l,2);T.length<=b.length&&T.length<d?(d=T.length,f=T,g(m,p)):b.length<=T.length&&b.length<d&&(d=b.length,f=b,g(v,p))}for(var w=this.spawn(f.map(function(L){return i[L[0]]})),A=this.spawn(),S=this.spawn(),C=p[0],R=0;R<p.length;R++){var P=p[R],M=n[R];P===C?A.merge(M):S.merge(M)}var N=function(z){var B=e.spawn();return z.forEach(function(k){B.merge(k),k.connectedEdges().forEach(function(U){e.contains(U)&&!w.contains(U)&&B.merge(U)})}),B},D=[N(A),N(S)],I={cut:w,components:D,partition1:A,partition2:S};return I}},Oq=function(e){return{x:e.x,y:e.y}},Tv=function(e,t,n){return{x:e.x*t+n.x,y:e.y*t+n.y}},pk=function(e,t,n){return{x:(e.x-n.x)/t,y:(e.y-n.y)/t}},Ku=function(e){return{x:e[0],y:e[1]}},Fq=function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=1/0,a=t;a<n;a++){var s=e[a];isFinite(s)&&(i=Math.min(s,i))}return i},Bq=function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=-1/0,a=t;a<n;a++){var s=e[a];isFinite(s)&&(i=Math.max(s,i))}return i},Uq=function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=0,a=0,s=t;s<n;s++){var o=e[s];isFinite(o)&&(i+=o,a++)}return i/a},kq=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.length,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0;i?e=e.slice(t,n):(n<e.length&&e.splice(n,e.length-n),t>0&&e.splice(0,t));for(var o=0,l=e.length-1;l>=0;l--){var u=e[l];s?isFinite(u)||(e[l]=-1/0,o++):e.splice(l,1)}a&&e.sort(function(d,f){return d-f});var c=e.length,h=Math.floor(c/2);return c%2!==0?e[h+1+o]:(e[h-1+o]+e[h+o])/2},Gq=function(e){return Math.PI*e/180},Kd=function(e,t){return Math.atan2(t,e)-Math.PI/2},BS=Math.log2||function(r){return Math.log(r)/Math.log(2)},gk=function(e){return e>0?1:e<0?-1:0},Vl=function(e,t){return Math.sqrt(_l(e,t))},_l=function(e,t){var n=t.x-e.x,i=t.y-e.y;return n*n+i*i},zq=function(e){for(var t=e.length,n=0,i=0;i<t;i++)n+=e[i];for(var a=0;a<t;a++)e[a]=e[a]/n;return e},gr=function(e,t,n,i){return(1-i)*(1-i)*e+2*(1-i)*i*t+i*i*n},oc=function(e,t,n,i){return{x:gr(e.x,t.x,n.x,i),y:gr(e.y,t.y,n.y,i)}},Vq=function(e,t,n,i){var a={x:t.x-e.x,y:t.y-e.y},s=Vl(e,t),o={x:a.x/s,y:a.y/s};return n=n==null?0:n,i=i!=null?i:n*s,{x:e.x+o.x*i,y:e.y+o.y*i}},Mf=function(e,t,n){return Math.max(e,Math.min(n,t))},bi=function(e){if(e==null)return{x1:1/0,y1:1/0,x2:-1/0,y2:-1/0,w:0,h:0};if(e.x1!=null&&e.y1!=null){if(e.x2!=null&&e.y2!=null&&e.x2>=e.x1&&e.y2>=e.y1)return{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,w:e.x2-e.x1,h:e.y2-e.y1};if(e.w!=null&&e.h!=null&&e.w>=0&&e.h>=0)return{x1:e.x1,y1:e.y1,x2:e.x1+e.w,y2:e.y1+e.h,w:e.w,h:e.h}}},Hq=function(e){return{x1:e.x1,x2:e.x2,w:e.w,y1:e.y1,y2:e.y2,h:e.h}},Wq=function(e){e.x1=1/0,e.y1=1/0,e.x2=-1/0,e.y2=-1/0,e.w=0,e.h=0},qq=function(e,t,n){return{x1:e.x1+t,x2:e.x2+t,y1:e.y1+n,y2:e.y2+n,w:e.w,h:e.h}},vk=function(e,t){e.x1=Math.min(e.x1,t.x1),e.x2=Math.max(e.x2,t.x2),e.w=e.x2-e.x1,e.y1=Math.min(e.y1,t.y1),e.y2=Math.max(e.y2,t.y2),e.h=e.y2-e.y1},$q=function(e,t,n){e.x1=Math.min(e.x1,t),e.x2=Math.max(e.x2,t),e.w=e.x2-e.x1,e.y1=Math.min(e.y1,n),e.y2=Math.max(e.y2,n),e.h=e.y2-e.y1},fg=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.x1-=t,e.x2+=t,e.y1-=t,e.y2+=t,e.w=e.x2-e.x1,e.h=e.y2-e.y1,e},dg=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0],n,i,a,s;if(t.length===1)n=i=a=s=t[0];else if(t.length===2)n=a=t[0],s=i=t[1];else if(t.length===4){var o=vr(t,4);n=o[0],i=o[1],a=o[2],s=o[3]}return e.x1-=s,e.x2+=i,e.y1-=n,e.y2+=a,e.w=e.x2-e.x1,e.h=e.y2-e.y1,e},CC=function(e,t){e.x1=t.x1,e.y1=t.y1,e.x2=t.x2,e.y2=t.y2,e.w=e.x2-e.x1,e.h=e.y2-e.y1},US=function(e,t){return!(e.x1>t.x2||t.x1>e.x2||e.x2<t.x1||t.x2<e.x1||e.y2<t.y1||t.y2<e.y1||e.y1>t.y2||t.y1>e.y2)},xc=function(e,t,n){return e.x1<=t&&t<=e.x2&&e.y1<=n&&n<=e.y2},Xq=function(e,t){return xc(e,t.x,t.y)},mk=function(e,t){return xc(e,t.x1,t.y1)&&xc(e,t.x2,t.y2)},yk=function(e,t,n,i,a,s,o){var l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:"auto",u=l==="auto"?Hl(a,s):l,c=a/2,h=s/2;u=Math.min(u,c,h);var d=u!==c,f=u!==h,p;if(d){var m=n-c+u-o,v=i-h-o,g=n+c-u+o,y=v;if(p=So(e,t,n,i,m,v,g,y,!1),p.length>0)return p}if(f){var _=n+c+o,x=i-h+u-o,E=_,T=i+h-u+o;if(p=So(e,t,n,i,_,x,E,T,!1),p.length>0)return p}if(d){var b=n-c+u-o,w=i+h+o,A=n+c-u+o,S=w;if(p=So(e,t,n,i,b,w,A,S,!1),p.length>0)return p}if(f){var C=n-c-o,R=i-h+u-o,P=C,M=i+h-u+o;if(p=So(e,t,n,i,C,R,P,M,!1),p.length>0)return p}var N;{var D=n-c+u,I=i-h+u;if(N=Qh(e,t,n,i,D,I,u+o),N.length>0&&N[0]<=D&&N[1]<=I)return[N[0],N[1]]}{var L=n+c-u,z=i-h+u;if(N=Qh(e,t,n,i,L,z,u+o),N.length>0&&N[0]>=L&&N[1]<=z)return[N[0],N[1]]}{var B=n+c-u,k=i+h-u;if(N=Qh(e,t,n,i,B,k,u+o),N.length>0&&N[0]>=B&&N[1]>=k)return[N[0],N[1]]}{var U=n-c+u,G=i+h-u;if(N=Qh(e,t,n,i,U,G,u+o),N.length>0&&N[0]<=U&&N[1]>=G)return[N[0],N[1]]}return[]},Yq=function(e,t,n,i,a,s,o){var l=o,u=Math.min(n,a),c=Math.max(n,a),h=Math.min(i,s),d=Math.max(i,s);return u-l<=e&&e<=c+l&&h-l<=t&&t<=d+l},jq=function(e,t,n,i,a,s,o,l,u){var c={x1:Math.min(n,o,a)-u,x2:Math.max(n,o,a)+u,y1:Math.min(i,l,s)-u,y2:Math.max(i,l,s)+u};return!(e<c.x1||e>c.x2||t<c.y1||t>c.y2)},Kq=function(e,t,n,i){n-=i;var a=t*t-4*e*n;if(a<0)return[];var s=Math.sqrt(a),o=2*e,l=(-t+s)/o,u=(-t-s)/o;return[l,u]},Qq=function(e,t,n,i,a){var s=1e-5;e===0&&(e=s),t/=e,n/=e,i/=e;var o,l,u,c,h,d,f,p;if(l=(3*n-t*t)/9,u=-(27*i)+t*(9*n-2*(t*t)),u/=54,o=l*l*l+u*u,a[1]=0,f=t/3,o>0){h=u+Math.sqrt(o),h=h<0?-Math.pow(-h,1/3):Math.pow(h,1/3),d=u-Math.sqrt(o),d=d<0?-Math.pow(-d,1/3):Math.pow(d,1/3),a[0]=-f+h+d,f+=(h+d)/2,a[4]=a[2]=-f,f=Math.sqrt(3)*(-d+h)/2,a[3]=f,a[5]=-f;return}if(a[5]=a[3]=0,o===0){p=u<0?-Math.pow(-u,1/3):Math.pow(u,1/3),a[0]=-f+2*p,a[4]=a[2]=-(p+f);return}l=-l,c=l*l*l,c=Math.acos(u/Math.sqrt(c)),p=2*Math.sqrt(l),a[0]=-f+p*Math.cos(c/3),a[2]=-f+p*Math.cos((c+2*Math.PI)/3),a[4]=-f+p*Math.cos((c+4*Math.PI)/3)},Zq=function(e,t,n,i,a,s,o,l){var u=1*n*n-4*n*a+2*n*o+4*a*a-4*a*o+o*o+i*i-4*i*s+2*i*l+4*s*s-4*s*l+l*l,c=1*9*n*a-3*n*n-3*n*o-6*a*a+3*a*o+9*i*s-3*i*i-3*i*l-6*s*s+3*s*l,h=1*3*n*n-6*n*a+n*o-n*e+2*a*a+2*a*e-o*e+3*i*i-6*i*s+i*l-i*t+2*s*s+2*s*t-l*t,d=1*n*a-n*n+n*e-a*e+i*s-i*i+i*t-s*t,f=[];Qq(u,c,h,d,f);for(var p=1e-7,m=[],v=0;v<6;v+=2)Math.abs(f[v+1])<p&&f[v]>=0&&f[v]<=1&&m.push(f[v]);m.push(1),m.push(0);for(var g=-1,y,_,x,E=0;E<m.length;E++)y=Math.pow(1-m[E],2)*n+2*(1-m[E])*m[E]*a+m[E]*m[E]*o,_=Math.pow(1-m[E],2)*i+2*(1-m[E])*m[E]*s+m[E]*m[E]*l,x=Math.pow(y-e,2)+Math.pow(_-t,2),g>=0?x<g&&(g=x):g=x;return g},Jq=function(e,t,n,i,a,s){var o=[e-n,t-i],l=[a-n,s-i],u=l[0]*l[0]+l[1]*l[1],c=o[0]*o[0]+o[1]*o[1],h=o[0]*l[0]+o[1]*l[1],d=h*h/u;return h<0?c:d>u?(e-a)*(e-a)+(t-s)*(t-s):c-d},li=function(e,t,n){for(var i,a,s,o,l,u=0,c=0;c<n.length/2;c++)if(i=n[c*2],a=n[c*2+1],c+1<n.length/2?(s=n[(c+1)*2],o=n[(c+1)*2+1]):(s=n[(c+1-n.length/2)*2],o=n[(c+1-n.length/2)*2+1]),!(i==e&&s==e))if(i>=e&&e>=s||i<=e&&e<=s)l=(e-i)/(s-i)*(o-a)+a,l>t&&u++;else continue;return u%2!==0},$s=function(e,t,n,i,a,s,o,l,u){var c=new Array(n.length),h;l[0]!=null?(h=Math.atan(l[1]/l[0]),l[0]<0?h=h+Math.PI/2:h=-h-Math.PI/2):h=l;for(var d=Math.cos(-h),f=Math.sin(-h),p=0;p<c.length/2;p++)c[p*2]=s/2*(n[p*2]*d-n[p*2+1]*f),c[p*2+1]=o/2*(n[p*2+1]*d+n[p*2]*f),c[p*2]+=i,c[p*2+1]+=a;var m;if(u>0){var v=zg(c,-u);m=Gg(v)}else m=c;return li(e,t,m)},e$=function(e,t,n,i,a,s,o,l){for(var u=new Array(n.length*2),c=0;c<l.length;c++){var h=l[c];u[c*4+0]=h.startX,u[c*4+1]=h.startY,u[c*4+2]=h.stopX,u[c*4+3]=h.stopY;var d=Math.pow(h.cx-e,2)+Math.pow(h.cy-t,2);if(d<=Math.pow(h.radius,2))return!0}return li(e,t,u)},Gg=function(e){for(var t=new Array(e.length/2),n,i,a,s,o,l,u,c,h=0;h<e.length/4;h++){n=e[h*4],i=e[h*4+1],a=e[h*4+2],s=e[h*4+3],h<e.length/4-1?(o=e[(h+1)*4],l=e[(h+1)*4+1],u=e[(h+1)*4+2],c=e[(h+1)*4+3]):(o=e[0],l=e[1],u=e[2],c=e[3]);var d=So(n,i,a,s,o,l,u,c,!0);t[h*2]=d[0],t[h*2+1]=d[1]}return t},zg=function(e,t){for(var n=new Array(e.length*2),i,a,s,o,l=0;l<e.length/2;l++){i=e[l*2],a=e[l*2+1],l<e.length/2-1?(s=e[(l+1)*2],o=e[(l+1)*2+1]):(s=e[0],o=e[1]);var u=o-a,c=-(s-i),h=Math.sqrt(u*u+c*c),d=u/h,f=c/h;n[l*4]=i+d*t,n[l*4+1]=a+f*t,n[l*4+2]=s+d*t,n[l*4+3]=o+f*t}return n},t$=function(e,t,n,i,a,s){var o=n-e,l=i-t;o/=a,l/=s;var u=Math.sqrt(o*o+l*l),c=u-1;if(c<0)return[];var h=c/u;return[(n-e)*h+e,(i-t)*h+t]},Il=function(e,t,n,i,a,s,o){return e-=a,t-=s,e/=n/2+o,t/=i/2+o,e*e+t*t<=1},Qh=function(e,t,n,i,a,s,o){var l=[n-e,i-t],u=[e-a,t-s],c=l[0]*l[0]+l[1]*l[1],h=2*(u[0]*l[0]+u[1]*l[1]),d=u[0]*u[0]+u[1]*u[1]-o*o,f=h*h-4*c*d;if(f<0)return[];var p=(-h+Math.sqrt(f))/(2*c),m=(-h-Math.sqrt(f))/(2*c),v=Math.min(p,m),g=Math.max(p,m),y=[];if(v>=0&&v<=1&&y.push(v),g>=0&&g<=1&&y.push(g),y.length===0)return[];var _=y[0]*l[0]+e,x=y[0]*l[1]+t;if(y.length>1){if(y[0]==y[1])return[_,x];var E=y[1]*l[0]+e,T=y[1]*l[1]+t;return[_,x,E,T]}else return[_,x]},sy=function(e,t,n){return t<=e&&e<=n||n<=e&&e<=t?e:e<=t&&t<=n||n<=t&&t<=e?t:n},So=function(e,t,n,i,a,s,o,l,u){var c=e-a,h=n-e,d=o-a,f=t-s,p=i-t,m=l-s,v=d*f-m*c,g=h*f-p*c,y=m*h-d*p;if(y!==0){var _=v/y,x=g/y,E=.001,T=0-E,b=1+E;return T<=_&&_<=b&&T<=x&&x<=b?[e+_*h,t+_*p]:u?[e+_*h,t+_*p]:[]}else return v===0||g===0?sy(e,n,o)===o?[o,l]:sy(e,n,a)===a?[a,s]:sy(a,o,n)===n?[n,i]:[]:[]},Cf=function(e,t,n,i,a,s,o,l){var u=[],c,h=new Array(n.length),d=!0;s==null&&(d=!1);var f;if(d){for(var p=0;p<h.length/2;p++)h[p*2]=n[p*2]*s+i,h[p*2+1]=n[p*2+1]*o+a;if(l>0){var m=zg(h,-l);f=Gg(m)}else f=h}else f=n;for(var v,g,y,_,x=0;x<f.length/2;x++)v=f[x*2],g=f[x*2+1],x<f.length/2-1?(y=f[(x+1)*2],_=f[(x+1)*2+1]):(y=f[0],_=f[1]),c=So(e,t,i,a,v,g,y,_),c.length!==0&&u.push(c[0],c[1]);return u},n$=function(e,t,n,i,a,s,o,l,u){var c=[],h,d=new Array(n.length*2);u.forEach(function(y,_){_===0?(d[d.length-2]=y.startX,d[d.length-1]=y.startY):(d[_*4-2]=y.startX,d[_*4-1]=y.startY),d[_*4]=y.stopX,d[_*4+1]=y.stopY,h=Qh(e,t,i,a,y.cx,y.cy,y.radius),h.length!==0&&c.push(h[0],h[1])});for(var f=0;f<d.length/4;f++)h=So(e,t,i,a,d[f*4],d[f*4+1],d[f*4+2],d[f*4+3],!1),h.length!==0&&c.push(h[0],h[1]);if(c.length>2){for(var p=[c[0],c[1]],m=Math.pow(p[0]-e,2)+Math.pow(p[1]-t,2),v=1;v<c.length/2;v++){var g=Math.pow(c[v*2]-e,2)+Math.pow(c[v*2+1]-t,2);g<=m&&(p[0]=c[v*2],p[1]=c[v*2+1],m=g)}return p}return c},Qd=function(e,t,n){var i=[e[0]-t[0],e[1]-t[1]],a=Math.sqrt(i[0]*i[0]+i[1]*i[1]),s=(a-n)/a;return s<0&&(s=1e-5),[t[0]+s*i[0],t[1]+s*i[1]]},jr=function(e,t){var n=ww(e,t);return n=_k(n),n},_k=function(e){for(var t,n,i=e.length/2,a=1/0,s=1/0,o=-1/0,l=-1/0,u=0;u<i;u++)t=e[2*u],n=e[2*u+1],a=Math.min(a,t),o=Math.max(o,t),s=Math.min(s,n),l=Math.max(l,n);for(var c=2/(o-a),h=2/(l-s),d=0;d<i;d++)t=e[2*d]=e[2*d]*c,n=e[2*d+1]=e[2*d+1]*h,a=Math.min(a,t),o=Math.max(o,t),s=Math.min(s,n),l=Math.max(l,n);if(s<-1)for(var f=0;f<i;f++)n=e[2*f+1]=e[2*f+1]+(-1-s);return e},ww=function(e,t){var n=1/e*2*Math.PI,i=e%2===0?Math.PI/2+n/2:Math.PI/2;i+=t;for(var a=new Array(e*2),s,o=0;o<e;o++)s=o*n+i,a[2*o]=Math.cos(s),a[2*o+1]=Math.sin(-s);return a},Hl=function(e,t){return Math.min(e/4,t/4,8)},xk=function(e,t){return Math.min(e/10,t/10,8)},kS=function(){return 8},r$=function(e,t,n){return[e-2*t+n,2*(t-e),e]},Sw=function(e,t){return{heightOffset:Math.min(15,.05*t),widthOffset:Math.min(100,.25*e),ctrlPtOffsetPct:.05}},i$=cr({dampingFactor:.8,precision:1e-6,iterations:200,weight:function(e){return 1}}),a$={pageRank:function(e){for(var t=i$(e),n=t.dampingFactor,i=t.precision,a=t.iterations,s=t.weight,o=this._private.cy,l=this.byGroup(),u=l.nodes,c=l.edges,h=u.length,d=h*h,f=c.length,p=new Array(d),m=new Array(h),v=(1-n)/h,g=0;g<h;g++){for(var y=0;y<h;y++){var _=g*h+y;p[_]=0}m[g]=0}for(var x=0;x<f;x++){var E=c[x],T=E.data("source"),b=E.data("target");if(T!==b){var w=u.indexOfId(T),A=u.indexOfId(b),S=s(E),C=A*h+w;p[C]+=S,m[w]+=S}}for(var R=1/h+v,P=0;P<h;P++)if(m[P]===0)for(var M=0;M<h;M++){var N=M*h+P;p[N]=R}else for(var D=0;D<h;D++){var I=D*h+P;p[I]=p[I]/m[P]+v}for(var L=new Array(h),z=new Array(h),B,k=0;k<h;k++)L[k]=1;for(var U=0;U<a;U++){for(var G=0;G<h;G++)z[G]=0;for(var O=0;O<h;O++)for(var F=0;F<h;F++){var V=O*h+F;z[O]+=p[V]*L[F]}zq(z),B=L,L=z,z=B;for(var $=0,Z=0;Z<h;Z++){var Y=B[Z]-L[Z];$+=Y*Y}if($<i)break}var X={rank:function(se){return se=o.collection(se)[0],L[u.indexOf(se)]}};return X}},RC=cr({root:null,weight:function(e){return 1},directed:!1,alpha:0}),lc={degreeCentralityNormalized:function(e){e=RC(e);var t=this.cy(),n=this.nodes(),i=n.length;if(e.directed){for(var c={},h={},d=0,f=0,p=0;p<i;p++){var m=n[p],v=m.id();e.root=m;var g=this.degreeCentrality(e);d<g.indegree&&(d=g.indegree),f<g.outdegree&&(f=g.outdegree),c[v]=g.indegree,h[v]=g.outdegree}return{indegree:function(_){return d==0?0:(dt(_)&&(_=t.filter(_)),c[_.id()]/d)},outdegree:function(_){return f===0?0:(dt(_)&&(_=t.filter(_)),h[_.id()]/f)}}}else{for(var a={},s=0,o=0;o<i;o++){var l=n[o];e.root=l;var u=this.degreeCentrality(e);s<u.degree&&(s=u.degree),a[l.id()]=u.degree}return{degree:function(_){return s===0?0:(dt(_)&&(_=t.filter(_)),a[_.id()]/s)}}}},degreeCentrality:function(e){e=RC(e);var t=this.cy(),n=this,i=e,a=i.root,s=i.weight,o=i.directed,l=i.alpha;if(a=t.collection(a)[0],o){for(var f=a.connectedEdges(),p=f.filter(function(T){return T.target().same(a)&&n.has(T)}),m=f.filter(function(T){return T.source().same(a)&&n.has(T)}),v=p.length,g=m.length,y=0,_=0,x=0;x<p.length;x++)y+=s(p[x]);for(var E=0;E<m.length;E++)_+=s(m[E]);return{indegree:Math.pow(v,1-l)*Math.pow(y,l),outdegree:Math.pow(g,1-l)*Math.pow(_,l)}}else{for(var u=a.connectedEdges().intersection(n),c=u.length,h=0,d=0;d<u.length;d++)h+=s(u[d]);return{degree:Math.pow(c,1-l)*Math.pow(h,l)}}}};lc.dc=lc.degreeCentrality;lc.dcn=lc.degreeCentralityNormalised=lc.degreeCentralityNormalized;var NC=cr({harmonic:!0,weight:function(){return 1},directed:!1,root:null}),uc={closenessCentralityNormalized:function(e){for(var t=NC(e),n=t.harmonic,i=t.weight,a=t.directed,s=this.cy(),o={},l=0,u=this.nodes(),c=this.floydWarshall({weight:i,directed:a}),h=0;h<u.length;h++){for(var d=0,f=u[h],p=0;p<u.length;p++)if(h!==p){var m=c.distance(f,u[p]);n?d+=1/m:d+=m}n||(d=1/d),l<d&&(l=d),o[f.id()]=d}return{closeness:function(g){return l==0?0:(dt(g)?g=s.filter(g)[0].id():g=g.id(),o[g]/l)}}},closenessCentrality:function(e){var t=NC(e),n=t.root,i=t.weight,a=t.directed,s=t.harmonic;n=this.filter(n)[0];for(var o=this.dijkstra({root:n,weight:i,directed:a}),l=0,u=this.nodes(),c=0;c<u.length;c++){var h=u[c];if(!h.same(n)){var d=o.distanceTo(h);s?l+=1/d:l+=d}}return s?l:1/l}};uc.cc=uc.closenessCentrality;uc.ccn=uc.closenessCentralityNormalised=uc.closenessCentralityNormalized;var s$=cr({weight:null,directed:!1}),Aw={betweennessCentrality:function(e){for(var t=s$(e),n=t.directed,i=t.weight,a=i!=null,s=this.cy(),o=this.nodes(),l={},u={},c=0,h={set:function(_,x){u[_]=x,x>c&&(c=x)},get:function(_){return u[_]}},d=0;d<o.length;d++){var f=o[d],p=f.id();n?l[p]=f.outgoers().nodes():l[p]=f.openNeighborhood().nodes(),h.set(p,0)}for(var m=function(){for(var _=o[v].id(),x=[],E={},T={},b={},w=new yd(function(O,F){return b[O]-b[F]}),A=0;A<o.length;A++){var S=o[A].id();E[S]=[],T[S]=0,b[S]=1/0}for(T[_]=1,b[_]=0,w.push(_);!w.empty();){var C=w.pop();if(x.push(C),a)for(var R=0;R<l[C].length;R++){var P=l[C][R],M=s.getElementById(C),N=void 0;M.edgesTo(P).length>0?N=M.edgesTo(P)[0]:N=P.edgesTo(M)[0];var D=i(N);P=P.id(),b[P]>b[C]+D&&(b[P]=b[C]+D,w.nodes.indexOf(P)<0?w.push(P):w.updateItem(P),T[P]=0,E[P]=[]),b[P]==b[C]+D&&(T[P]=T[P]+T[C],E[P].push(C))}else for(var I=0;I<l[C].length;I++){var L=l[C][I].id();b[L]==1/0&&(w.push(L),b[L]=b[C]+1),b[L]==b[C]+1&&(T[L]=T[L]+T[C],E[L].push(C))}}for(var z={},B=0;B<o.length;B++)z[o[B].id()]=0;for(;x.length>0;){for(var k=x.pop(),U=0;U<E[k].length;U++){var G=E[k][U];z[G]=z[G]+T[G]/T[k]*(1+z[k])}k!=o[v].id()&&h.set(k,h.get(k)+z[k])}},v=0;v<o.length;v++)m();var g={betweenness:function(_){var x=s.collection(_).id();return h.get(x)},betweennessNormalized:function(_){if(c==0)return 0;var x=s.collection(_).id();return h.get(x)/c}};return g.betweennessNormalised=g.betweennessNormalized,g}};Aw.bc=Aw.betweennessCentrality;var o$=cr({expandFactor:2,inflateFactor:2,multFactor:1,maxIterations:20,attributes:[function(r){return 1}]}),l$=function(e){return o$(e)},u$=function(e,t){for(var n=0,i=0;i<t.length;i++)n+=t[i](e);return n},c$=function(e,t,n){for(var i=0;i<t;i++)e[i*t+i]=n},bk=function(e,t){for(var n,i=0;i<t;i++){n=0;for(var a=0;a<t;a++)n+=e[a*t+i];for(var s=0;s<t;s++)e[s*t+i]=e[s*t+i]/n}},h$=function(e,t,n){for(var i=new Array(n*n),a=0;a<n;a++){for(var s=0;s<n;s++)i[a*n+s]=0;for(var o=0;o<n;o++)for(var l=0;l<n;l++)i[a*n+l]+=e[a*n+o]*t[o*n+l]}return i},f$=function(e,t,n){for(var i=e.slice(0),a=1;a<n;a++)e=h$(e,i,t);return e},d$=function(e,t,n){for(var i=new Array(t*t),a=0;a<t*t;a++)i[a]=Math.pow(e[a],n);return bk(i,t),i},p$=function(e,t,n,i){for(var a=0;a<n;a++){var s=Math.round(e[a]*Math.pow(10,i))/Math.pow(10,i),o=Math.round(t[a]*Math.pow(10,i))/Math.pow(10,i);if(s!==o)return!1}return!0},g$=function(e,t,n,i){for(var a=[],s=0;s<t;s++){for(var o=[],l=0;l<t;l++)Math.round(e[s*t+l]*1e3)/1e3>0&&o.push(n[l]);o.length!==0&&a.push(i.collection(o))}return a},v$=function(e,t){for(var n=0;n<e.length;n++)if(!t[n]||e[n].id()!==t[n].id())return!1;return!0},m$=function(e){for(var t=0;t<e.length;t++)for(var n=0;n<e.length;n++)t!=n&&v$(e[t],e[n])&&e.splice(n,1);return e},PC=function(e){for(var t=this.nodes(),n=this.edges(),i=this.cy(),a=l$(e),s={},o=0;o<t.length;o++)s[t[o].id()]=o;for(var l=t.length,u=l*l,c=new Array(u),h,d=0;d<u;d++)c[d]=0;for(var f=0;f<n.length;f++){var p=n[f],m=s[p.source().id()],v=s[p.target().id()],g=u$(p,a.attributes);c[m*l+v]+=g,c[v*l+m]+=g}c$(c,l,a.multFactor),bk(c,l);for(var y=!0,_=0;y&&_<a.maxIterations;)y=!1,h=f$(c,l,a.expandFactor),c=d$(h,l,a.inflateFactor),p$(c,h,u,4)||(y=!0),_++;var x=g$(c,l,t,i);return x=m$(x),x},y$={markovClustering:PC,mcl:PC},_$=function(e){return e},Ek=function(e,t){return Math.abs(t-e)},DC=function(e,t,n){return e+Ek(t,n)},LC=function(e,t,n){return e+Math.pow(n-t,2)},x$=function(e){return Math.sqrt(e)},b$=function(e,t,n){return Math.max(e,Ek(t,n))},_h=function(e,t,n,i,a){for(var s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:_$,o=i,l,u,c=0;c<e;c++)l=t(c),u=n(c),o=a(o,l,u);return s(o)},bc={euclidean:function(e,t,n){return e>=2?_h(e,t,n,0,LC,x$):_h(e,t,n,0,DC)},squaredEuclidean:function(e,t,n){return _h(e,t,n,0,LC)},manhattan:function(e,t,n){return _h(e,t,n,0,DC)},max:function(e,t,n){return _h(e,t,n,-1/0,b$)}};bc["squared-euclidean"]=bc.squaredEuclidean;bc.squaredeuclidean=bc.squaredEuclidean;function wv(r,e,t,n,i,a){var s;return Pn(r)?s=r:s=bc[r]||bc.euclidean,e===0&&Pn(r)?s(i,a):s(e,t,n,i,a)}var E$=cr({k:2,m:2,sensitivityThreshold:1e-4,distance:"euclidean",maxIterations:10,attributes:[],testMode:!1,testCentroids:null}),GS=function(e){return E$(e)},Vg=function(e,t,n,i,a){var s=a!=="kMedoids",o=s?function(h){return n[h]}:function(h){return i[h](n)},l=function(d){return i[d](t)},u=n,c=t;return wv(e,i.length,o,l,u,c)},oy=function(e,t,n){for(var i=n.length,a=new Array(i),s=new Array(i),o=new Array(t),l=null,u=0;u<i;u++)a[u]=e.min(n[u]).value,s[u]=e.max(n[u]).value;for(var c=0;c<t;c++){l=[];for(var h=0;h<i;h++)l[h]=Math.random()*(s[h]-a[h])+a[h];o[c]=l}return o},Tk=function(e,t,n,i,a){for(var s=1/0,o=0,l=0;l<t.length;l++){var u=Vg(n,e,t[l],i,a);u<s&&(s=u,o=l)}return o},wk=function(e,t,n){for(var i=[],a=null,s=0;s<t.length;s++)a=t[s],n[a.id()]===e&&i.push(a);return i},T$=function(e,t,n){return Math.abs(t-e)<=n},w$=function(e,t,n){for(var i=0;i<e.length;i++)for(var a=0;a<e[i].length;a++){var s=Math.abs(e[i][a]-t[i][a]);if(s>n)return!1}return!0},S$=function(e,t,n){for(var i=0;i<n;i++)if(e===t[i])return!0;return!1},IC=function(e,t){var n=new Array(t);if(e.length<50)for(var i=0;i<t;i++){for(var a=e[Math.floor(Math.random()*e.length)];S$(a,n,i);)a=e[Math.floor(Math.random()*e.length)];n[i]=a}else for(var s=0;s<t;s++)n[s]=e[Math.floor(Math.random()*e.length)];return n},OC=function(e,t,n){for(var i=0,a=0;a<t.length;a++)i+=Vg("manhattan",t[a],e,n,"kMedoids");return i},A$=function(e){var t=this.cy(),n=this.nodes(),i=null,a=GS(e),s=new Array(a.k),o={},l;a.testMode?typeof a.testCentroids=="number"?(a.testCentroids,l=oy(n,a.k,a.attributes)):sr(a.testCentroids)==="object"?l=a.testCentroids:l=oy(n,a.k,a.attributes):l=oy(n,a.k,a.attributes);for(var u=!0,c=0;u&&c<a.maxIterations;){for(var h=0;h<n.length;h++)i=n[h],o[i.id()]=Tk(i,l,a.distance,a.attributes,"kMeans");u=!1;for(var d=0;d<a.k;d++){var f=wk(d,n,o);if(f.length!==0){for(var p=a.attributes.length,m=l[d],v=new Array(p),g=new Array(p),y=0;y<p;y++){g[y]=0;for(var _=0;_<f.length;_++)i=f[_],g[y]+=a.attributes[y](i);v[y]=g[y]/f.length,T$(v[y],m[y],a.sensitivityThreshold)||(u=!0)}l[d]=v,s[d]=t.collection(f)}}c++}return s},M$=function(e){var t=this.cy(),n=this.nodes(),i=null,a=GS(e),s=new Array(a.k),o,l={},u,c=new Array(a.k);a.testMode?typeof a.testCentroids=="number"||(sr(a.testCentroids)==="object"?o=a.testCentroids:o=IC(n,a.k)):o=IC(n,a.k);for(var h=!0,d=0;h&&d<a.maxIterations;){for(var f=0;f<n.length;f++)i=n[f],l[i.id()]=Tk(i,o,a.distance,a.attributes,"kMedoids");h=!1;for(var p=0;p<o.length;p++){var m=wk(p,n,l);if(m.length!==0){c[p]=OC(o[p],m,a.attributes);for(var v=0;v<m.length;v++)u=OC(m[v],m,a.attributes),u<c[p]&&(c[p]=u,o[p]=m[v],h=!0);s[p]=t.collection(m)}}d++}return s},C$=function(e,t,n,i,a){for(var s,o,l=0;l<t.length;l++)for(var u=0;u<e.length;u++)i[l][u]=Math.pow(n[l][u],a.m);for(var c=0;c<e.length;c++)for(var h=0;h<a.attributes.length;h++){s=0,o=0;for(var d=0;d<t.length;d++)s+=i[d][c]*a.attributes[h](t[d]),o+=i[d][c];e[c][h]=s/o}},R$=function(e,t,n,i,a){for(var s=0;s<e.length;s++)t[s]=e[s].slice();for(var o,l,u,c=2/(a.m-1),h=0;h<n.length;h++)for(var d=0;d<i.length;d++){o=0;for(var f=0;f<n.length;f++)l=Vg(a.distance,i[d],n[h],a.attributes,"cmeans"),u=Vg(a.distance,i[d],n[f],a.attributes,"cmeans"),o+=Math.pow(l/u,c);e[d][h]=1/o}},N$=function(e,t,n,i){for(var a=new Array(n.k),s=0;s<a.length;s++)a[s]=[];for(var o,l,u=0;u<t.length;u++){o=-1/0,l=-1;for(var c=0;c<t[0].length;c++)t[u][c]>o&&(o=t[u][c],l=c);a[l].push(e[u])}for(var h=0;h<a.length;h++)a[h]=i.collection(a[h]);return a},FC=function(e){var t=this.cy(),n=this.nodes(),i=GS(e),a,s,o,l,u;l=new Array(n.length);for(var c=0;c<n.length;c++)l[c]=new Array(i.k);o=new Array(n.length);for(var h=0;h<n.length;h++)o[h]=new Array(i.k);for(var d=0;d<n.length;d++){for(var f=0,p=0;p<i.k;p++)o[d][p]=Math.random(),f+=o[d][p];for(var m=0;m<i.k;m++)o[d][m]=o[d][m]/f}s=new Array(i.k);for(var v=0;v<i.k;v++)s[v]=new Array(i.attributes.length);u=new Array(n.length);for(var g=0;g<n.length;g++)u[g]=new Array(i.k);for(var y=!0,_=0;y&&_<i.maxIterations;)y=!1,C$(s,n,o,u,i),R$(o,l,s,n,i),w$(o,l,i.sensitivityThreshold)||(y=!0),_++;return a=N$(n,o,i,t),{clusters:a,degreeOfMembership:o}},P$={kMeans:A$,kMedoids:M$,fuzzyCMeans:FC,fcm:FC},D$=cr({distance:"euclidean",linkage:"min",mode:"threshold",threshold:1/0,addDendrogram:!1,dendrogramDepth:0,attributes:[]}),L$={single:"min",complete:"max"},I$=function(e){var t=D$(e),n=L$[t.linkage];return n!=null&&(t.linkage=n),t},BC=function(e,t,n,i,a){for(var s=0,o=1/0,l,u=a.attributes,c=function(A,S){return wv(a.distance,u.length,function(C){return u[C](A)},function(C){return u[C](S)},A,S)},h=0;h<e.length;h++){var d=e[h].key,f=n[d][i[d]];f<o&&(s=d,o=f)}if(a.mode==="threshold"&&o>=a.threshold||a.mode==="dendrogram"&&e.length===1)return!1;var p=t[s],m=t[i[s]],v;a.mode==="dendrogram"?v={left:p,right:m,key:p.key}:v={value:p.value.concat(m.value),key:p.key},e[p.index]=v,e.splice(m.index,1),t[p.key]=v;for(var g=0;g<e.length;g++){var y=e[g];p.key===y.key?l=1/0:a.linkage==="min"?(l=n[p.key][y.key],n[p.key][y.key]>n[m.key][y.key]&&(l=n[m.key][y.key])):a.linkage==="max"?(l=n[p.key][y.key],n[p.key][y.key]<n[m.key][y.key]&&(l=n[m.key][y.key])):a.linkage==="mean"?l=(n[p.key][y.key]*p.size+n[m.key][y.key]*m.size)/(p.size+m.size):a.mode==="dendrogram"?l=c(y.value,p.value):l=c(y.value[0],p.value[0]),n[p.key][y.key]=n[y.key][p.key]=l}for(var _=0;_<e.length;_++){var x=e[_].key;if(i[x]===p.key||i[x]===m.key){for(var E=x,T=0;T<e.length;T++){var b=e[T].key;n[x][b]<n[x][E]&&(E=b)}i[x]=E}e[_].index=_}return p.key=m.key=p.index=m.index=null,!0},Qu=function(e,t,n){!e||(e.value?t.push(e.value):(e.left&&Qu(e.left,t),e.right&&Qu(e.right,t)))},Mw=function(e,t){if(!e)return"";if(e.left&&e.right){var n=Mw(e.left,t),i=Mw(e.right,t),a=t.add({group:"nodes",data:{id:n+","+i}});return t.add({group:"edges",data:{source:n,target:a.id()}}),t.add({group:"edges",data:{source:i,target:a.id()}}),a.id()}else if(e.value)return e.value.id()},Cw=function(e,t,n){if(!e)return[];var i=[],a=[],s=[];return t===0?(e.left&&Qu(e.left,i),e.right&&Qu(e.right,a),s=i.concat(a),[n.collection(s)]):t===1?e.value?[n.collection(e.value)]:(e.left&&Qu(e.left,i),e.right&&Qu(e.right,a),[n.collection(i),n.collection(a)]):e.value?[n.collection(e.value)]:(e.left&&(i=Cw(e.left,t-1,n)),e.right&&(a=Cw(e.right,t-1,n)),i.concat(a))},UC=function(e){for(var t=this.cy(),n=this.nodes(),i=I$(e),a=i.attributes,s=function(_,x){return wv(i.distance,a.length,function(E){return a[E](_)},function(E){return a[E](x)},_,x)},o=[],l=[],u=[],c=[],h=0;h<n.length;h++){var d={value:i.mode==="dendrogram"?n[h]:[n[h]],key:h,index:h};o[h]=d,c[h]=d,l[h]=[],u[h]=0}for(var f=0;f<o.length;f++)for(var p=0;p<=f;p++){var m=void 0;i.mode==="dendrogram"?m=f===p?1/0:s(o[f].value,o[p].value):m=f===p?1/0:s(o[f].value[0],o[p].value[0]),l[f][p]=m,l[p][f]=m,m<l[f][u[f]]&&(u[f]=p)}for(var v=BC(o,c,l,u,i);v;)v=BC(o,c,l,u,i);var g;return i.mode==="dendrogram"?(g=Cw(o[0],i.dendrogramDepth,t),i.addDendrogram&&Mw(o[0],t)):(g=new Array(o.length),o.forEach(function(y,_){y.key=y.index=null,g[_]=t.collection(y.value)})),g},O$={hierarchicalClustering:UC,hca:UC},F$=cr({distance:"euclidean",preference:"median",damping:.8,maxIterations:1e3,minIterations:100,attributes:[]}),B$=function(e){var t=e.damping,n=e.preference;.5<=t&&t<1||Nn("Damping must range on [0.5, 1).  Got: ".concat(t));var i=["median","mean","min","max"];return i.some(function(a){return a===n})||et(n)||Nn("Preference must be one of [".concat(i.map(function(a){return"'".concat(a,"'")}).join(", "),"] or a number.  Got: ").concat(n)),F$(e)},U$=function(e,t,n,i){var a=function(o,l){return i[l](o)};return-wv(e,i.length,function(s){return a(t,s)},function(s){return a(n,s)},t,n)},k$=function(e,t){var n=null;return t==="median"?n=kq(e):t==="mean"?n=Uq(e):t==="min"?n=Fq(e):t==="max"?n=Bq(e):n=t,n},G$=function(e,t,n){for(var i=[],a=0;a<e;a++)t[a*e+a]+n[a*e+a]>0&&i.push(a);return i},kC=function(e,t,n){for(var i=[],a=0;a<e;a++){for(var s=-1,o=-1/0,l=0;l<n.length;l++){var u=n[l];t[a*e+u]>o&&(s=u,o=t[a*e+u])}s>0&&i.push(s)}for(var c=0;c<n.length;c++)i[n[c]]=n[c];return i},z$=function(e,t,n){for(var i=kC(e,t,n),a=0;a<n.length;a++){for(var s=[],o=0;o<i.length;o++)i[o]===n[a]&&s.push(o);for(var l=-1,u=-1/0,c=0;c<s.length;c++){for(var h=0,d=0;d<s.length;d++)h+=t[s[d]*e+s[c]];h>u&&(l=c,u=h)}n[a]=s[l]}return i=kC(e,t,n),i},GC=function(e){for(var t=this.cy(),n=this.nodes(),i=B$(e),a={},s=0;s<n.length;s++)a[n[s].id()]=s;var o,l,u,c,h,d;o=n.length,l=o*o,u=new Array(l);for(var f=0;f<l;f++)u[f]=-1/0;for(var p=0;p<o;p++)for(var m=0;m<o;m++)p!==m&&(u[p*o+m]=U$(i.distance,n[p],n[m],i.attributes));c=k$(u,i.preference);for(var v=0;v<o;v++)u[v*o+v]=c;h=new Array(l);for(var g=0;g<l;g++)h[g]=0;d=new Array(l);for(var y=0;y<l;y++)d[y]=0;for(var _=new Array(o),x=new Array(o),E=new Array(o),T=0;T<o;T++)_[T]=0,x[T]=0,E[T]=0;for(var b=new Array(o*i.minIterations),w=0;w<b.length;w++)b[w]=0;var A;for(A=0;A<i.maxIterations;A++){for(var S=0;S<o;S++){for(var C=-1/0,R=-1/0,P=-1,M=0,N=0;N<o;N++)_[N]=h[S*o+N],M=d[S*o+N]+u[S*o+N],M>=C?(R=C,C=M,P=N):M>R&&(R=M);for(var D=0;D<o;D++)h[S*o+D]=(1-i.damping)*(u[S*o+D]-C)+i.damping*_[D];h[S*o+P]=(1-i.damping)*(u[S*o+P]-R)+i.damping*_[P]}for(var I=0;I<o;I++){for(var L=0,z=0;z<o;z++)_[z]=d[z*o+I],x[z]=Math.max(0,h[z*o+I]),L+=x[z];L-=x[I],x[I]=h[I*o+I],L+=x[I];for(var B=0;B<o;B++)d[B*o+I]=(1-i.damping)*Math.min(0,L-x[B])+i.damping*_[B];d[I*o+I]=(1-i.damping)*(L-x[I])+i.damping*_[I]}for(var k=0,U=0;U<o;U++){var G=d[U*o+U]+h[U*o+U]>0?1:0;b[A%i.minIterations*o+U]=G,k+=G}if(k>0&&(A>=i.minIterations-1||A==i.maxIterations-1)){for(var O=0,F=0;F<o;F++){E[F]=0;for(var V=0;V<i.minIterations;V++)E[F]+=b[V*o+F];(E[F]===0||E[F]===i.minIterations)&&O++}if(O===o)break}}for(var $=G$(o,h,d),Z=z$(o,u,$),Y={},X=0;X<$.length;X++)Y[$[X]]=[];for(var K=0;K<n.length;K++){var se=a[n[K].id()],oe=Z[se];oe!=null&&Y[oe].push(n[K])}for(var W=new Array($.length),Ne=0;Ne<$.length;Ne++)W[Ne]=t.collection(Y[$[Ne]]);return W},V$={affinityPropagation:GC,ap:GC},H$=cr({root:void 0,directed:!1}),W$={hierholzer:function(e){if(!$t(e)){var t=arguments;e={root:t[0],directed:t[1]}}var n=H$(e),i=n.root,a=n.directed,s=this,o=!1,l,u,c;i&&(c=dt(i)?this.filter(i)[0].id():i[0].id());var h={},d={};a?s.forEach(function(y){var _=y.id();if(y.isNode()){var x=y.indegree(!0),E=y.outdegree(!0),T=x-E,b=E-x;T==1?l?o=!0:l=_:b==1?u?o=!0:u=_:(b>1||T>1)&&(o=!0),h[_]=[],y.outgoers().forEach(function(w){w.isEdge()&&h[_].push(w.id())})}else d[_]=[void 0,y.target().id()]}):s.forEach(function(y){var _=y.id();if(y.isNode()){var x=y.degree(!0);x%2&&(l?u?o=!0:u=_:l=_),h[_]=[],y.connectedEdges().forEach(function(E){return h[_].push(E.id())})}else d[_]=[y.source().id(),y.target().id()]});var f={found:!1,trail:void 0};if(o)return f;if(u&&l)if(a){if(c&&u!=c)return f;c=u}else{if(c&&u!=c&&l!=c)return f;c||(c=u)}else c||(c=s[0].id());var p=function(_){for(var x=_,E=[_],T,b,w;h[x].length;)T=h[x].shift(),b=d[T][0],w=d[T][1],x!=w?(h[w]=h[w].filter(function(A){return A!=T}),x=w):!a&&x!=b&&(h[b]=h[b].filter(function(A){return A!=T}),x=b),E.unshift(T),E.unshift(x);return E},m=[],v=[];for(v=p(c);v.length!=1;)h[v[0]].length==0?(m.unshift(s.getElementById(v.shift())),m.unshift(s.getElementById(v.shift()))):v=p(v.shift()).concat(v);m.unshift(s.getElementById(v.shift()));for(var g in h)if(h[g].length)return f;return f.found=!0,f.trail=this.spawn(m,!0),f}},Zd=function(){var e=this,t={},n=0,i=0,a=[],s=[],o={},l=function(d,f){for(var p=s.length-1,m=[],v=e.spawn();s[p].x!=d||s[p].y!=f;)m.push(s.pop().edge),p--;m.push(s.pop().edge),m.forEach(function(g){var y=g.connectedNodes().intersection(e);v.merge(g),y.forEach(function(_){var x=_.id(),E=_.connectedEdges().intersection(e);v.merge(_),t[x].cutVertex?v.merge(E.filter(function(T){return T.isLoop()})):v.merge(E)})}),a.push(v)},u=function(d,f,p){d===p&&(i+=1),t[f]={id:n,low:n++,cutVertex:!1};var m=e.getElementById(f).connectedEdges().intersection(e);if(m.size()===0)a.push(e.spawn(e.getElementById(f)));else{var v,g,y,_;m.forEach(function(x){v=x.source().id(),g=x.target().id(),y=v===f?g:v,y!==p&&(_=x.id(),o[_]||(o[_]=!0,s.push({x:f,y,edge:x})),y in t?t[f].low=Math.min(t[f].low,t[y].id):(u(d,y,f),t[f].low=Math.min(t[f].low,t[y].low),t[f].id<=t[y].low&&(t[f].cutVertex=!0,l(f,y))))})}};e.forEach(function(h){if(h.isNode()){var d=h.id();d in t||(i=0,u(d,d),t[d].cutVertex=i>1)}});var c=Object.keys(t).filter(function(h){return t[h].cutVertex}).map(function(h){return e.getElementById(h)});return{cut:e.spawn(c),components:a}},q$={hopcroftTarjanBiconnected:Zd,htbc:Zd,htb:Zd,hopcroftTarjanBiconnectedComponents:Zd},Jd=function(){var e=this,t={},n=0,i=[],a=[],s=e.spawn(e),o=function(u){a.push(u),t[u]={index:n,low:n++,explored:!1};var c=e.getElementById(u).connectedEdges().intersection(e);if(c.forEach(function(m){var v=m.target().id();v!==u&&(v in t||o(v),t[v].explored||(t[u].low=Math.min(t[u].low,t[v].low)))}),t[u].index===t[u].low){for(var h=e.spawn();;){var d=a.pop();if(h.merge(e.getElementById(d)),t[d].low=t[u].index,t[d].explored=!0,d===u)break}var f=h.edgesWith(h),p=h.merge(f);i.push(p),s=s.difference(p)}};return e.forEach(function(l){if(l.isNode()){var u=l.id();u in t||o(u)}}),{cut:s,components:i}},$$={tarjanStronglyConnected:Jd,tsc:Jd,tscc:Jd,tarjanStronglyConnectedComponents:Jd},Sk={};[Af,wq,Sq,Mq,Rq,Pq,Iq,a$,lc,uc,Aw,y$,P$,O$,V$,W$,q$,$$].forEach(function(r){mt(Sk,r)});/*!
Embeddable Minimum Strictly-Compliant Promises/A+ 1.1.1 Thenable
Copyright (c) 2013-2014 Ralf S. Engelschall (http://engelschall.com)
Licensed under The MIT License (http://opensource.org/licenses/MIT)
*/var Ak=0,Mk=1,Ck=2,Fa=function(e){if(!(this instanceof Fa))return new Fa(e);this.id="Thenable/1.0.7",this.state=Ak,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},typeof e=="function"&&e.call(this,this.fulfill.bind(this),this.reject.bind(this))};Fa.prototype={fulfill:function(e){return zC(this,Mk,"fulfillValue",e)},reject:function(e){return zC(this,Ck,"rejectReason",e)},then:function(e,t){var n=this,i=new Fa;return n.onFulfilled.push(HC(e,i,"fulfill")),n.onRejected.push(HC(t,i,"reject")),Rk(n),i.proxy}};var zC=function(e,t,n,i){return e.state===Ak&&(e.state=t,e[n]=i,Rk(e)),e},Rk=function(e){e.state===Mk?VC(e,"onFulfilled",e.fulfillValue):e.state===Ck&&VC(e,"onRejected",e.rejectReason)},VC=function(e,t,n){if(e[t].length!==0){var i=e[t];e[t]=[];var a=function(){for(var o=0;o<i.length;o++)i[o](n)};typeof setImmediate=="function"?setImmediate(a):setTimeout(a,0)}},HC=function(e,t,n){return function(i){if(typeof e!="function")t[n].call(t,i);else{var a;try{a=e(i)}catch(s){t.reject(s);return}Nk(t,a)}}},Nk=function(e,t){if(e===t||e.proxy===t){e.reject(new TypeError("cannot resolve promise with itself"));return}var n;if(sr(t)==="object"&&t!==null||typeof t=="function")try{n=t.then}catch(a){e.reject(a);return}if(typeof n=="function"){var i=!1;try{n.call(t,function(a){i||(i=!0,a===t?e.reject(new TypeError("circular thenable chain")):Nk(e,a))},function(a){i||(i=!0,e.reject(a))})}catch(a){i||e.reject(a)}return}e.fulfill(t)};Fa.all=function(r){return new Fa(function(e,t){for(var n=new Array(r.length),i=0,a=function(l,u){n[l]=u,i++,i===r.length&&e(n)},s=0;s<r.length;s++)(function(o){var l=r[o],u=l!=null&&l.then!=null;if(u)l.then(function(h){a(o,h)},function(h){t(h)});else{var c=l;a(o,c)}})(s)})};Fa.resolve=function(r){return new Fa(function(e,t){e(r)})};Fa.reject=function(r){return new Fa(function(e,t){t(r)})};var Kc=typeof Promise<"u"?Promise:Fa,Rw=function(e,t,n){var i=PS(e),a=!i,s=this._private=mt({duration:1e3},t,n);if(s.target=e,s.style=s.style||s.css,s.started=!1,s.playing=!1,s.hooked=!1,s.applying=!1,s.progress=0,s.completes=[],s.frames=[],s.complete&&Pn(s.complete)&&s.completes.push(s.complete),a){var o=e.position();s.startPosition=s.startPosition||{x:o.x,y:o.y},s.startStyle=s.startStyle||e.cy().style().getAnimationStartStyle(e,s.style)}if(i){var l=e.pan();s.startPan={x:l.x,y:l.y},s.startZoom=e.zoom()}this.length=1,this[0]=this},Wl=Rw.prototype;mt(Wl,{instanceString:function(){return"animation"},hook:function(){var e=this._private;if(!e.hooked){var t,n=e.target._private.animation;e.queue?t=n.queue:t=n.current,t.push(this),ki(e.target)&&e.target.cy().addToAnimationPool(e.target),e.hooked=!0}return this},play:function(){var e=this._private;return e.progress===1&&(e.progress=0),e.playing=!0,e.started=!1,e.stopped=!1,this.hook(),this},playing:function(){return this._private.playing},apply:function(){var e=this._private;return e.applying=!0,e.started=!1,e.stopped=!1,this.hook(),this},applying:function(){return this._private.applying},pause:function(){var e=this._private;return e.playing=!1,e.started=!1,this},stop:function(){var e=this._private;return e.playing=!1,e.started=!1,e.stopped=!0,this},rewind:function(){return this.progress(0)},fastforward:function(){return this.progress(1)},time:function(e){var t=this._private;return e===void 0?t.progress*t.duration:this.progress(e/t.duration)},progress:function(e){var t=this._private,n=t.playing;return e===void 0?t.progress:(n&&this.pause(),t.progress=e,t.started=!1,n&&this.play(),this)},completed:function(){return this._private.progress===1},reverse:function(){var e=this._private,t=e.playing;t&&this.pause(),e.progress=1-e.progress,e.started=!1;var n=function(u,c){var h=e[u];h!=null&&(e[u]=e[c],e[c]=h)};if(n("zoom","startZoom"),n("pan","startPan"),n("position","startPosition"),e.style)for(var i=0;i<e.style.length;i++){var a=e.style[i],s=a.name,o=e.startStyle[s];e.startStyle[s]=a,e.style[i]=o}return t&&this.play(),this},promise:function(e){var t=this._private,n;switch(e){case"frame":n=t.frames;break;default:case"complete":case"completed":n=t.completes}return new Kc(function(i,a){n.push(function(){i()})})}});Wl.complete=Wl.completed;Wl.run=Wl.play;Wl.running=Wl.playing;var X$={animated:function(){return function(){var t=this,n=t.length!==void 0,i=n?t:[t],a=this._private.cy||this;if(!a.styleEnabled())return!1;var s=i[0];if(s)return s._private.animation.current.length>0}},clearQueue:function(){return function(){var t=this,n=t.length!==void 0,i=n?t:[t],a=this._private.cy||this;if(!a.styleEnabled())return this;for(var s=0;s<i.length;s++){var o=i[s];o._private.animation.queue=[]}return this}},delay:function(){return function(t,n){var i=this._private.cy||this;return i.styleEnabled()?this.animate({delay:t,duration:t,complete:n}):this}},delayAnimation:function(){return function(t,n){var i=this._private.cy||this;return i.styleEnabled()?this.animation({delay:t,duration:t,complete:n}):this}},animation:function(){return function(t,n){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this,l=!a,u=!l;if(!o.styleEnabled())return this;var c=o.style();t=mt({},t,n);var h=Object.keys(t).length===0;if(h)return new Rw(s[0],t);switch(t.duration===void 0&&(t.duration=400),t.duration){case"slow":t.duration=600;break;case"fast":t.duration=200;break}if(u&&(t.style=c.getPropsList(t.style||t.css),t.css=void 0),u&&t.renderedPosition!=null){var d=t.renderedPosition,f=o.pan(),p=o.zoom();t.position=pk(d,p,f)}if(l&&t.panBy!=null){var m=t.panBy,v=o.pan();t.pan={x:v.x+m.x,y:v.y+m.y}}var g=t.center||t.centre;if(l&&g!=null){var y=o.getCenterPan(g.eles,t.zoom);y!=null&&(t.pan=y)}if(l&&t.fit!=null){var _=t.fit,x=o.getFitViewport(_.eles||_.boundingBox,_.padding);x!=null&&(t.pan=x.pan,t.zoom=x.zoom)}if(l&&$t(t.zoom)){var E=o.getZoomedViewport(t.zoom);E!=null?(E.zoomed&&(t.zoom=E.zoom),E.panned&&(t.pan=E.pan)):t.zoom=null}return new Rw(s[0],t)}},animate:function(){return function(t,n){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this;if(!o.styleEnabled())return this;n&&(t=mt({},t,n));for(var l=0;l<s.length;l++){var u=s[l],c=u.animated()&&(t.queue===void 0||t.queue),h=u.animation(t,c?{queue:!0}:void 0);h.play()}return this}},stop:function(){return function(t,n){var i=this,a=i.length!==void 0,s=a?i:[i],o=this._private.cy||this;if(!o.styleEnabled())return this;for(var l=0;l<s.length;l++){for(var u=s[l],c=u._private,h=c.animation.current,d=0;d<h.length;d++){var f=h[d],p=f._private;n&&(p.duration=0)}t&&(c.animation.queue=[]),n||(c.animation.current=[])}return o.notify("draw"),this}}},ly,WC;function Sv(){if(WC)return ly;WC=1;var r=Array.isArray;return ly=r,ly}var uy,qC;function Y$(){if(qC)return uy;qC=1;var r=Sv(),e=vd(),t=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function i(a,s){if(r(a))return!1;var o=typeof a;return o=="number"||o=="symbol"||o=="boolean"||a==null||e(a)?!0:n.test(a)||!t.test(a)||s!=null&&a in Object(s)}return uy=i,uy}var cy,$C;function j$(){if($C)return cy;$C=1;var r=ak(),e=gd(),t="[object AsyncFunction]",n="[object Function]",i="[object GeneratorFunction]",a="[object Proxy]";function s(o){if(!e(o))return!1;var l=r(o);return l==n||l==i||l==t||l==a}return cy=s,cy}var hy,XC;function K$(){if(XC)return hy;XC=1;var r=bv(),e=r["__core-js_shared__"];return hy=e,hy}var fy,YC;function Q$(){if(YC)return fy;YC=1;var r=K$(),e=function(){var n=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function t(n){return!!e&&e in n}return fy=t,fy}var dy,jC;function Z$(){if(jC)return dy;jC=1;var r=Function.prototype,e=r.toString;function t(n){if(n!=null){try{return e.call(n)}catch{}try{return n+""}catch{}}return""}return dy=t,dy}var py,KC;function J$(){if(KC)return py;KC=1;var r=j$(),e=Q$(),t=gd(),n=Z$(),i=/[\\^$.*+?()[\]{}|]/g,a=/^\[object .+?Constructor\]$/,s=Function.prototype,o=Object.prototype,l=s.toString,u=o.hasOwnProperty,c=RegExp("^"+l.call(u).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function h(d){if(!t(d)||e(d))return!1;var f=r(d)?c:a;return f.test(n(d))}return py=h,py}var gy,QC;function e8(){if(QC)return gy;QC=1;function r(e,t){return e==null?void 0:e[t]}return gy=r,gy}var vy,ZC;function zS(){if(ZC)return vy;ZC=1;var r=J$(),e=e8();function t(n,i){var a=e(n,i);return r(a)?a:void 0}return vy=t,vy}var my,JC;function Av(){if(JC)return my;JC=1;var r=zS(),e=r(Object,"create");return my=e,my}var yy,eR;function t8(){if(eR)return yy;eR=1;var r=Av();function e(){this.__data__=r?r(null):{},this.size=0}return yy=e,yy}var _y,tR;function n8(){if(tR)return _y;tR=1;function r(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}return _y=r,_y}var xy,nR;function r8(){if(nR)return xy;nR=1;var r=Av(),e="__lodash_hash_undefined__",t=Object.prototype,n=t.hasOwnProperty;function i(a){var s=this.__data__;if(r){var o=s[a];return o===e?void 0:o}return n.call(s,a)?s[a]:void 0}return xy=i,xy}var by,rR;function i8(){if(rR)return by;rR=1;var r=Av(),e=Object.prototype,t=e.hasOwnProperty;function n(i){var a=this.__data__;return r?a[i]!==void 0:t.call(a,i)}return by=n,by}var Ey,iR;function a8(){if(iR)return Ey;iR=1;var r=Av(),e="__lodash_hash_undefined__";function t(n,i){var a=this.__data__;return this.size+=this.has(n)?0:1,a[n]=r&&i===void 0?e:i,this}return Ey=t,Ey}var Ty,aR;function s8(){if(aR)return Ty;aR=1;var r=t8(),e=n8(),t=r8(),n=i8(),i=a8();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=r,a.prototype.delete=e,a.prototype.get=t,a.prototype.has=n,a.prototype.set=i,Ty=a,Ty}var wy,sR;function o8(){if(sR)return wy;sR=1;function r(){this.__data__=[],this.size=0}return wy=r,wy}var Sy,oR;function Pk(){if(oR)return Sy;oR=1;function r(e,t){return e===t||e!==e&&t!==t}return Sy=r,Sy}var Ay,lR;function Mv(){if(lR)return Ay;lR=1;var r=Pk();function e(t,n){for(var i=t.length;i--;)if(r(t[i][0],n))return i;return-1}return Ay=e,Ay}var My,uR;function l8(){if(uR)return My;uR=1;var r=Mv(),e=Array.prototype,t=e.splice;function n(i){var a=this.__data__,s=r(a,i);if(s<0)return!1;var o=a.length-1;return s==o?a.pop():t.call(a,s,1),--this.size,!0}return My=n,My}var Cy,cR;function u8(){if(cR)return Cy;cR=1;var r=Mv();function e(t){var n=this.__data__,i=r(n,t);return i<0?void 0:n[i][1]}return Cy=e,Cy}var Ry,hR;function c8(){if(hR)return Ry;hR=1;var r=Mv();function e(t){return r(this.__data__,t)>-1}return Ry=e,Ry}var Ny,fR;function h8(){if(fR)return Ny;fR=1;var r=Mv();function e(t,n){var i=this.__data__,a=r(i,t);return a<0?(++this.size,i.push([t,n])):i[a][1]=n,this}return Ny=e,Ny}var Py,dR;function f8(){if(dR)return Py;dR=1;var r=o8(),e=l8(),t=u8(),n=c8(),i=h8();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=r,a.prototype.delete=e,a.prototype.get=t,a.prototype.has=n,a.prototype.set=i,Py=a,Py}var Dy,pR;function d8(){if(pR)return Dy;pR=1;var r=zS(),e=bv(),t=r(e,"Map");return Dy=t,Dy}var Ly,gR;function p8(){if(gR)return Ly;gR=1;var r=s8(),e=f8(),t=d8();function n(){this.size=0,this.__data__={hash:new r,map:new(t||e),string:new r}}return Ly=n,Ly}var Iy,vR;function g8(){if(vR)return Iy;vR=1;function r(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}return Iy=r,Iy}var Oy,mR;function Cv(){if(mR)return Oy;mR=1;var r=g8();function e(t,n){var i=t.__data__;return r(n)?i[typeof n=="string"?"string":"hash"]:i.map}return Oy=e,Oy}var Fy,yR;function v8(){if(yR)return Fy;yR=1;var r=Cv();function e(t){var n=r(this,t).delete(t);return this.size-=n?1:0,n}return Fy=e,Fy}var By,_R;function m8(){if(_R)return By;_R=1;var r=Cv();function e(t){return r(this,t).get(t)}return By=e,By}var Uy,xR;function y8(){if(xR)return Uy;xR=1;var r=Cv();function e(t){return r(this,t).has(t)}return Uy=e,Uy}var ky,bR;function _8(){if(bR)return ky;bR=1;var r=Cv();function e(t,n){var i=r(this,t),a=i.size;return i.set(t,n),this.size+=i.size==a?0:1,this}return ky=e,ky}var Gy,ER;function x8(){if(ER)return Gy;ER=1;var r=p8(),e=v8(),t=m8(),n=y8(),i=_8();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=r,a.prototype.delete=e,a.prototype.get=t,a.prototype.has=n,a.prototype.set=i,Gy=a,Gy}var zy,TR;function b8(){if(TR)return zy;TR=1;var r=x8(),e="Expected a function";function t(n,i){if(typeof n!="function"||i!=null&&typeof i!="function")throw new TypeError(e);var a=function(){var s=arguments,o=i?i.apply(this,s):s[0],l=a.cache;if(l.has(o))return l.get(o);var u=n.apply(this,s);return a.cache=l.set(o,u)||l,u};return a.cache=new(t.Cache||r),a}return t.Cache=r,zy=t,zy}var Vy,wR;function E8(){if(wR)return Vy;wR=1;var r=b8(),e=500;function t(n){var i=r(n,function(s){return a.size===e&&a.clear(),s}),a=i.cache;return i}return Vy=t,Vy}var Hy,SR;function Dk(){if(SR)return Hy;SR=1;var r=E8(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,t=/\\(\\)?/g,n=r(function(i){var a=[];return i.charCodeAt(0)===46&&a.push(""),i.replace(e,function(s,o,l,u){a.push(l?u.replace(t,"$1"):o||s)}),a});return Hy=n,Hy}var Wy,AR;function Lk(){if(AR)return Wy;AR=1;function r(e,t){for(var n=-1,i=e==null?0:e.length,a=Array(i);++n<i;)a[n]=t(e[n],n,e);return a}return Wy=r,Wy}var qy,MR;function T8(){if(MR)return qy;MR=1;var r=LS(),e=Lk(),t=Sv(),n=vd(),i=r?r.prototype:void 0,a=i?i.toString:void 0;function s(o){if(typeof o=="string")return o;if(t(o))return e(o,s)+"";if(n(o))return a?a.call(o):"";var l=o+"";return l=="0"&&1/o==-1/0?"-0":l}return qy=s,qy}var $y,CR;function Ik(){if(CR)return $y;CR=1;var r=T8();function e(t){return t==null?"":r(t)}return $y=e,$y}var Xy,RR;function Ok(){if(RR)return Xy;RR=1;var r=Sv(),e=Y$(),t=Dk(),n=Ik();function i(a,s){return r(a)?a:e(a,s)?[a]:t(n(a))}return Xy=i,Xy}var Yy,NR;function VS(){if(NR)return Yy;NR=1;var r=vd();function e(t){if(typeof t=="string"||r(t))return t;var n=t+"";return n=="0"&&1/t==-1/0?"-0":n}return Yy=e,Yy}var jy,PR;function w8(){if(PR)return jy;PR=1;var r=Ok(),e=VS();function t(n,i){i=r(i,n);for(var a=0,s=i.length;n!=null&&a<s;)n=n[e(i[a++])];return a&&a==s?n:void 0}return jy=t,jy}var Ky,DR;function S8(){if(DR)return Ky;DR=1;var r=w8();function e(t,n,i){var a=t==null?void 0:r(t,n);return a===void 0?i:a}return Ky=e,Ky}var A8=S8(),M8=pd(A8),Qy,LR;function C8(){if(LR)return Qy;LR=1;var r=zS(),e=function(){try{var t=r(Object,"defineProperty");return t({},"",{}),t}catch{}}();return Qy=e,Qy}var Zy,IR;function R8(){if(IR)return Zy;IR=1;var r=C8();function e(t,n,i){n=="__proto__"&&r?r(t,n,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[n]=i}return Zy=e,Zy}var Jy,OR;function N8(){if(OR)return Jy;OR=1;var r=R8(),e=Pk(),t=Object.prototype,n=t.hasOwnProperty;function i(a,s,o){var l=a[s];(!(n.call(a,s)&&e(l,o))||o===void 0&&!(s in a))&&r(a,s,o)}return Jy=i,Jy}var e0,FR;function P8(){if(FR)return e0;FR=1;var r=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function t(n,i){var a=typeof n;return i=i==null?r:i,!!i&&(a=="number"||a!="symbol"&&e.test(n))&&n>-1&&n%1==0&&n<i}return e0=t,e0}var t0,BR;function D8(){if(BR)return t0;BR=1;var r=N8(),e=Ok(),t=P8(),n=gd(),i=VS();function a(s,o,l,u){if(!n(s))return s;o=e(o,s);for(var c=-1,h=o.length,d=h-1,f=s;f!=null&&++c<h;){var p=i(o[c]),m=l;if(p==="__proto__"||p==="constructor"||p==="prototype")return s;if(c!=d){var v=f[p];m=u?u(v,p,f):void 0,m===void 0&&(m=n(v)?v:t(o[c+1])?[]:{})}r(f,p,m),f=f[p]}return s}return t0=a,t0}var n0,UR;function L8(){if(UR)return n0;UR=1;var r=D8();function e(t,n,i){return t==null?t:r(t,n,i)}return n0=e,n0}var I8=L8(),O8=pd(I8),r0,kR;function F8(){if(kR)return r0;kR=1;function r(e,t){var n=-1,i=e.length;for(t||(t=Array(i));++n<i;)t[n]=e[n];return t}return r0=r,r0}var i0,GR;function B8(){if(GR)return i0;GR=1;var r=Lk(),e=F8(),t=Sv(),n=vd(),i=Dk(),a=VS(),s=Ik();function o(l){return t(l)?r(l,a):n(l)?[l]:e(i(s(l)))}return i0=o,i0}var U8=B8(),k8=pd(U8),G8={data:function(e){var t={field:"data",bindingEvent:"data",allowBinding:!1,allowSetting:!1,allowGetting:!1,settingEvent:"data",settingTriggersEvent:!1,triggerFnName:"trigger",immutableKeys:{},updateStyle:!1,beforeGet:function(i){},beforeSet:function(i,a){},onSet:function(i){},canSet:function(i){return!0}};return e=mt({},t,e),function(i,a){var s=e,o=this,l=o.length!==void 0,u=l?o:[o],c=l?o[0]:o;if(dt(i)){var h=i.indexOf(".")!==-1,d=h&&k8(i);if(s.allowGetting&&a===void 0){var f;return c&&(s.beforeGet(c),d&&c._private[s.field][i]===void 0?f=M8(c._private[s.field],d):f=c._private[s.field][i]),f}else if(s.allowSetting&&a!==void 0){var p=!s.immutableKeys[i];if(p){var m=YU({},i,a);s.beforeSet(o,m);for(var v=0,g=u.length;v<g;v++){var y=u[v];s.canSet(y)&&(d&&c._private[s.field][i]===void 0?O8(y._private[s.field],d,a):y._private[s.field][i]=a)}s.updateStyle&&o.updateStyle(),s.onSet(o),s.settingTriggersEvent&&o[s.triggerFnName](s.settingEvent)}}}else if(s.allowSetting&&$t(i)){var _=i,x,E,T=Object.keys(_);s.beforeSet(o,_);for(var b=0;b<T.length;b++){x=T[b],E=_[x];var w=!s.immutableKeys[x];if(w)for(var A=0;A<u.length;A++){var S=u[A];s.canSet(S)&&(S._private[s.field][x]=E)}}s.updateStyle&&o.updateStyle(),s.onSet(o),s.settingTriggersEvent&&o[s.triggerFnName](s.settingEvent)}else if(s.allowBinding&&Pn(i)){var C=i;o.on(s.bindingEvent,C)}else if(s.allowGetting&&i===void 0){var R;return c&&(s.beforeGet(c),R=c._private[s.field]),R}return o}},removeData:function(e){var t={field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!1,immutableKeys:{}};return e=mt({},t,e),function(i){var a=e,s=this,o=s.length!==void 0,l=o?s:[s];if(dt(i)){for(var u=i.split(/\s+/),c=u.length,h=0;h<c;h++){var d=u[h];if(!Bo(d)){var f=!a.immutableKeys[d];if(f)for(var p=0,m=l.length;p<m;p++)l[p]._private[a.field][d]=void 0}}a.triggerEvent&&s[a.triggerFnName](a.event)}else if(i===void 0){for(var v=0,g=l.length;v<g;v++)for(var y=l[v]._private[a.field],_=Object.keys(y),x=0;x<_.length;x++){var E=_[x],T=!a.immutableKeys[E];T&&(y[E]=void 0)}a.triggerEvent&&s[a.triggerFnName](a.event)}return s}}},z8={eventAliasesOn:function(e){var t=e;t.addListener=t.listen=t.bind=t.on,t.unlisten=t.unbind=t.off=t.removeListener,t.trigger=t.emit,t.pon=t.promiseOn=function(n,i){var a=this,s=Array.prototype.slice.call(arguments,0);return new Kc(function(o,l){var u=function(f){a.off.apply(a,h),o(f)},c=s.concat([u]),h=c.concat([]);a.on.apply(a,c)})}}},tn={};[X$,G8,z8].forEach(function(r){mt(tn,r)});var V8={animate:tn.animate(),animation:tn.animation(),animated:tn.animated(),clearQueue:tn.clearQueue(),delay:tn.delay(),delayAnimation:tn.delayAnimation(),stop:tn.stop()},pg={classes:function(e){var t=this;if(e===void 0){var n=[];return t[0]._private.classes.forEach(function(p){return n.push(p)}),n}else fn(e)||(e=(e||"").match(/\S+/g)||[]);for(var i=[],a=new jc(e),s=0;s<t.length;s++){for(var o=t[s],l=o._private,u=l.classes,c=!1,h=0;h<e.length;h++){var d=e[h],f=u.has(d);if(!f){c=!0;break}}c||(c=u.size!==e.length),c&&(l.classes=a,i.push(o))}return i.length>0&&this.spawn(i).updateStyle().emit("class"),t},addClass:function(e){return this.toggleClass(e,!0)},hasClass:function(e){var t=this[0];return t!=null&&t._private.classes.has(e)},toggleClass:function(e,t){fn(e)||(e=e.match(/\S+/g)||[]);for(var n=this,i=t===void 0,a=[],s=0,o=n.length;s<o;s++)for(var l=n[s],u=l._private.classes,c=!1,h=0;h<e.length;h++){var d=e[h],f=u.has(d),p=!1;t||i&&!f?(u.add(d),p=!0):(!t||i&&f)&&(u.delete(d),p=!0),!c&&p&&(a.push(l),c=!0)}return a.length>0&&this.spawn(a).updateStyle().emit("class"),n},removeClass:function(e){return this.toggleClass(e,!1)},flashClass:function(e,t){var n=this;if(t==null)t=250;else if(t===0)return n;return n.addClass(e),setTimeout(function(){n.removeClass(e)},t),n}};pg.className=pg.classNames=pg.classes;var Wt={metaChar:"[\\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;\\<\\=\\>\\?\\@\\[\\]\\^\\`\\{\\|\\}\\~]",comparatorOp:"=|\\!=|>|>=|<|<=|\\$=|\\^=|\\*=",boolOp:"\\?|\\!|\\^",string:`"(?:\\\\"|[^"])*"|'(?:\\\\'|[^'])*'`,number:nr,meta:"degree|indegree|outdegree",separator:"\\s*,\\s*",descendant:"\\s+",child:"\\s+>\\s+",subject:"\\$",group:"node|edge|\\*",directedEdge:"\\s+->\\s+",undirectedEdge:"\\s+<->\\s+"};Wt.variable="(?:[\\w-.]|(?:\\\\"+Wt.metaChar+"))+";Wt.className="(?:[\\w-]|(?:\\\\"+Wt.metaChar+"))+";Wt.value=Wt.string+"|"+Wt.number;Wt.id=Wt.variable;(function(){var r,e,t;for(r=Wt.comparatorOp.split("|"),t=0;t<r.length;t++)e=r[t],Wt.comparatorOp+="|@"+e;for(r=Wt.comparatorOp.split("|"),t=0;t<r.length;t++)e=r[t],!(e.indexOf("!")>=0)&&e!=="="&&(Wt.comparatorOp+="|\\!"+e)})();var an=function(){return{checks:[]}},lt={GROUP:0,COLLECTION:1,FILTER:2,DATA_COMPARE:3,DATA_EXIST:4,DATA_BOOL:5,META_COMPARE:6,STATE:7,ID:8,CLASS:9,UNDIRECTED_EDGE:10,DIRECTED_EDGE:11,NODE_SOURCE:12,NODE_TARGET:13,NODE_NEIGHBOR:14,CHILD:15,DESCENDANT:16,PARENT:17,ANCESTOR:18,COMPOUND_SPLIT:19,TRUE:20},Nw=[{selector:":selected",matches:function(e){return e.selected()}},{selector:":unselected",matches:function(e){return!e.selected()}},{selector:":selectable",matches:function(e){return e.selectable()}},{selector:":unselectable",matches:function(e){return!e.selectable()}},{selector:":locked",matches:function(e){return e.locked()}},{selector:":unlocked",matches:function(e){return!e.locked()}},{selector:":visible",matches:function(e){return e.visible()}},{selector:":hidden",matches:function(e){return!e.visible()}},{selector:":transparent",matches:function(e){return e.transparent()}},{selector:":grabbed",matches:function(e){return e.grabbed()}},{selector:":free",matches:function(e){return!e.grabbed()}},{selector:":removed",matches:function(e){return e.removed()}},{selector:":inside",matches:function(e){return!e.removed()}},{selector:":grabbable",matches:function(e){return e.grabbable()}},{selector:":ungrabbable",matches:function(e){return!e.grabbable()}},{selector:":animated",matches:function(e){return e.animated()}},{selector:":unanimated",matches:function(e){return!e.animated()}},{selector:":parent",matches:function(e){return e.isParent()}},{selector:":childless",matches:function(e){return e.isChildless()}},{selector:":child",matches:function(e){return e.isChild()}},{selector:":orphan",matches:function(e){return e.isOrphan()}},{selector:":nonorphan",matches:function(e){return e.isChild()}},{selector:":compound",matches:function(e){return e.isNode()?e.isParent():e.source().isParent()||e.target().isParent()}},{selector:":loop",matches:function(e){return e.isLoop()}},{selector:":simple",matches:function(e){return e.isSimple()}},{selector:":active",matches:function(e){return e.active()}},{selector:":inactive",matches:function(e){return!e.active()}},{selector:":backgrounding",matches:function(e){return e.backgrounding()}},{selector:":nonbackgrounding",matches:function(e){return!e.backgrounding()}}].sort(function(r,e){return qW(r.selector,e.selector)}),H8=function(){for(var r={},e,t=0;t<Nw.length;t++)e=Nw[t],r[e.selector]=e.matches;return r}(),W8=function(e,t){return H8[e](t)},q8="("+Nw.map(function(r){return r.selector}).join("|")+")",pu=function(e){return e.replace(new RegExp("\\\\("+Wt.metaChar+")","g"),function(t,n){return n})},lo=function(e,t,n){e[e.length-1]=n},Pw=[{name:"group",query:!0,regex:"("+Wt.group+")",populate:function(e,t,n){var i=vr(n,1),a=i[0];t.checks.push({type:lt.GROUP,value:a==="*"?a:a+"s"})}},{name:"state",query:!0,regex:q8,populate:function(e,t,n){var i=vr(n,1),a=i[0];t.checks.push({type:lt.STATE,value:a})}},{name:"id",query:!0,regex:"\\#("+Wt.id+")",populate:function(e,t,n){var i=vr(n,1),a=i[0];t.checks.push({type:lt.ID,value:pu(a)})}},{name:"className",query:!0,regex:"\\.("+Wt.className+")",populate:function(e,t,n){var i=vr(n,1),a=i[0];t.checks.push({type:lt.CLASS,value:pu(a)})}},{name:"dataExists",query:!0,regex:"\\[\\s*("+Wt.variable+")\\s*\\]",populate:function(e,t,n){var i=vr(n,1),a=i[0];t.checks.push({type:lt.DATA_EXIST,field:pu(a)})}},{name:"dataCompare",query:!0,regex:"\\[\\s*("+Wt.variable+")\\s*("+Wt.comparatorOp+")\\s*("+Wt.value+")\\s*\\]",populate:function(e,t,n){var i=vr(n,3),a=i[0],s=i[1],o=i[2],l=new RegExp("^"+Wt.string+"$").exec(o)!=null;l?o=o.substring(1,o.length-1):o=parseFloat(o),t.checks.push({type:lt.DATA_COMPARE,field:pu(a),operator:s,value:o})}},{name:"dataBool",query:!0,regex:"\\[\\s*("+Wt.boolOp+")\\s*("+Wt.variable+")\\s*\\]",populate:function(e,t,n){var i=vr(n,2),a=i[0],s=i[1];t.checks.push({type:lt.DATA_BOOL,field:pu(s),operator:a})}},{name:"metaCompare",query:!0,regex:"\\[\\[\\s*("+Wt.meta+")\\s*("+Wt.comparatorOp+")\\s*("+Wt.number+")\\s*\\]\\]",populate:function(e,t,n){var i=vr(n,3),a=i[0],s=i[1],o=i[2];t.checks.push({type:lt.META_COMPARE,field:pu(a),operator:s,value:parseFloat(o)})}},{name:"nextQuery",separator:!0,regex:Wt.separator,populate:function(e,t){var n=e.currentSubject,i=e.edgeCount,a=e.compoundCount,s=e[e.length-1];n!=null&&(s.subject=n,e.currentSubject=null),s.edgeCount=i,s.compoundCount=a,e.edgeCount=0,e.compoundCount=0;var o=e[e.length++]=an();return o}},{name:"directedEdge",separator:!0,regex:Wt.directedEdge,populate:function(e,t){if(e.currentSubject==null){var n=an(),i=t,a=an();return n.checks.push({type:lt.DIRECTED_EDGE,source:i,target:a}),lo(e,t,n),e.edgeCount++,a}else{var s=an(),o=t,l=an();return s.checks.push({type:lt.NODE_SOURCE,source:o,target:l}),lo(e,t,s),e.edgeCount++,l}}},{name:"undirectedEdge",separator:!0,regex:Wt.undirectedEdge,populate:function(e,t){if(e.currentSubject==null){var n=an(),i=t,a=an();return n.checks.push({type:lt.UNDIRECTED_EDGE,nodes:[i,a]}),lo(e,t,n),e.edgeCount++,a}else{var s=an(),o=t,l=an();return s.checks.push({type:lt.NODE_NEIGHBOR,node:o,neighbor:l}),lo(e,t,s),l}}},{name:"child",separator:!0,regex:Wt.child,populate:function(e,t){if(e.currentSubject==null){var n=an(),i=an(),a=e[e.length-1];return n.checks.push({type:lt.CHILD,parent:a,child:i}),lo(e,t,n),e.compoundCount++,i}else if(e.currentSubject===t){var s=an(),o=e[e.length-1],l=an(),u=an(),c=an(),h=an();return s.checks.push({type:lt.COMPOUND_SPLIT,left:o,right:l,subject:u}),u.checks=t.checks,t.checks=[{type:lt.TRUE}],h.checks.push({type:lt.TRUE}),l.checks.push({type:lt.PARENT,parent:h,child:c}),lo(e,o,s),e.currentSubject=u,e.compoundCount++,c}else{var d=an(),f=an(),p=[{type:lt.PARENT,parent:d,child:f}];return d.checks=t.checks,t.checks=p,e.compoundCount++,f}}},{name:"descendant",separator:!0,regex:Wt.descendant,populate:function(e,t){if(e.currentSubject==null){var n=an(),i=an(),a=e[e.length-1];return n.checks.push({type:lt.DESCENDANT,ancestor:a,descendant:i}),lo(e,t,n),e.compoundCount++,i}else if(e.currentSubject===t){var s=an(),o=e[e.length-1],l=an(),u=an(),c=an(),h=an();return s.checks.push({type:lt.COMPOUND_SPLIT,left:o,right:l,subject:u}),u.checks=t.checks,t.checks=[{type:lt.TRUE}],h.checks.push({type:lt.TRUE}),l.checks.push({type:lt.ANCESTOR,ancestor:h,descendant:c}),lo(e,o,s),e.currentSubject=u,e.compoundCount++,c}else{var d=an(),f=an(),p=[{type:lt.ANCESTOR,ancestor:d,descendant:f}];return d.checks=t.checks,t.checks=p,e.compoundCount++,f}}},{name:"subject",modifier:!0,regex:Wt.subject,populate:function(e,t){if(e.currentSubject!=null&&e.currentSubject!==t)return nn("Redefinition of subject in selector `"+e.toString()+"`"),!1;e.currentSubject=t;var n=e[e.length-1],i=n.checks[0],a=i==null?null:i.type;a===lt.DIRECTED_EDGE?i.type=lt.NODE_TARGET:a===lt.UNDIRECTED_EDGE&&(i.type=lt.NODE_NEIGHBOR,i.node=i.nodes[1],i.neighbor=i.nodes[0],i.nodes=null)}}];Pw.forEach(function(r){return r.regexObj=new RegExp("^"+r.regex)});var $8=function(e){for(var t,n,i,a=0;a<Pw.length;a++){var s=Pw[a],o=s.name,l=e.match(s.regexObj);if(l!=null){n=l,t=s,i=o;var u=l[0];e=e.substring(u.length);break}}return{expr:t,match:n,name:i,remaining:e}},X8=function(e){var t=e.match(/^\s+/);if(t){var n=t[0];e=e.substring(n.length)}return e},Y8=function(e){var t=this,n=t.inputText=e,i=t[0]=an();for(t.length=1,n=X8(n);;){var a=$8(n);if(a.expr==null)return nn("The selector `"+e+"`is invalid"),!1;var s=a.match.slice(1),o=a.expr.populate(t,i,s);if(o===!1)return!1;if(o!=null&&(i=o),n=a.remaining,n.match(/^\s*$/))break}var l=t[t.length-1];t.currentSubject!=null&&(l.subject=t.currentSubject),l.edgeCount=t.edgeCount,l.compoundCount=t.compoundCount;for(var u=0;u<t.length;u++){var c=t[u];if(c.compoundCount>0&&c.edgeCount>0)return nn("The selector `"+e+"` is invalid because it uses both a compound selector and an edge selector"),!1;if(c.edgeCount>1)return nn("The selector `"+e+"` is invalid because it uses multiple edge selectors"),!1;c.edgeCount===1&&nn("The selector `"+e+"` is deprecated.  Edge selectors do not take effect on changes to source and target nodes after an edge is added, for performance reasons.  Use a class or data selector on edges instead, updating the class or data of an edge when your app detects a change in source or target nodes.")}return!0},j8=function(){if(this.toStringCache!=null)return this.toStringCache;for(var e=function(c){return c==null?"":c},t=function(c){return dt(c)?'"'+c+'"':e(c)},n=function(c){return" "+c+" "},i=function(c,h){var d=c.type,f=c.value;switch(d){case lt.GROUP:{var p=e(f);return p.substring(0,p.length-1)}case lt.DATA_COMPARE:{var m=c.field,v=c.operator;return"["+m+n(e(v))+t(f)+"]"}case lt.DATA_BOOL:{var g=c.operator,y=c.field;return"["+e(g)+y+"]"}case lt.DATA_EXIST:{var _=c.field;return"["+_+"]"}case lt.META_COMPARE:{var x=c.operator,E=c.field;return"[["+E+n(e(x))+t(f)+"]]"}case lt.STATE:return f;case lt.ID:return"#"+f;case lt.CLASS:return"."+f;case lt.PARENT:case lt.CHILD:return a(c.parent,h)+n(">")+a(c.child,h);case lt.ANCESTOR:case lt.DESCENDANT:return a(c.ancestor,h)+" "+a(c.descendant,h);case lt.COMPOUND_SPLIT:{var T=a(c.left,h),b=a(c.subject,h),w=a(c.right,h);return T+(T.length>0?" ":"")+b+w}case lt.TRUE:return""}},a=function(c,h){return c.checks.reduce(function(d,f,p){return d+(h===c&&p===0?"$":"")+i(f,h)},"")},s="",o=0;o<this.length;o++){var l=this[o];s+=a(l,l.subject),this.length>1&&o<this.length-1&&(s+=", ")}return this.toStringCache=s,s},K8={parse:Y8,toString:j8},Fk=function(e,t,n){var i,a=dt(e),s=et(e),o=dt(n),l,u,c=!1,h=!1,d=!1;switch(t.indexOf("!")>=0&&(t=t.replace("!",""),h=!0),t.indexOf("@")>=0&&(t=t.replace("@",""),c=!0),(a||o||c)&&(l=!a&&!s?"":""+e,u=""+n),c&&(e=l=l.toLowerCase(),n=u=u.toLowerCase()),t){case"*=":i=l.indexOf(u)>=0;break;case"$=":i=l.indexOf(u,l.length-u.length)>=0;break;case"^=":i=l.indexOf(u)===0;break;case"=":i=e===n;break;case">":d=!0,i=e>n;break;case">=":d=!0,i=e>=n;break;case"<":d=!0,i=e<n;break;case"<=":d=!0,i=e<=n;break;default:i=!1;break}return h&&(e!=null||!d)&&(i=!i),i},Q8=function(e,t){switch(t){case"?":return!!e;case"!":return!e;case"^":return e===void 0}},Z8=function(e){return e!==void 0},HS=function(e,t){return e.data(t)},J8=function(e,t){return e[t]()},Bn=[],bn=function(e,t){return e.checks.every(function(n){return Bn[n.type](n,t)})};Bn[lt.GROUP]=function(r,e){var t=r.value;return t==="*"||t===e.group()};Bn[lt.STATE]=function(r,e){var t=r.value;return W8(t,e)};Bn[lt.ID]=function(r,e){var t=r.value;return e.id()===t};Bn[lt.CLASS]=function(r,e){var t=r.value;return e.hasClass(t)};Bn[lt.META_COMPARE]=function(r,e){var t=r.field,n=r.operator,i=r.value;return Fk(J8(e,t),n,i)};Bn[lt.DATA_COMPARE]=function(r,e){var t=r.field,n=r.operator,i=r.value;return Fk(HS(e,t),n,i)};Bn[lt.DATA_BOOL]=function(r,e){var t=r.field,n=r.operator;return Q8(HS(e,t),n)};Bn[lt.DATA_EXIST]=function(r,e){var t=r.field;return r.operator,Z8(HS(e,t))};Bn[lt.UNDIRECTED_EDGE]=function(r,e){var t=r.nodes[0],n=r.nodes[1],i=e.source(),a=e.target();return bn(t,i)&&bn(n,a)||bn(n,i)&&bn(t,a)};Bn[lt.NODE_NEIGHBOR]=function(r,e){return bn(r.node,e)&&e.neighborhood().some(function(t){return t.isNode()&&bn(r.neighbor,t)})};Bn[lt.DIRECTED_EDGE]=function(r,e){return bn(r.source,e.source())&&bn(r.target,e.target())};Bn[lt.NODE_SOURCE]=function(r,e){return bn(r.source,e)&&e.outgoers().some(function(t){return t.isNode()&&bn(r.target,t)})};Bn[lt.NODE_TARGET]=function(r,e){return bn(r.target,e)&&e.incomers().some(function(t){return t.isNode()&&bn(r.source,t)})};Bn[lt.CHILD]=function(r,e){return bn(r.child,e)&&bn(r.parent,e.parent())};Bn[lt.PARENT]=function(r,e){return bn(r.parent,e)&&e.children().some(function(t){return bn(r.child,t)})};Bn[lt.DESCENDANT]=function(r,e){return bn(r.descendant,e)&&e.ancestors().some(function(t){return bn(r.ancestor,t)})};Bn[lt.ANCESTOR]=function(r,e){return bn(r.ancestor,e)&&e.descendants().some(function(t){return bn(r.descendant,t)})};Bn[lt.COMPOUND_SPLIT]=function(r,e){return bn(r.subject,e)&&bn(r.left,e)&&bn(r.right,e)};Bn[lt.TRUE]=function(){return!0};Bn[lt.COLLECTION]=function(r,e){var t=r.value;return t.has(e)};Bn[lt.FILTER]=function(r,e){var t=r.value;return t(e)};var e6=function(e){var t=this;if(t.length===1&&t[0].checks.length===1&&t[0].checks[0].type===lt.ID)return e.getElementById(t[0].checks[0].value).collection();var n=function(a){for(var s=0;s<t.length;s++){var o=t[s];if(bn(o,a))return!0}return!1};return t.text()==null&&(n=function(){return!0}),e.filter(n)},t6=function(e){for(var t=this,n=0;n<t.length;n++){var i=t[n];if(bn(i,e))return!0}return!1},n6={matches:t6,filter:e6},Go=function(e){this.inputText=e,this.currentSubject=null,this.compoundCount=0,this.edgeCount=0,this.length=0,e==null||dt(e)&&e.match(/^\s*$/)||(ki(e)?this.addQuery({checks:[{type:lt.COLLECTION,value:e.collection()}]}):Pn(e)?this.addQuery({checks:[{type:lt.FILTER,value:e}]}):dt(e)?this.parse(e)||(this.invalid=!0):Nn("A selector must be created from a string; found "))},zo=Go.prototype;[K8,n6].forEach(function(r){return mt(zo,r)});zo.text=function(){return this.inputText};zo.size=function(){return this.length};zo.eq=function(r){return this[r]};zo.sameText=function(r){return!this.invalid&&!r.invalid&&this.text()===r.text()};zo.addQuery=function(r){this[this.length++]=r};zo.selector=zo.toString;var Ro={allAre:function(e){var t=new Go(e);return this.every(function(n){return t.matches(n)})},is:function(e){var t=new Go(e);return this.some(function(n){return t.matches(n)})},some:function(e,t){for(var n=0;n<this.length;n++){var i=t?e.apply(t,[this[n],n,this]):e(this[n],n,this);if(i)return!0}return!1},every:function(e,t){for(var n=0;n<this.length;n++){var i=t?e.apply(t,[this[n],n,this]):e(this[n],n,this);if(!i)return!1}return!0},same:function(e){if(this===e)return!0;e=this.cy().collection(e);var t=this.length,n=e.length;return t!==n?!1:t===1?this[0]===e[0]:this.every(function(i){return e.hasElementWithId(i.id())})},anySame:function(e){return e=this.cy().collection(e),this.some(function(t){return e.hasElementWithId(t.id())})},allAreNeighbors:function(e){e=this.cy().collection(e);var t=this.neighborhood();return e.every(function(n){return t.hasElementWithId(n.id())})},contains:function(e){e=this.cy().collection(e);var t=this;return e.every(function(n){return t.hasElementWithId(n.id())})}};Ro.allAreNeighbours=Ro.allAreNeighbors;Ro.has=Ro.contains;Ro.equal=Ro.equals=Ro.same;var na=function(e,t){return function(i,a,s,o){var l=i,u=this,c;if(l==null?c="":ki(l)&&l.length===1&&(c=l.id()),u.length===1&&c){var h=u[0]._private,d=h.traversalCache=h.traversalCache||{},f=d[t]=d[t]||[],p=Uo(c),m=f[p];return m||(f[p]=e.call(u,i,a,s,o))}else return e.call(u,i,a,s,o)}},Ec={parent:function(e){var t=[];if(this.length===1){var n=this[0]._private.parent;if(n)return n}for(var i=0;i<this.length;i++){var a=this[i],s=a._private.parent;s&&t.push(s)}return this.spawn(t,!0).filter(e)},parents:function(e){for(var t=[],n=this.parent();n.nonempty();){for(var i=0;i<n.length;i++){var a=n[i];t.push(a)}n=n.parent()}return this.spawn(t,!0).filter(e)},commonAncestors:function(e){for(var t,n=0;n<this.length;n++){var i=this[n],a=i.parents();t=t||a,t=t.intersect(a)}return t.filter(e)},orphans:function(e){return this.stdFilter(function(t){return t.isOrphan()}).filter(e)},nonorphans:function(e){return this.stdFilter(function(t){return t.isChild()}).filter(e)},children:na(function(r){for(var e=[],t=0;t<this.length;t++)for(var n=this[t],i=n._private.children,a=0;a<i.length;a++)e.push(i[a]);return this.spawn(e,!0).filter(r)},"children"),siblings:function(e){return this.parent().children().not(this).filter(e)},isParent:function(){var e=this[0];if(e)return e.isNode()&&e._private.children.length!==0},isChildless:function(){var e=this[0];if(e)return e.isNode()&&e._private.children.length===0},isChild:function(){var e=this[0];if(e)return e.isNode()&&e._private.parent!=null},isOrphan:function(){var e=this[0];if(e)return e.isNode()&&e._private.parent==null},descendants:function(e){var t=[];function n(i){for(var a=0;a<i.length;a++){var s=i[a];t.push(s),s.children().nonempty()&&n(s.children())}}return n(this.children()),this.spawn(t,!0).filter(e)}};function WS(r,e,t,n){for(var i=[],a=new jc,s=r.cy(),o=s.hasCompoundNodes(),l=0;l<r.length;l++){var u=r[l];t?i.push(u):o&&n(i,a,u)}for(;i.length>0;){var c=i.shift();e(c),a.add(c.id()),o&&n(i,a,c)}return r}function Bk(r,e,t){if(t.isParent())for(var n=t._private.children,i=0;i<n.length;i++){var a=n[i];e.has(a.id())||r.push(a)}}Ec.forEachDown=function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return WS(this,r,e,Bk)};function Uk(r,e,t){if(t.isChild()){var n=t._private.parent;e.has(n.id())||r.push(n)}}Ec.forEachUp=function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return WS(this,r,e,Uk)};function r6(r,e,t){Uk(r,e,t),Bk(r,e,t)}Ec.forEachUpAndDown=function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return WS(this,r,e,r6)};Ec.ancestors=Ec.parents;var Rf,kk;Rf=kk={data:tn.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),removeData:tn.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),scratch:tn.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:tn.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),rscratch:tn.data({field:"rscratch",allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!0}),removeRscratch:tn.removeData({field:"rscratch",triggerEvent:!1}),id:function(){var e=this[0];if(e)return e._private.data.id}};Rf.attr=Rf.data;Rf.removeAttr=Rf.removeData;var i6=kk,Rv={};function a0(r){return function(e){var t=this;if(e===void 0&&(e=!0),t.length!==0)if(t.isNode()&&!t.removed()){for(var n=0,i=t[0],a=i._private.edges,s=0;s<a.length;s++){var o=a[s];!e&&o.isLoop()||(n+=r(i,o))}return n}else return}}mt(Rv,{degree:a0(function(r,e){return e.source().same(e.target())?2:1}),indegree:a0(function(r,e){return e.target().same(r)?1:0}),outdegree:a0(function(r,e){return e.source().same(r)?1:0})});function gu(r,e){return function(t){for(var n,i=this.nodes(),a=0;a<i.length;a++){var s=i[a],o=s[r](t);o!==void 0&&(n===void 0||e(o,n))&&(n=o)}return n}}mt(Rv,{minDegree:gu("degree",function(r,e){return r<e}),maxDegree:gu("degree",function(r,e){return r>e}),minIndegree:gu("indegree",function(r,e){return r<e}),maxIndegree:gu("indegree",function(r,e){return r>e}),minOutdegree:gu("outdegree",function(r,e){return r<e}),maxOutdegree:gu("outdegree",function(r,e){return r>e})});mt(Rv,{totalDegree:function(e){for(var t=0,n=this.nodes(),i=0;i<n.length;i++)t+=n[i].degree(e);return t}});var La,Gk,zk=function(e,t,n){for(var i=0;i<e.length;i++){var a=e[i];if(!a.locked()){var s=a._private.position,o={x:t.x!=null?t.x-s.x:0,y:t.y!=null?t.y-s.y:0};a.isParent()&&!(o.x===0&&o.y===0)&&a.children().shift(o,n),a.dirtyBoundingBoxCache()}}},zR={field:"position",bindingEvent:"position",allowBinding:!0,allowSetting:!0,settingEvent:"position",settingTriggersEvent:!0,triggerFnName:"emitAndNotify",allowGetting:!0,validKeys:["x","y"],beforeGet:function(e){e.updateCompoundBounds()},beforeSet:function(e,t){zk(e,t,!1)},onSet:function(e){e.dirtyCompoundBoundsCache()},canSet:function(e){return!e.locked()}};La=Gk={position:tn.data(zR),silentPosition:tn.data(mt({},zR,{allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!1,beforeSet:function(e,t){zk(e,t,!0)},onSet:function(e){e.dirtyCompoundBoundsCache()}})),positions:function(e,t){if($t(e))t?this.silentPosition(e):this.position(e);else if(Pn(e)){var n=e,i=this.cy();i.startBatch();for(var a=0;a<this.length;a++){var s=this[a],o=void 0;(o=n(s,a))&&(t?s.silentPosition(o):s.position(o))}i.endBatch()}return this},silentPositions:function(e){return this.positions(e,!0)},shift:function(e,t,n){var i;if($t(e)?(i={x:et(e.x)?e.x:0,y:et(e.y)?e.y:0},n=t):dt(e)&&et(t)&&(i={x:0,y:0},i[e]=t),i!=null){var a=this.cy();a.startBatch();for(var s=0;s<this.length;s++){var o=this[s];if(!(a.hasCompoundNodes()&&o.isChild()&&o.ancestors().anySame(this))){var l=o.position(),u={x:l.x+i.x,y:l.y+i.y};n?o.silentPosition(u):o.position(u)}}a.endBatch()}return this},silentShift:function(e,t){return $t(e)?this.shift(e,!0):dt(e)&&et(t)&&this.shift(e,t,!0),this},renderedPosition:function(e,t){var n=this[0],i=this.cy(),a=i.zoom(),s=i.pan(),o=$t(e)?e:void 0,l=o!==void 0||t!==void 0&&dt(e);if(n&&n.isNode())if(l)for(var u=0;u<this.length;u++){var c=this[u];t!==void 0?c.position(e,(t-s[e])/a):o!==void 0&&c.position(pk(o,a,s))}else{var h=n.position();return o=Tv(h,a,s),e===void 0?o:o[e]}else if(!l)return;return this},relativePosition:function(e,t){var n=this[0],i=this.cy(),a=$t(e)?e:void 0,s=a!==void 0||t!==void 0&&dt(e),o=i.hasCompoundNodes();if(n&&n.isNode())if(s)for(var l=0;l<this.length;l++){var u=this[l],c=o?u.parent():null,h=c&&c.length>0,d=h;h&&(c=c[0]);var f=d?c.position():{x:0,y:0};t!==void 0?u.position(e,t+f[e]):a!==void 0&&u.position({x:a.x+f.x,y:a.y+f.y})}else{var p=n.position(),m=o?n.parent():null,v=m&&m.length>0,g=v;v&&(m=m[0]);var y=g?m.position():{x:0,y:0};return a={x:p.x-y.x,y:p.y-y.y},e===void 0?a:a[e]}else if(!s)return;return this}};La.modelPosition=La.point=La.position;La.modelPositions=La.points=La.positions;La.renderedPoint=La.renderedPosition;La.relativePoint=La.relativePosition;var a6=Gk,cc,Qo;cc=Qo={};Qo.renderedBoundingBox=function(r){var e=this.boundingBox(r),t=this.cy(),n=t.zoom(),i=t.pan(),a=e.x1*n+i.x,s=e.x2*n+i.x,o=e.y1*n+i.y,l=e.y2*n+i.y;return{x1:a,x2:s,y1:o,y2:l,w:s-a,h:l-o}};Qo.dirtyCompoundBoundsCache=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=this.cy();return!e.styleEnabled()||!e.hasCompoundNodes()?this:(this.forEachUp(function(t){if(t.isParent()){var n=t._private;n.compoundBoundsClean=!1,n.bbCache=null,r||t.emitAndNotify("bounds")}}),this)};Qo.updateCompoundBounds=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=this.cy();if(!e.styleEnabled()||!e.hasCompoundNodes())return this;if(!r&&e.batching())return this;function t(s){if(!s.isParent())return;var o=s._private,l=s.children(),u=s.pstyle("compound-sizing-wrt-labels").value==="include",c={width:{val:s.pstyle("min-width").pfValue,left:s.pstyle("min-width-bias-left"),right:s.pstyle("min-width-bias-right")},height:{val:s.pstyle("min-height").pfValue,top:s.pstyle("min-height-bias-top"),bottom:s.pstyle("min-height-bias-bottom")}},h=l.boundingBox({includeLabels:u,includeOverlays:!1,useCache:!1}),d=o.position;(h.w===0||h.h===0)&&(h={w:s.pstyle("width").pfValue,h:s.pstyle("height").pfValue},h.x1=d.x-h.w/2,h.x2=d.x+h.w/2,h.y1=d.y-h.h/2,h.y2=d.y+h.h/2);function f(A,S,C){var R=0,P=0,M=S+C;return A>0&&M>0&&(R=S/M*A,P=C/M*A),{biasDiff:R,biasComplementDiff:P}}function p(A,S,C,R){if(C.units==="%")switch(R){case"width":return A>0?C.pfValue*A:0;case"height":return S>0?C.pfValue*S:0;case"average":return A>0&&S>0?C.pfValue*(A+S)/2:0;case"min":return A>0&&S>0?A>S?C.pfValue*S:C.pfValue*A:0;case"max":return A>0&&S>0?A>S?C.pfValue*A:C.pfValue*S:0;default:return 0}else return C.units==="px"?C.pfValue:0}var m=c.width.left.value;c.width.left.units==="px"&&c.width.val>0&&(m=m*100/c.width.val);var v=c.width.right.value;c.width.right.units==="px"&&c.width.val>0&&(v=v*100/c.width.val);var g=c.height.top.value;c.height.top.units==="px"&&c.height.val>0&&(g=g*100/c.height.val);var y=c.height.bottom.value;c.height.bottom.units==="px"&&c.height.val>0&&(y=y*100/c.height.val);var _=f(c.width.val-h.w,m,v),x=_.biasDiff,E=_.biasComplementDiff,T=f(c.height.val-h.h,g,y),b=T.biasDiff,w=T.biasComplementDiff;o.autoPadding=p(h.w,h.h,s.pstyle("padding"),s.pstyle("padding-relative-to").value),o.autoWidth=Math.max(h.w,c.width.val),d.x=(-x+h.x1+h.x2+E)/2,o.autoHeight=Math.max(h.h,c.height.val),d.y=(-b+h.y1+h.y2+w)/2}for(var n=0;n<this.length;n++){var i=this[n],a=i._private;(!a.compoundBoundsClean||r)&&(t(i),e.batching()||(a.compoundBoundsClean=!0))}return this};var Zi=function(e){return e===1/0||e===-1/0?0:e},Ta=function(e,t,n,i,a){i-t===0||a-n===0||t==null||n==null||i==null||a==null||(e.x1=t<e.x1?t:e.x1,e.x2=i>e.x2?i:e.x2,e.y1=n<e.y1?n:e.y1,e.y2=a>e.y2?a:e.y2,e.w=e.x2-e.x1,e.h=e.y2-e.y1)},xl=function(e,t){return t==null?e:Ta(e,t.x1,t.y1,t.x2,t.y2)},xh=function(e,t,n){return Qi(e,t,n)},ep=function(e,t,n){if(!t.cy().headless()){var i=t._private,a=i.rstyle,s=a.arrowWidth/2,o=t.pstyle(n+"-arrow-shape").value,l,u;if(o!=="none"){n==="source"?(l=a.srcX,u=a.srcY):n==="target"?(l=a.tgtX,u=a.tgtY):(l=a.midX,u=a.midY);var c=i.arrowBounds=i.arrowBounds||{},h=c[n]=c[n]||{};h.x1=l-s,h.y1=u-s,h.x2=l+s,h.y2=u+s,h.w=h.x2-h.x1,h.h=h.y2-h.y1,fg(h,1),Ta(e,h.x1,h.y1,h.x2,h.y2)}}},s0=function(e,t,n){if(!t.cy().headless()){var i;n?i=n+"-":i="";var a=t._private,s=a.rstyle,o=t.pstyle(i+"label").strValue;if(o){var l=t.pstyle("text-halign"),u=t.pstyle("text-valign"),c=xh(s,"labelWidth",n),h=xh(s,"labelHeight",n),d=xh(s,"labelX",n),f=xh(s,"labelY",n),p=t.pstyle(i+"text-margin-x").pfValue,m=t.pstyle(i+"text-margin-y").pfValue,v=t.isEdge(),g=t.pstyle(i+"text-rotation"),y=t.pstyle("text-outline-width").pfValue,_=t.pstyle("text-border-width").pfValue,x=_/2,E=t.pstyle("text-background-padding").pfValue,T=2,b=h,w=c,A=w/2,S=b/2,C,R,P,M;if(v)C=d-A,R=d+A,P=f-S,M=f+S;else{switch(l.value){case"left":C=d-w,R=d;break;case"center":C=d-A,R=d+A;break;case"right":C=d,R=d+w;break}switch(u.value){case"top":P=f-b,M=f;break;case"center":P=f-S,M=f+S;break;case"bottom":P=f,M=f+b;break}}var N=p-Math.max(y,x)-E-T,D=p+Math.max(y,x)+E+T,I=m-Math.max(y,x)-E-T,L=m+Math.max(y,x)+E+T;C+=N,R+=D,P+=I,M+=L;var z=n||"main",B=a.labelBounds,k=B[z]=B[z]||{};k.x1=C,k.y1=P,k.x2=R,k.y2=M,k.w=R-C,k.h=M-P,k.leftPad=N,k.rightPad=D,k.topPad=I,k.botPad=L;var U=v&&g.strValue==="autorotate",G=g.pfValue!=null&&g.pfValue!==0;if(U||G){var O=U?xh(a.rstyle,"labelAngle",n):g.pfValue,F=Math.cos(O),V=Math.sin(O),$=(C+R)/2,Z=(P+M)/2;if(!v){switch(l.value){case"left":$=R;break;case"right":$=C;break}switch(u.value){case"top":Z=M;break;case"bottom":Z=P;break}}var Y=function(we,pe){return we=we-$,pe=pe-Z,{x:we*F-pe*V+$,y:we*V+pe*F+Z}},X=Y(C,P),K=Y(C,M),se=Y(R,P),oe=Y(R,M);C=Math.min(X.x,K.x,se.x,oe.x),R=Math.max(X.x,K.x,se.x,oe.x),P=Math.min(X.y,K.y,se.y,oe.y),M=Math.max(X.y,K.y,se.y,oe.y)}var W=z+"Rot",Ne=B[W]=B[W]||{};Ne.x1=C,Ne.y1=P,Ne.x2=R,Ne.y2=M,Ne.w=R-C,Ne.h=M-P,Ta(e,C,P,R,M),Ta(a.labelBounds.all,C,P,R,M)}return e}},s6=function(e,t){if(!t.cy().headless()){var n=t.pstyle("outline-opacity").value,i=t.pstyle("outline-width").value;if(n>0&&i>0){var a=t.pstyle("outline-offset").value,s=t.pstyle("shape").value,o=i+a,l=(e.w+o*2)/e.w,u=(e.h+o*2)/e.h,c=0,h=0;["diamond","pentagon","round-triangle"].includes(s)?(l=(e.w+o*2.4)/e.w,h=-o/3.6):["concave-hexagon","rhomboid","right-rhomboid"].includes(s)?l=(e.w+o*2.4)/e.w:s==="star"?(l=(e.w+o*2.8)/e.w,u=(e.h+o*2.6)/e.h,h=-o/3.8):s==="triangle"?(l=(e.w+o*2.8)/e.w,u=(e.h+o*2.4)/e.h,h=-o/1.4):s==="vee"&&(l=(e.w+o*4.4)/e.w,u=(e.h+o*3.8)/e.h,h=-o*.5);var d=e.h*u-e.h,f=e.w*l-e.w;if(dg(e,[Math.ceil(d/2),Math.ceil(f/2)]),c!=0||h!==0){var p=qq(e,c,h);vk(e,p)}}}},o6=function(e,t){var n=e._private.cy,i=n.styleEnabled(),a=n.headless(),s=bi(),o=e._private,l=e.isNode(),u=e.isEdge(),c,h,d,f,p,m,v=o.rstyle,g=l&&i?e.pstyle("bounds-expansion").pfValue:[0],y=function(Be){return Be.pstyle("display").value!=="none"},_=!i||y(e)&&(!u||y(e.source())&&y(e.target()));if(_){var x=0,E=0;i&&t.includeOverlays&&(x=e.pstyle("overlay-opacity").value,x!==0&&(E=e.pstyle("overlay-padding").value));var T=0,b=0;i&&t.includeUnderlays&&(T=e.pstyle("underlay-opacity").value,T!==0&&(b=e.pstyle("underlay-padding").value));var w=Math.max(E,b),A=0,S=0;if(i&&(A=e.pstyle("width").pfValue,S=A/2),l&&t.includeNodes){var C=e.position();p=C.x,m=C.y;var R=e.outerWidth(),P=R/2,M=e.outerHeight(),N=M/2;c=p-P,h=p+P,d=m-N,f=m+N,Ta(s,c,d,h,f),i&&t.includeOutlines&&s6(s,e)}else if(u&&t.includeEdges)if(i&&!a){var D=e.pstyle("curve-style").strValue;if(c=Math.min(v.srcX,v.midX,v.tgtX),h=Math.max(v.srcX,v.midX,v.tgtX),d=Math.min(v.srcY,v.midY,v.tgtY),f=Math.max(v.srcY,v.midY,v.tgtY),c-=S,h+=S,d-=S,f+=S,Ta(s,c,d,h,f),D==="haystack"){var I=v.haystackPts;if(I&&I.length===2){if(c=I[0].x,d=I[0].y,h=I[1].x,f=I[1].y,c>h){var L=c;c=h,h=L}if(d>f){var z=d;d=f,f=z}Ta(s,c-S,d-S,h+S,f+S)}}else if(D==="bezier"||D==="unbundled-bezier"||D.endsWith("segments")||D.endsWith("taxi")){var B;switch(D){case"bezier":case"unbundled-bezier":B=v.bezierPts;break;case"segments":case"taxi":case"round-segments":case"round-taxi":B=v.linePts;break}if(B!=null)for(var k=0;k<B.length;k++){var U=B[k];c=U.x-S,h=U.x+S,d=U.y-S,f=U.y+S,Ta(s,c,d,h,f)}}}else{var G=e.source(),O=G.position(),F=e.target(),V=F.position();if(c=O.x,h=V.x,d=O.y,f=V.y,c>h){var $=c;c=h,h=$}if(d>f){var Z=d;d=f,f=Z}c-=S,h+=S,d-=S,f+=S,Ta(s,c,d,h,f)}if(i&&t.includeEdges&&u&&(ep(s,e,"mid-source"),ep(s,e,"mid-target"),ep(s,e,"source"),ep(s,e,"target")),i){var Y=e.pstyle("ghost").value==="yes";if(Y){var X=e.pstyle("ghost-offset-x").pfValue,K=e.pstyle("ghost-offset-y").pfValue;Ta(s,s.x1+X,s.y1+K,s.x2+X,s.y2+K)}}var se=o.bodyBounds=o.bodyBounds||{};CC(se,s),dg(se,g),fg(se,1),i&&(c=s.x1,h=s.x2,d=s.y1,f=s.y2,Ta(s,c-w,d-w,h+w,f+w));var oe=o.overlayBounds=o.overlayBounds||{};CC(oe,s),dg(oe,g),fg(oe,1);var W=o.labelBounds=o.labelBounds||{};W.all!=null?Wq(W.all):W.all=bi(),i&&t.includeLabels&&(t.includeMainLabels&&s0(s,e,null),u&&(t.includeSourceLabels&&s0(s,e,"source"),t.includeTargetLabels&&s0(s,e,"target")))}return s.x1=Zi(s.x1),s.y1=Zi(s.y1),s.x2=Zi(s.x2),s.y2=Zi(s.y2),s.w=Zi(s.x2-s.x1),s.h=Zi(s.y2-s.y1),s.w>0&&s.h>0&&_&&(dg(s,g),fg(s,1)),s},Vk=function(e){var t=0,n=function(s){return(s?1:0)<<t++},i=0;return i+=n(e.incudeNodes),i+=n(e.includeEdges),i+=n(e.includeLabels),i+=n(e.includeMainLabels),i+=n(e.includeSourceLabels),i+=n(e.includeTargetLabels),i+=n(e.includeOverlays),i+=n(e.includeOutlines),i},Hk=function(e){var t=function(o){return Math.round(o)};if(e.isEdge()){var n=e.source().position(),i=e.target().position();return EC([t(n.x),t(n.y),t(i.x),t(i.y)])}else{var a=e.position();return EC([t(a.x),t(a.y)])}},VR=function(e,t){var n=e._private,i,a=e.isEdge(),s=t==null?HR:Vk(t),o=s===HR;if(n.bbCache==null?(i=o6(e,Nf),n.bbCache=i,n.bbCachePosKey=Hk(e)):i=n.bbCache,!o){var l=e.isNode();i=bi(),(t.includeNodes&&l||t.includeEdges&&!l)&&(t.includeOverlays?xl(i,n.overlayBounds):xl(i,n.bodyBounds)),t.includeLabels&&(t.includeMainLabels&&(!a||t.includeSourceLabels&&t.includeTargetLabels)?xl(i,n.labelBounds.all):(t.includeMainLabels&&xl(i,n.labelBounds.mainRot),t.includeSourceLabels&&xl(i,n.labelBounds.sourceRot),t.includeTargetLabels&&xl(i,n.labelBounds.targetRot))),i.w=i.x2-i.x1,i.h=i.y2-i.y1}return i},Nf={includeNodes:!0,includeEdges:!0,includeLabels:!0,includeMainLabels:!0,includeSourceLabels:!0,includeTargetLabels:!0,includeOverlays:!0,includeUnderlays:!0,includeOutlines:!0,useCache:!0},HR=Vk(Nf),WR=cr(Nf);Qo.boundingBox=function(r){var e,t=r===void 0||r.useCache===void 0||r.useCache===!0,n=_c(function(c){var h=c._private;return h.bbCache==null||h.styleDirty||h.bbCachePosKey!==Hk(c)},function(c){return c.id()});if(t&&this.length===1&&!n(this[0]))r===void 0?r=Nf:r=WR(r),e=VR(this[0],r);else{e=bi(),r=r||Nf;var i=WR(r),a=this,s=a.cy(),o=s.styleEnabled();this.edges().forEach(n),this.nodes().forEach(n),o&&this.recalculateRenderedStyle(t),this.updateCompoundBounds(!t);for(var l=0;l<a.length;l++){var u=a[l];n(u)&&u.dirtyBoundingBoxCache(),xl(e,VR(u,i))}}return e.x1=Zi(e.x1),e.y1=Zi(e.y1),e.x2=Zi(e.x2),e.y2=Zi(e.y2),e.w=Zi(e.x2-e.x1),e.h=Zi(e.y2-e.y1),e};Qo.dirtyBoundingBoxCache=function(){for(var r=0;r<this.length;r++){var e=this[r]._private;e.bbCache=null,e.bbCachePosKey=null,e.bodyBounds=null,e.overlayBounds=null,e.labelBounds.all=null,e.labelBounds.source=null,e.labelBounds.target=null,e.labelBounds.main=null,e.labelBounds.sourceRot=null,e.labelBounds.targetRot=null,e.labelBounds.mainRot=null,e.arrowBounds.source=null,e.arrowBounds.target=null,e.arrowBounds["mid-source"]=null,e.arrowBounds["mid-target"]=null}return this.emitAndNotify("bounds"),this};Qo.boundingBoxAt=function(r){var e=this.nodes(),t=this.cy(),n=t.hasCompoundNodes(),i=t.collection();if(n&&(i=e.filter(function(u){return u.isParent()}),e=e.not(i)),$t(r)){var a=r;r=function(){return a}}var s=function(c,h){return c._private.bbAtOldPos=r(c,h)},o=function(c){return c._private.bbAtOldPos};t.startBatch(),e.forEach(s).silentPositions(r),n&&(i.dirtyCompoundBoundsCache(),i.dirtyBoundingBoxCache(),i.updateCompoundBounds(!0));var l=Hq(this.boundingBox({useCache:!1}));return e.silentPositions(o),n&&(i.dirtyCompoundBoundsCache(),i.dirtyBoundingBoxCache(),i.updateCompoundBounds(!0)),t.endBatch(),l};cc.boundingbox=cc.bb=cc.boundingBox;cc.renderedBoundingbox=cc.renderedBoundingBox;var l6=Qo,Zh,_d;Zh=_d={};var Wk=function(e){e.uppercaseName=oC(e.name),e.autoName="auto"+e.uppercaseName,e.labelName="label"+e.uppercaseName,e.outerName="outer"+e.uppercaseName,e.uppercaseOuterName=oC(e.outerName),Zh[e.name]=function(){var n=this[0],i=n._private,a=i.cy,s=a._private.styleEnabled;if(n)if(s){if(n.isParent())return n.updateCompoundBounds(),i[e.autoName]||0;var o=n.pstyle(e.name);switch(o.strValue){case"label":return n.recalculateRenderedStyle(),i.rstyle[e.labelName]||0;default:return o.pfValue}}else return 1},Zh["outer"+e.uppercaseName]=function(){var n=this[0],i=n._private,a=i.cy,s=a._private.styleEnabled;if(n)if(s){var o=n[e.name](),l=n.pstyle("border-width").pfValue,u=2*n.padding();return o+l+u}else return 1},Zh["rendered"+e.uppercaseName]=function(){var n=this[0];if(n){var i=n[e.name]();return i*this.cy().zoom()}},Zh["rendered"+e.uppercaseOuterName]=function(){var n=this[0];if(n){var i=n[e.outerName]();return i*this.cy().zoom()}}};Wk({name:"width"});Wk({name:"height"});_d.padding=function(){var r=this[0],e=r._private;return r.isParent()?(r.updateCompoundBounds(),e.autoPadding!==void 0?e.autoPadding:r.pstyle("padding").pfValue):r.pstyle("padding").pfValue};_d.paddedHeight=function(){var r=this[0];return r.height()+2*r.padding()};_d.paddedWidth=function(){var r=this[0];return r.width()+2*r.padding()};var u6=_d,c6=function(e,t){if(e.isEdge()&&e.takesUpSpace())return t(e)},h6=function(e,t){if(e.isEdge()&&e.takesUpSpace()){var n=e.cy();return Tv(t(e),n.zoom(),n.pan())}},f6=function(e,t){if(e.isEdge()&&e.takesUpSpace()){var n=e.cy(),i=n.pan(),a=n.zoom();return t(e).map(function(s){return Tv(s,a,i)})}},d6=function(e){return e.renderer().getControlPoints(e)},p6=function(e){return e.renderer().getSegmentPoints(e)},g6=function(e){return e.renderer().getSourceEndpoint(e)},v6=function(e){return e.renderer().getTargetEndpoint(e)},m6=function(e){return e.renderer().getEdgeMidpoint(e)},qR={controlPoints:{get:d6,mult:!0},segmentPoints:{get:p6,mult:!0},sourceEndpoint:{get:g6},targetEndpoint:{get:v6},midpoint:{get:m6}},y6=function(e){return"rendered"+e[0].toUpperCase()+e.substr(1)},_6=Object.keys(qR).reduce(function(r,e){var t=qR[e],n=y6(e);return r[e]=function(){return c6(this,t.get)},t.mult?r[n]=function(){return f6(this,t.get)}:r[n]=function(){return h6(this,t.get)},r},{}),x6=mt({},a6,l6,u6,_6);/*!
Event object based on jQuery events, MIT license

https://jquery.org/license/
https://tldrlegal.com/license/mit-license
https://github.com/jquery/jquery/blob/master/src/event.js
*/var qk=function(e,t){this.recycle(e,t)};function bh(){return!1}function tp(){return!0}qk.prototype={instanceString:function(){return"event"},recycle:function(e,t){if(this.isImmediatePropagationStopped=this.isPropagationStopped=this.isDefaultPrevented=bh,e!=null&&e.preventDefault?(this.type=e.type,this.isDefaultPrevented=e.defaultPrevented?tp:bh):e!=null&&e.type?t=e:this.type=e,t!=null&&(this.originalEvent=t.originalEvent,this.type=t.type!=null?t.type:this.type,this.cy=t.cy,this.target=t.target,this.position=t.position,this.renderedPosition=t.renderedPosition,this.namespace=t.namespace,this.layout=t.layout),this.cy!=null&&this.position!=null&&this.renderedPosition==null){var n=this.position,i=this.cy.zoom(),a=this.cy.pan();this.renderedPosition={x:n.x*i+a.x,y:n.y*i+a.y}}this.timeStamp=e&&e.timeStamp||Date.now()},preventDefault:function(){this.isDefaultPrevented=tp;var e=this.originalEvent;!e||e.preventDefault&&e.preventDefault()},stopPropagation:function(){this.isPropagationStopped=tp;var e=this.originalEvent;!e||e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=tp,this.stopPropagation()},isDefaultPrevented:bh,isPropagationStopped:bh,isImmediatePropagationStopped:bh};var $k=/^([^.]+)(\.(?:[^.]+))?$/,b6=".*",Xk={qualifierCompare:function(e,t){return e===t},eventMatches:function(){return!0},addEventFields:function(){},callbackContext:function(e){return e},beforeEmit:function(){},afterEmit:function(){},bubble:function(){return!1},parent:function(){return null},context:null},$R=Object.keys(Xk),E6={};function Nv(){for(var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:E6,e=arguments.length>1?arguments[1]:void 0,t=0;t<$R.length;t++){var n=$R[t];this[n]=r[n]||Xk[n]}this.context=e||this.context,this.listeners=[],this.emitting=0}var Vo=Nv.prototype,Yk=function(e,t,n,i,a,s,o){Pn(i)&&(a=i,i=null),o&&(s==null?s=o:s=mt({},s,o));for(var l=fn(n)?n:n.split(/\s+/),u=0;u<l.length;u++){var c=l[u];if(!Bo(c)){var h=c.match($k);if(h){var d=h[1],f=h[2]?h[2]:null,p=t(e,c,d,f,i,a,s);if(p===!1)break}}}},XR=function(e,t){return e.addEventFields(e.context,t),new qk(t.type,t)},T6=function(e,t,n){if(IW(n)){t(e,n);return}else if($t(n)){t(e,XR(e,n));return}for(var i=fn(n)?n:n.split(/\s+/),a=0;a<i.length;a++){var s=i[a];if(!Bo(s)){var o=s.match($k);if(o){var l=o[1],u=o[2]?o[2]:null,c=XR(e,{type:l,namespace:u,target:e.context});t(e,c)}}}};Vo.on=Vo.addListener=function(r,e,t,n,i){return Yk(this,function(a,s,o,l,u,c,h){Pn(c)&&a.listeners.push({event:s,callback:c,type:o,namespace:l,qualifier:u,conf:h})},r,e,t,n,i),this};Vo.one=function(r,e,t,n){return this.on(r,e,t,n,{one:!0})};Vo.removeListener=Vo.off=function(r,e,t,n){var i=this;this.emitting!==0&&(this.listeners=dq(this.listeners));for(var a=this.listeners,s=function(u){var c=a[u];Yk(i,function(h,d,f,p,m,v){if((c.type===f||r==="*")&&(!p&&c.namespace!==".*"||c.namespace===p)&&(!m||h.qualifierCompare(c.qualifier,m))&&(!v||c.callback===v))return a.splice(u,1),!1},r,e,t,n)},o=a.length-1;o>=0;o--)s(o);return this};Vo.removeAllListeners=function(){return this.removeListener("*")};Vo.emit=Vo.trigger=function(r,e,t){var n=this.listeners,i=n.length;return this.emitting++,fn(e)||(e=[e]),T6(this,function(a,s){t!=null&&(n=[{event:s.event,type:s.type,namespace:s.namespace,callback:t}],i=n.length);for(var o=function(){var c=n[l];if(c.type===s.type&&(!c.namespace||c.namespace===s.namespace||c.namespace===b6)&&a.eventMatches(a.context,c,s)){var h=[s];e!=null&&gq(h,e),a.beforeEmit(a.context,c,s),c.conf&&c.conf.one&&(a.listeners=a.listeners.filter(function(p){return p!==c}));var d=a.callbackContext(a.context,c,s),f=c.callback.apply(d,h);a.afterEmit(a.context,c,s),f===!1&&(s.stopPropagation(),s.preventDefault())}},l=0;l<i;l++)o();a.bubble(a.context)&&!s.isPropagationStopped()&&a.parent(a.context).emit(s,e)},r),this.emitting--,this};var w6={qualifierCompare:function(e,t){return e==null||t==null?e==null&&t==null:e.sameText(t)},eventMatches:function(e,t,n){var i=t.qualifier;return i!=null?e!==n.target&&dd(n.target)&&i.matches(n.target):!0},addEventFields:function(e,t){t.cy=e.cy(),t.target=e},callbackContext:function(e,t,n){return t.qualifier!=null?n.target:e},beforeEmit:function(e,t){t.conf&&t.conf.once&&t.conf.onceCollection.removeListener(t.event,t.qualifier,t.callback)},bubble:function(){return!0},parent:function(e){return e.isChild()?e.parent():e.cy()}},np=function(e){return dt(e)?new Go(e):e},jk={createEmitter:function(){for(var e=0;e<this.length;e++){var t=this[e],n=t._private;n.emitter||(n.emitter=new Nv(w6,t))}return this},emitter:function(){return this._private.emitter},on:function(e,t,n){for(var i=np(t),a=0;a<this.length;a++){var s=this[a];s.emitter().on(e,i,n)}return this},removeListener:function(e,t,n){for(var i=np(t),a=0;a<this.length;a++){var s=this[a];s.emitter().removeListener(e,i,n)}return this},removeAllListeners:function(){for(var e=0;e<this.length;e++){var t=this[e];t.emitter().removeAllListeners()}return this},one:function(e,t,n){for(var i=np(t),a=0;a<this.length;a++){var s=this[a];s.emitter().one(e,i,n)}return this},once:function(e,t,n){for(var i=np(t),a=0;a<this.length;a++){var s=this[a];s.emitter().on(e,i,n,{once:!0,onceCollection:this})}},emit:function(e,t){for(var n=0;n<this.length;n++){var i=this[n];i.emitter().emit(e,t)}return this},emitAndNotify:function(e,t){if(this.length!==0)return this.cy().notify(e,this),this.emit(e,t),this}};tn.eventAliasesOn(jk);var Kk={nodes:function(e){return this.filter(function(t){return t.isNode()}).filter(e)},edges:function(e){return this.filter(function(t){return t.isEdge()}).filter(e)},byGroup:function(){for(var e=this.spawn(),t=this.spawn(),n=0;n<this.length;n++){var i=this[n];i.isNode()?e.push(i):t.push(i)}return{nodes:e,edges:t}},filter:function(e,t){if(e===void 0)return this;if(dt(e)||ki(e))return new Go(e).filter(this);if(Pn(e)){for(var n=this.spawn(),i=this,a=0;a<i.length;a++){var s=i[a],o=t?e.apply(t,[s,a,i]):e(s,a,i);o&&n.push(s)}return n}return this.spawn()},not:function(e){if(e){dt(e)&&(e=this.filter(e));for(var t=this.spawn(),n=0;n<this.length;n++){var i=this[n],a=e.has(i);a||t.push(i)}return t}else return this},absoluteComplement:function(){var e=this.cy();return e.mutableElements().not(this)},intersect:function(e){if(dt(e)){var t=e;return this.filter(t)}for(var n=this.spawn(),i=this,a=e,s=this.length<e.length,o=s?i:a,l=s?a:i,u=0;u<o.length;u++){var c=o[u];l.has(c)&&n.push(c)}return n},xor:function(e){var t=this._private.cy;dt(e)&&(e=t.$(e));var n=this.spawn(),i=this,a=e,s=function(l,u){for(var c=0;c<l.length;c++){var h=l[c],d=h._private.data.id,f=u.hasElementWithId(d);f||n.push(h)}};return s(i,a),s(a,i),n},diff:function(e){var t=this._private.cy;dt(e)&&(e=t.$(e));var n=this.spawn(),i=this.spawn(),a=this.spawn(),s=this,o=e,l=function(c,h,d){for(var f=0;f<c.length;f++){var p=c[f],m=p._private.data.id,v=h.hasElementWithId(m);v?a.merge(p):d.push(p)}};return l(s,o,n),l(o,s,i),{left:n,right:i,both:a}},add:function(e){var t=this._private.cy;if(!e)return this;if(dt(e)){var n=e;e=t.mutableElements().filter(n)}for(var i=this.spawnSelf(),a=0;a<e.length;a++){var s=e[a],o=!this.has(s);o&&i.push(s)}return i},merge:function(e){var t=this._private,n=t.cy;if(!e)return this;if(e&&dt(e)){var i=e;e=n.mutableElements().filter(i)}for(var a=t.map,s=0;s<e.length;s++){var o=e[s],l=o._private.data.id,u=!a.has(l);if(u){var c=this.length++;this[c]=o,a.set(l,{ele:o,index:c})}}return this},unmergeAt:function(e){var t=this[e],n=t.id(),i=this._private,a=i.map;this[e]=void 0,a.delete(n);var s=e===this.length-1;if(this.length>1&&!s){var o=this.length-1,l=this[o],u=l._private.data.id;this[o]=void 0,this[e]=l,a.set(u,{ele:l,index:e})}return this.length--,this},unmergeOne:function(e){e=e[0];var t=this._private,n=e._private.data.id,i=t.map,a=i.get(n);if(!a)return this;var s=a.index;return this.unmergeAt(s),this},unmerge:function(e){var t=this._private.cy;if(!e)return this;if(e&&dt(e)){var n=e;e=t.mutableElements().filter(n)}for(var i=0;i<e.length;i++)this.unmergeOne(e[i]);return this},unmergeBy:function(e){for(var t=this.length-1;t>=0;t--){var n=this[t];e(n)&&this.unmergeAt(t)}return this},map:function(e,t){for(var n=[],i=this,a=0;a<i.length;a++){var s=i[a],o=t?e.apply(t,[s,a,i]):e(s,a,i);n.push(o)}return n},reduce:function(e,t){for(var n=t,i=this,a=0;a<i.length;a++)n=e(n,i[a],a,i);return n},max:function(e,t){for(var n=-1/0,i,a=this,s=0;s<a.length;s++){var o=a[s],l=t?e.apply(t,[o,s,a]):e(o,s,a);l>n&&(n=l,i=o)}return{value:n,ele:i}},min:function(e,t){for(var n=1/0,i,a=this,s=0;s<a.length;s++){var o=a[s],l=t?e.apply(t,[o,s,a]):e(o,s,a);l<n&&(n=l,i=o)}return{value:n,ele:i}}},jt=Kk;jt.u=jt["|"]=jt["+"]=jt.union=jt.or=jt.add;jt["\\"]=jt["!"]=jt["-"]=jt.difference=jt.relativeComplement=jt.subtract=jt.not;jt.n=jt["&"]=jt["."]=jt.and=jt.intersection=jt.intersect;jt["^"]=jt["(+)"]=jt["(-)"]=jt.symmetricDifference=jt.symdiff=jt.xor;jt.fnFilter=jt.filterFn=jt.stdFilter=jt.filter;jt.complement=jt.abscomp=jt.absoluteComplement;var S6={isNode:function(){return this.group()==="nodes"},isEdge:function(){return this.group()==="edges"},isLoop:function(){return this.isEdge()&&this.source()[0]===this.target()[0]},isSimple:function(){return this.isEdge()&&this.source()[0]!==this.target()[0]},group:function(){var e=this[0];if(e)return e._private.group}},Qk=function(e,t){var n=e.cy(),i=n.hasCompoundNodes();function a(c){var h=c.pstyle("z-compound-depth");return h.value==="auto"?i?c.zDepth():0:h.value==="bottom"?-1:h.value==="top"?IS:0}var s=a(e)-a(t);if(s!==0)return s;function o(c){var h=c.pstyle("z-index-compare");return h.value==="auto"&&c.isNode()?1:0}var l=o(e)-o(t);if(l!==0)return l;var u=e.pstyle("z-index").value-t.pstyle("z-index").value;return u!==0?u:e.poolIndex()-t.poolIndex()},Hg={forEach:function(e,t){if(Pn(e))for(var n=this.length,i=0;i<n;i++){var a=this[i],s=t?e.apply(t,[a,i,this]):e(a,i,this);if(s===!1)break}return this},toArray:function(){for(var e=[],t=0;t<this.length;t++)e.push(this[t]);return e},slice:function(e,t){var n=[],i=this.length;t==null&&(t=i),e==null&&(e=0),e<0&&(e=i+e),t<0&&(t=i+t);for(var a=e;a>=0&&a<t&&a<i;a++)n.push(this[a]);return this.spawn(n)},size:function(){return this.length},eq:function(e){return this[e]||this.spawn()},first:function(){return this[0]||this.spawn()},last:function(){return this[this.length-1]||this.spawn()},empty:function(){return this.length===0},nonempty:function(){return!this.empty()},sort:function(e){if(!Pn(e))return this;var t=this.toArray().sort(e);return this.spawn(t)},sortByZIndex:function(){return this.sort(Qk)},zDepth:function(){var e=this[0];if(!!e){var t=e._private,n=t.group;if(n==="nodes"){var i=t.data.parent?e.parents().size():0;return e.isParent()?i:IS-1}else{var a=t.source,s=t.target,o=a.zDepth(),l=s.zDepth();return Math.max(o,l,0)}}}};Hg.each=Hg.forEach;var A6=function(){var e="undefined",t=(typeof Symbol>"u"?"undefined":sr(Symbol))!=e&&sr(Symbol.iterator)!=e;t&&(Hg[Symbol.iterator]=function(){var n=this,i={value:void 0,done:!1},a=0,s=this.length;return YU({next:function(){return a<s?i.value=n[a++]:(i.value=void 0,i.done=!0),i}},Symbol.iterator,function(){return this})})};A6();var M6=cr({nodeDimensionsIncludeLabels:!1}),gg={layoutDimensions:function(e){e=M6(e);var t;if(!this.takesUpSpace())t={w:0,h:0};else if(e.nodeDimensionsIncludeLabels){var n=this.boundingBox();t={w:n.w,h:n.h}}else t={w:this.outerWidth(),h:this.outerHeight()};return(t.w===0||t.h===0)&&(t.w=t.h=1),t},layoutPositions:function(e,t,n){var i=this.nodes().filter(function(E){return!E.isParent()}),a=this.cy(),s=t.eles,o=function(T){return T.id()},l=_c(n,o);e.emit({type:"layoutstart",layout:e}),e.animations=[];var u=function(T,b,w){var A={x:b.x1+b.w/2,y:b.y1+b.h/2},S={x:(w.x-A.x)*T,y:(w.y-A.y)*T};return{x:A.x+S.x,y:A.y+S.y}},c=t.spacingFactor&&t.spacingFactor!==1,h=function(){if(!c)return null;for(var T=bi(),b=0;b<i.length;b++){var w=i[b],A=l(w,b);$q(T,A.x,A.y)}return T},d=h(),f=_c(function(E,T){var b=l(E,T);if(c){var w=Math.abs(t.spacingFactor);b=u(w,d,b)}return t.transform!=null&&(b=t.transform(E,b)),b},o);if(t.animate){for(var p=0;p<i.length;p++){var m=i[p],v=f(m,p),g=t.animateFilter==null||t.animateFilter(m,p);if(g){var y=m.animation({position:v,duration:t.animationDuration,easing:t.animationEasing});e.animations.push(y)}else m.position(v)}if(t.fit){var _=a.animation({fit:{boundingBox:s.boundingBoxAt(f),padding:t.padding},duration:t.animationDuration,easing:t.animationEasing});e.animations.push(_)}else if(t.zoom!==void 0&&t.pan!==void 0){var x=a.animation({zoom:t.zoom,pan:t.pan,duration:t.animationDuration,easing:t.animationEasing});e.animations.push(x)}e.animations.forEach(function(E){return E.play()}),e.one("layoutready",t.ready),e.emit({type:"layoutready",layout:e}),Kc.all(e.animations.map(function(E){return E.promise()})).then(function(){e.one("layoutstop",t.stop),e.emit({type:"layoutstop",layout:e})})}else i.positions(f),t.fit&&a.fit(t.eles,t.padding),t.zoom!=null&&a.zoom(t.zoom),t.pan&&a.pan(t.pan),e.one("layoutready",t.ready),e.emit({type:"layoutready",layout:e}),e.one("layoutstop",t.stop),e.emit({type:"layoutstop",layout:e});return this},layout:function(e){var t=this.cy();return t.makeLayout(mt({},e,{eles:this}))}};gg.createLayout=gg.makeLayout=gg.layout;function Zk(r,e,t){var n=t._private,i=n.styleCache=n.styleCache||[],a;return(a=i[r])!=null||(a=i[r]=e(t)),a}function Pv(r,e){return r=Uo(r),function(n){return Zk(r,e,n)}}function Dv(r,e){r=Uo(r);var t=function(i){return e.call(i)};return function(){var i=this[0];if(i)return Zk(r,t,i)}}var Mr={recalculateRenderedStyle:function(e){var t=this.cy(),n=t.renderer(),i=t.styleEnabled();return n&&i&&n.recalculateRenderedStyle(this,e),this},dirtyStyleCache:function(){var e=this.cy(),t=function(a){return a._private.styleCache=null};if(e.hasCompoundNodes()){var n;n=this.spawnSelf().merge(this.descendants()).merge(this.parents()),n.merge(n.connectedEdges()),n.forEach(t)}else this.forEach(function(i){t(i),i.connectedEdges().forEach(t)});return this},updateStyle:function(e){var t=this._private.cy;if(!t.styleEnabled())return this;if(t.batching()){var n=t._private.batchStyleEles;return n.merge(this),this}var i=t.hasCompoundNodes(),a=this;e=!!(e||e===void 0),i&&(a=this.spawnSelf().merge(this.descendants()).merge(this.parents()));var s=a;return e?s.emitAndNotify("style"):s.emit("style"),a.forEach(function(o){return o._private.styleDirty=!0}),this},cleanStyle:function(){var e=this.cy();if(!!e.styleEnabled())for(var t=0;t<this.length;t++){var n=this[t];n._private.styleDirty&&(n._private.styleDirty=!1,e.style().apply(n))}},parsedStyle:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=this[0],i=n.cy();if(!!i.styleEnabled()&&n){n._private.styleDirty&&(n._private.styleDirty=!1,i.style().apply(n));var a=n._private.style[e];return a!=null?a:t?i.style().getDefaultProperty(e):null}},numericStyle:function(e){var t=this[0];if(!!t.cy().styleEnabled()&&t){var n=t.pstyle(e);return n.pfValue!==void 0?n.pfValue:n.value}},numericStyleUnits:function(e){var t=this[0];if(!!t.cy().styleEnabled()&&t)return t.pstyle(e).units},renderedStyle:function(e){var t=this.cy();if(!t.styleEnabled())return this;var n=this[0];if(n)return t.style().getRenderedStyle(n,e)},style:function(e,t){var n=this.cy();if(!n.styleEnabled())return this;var i=!1,a=n.style();if($t(e)){var s=e;a.applyBypass(this,s,i),this.emitAndNotify("style")}else if(dt(e))if(t===void 0){var o=this[0];return o?a.getStylePropertyValue(o,e):void 0}else a.applyBypass(this,e,t,i),this.emitAndNotify("style");else if(e===void 0){var l=this[0];return l?a.getRawStyle(l):void 0}return this},removeStyle:function(e){var t=this.cy();if(!t.styleEnabled())return this;var n=!1,i=t.style(),a=this;if(e===void 0)for(var s=0;s<a.length;s++){var o=a[s];i.removeAllBypasses(o,n)}else{e=e.split(/\s+/);for(var l=0;l<a.length;l++){var u=a[l];i.removeBypasses(u,e,n)}}return this.emitAndNotify("style"),this},show:function(){return this.css("display","element"),this},hide:function(){return this.css("display","none"),this},effectiveOpacity:function(){var e=this.cy();if(!e.styleEnabled())return 1;var t=e.hasCompoundNodes(),n=this[0];if(n){var i=n._private,a=n.pstyle("opacity").value;if(!t)return a;var s=i.data.parent?n.parents():null;if(s)for(var o=0;o<s.length;o++){var l=s[o],u=l.pstyle("opacity").value;a=u*a}return a}},transparent:function(){var e=this.cy();if(!e.styleEnabled())return!1;var t=this[0],n=t.cy().hasCompoundNodes();if(t)return n?t.effectiveOpacity()===0:t.pstyle("opacity").value===0},backgrounding:function(){var e=this.cy();if(!e.styleEnabled())return!1;var t=this[0];return!!t._private.backgrounding}};function o0(r,e){var t=r._private,n=t.data.parent?r.parents():null;if(n)for(var i=0;i<n.length;i++){var a=n[i];if(!e(a))return!1}return!0}function qS(r){var e=r.ok,t=r.edgeOkViaNode||r.ok,n=r.parentOk||r.ok;return function(){var i=this.cy();if(!i.styleEnabled())return!0;var a=this[0],s=i.hasCompoundNodes();if(a){var o=a._private;if(!e(a))return!1;if(a.isNode())return!s||o0(a,n);var l=o.source,u=o.target;return t(l)&&(!s||o0(l,t))&&(l===u||t(u)&&(!s||o0(u,t)))}}}var Qc=Pv("eleTakesUpSpace",function(r){return r.pstyle("display").value==="element"&&r.width()!==0&&(r.isNode()?r.height()!==0:!0)});Mr.takesUpSpace=Dv("takesUpSpace",qS({ok:Qc}));var C6=Pv("eleInteractive",function(r){return r.pstyle("events").value==="yes"&&r.pstyle("visibility").value==="visible"&&Qc(r)}),R6=Pv("parentInteractive",function(r){return r.pstyle("visibility").value==="visible"&&Qc(r)});Mr.interactive=Dv("interactive",qS({ok:C6,parentOk:R6,edgeOkViaNode:Qc}));Mr.noninteractive=function(){var r=this[0];if(r)return!r.interactive()};var N6=Pv("eleVisible",function(r){return r.pstyle("visibility").value==="visible"&&r.pstyle("opacity").pfValue!==0&&Qc(r)}),P6=Qc;Mr.visible=Dv("visible",qS({ok:N6,edgeOkViaNode:P6}));Mr.hidden=function(){var r=this[0];if(r)return!r.visible()};Mr.isBundledBezier=Dv("isBundledBezier",function(){return this.cy().styleEnabled()?!this.removed()&&this.pstyle("curve-style").value==="bezier"&&this.takesUpSpace():!1});Mr.bypass=Mr.css=Mr.style;Mr.renderedCss=Mr.renderedStyle;Mr.removeBypass=Mr.removeCss=Mr.removeStyle;Mr.pstyle=Mr.parsedStyle;var No={};function YR(r){return function(){var e=arguments,t=[];if(e.length===2){var n=e[0],i=e[1];this.on(r.event,n,i)}else if(e.length===1&&Pn(e[0])){var a=e[0];this.on(r.event,a)}else if(e.length===0||e.length===1&&fn(e[0])){for(var s=e.length===1?e[0]:null,o=0;o<this.length;o++){var l=this[o],u=!r.ableField||l._private[r.ableField],c=l._private[r.field]!=r.value;if(r.overrideAble){var h=r.overrideAble(l);if(h!==void 0&&(u=h,!h))return this}u&&(l._private[r.field]=r.value,c&&t.push(l))}var d=this.spawn(t);d.updateStyle(),d.emit(r.event),s&&d.emit(s)}return this}}function Zc(r){No[r.field]=function(){var e=this[0];if(e){if(r.overrideField){var t=r.overrideField(e);if(t!==void 0)return t}return e._private[r.field]}},No[r.on]=YR({event:r.on,field:r.field,ableField:r.ableField,overrideAble:r.overrideAble,value:!0}),No[r.off]=YR({event:r.off,field:r.field,ableField:r.ableField,overrideAble:r.overrideAble,value:!1})}Zc({field:"locked",overrideField:function(e){return e.cy().autolock()?!0:void 0},on:"lock",off:"unlock"});Zc({field:"grabbable",overrideField:function(e){return e.cy().autoungrabify()||e.pannable()?!1:void 0},on:"grabify",off:"ungrabify"});Zc({field:"selected",ableField:"selectable",overrideAble:function(e){return e.cy().autounselectify()?!1:void 0},on:"select",off:"unselect"});Zc({field:"selectable",overrideField:function(e){return e.cy().autounselectify()?!1:void 0},on:"selectify",off:"unselectify"});No.deselect=No.unselect;No.grabbed=function(){var r=this[0];if(r)return r._private.grabbed};Zc({field:"active",on:"activate",off:"unactivate"});Zc({field:"pannable",on:"panify",off:"unpanify"});No.inactive=function(){var r=this[0];if(r)return!r._private.active};var Gr={},jR=function(e){return function(n){for(var i=this,a=[],s=0;s<i.length;s++){var o=i[s];if(!!o.isNode()){for(var l=!1,u=o.connectedEdges(),c=0;c<u.length;c++){var h=u[c],d=h.source(),f=h.target();if(e.noIncomingEdges&&f===o&&d!==o||e.noOutgoingEdges&&d===o&&f!==o){l=!0;break}}l||a.push(o)}}return this.spawn(a,!0).filter(n)}},KR=function(e){return function(t){for(var n=this,i=[],a=0;a<n.length;a++){var s=n[a];if(!!s.isNode())for(var o=s.connectedEdges(),l=0;l<o.length;l++){var u=o[l],c=u.source(),h=u.target();e.outgoing&&c===s?(i.push(u),i.push(h)):e.incoming&&h===s&&(i.push(u),i.push(c))}}return this.spawn(i,!0).filter(t)}},QR=function(e){return function(t){for(var n=this,i=[],a={};;){var s=e.outgoing?n.outgoers():n.incomers();if(s.length===0)break;for(var o=!1,l=0;l<s.length;l++){var u=s[l],c=u.id();a[c]||(a[c]=!0,i.push(u),o=!0)}if(!o)break;n=s}return this.spawn(i,!0).filter(t)}};Gr.clearTraversalCache=function(){for(var r=0;r<this.length;r++)this[r]._private.traversalCache=null};mt(Gr,{roots:jR({noIncomingEdges:!0}),leaves:jR({noOutgoingEdges:!0}),outgoers:na(KR({outgoing:!0}),"outgoers"),successors:QR({outgoing:!0}),incomers:na(KR({incoming:!0}),"incomers"),predecessors:QR({})});mt(Gr,{neighborhood:na(function(r){for(var e=[],t=this.nodes(),n=0;n<t.length;n++)for(var i=t[n],a=i.connectedEdges(),s=0;s<a.length;s++){var o=a[s],l=o.source(),u=o.target(),c=i===l?u:l;c.length>0&&e.push(c[0]),e.push(o[0])}return this.spawn(e,!0).filter(r)},"neighborhood"),closedNeighborhood:function(e){return this.neighborhood().add(this).filter(e)},openNeighborhood:function(e){return this.neighborhood(e)}});Gr.neighbourhood=Gr.neighborhood;Gr.closedNeighbourhood=Gr.closedNeighborhood;Gr.openNeighbourhood=Gr.openNeighborhood;mt(Gr,{source:na(function(e){var t=this[0],n;return t&&(n=t._private.source||t.cy().collection()),n&&e?n.filter(e):n},"source"),target:na(function(e){var t=this[0],n;return t&&(n=t._private.target||t.cy().collection()),n&&e?n.filter(e):n},"target"),sources:ZR({attr:"source"}),targets:ZR({attr:"target"})});function ZR(r){return function(t){for(var n=[],i=0;i<this.length;i++){var a=this[i],s=a._private[r.attr];s&&n.push(s)}return this.spawn(n,!0).filter(t)}}mt(Gr,{edgesWith:na(JR(),"edgesWith"),edgesTo:na(JR({thisIsSrc:!0}),"edgesTo")});function JR(r){return function(t){var n=[],i=this._private.cy,a=r||{};dt(t)&&(t=i.$(t));for(var s=0;s<t.length;s++)for(var o=t[s]._private.edges,l=0;l<o.length;l++){var u=o[l],c=u._private.data,h=this.hasElementWithId(c.source)&&t.hasElementWithId(c.target),d=t.hasElementWithId(c.source)&&this.hasElementWithId(c.target),f=h||d;!f||(a.thisIsSrc||a.thisIsTgt)&&(a.thisIsSrc&&!h||a.thisIsTgt&&!d)||n.push(u)}return this.spawn(n,!0)}}mt(Gr,{connectedEdges:na(function(r){for(var e=[],t=this,n=0;n<t.length;n++){var i=t[n];if(!!i.isNode())for(var a=i._private.edges,s=0;s<a.length;s++){var o=a[s];e.push(o)}}return this.spawn(e,!0).filter(r)},"connectedEdges"),connectedNodes:na(function(r){for(var e=[],t=this,n=0;n<t.length;n++){var i=t[n];!i.isEdge()||(e.push(i.source()[0]),e.push(i.target()[0]))}return this.spawn(e,!0).filter(r)},"connectedNodes"),parallelEdges:na(eN(),"parallelEdges"),codirectedEdges:na(eN({codirected:!0}),"codirectedEdges")});function eN(r){var e={codirected:!1};return r=mt({},e,r),function(n){for(var i=[],a=this.edges(),s=r,o=0;o<a.length;o++)for(var l=a[o],u=l._private,c=u.source,h=c._private.data.id,d=u.data.target,f=c._private.edges,p=0;p<f.length;p++){var m=f[p],v=m._private.data,g=v.target,y=v.source,_=g===d&&y===h,x=h===g&&d===y;(s.codirected&&_||!s.codirected&&(_||x))&&i.push(m)}return this.spawn(i,!0).filter(n)}}mt(Gr,{components:function(e){var t=this,n=t.cy(),i=n.collection(),a=e==null?t.nodes():e.nodes(),s=[];e!=null&&a.empty()&&(a=e.sources());var o=function(c,h){i.merge(c),a.unmerge(c),h.merge(c)};if(a.empty())return t.spawn();var l=function(){var c=n.collection();s.push(c);var h=a[0];o(h,c),t.bfs({directed:!1,roots:h,visit:function(f){return o(f,c)}}),c.forEach(function(d){d.connectedEdges().forEach(function(f){t.has(f)&&c.has(f.source())&&c.has(f.target())&&c.merge(f)})})};do l();while(a.length>0);return s},component:function(){var e=this[0];return e.cy().mutableElements().components(e)[0]}});Gr.componentsOf=Gr.components;var Cr=function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e===void 0){Nn("A collection must have a reference to the core");return}var a=new Os,s=!1;if(!t)t=[];else if(t.length>0&&$t(t[0])&&!dd(t[0])){s=!0;for(var o=[],l=new jc,u=0,c=t.length;u<c;u++){var h=t[u];h.data==null&&(h.data={});var d=h.data;if(d.id==null)d.id=fk();else if(e.hasElementWithId(d.id)||l.has(d.id))continue;var f=new Ev(e,h,!1);o.push(f),l.add(d.id)}t=o}this.length=0;for(var p=0,m=t.length;p<m;p++){var v=t[p][0];if(v!=null){var g=v._private.data.id;(!n||!a.has(g))&&(n&&a.set(g,{index:this.length,ele:v}),this[this.length]=v,this.length++)}}this._private={eles:this,cy:e,get map(){return this.lazyMap==null&&this.rebuildMap(),this.lazyMap},set map(y){this.lazyMap=y},rebuildMap:function(){for(var _=this.lazyMap=new Os,x=this.eles,E=0;E<x.length;E++){var T=x[E];_.set(T.id(),{index:E,ele:T})}}},n&&(this._private.map=a),s&&!i&&this.restore()},yn=Ev.prototype=Cr.prototype=Object.create(Array.prototype);yn.instanceString=function(){return"collection"};yn.spawn=function(r,e){return new Cr(this.cy(),r,e)};yn.spawnSelf=function(){return this.spawn(this)};yn.cy=function(){return this._private.cy};yn.renderer=function(){return this._private.cy.renderer()};yn.element=function(){return this[0]};yn.collection=function(){return ZU(this)?this:new Cr(this._private.cy,[this])};yn.unique=function(){return new Cr(this._private.cy,this,!0)};yn.hasElementWithId=function(r){return r=""+r,this._private.map.has(r)};yn.getElementById=function(r){r=""+r;var e=this._private.cy,t=this._private.map.get(r);return t?t.ele:new Cr(e)};yn.$id=yn.getElementById;yn.poolIndex=function(){var r=this._private.cy,e=r._private.elements,t=this[0]._private.data.id;return e._private.map.get(t).index};yn.indexOf=function(r){var e=r[0]._private.data.id;return this._private.map.get(e).index};yn.indexOfId=function(r){return r=""+r,this._private.map.get(r).index};yn.json=function(r){var e=this.element(),t=this.cy();if(e==null&&r)return this;if(e!=null){var n=e._private;if($t(r)){if(t.startBatch(),r.data){e.data(r.data);var i=n.data;if(e.isEdge()){var a=!1,s={},o=r.data.source,l=r.data.target;o!=null&&o!=i.source&&(s.source=""+o,a=!0),l!=null&&l!=i.target&&(s.target=""+l,a=!0),a&&(e=e.move(s))}else{var u="parent"in r.data,c=r.data.parent;u&&(c!=null||i.parent!=null)&&c!=i.parent&&(c===void 0&&(c=null),c!=null&&(c=""+c),e=e.move({parent:c}))}}r.position&&e.position(r.position);var h=function(m,v,g){var y=r[m];y!=null&&y!==n[m]&&(y?e[v]():e[g]())};return h("removed","remove","restore"),h("selected","select","unselect"),h("selectable","selectify","unselectify"),h("locked","lock","unlock"),h("grabbable","grabify","ungrabify"),h("pannable","panify","unpanify"),r.classes!=null&&e.classes(r.classes),t.endBatch(),this}else if(r===void 0){var d={data:es(n.data),position:es(n.position),group:n.group,removed:n.removed,selected:n.selected,selectable:n.selectable,locked:n.locked,grabbable:n.grabbable,pannable:n.pannable,classes:null};d.classes="";var f=0;return n.classes.forEach(function(p){return d.classes+=f++===0?p:" "+p}),d}}};yn.jsons=function(){for(var r=[],e=0;e<this.length;e++){var t=this[e],n=t.json();r.push(n)}return r};yn.clone=function(){for(var r=this.cy(),e=[],t=0;t<this.length;t++){var n=this[t],i=n.json(),a=new Ev(r,i,!1);e.push(a)}return new Cr(r,e)};yn.copy=yn.clone;yn.restore=function(){for(var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=this,n=t.cy(),i=n._private,a=[],s=[],o,l=0,u=t.length;l<u;l++){var c=t[l];e&&!c.removed()||(c.isNode()?a.push(c):s.push(c))}o=a.concat(s);var h,d=function(){o.splice(h,1),h--};for(h=0;h<o.length;h++){var f=o[h],p=f._private,m=p.data;if(f.clearTraversalCache(),!(!e&&!p.removed)){if(m.id===void 0)m.id=fk();else if(et(m.id))m.id=""+m.id;else if(Bo(m.id)||!dt(m.id)){Nn("Can not create element with invalid string ID `"+m.id+"`"),d();continue}else if(n.hasElementWithId(m.id)){Nn("Can not create second element with ID `"+m.id+"`"),d();continue}}var v=m.id;if(f.isNode()){var g=p.position;g.x==null&&(g.x=0),g.y==null&&(g.y=0)}if(f.isEdge()){for(var y=f,_=["source","target"],x=_.length,E=!1,T=0;T<x;T++){var b=_[T],w=m[b];et(w)&&(w=m[b]=""+m[b]),w==null||w===""?(Nn("Can not create edge `"+v+"` with unspecified "+b),E=!0):n.hasElementWithId(w)||(Nn("Can not create edge `"+v+"` with nonexistant "+b+" `"+w+"`"),E=!0)}if(E){d();continue}var A=n.getElementById(m.source),S=n.getElementById(m.target);A.same(S)?A._private.edges.push(y):(A._private.edges.push(y),S._private.edges.push(y)),y._private.source=A,y._private.target=S}p.map=new Os,p.map.set(v,{ele:f,index:0}),p.removed=!1,e&&n.addToPool(f)}for(var C=0;C<a.length;C++){var R=a[C],P=R._private.data;et(P.parent)&&(P.parent=""+P.parent);var M=P.parent,N=M!=null;if(N||R._private.parent){var D=R._private.parent?n.collection().merge(R._private.parent):n.getElementById(M);if(D.empty())P.parent=void 0;else if(D[0].removed())nn("Node added with missing parent, reference to parent removed"),P.parent=void 0,R._private.parent=null;else{for(var I=!1,L=D;!L.empty();){if(R.same(L)){I=!0,P.parent=void 0;break}L=L.parent()}I||(D[0]._private.children.push(R),R._private.parent=D[0],i.hasCompoundNodes=!0)}}}if(o.length>0){for(var z=o.length===t.length?t:new Cr(n,o),B=0;B<z.length;B++){var k=z[B];k.isNode()||(k.parallelEdges().clearTraversalCache(),k.source().clearTraversalCache(),k.target().clearTraversalCache())}var U;i.hasCompoundNodes?U=n.collection().merge(z).merge(z.connectedNodes()).merge(z.parent()):U=z,U.dirtyCompoundBoundsCache().dirtyBoundingBoxCache().updateStyle(r),r?z.emitAndNotify("add"):e&&z.emit("add")}return t};yn.removed=function(){var r=this[0];return r&&r._private.removed};yn.inside=function(){var r=this[0];return r&&!r._private.removed};yn.remove=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=this,n=[],i={},a=t._private.cy;function s(M){for(var N=M._private.edges,D=0;D<N.length;D++)l(N[D])}function o(M){for(var N=M._private.children,D=0;D<N.length;D++)l(N[D])}function l(M){var N=i[M.id()];e&&M.removed()||N||(i[M.id()]=!0,M.isNode()?(n.push(M),s(M),o(M)):n.unshift(M))}for(var u=0,c=t.length;u<c;u++){var h=t[u];l(h)}function d(M,N){var D=M._private.edges;ko(D,N),M.clearTraversalCache()}function f(M){M.clearTraversalCache()}var p=[];p.ids={};function m(M,N){N=N[0],M=M[0];var D=M._private.children,I=M.id();ko(D,N),N._private.parent=null,p.ids[I]||(p.ids[I]=!0,p.push(M))}t.dirtyCompoundBoundsCache(),e&&a.removeFromPool(n);for(var v=0;v<n.length;v++){var g=n[v];if(g.isEdge()){var y=g.source()[0],_=g.target()[0];d(y,g),d(_,g);for(var x=g.parallelEdges(),E=0;E<x.length;E++){var T=x[E];f(T),T.isBundledBezier()&&T.dirtyBoundingBoxCache()}}else{var b=g.parent();b.length!==0&&m(b,g)}e&&(g._private.removed=!0)}var w=a._private.elements;a._private.hasCompoundNodes=!1;for(var A=0;A<w.length;A++){var S=w[A];if(S.isParent()){a._private.hasCompoundNodes=!0;break}}var C=new Cr(this.cy(),n);C.size()>0&&(r?C.emitAndNotify("remove"):e&&C.emit("remove"));for(var R=0;R<p.length;R++){var P=p[R];(!e||!P.removed())&&P.updateStyle()}return C};yn.move=function(r){var e=this._private.cy,t=this,n=!1,i=!1,a=function(p){return p==null?p:""+p};if(r.source!==void 0||r.target!==void 0){var s=a(r.source),o=a(r.target),l=s!=null&&e.hasElementWithId(s),u=o!=null&&e.hasElementWithId(o);(l||u)&&(e.batch(function(){t.remove(n,i),t.emitAndNotify("moveout");for(var f=0;f<t.length;f++){var p=t[f],m=p._private.data;p.isEdge()&&(l&&(m.source=s),u&&(m.target=o))}t.restore(n,i)}),t.emitAndNotify("move"))}else if(r.parent!==void 0){var c=a(r.parent),h=c===null||e.hasElementWithId(c);if(h){var d=c===null?void 0:c;e.batch(function(){var f=t.remove(n,i);f.emitAndNotify("moveout");for(var p=0;p<t.length;p++){var m=t[p],v=m._private.data;m.isNode()&&(v.parent=d)}f.restore(n,i)}),t.emitAndNotify("move")}}return this};[Sk,V8,pg,Ro,Ec,i6,Rv,x6,jk,Kk,S6,Hg,gg,Mr,No,Gr].forEach(function(r){mt(yn,r)});var D6={add:function(e){var t,n=this;if(ki(e)){var i=e;if(i._private.cy===n)t=i.restore();else{for(var a=[],s=0;s<i.length;s++){var o=i[s];a.push(o.json())}t=new Cr(n,a)}}else if(fn(e)){var l=e;t=new Cr(n,l)}else if($t(e)&&(fn(e.nodes)||fn(e.edges))){for(var u=e,c=[],h=["nodes","edges"],d=0,f=h.length;d<f;d++){var p=h[d],m=u[p];if(fn(m))for(var v=0,g=m.length;v<g;v++){var y=mt({group:p},m[v]);c.push(y)}}t=new Cr(n,c)}else{var _=e;t=new Ev(n,_).collection()}return t},remove:function(e){if(!ki(e)){if(dt(e)){var t=e;e=this.$(t)}}return e.remove()}};/*! Bezier curve function generator. Copyright Gaetan Renaudeau. MIT License: http://en.wikipedia.org/wiki/MIT_License */function L6(r,e,t,n){var i=4,a=.001,s=1e-7,o=10,l=11,u=1/(l-1),c=typeof Float32Array<"u";if(arguments.length!==4)return!1;for(var h=0;h<4;++h)if(typeof arguments[h]!="number"||isNaN(arguments[h])||!isFinite(arguments[h]))return!1;r=Math.min(r,1),t=Math.min(t,1),r=Math.max(r,0),t=Math.max(t,0);var d=c?new Float32Array(l):new Array(l);function f(S,C){return 1-3*C+3*S}function p(S,C){return 3*C-6*S}function m(S){return 3*S}function v(S,C,R){return((f(C,R)*S+p(C,R))*S+m(C))*S}function g(S,C,R){return 3*f(C,R)*S*S+2*p(C,R)*S+m(C)}function y(S,C){for(var R=0;R<i;++R){var P=g(C,r,t);if(P===0)return C;var M=v(C,r,t)-S;C-=M/P}return C}function _(){for(var S=0;S<l;++S)d[S]=v(S*u,r,t)}function x(S,C,R){var P,M,N=0;do M=C+(R-C)/2,P=v(M,r,t)-S,P>0?R=M:C=M;while(Math.abs(P)>s&&++N<o);return M}function E(S){for(var C=0,R=1,P=l-1;R!==P&&d[R]<=S;++R)C+=u;--R;var M=(S-d[R])/(d[R+1]-d[R]),N=C+M*u,D=g(N,r,t);return D>=a?y(S,N):D===0?N:x(S,C,C+u)}var T=!1;function b(){T=!0,(r!==e||t!==n)&&_()}var w=function(C){return T||b(),r===e&&t===n?C:C===0?0:C===1?1:v(E(C),e,n)};w.getControlPoints=function(){return[{x:r,y:e},{x:t,y:n}]};var A="generateBezier("+[r,e,t,n]+")";return w.toString=function(){return A},w}/*! Runge-Kutta spring physics function generator. Adapted from Framer.js, copyright Koen Bok. MIT License: http://en.wikipedia.org/wiki/MIT_License */var I6=function(){function r(n){return-n.tension*n.x-n.friction*n.v}function e(n,i,a){var s={x:n.x+a.dx*i,v:n.v+a.dv*i,tension:n.tension,friction:n.friction};return{dx:s.v,dv:r(s)}}function t(n,i){var a={dx:n.v,dv:r(n)},s=e(n,i*.5,a),o=e(n,i*.5,s),l=e(n,i,o),u=1/6*(a.dx+2*(s.dx+o.dx)+l.dx),c=1/6*(a.dv+2*(s.dv+o.dv)+l.dv);return n.x=n.x+u*i,n.v=n.v+c*i,n}return function n(i,a,s){var o={x:-1,v:0,tension:null,friction:null},l=[0],u=0,c=1/1e4,h=16/1e3,d,f,p;for(i=parseFloat(i)||500,a=parseFloat(a)||20,s=s||null,o.tension=i,o.friction=a,d=s!==null,d?(u=n(i,a),f=u/s*h):f=h;p=t(p||o,f),l.push(1+p.x),u+=16,Math.abs(p.x)>c&&Math.abs(p.v)>c;);return d?function(m){return l[m*(l.length-1)|0]}:u}}(),gn=function(e,t,n,i){var a=L6(e,t,n,i);return function(s,o,l){return s+(o-s)*a(l)}},vg={linear:function(e,t,n){return e+(t-e)*n},ease:gn(.25,.1,.25,1),"ease-in":gn(.42,0,1,1),"ease-out":gn(0,0,.58,1),"ease-in-out":gn(.42,0,.58,1),"ease-in-sine":gn(.47,0,.745,.715),"ease-out-sine":gn(.39,.575,.565,1),"ease-in-out-sine":gn(.445,.05,.55,.95),"ease-in-quad":gn(.55,.085,.68,.53),"ease-out-quad":gn(.25,.46,.45,.94),"ease-in-out-quad":gn(.455,.03,.515,.955),"ease-in-cubic":gn(.55,.055,.675,.19),"ease-out-cubic":gn(.215,.61,.355,1),"ease-in-out-cubic":gn(.645,.045,.355,1),"ease-in-quart":gn(.895,.03,.685,.22),"ease-out-quart":gn(.165,.84,.44,1),"ease-in-out-quart":gn(.77,0,.175,1),"ease-in-quint":gn(.755,.05,.855,.06),"ease-out-quint":gn(.23,1,.32,1),"ease-in-out-quint":gn(.86,0,.07,1),"ease-in-expo":gn(.95,.05,.795,.035),"ease-out-expo":gn(.19,1,.22,1),"ease-in-out-expo":gn(1,0,0,1),"ease-in-circ":gn(.6,.04,.98,.335),"ease-out-circ":gn(.075,.82,.165,1),"ease-in-out-circ":gn(.785,.135,.15,.86),spring:function(e,t,n){if(n===0)return vg.linear;var i=I6(e,t,n);return function(a,s,o){return a+(s-a)*i(o)}},"cubic-bezier":gn};function tN(r,e,t,n,i){if(n===1||e===t)return t;var a=i(e,t,n);return r==null||((r.roundValue||r.color)&&(a=Math.round(a)),r.min!==void 0&&(a=Math.max(a,r.min)),r.max!==void 0&&(a=Math.min(a,r.max))),a}function nN(r,e){return r.pfValue!=null||r.value!=null?r.pfValue!=null&&(e==null||e.type.units!=="%")?r.pfValue:r.value:r}function vu(r,e,t,n,i){var a=i!=null?i.type:null;t<0?t=0:t>1&&(t=1);var s=nN(r,i),o=nN(e,i);if(et(s)&&et(o))return tN(a,s,o,t,n);if(fn(s)&&fn(o)){for(var l=[],u=0;u<o.length;u++){var c=s[u],h=o[u];if(c!=null&&h!=null){var d=tN(a,c,h,t,n);l.push(d)}else l.push(h)}return l}}function O6(r,e,t,n){var i=!n,a=r._private,s=e._private,o=s.easing,l=s.startTime,u=n?r:r.cy(),c=u.style();if(!s.easingImpl)if(o==null)s.easingImpl=vg.linear;else{var h;if(dt(o)){var d=c.parse("transition-timing-function",o);h=d.value}else h=o;var f,p;dt(h)?(f=h,p=[]):(f=h[1],p=h.slice(2).map(function(z){return+z})),p.length>0?(f==="spring"&&p.push(s.duration),s.easingImpl=vg[f].apply(null,p)):s.easingImpl=vg[f]}var m=s.easingImpl,v;if(s.duration===0?v=1:v=(t-l)/s.duration,s.applying&&(v=s.progress),v<0?v=0:v>1&&(v=1),s.delay==null){var g=s.startPosition,y=s.position;if(y&&i&&!r.locked()){var _={};Eh(g.x,y.x)&&(_.x=vu(g.x,y.x,v,m)),Eh(g.y,y.y)&&(_.y=vu(g.y,y.y,v,m)),r.position(_)}var x=s.startPan,E=s.pan,T=a.pan,b=E!=null&&n;b&&(Eh(x.x,E.x)&&(T.x=vu(x.x,E.x,v,m)),Eh(x.y,E.y)&&(T.y=vu(x.y,E.y,v,m)),r.emit("pan"));var w=s.startZoom,A=s.zoom,S=A!=null&&n;S&&(Eh(w,A)&&(a.zoom=Mf(a.minZoom,vu(w,A,v,m),a.maxZoom)),r.emit("zoom")),(b||S)&&r.emit("viewport");var C=s.style;if(C&&C.length>0&&i){for(var R=0;R<C.length;R++){var P=C[R],M=P.name,N=P,D=s.startStyle[M],I=c.properties[D.name],L=vu(D,N,v,m,I);c.overrideBypass(r,M,L)}r.emit("style")}}return s.progress=v,v}function Eh(r,e){return r==null||e==null?!1:et(r)&&et(e)?!0:!!(r&&e)}function F6(r,e,t,n){var i=e._private;i.started=!0,i.startTime=t-i.progress*i.duration}function rN(r,e){var t=e._private.aniEles,n=[];function i(c,h){var d=c._private,f=d.animation.current,p=d.animation.queue,m=!1;if(f.length===0){var v=p.shift();v&&f.push(v)}for(var g=function(T){for(var b=T.length-1;b>=0;b--){var w=T[b];w()}T.splice(0,T.length)},y=f.length-1;y>=0;y--){var _=f[y],x=_._private;if(x.stopped){f.splice(y,1),x.hooked=!1,x.playing=!1,x.started=!1,g(x.frames);continue}!x.playing&&!x.applying||(x.playing&&x.applying&&(x.applying=!1),x.started||F6(c,_,r),O6(c,_,r,h),x.applying&&(x.applying=!1),g(x.frames),x.step!=null&&x.step(r),_.completed()&&(f.splice(y,1),x.hooked=!1,x.playing=!1,x.started=!1,g(x.completes)),m=!0)}return!h&&f.length===0&&p.length===0&&n.push(c),m}for(var a=!1,s=0;s<t.length;s++){var o=t[s],l=i(o);a=a||l}var u=i(e,!0);(a||u)&&(t.length>0?e.notify("draw",t):e.notify("draw")),t.unmerge(n),e.emit("step")}var B6={animate:tn.animate(),animation:tn.animation(),animated:tn.animated(),clearQueue:tn.clearQueue(),delay:tn.delay(),delayAnimation:tn.delayAnimation(),stop:tn.stop(),addToAnimationPool:function(e){var t=this;!t.styleEnabled()||t._private.aniEles.merge(e)},stopAnimationLoop:function(){this._private.animationsRunning=!1},startAnimationLoop:function(){var e=this;if(e._private.animationsRunning=!0,!e.styleEnabled())return;function t(){!e._private.animationsRunning||Ug(function(a){rN(a,e),t()})}var n=e.renderer();n&&n.beforeRender?n.beforeRender(function(a,s){rN(s,e)},n.beforeRenderPriorities.animations):t()}},U6={qualifierCompare:function(e,t){return e==null||t==null?e==null&&t==null:e.sameText(t)},eventMatches:function(e,t,n){var i=t.qualifier;return i!=null?e!==n.target&&dd(n.target)&&i.matches(n.target):!0},addEventFields:function(e,t){t.cy=e,t.target=e},callbackContext:function(e,t,n){return t.qualifier!=null?n.target:e}},rp=function(e){return dt(e)?new Go(e):e},Jk={createEmitter:function(){var e=this._private;return e.emitter||(e.emitter=new Nv(U6,this)),this},emitter:function(){return this._private.emitter},on:function(e,t,n){return this.emitter().on(e,rp(t),n),this},removeListener:function(e,t,n){return this.emitter().removeListener(e,rp(t),n),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},one:function(e,t,n){return this.emitter().one(e,rp(t),n),this},once:function(e,t,n){return this.emitter().one(e,rp(t),n),this},emit:function(e,t){return this.emitter().emit(e,t),this},emitAndNotify:function(e,t){return this.emit(e),this.notify(e,t),this}};tn.eventAliasesOn(Jk);var Dw={png:function(e){var t=this._private.renderer;return e=e||{},t.png(e)},jpg:function(e){var t=this._private.renderer;return e=e||{},e.bg=e.bg||"#fff",t.jpg(e)}};Dw.jpeg=Dw.jpg;var mg={layout:function(e){var t=this;if(e==null){Nn("Layout options must be specified to make a layout");return}if(e.name==null){Nn("A `name` must be specified to make a layout");return}var n=e.name,i=t.extension("layout",n);if(i==null){Nn("No such layout `"+n+"` found.  Did you forget to import it and `cytoscape.use()` it?");return}var a;dt(e.eles)?a=t.$(e.eles):a=e.eles!=null?e.eles:t.$();var s=new i(mt({},e,{cy:t,eles:a}));return s}};mg.createLayout=mg.makeLayout=mg.layout;var k6={notify:function(e,t){var n=this._private;if(this.batching()){n.batchNotifications=n.batchNotifications||{};var i=n.batchNotifications[e]=n.batchNotifications[e]||this.collection();t!=null&&i.merge(t);return}if(!!n.notificationsEnabled){var a=this.renderer();this.destroyed()||!a||a.notify(e,t)}},notifications:function(e){var t=this._private;return e===void 0?t.notificationsEnabled:(t.notificationsEnabled=!!e,this)},noNotifications:function(e){this.notifications(!1),e(),this.notifications(!0)},batching:function(){return this._private.batchCount>0},startBatch:function(){var e=this._private;return e.batchCount==null&&(e.batchCount=0),e.batchCount===0&&(e.batchStyleEles=this.collection(),e.batchNotifications={}),e.batchCount++,this},endBatch:function(){var e=this._private;if(e.batchCount===0)return this;if(e.batchCount--,e.batchCount===0){e.batchStyleEles.updateStyle();var t=this.renderer();Object.keys(e.batchNotifications).forEach(function(n){var i=e.batchNotifications[n];i.empty()?t.notify(n):t.notify(n,i)})}return this},batch:function(e){return this.startBatch(),e(),this.endBatch(),this},batchData:function(e){var t=this;return this.batch(function(){for(var n=Object.keys(e),i=0;i<n.length;i++){var a=n[i],s=e[a],o=t.getElementById(a);o.data(s)}})}},G6=cr({hideEdgesOnViewport:!1,textureOnViewport:!1,motionBlur:!1,motionBlurOpacity:.05,pixelRatio:void 0,desktopTapThreshold:4,touchTapThreshold:8,wheelSensitivity:1,debug:!1,showFps:!1,webgl:!1,webglDebug:!1,webglDebugShowAtlases:!1,webglTexSize:2048,webglTexRows:36,webglTexRowsNodes:18,webglBatchSize:2048,webglTexPerBatch:14,webglBgColor:[255,255,255]}),Lw={renderTo:function(e,t,n,i){var a=this._private.renderer;return a.renderTo(e,t,n,i),this},renderer:function(){return this._private.renderer},forceRender:function(){return this.notify("draw"),this},resize:function(){return this.invalidateSize(),this.emitAndNotify("resize"),this},initRenderer:function(e){var t=this,n=t.extension("renderer",e.name);if(n==null){Nn("Can not initialise: No such renderer `".concat(e.name,"` found. Did you forget to import it and `cytoscape.use()` it?"));return}e.wheelSensitivity!==void 0&&nn("You have set a custom wheel sensitivity.  This will make your app zoom unnaturally when using mainstream mice.  You should change this value from the default only if you can guarantee that all your users will use the same hardware and OS configuration as your current machine.");var i=G6(e);i.cy=t,t._private.renderer=new n(i),this.notify("init")},destroyRenderer:function(){var e=this;e.notify("destroy");var t=e.container();if(t)for(t._cyreg=null;t.childNodes.length>0;)t.removeChild(t.childNodes[0]);e._private.renderer=null,e.mutableElements().forEach(function(n){var i=n._private;i.rscratch={},i.rstyle={},i.animation.current=[],i.animation.queue=[]})},onRender:function(e){return this.on("render",e)},offRender:function(e){return this.off("render",e)}};Lw.invalidateDimensions=Lw.resize;var yg={collection:function(e,t){return dt(e)?this.$(e):ki(e)?e.collection():fn(e)?(t||(t={}),new Cr(this,e,t.unique,t.removed)):new Cr(this)},nodes:function(e){var t=this.$(function(n){return n.isNode()});return e?t.filter(e):t},edges:function(e){var t=this.$(function(n){return n.isEdge()});return e?t.filter(e):t},$:function(e){var t=this._private.elements;return e?t.filter(e):t.spawnSelf()},mutableElements:function(){return this._private.elements}};yg.elements=yg.filter=yg.$;var Er={},cf="t",z6="f";Er.apply=function(r){for(var e=this,t=e._private,n=t.cy,i=n.collection(),a=0;a<r.length;a++){var s=r[a],o=e.getContextMeta(s);if(!o.empty){var l=e.getContextStyle(o),u=e.applyContextStyle(o,l,s);s._private.appliedInitStyle?e.updateTransitions(s,u.diffProps):s._private.appliedInitStyle=!0;var c=e.updateStyleHints(s);c&&i.push(s)}}return i};Er.getPropertiesDiff=function(r,e){var t=this,n=t._private.propDiffs=t._private.propDiffs||{},i=r+"-"+e,a=n[i];if(a)return a;for(var s=[],o={},l=0;l<t.length;l++){var u=t[l],c=r[l]===cf,h=e[l]===cf,d=c!==h,f=u.mappedProperties.length>0;if(d||h&&f){var p=void 0;d&&f||d?p=u.properties:f&&(p=u.mappedProperties);for(var m=0;m<p.length;m++){for(var v=p[m],g=v.name,y=!1,_=l+1;_<t.length;_++){var x=t[_],E=e[_]===cf;if(!!E&&(y=x.properties[v.name]!=null,y))break}!o[g]&&!y&&(o[g]=!0,s.push(g))}}}return n[i]=s,s};Er.getContextMeta=function(r){for(var e=this,t="",n,i=r._private.styleCxtKey||"",a=0;a<e.length;a++){var s=e[a],o=s.selector&&s.selector.matches(r);o?t+=cf:t+=z6}return n=e.getPropertiesDiff(i,t),r._private.styleCxtKey=t,{key:t,diffPropNames:n,empty:n.length===0}};Er.getContextStyle=function(r){var e=r.key,t=this,n=this._private.contextStyles=this._private.contextStyles||{};if(n[e])return n[e];for(var i={_private:{key:e}},a=0;a<t.length;a++){var s=t[a],o=e[a]===cf;if(!!o)for(var l=0;l<s.properties.length;l++){var u=s.properties[l];i[u.name]=u}}return n[e]=i,i};Er.applyContextStyle=function(r,e,t){for(var n=this,i=r.diffPropNames,a={},s=n.types,o=0;o<i.length;o++){var l=i[o],u=e[l],c=t.pstyle(l);if(!u)if(c)c.bypass?u={name:l,deleteBypassed:!0}:u={name:l,delete:!0};else continue;if(c!==u){if(u.mapped===s.fn&&c!=null&&c.mapping!=null&&c.mapping.value===u.value){var h=c.mapping,d=h.fnValue=u.value(t);if(d===h.prevFnValue)continue}var f=a[l]={prev:c};n.applyParsedProperty(t,u),f.next=t.pstyle(l),f.next&&f.next.bypass&&(f.next=f.next.bypassed)}}return{diffProps:a}};Er.updateStyleHints=function(r){var e=r._private,t=this,n=t.propertyGroupNames,i=t.propertyGroupKeys,a=function(K,se,oe){return t.getPropertiesHash(K,se,oe)},s=e.styleKey;if(r.removed())return!1;var o=e.group==="nodes",l=r._private.style;n=Object.keys(l);for(var u=0;u<i.length;u++){var c=i[u];e.styleKeys[c]=[ju,Kh]}for(var h=function(K,se){return e.styleKeys[se][0]=wf(K,e.styleKeys[se][0])},d=function(K,se){return e.styleKeys[se][1]=Sf(K,e.styleKeys[se][1])},f=function(K,se){h(K,se),d(K,se)},p=function(K,se){for(var oe=0;oe<K.length;oe++){var W=K.charCodeAt(oe);h(W,se),d(W,se)}},m=2e9,v=function(K){return-128<K&&K<128&&Math.floor(K)!==K?m-(K*1024|0):K},g=0;g<n.length;g++){var y=n[g],_=l[y];if(_!=null){var x=this.properties[y],E=x.type,T=x.groupKey,b=void 0;x.hashOverride!=null?b=x.hashOverride(r,_):_.pfValue!=null&&(b=_.pfValue);var w=x.enums==null?_.value:null,A=b!=null,S=w!=null,C=A||S,R=_.units;if(E.number&&C&&!E.multiple){var P=A?b:w;f(v(P),T),!A&&R!=null&&p(R,T)}else p(_.strValue,T)}}for(var M=[ju,Kh],N=0;N<i.length;N++){var D=i[N],I=e.styleKeys[D];M[0]=wf(I[0],M[0]),M[1]=Sf(I[1],M[1])}e.styleKey=lq(M[0],M[1]);var L=e.styleKeys;e.labelDimsKey=oo(L.labelDimensions);var z=a(r,["label"],L.labelDimensions);if(e.labelKey=oo(z),e.labelStyleKey=oo(jd(L.commonLabel,z)),!o){var B=a(r,["source-label"],L.labelDimensions);e.sourceLabelKey=oo(B),e.sourceLabelStyleKey=oo(jd(L.commonLabel,B));var k=a(r,["target-label"],L.labelDimensions);e.targetLabelKey=oo(k),e.targetLabelStyleKey=oo(jd(L.commonLabel,k))}if(o){var U=e.styleKeys,G=U.nodeBody,O=U.nodeBorder,F=U.nodeOutline,V=U.backgroundImage,$=U.compound,Z=U.pie,Y=[G,O,F,V,$,Z].filter(function(X){return X!=null}).reduce(jd,[ju,Kh]);e.nodeKey=oo(Y),e.hasPie=Z!=null&&Z[0]!==ju&&Z[1]!==Kh}return s!==e.styleKey};Er.clearStyleHints=function(r){var e=r._private;e.styleCxtKey="",e.styleKeys={},e.styleKey=null,e.labelKey=null,e.labelStyleKey=null,e.sourceLabelKey=null,e.sourceLabelStyleKey=null,e.targetLabelKey=null,e.targetLabelStyleKey=null,e.nodeKey=null,e.hasPie=null};Er.applyParsedProperty=function(r,e){var t=this,n=e,i=r._private.style,a,s=t.types,o=t.properties[n.name].type,l=n.bypass,u=i[n.name],c=u&&u.bypass,h=r._private,d="mapping",f=function(G){return G==null?null:G.pfValue!=null?G.pfValue:G.value},p=function(){var G=f(u),O=f(n);t.checkTriggers(r,n.name,G,O)};if(e.name==="curve-style"&&r.isEdge()&&(e.value!=="bezier"&&r.isLoop()||e.value==="haystack"&&(r.source().isParent()||r.target().isParent()))&&(n=e=this.parse(e.name,"bezier",l)),n.delete)return i[n.name]=void 0,p(),!0;if(n.deleteBypassed)return u?u.bypass?(u.bypassed=void 0,p(),!0):!1:(p(),!0);if(n.deleteBypass)return u?u.bypass?(i[n.name]=u.bypassed,p(),!0):!1:(p(),!0);var m=function(){nn("Do not assign mappings to elements without corresponding data (i.e. ele `"+r.id()+"` has no mapping for property `"+n.name+"` with data field `"+n.field+"`); try a `["+n.field+"]` selector to limit scope to elements with `"+n.field+"` defined")};switch(n.mapped){case s.mapData:{for(var v=n.field.split("."),g=h.data,y=0;y<v.length&&g;y++){var _=v[y];g=g[_]}if(g==null)return m(),!1;var x;if(et(g)){var E=n.fieldMax-n.fieldMin;E===0?x=0:x=(g-n.fieldMin)/E}else return nn("Do not use continuous mappers without specifying numeric data (i.e. `"+n.field+": "+g+"` for `"+r.id()+"` is non-numeric)"),!1;if(x<0?x=0:x>1&&(x=1),o.color){var T=n.valueMin[0],b=n.valueMax[0],w=n.valueMin[1],A=n.valueMax[1],S=n.valueMin[2],C=n.valueMax[2],R=n.valueMin[3]==null?1:n.valueMin[3],P=n.valueMax[3]==null?1:n.valueMax[3],M=[Math.round(T+(b-T)*x),Math.round(w+(A-w)*x),Math.round(S+(C-S)*x),Math.round(R+(P-R)*x)];a={bypass:n.bypass,name:n.name,value:M,strValue:"rgb("+M[0]+", "+M[1]+", "+M[2]+")"}}else if(o.number){var N=n.valueMin+(n.valueMax-n.valueMin)*x;a=this.parse(n.name,N,n.bypass,d)}else return!1;if(!a)return m(),!1;a.mapping=n,n=a;break}case s.data:{for(var D=n.field.split("."),I=h.data,L=0;L<D.length&&I;L++){var z=D[L];I=I[z]}if(I!=null&&(a=this.parse(n.name,I,n.bypass,d)),!a)return m(),!1;a.mapping=n,n=a;break}case s.fn:{var B=n.value,k=n.fnValue!=null?n.fnValue:B(r);if(n.prevFnValue=k,k==null)return nn("Custom function mappers may not return null (i.e. `"+n.name+"` for ele `"+r.id()+"` is null)"),!1;if(a=this.parse(n.name,k,n.bypass,d),!a)return nn("Custom function mappers may not return invalid values for the property type (i.e. `"+n.name+"` for ele `"+r.id()+"` is invalid)"),!1;a.mapping=es(n),n=a;break}case void 0:break;default:return!1}return l?(c?n.bypassed=u.bypassed:n.bypassed=u,i[n.name]=n):c?u.bypassed=n:i[n.name]=n,p(),!0};Er.cleanElements=function(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(this.clearStyleHints(n),n.dirtyCompoundBoundsCache(),n.dirtyBoundingBoxCache(),!e)n._private.style={};else for(var i=n._private.style,a=Object.keys(i),s=0;s<a.length;s++){var o=a[s],l=i[o];l!=null&&(l.bypass?l.bypassed=null:i[o]=null)}}};Er.update=function(){var r=this._private.cy,e=r.mutableElements();e.updateStyle()};Er.updateTransitions=function(r,e){var t=this,n=r._private,i=r.pstyle("transition-property").value,a=r.pstyle("transition-duration").pfValue,s=r.pstyle("transition-delay").pfValue;if(i.length>0&&a>0){for(var o={},l=!1,u=0;u<i.length;u++){var c=i[u],h=r.pstyle(c),d=e[c];if(!!d){var f=d.prev,p=f,m=d.next!=null?d.next:h,v=!1,g=void 0,y=1e-6;!p||(et(p.pfValue)&&et(m.pfValue)?(v=m.pfValue-p.pfValue,g=p.pfValue+y*v):et(p.value)&&et(m.value)?(v=m.value-p.value,g=p.value+y*v):fn(p.value)&&fn(m.value)&&(v=p.value[0]!==m.value[0]||p.value[1]!==m.value[1]||p.value[2]!==m.value[2],g=p.strValue),v&&(o[c]=m.strValue,this.applyBypass(r,c,g),l=!0))}}if(!l)return;n.transitioning=!0,new Kc(function(_){s>0?r.delayAnimation(s).play().promise().then(_):_()}).then(function(){return r.animation({style:o,duration:a,easing:r.pstyle("transition-timing-function").value,queue:!1}).play().promise()}).then(function(){t.removeBypasses(r,i),r.emitAndNotify("style"),n.transitioning=!1})}else n.transitioning&&(this.removeBypasses(r,i),r.emitAndNotify("style"),n.transitioning=!1)};Er.checkTrigger=function(r,e,t,n,i,a){var s=this.properties[e],o=i(s);r.removed()||o!=null&&o(t,n,r)&&a(s)};Er.checkZOrderTrigger=function(r,e,t,n){var i=this;this.checkTrigger(r,e,t,n,function(a){return a.triggersZOrder},function(){i._private.cy.notify("zorder",r)})};Er.checkBoundsTrigger=function(r,e,t,n){this.checkTrigger(r,e,t,n,function(i){return i.triggersBounds},function(i){r.dirtyCompoundBoundsCache(),r.dirtyBoundingBoxCache()})};Er.checkConnectedEdgesBoundsTrigger=function(r,e,t,n){this.checkTrigger(r,e,t,n,function(i){return i.triggersBoundsOfConnectedEdges},function(i){r.connectedEdges().forEach(function(a){a.dirtyBoundingBoxCache()})})};Er.checkParallelEdgesBoundsTrigger=function(r,e,t,n){this.checkTrigger(r,e,t,n,function(i){return i.triggersBoundsOfParallelEdges},function(i){r.parallelEdges().forEach(function(a){a.dirtyBoundingBoxCache()})})};Er.checkTriggers=function(r,e,t,n){r.dirtyStyleCache(),this.checkZOrderTrigger(r,e,t,n),this.checkBoundsTrigger(r,e,t,n),this.checkConnectedEdgesBoundsTrigger(r,e,t,n),this.checkParallelEdgesBoundsTrigger(r,e,t,n)};var xd={};xd.applyBypass=function(r,e,t,n){var i=this,a=[],s=!0;if(e==="*"||e==="**"){if(t!==void 0)for(var o=0;o<i.properties.length;o++){var l=i.properties[o],u=l.name,c=this.parse(u,t,!0);c&&a.push(c)}}else if(dt(e)){var h=this.parse(e,t,!0);h&&a.push(h)}else if($t(e)){var d=e;n=t;for(var f=Object.keys(d),p=0;p<f.length;p++){var m=f[p],v=d[m];if(v===void 0&&(v=d[xv(m)]),v!==void 0){var g=this.parse(m,v,!0);g&&a.push(g)}}}else return!1;if(a.length===0)return!1;for(var y=!1,_=0;_<r.length;_++){for(var x=r[_],E={},T=void 0,b=0;b<a.length;b++){var w=a[b];if(n){var A=x.pstyle(w.name);T=E[w.name]={prev:A}}y=this.applyParsedProperty(x,es(w))||y,n&&(T.next=x.pstyle(w.name))}y&&this.updateStyleHints(x),n&&this.updateTransitions(x,E,s)}return y};xd.overrideBypass=function(r,e,t){e=DS(e);for(var n=0;n<r.length;n++){var i=r[n],a=i._private.style[e],s=this.properties[e].type,o=s.color,l=s.mutiple,u=a?a.pfValue!=null?a.pfValue:a.value:null;!a||!a.bypass?this.applyBypass(i,e,t):(a.value=t,a.pfValue!=null&&(a.pfValue=t),o?a.strValue="rgb("+t.join(",")+")":l?a.strValue=t.join(" "):a.strValue=""+t,this.updateStyleHints(i)),this.checkTriggers(i,e,u,t)}};xd.removeAllBypasses=function(r,e){return this.removeBypasses(r,this.propertyNames,e)};xd.removeBypasses=function(r,e,t){for(var n=!0,i=0;i<r.length;i++){for(var a=r[i],s={},o=0;o<e.length;o++){var l=e[o],u=this.properties[l],c=a.pstyle(u.name);if(!(!c||!c.bypass)){var h="",d=this.parse(l,h,!0),f=s[u.name]={prev:c};this.applyParsedProperty(a,d),f.next=a.pstyle(u.name)}}this.updateStyleHints(a),t&&this.updateTransitions(a,s,n)}};var $S={};$S.getEmSizeInPixels=function(){var r=this.containerCss("font-size");return r!=null?parseFloat(r):1};$S.containerCss=function(r){var e=this._private.cy,t=e.container(),n=e.window();if(n&&t&&n.getComputedStyle)return n.getComputedStyle(t).getPropertyValue(r)};var as={};as.getRenderedStyle=function(r,e){return e?this.getStylePropertyValue(r,e,!0):this.getRawStyle(r,!0)};as.getRawStyle=function(r,e){var t=this;if(r=r[0],r){for(var n={},i=0;i<t.properties.length;i++){var a=t.properties[i],s=t.getStylePropertyValue(r,a.name,e);s!=null&&(n[a.name]=s,n[xv(a.name)]=s)}return n}};as.getIndexedStyle=function(r,e,t,n){var i=r.pstyle(e)[t][n];return i!=null?i:r.cy().style().getDefaultProperty(e)[t][0]};as.getStylePropertyValue=function(r,e,t){var n=this;if(r=r[0],r){var i=n.properties[e];i.alias&&(i=i.pointsTo);var a=i.type,s=r.pstyle(i.name);if(s){var o=s.value,l=s.units,u=s.strValue;if(t&&a.number&&o!=null&&et(o)){var c=r.cy().zoom(),h=function(v){return v*c},d=function(v,g){return h(v)+g},f=fn(o),p=f?l.every(function(m){return m!=null}):l!=null;return p?f?o.map(function(m,v){return d(m,l[v])}).join(" "):d(o,l):f?o.map(function(m){return dt(m)?m:""+h(m)}).join(" "):""+h(o)}else if(u!=null)return u}return null}};as.getAnimationStartStyle=function(r,e){for(var t={},n=0;n<e.length;n++){var i=e[n],a=i.name,s=r.pstyle(a);s!==void 0&&($t(s)?s=this.parse(a,s.strValue):s=this.parse(a,s)),s&&(t[a]=s)}return t};as.getPropsList=function(r){var e=this,t=[],n=r,i=e.properties;if(n)for(var a=Object.keys(n),s=0;s<a.length;s++){var o=a[s],l=n[o],u=i[o]||i[DS(o)],c=this.parse(u.name,l);c&&t.push(c)}return t};as.getNonDefaultPropertiesHash=function(r,e,t){var n=t.slice(),i,a,s,o,l,u;for(l=0;l<e.length;l++)if(i=e[l],a=r.pstyle(i,!1),a!=null)if(a.pfValue!=null)n[0]=wf(o,n[0]),n[1]=Sf(o,n[1]);else for(s=a.strValue,u=0;u<s.length;u++)o=s.charCodeAt(u),n[0]=wf(o,n[0]),n[1]=Sf(o,n[1]);return n};as.getPropertiesHash=as.getNonDefaultPropertiesHash;var Lv={};Lv.appendFromJson=function(r){for(var e=this,t=0;t<r.length;t++){var n=r[t],i=n.selector,a=n.style||n.css,s=Object.keys(a);e.selector(i);for(var o=0;o<s.length;o++){var l=s[o],u=a[l];e.css(l,u)}}return e};Lv.fromJson=function(r){var e=this;return e.resetToDefault(),e.appendFromJson(r),e};Lv.json=function(){for(var r=[],e=this.defaultLength;e<this.length;e++){for(var t=this[e],n=t.selector,i=t.properties,a={},s=0;s<i.length;s++){var o=i[s];a[o.name]=o.strValue}r.push({selector:n?n.toString():"core",style:a})}return r};var XS={};XS.appendFromString=function(r){var e=this,t=this,n=""+r,i,a,s;n=n.replace(/[/][*](\s|.)+?[*][/]/g,"");function o(){n.length>i.length?n=n.substr(i.length):n=""}function l(){a.length>s.length?a=a.substr(s.length):a=""}for(;;){var u=n.match(/^\s*$/);if(u)break;var c=n.match(/^\s*((?:.|\s)+?)\s*\{((?:.|\s)+?)\}/);if(!c){nn("Halting stylesheet parsing: String stylesheet contains more to parse but no selector and block found in: "+n);break}i=c[0];var h=c[1];if(h!=="core"){var d=new Go(h);if(d.invalid){nn("Skipping parsing of block: Invalid selector found in string stylesheet: "+h),o();continue}}var f=c[2],p=!1;a=f;for(var m=[];;){var v=a.match(/^\s*$/);if(v)break;var g=a.match(/^\s*(.+?)\s*:\s*(.+?)(?:\s*;|\s*$)/);if(!g){nn("Skipping parsing of block: Invalid formatting of style property and value definitions found in:"+f),p=!0;break}s=g[0];var y=g[1],_=g[2],x=e.properties[y];if(!x){nn("Skipping property: Invalid property name in: "+s),l();continue}var E=t.parse(y,_);if(!E){nn("Skipping property: Invalid property definition in: "+s),l();continue}m.push({name:y,val:_}),l()}if(p){o();break}t.selector(h);for(var T=0;T<m.length;T++){var b=m[T];t.css(b.name,b.val)}o()}return t};XS.fromString=function(r){var e=this;return e.resetToDefault(),e.appendFromString(r),e};var Sr={};(function(){var r=nr,e=GW,t=VW,n=HW,i=WW,a=function(Y){return"^"+Y+"\\s*\\(\\s*([\\w\\.]+)\\s*\\)$"},s=function(Y){var X=r+"|\\w+|"+e+"|"+t+"|"+n+"|"+i;return"^"+Y+"\\s*\\(([\\w\\.]+)\\s*\\,\\s*("+r+")\\s*\\,\\s*("+r+")\\s*,\\s*("+X+")\\s*\\,\\s*("+X+")\\)$"},o=[`^url\\s*\\(\\s*['"]?(.+?)['"]?\\s*\\)$`,"^(none)$","^(.+)$"];Sr.types={time:{number:!0,min:0,units:"s|ms",implicitUnits:"ms"},percent:{number:!0,min:0,max:100,units:"%",implicitUnits:"%"},percentages:{number:!0,min:0,max:100,units:"%",implicitUnits:"%",multiple:!0},zeroOneNumber:{number:!0,min:0,max:1,unitless:!0},zeroOneNumbers:{number:!0,min:0,max:1,unitless:!0,multiple:!0},nOneOneNumber:{number:!0,min:-1,max:1,unitless:!0},nonNegativeInt:{number:!0,min:0,integer:!0,unitless:!0},nonNegativeNumber:{number:!0,min:0,unitless:!0},position:{enums:["parent","origin"]},nodeSize:{number:!0,min:0,enums:["label"]},number:{number:!0,unitless:!0},numbers:{number:!0,unitless:!0,multiple:!0},positiveNumber:{number:!0,unitless:!0,min:0,strictMin:!0},size:{number:!0,min:0},bidirectionalSize:{number:!0},bidirectionalSizeMaybePercent:{number:!0,allowPercent:!0},bidirectionalSizes:{number:!0,multiple:!0},sizeMaybePercent:{number:!0,min:0,allowPercent:!0},axisDirection:{enums:["horizontal","leftward","rightward","vertical","upward","downward","auto"]},paddingRelativeTo:{enums:["width","height","average","min","max"]},bgWH:{number:!0,min:0,allowPercent:!0,enums:["auto"],multiple:!0},bgPos:{number:!0,allowPercent:!0,multiple:!0},bgRelativeTo:{enums:["inner","include-padding"],multiple:!0},bgRepeat:{enums:["repeat","repeat-x","repeat-y","no-repeat"],multiple:!0},bgFit:{enums:["none","contain","cover"],multiple:!0},bgCrossOrigin:{enums:["anonymous","use-credentials","null"],multiple:!0},bgClip:{enums:["none","node"],multiple:!0},bgContainment:{enums:["inside","over"],multiple:!0},color:{color:!0},colors:{color:!0,multiple:!0},fill:{enums:["solid","linear-gradient","radial-gradient"]},bool:{enums:["yes","no"]},bools:{enums:["yes","no"],multiple:!0},lineStyle:{enums:["solid","dotted","dashed"]},lineCap:{enums:["butt","round","square"]},linePosition:{enums:["center","inside","outside"]},lineJoin:{enums:["round","bevel","miter"]},borderStyle:{enums:["solid","dotted","dashed","double"]},curveStyle:{enums:["bezier","unbundled-bezier","haystack","segments","straight","straight-triangle","taxi","round-segments","round-taxi"]},radiusType:{enums:["arc-radius","influence-radius"],multiple:!0},fontFamily:{regex:'^([\\w- \\"]+(?:\\s*,\\s*[\\w- \\"]+)*)$'},fontStyle:{enums:["italic","normal","oblique"]},fontWeight:{enums:["normal","bold","bolder","lighter","100","200","300","400","500","600","800","900",100,200,300,400,500,600,700,800,900]},textDecoration:{enums:["none","underline","overline","line-through"]},textTransform:{enums:["none","uppercase","lowercase"]},textWrap:{enums:["none","wrap","ellipsis"]},textOverflowWrap:{enums:["whitespace","anywhere"]},textBackgroundShape:{enums:["rectangle","roundrectangle","round-rectangle"]},nodeShape:{enums:["rectangle","roundrectangle","round-rectangle","cutrectangle","cut-rectangle","bottomroundrectangle","bottom-round-rectangle","barrel","ellipse","triangle","round-triangle","square","pentagon","round-pentagon","hexagon","round-hexagon","concavehexagon","concave-hexagon","heptagon","round-heptagon","octagon","round-octagon","tag","round-tag","star","diamond","round-diamond","vee","rhomboid","right-rhomboid","polygon"]},overlayShape:{enums:["roundrectangle","round-rectangle","ellipse"]},cornerRadius:{number:!0,min:0,units:"px|em",implicitUnits:"px",enums:["auto"]},compoundIncludeLabels:{enums:["include","exclude"]},arrowShape:{enums:["tee","triangle","triangle-tee","circle-triangle","triangle-cross","triangle-backcurve","vee","square","circle","diamond","chevron","none"]},arrowFill:{enums:["filled","hollow"]},arrowWidth:{number:!0,units:"%|px|em",implicitUnits:"px",enums:["match-line"]},display:{enums:["element","none"]},visibility:{enums:["hidden","visible"]},zCompoundDepth:{enums:["bottom","orphan","auto","top"]},zIndexCompare:{enums:["auto","manual"]},valign:{enums:["top","center","bottom"]},halign:{enums:["left","center","right"]},justification:{enums:["left","center","right","auto"]},text:{string:!0},data:{mapping:!0,regex:a("data")},layoutData:{mapping:!0,regex:a("layoutData")},scratch:{mapping:!0,regex:a("scratch")},mapData:{mapping:!0,regex:s("mapData")},mapLayoutData:{mapping:!0,regex:s("mapLayoutData")},mapScratch:{mapping:!0,regex:s("mapScratch")},fn:{mapping:!0,fn:!0},url:{regexes:o,singleRegexMatchValue:!0},urls:{regexes:o,singleRegexMatchValue:!0,multiple:!0},propList:{propList:!0},angle:{number:!0,units:"deg|rad",implicitUnits:"rad"},textRotation:{number:!0,units:"deg|rad",implicitUnits:"rad",enums:["none","autorotate"]},polygonPointList:{number:!0,multiple:!0,evenMultiple:!0,min:-1,max:1,unitless:!0},edgeDistances:{enums:["intersection","node-position","endpoints"]},edgeEndpoint:{number:!0,multiple:!0,units:"%|px|em|deg|rad",implicitUnits:"px",enums:["inside-to-node","outside-to-node","outside-to-node-or-label","outside-to-line","outside-to-line-or-label"],singleEnum:!0,validate:function(Y,X){switch(Y.length){case 2:return X[0]!=="deg"&&X[0]!=="rad"&&X[1]!=="deg"&&X[1]!=="rad";case 1:return dt(Y[0])||X[0]==="deg"||X[0]==="rad";default:return!1}}},easing:{regexes:["^(spring)\\s*\\(\\s*("+r+")\\s*,\\s*("+r+")\\s*\\)$","^(cubic-bezier)\\s*\\(\\s*("+r+")\\s*,\\s*("+r+")\\s*,\\s*("+r+")\\s*,\\s*("+r+")\\s*\\)$"],enums:["linear","ease","ease-in","ease-out","ease-in-out","ease-in-sine","ease-out-sine","ease-in-out-sine","ease-in-quad","ease-out-quad","ease-in-out-quad","ease-in-cubic","ease-out-cubic","ease-in-out-cubic","ease-in-quart","ease-out-quart","ease-in-out-quart","ease-in-quint","ease-out-quint","ease-in-out-quint","ease-in-expo","ease-out-expo","ease-in-out-expo","ease-in-circ","ease-out-circ","ease-in-out-circ"]},gradientDirection:{enums:["to-bottom","to-top","to-left","to-right","to-bottom-right","to-bottom-left","to-top-right","to-top-left","to-right-bottom","to-left-bottom","to-right-top","to-left-top"]},boundsExpansion:{number:!0,multiple:!0,min:0,validate:function(Y){var X=Y.length;return X===1||X===2||X===4}}};var l={zeroNonZero:function(Y,X){return(Y==null||X==null)&&Y!==X||Y==0&&X!=0?!0:Y!=0&&X==0},any:function(Y,X){return Y!=X},emptyNonEmpty:function(Y,X){var K=Bo(Y),se=Bo(X);return K&&!se||!K&&se}},u=Sr.types,c=[{name:"label",type:u.text,triggersBounds:l.any,triggersZOrder:l.emptyNonEmpty},{name:"text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any}],h=[{name:"source-label",type:u.text,triggersBounds:l.any},{name:"source-text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"source-text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"source-text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"source-text-offset",type:u.size,triggersBounds:l.any}],d=[{name:"target-label",type:u.text,triggersBounds:l.any},{name:"target-text-rotation",type:u.textRotation,triggersBounds:l.any},{name:"target-text-margin-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"target-text-margin-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"target-text-offset",type:u.size,triggersBounds:l.any}],f=[{name:"font-family",type:u.fontFamily,triggersBounds:l.any},{name:"font-style",type:u.fontStyle,triggersBounds:l.any},{name:"font-weight",type:u.fontWeight,triggersBounds:l.any},{name:"font-size",type:u.size,triggersBounds:l.any},{name:"text-transform",type:u.textTransform,triggersBounds:l.any},{name:"text-wrap",type:u.textWrap,triggersBounds:l.any},{name:"text-overflow-wrap",type:u.textOverflowWrap,triggersBounds:l.any},{name:"text-max-width",type:u.size,triggersBounds:l.any},{name:"text-outline-width",type:u.size,triggersBounds:l.any},{name:"line-height",type:u.positiveNumber,triggersBounds:l.any}],p=[{name:"text-valign",type:u.valign,triggersBounds:l.any},{name:"text-halign",type:u.halign,triggersBounds:l.any},{name:"color",type:u.color},{name:"text-outline-color",type:u.color},{name:"text-outline-opacity",type:u.zeroOneNumber},{name:"text-background-color",type:u.color},{name:"text-background-opacity",type:u.zeroOneNumber},{name:"text-background-padding",type:u.size,triggersBounds:l.any},{name:"text-border-opacity",type:u.zeroOneNumber},{name:"text-border-color",type:u.color},{name:"text-border-width",type:u.size,triggersBounds:l.any},{name:"text-border-style",type:u.borderStyle,triggersBounds:l.any},{name:"text-background-shape",type:u.textBackgroundShape,triggersBounds:l.any},{name:"text-justification",type:u.justification}],m=[{name:"events",type:u.bool,triggersZOrder:l.any},{name:"text-events",type:u.bool,triggersZOrder:l.any}],v=[{name:"display",type:u.display,triggersZOrder:l.any,triggersBounds:l.any,triggersBoundsOfConnectedEdges:l.any,triggersBoundsOfParallelEdges:function(Y,X,K){return Y===X?!1:K.pstyle("curve-style").value==="bezier"}},{name:"visibility",type:u.visibility,triggersZOrder:l.any},{name:"opacity",type:u.zeroOneNumber,triggersZOrder:l.zeroNonZero},{name:"text-opacity",type:u.zeroOneNumber},{name:"min-zoomed-font-size",type:u.size},{name:"z-compound-depth",type:u.zCompoundDepth,triggersZOrder:l.any},{name:"z-index-compare",type:u.zIndexCompare,triggersZOrder:l.any},{name:"z-index",type:u.number,triggersZOrder:l.any}],g=[{name:"overlay-padding",type:u.size,triggersBounds:l.any},{name:"overlay-color",type:u.color},{name:"overlay-opacity",type:u.zeroOneNumber,triggersBounds:l.zeroNonZero},{name:"overlay-shape",type:u.overlayShape,triggersBounds:l.any},{name:"overlay-corner-radius",type:u.cornerRadius}],y=[{name:"underlay-padding",type:u.size,triggersBounds:l.any},{name:"underlay-color",type:u.color},{name:"underlay-opacity",type:u.zeroOneNumber,triggersBounds:l.zeroNonZero},{name:"underlay-shape",type:u.overlayShape,triggersBounds:l.any},{name:"underlay-corner-radius",type:u.cornerRadius}],_=[{name:"transition-property",type:u.propList},{name:"transition-duration",type:u.time},{name:"transition-delay",type:u.time},{name:"transition-timing-function",type:u.easing}],x=function(Y,X){return X.value==="label"?-Y.poolIndex():X.pfValue},E=[{name:"height",type:u.nodeSize,triggersBounds:l.any,hashOverride:x},{name:"width",type:u.nodeSize,triggersBounds:l.any,hashOverride:x},{name:"shape",type:u.nodeShape,triggersBounds:l.any},{name:"shape-polygon-points",type:u.polygonPointList,triggersBounds:l.any},{name:"corner-radius",type:u.cornerRadius},{name:"background-color",type:u.color},{name:"background-fill",type:u.fill},{name:"background-opacity",type:u.zeroOneNumber},{name:"background-blacken",type:u.nOneOneNumber},{name:"background-gradient-stop-colors",type:u.colors},{name:"background-gradient-stop-positions",type:u.percentages},{name:"background-gradient-direction",type:u.gradientDirection},{name:"padding",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"padding-relative-to",type:u.paddingRelativeTo,triggersBounds:l.any},{name:"bounds-expansion",type:u.boundsExpansion,triggersBounds:l.any}],T=[{name:"border-color",type:u.color},{name:"border-opacity",type:u.zeroOneNumber},{name:"border-width",type:u.size,triggersBounds:l.any},{name:"border-style",type:u.borderStyle},{name:"border-cap",type:u.lineCap},{name:"border-join",type:u.lineJoin},{name:"border-dash-pattern",type:u.numbers},{name:"border-dash-offset",type:u.number},{name:"border-position",type:u.linePosition}],b=[{name:"outline-color",type:u.color},{name:"outline-opacity",type:u.zeroOneNumber},{name:"outline-width",type:u.size,triggersBounds:l.any},{name:"outline-style",type:u.borderStyle},{name:"outline-offset",type:u.size,triggersBounds:l.any}],w=[{name:"background-image",type:u.urls},{name:"background-image-crossorigin",type:u.bgCrossOrigin},{name:"background-image-opacity",type:u.zeroOneNumbers},{name:"background-image-containment",type:u.bgContainment},{name:"background-image-smoothing",type:u.bools},{name:"background-position-x",type:u.bgPos},{name:"background-position-y",type:u.bgPos},{name:"background-width-relative-to",type:u.bgRelativeTo},{name:"background-height-relative-to",type:u.bgRelativeTo},{name:"background-repeat",type:u.bgRepeat},{name:"background-fit",type:u.bgFit},{name:"background-clip",type:u.bgClip},{name:"background-width",type:u.bgWH},{name:"background-height",type:u.bgWH},{name:"background-offset-x",type:u.bgPos},{name:"background-offset-y",type:u.bgPos}],A=[{name:"position",type:u.position,triggersBounds:l.any},{name:"compound-sizing-wrt-labels",type:u.compoundIncludeLabels,triggersBounds:l.any},{name:"min-width",type:u.size,triggersBounds:l.any},{name:"min-width-bias-left",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-width-bias-right",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-height",type:u.size,triggersBounds:l.any},{name:"min-height-bias-top",type:u.sizeMaybePercent,triggersBounds:l.any},{name:"min-height-bias-bottom",type:u.sizeMaybePercent,triggersBounds:l.any}],S=[{name:"line-style",type:u.lineStyle},{name:"line-color",type:u.color},{name:"line-fill",type:u.fill},{name:"line-cap",type:u.lineCap},{name:"line-opacity",type:u.zeroOneNumber},{name:"line-dash-pattern",type:u.numbers},{name:"line-dash-offset",type:u.number},{name:"line-outline-width",type:u.size},{name:"line-outline-color",type:u.color},{name:"line-gradient-stop-colors",type:u.colors},{name:"line-gradient-stop-positions",type:u.percentages},{name:"curve-style",type:u.curveStyle,triggersBounds:l.any,triggersBoundsOfParallelEdges:function(Y,X){return Y===X?!1:Y==="bezier"||X==="bezier"}},{name:"haystack-radius",type:u.zeroOneNumber,triggersBounds:l.any},{name:"source-endpoint",type:u.edgeEndpoint,triggersBounds:l.any},{name:"target-endpoint",type:u.edgeEndpoint,triggersBounds:l.any},{name:"control-point-step-size",type:u.size,triggersBounds:l.any},{name:"control-point-distances",type:u.bidirectionalSizes,triggersBounds:l.any},{name:"control-point-weights",type:u.numbers,triggersBounds:l.any},{name:"segment-distances",type:u.bidirectionalSizes,triggersBounds:l.any},{name:"segment-weights",type:u.numbers,triggersBounds:l.any},{name:"segment-radii",type:u.numbers,triggersBounds:l.any},{name:"radius-type",type:u.radiusType,triggersBounds:l.any},{name:"taxi-turn",type:u.bidirectionalSizeMaybePercent,triggersBounds:l.any},{name:"taxi-turn-min-distance",type:u.size,triggersBounds:l.any},{name:"taxi-direction",type:u.axisDirection,triggersBounds:l.any},{name:"taxi-radius",type:u.number,triggersBounds:l.any},{name:"edge-distances",type:u.edgeDistances,triggersBounds:l.any},{name:"arrow-scale",type:u.positiveNumber,triggersBounds:l.any},{name:"loop-direction",type:u.angle,triggersBounds:l.any},{name:"loop-sweep",type:u.angle,triggersBounds:l.any},{name:"source-distance-from-node",type:u.size,triggersBounds:l.any},{name:"target-distance-from-node",type:u.size,triggersBounds:l.any}],C=[{name:"ghost",type:u.bool,triggersBounds:l.any},{name:"ghost-offset-x",type:u.bidirectionalSize,triggersBounds:l.any},{name:"ghost-offset-y",type:u.bidirectionalSize,triggersBounds:l.any},{name:"ghost-opacity",type:u.zeroOneNumber}],R=[{name:"selection-box-color",type:u.color},{name:"selection-box-opacity",type:u.zeroOneNumber},{name:"selection-box-border-color",type:u.color},{name:"selection-box-border-width",type:u.size},{name:"active-bg-color",type:u.color},{name:"active-bg-opacity",type:u.zeroOneNumber},{name:"active-bg-size",type:u.size},{name:"outside-texture-bg-color",type:u.color},{name:"outside-texture-bg-opacity",type:u.zeroOneNumber}],P=[];Sr.pieBackgroundN=16,P.push({name:"pie-size",type:u.sizeMaybePercent});for(var M=1;M<=Sr.pieBackgroundN;M++)P.push({name:"pie-"+M+"-background-color",type:u.color}),P.push({name:"pie-"+M+"-background-size",type:u.percent}),P.push({name:"pie-"+M+"-background-opacity",type:u.zeroOneNumber});var N=[],D=Sr.arrowPrefixes=["source","mid-source","target","mid-target"];[{name:"arrow-shape",type:u.arrowShape,triggersBounds:l.any},{name:"arrow-color",type:u.color},{name:"arrow-fill",type:u.arrowFill},{name:"arrow-width",type:u.arrowWidth}].forEach(function(Z){D.forEach(function(Y){var X=Y+"-"+Z.name,K=Z.type,se=Z.triggersBounds;N.push({name:X,type:K,triggersBounds:se})})},{});var I=Sr.properties=[].concat(m,_,v,g,y,C,p,f,c,h,d,E,T,b,w,P,A,S,N,R),L=Sr.propertyGroups={behavior:m,transition:_,visibility:v,overlay:g,underlay:y,ghost:C,commonLabel:p,labelDimensions:f,mainLabel:c,sourceLabel:h,targetLabel:d,nodeBody:E,nodeBorder:T,nodeOutline:b,backgroundImage:w,pie:P,compound:A,edgeLine:S,edgeArrow:N,core:R},z=Sr.propertyGroupNames={},B=Sr.propertyGroupKeys=Object.keys(L);B.forEach(function(Z){z[Z]=L[Z].map(function(Y){return Y.name}),L[Z].forEach(function(Y){return Y.groupKey=Z})});var k=Sr.aliases=[{name:"content",pointsTo:"label"},{name:"control-point-distance",pointsTo:"control-point-distances"},{name:"control-point-weight",pointsTo:"control-point-weights"},{name:"segment-distance",pointsTo:"segment-distances"},{name:"segment-weight",pointsTo:"segment-weights"},{name:"segment-radius",pointsTo:"segment-radii"},{name:"edge-text-rotation",pointsTo:"text-rotation"},{name:"padding-left",pointsTo:"padding"},{name:"padding-right",pointsTo:"padding"},{name:"padding-top",pointsTo:"padding"},{name:"padding-bottom",pointsTo:"padding"}];Sr.propertyNames=I.map(function(Z){return Z.name});for(var U=0;U<I.length;U++){var G=I[U];I[G.name]=G}for(var O=0;O<k.length;O++){var F=k[O],V=I[F.pointsTo],$={name:F.name,alias:!0,pointsTo:V};I.push($),I[F.name]=$}})();Sr.getDefaultProperty=function(r){return this.getDefaultProperties()[r]};Sr.getDefaultProperties=function(){var r=this._private;if(r.defaultProperties!=null)return r.defaultProperties;for(var e=mt({"selection-box-color":"#ddd","selection-box-opacity":.65,"selection-box-border-color":"#aaa","selection-box-border-width":1,"active-bg-color":"black","active-bg-opacity":.15,"active-bg-size":30,"outside-texture-bg-color":"#000","outside-texture-bg-opacity":.125,events:"yes","text-events":"no","text-valign":"top","text-halign":"center","text-justification":"auto","line-height":1,color:"#000","text-outline-color":"#000","text-outline-width":0,"text-outline-opacity":1,"text-opacity":1,"text-decoration":"none","text-transform":"none","text-wrap":"none","text-overflow-wrap":"whitespace","text-max-width":9999,"text-background-color":"#000","text-background-opacity":0,"text-background-shape":"rectangle","text-background-padding":0,"text-border-opacity":0,"text-border-width":0,"text-border-style":"solid","text-border-color":"#000","font-family":"Helvetica Neue, Helvetica, sans-serif","font-style":"normal","font-weight":"normal","font-size":16,"min-zoomed-font-size":0,"text-rotation":"none","source-text-rotation":"none","target-text-rotation":"none",visibility:"visible",display:"element",opacity:1,"z-compound-depth":"auto","z-index-compare":"auto","z-index":0,label:"","text-margin-x":0,"text-margin-y":0,"source-label":"","source-text-offset":0,"source-text-margin-x":0,"source-text-margin-y":0,"target-label":"","target-text-offset":0,"target-text-margin-x":0,"target-text-margin-y":0,"overlay-opacity":0,"overlay-color":"#000","overlay-padding":10,"overlay-shape":"round-rectangle","overlay-corner-radius":"auto","underlay-opacity":0,"underlay-color":"#000","underlay-padding":10,"underlay-shape":"round-rectangle","underlay-corner-radius":"auto","transition-property":"none","transition-duration":0,"transition-delay":0,"transition-timing-function":"linear","background-blacken":0,"background-color":"#999","background-fill":"solid","background-opacity":1,"background-image":"none","background-image-crossorigin":"anonymous","background-image-opacity":1,"background-image-containment":"inside","background-image-smoothing":"yes","background-position-x":"50%","background-position-y":"50%","background-offset-x":0,"background-offset-y":0,"background-width-relative-to":"include-padding","background-height-relative-to":"include-padding","background-repeat":"no-repeat","background-fit":"none","background-clip":"node","background-width":"auto","background-height":"auto","border-color":"#000","border-opacity":1,"border-width":0,"border-style":"solid","border-dash-pattern":[4,2],"border-dash-offset":0,"border-cap":"butt","border-join":"miter","border-position":"center","outline-color":"#999","outline-opacity":1,"outline-width":0,"outline-offset":0,"outline-style":"solid",height:30,width:30,shape:"ellipse","shape-polygon-points":"-1, -1,   1, -1,   1, 1,   -1, 1","corner-radius":"auto","bounds-expansion":0,"background-gradient-direction":"to-bottom","background-gradient-stop-colors":"#999","background-gradient-stop-positions":"0%",ghost:"no","ghost-offset-y":0,"ghost-offset-x":0,"ghost-opacity":0,padding:0,"padding-relative-to":"width",position:"origin","compound-sizing-wrt-labels":"include","min-width":0,"min-width-bias-left":0,"min-width-bias-right":0,"min-height":0,"min-height-bias-top":0,"min-height-bias-bottom":0},{"pie-size":"100%"},[{name:"pie-{{i}}-background-color",value:"black"},{name:"pie-{{i}}-background-size",value:"0%"},{name:"pie-{{i}}-background-opacity",value:1}].reduce(function(l,u){for(var c=1;c<=Sr.pieBackgroundN;c++){var h=u.name.replace("{{i}}",c),d=u.value;l[h]=d}return l},{}),{"line-style":"solid","line-color":"#999","line-fill":"solid","line-cap":"butt","line-opacity":1,"line-outline-width":0,"line-outline-color":"#000","line-gradient-stop-colors":"#999","line-gradient-stop-positions":"0%","control-point-step-size":40,"control-point-weights":.5,"segment-weights":.5,"segment-distances":20,"segment-radii":15,"radius-type":"arc-radius","taxi-turn":"50%","taxi-radius":15,"taxi-turn-min-distance":10,"taxi-direction":"auto","edge-distances":"intersection","curve-style":"haystack","haystack-radius":0,"arrow-scale":1,"loop-direction":"-45deg","loop-sweep":"-90deg","source-distance-from-node":0,"target-distance-from-node":0,"source-endpoint":"outside-to-node","target-endpoint":"outside-to-node","line-dash-pattern":[6,3],"line-dash-offset":0},[{name:"arrow-shape",value:"none"},{name:"arrow-color",value:"#999"},{name:"arrow-fill",value:"filled"},{name:"arrow-width",value:1}].reduce(function(l,u){return Sr.arrowPrefixes.forEach(function(c){var h=c+"-"+u.name,d=u.value;l[h]=d}),l},{})),t={},n=0;n<this.properties.length;n++){var i=this.properties[n];if(!i.pointsTo){var a=i.name,s=e[a],o=this.parse(a,s);t[a]=o}}return r.defaultProperties=t,r.defaultProperties};Sr.addDefaultStylesheet=function(){this.selector(":parent").css({shape:"rectangle",padding:10,"background-color":"#eee","border-color":"#ccc","border-width":1}).selector("edge").css({width:3}).selector(":loop").css({"curve-style":"bezier"}).selector("edge:compound").css({"curve-style":"bezier","source-endpoint":"outside-to-line","target-endpoint":"outside-to-line"}).selector(":selected").css({"background-color":"#0169D9","line-color":"#0169D9","source-arrow-color":"#0169D9","target-arrow-color":"#0169D9","mid-source-arrow-color":"#0169D9","mid-target-arrow-color":"#0169D9"}).selector(":parent:selected").css({"background-color":"#CCE1F9","border-color":"#aec8e5"}).selector(":active").css({"overlay-color":"black","overlay-padding":10,"overlay-opacity":.25}),this.defaultLength=this.length};var Iv={};Iv.parse=function(r,e,t,n){var i=this;if(Pn(e))return i.parseImplWarn(r,e,t,n);var a=n==="mapping"||n===!0||n===!1||n==null?"dontcare":n,s=t?"t":"f",o=""+e,l=uk(r,o,s,a),u=i.propCache=i.propCache||[],c;return(c=u[l])||(c=u[l]=i.parseImplWarn(r,e,t,n)),(t||n==="mapping")&&(c=es(c),c&&(c.value=es(c.value))),c};Iv.parseImplWarn=function(r,e,t,n){var i=this.parseImpl(r,e,t,n);return!i&&e!=null&&nn("The style property `".concat(r,": ").concat(e,"` is invalid")),i&&(i.name==="width"||i.name==="height")&&e==="label"&&nn("The style value of `label` is deprecated for `"+i.name+"`"),i};Iv.parseImpl=function(r,e,t,n){var i=this;r=DS(r);var a=i.properties[r],s=e,o=i.types;if(!a||e===void 0)return null;a.alias&&(a=a.pointsTo,r=a.name);var l=dt(e);l&&(e=e.trim());var u=a.type;if(!u)return null;if(t&&(e===""||e===null))return{name:r,value:e,bypass:!0,deleteBypass:!0};if(Pn(e))return{name:r,value:e,strValue:"fn",mapped:o.fn,bypass:t};var c,h;if(!(!l||n||e.length<7||e[1]!=="a")){if(e.length>=7&&e[0]==="d"&&(c=new RegExp(o.data.regex).exec(e))){if(t)return!1;var d=o.data;return{name:r,value:c,strValue:""+e,mapped:d,field:c[1],bypass:t}}else if(e.length>=10&&e[0]==="m"&&(h=new RegExp(o.mapData.regex).exec(e))){if(t||u.multiple)return!1;var f=o.mapData;if(!(u.color||u.number))return!1;var p=this.parse(r,h[4]);if(!p||p.mapped)return!1;var m=this.parse(r,h[5]);if(!m||m.mapped)return!1;if(p.pfValue===m.pfValue||p.strValue===m.strValue)return nn("`"+r+": "+e+"` is not a valid mapper because the output range is zero; converting to `"+r+": "+p.strValue+"`"),this.parse(r,p.strValue);if(u.color){var v=p.value,g=m.value,y=v[0]===g[0]&&v[1]===g[1]&&v[2]===g[2]&&(v[3]===g[3]||(v[3]==null||v[3]===1)&&(g[3]==null||g[3]===1));if(y)return!1}return{name:r,value:h,strValue:""+e,mapped:f,field:h[1],fieldMin:parseFloat(h[2]),fieldMax:parseFloat(h[3]),valueMin:p.value,valueMax:m.value,bypass:t}}}if(u.multiple&&n!=="multiple"){var _;if(l?_=e.split(/\s+/):fn(e)?_=e:_=[e],u.evenMultiple&&_.length%2!==0)return null;for(var x=[],E=[],T=[],b="",w=!1,A=0;A<_.length;A++){var S=i.parse(r,_[A],t,"multiple");w=w||dt(S.value),x.push(S.value),T.push(S.pfValue!=null?S.pfValue:S.value),E.push(S.units),b+=(A>0?" ":"")+S.strValue}return u.validate&&!u.validate(x,E)?null:u.singleEnum&&w?x.length===1&&dt(x[0])?{name:r,value:x[0],strValue:x[0],bypass:t}:null:{name:r,value:x,pfValue:T,strValue:b,bypass:t,units:E}}var C=function(){for(var Y=0;Y<u.enums.length;Y++){var X=u.enums[Y];if(X===e)return{name:r,value:e,strValue:""+e,bypass:t}}return null};if(u.number){var R,P="px";if(u.units&&(R=u.units),u.implicitUnits&&(P=u.implicitUnits),!u.unitless)if(l){var M="px|em"+(u.allowPercent?"|\\%":"");R&&(M=R);var N=e.match("^("+nr+")("+M+")?$");N&&(e=N[1],R=N[2]||P)}else(!R||u.implicitUnits)&&(R=P);if(e=parseFloat(e),isNaN(e)&&u.enums===void 0)return null;if(isNaN(e)&&u.enums!==void 0)return e=s,C();if(u.integer&&!LW(e)||u.min!==void 0&&(e<u.min||u.strictMin&&e===u.min)||u.max!==void 0&&(e>u.max||u.strictMax&&e===u.max))return null;var D={name:r,value:e,strValue:""+e+(R||""),units:R,bypass:t};return u.unitless||R!=="px"&&R!=="em"?D.pfValue=e:D.pfValue=R==="px"||!R?e:this.getEmSizeInPixels()*e,(R==="ms"||R==="s")&&(D.pfValue=R==="ms"?e:1e3*e),(R==="deg"||R==="rad")&&(D.pfValue=R==="rad"?e:Gq(e)),R==="%"&&(D.pfValue=e/100),D}else if(u.propList){var I=[],L=""+e;if(L!=="none"){for(var z=L.split(/\s*,\s*|\s+/),B=0;B<z.length;B++){var k=z[B].trim();i.properties[k]?I.push(k):nn("`"+k+"` is not a valid property name")}if(I.length===0)return null}return{name:r,value:I,strValue:I.length===0?"none":I.join(" "),bypass:t}}else if(u.color){var U=nk(e);return U?{name:r,value:U,pfValue:U,strValue:"rgb("+U[0]+","+U[1]+","+U[2]+")",bypass:t}:null}else if(u.regex||u.regexes){if(u.enums){var G=C();if(G)return G}for(var O=u.regexes?u.regexes:[u.regex],F=0;F<O.length;F++){var V=new RegExp(O[F]),$=V.exec(e);if($)return{name:r,value:u.singleRegexMatchValue?$[1]:$,strValue:""+e,bypass:t}}return null}else return u.string?{name:r,value:""+e,strValue:""+e,bypass:t}:u.enums?C():null};var xr=function(e){if(!(this instanceof xr))return new xr(e);if(!PS(e)){Nn("A style must have a core reference");return}this._private={cy:e,coreStyle:{}},this.length=0,this.resetToDefault()},zr=xr.prototype;zr.instanceString=function(){return"style"};zr.clear=function(){for(var r=this._private,e=r.cy,t=e.elements(),n=0;n<this.length;n++)this[n]=void 0;return this.length=0,r.contextStyles={},r.propDiffs={},this.cleanElements(t,!0),t.forEach(function(i){var a=i[0]._private;a.styleDirty=!0,a.appliedInitStyle=!1}),this};zr.resetToDefault=function(){return this.clear(),this.addDefaultStylesheet(),this};zr.core=function(r){return this._private.coreStyle[r]||this.getDefaultProperty(r)};zr.selector=function(r){var e=r==="core"?null:new Go(r),t=this.length++;return this[t]={selector:e,properties:[],mappedProperties:[],index:t},this};zr.css=function(){var r=this,e=arguments;if(e.length===1)for(var t=e[0],n=0;n<r.properties.length;n++){var i=r.properties[n],a=t[i.name];a===void 0&&(a=t[xv(i.name)]),a!==void 0&&this.cssRule(i.name,a)}else e.length===2&&this.cssRule(e[0],e[1]);return this};zr.style=zr.css;zr.cssRule=function(r,e){var t=this.parse(r,e);if(t){var n=this.length-1;this[n].properties.push(t),this[n].properties[t.name]=t,t.name.match(/pie-(\d+)-background-size/)&&t.value&&(this._private.hasPie=!0),t.mapped&&this[n].mappedProperties.push(t);var i=!this[n].selector;i&&(this._private.coreStyle[t.name]=t)}return this};zr.append=function(r){return JU(r)?r.appendToStyle(this):fn(r)?this.appendFromJson(r):dt(r)&&this.appendFromString(r),this};xr.fromJson=function(r,e){var t=new xr(r);return t.fromJson(e),t};xr.fromString=function(r,e){return new xr(r).fromString(e)};[Er,xd,$S,as,Lv,XS,Sr,Iv].forEach(function(r){mt(zr,r)});xr.types=zr.types;xr.properties=zr.properties;xr.propertyGroups=zr.propertyGroups;xr.propertyGroupNames=zr.propertyGroupNames;xr.propertyGroupKeys=zr.propertyGroupKeys;var V6={style:function(e){if(e){var t=this.setStyle(e);t.update()}return this._private.style},setStyle:function(e){var t=this._private;return JU(e)?t.style=e.generateStyle(this):fn(e)?t.style=xr.fromJson(this,e):dt(e)?t.style=xr.fromString(this,e):t.style=xr(this),t.style},updateStyle:function(){this.mutableElements().updateStyle()}},H6="single",ql={autolock:function(e){if(e!==void 0)this._private.autolock=!!e;else return this._private.autolock;return this},autoungrabify:function(e){if(e!==void 0)this._private.autoungrabify=!!e;else return this._private.autoungrabify;return this},autounselectify:function(e){if(e!==void 0)this._private.autounselectify=!!e;else return this._private.autounselectify;return this},selectionType:function(e){var t=this._private;if(t.selectionType==null&&(t.selectionType=H6),e!==void 0)(e==="additive"||e==="single")&&(t.selectionType=e);else return t.selectionType;return this},panningEnabled:function(e){if(e!==void 0)this._private.panningEnabled=!!e;else return this._private.panningEnabled;return this},userPanningEnabled:function(e){if(e!==void 0)this._private.userPanningEnabled=!!e;else return this._private.userPanningEnabled;return this},zoomingEnabled:function(e){if(e!==void 0)this._private.zoomingEnabled=!!e;else return this._private.zoomingEnabled;return this},userZoomingEnabled:function(e){if(e!==void 0)this._private.userZoomingEnabled=!!e;else return this._private.userZoomingEnabled;return this},boxSelectionEnabled:function(e){if(e!==void 0)this._private.boxSelectionEnabled=!!e;else return this._private.boxSelectionEnabled;return this},pan:function(){var e=arguments,t=this._private.pan,n,i,a,s,o;switch(e.length){case 0:return t;case 1:if(dt(e[0]))return n=e[0],t[n];if($t(e[0])){if(!this._private.panningEnabled)return this;a=e[0],s=a.x,o=a.y,et(s)&&(t.x=s),et(o)&&(t.y=o),this.emit("pan viewport")}break;case 2:if(!this._private.panningEnabled)return this;n=e[0],i=e[1],(n==="x"||n==="y")&&et(i)&&(t[n]=i),this.emit("pan viewport");break}return this.notify("viewport"),this},panBy:function(e,t){var n=arguments,i=this._private.pan,a,s,o,l,u;if(!this._private.panningEnabled)return this;switch(n.length){case 1:$t(e)&&(o=n[0],l=o.x,u=o.y,et(l)&&(i.x+=l),et(u)&&(i.y+=u),this.emit("pan viewport"));break;case 2:a=e,s=t,(a==="x"||a==="y")&&et(s)&&(i[a]+=s),this.emit("pan viewport");break}return this.notify("viewport"),this},gc:function(){this.notify("gc")},fit:function(e,t){var n=this.getFitViewport(e,t);if(n){var i=this._private;i.zoom=n.zoom,i.pan=n.pan,this.emit("pan zoom viewport"),this.notify("viewport")}return this},getFitViewport:function(e,t){if(et(e)&&t===void 0&&(t=e,e=void 0),!(!this._private.panningEnabled||!this._private.zoomingEnabled)){var n;if(dt(e)){var i=e;e=this.$(i)}else if(FW(e)){var a=e;n={x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2},n.w=n.x2-n.x1,n.h=n.y2-n.y1}else ki(e)||(e=this.mutableElements());if(!(ki(e)&&e.empty())){n=n||e.boundingBox();var s=this.width(),o=this.height(),l;if(t=et(t)?t:0,!isNaN(s)&&!isNaN(o)&&s>0&&o>0&&!isNaN(n.w)&&!isNaN(n.h)&&n.w>0&&n.h>0){l=Math.min((s-2*t)/n.w,(o-2*t)/n.h),l=l>this._private.maxZoom?this._private.maxZoom:l,l=l<this._private.minZoom?this._private.minZoom:l;var u={x:(s-l*(n.x1+n.x2))/2,y:(o-l*(n.y1+n.y2))/2};return{zoom:l,pan:u}}}}},zoomRange:function(e,t){var n=this._private;if(t==null){var i=e;e=i.min,t=i.max}return et(e)&&et(t)&&e<=t?(n.minZoom=e,n.maxZoom=t):et(e)&&t===void 0&&e<=n.maxZoom?n.minZoom=e:et(t)&&e===void 0&&t>=n.minZoom&&(n.maxZoom=t),this},minZoom:function(e){return e===void 0?this._private.minZoom:this.zoomRange({min:e})},maxZoom:function(e){return e===void 0?this._private.maxZoom:this.zoomRange({max:e})},getZoomedViewport:function(e){var t=this._private,n=t.pan,i=t.zoom,a,s,o=!1;if(t.zoomingEnabled||(o=!0),et(e)?s=e:$t(e)&&(s=e.level,e.position!=null?a=Tv(e.position,i,n):e.renderedPosition!=null&&(a=e.renderedPosition),a!=null&&!t.panningEnabled&&(o=!0)),s=s>t.maxZoom?t.maxZoom:s,s=s<t.minZoom?t.minZoom:s,o||!et(s)||s===i||a!=null&&(!et(a.x)||!et(a.y)))return null;if(a!=null){var l=n,u=i,c=s,h={x:-c/u*(a.x-l.x)+a.x,y:-c/u*(a.y-l.y)+a.y};return{zoomed:!0,panned:!0,zoom:c,pan:h}}else return{zoomed:!0,panned:!1,zoom:s,pan:n}},zoom:function(e){if(e===void 0)return this._private.zoom;var t=this.getZoomedViewport(e),n=this._private;return t==null||!t.zoomed?this:(n.zoom=t.zoom,t.panned&&(n.pan.x=t.pan.x,n.pan.y=t.pan.y),this.emit("zoom"+(t.panned?" pan":"")+" viewport"),this.notify("viewport"),this)},viewport:function(e){var t=this._private,n=!0,i=!0,a=[],s=!1,o=!1;if(!e)return this;if(et(e.zoom)||(n=!1),$t(e.pan)||(i=!1),!n&&!i)return this;if(n){var l=e.zoom;l<t.minZoom||l>t.maxZoom||!t.zoomingEnabled?s=!0:(t.zoom=l,a.push("zoom"))}if(i&&(!s||!e.cancelOnFailedZoom)&&t.panningEnabled){var u=e.pan;et(u.x)&&(t.pan.x=u.x,o=!1),et(u.y)&&(t.pan.y=u.y,o=!1),o||a.push("pan")}return a.length>0&&(a.push("viewport"),this.emit(a.join(" ")),this.notify("viewport")),this},center:function(e){var t=this.getCenterPan(e);return t&&(this._private.pan=t,this.emit("pan viewport"),this.notify("viewport")),this},getCenterPan:function(e,t){if(!!this._private.panningEnabled){if(dt(e)){var n=e;e=this.mutableElements().filter(n)}else ki(e)||(e=this.mutableElements());if(e.length!==0){var i=e.boundingBox(),a=this.width(),s=this.height();t=t===void 0?this._private.zoom:t;var o={x:(a-t*(i.x1+i.x2))/2,y:(s-t*(i.y1+i.y2))/2};return o}}},reset:function(){return!this._private.panningEnabled||!this._private.zoomingEnabled?this:(this.viewport({pan:{x:0,y:0},zoom:1}),this)},invalidateSize:function(){this._private.sizeCache=null},size:function(){var e=this._private,t=e.container,n=this;return e.sizeCache=e.sizeCache||(t?function(){var i=n.window().getComputedStyle(t),a=function(o){return parseFloat(i.getPropertyValue(o))};return{width:t.clientWidth-a("padding-left")-a("padding-right"),height:t.clientHeight-a("padding-top")-a("padding-bottom")}}():{width:1,height:1})},width:function(){return this.size().width},height:function(){return this.size().height},extent:function(){var e=this._private.pan,t=this._private.zoom,n=this.renderedExtent(),i={x1:(n.x1-e.x)/t,x2:(n.x2-e.x)/t,y1:(n.y1-e.y)/t,y2:(n.y2-e.y)/t};return i.w=i.x2-i.x1,i.h=i.y2-i.y1,i},renderedExtent:function(){var e=this.width(),t=this.height();return{x1:0,y1:0,x2:e,y2:t,w:e,h:t}},multiClickDebounceTime:function(e){if(e)this._private.multiClickDebounceTime=e;else return this._private.multiClickDebounceTime;return this}};ql.centre=ql.center;ql.autolockNodes=ql.autolock;ql.autoungrabifyNodes=ql.autoungrabify;var Pf={data:tn.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeData:tn.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),scratch:tn.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:tn.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0})};Pf.attr=Pf.data;Pf.removeAttr=Pf.removeData;var Df=function(e){var t=this;e=mt({},e);var n=e.container;n&&!Bg(n)&&Bg(n[0])&&(n=n[0]);var i=n?n._cyreg:null;i=i||{},i&&i.cy&&(i.cy.destroy(),i={});var a=i.readies=i.readies||[];n&&(n._cyreg=i),i.cy=t;var s=tr!==void 0&&n!==void 0&&!e.headless,o=e;o.layout=mt({name:s?"grid":"null"},o.layout),o.renderer=mt({name:s?"canvas":"null"},o.renderer);var l=function(p,m,v){return m!==void 0?m:v!==void 0?v:p},u=this._private={container:n,ready:!1,options:o,elements:new Cr(this),listeners:[],aniEles:new Cr(this),data:o.data||{},scratch:{},layout:null,renderer:null,destroyed:!1,notificationsEnabled:!0,minZoom:1e-50,maxZoom:1e50,zoomingEnabled:l(!0,o.zoomingEnabled),userZoomingEnabled:l(!0,o.userZoomingEnabled),panningEnabled:l(!0,o.panningEnabled),userPanningEnabled:l(!0,o.userPanningEnabled),boxSelectionEnabled:l(!0,o.boxSelectionEnabled),autolock:l(!1,o.autolock,o.autolockNodes),autoungrabify:l(!1,o.autoungrabify,o.autoungrabifyNodes),autounselectify:l(!1,o.autounselectify),styleEnabled:o.styleEnabled===void 0?s:o.styleEnabled,zoom:et(o.zoom)?o.zoom:1,pan:{x:$t(o.pan)&&et(o.pan.x)?o.pan.x:0,y:$t(o.pan)&&et(o.pan.y)?o.pan.y:0},animation:{current:[],queue:[]},hasCompoundNodes:!1,multiClickDebounceTime:l(250,o.multiClickDebounceTime)};this.createEmitter(),this.selectionType(o.selectionType),this.zoomRange({min:o.minZoom,max:o.maxZoom});var c=function(p,m){var v=p.some(BW);if(v)return Kc.all(p).then(m);m(p)};u.styleEnabled&&t.setStyle([]);var h=mt({},o,o.renderer);t.initRenderer(h);var d=function(p,m,v){t.notifications(!1);var g=t.mutableElements();g.length>0&&g.remove(),p!=null&&($t(p)||fn(p))&&t.add(p),t.one("layoutready",function(_){t.notifications(!0),t.emit(_),t.one("load",m),t.emitAndNotify("load")}).one("layoutstop",function(){t.one("done",v),t.emit("done")});var y=mt({},t._private.options.layout);y.eles=t.elements(),t.layout(y).run()};c([o.style,o.elements],function(f){var p=f[0],m=f[1];u.styleEnabled&&t.style().append(p),d(m,function(){t.startAnimationLoop(),u.ready=!0,Pn(o.ready)&&t.on("ready",o.ready);for(var v=0;v<a.length;v++){var g=a[v];t.on("ready",g)}i&&(i.readies=[]),t.emit("ready")},o.done)})},Wg=Df.prototype;mt(Wg,{instanceString:function(){return"core"},isReady:function(){return this._private.ready},destroyed:function(){return this._private.destroyed},ready:function(e){return this.isReady()?this.emitter().emit("ready",[],e):this.on("ready",e),this},destroy:function(){var e=this;if(!e.destroyed())return e.stopAnimationLoop(),e.destroyRenderer(),this.emit("destroy"),e._private.destroyed=!0,e},hasElementWithId:function(e){return this._private.elements.hasElementWithId(e)},getElementById:function(e){return this._private.elements.getElementById(e)},hasCompoundNodes:function(){return this._private.hasCompoundNodes},headless:function(){return this._private.renderer.isHeadless()},styleEnabled:function(){return this._private.styleEnabled},addToPool:function(e){return this._private.elements.merge(e),this},removeFromPool:function(e){return this._private.elements.unmerge(e),this},container:function(){return this._private.container||null},window:function(){var e=this._private.container;if(e==null)return tr;var t=this._private.container.ownerDocument;return t===void 0||t==null?tr:t.defaultView||tr},mount:function(e){if(e!=null){var t=this,n=t._private,i=n.options;return!Bg(e)&&Bg(e[0])&&(e=e[0]),t.stopAnimationLoop(),t.destroyRenderer(),n.container=e,n.styleEnabled=!0,t.invalidateSize(),t.initRenderer(mt({},i,i.renderer,{name:i.renderer.name==="null"?"canvas":i.renderer.name})),t.startAnimationLoop(),t.style(i.style),t.emit("mount"),t}},unmount:function(){var e=this;return e.stopAnimationLoop(),e.destroyRenderer(),e.initRenderer({name:"null"}),e.emit("unmount"),e},options:function(){return es(this._private.options)},json:function(e){var t=this,n=t._private,i=t.mutableElements(),a=function(x){return t.getElementById(x.id())};if($t(e)){if(t.startBatch(),e.elements){var s={},o=function(x,E){for(var T=[],b=[],w=0;w<x.length;w++){var A=x[w];if(!A.data.id){nn("cy.json() cannot handle elements without an ID attribute");continue}var S=""+A.data.id,C=t.getElementById(S);s[S]=!0,C.length!==0?b.push({ele:C,json:A}):(E&&(A.group=E),T.push(A))}t.add(T);for(var R=0;R<b.length;R++){var P=b[R],M=P.ele,N=P.json;M.json(N)}};if(fn(e.elements))o(e.elements);else for(var l=["nodes","edges"],u=0;u<l.length;u++){var c=l[u],h=e.elements[c];fn(h)&&o(h,c)}var d=t.collection();i.filter(function(_){return!s[_.id()]}).forEach(function(_){_.isParent()?d.merge(_):_.remove()}),d.forEach(function(_){return _.children().move({parent:null})}),d.forEach(function(_){return a(_).remove()})}e.style&&t.style(e.style),e.zoom!=null&&e.zoom!==n.zoom&&t.zoom(e.zoom),e.pan&&(e.pan.x!==n.pan.x||e.pan.y!==n.pan.y)&&t.pan(e.pan),e.data&&t.data(e.data);for(var f=["minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","panningEnabled","userPanningEnabled","boxSelectionEnabled","autolock","autoungrabify","autounselectify","multiClickDebounceTime"],p=0;p<f.length;p++){var m=f[p];e[m]!=null&&t[m](e[m])}return t.endBatch(),this}else{var v=!!e,g={};v?g.elements=this.elements().map(function(_){return _.json()}):(g.elements={},i.forEach(function(_){var x=_.group();g.elements[x]||(g.elements[x]=[]),g.elements[x].push(_.json())})),this._private.styleEnabled&&(g.style=t.style().json()),g.data=es(t.data());var y=n.options;return g.zoomingEnabled=n.zoomingEnabled,g.userZoomingEnabled=n.userZoomingEnabled,g.zoom=n.zoom,g.minZoom=n.minZoom,g.maxZoom=n.maxZoom,g.panningEnabled=n.panningEnabled,g.userPanningEnabled=n.userPanningEnabled,g.pan=es(n.pan),g.boxSelectionEnabled=n.boxSelectionEnabled,g.renderer=es(y.renderer),g.hideEdgesOnViewport=y.hideEdgesOnViewport,g.textureOnViewport=y.textureOnViewport,g.wheelSensitivity=y.wheelSensitivity,g.motionBlur=y.motionBlur,g.multiClickDebounceTime=y.multiClickDebounceTime,g}}});Wg.$id=Wg.getElementById;[D6,B6,Jk,Dw,mg,k6,Lw,yg,V6,ql,Pf].forEach(function(r){mt(Wg,r)});var W6={fit:!0,directed:!1,padding:30,circle:!1,grid:!1,spacingFactor:1.75,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,roots:void 0,depthSort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}},q6={maximal:!1,acyclic:!1},mu=function(e){return e.scratch("breadthfirst")},iN=function(e,t){return e.scratch("breadthfirst",t)};function e3(r){this.options=mt({},W6,q6,r)}e3.prototype.run=function(){var r=this.options,e=r.cy,t=r.eles,n=t.nodes().filter(function(pe){return pe.isChildless()}),i=t,a=r.directed,s=r.acyclic||r.maximal||r.maximalAdjustments>0,o=!!r.boundingBox,l=e.extent(),u=bi(o?r.boundingBox:{x1:l.x1,y1:l.y1,w:l.w,h:l.h}),c;if(ki(r.roots))c=r.roots;else if(fn(r.roots)){for(var h=[],d=0;d<r.roots.length;d++){var f=r.roots[d],p=e.getElementById(f);h.push(p)}c=e.collection(h)}else if(dt(r.roots))c=e.$(r.roots);else if(a)c=n.roots();else{var m=t.components();c=e.collection();for(var v=function(){var Me=m[g],Ae=Me.maxDegree(!1),j=Me.filter(function(H){return H.degree(!1)===Ae});c=c.add(j)},g=0;g<m.length;g++)v()}var y=[],_={},x=function(Me,Ae){y[Ae]==null&&(y[Ae]=[]);var j=y[Ae].length;y[Ae].push(Me),iN(Me,{index:j,depth:Ae})},E=function(Me,Ae){var j=mu(Me),H=j.depth,te=j.index;y[H][te]=null,Me.isChildless()&&x(Me,Ae)};i.bfs({roots:c,directed:r.directed,visit:function(Me,Ae,j,H,te){var me=Me[0],Ee=me.id();me.isChildless()&&x(me,te),_[Ee]=!0}});for(var T=[],b=0;b<n.length;b++){var w=n[b];_[w.id()]||T.push(w)}var A=function(Me){for(var Ae=y[Me],j=0;j<Ae.length;j++){var H=Ae[j];if(H==null){Ae.splice(j,1),j--;continue}iN(H,{depth:Me,index:j})}},S=function(Me,Ae){for(var j=mu(Me),H=Me.incomers().filter(function(fe){return fe.isNode()&&t.has(fe)}),te=-1,me=Me.id(),Ee=0;Ee<H.length;Ee++){var le=H[Ee],q=mu(le);te=Math.max(te,q.depth)}if(j.depth<=te){if(!r.acyclic&&Ae[me])return null;var ne=te+1;return E(Me,ne),Ae[me]=ne,!0}return!1};if(a&&s){var C=[],R={},P=function(Me){return C.push(Me)},M=function(){return C.shift()};for(n.forEach(function(pe){return C.push(pe)});C.length>0;){var N=M(),D=S(N,R);if(D)N.outgoers().filter(function(pe){return pe.isNode()&&t.has(pe)}).forEach(P);else if(D===null){nn("Detected double maximal shift for node `"+N.id()+"`.  Bailing maximal adjustment due to cycle.  Use `options.maximal: true` only on DAGs.");break}}}var I=0;if(r.avoidOverlap)for(var L=0;L<n.length;L++){var z=n[L],B=z.layoutDimensions(r),k=B.w,U=B.h;I=Math.max(I,k,U)}var G={},O=function(Me){if(G[Me.id()])return G[Me.id()];for(var Ae=mu(Me).depth,j=Me.neighborhood(),H=0,te=0,me=0;me<j.length;me++){var Ee=j[me];if(!(Ee.isEdge()||Ee.isParent()||!n.has(Ee))){var le=mu(Ee);if(le!=null){var q=le.index,ne=le.depth;if(!(q==null||ne==null)){var fe=y[ne].length;ne<Ae&&(H+=q/fe,te++)}}}}return te=Math.max(1,te),H=H/te,te===0&&(H=0),G[Me.id()]=H,H},F=function(Me,Ae){var j=O(Me),H=O(Ae),te=j-H;return te===0?tk(Me.id(),Ae.id()):te};r.depthSort!==void 0&&(F=r.depthSort);for(var V=y.length,$=0;$<V;$++)y[$].sort(F),A($);for(var Z=[],Y=0;Y<T.length;Y++)Z.push(T[Y]);var X=function(){for(var Me=0;Me<V;Me++)A(Me)};Z.length&&(y.unshift(Z),V=y.length,X());for(var K=0,se=0;se<V;se++)K=Math.max(y[se].length,K);var oe={x:u.x1+u.w/2,y:u.y1+u.h/2},W=n.reduce(function(pe,Me){return function(Ae){return{w:pe.w===-1?Ae.w:(pe.w+Ae.w)/2,h:pe.h===-1?Ae.h:(pe.h+Ae.h)/2}}(Me.boundingBox({includeLabels:r.nodeDimensionsIncludeLabels}))},{w:-1,h:-1}),Ne=Math.max(V===1?0:o?(u.h-r.padding*2-W.h)/(V-1):(u.h-r.padding*2-W.h)/(V+1),I),Be=y.reduce(function(pe,Me){return Math.max(pe,Me.length)},0),we=function(Me){var Ae=mu(Me),j=Ae.depth,H=Ae.index;if(r.circle){var te=Math.min(u.w/2/V,u.h/2/V);te=Math.max(te,I);var me=te*j+te-(V>0&&y[0].length<=3?te/2:0),Ee=2*Math.PI/y[j].length*H;return j===0&&y[0].length===1&&(me=1),{x:oe.x+me*Math.cos(Ee),y:oe.y+me*Math.sin(Ee)}}else{var le=y[j].length,q=Math.max(le===1?0:o?(u.w-r.padding*2-W.w)/((r.grid?Be:le)-1):(u.w-r.padding*2-W.w)/((r.grid?Be:le)+1),I),ne={x:oe.x+(H+1-(le+1)/2)*q,y:oe.y+(j+1-(V+1)/2)*Ne};return ne}};return t.nodes().layoutPositions(this,r,we),this};var $6={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,radius:void 0,startAngle:3/2*Math.PI,sweep:void 0,clockwise:!0,sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function t3(r){this.options=mt({},$6,r)}t3.prototype.run=function(){var r=this.options,e=r,t=r.cy,n=e.eles,i=e.counterclockwise!==void 0?!e.counterclockwise:e.clockwise,a=n.nodes().not(":parent");e.sort&&(a=a.sort(e.sort));for(var s=bi(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:t.width(),h:t.height()}),o={x:s.x1+s.w/2,y:s.y1+s.h/2},l=e.sweep===void 0?2*Math.PI-2*Math.PI/a.length:e.sweep,u=l/Math.max(1,a.length-1),c,h=0,d=0;d<a.length;d++){var f=a[d],p=f.layoutDimensions(e),m=p.w,v=p.h;h=Math.max(h,m,v)}if(et(e.radius)?c=e.radius:a.length<=1?c=0:c=Math.min(s.h,s.w)/2-h,a.length>1&&e.avoidOverlap){h*=1.75;var g=Math.cos(u)-Math.cos(0),y=Math.sin(u)-Math.sin(0),_=Math.sqrt(h*h/(g*g+y*y));c=Math.max(_,c)}var x=function(T,b){var w=e.startAngle+b*u*(i?1:-1),A=c*Math.cos(w),S=c*Math.sin(w),C={x:o.x+A,y:o.y+S};return C};return n.nodes().layoutPositions(this,e,x),this};var X6={fit:!0,padding:30,startAngle:3/2*Math.PI,sweep:void 0,clockwise:!0,equidistant:!1,minNodeSpacing:10,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,height:void 0,width:void 0,spacingFactor:void 0,concentric:function(e){return e.degree()},levelWidth:function(e){return e.maxDegree()/4},animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function n3(r){this.options=mt({},X6,r)}n3.prototype.run=function(){for(var r=this.options,e=r,t=e.counterclockwise!==void 0?!e.counterclockwise:e.clockwise,n=r.cy,i=e.eles,a=i.nodes().not(":parent"),s=bi(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:n.width(),h:n.height()}),o={x:s.x1+s.w/2,y:s.y1+s.h/2},l=[],u=0,c=0;c<a.length;c++){var h=a[c],d=void 0;d=e.concentric(h),l.push({value:d,node:h}),h._private.scratch.concentric=d}a.updateStyle();for(var f=0;f<a.length;f++){var p=a[f],m=p.layoutDimensions(e);u=Math.max(u,m.w,m.h)}l.sort(function(W,Ne){return Ne.value-W.value});for(var v=e.levelWidth(a),g=[[]],y=g[0],_=0;_<l.length;_++){var x=l[_];if(y.length>0){var E=Math.abs(y[0].value-x.value);E>=v&&(y=[],g.push(y))}y.push(x)}var T=u+e.minNodeSpacing;if(!e.avoidOverlap){var b=g.length>0&&g[0].length>1,w=Math.min(s.w,s.h)/2-T,A=w/(g.length+b?1:0);T=Math.min(T,A)}for(var S=0,C=0;C<g.length;C++){var R=g[C],P=e.sweep===void 0?2*Math.PI-2*Math.PI/R.length:e.sweep,M=R.dTheta=P/Math.max(1,R.length-1);if(R.length>1&&e.avoidOverlap){var N=Math.cos(M)-Math.cos(0),D=Math.sin(M)-Math.sin(0),I=Math.sqrt(T*T/(N*N+D*D));S=Math.max(I,S)}R.r=S,S+=T}if(e.equidistant){for(var L=0,z=0,B=0;B<g.length;B++){var k=g[B],U=k.r-z;L=Math.max(L,U)}z=0;for(var G=0;G<g.length;G++){var O=g[G];G===0&&(z=O.r),O.r=z,z+=L}}for(var F={},V=0;V<g.length;V++)for(var $=g[V],Z=$.dTheta,Y=$.r,X=0;X<$.length;X++){var K=$[X],se=e.startAngle+(t?1:-1)*Z*X,oe={x:o.x+Y*Math.cos(se),y:o.y+Y*Math.sin(se)};F[K.node.id()]=oe}return i.nodes().layoutPositions(this,e,function(W){var Ne=W.id();return F[Ne]}),this};var l0,Y6={ready:function(){},stop:function(){},animate:!0,animationEasing:void 0,animationDuration:void 0,animateFilter:function(e,t){return!0},animationThreshold:250,refresh:20,fit:!0,padding:30,boundingBox:void 0,nodeDimensionsIncludeLabels:!1,randomize:!1,componentSpacing:40,nodeRepulsion:function(e){return 2048},nodeOverlap:4,idealEdgeLength:function(e){return 32},edgeElasticity:function(e){return 32},nestingFactor:1.2,gravity:1,numIter:1e3,initialTemp:1e3,coolingFactor:.99,minTemp:1};function Ov(r){this.options=mt({},Y6,r),this.options.layout=this;var e=this.options.eles.nodes(),t=this.options.eles.edges(),n=t.filter(function(i){var a=i.source().data("id"),s=i.target().data("id"),o=e.some(function(u){return u.data("id")===a}),l=e.some(function(u){return u.data("id")===s});return!o||!l});this.options.eles=this.options.eles.not(n)}Ov.prototype.run=function(){var r=this.options,e=r.cy,t=this;t.stopped=!1,(r.animate===!0||r.animate===!1)&&t.emit({type:"layoutstart",layout:t}),r.debug===!0?l0=!0:l0=!1;var n=j6(e,t,r);l0&&Q6(n),r.randomize&&Z6(n);var i=qs(),a=function(){J6(n,e,r),r.fit===!0&&e.fit(r.padding)},s=function(d){return!(t.stopped||d>=r.numIter||(eX(n,r),n.temperature=n.temperature*r.coolingFactor,n.temperature<r.minTemp))},o=function(){if(r.animate===!0||r.animate===!1)a(),t.one("layoutstop",r.stop),t.emit({type:"layoutstop",layout:t});else{var d=r.eles.nodes(),f=i3(n,r,d);d.layoutPositions(t,r,f)}},l=0,u=!0;if(r.animate===!0){var c=function(){for(var d=0;u&&d<r.refresh;)u=s(l),l++,d++;if(!u)sN(n,r),o();else{var f=qs();f-i>=r.animationThreshold&&a(),Ug(c)}};c()}else{for(;u;)u=s(l),l++;sN(n,r),o()}return this};Ov.prototype.stop=function(){return this.stopped=!0,this.thread&&this.thread.stop(),this.emit("layoutstop"),this};Ov.prototype.destroy=function(){return this.thread&&this.thread.stop(),this};var j6=function(e,t,n){for(var i=n.eles.edges(),a=n.eles.nodes(),s=bi(n.boundingBox?n.boundingBox:{x1:0,y1:0,w:e.width(),h:e.height()}),o={isCompound:e.hasCompoundNodes(),layoutNodes:[],idToIndex:{},nodeSize:a.size(),graphSet:[],indexToGraph:[],layoutEdges:[],edgeSize:i.size(),temperature:n.initialTemp,clientWidth:s.w,clientHeight:s.h,boundingBox:s},l=n.eles.components(),u={},c=0;c<l.length;c++)for(var h=l[c],d=0;d<h.length;d++){var f=h[d];u[f.id()]=c}for(var c=0;c<o.nodeSize;c++){var p=a[c],m=p.layoutDimensions(n),v={};v.isLocked=p.locked(),v.id=p.data("id"),v.parentId=p.data("parent"),v.cmptId=u[p.id()],v.children=[],v.positionX=p.position("x"),v.positionY=p.position("y"),v.offsetX=0,v.offsetY=0,v.height=m.w,v.width=m.h,v.maxX=v.positionX+v.width/2,v.minX=v.positionX-v.width/2,v.maxY=v.positionY+v.height/2,v.minY=v.positionY-v.height/2,v.padLeft=parseFloat(p.style("padding")),v.padRight=parseFloat(p.style("padding")),v.padTop=parseFloat(p.style("padding")),v.padBottom=parseFloat(p.style("padding")),v.nodeRepulsion=Pn(n.nodeRepulsion)?n.nodeRepulsion(p):n.nodeRepulsion,o.layoutNodes.push(v),o.idToIndex[v.id]=c}for(var g=[],y=0,_=-1,x=[],c=0;c<o.nodeSize;c++){var p=o.layoutNodes[c],E=p.parentId;E!=null?o.layoutNodes[o.idToIndex[E]].children.push(p.id):(g[++_]=p.id,x.push(p.id))}for(o.graphSet.push(x);y<=_;){var T=g[y++],b=o.idToIndex[T],f=o.layoutNodes[b],w=f.children;if(w.length>0){o.graphSet.push(w);for(var c=0;c<w.length;c++)g[++_]=w[c]}}for(var c=0;c<o.graphSet.length;c++)for(var A=o.graphSet[c],d=0;d<A.length;d++){var S=o.idToIndex[A[d]];o.indexToGraph[S]=c}for(var c=0;c<o.edgeSize;c++){var C=i[c],R={};R.id=C.data("id"),R.sourceId=C.data("source"),R.targetId=C.data("target");var P=Pn(n.idealEdgeLength)?n.idealEdgeLength(C):n.idealEdgeLength,M=Pn(n.edgeElasticity)?n.edgeElasticity(C):n.edgeElasticity,N=o.idToIndex[R.sourceId],D=o.idToIndex[R.targetId],I=o.indexToGraph[N],L=o.indexToGraph[D];if(I!=L){for(var z=K6(R.sourceId,R.targetId,o),B=o.graphSet[z],k=0,v=o.layoutNodes[N];B.indexOf(v.id)===-1;)v=o.layoutNodes[o.idToIndex[v.parentId]],k++;for(v=o.layoutNodes[D];B.indexOf(v.id)===-1;)v=o.layoutNodes[o.idToIndex[v.parentId]],k++;P*=k*n.nestingFactor}R.idealLength=P,R.elasticity=M,o.layoutEdges.push(R)}return o},K6=function(e,t,n){var i=r3(e,t,0,n);return 2>i.count?0:i.graph},r3=function(e,t,n,i){var a=i.graphSet[n];if(-1<a.indexOf(e)&&-1<a.indexOf(t))return{count:2,graph:n};for(var s=0,o=0;o<a.length;o++){var l=a[o],u=i.idToIndex[l],c=i.layoutNodes[u].children;if(c.length!==0){var h=i.indexToGraph[i.idToIndex[c[0]]],d=r3(e,t,h,i);if(d.count!==0)if(d.count===1){if(s++,s===2)break}else return d}}return{count:s,graph:n}},Q6,Z6=function(e,t){for(var n=e.clientWidth,i=e.clientHeight,a=0;a<e.nodeSize;a++){var s=e.layoutNodes[a];s.children.length===0&&!s.isLocked&&(s.positionX=Math.random()*n,s.positionY=Math.random()*i)}},i3=function(e,t,n){var i=e.boundingBox,a={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0};return t.boundingBox&&(n.forEach(function(s){var o=e.layoutNodes[e.idToIndex[s.data("id")]];a.x1=Math.min(a.x1,o.positionX),a.x2=Math.max(a.x2,o.positionX),a.y1=Math.min(a.y1,o.positionY),a.y2=Math.max(a.y2,o.positionY)}),a.w=a.x2-a.x1,a.h=a.y2-a.y1),function(s,o){var l=e.layoutNodes[e.idToIndex[s.data("id")]];if(t.boundingBox){var u=(l.positionX-a.x1)/a.w,c=(l.positionY-a.y1)/a.h;return{x:i.x1+u*i.w,y:i.y1+c*i.h}}else return{x:l.positionX,y:l.positionY}}},J6=function(e,t,n){var i=n.layout,a=n.eles.nodes(),s=i3(e,n,a);a.positions(s),e.ready!==!0&&(e.ready=!0,i.one("layoutready",n.ready),i.emit({type:"layoutready",layout:this}))},eX=function(e,t,n){tX(e,t),iX(e),aX(e,t),sX(e),oX(e)},tX=function(e,t){for(var n=0;n<e.graphSet.length;n++)for(var i=e.graphSet[n],a=i.length,s=0;s<a;s++)for(var o=e.layoutNodes[e.idToIndex[i[s]]],l=s+1;l<a;l++){var u=e.layoutNodes[e.idToIndex[i[l]]];nX(o,u,e,t)}},aN=function(e){return-1+2*e*Math.random()},nX=function(e,t,n,i){var a=e.cmptId,s=t.cmptId;if(!(a!==s&&!n.isCompound)){var o=t.positionX-e.positionX,l=t.positionY-e.positionY,u=1;o===0&&l===0&&(o=aN(u),l=aN(u));var c=rX(e,t,o,l);if(c>0)var h=i.nodeOverlap*c,d=Math.sqrt(o*o+l*l),f=h*o/d,p=h*l/d;else var m=qg(e,o,l),v=qg(t,-1*o,-1*l),g=v.x-m.x,y=v.y-m.y,_=g*g+y*y,d=Math.sqrt(_),h=(e.nodeRepulsion+t.nodeRepulsion)/_,f=h*g/d,p=h*y/d;e.isLocked||(e.offsetX-=f,e.offsetY-=p),t.isLocked||(t.offsetX+=f,t.offsetY+=p)}},rX=function(e,t,n,i){if(n>0)var a=e.maxX-t.minX;else var a=t.maxX-e.minX;if(i>0)var s=e.maxY-t.minY;else var s=t.maxY-e.minY;return a>=0&&s>=0?Math.sqrt(a*a+s*s):0},qg=function(e,t,n){var i=e.positionX,a=e.positionY,s=e.height||1,o=e.width||1,l=n/t,u=s/o,c={};return t===0&&0<n||t===0&&0>n?(c.x=i,c.y=a+s/2,c):0<t&&-1*u<=l&&l<=u?(c.x=i+o/2,c.y=a+o*n/2/t,c):0>t&&-1*u<=l&&l<=u?(c.x=i-o/2,c.y=a-o*n/2/t,c):0<n&&(l<=-1*u||l>=u)?(c.x=i+s*t/2/n,c.y=a+s/2,c):(0>n&&(l<=-1*u||l>=u)&&(c.x=i-s*t/2/n,c.y=a-s/2),c)},iX=function(e,t){for(var n=0;n<e.edgeSize;n++){var i=e.layoutEdges[n],a=e.idToIndex[i.sourceId],s=e.layoutNodes[a],o=e.idToIndex[i.targetId],l=e.layoutNodes[o],u=l.positionX-s.positionX,c=l.positionY-s.positionY;if(!(u===0&&c===0)){var h=qg(s,u,c),d=qg(l,-1*u,-1*c),f=d.x-h.x,p=d.y-h.y,m=Math.sqrt(f*f+p*p),v=Math.pow(i.idealLength-m,2)/i.elasticity;if(m!==0)var g=v*f/m,y=v*p/m;else var g=0,y=0;s.isLocked||(s.offsetX+=g,s.offsetY+=y),l.isLocked||(l.offsetX-=g,l.offsetY-=y)}}},aX=function(e,t){if(t.gravity!==0)for(var n=1,i=0;i<e.graphSet.length;i++){var a=e.graphSet[i],s=a.length;if(i===0)var o=e.clientHeight/2,l=e.clientWidth/2;else var u=e.layoutNodes[e.idToIndex[a[0]]],c=e.layoutNodes[e.idToIndex[u.parentId]],o=c.positionX,l=c.positionY;for(var h=0;h<s;h++){var d=e.layoutNodes[e.idToIndex[a[h]]];if(!d.isLocked){var f=o-d.positionX,p=l-d.positionY,m=Math.sqrt(f*f+p*p);if(m>n){var v=t.gravity*f/m,g=t.gravity*p/m;d.offsetX+=v,d.offsetY+=g}}}}},sX=function(e,t){var n=[],i=0,a=-1;for(n.push.apply(n,e.graphSet[0]),a+=e.graphSet[0].length;i<=a;){var s=n[i++],o=e.idToIndex[s],l=e.layoutNodes[o],u=l.children;if(0<u.length&&!l.isLocked){for(var c=l.offsetX,h=l.offsetY,d=0;d<u.length;d++){var f=e.layoutNodes[e.idToIndex[u[d]]];f.offsetX+=c,f.offsetY+=h,n[++a]=u[d]}l.offsetX=0,l.offsetY=0}}},oX=function(e,t){for(var n=0;n<e.nodeSize;n++){var i=e.layoutNodes[n];0<i.children.length&&(i.maxX=void 0,i.minX=void 0,i.maxY=void 0,i.minY=void 0)}for(var n=0;n<e.nodeSize;n++){var i=e.layoutNodes[n];if(!(0<i.children.length||i.isLocked)){var a=lX(i.offsetX,i.offsetY,e.temperature);i.positionX+=a.x,i.positionY+=a.y,i.offsetX=0,i.offsetY=0,i.minX=i.positionX-i.width,i.maxX=i.positionX+i.width,i.minY=i.positionY-i.height,i.maxY=i.positionY+i.height,a3(i,e)}}for(var n=0;n<e.nodeSize;n++){var i=e.layoutNodes[n];0<i.children.length&&!i.isLocked&&(i.positionX=(i.maxX+i.minX)/2,i.positionY=(i.maxY+i.minY)/2,i.width=i.maxX-i.minX,i.height=i.maxY-i.minY)}},lX=function(e,t,n){var i=Math.sqrt(e*e+t*t);if(i>n)var a={x:n*e/i,y:n*t/i};else var a={x:e,y:t};return a},a3=function(e,t){var n=e.parentId;if(n!=null){var i=t.layoutNodes[t.idToIndex[n]],a=!1;if((i.maxX==null||e.maxX+i.padRight>i.maxX)&&(i.maxX=e.maxX+i.padRight,a=!0),(i.minX==null||e.minX-i.padLeft<i.minX)&&(i.minX=e.minX-i.padLeft,a=!0),(i.maxY==null||e.maxY+i.padBottom>i.maxY)&&(i.maxY=e.maxY+i.padBottom,a=!0),(i.minY==null||e.minY-i.padTop<i.minY)&&(i.minY=e.minY-i.padTop,a=!0),a)return a3(i,t)}},sN=function(e,t){for(var n=e.layoutNodes,i=[],a=0;a<n.length;a++){var s=n[a],o=s.cmptId,l=i[o]=i[o]||[];l.push(s)}for(var u=0,a=0;a<i.length;a++){var c=i[a];if(!!c){c.x1=1/0,c.x2=-1/0,c.y1=1/0,c.y2=-1/0;for(var h=0;h<c.length;h++){var d=c[h];c.x1=Math.min(c.x1,d.positionX-d.width/2),c.x2=Math.max(c.x2,d.positionX+d.width/2),c.y1=Math.min(c.y1,d.positionY-d.height/2),c.y2=Math.max(c.y2,d.positionY+d.height/2)}c.w=c.x2-c.x1,c.h=c.y2-c.y1,u+=c.w*c.h}}i.sort(function(y,_){return _.w*_.h-y.w*y.h});for(var f=0,p=0,m=0,v=0,g=Math.sqrt(u)*e.clientWidth/e.clientHeight,a=0;a<i.length;a++){var c=i[a];if(!!c){for(var h=0;h<c.length;h++){var d=c[h];d.isLocked||(d.positionX+=f-c.x1,d.positionY+=p-c.y1)}f+=c.w+t.componentSpacing,m+=c.w+t.componentSpacing,v=Math.max(v,c.h),m>g&&(p+=v+t.componentSpacing,f=0,m=0,v=0)}}},uX={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,avoidOverlapPadding:10,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,condense:!1,rows:void 0,cols:void 0,position:function(e){},sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function s3(r){this.options=mt({},uX,r)}s3.prototype.run=function(){var r=this.options,e=r,t=r.cy,n=e.eles,i=n.nodes().not(":parent");e.sort&&(i=i.sort(e.sort));var a=bi(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:t.width(),h:t.height()});if(a.h===0||a.w===0)n.nodes().layoutPositions(this,e,function(G){return{x:a.x1,y:a.y1}});else{var s=i.size(),o=Math.sqrt(s*a.h/a.w),l=Math.round(o),u=Math.round(a.w/a.h*o),c=function(O){if(O==null)return Math.min(l,u);var F=Math.min(l,u);F==l?l=O:u=O},h=function(O){if(O==null)return Math.max(l,u);var F=Math.max(l,u);F==l?l=O:u=O},d=e.rows,f=e.cols!=null?e.cols:e.columns;if(d!=null&&f!=null)l=d,u=f;else if(d!=null&&f==null)l=d,u=Math.ceil(s/l);else if(d==null&&f!=null)u=f,l=Math.ceil(s/u);else if(u*l>s){var p=c(),m=h();(p-1)*m>=s?c(p-1):(m-1)*p>=s&&h(m-1)}else for(;u*l<s;){var v=c(),g=h();(g+1)*v>=s?h(g+1):c(v+1)}var y=a.w/u,_=a.h/l;if(e.condense&&(y=0,_=0),e.avoidOverlap)for(var x=0;x<i.length;x++){var E=i[x],T=E._private.position;(T.x==null||T.y==null)&&(T.x=0,T.y=0);var b=E.layoutDimensions(e),w=e.avoidOverlapPadding,A=b.w+w,S=b.h+w;y=Math.max(y,A),_=Math.max(_,S)}for(var C={},R=function(O,F){return!!C["c-"+O+"-"+F]},P=function(O,F){C["c-"+O+"-"+F]=!0},M=0,N=0,D=function(){N++,N>=u&&(N=0,M++)},I={},L=0;L<i.length;L++){var z=i[L],B=e.position(z);if(B&&(B.row!==void 0||B.col!==void 0)){var k={row:B.row,col:B.col};if(k.col===void 0)for(k.col=0;R(k.row,k.col);)k.col++;else if(k.row===void 0)for(k.row=0;R(k.row,k.col);)k.row++;I[z.id()]=k,P(k.row,k.col)}}var U=function(O,F){var V,$;if(O.locked()||O.isParent())return!1;var Z=I[O.id()];if(Z)V=Z.col*y+y/2+a.x1,$=Z.row*_+_/2+a.y1;else{for(;R(M,N);)D();V=N*y+y/2+a.x1,$=M*_+_/2+a.y1,P(M,N),D()}return{x:V,y:$}};i.layoutPositions(this,e,U)}return this};var cX={ready:function(){},stop:function(){}};function YS(r){this.options=mt({},cX,r)}YS.prototype.run=function(){var r=this.options,e=r.eles,t=this;return r.cy,t.emit("layoutstart"),e.nodes().positions(function(){return{x:0,y:0}}),t.one("layoutready",r.ready),t.emit("layoutready"),t.one("layoutstop",r.stop),t.emit("layoutstop"),this};YS.prototype.stop=function(){return this};var hX={positions:void 0,zoom:void 0,pan:void 0,fit:!0,padding:30,spacingFactor:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function o3(r){this.options=mt({},hX,r)}o3.prototype.run=function(){var r=this.options,e=r.eles,t=e.nodes(),n=Pn(r.positions);function i(a){if(r.positions==null)return Oq(a.position());if(n)return r.positions(a);var s=r.positions[a._private.data.id];return s==null?null:s}return t.layoutPositions(this,r,function(a,s){var o=i(a);return a.locked()||o==null?!1:o}),this};var fX={fit:!0,padding:30,boundingBox:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function l3(r){this.options=mt({},fX,r)}l3.prototype.run=function(){var r=this.options,e=r.cy,t=r.eles,n=bi(r.boundingBox?r.boundingBox:{x1:0,y1:0,w:e.width(),h:e.height()}),i=function(s,o){return{x:n.x1+Math.round(Math.random()*n.w),y:n.y1+Math.round(Math.random()*n.h)}};return t.nodes().layoutPositions(this,r,i),this};var dX=[{name:"breadthfirst",impl:e3},{name:"circle",impl:t3},{name:"concentric",impl:n3},{name:"cose",impl:Ov},{name:"grid",impl:s3},{name:"null",impl:YS},{name:"preset",impl:o3},{name:"random",impl:l3}];function u3(r){this.options=r,this.notifications=0}var oN=function(){},lN=function(){throw new Error("A headless instance can not render images")};u3.prototype={recalculateRenderedStyle:oN,notify:function(){this.notifications++},init:oN,isHeadless:function(){return!0},png:lN,jpg:lN};var jS={};jS.arrowShapeWidth=.3;jS.registerArrowShapes=function(){var r=this.arrowShapes={},e=this,t=function(u,c,h,d,f,p,m){var v=f.x-h/2-m,g=f.x+h/2+m,y=f.y-h/2-m,_=f.y+h/2+m,x=v<=u&&u<=g&&y<=c&&c<=_;return x},n=function(u,c,h,d,f){var p=u*Math.cos(d)-c*Math.sin(d),m=u*Math.sin(d)+c*Math.cos(d),v=p*h,g=m*h,y=v+f.x,_=g+f.y;return{x:y,y:_}},i=function(u,c,h,d){for(var f=[],p=0;p<u.length;p+=2){var m=u[p],v=u[p+1];f.push(n(m,v,c,h,d))}return f},a=function(u){for(var c=[],h=0;h<u.length;h++){var d=u[h];c.push(d.x,d.y)}return c},s=function(u){return u.pstyle("width").pfValue*u.pstyle("arrow-scale").pfValue*2},o=function(u,c){dt(c)&&(c=r[c]),r[u]=mt({name:u,points:[-.15,-.3,.15,-.3,.15,.3,-.15,.3],collide:function(d,f,p,m,v,g){var y=a(i(this.points,p+2*g,m,v)),_=li(d,f,y);return _},roughCollide:t,draw:function(d,f,p,m){var v=i(this.points,f,p,m);e.arrowShapeImpl("polygon")(d,v)},spacing:function(d){return 0},gap:s},c)};o("none",{collide:kg,roughCollide:kg,draw:OS,spacing:wC,gap:wC}),o("triangle",{points:[-.15,-.3,0,0,.15,-.3]}),o("arrow","triangle"),o("triangle-backcurve",{points:r.triangle.points,controlPoint:[0,-.15],roughCollide:t,draw:function(u,c,h,d,f){var p=i(this.points,c,h,d),m=this.controlPoint,v=n(m[0],m[1],c,h,d);e.arrowShapeImpl(this.name)(u,p,v)},gap:function(u){return s(u)*.8}}),o("triangle-tee",{points:[0,0,.15,-.3,-.15,-.3,0,0],pointsTee:[-.15,-.4,-.15,-.5,.15,-.5,.15,-.4],collide:function(u,c,h,d,f,p,m){var v=a(i(this.points,h+2*m,d,f)),g=a(i(this.pointsTee,h+2*m,d,f)),y=li(u,c,v)||li(u,c,g);return y},draw:function(u,c,h,d,f){var p=i(this.points,c,h,d),m=i(this.pointsTee,c,h,d);e.arrowShapeImpl(this.name)(u,p,m)}}),o("circle-triangle",{radius:.15,pointsTr:[0,-.15,.15,-.45,-.15,-.45,0,-.15],collide:function(u,c,h,d,f,p,m){var v=f,g=Math.pow(v.x-u,2)+Math.pow(v.y-c,2)<=Math.pow((h+2*m)*this.radius,2),y=a(i(this.points,h+2*m,d,f));return li(u,c,y)||g},draw:function(u,c,h,d,f){var p=i(this.pointsTr,c,h,d);e.arrowShapeImpl(this.name)(u,p,d.x,d.y,this.radius*c)},spacing:function(u){return e.getArrowWidth(u.pstyle("width").pfValue,u.pstyle("arrow-scale").value)*this.radius}}),o("triangle-cross",{points:[0,0,.15,-.3,-.15,-.3,0,0],baseCrossLinePts:[-.15,-.4,-.15,-.4,.15,-.4,.15,-.4],crossLinePts:function(u,c){var h=this.baseCrossLinePts.slice(),d=c/u,f=3,p=5;return h[f]=h[f]-d,h[p]=h[p]-d,h},collide:function(u,c,h,d,f,p,m){var v=a(i(this.points,h+2*m,d,f)),g=a(i(this.crossLinePts(h,p),h+2*m,d,f)),y=li(u,c,v)||li(u,c,g);return y},draw:function(u,c,h,d,f){var p=i(this.points,c,h,d),m=i(this.crossLinePts(c,f),c,h,d);e.arrowShapeImpl(this.name)(u,p,m)}}),o("vee",{points:[-.15,-.3,0,0,.15,-.3,0,-.15],gap:function(u){return s(u)*.525}}),o("circle",{radius:.15,collide:function(u,c,h,d,f,p,m){var v=f,g=Math.pow(v.x-u,2)+Math.pow(v.y-c,2)<=Math.pow((h+2*m)*this.radius,2);return g},draw:function(u,c,h,d,f){e.arrowShapeImpl(this.name)(u,d.x,d.y,this.radius*c)},spacing:function(u){return e.getArrowWidth(u.pstyle("width").pfValue,u.pstyle("arrow-scale").value)*this.radius}}),o("tee",{points:[-.15,0,-.15,-.1,.15,-.1,.15,0],spacing:function(u){return 1},gap:function(u){return 1}}),o("square",{points:[-.15,0,.15,0,.15,-.3,-.15,-.3]}),o("diamond",{points:[-.15,-.15,0,-.3,.15,-.15,0,0],gap:function(u){return u.pstyle("width").pfValue*u.pstyle("arrow-scale").value}}),o("chevron",{points:[0,0,-.15,-.15,-.1,-.2,0,-.1,.1,-.2,.15,-.15],gap:function(u){return .95*u.pstyle("width").pfValue*u.pstyle("arrow-scale").value}})};var tu={};tu.projectIntoViewport=function(r,e){var t=this.cy,n=this.findContainerClientCoords(),i=n[0],a=n[1],s=n[4],o=t.pan(),l=t.zoom(),u=((r-i)/s-o.x)/l,c=((e-a)/s-o.y)/l;return[u,c]};tu.findContainerClientCoords=function(){if(this.containerBB)return this.containerBB;var r=this.container,e=r.getBoundingClientRect(),t=this.cy.window().getComputedStyle(r),n=function(g){return parseFloat(t.getPropertyValue(g))},i={left:n("padding-left"),right:n("padding-right"),top:n("padding-top"),bottom:n("padding-bottom")},a={left:n("border-left-width"),right:n("border-right-width"),top:n("border-top-width"),bottom:n("border-bottom-width")},s=r.clientWidth,o=r.clientHeight,l=i.left+i.right,u=i.top+i.bottom,c=a.left+a.right,h=e.width/(s+c),d=s-l,f=o-u,p=e.left+i.left+a.left,m=e.top+i.top+a.top;return this.containerBB=[p,m,d,f,h]};tu.invalidateContainerClientCoordsCache=function(){this.containerBB=null};tu.findNearestElement=function(r,e,t,n){return this.findNearestElements(r,e,t,n)[0]};tu.findNearestElements=function(r,e,t,n){var i=this,a=this,s=a.getCachedZSortedEles(),o=[],l=a.cy.zoom(),u=a.cy.hasCompoundNodes(),c=(n?24:8)/l,h=(n?8:2)/l,d=(n?8:2)/l,f=1/0,p,m;t&&(s=s.interactive);function v(b,w){if(b.isNode()){if(m)return;m=b,o.push(b)}if(b.isEdge()&&(w==null||w<f))if(p){if(p.pstyle("z-compound-depth").value===b.pstyle("z-compound-depth").value&&p.pstyle("z-compound-depth").value===b.pstyle("z-compound-depth").value){for(var A=0;A<o.length;A++)if(o[A].isEdge()){o[A]=b,p=b,f=w!=null?w:f;break}}}else o.push(b),p=b,f=w!=null?w:f}function g(b){var w=b.outerWidth()+2*h,A=b.outerHeight()+2*h,S=w/2,C=A/2,R=b.position(),P=b.pstyle("corner-radius").value==="auto"?"auto":b.pstyle("corner-radius").pfValue,M=b._private.rscratch;if(R.x-S<=r&&r<=R.x+S&&R.y-C<=e&&e<=R.y+C){var N=a.nodeShapes[i.getNodeShape(b)];if(N.checkPoint(r,e,0,w,A,R.x,R.y,P,M))return v(b,0),!0}}function y(b){var w=b._private,A=w.rscratch,S=b.pstyle("width").pfValue,C=b.pstyle("arrow-scale").value,R=S/2+c,P=R*R,M=R*2,L=w.source,z=w.target,N;if(A.edgeType==="segments"||A.edgeType==="straight"||A.edgeType==="haystack"){for(var D=A.allpts,I=0;I+3<D.length;I+=2)if(Yq(r,e,D[I],D[I+1],D[I+2],D[I+3],M)&&P>(N=Jq(r,e,D[I],D[I+1],D[I+2],D[I+3])))return v(b,N),!0}else if(A.edgeType==="bezier"||A.edgeType==="multibezier"||A.edgeType==="self"||A.edgeType==="compound"){for(var D=A.allpts,I=0;I+5<A.allpts.length;I+=4)if(jq(r,e,D[I],D[I+1],D[I+2],D[I+3],D[I+4],D[I+5],M)&&P>(N=Zq(r,e,D[I],D[I+1],D[I+2],D[I+3],D[I+4],D[I+5])))return v(b,N),!0}for(var L=L||w.source,z=z||w.target,B=i.getArrowWidth(S,C),k=[{name:"source",x:A.arrowStartX,y:A.arrowStartY,angle:A.srcArrowAngle},{name:"target",x:A.arrowEndX,y:A.arrowEndY,angle:A.tgtArrowAngle},{name:"mid-source",x:A.midX,y:A.midY,angle:A.midsrcArrowAngle},{name:"mid-target",x:A.midX,y:A.midY,angle:A.midtgtArrowAngle}],I=0;I<k.length;I++){var U=k[I],G=a.arrowShapes[b.pstyle(U.name+"-arrow-shape").value],O=b.pstyle("width").pfValue;if(G.roughCollide(r,e,B,U.angle,{x:U.x,y:U.y},O,c)&&G.collide(r,e,B,U.angle,{x:U.x,y:U.y},O,c))return v(b),!0}u&&o.length>0&&(g(L),g(z))}function _(b,w,A){return Qi(b,w,A)}function x(b,w){var A=b._private,S=d,C;w?C=w+"-":C="",b.boundingBox();var R=A.labelBounds[w||"main"],P=b.pstyle(C+"label").value,M=b.pstyle("text-events").strValue==="yes";if(!(!M||!P)){var N=_(A.rscratch,"labelX",w),D=_(A.rscratch,"labelY",w),I=_(A.rscratch,"labelAngle",w),L=b.pstyle(C+"text-margin-x").pfValue,z=b.pstyle(C+"text-margin-y").pfValue,B=R.x1-S-L,k=R.x2+S-L,U=R.y1-S-z,G=R.y2+S-z;if(I){var O=Math.cos(I),F=Math.sin(I),V=function(oe,W){return oe=oe-N,W=W-D,{x:oe*O-W*F+N,y:oe*F+W*O+D}},$=V(B,U),Z=V(B,G),Y=V(k,U),X=V(k,G),K=[$.x+L,$.y+z,Y.x+L,Y.y+z,X.x+L,X.y+z,Z.x+L,Z.y+z];if(li(r,e,K))return v(b),!0}else if(xc(R,r,e))return v(b),!0}}for(var E=s.length-1;E>=0;E--){var T=s[E];T.isNode()?g(T)||x(T):y(T)||x(T)||x(T,"source")||x(T,"target")}return o};tu.getAllInBox=function(r,e,t,n){var i=this.getCachedZSortedEles().interactive,a=[],s=Math.min(r,t),o=Math.max(r,t),l=Math.min(e,n),u=Math.max(e,n);r=s,t=o,e=l,n=u;for(var c=bi({x1:r,y1:e,x2:t,y2:n}),h=0;h<i.length;h++){var d=i[h];if(d.isNode()){var f=d,p=f.boundingBox({includeNodes:!0,includeEdges:!1,includeLabels:!1});US(c,p)&&!mk(p,c)&&a.push(f)}else{var m=d,v=m._private,g=v.rscratch;if(g.startX!=null&&g.startY!=null&&!xc(c,g.startX,g.startY)||g.endX!=null&&g.endY!=null&&!xc(c,g.endX,g.endY))continue;if(g.edgeType==="bezier"||g.edgeType==="multibezier"||g.edgeType==="self"||g.edgeType==="compound"||g.edgeType==="segments"||g.edgeType==="haystack"){for(var y=v.rstyle.bezierPts||v.rstyle.linePts||v.rstyle.haystackPts,_=!0,x=0;x<y.length;x++)if(!Xq(c,y[x])){_=!1;break}_&&a.push(m)}else(g.edgeType==="haystack"||g.edgeType==="straight")&&a.push(m)}}return a};var $g={};$g.calculateArrowAngles=function(r){var e=r._private.rscratch,t=e.edgeType==="haystack",n=e.edgeType==="bezier",i=e.edgeType==="multibezier",a=e.edgeType==="segments",s=e.edgeType==="compound",o=e.edgeType==="self",l,u,c,h,d,f,g,y;if(t?(c=e.haystackPts[0],h=e.haystackPts[1],d=e.haystackPts[2],f=e.haystackPts[3]):(c=e.arrowStartX,h=e.arrowStartY,d=e.arrowEndX,f=e.arrowEndY),g=e.midX,y=e.midY,a)l=c-e.segpts[0],u=h-e.segpts[1];else if(i||s||o||n){var p=e.allpts,m=gr(p[0],p[2],p[4],.1),v=gr(p[1],p[3],p[5],.1);l=c-m,u=h-v}else l=c-g,u=h-y;e.srcArrowAngle=Kd(l,u);var g=e.midX,y=e.midY;if(t&&(g=(c+d)/2,y=(h+f)/2),l=d-c,u=f-h,a){var p=e.allpts;if(p.length/2%2===0){var _=p.length/2,x=_-2;l=p[_]-p[x],u=p[_+1]-p[x+1]}else if(e.isRound)l=e.midVector[1],u=-e.midVector[0];else{var _=p.length/2-1,x=_-2;l=p[_]-p[x],u=p[_+1]-p[x+1]}}else if(i||s||o){var p=e.allpts,E=e.ctrlpts,T,b,w,A;if(E.length/2%2===0){var S=p.length/2-1,C=S+2,R=C+2;T=gr(p[S],p[C],p[R],0),b=gr(p[S+1],p[C+1],p[R+1],0),w=gr(p[S],p[C],p[R],1e-4),A=gr(p[S+1],p[C+1],p[R+1],1e-4)}else{var C=p.length/2-1,S=C-2,R=C+2;T=gr(p[S],p[C],p[R],.4999),b=gr(p[S+1],p[C+1],p[R+1],.4999),w=gr(p[S],p[C],p[R],.5),A=gr(p[S+1],p[C+1],p[R+1],.5)}l=w-T,u=A-b}if(e.midtgtArrowAngle=Kd(l,u),e.midDispX=l,e.midDispY=u,l*=-1,u*=-1,a){var p=e.allpts;if(p.length/2%2!==0){if(!e.isRound){var _=p.length/2-1,P=_+2;l=-(p[P]-p[_]),u=-(p[P+1]-p[_+1])}}}if(e.midsrcArrowAngle=Kd(l,u),a)l=d-e.segpts[e.segpts.length-2],u=f-e.segpts[e.segpts.length-1];else if(i||s||o||n){var p=e.allpts,M=p.length,m=gr(p[M-6],p[M-4],p[M-2],.9),v=gr(p[M-5],p[M-3],p[M-1],.9);l=d-m,u=f-v}else l=d-g,u=f-y;e.tgtArrowAngle=Kd(l,u)};$g.getArrowWidth=$g.getArrowHeight=function(r,e){var t=this.arrowWidthCache=this.arrowWidthCache||{},n=t[r+", "+e];return n||(n=Math.max(Math.pow(r*13.37,.9),29)*e,t[r+", "+e]=n,n)};var Iw,Ow,Ya={},Yi={},uN,cN,Ml,_g,vs,ul,bl,$a,yu,ip,c3,h3,Fw,Bw,hN,fN=function(e,t,n){n.x=t.x-e.x,n.y=t.y-e.y,n.len=Math.sqrt(n.x*n.x+n.y*n.y),n.nx=n.x/n.len,n.ny=n.y/n.len,n.ang=Math.atan2(n.ny,n.nx)},pX=function(e,t){t.x=e.x*-1,t.y=e.y*-1,t.nx=e.nx*-1,t.ny=e.ny*-1,t.ang=e.ang>0?-(Math.PI-e.ang):Math.PI+e.ang},gX=function(e,t,n,i,a){if(e!==hN?fN(t,e,Ya):pX(Yi,Ya),fN(t,n,Yi),uN=Ya.nx*Yi.ny-Ya.ny*Yi.nx,cN=Ya.nx*Yi.nx-Ya.ny*-Yi.ny,vs=Math.asin(Math.max(-1,Math.min(1,uN))),Math.abs(vs)<1e-6){Iw=t.x,Ow=t.y,bl=yu=0;return}Ml=1,_g=!1,cN<0?vs<0?vs=Math.PI+vs:(vs=Math.PI-vs,Ml=-1,_g=!0):vs>0&&(Ml=-1,_g=!0),t.radius!==void 0?yu=t.radius:yu=i,ul=vs/2,ip=Math.min(Ya.len/2,Yi.len/2),a?($a=Math.abs(Math.cos(ul)*yu/Math.sin(ul)),$a>ip?($a=ip,bl=Math.abs($a*Math.sin(ul)/Math.cos(ul))):bl=yu):($a=Math.min(ip,yu),bl=Math.abs($a*Math.sin(ul)/Math.cos(ul))),Fw=t.x+Yi.nx*$a,Bw=t.y+Yi.ny*$a,Iw=Fw-Yi.ny*bl*Ml,Ow=Bw+Yi.nx*bl*Ml,c3=t.x+Ya.nx*$a,h3=t.y+Ya.ny*$a,hN=t};function f3(r,e){e.radius===0?r.lineTo(e.cx,e.cy):r.arc(e.cx,e.cy,e.radius,e.startAngle,e.endAngle,e.counterClockwise)}function KS(r,e,t,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;return n===0||e.radius===0?{cx:e.x,cy:e.y,radius:0,startX:e.x,startY:e.y,stopX:e.x,stopY:e.y,startAngle:void 0,endAngle:void 0,counterClockwise:void 0}:(gX(r,e,t,n,i),{cx:Iw,cy:Ow,radius:bl,startX:c3,startY:h3,stopX:Fw,stopY:Bw,startAngle:Ya.ang+Math.PI/2*Ml,endAngle:Yi.ang-Math.PI/2*Ml,counterClockwise:_g})}var Lf=.01,vX=Math.sqrt(2*Lf),qr={};qr.findMidptPtsEtc=function(r,e){var t=e.posPts,n=e.intersectionPts,i=e.vectorNormInverse,a,s=r.pstyle("source-endpoint"),o=r.pstyle("target-endpoint"),l=s.units!=null&&o.units!=null,u=function(E,T,b,w){var A=w-T,S=b-E,C=Math.sqrt(S*S+A*A);return{x:-A/C,y:S/C}},c=r.pstyle("edge-distances").value;switch(c){case"node-position":a=t;break;case"intersection":a=n;break;case"endpoints":{if(l){var h=this.manualEndptToPx(r.source()[0],s),d=vr(h,2),f=d[0],p=d[1],m=this.manualEndptToPx(r.target()[0],o),v=vr(m,2),g=v[0],y=v[1],_={x1:f,y1:p,x2:g,y2:y};i=u(f,p,g,y),a=_}else nn("Edge ".concat(r.id()," has edge-distances:endpoints specified without manual endpoints specified via source-endpoint and target-endpoint.  Falling back on edge-distances:intersection (default).")),a=n;break}}return{midptPts:a,vectorNormInverse:i}};qr.findHaystackPoints=function(r){for(var e=0;e<r.length;e++){var t=r[e],n=t._private,i=n.rscratch;if(!i.haystack){var a=Math.random()*2*Math.PI;i.source={x:Math.cos(a),y:Math.sin(a)},a=Math.random()*2*Math.PI,i.target={x:Math.cos(a),y:Math.sin(a)}}var s=n.source,o=n.target,l=s.position(),u=o.position(),c=s.width(),h=o.width(),d=s.height(),f=o.height(),p=t.pstyle("haystack-radius").value,m=p/2;i.haystackPts=i.allpts=[i.source.x*c*m+l.x,i.source.y*d*m+l.y,i.target.x*h*m+u.x,i.target.y*f*m+u.y],i.midX=(i.allpts[0]+i.allpts[2])/2,i.midY=(i.allpts[1]+i.allpts[3])/2,i.edgeType="haystack",i.haystack=!0,this.storeEdgeProjections(t),this.calculateArrowAngles(t),this.recalculateEdgeLabelProjections(t),this.calculateLabelAngles(t)}};qr.findSegmentsPoints=function(r,e){var t=r._private.rscratch,n=r.pstyle("segment-weights"),i=r.pstyle("segment-distances"),a=r.pstyle("segment-radii"),s=r.pstyle("radius-type"),o=Math.min(n.pfValue.length,i.pfValue.length),l=a.pfValue[a.pfValue.length-1],u=s.pfValue[s.pfValue.length-1];t.edgeType="segments",t.segpts=[],t.radii=[],t.isArcRadius=[];for(var c=0;c<o;c++){var h=n.pfValue[c],d=i.pfValue[c],f=1-h,p=h,m=this.findMidptPtsEtc(r,e),v=m.midptPts,g=m.vectorNormInverse,y={x:v.x1*f+v.x2*p,y:v.y1*f+v.y2*p};t.segpts.push(y.x+g.x*d,y.y+g.y*d),t.radii.push(a.pfValue[c]!==void 0?a.pfValue[c]:l),t.isArcRadius.push((s.pfValue[c]!==void 0?s.pfValue[c]:u)==="arc-radius")}};qr.findLoopPoints=function(r,e,t,n){var i=r._private.rscratch,a=e.dirCounts,s=e.srcPos,o=r.pstyle("control-point-distances"),l=o?o.pfValue[0]:void 0,u=r.pstyle("loop-direction").pfValue,c=r.pstyle("loop-sweep").pfValue,h=r.pstyle("control-point-step-size").pfValue;i.edgeType="self";var d=t,f=h;n&&(d=0,f=l);var p=u-Math.PI/2,m=p-c/2,v=p+c/2,g=String(u+"_"+c);d=a[g]===void 0?a[g]=0:++a[g],i.ctrlpts=[s.x+Math.cos(m)*1.4*f*(d/3+1),s.y+Math.sin(m)*1.4*f*(d/3+1),s.x+Math.cos(v)*1.4*f*(d/3+1),s.y+Math.sin(v)*1.4*f*(d/3+1)]};qr.findCompoundLoopPoints=function(r,e,t,n){var i=r._private.rscratch;i.edgeType="compound";var a=e.srcPos,s=e.tgtPos,o=e.srcW,l=e.srcH,u=e.tgtW,c=e.tgtH,h=r.pstyle("control-point-step-size").pfValue,d=r.pstyle("control-point-distances"),f=d?d.pfValue[0]:void 0,p=t,m=h;n&&(p=0,m=f);var v=50,g={x:a.x-o/2,y:a.y-l/2},y={x:s.x-u/2,y:s.y-c/2},_={x:Math.min(g.x,y.x),y:Math.min(g.y,y.y)},x=.5,E=Math.max(x,Math.log(o*Lf)),T=Math.max(x,Math.log(u*Lf));i.ctrlpts=[_.x,_.y-(1+Math.pow(v,1.12)/100)*m*(p/3+1)*E,_.x-(1+Math.pow(v,1.12)/100)*m*(p/3+1)*T,_.y]};qr.findStraightEdgePoints=function(r){r._private.rscratch.edgeType="straight"};qr.findBezierPoints=function(r,e,t,n,i){var a=r._private.rscratch,s=r.pstyle("control-point-step-size").pfValue,o=r.pstyle("control-point-distances"),l=r.pstyle("control-point-weights"),u=o&&l?Math.min(o.value.length,l.value.length):1,c=o?o.pfValue[0]:void 0,h=l.value[0],d=n;a.edgeType=d?"multibezier":"bezier",a.ctrlpts=[];for(var f=0;f<u;f++){var p=(.5-e.eles.length/2+t)*s*(i?-1:1),m=void 0,v=gk(p);d&&(c=o?o.pfValue[f]:s,h=l.value[f]),n?m=c:m=c!==void 0?v*c:void 0;var g=m!==void 0?m:p,y=1-h,_=h,x=this.findMidptPtsEtc(r,e),E=x.midptPts,T=x.vectorNormInverse,b={x:E.x1*y+E.x2*_,y:E.y1*y+E.y2*_};a.ctrlpts.push(b.x+T.x*g,b.y+T.y*g)}};qr.findTaxiPoints=function(r,e){var t=r._private.rscratch;t.edgeType="segments";var n="vertical",i="horizontal",a="leftward",s="rightward",o="downward",l="upward",u="auto",c=e.posPts,h=e.srcW,d=e.srcH,f=e.tgtW,p=e.tgtH,m=r.pstyle("edge-distances").value,v=m!=="node-position",g=r.pstyle("taxi-direction").value,y=g,_=r.pstyle("taxi-turn"),x=_.units==="%",E=_.pfValue,T=E<0,b=r.pstyle("taxi-turn-min-distance").pfValue,w=v?(h+f)/2:0,A=v?(d+p)/2:0,S=c.x2-c.x1,C=c.y2-c.y1,R=function(ee,he){return ee>0?Math.max(ee-he,0):Math.min(ee+he,0)},P=R(S,w),M=R(C,A),N=!1;y===u?g=Math.abs(P)>Math.abs(M)?i:n:y===l||y===o?(g=n,N=!0):(y===a||y===s)&&(g=i,N=!0);var D=g===n,I=D?M:P,L=D?C:S,z=gk(L),B=!1;!(N&&(x||T))&&(y===o&&L<0||y===l&&L>0||y===a&&L>0||y===s&&L<0)&&(z*=-1,I=z*Math.abs(I),B=!0);var k;if(x){var U=E<0?1+E:E;k=U*I}else{var G=E<0?I:0;k=G+E*z}var O=function(ee){return Math.abs(ee)<b||Math.abs(ee)>=Math.abs(I)},F=O(k),V=O(Math.abs(I)-Math.abs(k)),$=F||V;if($&&!B)if(D){var Z=Math.abs(L)<=d/2,Y=Math.abs(S)<=f/2;if(Z){var X=(c.x1+c.x2)/2,K=c.y1,se=c.y2;t.segpts=[X,K,X,se]}else if(Y){var oe=(c.y1+c.y2)/2,W=c.x1,Ne=c.x2;t.segpts=[W,oe,Ne,oe]}else t.segpts=[c.x1,c.y2]}else{var Be=Math.abs(L)<=h/2,we=Math.abs(C)<=p/2;if(Be){var pe=(c.y1+c.y2)/2,Me=c.x1,Ae=c.x2;t.segpts=[Me,pe,Ae,pe]}else if(we){var j=(c.x1+c.x2)/2,H=c.y1,te=c.y2;t.segpts=[j,H,j,te]}else t.segpts=[c.x2,c.y1]}else if(D){var me=c.y1+k+(v?d/2*z:0),Ee=c.x1,le=c.x2;t.segpts=[Ee,me,le,me]}else{var q=c.x1+k+(v?h/2*z:0),ne=c.y1,fe=c.y2;t.segpts=[q,ne,q,fe]}if(t.isRound){var ce=r.pstyle("taxi-radius").value,ae=r.pstyle("radius-type").value[0]==="arc-radius";t.radii=new Array(t.segpts.length/2).fill(ce),t.isArcRadius=new Array(t.segpts.length/2).fill(ae)}};qr.tryToCorrectInvalidPoints=function(r,e){var t=r._private.rscratch;if(t.edgeType==="bezier"){var n=e.srcPos,i=e.tgtPos,a=e.srcW,s=e.srcH,o=e.tgtW,l=e.tgtH,u=e.srcShape,c=e.tgtShape,h=e.srcCornerRadius,d=e.tgtCornerRadius,f=e.srcRs,p=e.tgtRs,m=!et(t.startX)||!et(t.startY),v=!et(t.arrowStartX)||!et(t.arrowStartY),g=!et(t.endX)||!et(t.endY),y=!et(t.arrowEndX)||!et(t.arrowEndY),_=3,x=this.getArrowWidth(r.pstyle("width").pfValue,r.pstyle("arrow-scale").value)*this.arrowShapeWidth,E=_*x,T=Vl({x:t.ctrlpts[0],y:t.ctrlpts[1]},{x:t.startX,y:t.startY}),b=T<E,w=Vl({x:t.ctrlpts[0],y:t.ctrlpts[1]},{x:t.endX,y:t.endY}),A=w<E,S=!1;if(m||v||b){S=!0;var C={x:t.ctrlpts[0]-n.x,y:t.ctrlpts[1]-n.y},R=Math.sqrt(C.x*C.x+C.y*C.y),P={x:C.x/R,y:C.y/R},M=Math.max(a,s),N={x:t.ctrlpts[0]+P.x*2*M,y:t.ctrlpts[1]+P.y*2*M},D=u.intersectLine(n.x,n.y,a,s,N.x,N.y,0,h,f);b?(t.ctrlpts[0]=t.ctrlpts[0]+P.x*(E-T),t.ctrlpts[1]=t.ctrlpts[1]+P.y*(E-T)):(t.ctrlpts[0]=D[0]+P.x*E,t.ctrlpts[1]=D[1]+P.y*E)}if(g||y||A){S=!0;var I={x:t.ctrlpts[0]-i.x,y:t.ctrlpts[1]-i.y},L=Math.sqrt(I.x*I.x+I.y*I.y),z={x:I.x/L,y:I.y/L},B=Math.max(a,s),k={x:t.ctrlpts[0]+z.x*2*B,y:t.ctrlpts[1]+z.y*2*B},U=c.intersectLine(i.x,i.y,o,l,k.x,k.y,0,d,p);A?(t.ctrlpts[0]=t.ctrlpts[0]+z.x*(E-w),t.ctrlpts[1]=t.ctrlpts[1]+z.y*(E-w)):(t.ctrlpts[0]=U[0]+z.x*E,t.ctrlpts[1]=U[1]+z.y*E)}S&&this.findEndpoints(r)}};qr.storeAllpts=function(r){var e=r._private.rscratch;if(e.edgeType==="multibezier"||e.edgeType==="bezier"||e.edgeType==="self"||e.edgeType==="compound"){e.allpts=[],e.allpts.push(e.startX,e.startY);for(var t=0;t+1<e.ctrlpts.length;t+=2)e.allpts.push(e.ctrlpts[t],e.ctrlpts[t+1]),t+3<e.ctrlpts.length&&e.allpts.push((e.ctrlpts[t]+e.ctrlpts[t+2])/2,(e.ctrlpts[t+1]+e.ctrlpts[t+3])/2);e.allpts.push(e.endX,e.endY);var n,i;e.ctrlpts.length/2%2===0?(n=e.allpts.length/2-1,e.midX=e.allpts[n],e.midY=e.allpts[n+1]):(n=e.allpts.length/2-3,i=.5,e.midX=gr(e.allpts[n],e.allpts[n+2],e.allpts[n+4],i),e.midY=gr(e.allpts[n+1],e.allpts[n+3],e.allpts[n+5],i))}else if(e.edgeType==="straight")e.allpts=[e.startX,e.startY,e.endX,e.endY],e.midX=(e.startX+e.endX+e.arrowStartX+e.arrowEndX)/4,e.midY=(e.startY+e.endY+e.arrowStartY+e.arrowEndY)/4;else if(e.edgeType==="segments"){if(e.allpts=[],e.allpts.push(e.startX,e.startY),e.allpts.push.apply(e.allpts,e.segpts),e.allpts.push(e.endX,e.endY),e.isRound){e.roundCorners=[];for(var a=2;a+3<e.allpts.length;a+=2){var s=e.radii[a/2-1],o=e.isArcRadius[a/2-1];e.roundCorners.push(KS({x:e.allpts[a-2],y:e.allpts[a-1]},{x:e.allpts[a],y:e.allpts[a+1],radius:s},{x:e.allpts[a+2],y:e.allpts[a+3]},s,o))}}if(e.segpts.length%4===0){var l=e.segpts.length/2,u=l-2;e.midX=(e.segpts[u]+e.segpts[l])/2,e.midY=(e.segpts[u+1]+e.segpts[l+1])/2}else{var c=e.segpts.length/2-1;if(!e.isRound)e.midX=e.segpts[c],e.midY=e.segpts[c+1];else{var h={x:e.segpts[c],y:e.segpts[c+1]},d=e.roundCorners[c/2];if(d.radius===0){var f={x:e.segpts[c+2],y:e.segpts[c+3]};e.midX=h.x,e.midY=h.y,e.midVector=[h.y-f.y,f.x-h.x]}else{var p=[h.x-d.cx,h.y-d.cy],m=d.radius/Math.sqrt(Math.pow(p[0],2)+Math.pow(p[1],2));p=p.map(function(v){return v*m}),e.midX=d.cx+p[0],e.midY=d.cy+p[1],e.midVector=p}}}}};qr.checkForInvalidEdgeWarning=function(r){var e=r[0]._private.rscratch;e.nodesOverlap||et(e.startX)&&et(e.startY)&&et(e.endX)&&et(e.endY)?e.loggedErr=!1:e.loggedErr||(e.loggedErr=!0,nn("Edge `"+r.id()+"` has invalid endpoints and so it is impossible to draw.  Adjust your edge style (e.g. control points) accordingly or use an alternative edge type.  This is expected behaviour when the source node and the target node overlap."))};qr.findEdgeControlPoints=function(r){var e=this;if(!(!r||r.length===0)){for(var t=this,n=t.cy,i=n.hasCompoundNodes(),a=new Os,s=function(A,S){return[].concat(jU(A),[S?1:0]).join("-")},o=[],l=[],u=0;u<r.length;u++){var c=r[u],h=c._private,d=c.pstyle("curve-style").value;if(!(c.removed()||!c.takesUpSpace())){if(d==="haystack"){l.push(c);continue}var f=d==="unbundled-bezier"||d.endsWith("segments")||d==="straight"||d==="straight-triangle"||d.endsWith("taxi"),p=d==="unbundled-bezier"||d==="bezier",m=h.source,v=h.target,g=m.poolIndex(),y=v.poolIndex(),_=[g,y].sort(),x=s(_,f),E=a.get(x);E==null&&(E={eles:[]},o.push({pairId:_,edgeIsUnbundled:f}),a.set(x,E)),E.eles.push(c),f&&(E.hasUnbundled=!0),p&&(E.hasBezier=!0)}}for(var T=function(){var A=o[b],S=A.pairId,C=A.edgeIsUnbundled,R=s(S,C),P=a.get(R),M;if(!P.hasUnbundled){var N=P.eles[0].parallelEdges().filter(function(ae){return ae.isBundledBezier()});FS(P.eles),N.forEach(function(ae){return P.eles.push(ae)}),P.eles.sort(function(ae,ie){return ae.poolIndex()-ie.poolIndex()})}var D=P.eles[0],I=D.source(),L=D.target();if(I.poolIndex()>L.poolIndex()){var z=I;I=L,L=z}var B=P.srcPos=I.position(),k=P.tgtPos=L.position(),U=P.srcW=I.outerWidth(),G=P.srcH=I.outerHeight(),O=P.tgtW=L.outerWidth(),F=P.tgtH=L.outerHeight(),V=P.srcShape=t.nodeShapes[e.getNodeShape(I)],$=P.tgtShape=t.nodeShapes[e.getNodeShape(L)],Z=P.srcCornerRadius=I.pstyle("corner-radius").value==="auto"?"auto":I.pstyle("corner-radius").pfValue,Y=P.tgtCornerRadius=L.pstyle("corner-radius").value==="auto"?"auto":L.pstyle("corner-radius").pfValue,X=P.tgtRs=L._private.rscratch,K=P.srcRs=I._private.rscratch;P.dirCounts={north:0,west:0,south:0,east:0,northwest:0,southwest:0,northeast:0,southeast:0};for(var se=0;se<P.eles.length;se++){var oe=P.eles[se],W=oe[0]._private.rscratch,Ne=oe.pstyle("curve-style").value,Be=Ne==="unbundled-bezier"||Ne.endsWith("segments")||Ne.endsWith("taxi"),we=!I.same(oe.source());if(!P.calculatedIntersection&&I!==L&&(P.hasBezier||P.hasUnbundled)){P.calculatedIntersection=!0;var pe=V.intersectLine(B.x,B.y,U,G,k.x,k.y,0,Z,K),Me=P.srcIntn=pe,Ae=$.intersectLine(k.x,k.y,O,F,B.x,B.y,0,Y,X),j=P.tgtIntn=Ae,H=P.intersectionPts={x1:pe[0],x2:Ae[0],y1:pe[1],y2:Ae[1]},te=P.posPts={x1:B.x,x2:k.x,y1:B.y,y2:k.y},me=Math.abs(Ae[1]-pe[1]),Ee=Math.abs(Ae[0]-pe[0]),le=Math.sqrt(Ee*Ee+me*me);et(le)&&le>=vX||(le=Math.sqrt(Math.max(Ee*Ee,Lf)+Math.max(me*me,Lf)));var q=P.vector={x:Ee,y:me},ne=P.vectorNorm={x:q.x/le,y:q.y/le},fe={x:-ne.y,y:ne.x};P.nodesOverlap=!et(le)||$.checkPoint(pe[0],pe[1],0,O,F,k.x,k.y,Y,X)||V.checkPoint(Ae[0],Ae[1],0,U,G,B.x,B.y,Z,K),P.vectorNormInverse=fe,M={nodesOverlap:P.nodesOverlap,dirCounts:P.dirCounts,calculatedIntersection:!0,hasBezier:P.hasBezier,hasUnbundled:P.hasUnbundled,eles:P.eles,srcPos:k,srcRs:X,tgtPos:B,tgtRs:K,srcW:O,srcH:F,tgtW:U,tgtH:G,srcIntn:j,tgtIntn:Me,srcShape:$,tgtShape:V,posPts:{x1:te.x2,y1:te.y2,x2:te.x1,y2:te.y1},intersectionPts:{x1:H.x2,y1:H.y2,x2:H.x1,y2:H.y1},vector:{x:-q.x,y:-q.y},vectorNorm:{x:-ne.x,y:-ne.y},vectorNormInverse:{x:-fe.x,y:-fe.y}}}var ce=we?M:P;W.nodesOverlap=ce.nodesOverlap,W.srcIntn=ce.srcIntn,W.tgtIntn=ce.tgtIntn,W.isRound=Ne.startsWith("round"),i&&(I.isParent()||I.isChild()||L.isParent()||L.isChild())&&(I.parents().anySame(L)||L.parents().anySame(I)||I.same(L)&&I.isParent())?e.findCompoundLoopPoints(oe,ce,se,Be):I===L?e.findLoopPoints(oe,ce,se,Be):Ne.endsWith("segments")?e.findSegmentsPoints(oe,ce):Ne.endsWith("taxi")?e.findTaxiPoints(oe,ce):Ne==="straight"||!Be&&P.eles.length%2===1&&se===Math.floor(P.eles.length/2)?e.findStraightEdgePoints(oe):e.findBezierPoints(oe,ce,se,Be,we),e.findEndpoints(oe),e.tryToCorrectInvalidPoints(oe,ce),e.checkForInvalidEdgeWarning(oe),e.storeAllpts(oe),e.storeEdgeProjections(oe),e.calculateArrowAngles(oe),e.recalculateEdgeLabelProjections(oe),e.calculateLabelAngles(oe)}},b=0;b<o.length;b++)T();this.findHaystackPoints(l)}};function d3(r){var e=[];if(r!=null){for(var t=0;t<r.length;t+=2){var n=r[t],i=r[t+1];e.push({x:n,y:i})}return e}}qr.getSegmentPoints=function(r){var e=r[0]._private.rscratch;this.recalculateRenderedStyle(r);var t=e.edgeType;if(t==="segments")return d3(e.segpts)};qr.getControlPoints=function(r){var e=r[0]._private.rscratch;this.recalculateRenderedStyle(r);var t=e.edgeType;if(t==="bezier"||t==="multibezier"||t==="self"||t==="compound")return d3(e.ctrlpts)};qr.getEdgeMidpoint=function(r){var e=r[0]._private.rscratch;return this.recalculateRenderedStyle(r),{x:e.midX,y:e.midY}};var bd={};bd.manualEndptToPx=function(r,e){var t=this,n=r.position(),i=r.outerWidth(),a=r.outerHeight(),s=r._private.rscratch;if(e.value.length===2){var o=[e.pfValue[0],e.pfValue[1]];return e.units[0]==="%"&&(o[0]=o[0]*i),e.units[1]==="%"&&(o[1]=o[1]*a),o[0]+=n.x,o[1]+=n.y,o}else{var l=e.pfValue[0];l=-Math.PI/2+l;var u=2*Math.max(i,a),c=[n.x+Math.cos(l)*u,n.y+Math.sin(l)*u];return t.nodeShapes[this.getNodeShape(r)].intersectLine(n.x,n.y,i,a,c[0],c[1],0,r.pstyle("corner-radius").value==="auto"?"auto":r.pstyle("corner-radius").pfValue,s)}};bd.findEndpoints=function(r){var e=this,t,n=r.source()[0],i=r.target()[0],a=n.position(),s=i.position(),o=r.pstyle("target-arrow-shape").value,l=r.pstyle("source-arrow-shape").value,u=r.pstyle("target-distance-from-node").pfValue,c=r.pstyle("source-distance-from-node").pfValue,h=n._private.rscratch,d=i._private.rscratch,f=r.pstyle("curve-style").value,p=r._private.rscratch,m=p.edgeType,v=f==="taxi",g=m==="self"||m==="compound",y=m==="bezier"||m==="multibezier"||g,_=m!=="bezier",x=m==="straight"||m==="segments",E=m==="segments",T=y||_||x,b=g||v,w=r.pstyle("source-endpoint"),A=b?"outside-to-node":w.value,S=n.pstyle("corner-radius").value==="auto"?"auto":n.pstyle("corner-radius").pfValue,C=r.pstyle("target-endpoint"),R=b?"outside-to-node":C.value,P=i.pstyle("corner-radius").value==="auto"?"auto":i.pstyle("corner-radius").pfValue;p.srcManEndpt=w,p.tgtManEndpt=C;var M,N,D,I;if(y){var L=[p.ctrlpts[0],p.ctrlpts[1]],z=_?[p.ctrlpts[p.ctrlpts.length-2],p.ctrlpts[p.ctrlpts.length-1]]:L;M=z,N=L}else if(x){var B=E?p.segpts.slice(0,2):[s.x,s.y],k=E?p.segpts.slice(p.segpts.length-2):[a.x,a.y];M=k,N=B}if(R==="inside-to-node")t=[s.x,s.y];else if(C.units)t=this.manualEndptToPx(i,C);else if(R==="outside-to-line")t=p.tgtIntn;else if(R==="outside-to-node"||R==="outside-to-node-or-label"?D=M:(R==="outside-to-line"||R==="outside-to-line-or-label")&&(D=[a.x,a.y]),t=e.nodeShapes[this.getNodeShape(i)].intersectLine(s.x,s.y,i.outerWidth(),i.outerHeight(),D[0],D[1],0,P,d),R==="outside-to-node-or-label"||R==="outside-to-line-or-label"){var U=i._private.rscratch,G=U.labelWidth,O=U.labelHeight,F=U.labelX,V=U.labelY,$=G/2,Z=O/2,Y=i.pstyle("text-valign").value;Y==="top"?V-=Z:Y==="bottom"&&(V+=Z);var X=i.pstyle("text-halign").value;X==="left"?F-=$:X==="right"&&(F+=$);var K=Cf(D[0],D[1],[F-$,V-Z,F+$,V-Z,F+$,V+Z,F-$,V+Z],s.x,s.y);if(K.length>0){var se=a,oe=_l(se,Ku(t)),W=_l(se,Ku(K)),Ne=oe;if(W<oe&&(t=K,Ne=W),K.length>2){var Be=_l(se,{x:K[2],y:K[3]});Be<Ne&&(t=[K[2],K[3]])}}}var we=Qd(t,M,e.arrowShapes[o].spacing(r)+u),pe=Qd(t,M,e.arrowShapes[o].gap(r)+u);if(p.endX=pe[0],p.endY=pe[1],p.arrowEndX=we[0],p.arrowEndY=we[1],A==="inside-to-node")t=[a.x,a.y];else if(w.units)t=this.manualEndptToPx(n,w);else if(A==="outside-to-line")t=p.srcIntn;else if(A==="outside-to-node"||A==="outside-to-node-or-label"?I=N:(A==="outside-to-line"||A==="outside-to-line-or-label")&&(I=[s.x,s.y]),t=e.nodeShapes[this.getNodeShape(n)].intersectLine(a.x,a.y,n.outerWidth(),n.outerHeight(),I[0],I[1],0,S,h),A==="outside-to-node-or-label"||A==="outside-to-line-or-label"){var Me=n._private.rscratch,Ae=Me.labelWidth,j=Me.labelHeight,H=Me.labelX,te=Me.labelY,me=Ae/2,Ee=j/2,le=n.pstyle("text-valign").value;le==="top"?te-=Ee:le==="bottom"&&(te+=Ee);var q=n.pstyle("text-halign").value;q==="left"?H-=me:q==="right"&&(H+=me);var ne=Cf(I[0],I[1],[H-me,te-Ee,H+me,te-Ee,H+me,te+Ee,H-me,te+Ee],a.x,a.y);if(ne.length>0){var fe=s,ce=_l(fe,Ku(t)),ae=_l(fe,Ku(ne)),ie=ce;if(ae<ce&&(t=[ne[0],ne[1]],ie=ae),ne.length>2){var ee=_l(fe,{x:ne[2],y:ne[3]});ee<ie&&(t=[ne[2],ne[3]])}}}var he=Qd(t,N,e.arrowShapes[l].spacing(r)+c),ge=Qd(t,N,e.arrowShapes[l].gap(r)+c);p.startX=ge[0],p.startY=ge[1],p.arrowStartX=he[0],p.arrowStartY=he[1],T&&(!et(p.startX)||!et(p.startY)||!et(p.endX)||!et(p.endY)?p.badLine=!0:p.badLine=!1)};bd.getSourceEndpoint=function(r){var e=r[0]._private.rscratch;switch(this.recalculateRenderedStyle(r),e.edgeType){case"haystack":return{x:e.haystackPts[0],y:e.haystackPts[1]};default:return{x:e.arrowStartX,y:e.arrowStartY}}};bd.getTargetEndpoint=function(r){var e=r[0]._private.rscratch;switch(this.recalculateRenderedStyle(r),e.edgeType){case"haystack":return{x:e.haystackPts[2],y:e.haystackPts[3]};default:return{x:e.arrowEndX,y:e.arrowEndY}}};var QS={};function mX(r,e,t){for(var n=function(u,c,h,d){return gr(u,c,h,d)},i=e._private,a=i.rstyle.bezierPts,s=0;s<r.bezierProjPcts.length;s++){var o=r.bezierProjPcts[s];a.push({x:n(t[0],t[2],t[4],o),y:n(t[1],t[3],t[5],o)})}}QS.storeEdgeProjections=function(r){var e=r._private,t=e.rscratch,n=t.edgeType;if(e.rstyle.bezierPts=null,e.rstyle.linePts=null,e.rstyle.haystackPts=null,n==="multibezier"||n==="bezier"||n==="self"||n==="compound"){e.rstyle.bezierPts=[];for(var i=0;i+5<t.allpts.length;i+=4)mX(this,r,t.allpts.slice(i,i+6))}else if(n==="segments")for(var a=e.rstyle.linePts=[],i=0;i+1<t.allpts.length;i+=2)a.push({x:t.allpts[i],y:t.allpts[i+1]});else if(n==="haystack"){var s=t.haystackPts;e.rstyle.haystackPts=[{x:s[0],y:s[1]},{x:s[2],y:s[3]}]}e.rstyle.arrowWidth=this.getArrowWidth(r.pstyle("width").pfValue,r.pstyle("arrow-scale").value)*this.arrowShapeWidth};QS.recalculateEdgeProjections=function(r){this.findEdgeControlPoints(r)};var cs={};cs.recalculateNodeLabelProjection=function(r){var e=r.pstyle("label").strValue;if(!Bo(e)){var t,n,i=r._private,a=r.width(),s=r.height(),o=r.padding(),l=r.position(),u=r.pstyle("text-halign").strValue,c=r.pstyle("text-valign").strValue,h=i.rscratch,d=i.rstyle;switch(u){case"left":t=l.x-a/2-o;break;case"right":t=l.x+a/2+o;break;default:t=l.x}switch(c){case"top":n=l.y-s/2-o;break;case"bottom":n=l.y+s/2+o;break;default:n=l.y}h.labelX=t,h.labelY=n,d.labelX=t,d.labelY=n,this.calculateLabelAngles(r),this.applyLabelDimensions(r)}};var p3=function(e,t){var n=Math.atan(t/e);return e===0&&n<0&&(n=n*-1),n},g3=function(e,t){var n=t.x-e.x,i=t.y-e.y;return p3(n,i)},yX=function(e,t,n,i){var a=Mf(0,i-.001,1),s=Mf(0,i+.001,1),o=oc(e,t,n,a),l=oc(e,t,n,s);return g3(o,l)};cs.recalculateEdgeLabelProjections=function(r){var e,t=r._private,n=t.rscratch,i=this,a={mid:r.pstyle("label").strValue,source:r.pstyle("source-label").strValue,target:r.pstyle("target-label").strValue};if(!!(a.mid||a.source||a.target)){e={x:n.midX,y:n.midY};var s=function(h,d,f){Ss(t.rscratch,h,d,f),Ss(t.rstyle,h,d,f)};s("labelX",null,e.x),s("labelY",null,e.y);var o=p3(n.midDispX,n.midDispY);s("labelAutoAngle",null,o);var l=function(){if(l.cache)return l.cache;for(var h=[],d=0;d+5<n.allpts.length;d+=4){var f={x:n.allpts[d],y:n.allpts[d+1]},p={x:n.allpts[d+2],y:n.allpts[d+3]},m={x:n.allpts[d+4],y:n.allpts[d+5]};h.push({p0:f,p1:p,p2:m,startDist:0,length:0,segments:[]})}var v=t.rstyle.bezierPts,g=i.bezierProjPcts.length;function y(b,w,A,S,C){var R=Vl(w,A),P=b.segments[b.segments.length-1],M={p0:w,p1:A,t0:S,t1:C,startDist:P?P.startDist+P.length:0,length:R};b.segments.push(M),b.length+=R}for(var _=0;_<h.length;_++){var x=h[_],E=h[_-1];E&&(x.startDist=E.startDist+E.length),y(x,x.p0,v[_*g],0,i.bezierProjPcts[0]);for(var T=0;T<g-1;T++)y(x,v[_*g+T],v[_*g+T+1],i.bezierProjPcts[T],i.bezierProjPcts[T+1]);y(x,v[_*g+g-1],x.p2,i.bezierProjPcts[g-1],1)}return l.cache=h},u=function(h){var d,f=h==="source";if(!!a[h]){var p=r.pstyle(h+"-text-offset").pfValue;switch(n.edgeType){case"self":case"compound":case"bezier":case"multibezier":{for(var m=l(),v,g=0,y=0,_=0;_<m.length;_++){for(var x=m[f?_:m.length-1-_],E=0;E<x.segments.length;E++){var T=x.segments[f?E:x.segments.length-1-E],b=_===m.length-1&&E===x.segments.length-1;if(g=y,y+=T.length,y>=p||b){v={cp:x,segment:T};break}}if(v)break}var w=v.cp,A=v.segment,S=(p-g)/A.length,C=A.t1-A.t0,R=f?A.t0+C*S:A.t1-C*S;R=Mf(0,R,1),e=oc(w.p0,w.p1,w.p2,R),d=yX(w.p0,w.p1,w.p2,R);break}case"straight":case"segments":case"haystack":{for(var P=0,M,N,D,I,L=n.allpts.length,z=0;z+3<L&&(f?(D={x:n.allpts[z],y:n.allpts[z+1]},I={x:n.allpts[z+2],y:n.allpts[z+3]}):(D={x:n.allpts[L-2-z],y:n.allpts[L-1-z]},I={x:n.allpts[L-4-z],y:n.allpts[L-3-z]}),M=Vl(D,I),N=P,P+=M,!(P>=p));z+=2);var B=p-N,k=B/M;k=Mf(0,k,1),e=Vq(D,I,k),d=g3(D,I);break}}s("labelX",h,e.x),s("labelY",h,e.y),s("labelAutoAngle",h,d)}};u("source"),u("target"),this.applyLabelDimensions(r)}};cs.applyLabelDimensions=function(r){this.applyPrefixedLabelDimensions(r),r.isEdge()&&(this.applyPrefixedLabelDimensions(r,"source"),this.applyPrefixedLabelDimensions(r,"target"))};cs.applyPrefixedLabelDimensions=function(r,e){var t=r._private,n=this.getLabelText(r,e),i=Uo(n,r._private.labelDimsKey);if(Qi(t.rscratch,"prefixedLabelDimsKey",e)!==i){Ss(t.rscratch,"prefixedLabelDimsKey",e,i);var a=this.calculateLabelDimensions(r,n),s=r.pstyle("line-height").pfValue,o=r.pstyle("text-wrap").strValue,l=Qi(t.rscratch,"labelWrapCachedLines",e)||[],u=o!=="wrap"?1:Math.max(l.length,1),c=a.height/u,h=c*s,d=a.width,f=a.height+(u-1)*(s-1)*c;Ss(t.rstyle,"labelWidth",e,d),Ss(t.rscratch,"labelWidth",e,d),Ss(t.rstyle,"labelHeight",e,f),Ss(t.rscratch,"labelHeight",e,f),Ss(t.rscratch,"labelLineHeight",e,h)}};cs.getLabelText=function(r,e){var t=r._private,n=e?e+"-":"",i=r.pstyle(n+"label").strValue,a=r.pstyle("text-transform").value,s=function(G,O){return O?(Ss(t.rscratch,G,e,O),O):Qi(t.rscratch,G,e)};if(!i)return"";a=="none"||(a=="uppercase"?i=i.toUpperCase():a=="lowercase"&&(i=i.toLowerCase()));var o=r.pstyle("text-wrap").value;if(o==="wrap"){var l=s("labelKey");if(l!=null&&s("labelWrapKey")===l)return s("labelWrapCachedText");for(var u="\u200B",c=i.split(`
`),h=r.pstyle("text-max-width").pfValue,d=r.pstyle("text-overflow-wrap").value,f=d==="anywhere",p=[],m=/[\s\u200b]+|$/g,v=0;v<c.length;v++){var g=c[v],y=this.calculateLabelDimensions(r,g),_=y.width;if(f){var x=g.split("").join(u);g=x}if(_>h){var E=g.matchAll(m),T="",b=0,w=Na(E),A;try{for(w.s();!(A=w.n()).done;){var S=A.value,C=S[0],R=g.substring(b,S.index);b=S.index+C.length;var P=T.length===0?R:T+R+C,M=this.calculateLabelDimensions(r,P),N=M.width;N<=h?T+=R+C:(T&&p.push(T),T=R+C)}}catch(U){w.e(U)}finally{w.f()}T.match(/^[\s\u200b]+$/)||p.push(T)}else p.push(g)}s("labelWrapCachedLines",p),i=s("labelWrapCachedText",p.join(`
`)),s("labelWrapKey",l)}else if(o==="ellipsis"){var D=r.pstyle("text-max-width").pfValue,I="",L="\u2026",z=!1;if(this.calculateLabelDimensions(r,i).width<D)return i;for(var B=0;B<i.length;B++){var k=this.calculateLabelDimensions(r,I+i[B]+L).width;if(k>D)break;I+=i[B],B===i.length-1&&(z=!0)}return z||(I+=L),I}return i};cs.getLabelJustification=function(r){var e=r.pstyle("text-justification").strValue,t=r.pstyle("text-halign").strValue;if(e==="auto")if(r.isNode())switch(t){case"left":return"right";case"right":return"left";default:return"center"}else return"center";else return e};cs.calculateLabelDimensions=function(r,e){var t=this,n=t.cy.window(),i=n.document,a=0,s=r.pstyle("font-style").strValue,o=r.pstyle("font-size").pfValue,l=r.pstyle("font-family").strValue,u=r.pstyle("font-weight").strValue,c=this.labelCalcCanvas,h=this.labelCalcCanvasContext;if(!c){c=this.labelCalcCanvas=i.createElement("canvas"),h=this.labelCalcCanvasContext=c.getContext("2d");var d=c.style;d.position="absolute",d.left="-9999px",d.top="-9999px",d.zIndex="-1",d.visibility="hidden",d.pointerEvents="none"}h.font="".concat(s," ").concat(u," ").concat(o,"px ").concat(l);for(var f=0,p=0,m=e.split(`
`),v=0;v<m.length;v++){var g=m[v],y=h.measureText(g),_=Math.ceil(y.width),x=o;f=Math.max(_,f),p+=x}return f+=a,p+=a,{width:f,height:p}};cs.calculateLabelAngle=function(r,e){var t=r._private,n=t.rscratch,i=r.isEdge(),a=e?e+"-":"",s=r.pstyle(a+"text-rotation"),o=s.strValue;return o==="none"?0:i&&o==="autorotate"?n.labelAutoAngle:o==="autorotate"?0:s.pfValue};cs.calculateLabelAngles=function(r){var e=this,t=r.isEdge(),n=r._private,i=n.rscratch;i.labelAngle=e.calculateLabelAngle(r),t&&(i.sourceLabelAngle=e.calculateLabelAngle(r,"source"),i.targetLabelAngle=e.calculateLabelAngle(r,"target"))};var v3={},dN=28,pN=!1;v3.getNodeShape=function(r){var e=this,t=r.pstyle("shape").value;if(t==="cutrectangle"&&(r.width()<dN||r.height()<dN))return pN||(nn("The `cutrectangle` node shape can not be used at small sizes so `rectangle` is used instead"),pN=!0),"rectangle";if(r.isParent())return t==="rectangle"||t==="roundrectangle"||t==="round-rectangle"||t==="cutrectangle"||t==="cut-rectangle"||t==="barrel"?t:"rectangle";if(t==="polygon"){var n=r.pstyle("shape-polygon-points").value;return e.nodeShapes.makePolygon(n).name}return t};var Fv={};Fv.registerCalculationListeners=function(){var r=this.cy,e=r.collection(),t=this,n=function(s){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(e.merge(s),o)for(var l=0;l<s.length;l++){var u=s[l],c=u._private,h=c.rstyle;h.clean=!1,h.cleanConnected=!1}};t.binder(r).on("bounds.* dirty.*",function(s){var o=s.target;n(o)}).on("style.* background.*",function(s){var o=s.target;n(o,!1)});var i=function(s){if(s){var o=t.onUpdateEleCalcsFns;e.cleanStyle();for(var l=0;l<e.length;l++){var u=e[l],c=u._private.rstyle;u.isNode()&&!c.cleanConnected&&(n(u.connectedEdges()),c.cleanConnected=!0)}if(o)for(var h=0;h<o.length;h++){var d=o[h];d(s,e)}t.recalculateRenderedStyle(e),e=r.collection()}};t.flushRenderedStyleQueue=function(){i(!0)},t.beforeRender(i,t.beforeRenderPriorities.eleCalcs)};Fv.onUpdateEleCalcs=function(r){var e=this.onUpdateEleCalcsFns=this.onUpdateEleCalcsFns||[];e.push(r)};Fv.recalculateRenderedStyle=function(r,e){var t=function(x){return x._private.rstyle.cleanConnected};if(r.length!==0){var n=[],i=[];if(!this.destroyed){e===void 0&&(e=!0);for(var a=0;a<r.length;a++){var s=r[a],o=s._private,l=o.rstyle;s.isEdge()&&(!t(s.source())||!t(s.target()))&&(l.clean=!1),s.isEdge()&&s.isBundledBezier()&&s.parallelEdges().some(function(_){return!_._private.rstyle.clean&&_.isBundledBezier()})&&(l.clean=!1),!(e&&l.clean||s.removed())&&s.pstyle("display").value!=="none"&&(o.group==="nodes"?i.push(s):n.push(s),l.clean=!0)}for(var u=0;u<i.length;u++){var c=i[u],h=c._private,d=h.rstyle,f=c.position();this.recalculateNodeLabelProjection(c),d.nodeX=f.x,d.nodeY=f.y,d.nodeW=c.pstyle("width").pfValue,d.nodeH=c.pstyle("height").pfValue}this.recalculateEdgeProjections(n);for(var p=0;p<n.length;p++){var m=n[p],v=m._private,g=v.rstyle,y=v.rscratch;g.srcX=y.arrowStartX,g.srcY=y.arrowStartY,g.tgtX=y.arrowEndX,g.tgtY=y.arrowEndY,g.midX=y.midX,g.midY=y.midY,g.labelAngle=y.labelAngle,g.sourceLabelAngle=y.sourceLabelAngle,g.targetLabelAngle=y.targetLabelAngle}}}};var Bv={};Bv.updateCachedGrabbedEles=function(){var r=this.cachedZSortedEles;if(!!r){r.drag=[],r.nondrag=[];for(var e=[],t=0;t<r.length;t++){var n=r[t],i=n._private.rscratch;n.grabbed()&&!n.isParent()?e.push(n):i.inDragLayer?r.drag.push(n):r.nondrag.push(n)}for(var t=0;t<e.length;t++){var n=e[t];r.drag.push(n)}}};Bv.invalidateCachedZSortedEles=function(){this.cachedZSortedEles=null};Bv.getCachedZSortedEles=function(r){if(r||!this.cachedZSortedEles){var e=this.cy.mutableElements().toArray();e.sort(Qk),e.interactive=e.filter(function(t){return t.interactive()}),this.cachedZSortedEles=e,this.updateCachedGrabbedEles()}else e=this.cachedZSortedEles;return e};var m3={};[tu,$g,qr,bd,QS,cs,v3,Fv,Bv].forEach(function(r){mt(m3,r)});var y3={};y3.getCachedImage=function(r,e,t){var n=this,i=n.imageCache=n.imageCache||{},a=i[r];if(a)return a.image.complete||a.image.addEventListener("load",t),a.image;a=i[r]=i[r]||{};var s=a.image=new Image;s.addEventListener("load",t),s.addEventListener("error",function(){s.error=!0});var o="data:",l=r.substring(0,o.length).toLowerCase()===o;return l||(e=e==="null"?null:e,s.crossOrigin=e),s.src=r,s};var Jc={};Jc.registerBinding=function(r,e,t,n){var i=Array.prototype.slice.apply(arguments,[1]);if(Array.isArray(r)){for(var a=[],s=0;s<r.length;s++){var o=r[s];if(o!==void 0){var l=this.binder(o);a.push(l.on.apply(l,i))}}return a}var l=this.binder(r);return l.on.apply(l,i)};Jc.binder=function(r){var e=this,t=e.cy.window(),n=r===t||r===t.document||r===t.document.body||OW(r);if(e.supportsPassiveEvents==null){var i=!1;try{var a=Object.defineProperty({},"passive",{get:function(){return i=!0,!0}});t.addEventListener("test",null,a)}catch{}e.supportsPassiveEvents=i}var s=function(l,u,c){var h=Array.prototype.slice.call(arguments);return n&&e.supportsPassiveEvents&&(h[2]={capture:c!=null?c:!1,passive:!1,once:!1}),e.bindings.push({target:r,args:h}),(r.addEventListener||r.on).apply(r,h),this};return{on:s,addEventListener:s,addListener:s,bind:s}};Jc.nodeIsDraggable=function(r){return r&&r.isNode()&&!r.locked()&&r.grabbable()};Jc.nodeIsGrabbable=function(r){return this.nodeIsDraggable(r)&&r.interactive()};Jc.load=function(){var r=this,e=r.cy.window(),t=function(q){return q.selected()},n=function(q){var ne=q.getRootNode();if(ne&&ne.nodeType===11&&ne.host!==void 0)return ne},i=function(q,ne,fe,ce){q==null&&(q=r.cy);for(var ae=0;ae<ne.length;ae++){var ie=ne[ae];q.emit({originalEvent:fe,type:ie,position:ce})}},a=function(q){return q.shiftKey||q.metaKey||q.ctrlKey},s=function(q,ne){var fe=!0;if(r.cy.hasCompoundNodes()&&q&&q.pannable())for(var ce=0;ne&&ce<ne.length;ce++){var q=ne[ce];if(q.isNode()&&q.isParent()&&!q.pannable()){fe=!1;break}}else fe=!0;return fe},o=function(q){q[0]._private.grabbed=!0},l=function(q){q[0]._private.grabbed=!1},u=function(q){q[0]._private.rscratch.inDragLayer=!0},c=function(q){q[0]._private.rscratch.inDragLayer=!1},h=function(q){q[0]._private.rscratch.isGrabTarget=!0},d=function(q){q[0]._private.rscratch.isGrabTarget=!1},f=function(q,ne){var fe=ne.addToList,ce=fe.has(q);!ce&&q.grabbable()&&!q.locked()&&(fe.merge(q),o(q))},p=function(q,ne){if(!!q.cy().hasCompoundNodes()&&!(ne.inDragLayer==null&&ne.addToList==null)){var fe=q.descendants();ne.inDragLayer&&(fe.forEach(u),fe.connectedEdges().forEach(u)),ne.addToList&&f(fe,ne)}},m=function(q,ne){ne=ne||{};var fe=q.cy().hasCompoundNodes();ne.inDragLayer&&(q.forEach(u),q.neighborhood().stdFilter(function(ce){return!fe||ce.isEdge()}).forEach(u)),ne.addToList&&q.forEach(function(ce){f(ce,ne)}),p(q,ne),y(q,{inDragLayer:ne.inDragLayer}),r.updateCachedGrabbedEles()},v=m,g=function(q){!q||(r.getCachedZSortedEles().forEach(function(ne){l(ne),c(ne),d(ne)}),r.updateCachedGrabbedEles())},y=function(q,ne){if(!(ne.inDragLayer==null&&ne.addToList==null)&&!!q.cy().hasCompoundNodes()){var fe=q.ancestors().orphans();if(!fe.same(q)){var ce=fe.descendants().spawnSelf().merge(fe).unmerge(q).unmerge(q.descendants()),ae=ce.connectedEdges();ne.inDragLayer&&(ae.forEach(u),ce.forEach(u)),ne.addToList&&ce.forEach(function(ie){f(ie,ne)})}}},_=function(){document.activeElement!=null&&document.activeElement.blur!=null&&document.activeElement.blur()},x=typeof MutationObserver<"u",E=typeof ResizeObserver<"u";x?(r.removeObserver=new MutationObserver(function(le){for(var q=0;q<le.length;q++){var ne=le[q],fe=ne.removedNodes;if(fe)for(var ce=0;ce<fe.length;ce++){var ae=fe[ce];if(ae===r.container){r.destroy();break}}}}),r.container.parentNode&&r.removeObserver.observe(r.container.parentNode,{childList:!0})):r.registerBinding(r.container,"DOMNodeRemoved",function(le){r.destroy()});var T=md(function(){r.cy.resize()},100);x&&(r.styleObserver=new MutationObserver(T),r.styleObserver.observe(r.container,{attributes:!0})),r.registerBinding(e,"resize",T),E&&(r.resizeObserver=new ResizeObserver(T),r.resizeObserver.observe(r.container));var b=function(q,ne){for(;q!=null;)ne(q),q=q.parentNode},w=function(){r.invalidateContainerClientCoordsCache()};b(r.container,function(le){r.registerBinding(le,"transitionend",w),r.registerBinding(le,"animationend",w),r.registerBinding(le,"scroll",w)}),r.registerBinding(r.container,"contextmenu",function(le){le.preventDefault()});var A=function(){return r.selection[4]!==0},S=function(q){for(var ne=r.findContainerClientCoords(),fe=ne[0],ce=ne[1],ae=ne[2],ie=ne[3],ee=q.touches?q.touches:[q],he=!1,ge=0;ge<ee.length;ge++){var Te=ee[ge];if(fe<=Te.clientX&&Te.clientX<=fe+ae&&ce<=Te.clientY&&Te.clientY<=ce+ie){he=!0;break}}if(!he)return!1;for(var Se=r.container,Oe=q.target,J=Oe.parentNode,ve=!1;J;){if(J===Se){ve=!0;break}J=J.parentNode}return!!ve};r.registerBinding(r.container,"mousedown",function(q){if(!!S(q)&&!(r.hoverData.which===1&&q.which!==1)){q.preventDefault(),_(),r.hoverData.capture=!0,r.hoverData.which=q.which;var ne=r.cy,fe=[q.clientX,q.clientY],ce=r.projectIntoViewport(fe[0],fe[1]),ae=r.selection,ie=r.findNearestElements(ce[0],ce[1],!0,!1),ee=ie[0],he=r.dragData.possibleDragElements;r.hoverData.mdownPos=ce,r.hoverData.mdownGPos=fe;var ge=function(){r.hoverData.tapholdCancelled=!1,clearTimeout(r.hoverData.tapholdTimeout),r.hoverData.tapholdTimeout=setTimeout(function(){if(!r.hoverData.tapholdCancelled){var ue=r.hoverData.down;ue?ue.emit({originalEvent:q,type:"taphold",position:{x:ce[0],y:ce[1]}}):ne.emit({originalEvent:q,type:"taphold",position:{x:ce[0],y:ce[1]}})}},r.tapholdDuration)};if(q.which==3){r.hoverData.cxtStarted=!0;var Te={originalEvent:q,type:"cxttapstart",position:{x:ce[0],y:ce[1]}};ee?(ee.activate(),ee.emit(Te),r.hoverData.down=ee):ne.emit(Te),r.hoverData.downTime=new Date().getTime(),r.hoverData.cxtDragged=!1}else if(q.which==1){ee&&ee.activate();{if(ee!=null&&r.nodeIsGrabbable(ee)){var Se=function(ue){return{originalEvent:q,type:ue,position:{x:ce[0],y:ce[1]}}},Oe=function(ue){ue.emit(Se("grab"))};if(h(ee),!ee.selected())he=r.dragData.possibleDragElements=ne.collection(),v(ee,{addToList:he}),ee.emit(Se("grabon")).emit(Se("grab"));else{he=r.dragData.possibleDragElements=ne.collection();var J=ne.$(function(ve){return ve.isNode()&&ve.selected()&&r.nodeIsGrabbable(ve)});m(J,{addToList:he}),ee.emit(Se("grabon")),J.forEach(Oe)}r.redrawHint("eles",!0),r.redrawHint("drag",!0)}r.hoverData.down=ee,r.hoverData.downs=ie,r.hoverData.downTime=new Date().getTime()}i(ee,["mousedown","tapstart","vmousedown"],q,{x:ce[0],y:ce[1]}),ee==null?(ae[4]=1,r.data.bgActivePosistion={x:ce[0],y:ce[1]},r.redrawHint("select",!0),r.redraw()):ee.pannable()&&(ae[4]=1),ge()}ae[0]=ae[2]=ce[0],ae[1]=ae[3]=ce[1]}},!1);var C=n(r.container);r.registerBinding([e,C],"mousemove",function(q){var ne=r.hoverData.capture;if(!(!ne&&!S(q))){var fe=!1,ce=r.cy,ae=ce.zoom(),ie=[q.clientX,q.clientY],ee=r.projectIntoViewport(ie[0],ie[1]),he=r.hoverData.mdownPos,ge=r.hoverData.mdownGPos,Te=r.selection,Se=null;!r.hoverData.draggingEles&&!r.hoverData.dragging&&!r.hoverData.selecting&&(Se=r.findNearestElement(ee[0],ee[1],!0,!1));var Oe=r.hoverData.last,J=r.hoverData.down,ve=[ee[0]-Te[2],ee[1]-Te[3]],ue=r.dragData.possibleDragElements,_e;if(ge){var ke=ie[0]-ge[0],Ie=ke*ke,je=ie[1]-ge[1],$e=je*je,Xe=Ie+$e;r.hoverData.isOverThresholdDrag=_e=Xe>=r.desktopTapThreshold2}var Je=a(q);_e&&(r.hoverData.tapholdCancelled=!0);var nt=function(){var Dn=r.hoverData.dragDelta=r.hoverData.dragDelta||[];Dn.length===0?(Dn.push(ve[0]),Dn.push(ve[1])):(Dn[0]+=ve[0],Dn[1]+=ve[1])};fe=!0,i(Se,["mousemove","vmousemove","tapdrag"],q,{x:ee[0],y:ee[1]});var at=function(){r.data.bgActivePosistion=void 0,r.hoverData.selecting||ce.emit({originalEvent:q,type:"boxstart",position:{x:ee[0],y:ee[1]}}),Te[4]=1,r.hoverData.selecting=!0,r.redrawHint("select",!0),r.redraw()};if(r.hoverData.which===3){if(_e){var Xt={originalEvent:q,type:"cxtdrag",position:{x:ee[0],y:ee[1]}};J?J.emit(Xt):ce.emit(Xt),r.hoverData.cxtDragged=!0,(!r.hoverData.cxtOver||Se!==r.hoverData.cxtOver)&&(r.hoverData.cxtOver&&r.hoverData.cxtOver.emit({originalEvent:q,type:"cxtdragout",position:{x:ee[0],y:ee[1]}}),r.hoverData.cxtOver=Se,Se&&Se.emit({originalEvent:q,type:"cxtdragover",position:{x:ee[0],y:ee[1]}}))}}else if(r.hoverData.dragging){if(fe=!0,ce.panningEnabled()&&ce.userPanningEnabled()){var gt;if(r.hoverData.justStartedPan){var vt=r.hoverData.mdownPos;gt={x:(ee[0]-vt[0])*ae,y:(ee[1]-vt[1])*ae},r.hoverData.justStartedPan=!1}else gt={x:ve[0]*ae,y:ve[1]*ae};ce.panBy(gt),ce.emit("dragpan"),r.hoverData.dragged=!0}ee=r.projectIntoViewport(q.clientX,q.clientY)}else if(Te[4]==1&&(J==null||J.pannable())){if(_e){if(!r.hoverData.dragging&&ce.boxSelectionEnabled()&&(Je||!ce.panningEnabled()||!ce.userPanningEnabled()))at();else if(!r.hoverData.selecting&&ce.panningEnabled()&&ce.userPanningEnabled()){var pn=s(J,r.hoverData.downs);pn&&(r.hoverData.dragging=!0,r.hoverData.justStartedPan=!0,Te[4]=0,r.data.bgActivePosistion=Ku(he),r.redrawHint("select",!0),r.redraw())}J&&J.pannable()&&J.active()&&J.unactivate()}}else{if(J&&J.pannable()&&J.active()&&J.unactivate(),(!J||!J.grabbed())&&Se!=Oe&&(Oe&&i(Oe,["mouseout","tapdragout"],q,{x:ee[0],y:ee[1]}),Se&&i(Se,["mouseover","tapdragover"],q,{x:ee[0],y:ee[1]}),r.hoverData.last=Se),J)if(_e){if(ce.boxSelectionEnabled()&&Je)J&&J.grabbed()&&(g(ue),J.emit("freeon"),ue.emit("free"),r.dragData.didDrag&&(J.emit("dragfreeon"),ue.emit("dragfree"))),at();else if(J&&J.grabbed()&&r.nodeIsDraggable(J)){var Ft=!r.dragData.didDrag;Ft&&r.redrawHint("eles",!0),r.dragData.didDrag=!0,r.hoverData.draggingEles||m(ue,{inDragLayer:!0});var Gt={x:0,y:0};if(et(ve[0])&&et(ve[1])&&(Gt.x+=ve[0],Gt.y+=ve[1],Ft)){var Rt=r.hoverData.dragDelta;Rt&&et(Rt[0])&&et(Rt[1])&&(Gt.x+=Rt[0],Gt.y+=Rt[1])}r.hoverData.draggingEles=!0,ue.silentShift(Gt).emit("position drag"),r.redrawHint("drag",!0),r.redraw()}}else nt();fe=!0}if(Te[2]=ee[0],Te[3]=ee[1],fe)return q.stopPropagation&&q.stopPropagation(),q.preventDefault&&q.preventDefault(),!1}},!1);var R,P,M;r.registerBinding(e,"mouseup",function(q){if(!(r.hoverData.which===1&&q.which!==1&&r.hoverData.capture)){var ne=r.hoverData.capture;if(!!ne){r.hoverData.capture=!1;var fe=r.cy,ce=r.projectIntoViewport(q.clientX,q.clientY),ae=r.selection,ie=r.findNearestElement(ce[0],ce[1],!0,!1),ee=r.dragData.possibleDragElements,he=r.hoverData.down,ge=a(q);if(r.data.bgActivePosistion&&(r.redrawHint("select",!0),r.redraw()),r.hoverData.tapholdCancelled=!0,r.data.bgActivePosistion=void 0,he&&he.unactivate(),r.hoverData.which===3){var Te={originalEvent:q,type:"cxttapend",position:{x:ce[0],y:ce[1]}};if(he?he.emit(Te):fe.emit(Te),!r.hoverData.cxtDragged){var Se={originalEvent:q,type:"cxttap",position:{x:ce[0],y:ce[1]}};he?he.emit(Se):fe.emit(Se)}r.hoverData.cxtDragged=!1,r.hoverData.which=null}else if(r.hoverData.which===1){if(i(ie,["mouseup","tapend","vmouseup"],q,{x:ce[0],y:ce[1]}),!r.dragData.didDrag&&!r.hoverData.dragged&&!r.hoverData.selecting&&!r.hoverData.isOverThresholdDrag&&(i(he,["click","tap","vclick"],q,{x:ce[0],y:ce[1]}),P=!1,q.timeStamp-M<=fe.multiClickDebounceTime()?(R&&clearTimeout(R),P=!0,M=null,i(he,["dblclick","dbltap","vdblclick"],q,{x:ce[0],y:ce[1]})):(R=setTimeout(function(){P||i(he,["oneclick","onetap","voneclick"],q,{x:ce[0],y:ce[1]})},fe.multiClickDebounceTime()),M=q.timeStamp)),he==null&&!r.dragData.didDrag&&!r.hoverData.selecting&&!r.hoverData.dragged&&!a(q)&&(fe.$(t).unselect(["tapunselect"]),ee.length>0&&r.redrawHint("eles",!0),r.dragData.possibleDragElements=ee=fe.collection()),ie==he&&!r.dragData.didDrag&&!r.hoverData.selecting&&ie!=null&&ie._private.selectable&&(r.hoverData.dragging||(fe.selectionType()==="additive"||ge?ie.selected()?ie.unselect(["tapunselect"]):ie.select(["tapselect"]):ge||(fe.$(t).unmerge(ie).unselect(["tapunselect"]),ie.select(["tapselect"]))),r.redrawHint("eles",!0)),r.hoverData.selecting){var Oe=fe.collection(r.getAllInBox(ae[0],ae[1],ae[2],ae[3]));r.redrawHint("select",!0),Oe.length>0&&r.redrawHint("eles",!0),fe.emit({type:"boxend",originalEvent:q,position:{x:ce[0],y:ce[1]}});var J=function(_e){return _e.selectable()&&!_e.selected()};fe.selectionType()==="additive"||ge||fe.$(t).unmerge(Oe).unselect(),Oe.emit("box").stdFilter(J).select().emit("boxselect"),r.redraw()}if(r.hoverData.dragging&&(r.hoverData.dragging=!1,r.redrawHint("select",!0),r.redrawHint("eles",!0),r.redraw()),!ae[4]){r.redrawHint("drag",!0),r.redrawHint("eles",!0);var ve=he&&he.grabbed();g(ee),ve&&(he.emit("freeon"),ee.emit("free"),r.dragData.didDrag&&(he.emit("dragfreeon"),ee.emit("dragfree")))}}ae[4]=0,r.hoverData.down=null,r.hoverData.cxtStarted=!1,r.hoverData.draggingEles=!1,r.hoverData.selecting=!1,r.hoverData.isOverThresholdDrag=!1,r.dragData.didDrag=!1,r.hoverData.dragged=!1,r.hoverData.dragDelta=[],r.hoverData.mdownPos=null,r.hoverData.mdownGPos=null,r.hoverData.which=null}}},!1);var N=function(q){if(!r.scrollingPage){var ne=r.cy,fe=ne.zoom(),ce=ne.pan(),ae=r.projectIntoViewport(q.clientX,q.clientY),ie=[ae[0]*fe+ce.x,ae[1]*fe+ce.y];if(r.hoverData.draggingEles||r.hoverData.dragging||r.hoverData.cxtStarted||A()){q.preventDefault();return}if(ne.panningEnabled()&&ne.userPanningEnabled()&&ne.zoomingEnabled()&&ne.userZoomingEnabled()){q.preventDefault(),r.data.wheelZooming=!0,clearTimeout(r.data.wheelTimeout),r.data.wheelTimeout=setTimeout(function(){r.data.wheelZooming=!1,r.redrawHint("eles",!0),r.redraw()},150);var ee;q.deltaY!=null?ee=q.deltaY/-250:q.wheelDeltaY!=null?ee=q.wheelDeltaY/1e3:ee=q.wheelDelta/1e3,ee=ee*r.wheelSensitivity;var he=q.deltaMode===1;he&&(ee*=33);var ge=ne.zoom()*Math.pow(10,ee);q.type==="gesturechange"&&(ge=r.gestureStartZoom*q.scale),ne.zoom({level:ge,renderedPosition:{x:ie[0],y:ie[1]}}),ne.emit(q.type==="gesturechange"?"pinchzoom":"scrollzoom")}}};r.registerBinding(r.container,"wheel",N,!0),r.registerBinding(e,"scroll",function(q){r.scrollingPage=!0,clearTimeout(r.scrollingPageTimeout),r.scrollingPageTimeout=setTimeout(function(){r.scrollingPage=!1},250)},!0),r.registerBinding(r.container,"gesturestart",function(q){r.gestureStartZoom=r.cy.zoom(),r.hasTouchStarted||q.preventDefault()},!0),r.registerBinding(r.container,"gesturechange",function(le){r.hasTouchStarted||N(le)},!0),r.registerBinding(r.container,"mouseout",function(q){var ne=r.projectIntoViewport(q.clientX,q.clientY);r.cy.emit({originalEvent:q,type:"mouseout",position:{x:ne[0],y:ne[1]}})},!1),r.registerBinding(r.container,"mouseover",function(q){var ne=r.projectIntoViewport(q.clientX,q.clientY);r.cy.emit({originalEvent:q,type:"mouseover",position:{x:ne[0],y:ne[1]}})},!1);var D,I,L,z,B,k,U,G,O,F,V,$,Z,Y=function(q,ne,fe,ce){return Math.sqrt((fe-q)*(fe-q)+(ce-ne)*(ce-ne))},X=function(q,ne,fe,ce){return(fe-q)*(fe-q)+(ce-ne)*(ce-ne)},K;r.registerBinding(r.container,"touchstart",K=function(q){if(r.hasTouchStarted=!0,!!S(q)){_(),r.touchData.capture=!0,r.data.bgActivePosistion=void 0;var ne=r.cy,fe=r.touchData.now,ce=r.touchData.earlier;if(q.touches[0]){var ae=r.projectIntoViewport(q.touches[0].clientX,q.touches[0].clientY);fe[0]=ae[0],fe[1]=ae[1]}if(q.touches[1]){var ae=r.projectIntoViewport(q.touches[1].clientX,q.touches[1].clientY);fe[2]=ae[0],fe[3]=ae[1]}if(q.touches[2]){var ae=r.projectIntoViewport(q.touches[2].clientX,q.touches[2].clientY);fe[4]=ae[0],fe[5]=ae[1]}if(q.touches[1]){r.touchData.singleTouchMoved=!0,g(r.dragData.touchDragEles);var ie=r.findContainerClientCoords();O=ie[0],F=ie[1],V=ie[2],$=ie[3],D=q.touches[0].clientX-O,I=q.touches[0].clientY-F,L=q.touches[1].clientX-O,z=q.touches[1].clientY-F,Z=0<=D&&D<=V&&0<=L&&L<=V&&0<=I&&I<=$&&0<=z&&z<=$;var ee=ne.pan(),he=ne.zoom();B=Y(D,I,L,z),k=X(D,I,L,z),U=[(D+L)/2,(I+z)/2],G=[(U[0]-ee.x)/he,(U[1]-ee.y)/he];var ge=200,Te=ge*ge;if(k<Te&&!q.touches[2]){var Se=r.findNearestElement(fe[0],fe[1],!0,!0),Oe=r.findNearestElement(fe[2],fe[3],!0,!0);Se&&Se.isNode()?(Se.activate().emit({originalEvent:q,type:"cxttapstart",position:{x:fe[0],y:fe[1]}}),r.touchData.start=Se):Oe&&Oe.isNode()?(Oe.activate().emit({originalEvent:q,type:"cxttapstart",position:{x:fe[0],y:fe[1]}}),r.touchData.start=Oe):ne.emit({originalEvent:q,type:"cxttapstart",position:{x:fe[0],y:fe[1]}}),r.touchData.start&&(r.touchData.start._private.grabbed=!1),r.touchData.cxt=!0,r.touchData.cxtDragged=!1,r.data.bgActivePosistion=void 0,r.redraw();return}}if(q.touches[2])ne.boxSelectionEnabled()&&q.preventDefault();else if(!q.touches[1]){if(q.touches[0]){var J=r.findNearestElements(fe[0],fe[1],!0,!0),ve=J[0];if(ve!=null&&(ve.activate(),r.touchData.start=ve,r.touchData.starts=J,r.nodeIsGrabbable(ve))){var ue=r.dragData.touchDragEles=ne.collection(),_e=null;r.redrawHint("eles",!0),r.redrawHint("drag",!0),ve.selected()?(_e=ne.$(function(Xe){return Xe.selected()&&r.nodeIsGrabbable(Xe)}),m(_e,{addToList:ue})):v(ve,{addToList:ue}),h(ve);var ke=function(Je){return{originalEvent:q,type:Je,position:{x:fe[0],y:fe[1]}}};ve.emit(ke("grabon")),_e?_e.forEach(function(Xe){Xe.emit(ke("grab"))}):ve.emit(ke("grab"))}i(ve,["touchstart","tapstart","vmousedown"],q,{x:fe[0],y:fe[1]}),ve==null&&(r.data.bgActivePosistion={x:ae[0],y:ae[1]},r.redrawHint("select",!0),r.redraw()),r.touchData.singleTouchMoved=!1,r.touchData.singleTouchStartTime=+new Date,clearTimeout(r.touchData.tapholdTimeout),r.touchData.tapholdTimeout=setTimeout(function(){r.touchData.singleTouchMoved===!1&&!r.pinching&&!r.touchData.selecting&&i(r.touchData.start,["taphold"],q,{x:fe[0],y:fe[1]})},r.tapholdDuration)}}if(q.touches.length>=1){for(var Ie=r.touchData.startPosition=[null,null,null,null,null,null],je=0;je<fe.length;je++)Ie[je]=ce[je]=fe[je];var $e=q.touches[0];r.touchData.startGPosition=[$e.clientX,$e.clientY]}}},!1);var se;r.registerBinding(e,"touchmove",se=function(q){var ne=r.touchData.capture;if(!(!ne&&!S(q))){var fe=r.selection,ce=r.cy,ae=r.touchData.now,ie=r.touchData.earlier,ee=ce.zoom();if(q.touches[0]){var he=r.projectIntoViewport(q.touches[0].clientX,q.touches[0].clientY);ae[0]=he[0],ae[1]=he[1]}if(q.touches[1]){var he=r.projectIntoViewport(q.touches[1].clientX,q.touches[1].clientY);ae[2]=he[0],ae[3]=he[1]}if(q.touches[2]){var he=r.projectIntoViewport(q.touches[2].clientX,q.touches[2].clientY);ae[4]=he[0],ae[5]=he[1]}var ge=r.touchData.startGPosition,Te;if(ne&&q.touches[0]&&ge){for(var Se=[],Oe=0;Oe<ae.length;Oe++)Se[Oe]=ae[Oe]-ie[Oe];var J=q.touches[0].clientX-ge[0],ve=J*J,ue=q.touches[0].clientY-ge[1],_e=ue*ue,ke=ve+_e;Te=ke>=r.touchTapThreshold2}if(ne&&r.touchData.cxt){q.preventDefault();var Ie=q.touches[0].clientX-O,je=q.touches[0].clientY-F,$e=q.touches[1].clientX-O,Xe=q.touches[1].clientY-F,Je=X(Ie,je,$e,Xe),nt=Je/k,at=150,Xt=at*at,gt=1.5,vt=gt*gt;if(nt>=vt||Je>=Xt){r.touchData.cxt=!1,r.data.bgActivePosistion=void 0,r.redrawHint("select",!0);var pn={originalEvent:q,type:"cxttapend",position:{x:ae[0],y:ae[1]}};r.touchData.start?(r.touchData.start.unactivate().emit(pn),r.touchData.start=null):ce.emit(pn)}}if(ne&&r.touchData.cxt){var pn={originalEvent:q,type:"cxtdrag",position:{x:ae[0],y:ae[1]}};r.data.bgActivePosistion=void 0,r.redrawHint("select",!0),r.touchData.start?r.touchData.start.emit(pn):ce.emit(pn),r.touchData.start&&(r.touchData.start._private.grabbed=!1),r.touchData.cxtDragged=!0;var Ft=r.findNearestElement(ae[0],ae[1],!0,!0);(!r.touchData.cxtOver||Ft!==r.touchData.cxtOver)&&(r.touchData.cxtOver&&r.touchData.cxtOver.emit({originalEvent:q,type:"cxtdragout",position:{x:ae[0],y:ae[1]}}),r.touchData.cxtOver=Ft,Ft&&Ft.emit({originalEvent:q,type:"cxtdragover",position:{x:ae[0],y:ae[1]}}))}else if(ne&&q.touches[2]&&ce.boxSelectionEnabled())q.preventDefault(),r.data.bgActivePosistion=void 0,this.lastThreeTouch=+new Date,r.touchData.selecting||ce.emit({originalEvent:q,type:"boxstart",position:{x:ae[0],y:ae[1]}}),r.touchData.selecting=!0,r.touchData.didSelect=!0,fe[4]=1,!fe||fe.length===0||fe[0]===void 0?(fe[0]=(ae[0]+ae[2]+ae[4])/3,fe[1]=(ae[1]+ae[3]+ae[5])/3,fe[2]=(ae[0]+ae[2]+ae[4])/3+1,fe[3]=(ae[1]+ae[3]+ae[5])/3+1):(fe[2]=(ae[0]+ae[2]+ae[4])/3,fe[3]=(ae[1]+ae[3]+ae[5])/3),r.redrawHint("select",!0),r.redraw();else if(ne&&q.touches[1]&&!r.touchData.didSelect&&ce.zoomingEnabled()&&ce.panningEnabled()&&ce.userZoomingEnabled()&&ce.userPanningEnabled()){q.preventDefault(),r.data.bgActivePosistion=void 0,r.redrawHint("select",!0);var Gt=r.dragData.touchDragEles;if(Gt){r.redrawHint("drag",!0);for(var Rt=0;Rt<Gt.length;Rt++){var fr=Gt[Rt]._private;fr.grabbed=!1,fr.rscratch.inDragLayer=!1}}var Dn=r.touchData.start,Ie=q.touches[0].clientX-O,je=q.touches[0].clientY-F,$e=q.touches[1].clientX-O,Xe=q.touches[1].clientY-F,ps=Y(Ie,je,$e,Xe),Wi=ps/B;if(Z){var Va=Ie-D,Ha=je-I,pa=$e-L,ao=Xe-z,Wa=(Va+pa)/2,qa=(Ha+ao)/2,Q=ce.zoom(),ye=Q*Wi,Ce=ce.pan(),Re=G[0]*Q+Ce.x,xe=G[1]*Q+Ce.y,ze={x:-ye/Q*(Re-Ce.x-Wa)+Re,y:-ye/Q*(xe-Ce.y-qa)+xe};if(Dn&&Dn.active()){var Gt=r.dragData.touchDragEles;g(Gt),r.redrawHint("drag",!0),r.redrawHint("eles",!0),Dn.unactivate().emit("freeon"),Gt.emit("free"),r.dragData.didDrag&&(Dn.emit("dragfreeon"),Gt.emit("dragfree"))}ce.viewport({zoom:ye,pan:ze,cancelOnFailedZoom:!0}),ce.emit("pinchzoom"),B=ps,D=Ie,I=je,L=$e,z=Xe,r.pinching=!0}if(q.touches[0]){var he=r.projectIntoViewport(q.touches[0].clientX,q.touches[0].clientY);ae[0]=he[0],ae[1]=he[1]}if(q.touches[1]){var he=r.projectIntoViewport(q.touches[1].clientX,q.touches[1].clientY);ae[2]=he[0],ae[3]=he[1]}if(q.touches[2]){var he=r.projectIntoViewport(q.touches[2].clientX,q.touches[2].clientY);ae[4]=he[0],ae[5]=he[1]}}else if(q.touches[0]&&!r.touchData.didSelect){var Ke=r.touchData.start,st=r.touchData.last,Ft;if(!r.hoverData.draggingEles&&!r.swipePanning&&(Ft=r.findNearestElement(ae[0],ae[1],!0,!0)),ne&&Ke!=null&&q.preventDefault(),ne&&Ke!=null&&r.nodeIsDraggable(Ke))if(Te){var Gt=r.dragData.touchDragEles,ot=!r.dragData.didDrag;ot&&m(Gt,{inDragLayer:!0}),r.dragData.didDrag=!0;var pt={x:0,y:0};if(et(Se[0])&&et(Se[1])&&(pt.x+=Se[0],pt.y+=Se[1],ot)){r.redrawHint("eles",!0);var rt=r.touchData.dragDelta;rt&&et(rt[0])&&et(rt[1])&&(pt.x+=rt[0],pt.y+=rt[1])}r.hoverData.draggingEles=!0,Gt.silentShift(pt).emit("position drag"),r.redrawHint("drag",!0),r.touchData.startPosition[0]==ie[0]&&r.touchData.startPosition[1]==ie[1]&&r.redrawHint("eles",!0),r.redraw()}else{var rt=r.touchData.dragDelta=r.touchData.dragDelta||[];rt.length===0?(rt.push(Se[0]),rt.push(Se[1])):(rt[0]+=Se[0],rt[1]+=Se[1])}if(i(Ke||Ft,["touchmove","tapdrag","vmousemove"],q,{x:ae[0],y:ae[1]}),(!Ke||!Ke.grabbed())&&Ft!=st&&(st&&st.emit({originalEvent:q,type:"tapdragout",position:{x:ae[0],y:ae[1]}}),Ft&&Ft.emit({originalEvent:q,type:"tapdragover",position:{x:ae[0],y:ae[1]}})),r.touchData.last=Ft,ne)for(var Rt=0;Rt<ae.length;Rt++)ae[Rt]&&r.touchData.startPosition[Rt]&&Te&&(r.touchData.singleTouchMoved=!0);if(ne&&(Ke==null||Ke.pannable())&&ce.panningEnabled()&&ce.userPanningEnabled()){var Ve=s(Ke,r.touchData.starts);Ve&&(q.preventDefault(),r.data.bgActivePosistion||(r.data.bgActivePosistion=Ku(r.touchData.startPosition)),r.swipePanning?(ce.panBy({x:Se[0]*ee,y:Se[1]*ee}),ce.emit("dragpan")):Te&&(r.swipePanning=!0,ce.panBy({x:J*ee,y:ue*ee}),ce.emit("dragpan"),Ke&&(Ke.unactivate(),r.redrawHint("select",!0),r.touchData.start=null)));var he=r.projectIntoViewport(q.touches[0].clientX,q.touches[0].clientY);ae[0]=he[0],ae[1]=he[1]}}for(var Oe=0;Oe<ae.length;Oe++)ie[Oe]=ae[Oe];ne&&q.touches.length>0&&!r.hoverData.draggingEles&&!r.swipePanning&&r.data.bgActivePosistion!=null&&(r.data.bgActivePosistion=void 0,r.redrawHint("select",!0),r.redraw())}},!1);var oe;r.registerBinding(e,"touchcancel",oe=function(q){var ne=r.touchData.start;r.touchData.capture=!1,ne&&ne.unactivate()});var W,Ne,Be,we;if(r.registerBinding(e,"touchend",W=function(q){var ne=r.touchData.start,fe=r.touchData.capture;if(fe)q.touches.length===0&&(r.touchData.capture=!1),q.preventDefault();else return;var ce=r.selection;r.swipePanning=!1,r.hoverData.draggingEles=!1;var ae=r.cy,ie=ae.zoom(),ee=r.touchData.now,he=r.touchData.earlier;if(q.touches[0]){var ge=r.projectIntoViewport(q.touches[0].clientX,q.touches[0].clientY);ee[0]=ge[0],ee[1]=ge[1]}if(q.touches[1]){var ge=r.projectIntoViewport(q.touches[1].clientX,q.touches[1].clientY);ee[2]=ge[0],ee[3]=ge[1]}if(q.touches[2]){var ge=r.projectIntoViewport(q.touches[2].clientX,q.touches[2].clientY);ee[4]=ge[0],ee[5]=ge[1]}ne&&ne.unactivate();var Te;if(r.touchData.cxt){if(Te={originalEvent:q,type:"cxttapend",position:{x:ee[0],y:ee[1]}},ne?ne.emit(Te):ae.emit(Te),!r.touchData.cxtDragged){var Se={originalEvent:q,type:"cxttap",position:{x:ee[0],y:ee[1]}};ne?ne.emit(Se):ae.emit(Se)}r.touchData.start&&(r.touchData.start._private.grabbed=!1),r.touchData.cxt=!1,r.touchData.start=null,r.redraw();return}if(!q.touches[2]&&ae.boxSelectionEnabled()&&r.touchData.selecting){r.touchData.selecting=!1;var Oe=ae.collection(r.getAllInBox(ce[0],ce[1],ce[2],ce[3]));ce[0]=void 0,ce[1]=void 0,ce[2]=void 0,ce[3]=void 0,ce[4]=0,r.redrawHint("select",!0),ae.emit({type:"boxend",originalEvent:q,position:{x:ee[0],y:ee[1]}});var J=function(Xt){return Xt.selectable()&&!Xt.selected()};Oe.emit("box").stdFilter(J).select().emit("boxselect"),Oe.nonempty()&&r.redrawHint("eles",!0),r.redraw()}if(ne!=null&&ne.unactivate(),q.touches[2])r.data.bgActivePosistion=void 0,r.redrawHint("select",!0);else if(!q.touches[1]){if(!q.touches[0]){if(!q.touches[0]){r.data.bgActivePosistion=void 0,r.redrawHint("select",!0);var ve=r.dragData.touchDragEles;if(ne!=null){var ue=ne._private.grabbed;g(ve),r.redrawHint("drag",!0),r.redrawHint("eles",!0),ue&&(ne.emit("freeon"),ve.emit("free"),r.dragData.didDrag&&(ne.emit("dragfreeon"),ve.emit("dragfree"))),i(ne,["touchend","tapend","vmouseup","tapdragout"],q,{x:ee[0],y:ee[1]}),ne.unactivate(),r.touchData.start=null}else{var _e=r.findNearestElement(ee[0],ee[1],!0,!0);i(_e,["touchend","tapend","vmouseup","tapdragout"],q,{x:ee[0],y:ee[1]})}var ke=r.touchData.startPosition[0]-ee[0],Ie=ke*ke,je=r.touchData.startPosition[1]-ee[1],$e=je*je,Xe=Ie+$e,Je=Xe*ie*ie;r.touchData.singleTouchMoved||(ne||ae.$(":selected").unselect(["tapunselect"]),i(ne,["tap","vclick"],q,{x:ee[0],y:ee[1]}),Ne=!1,q.timeStamp-we<=ae.multiClickDebounceTime()?(Be&&clearTimeout(Be),Ne=!0,we=null,i(ne,["dbltap","vdblclick"],q,{x:ee[0],y:ee[1]})):(Be=setTimeout(function(){Ne||i(ne,["onetap","voneclick"],q,{x:ee[0],y:ee[1]})},ae.multiClickDebounceTime()),we=q.timeStamp)),ne!=null&&!r.dragData.didDrag&&ne._private.selectable&&Je<r.touchTapThreshold2&&!r.pinching&&(ae.selectionType()==="single"?(ae.$(t).unmerge(ne).unselect(["tapunselect"]),ne.select(["tapselect"])):ne.selected()?ne.unselect(["tapunselect"]):ne.select(["tapselect"]),r.redrawHint("eles",!0)),r.touchData.singleTouchMoved=!0}}}for(var nt=0;nt<ee.length;nt++)he[nt]=ee[nt];r.dragData.didDrag=!1,q.touches.length===0&&(r.touchData.dragDelta=[],r.touchData.startPosition=[null,null,null,null,null,null],r.touchData.startGPosition=null,r.touchData.didSelect=!1),q.touches.length<2&&(q.touches.length===1&&(r.touchData.startGPosition=[q.touches[0].clientX,q.touches[0].clientY]),r.pinching=!1,r.redrawHint("eles",!0),r.redraw())},!1),typeof TouchEvent>"u"){var pe=[],Me=function(q){return{clientX:q.clientX,clientY:q.clientY,force:1,identifier:q.pointerId,pageX:q.pageX,pageY:q.pageY,radiusX:q.width/2,radiusY:q.height/2,screenX:q.screenX,screenY:q.screenY,target:q.target}},Ae=function(q){return{event:q,touch:Me(q)}},j=function(q){pe.push(Ae(q))},H=function(q){for(var ne=0;ne<pe.length;ne++){var fe=pe[ne];if(fe.event.pointerId===q.pointerId){pe.splice(ne,1);return}}},te=function(q){var ne=pe.filter(function(fe){return fe.event.pointerId===q.pointerId})[0];ne.event=q,ne.touch=Me(q)},me=function(q){q.touches=pe.map(function(ne){return ne.touch})},Ee=function(q){return q.pointerType==="mouse"||q.pointerType===4};r.registerBinding(r.container,"pointerdown",function(le){Ee(le)||(le.preventDefault(),j(le),me(le),K(le))}),r.registerBinding(r.container,"pointerup",function(le){Ee(le)||(H(le),me(le),W(le))}),r.registerBinding(r.container,"pointercancel",function(le){Ee(le)||(H(le),me(le),oe(le))}),r.registerBinding(r.container,"pointermove",function(le){Ee(le)||(le.preventDefault(),te(le),me(le),se(le))})}};var Qs={};Qs.generatePolygon=function(r,e){return this.nodeShapes[r]={renderer:this,name:r,points:e,draw:function(n,i,a,s,o,l){this.renderer.nodeShapeImpl("polygon",n,i,a,s,o,this.points)},intersectLine:function(n,i,a,s,o,l,u,c){return Cf(o,l,this.points,n,i,a/2,s/2,u)},checkPoint:function(n,i,a,s,o,l,u,c){return $s(n,i,this.points,l,u,s,o,[0,-1],a)}}};Qs.generateEllipse=function(){return this.nodeShapes.ellipse={renderer:this,name:"ellipse",draw:function(e,t,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,t,n,i,a)},intersectLine:function(e,t,n,i,a,s,o,l){return t$(a,s,e,t,n/2+o,i/2+o)},checkPoint:function(e,t,n,i,a,s,o,l){return Il(e,t,i,a,s,o,n)}}};Qs.generateRoundPolygon=function(r,e){return this.nodeShapes[r]={renderer:this,name:r,points:e,getOrCreateCorners:function(n,i,a,s,o,l,u){if(l[u]!==void 0&&l[u+"-cx"]===n&&l[u+"-cy"]===i)return l[u];l[u]=new Array(e.length/2),l[u+"-cx"]=n,l[u+"-cy"]=i;var c=a/2,h=s/2;o=o==="auto"?xk(a,s):o;for(var d=new Array(e.length/2),f=0;f<e.length/2;f++)d[f]={x:n+c*e[f*2],y:i+h*e[f*2+1]};var p,m,v,g,y=d.length;for(m=d[y-1],p=0;p<y;p++)v=d[p%y],g=d[(p+1)%y],l[u][p]=KS(m,v,g,o),m=v,v=g;return l[u]},draw:function(n,i,a,s,o,l,u){this.renderer.nodeShapeImpl("round-polygon",n,i,a,s,o,this.points,this.getOrCreateCorners(i,a,s,o,l,u,"drawCorners"))},intersectLine:function(n,i,a,s,o,l,u,c,h){return n$(o,l,this.points,n,i,a,s,u,this.getOrCreateCorners(n,i,a,s,c,h,"corners"))},checkPoint:function(n,i,a,s,o,l,u,c,h){return e$(n,i,this.points,l,u,s,o,this.getOrCreateCorners(l,u,s,o,c,h,"corners"))}}};Qs.generateRoundRectangle=function(){return this.nodeShapes["round-rectangle"]=this.nodeShapes.roundrectangle={renderer:this,name:"round-rectangle",points:jr(4,0),draw:function(e,t,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,t,n,i,a,this.points,s)},intersectLine:function(e,t,n,i,a,s,o,l){return yk(a,s,e,t,n,i,o,l)},checkPoint:function(e,t,n,i,a,s,o,l){var u=i/2,c=a/2;l=l==="auto"?Hl(i,a):l,l=Math.min(u,c,l);var h=l*2;return!!($s(e,t,this.points,s,o,i,a-h,[0,-1],n)||$s(e,t,this.points,s,o,i-h,a,[0,-1],n)||Il(e,t,h,h,s-u+l,o-c+l,n)||Il(e,t,h,h,s+u-l,o-c+l,n)||Il(e,t,h,h,s+u-l,o+c-l,n)||Il(e,t,h,h,s-u+l,o+c-l,n))}}};Qs.generateCutRectangle=function(){return this.nodeShapes["cut-rectangle"]=this.nodeShapes.cutrectangle={renderer:this,name:"cut-rectangle",cornerLength:kS(),points:jr(4,0),draw:function(e,t,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,t,n,i,a,null,s)},generateCutTrianglePts:function(e,t,n,i,a){var s=a==="auto"?this.cornerLength:a,o=t/2,l=e/2,u=n-l,c=n+l,h=i-o,d=i+o;return{topLeft:[u,h+s,u+s,h,u+s,h+s],topRight:[c-s,h,c,h+s,c-s,h+s],bottomRight:[c,d-s,c-s,d,c-s,d-s],bottomLeft:[u+s,d,u,d-s,u+s,d-s]}},intersectLine:function(e,t,n,i,a,s,o,l){var u=this.generateCutTrianglePts(n+2*o,i+2*o,e,t,l),c=[].concat.apply([],[u.topLeft.splice(0,4),u.topRight.splice(0,4),u.bottomRight.splice(0,4),u.bottomLeft.splice(0,4)]);return Cf(a,s,c,e,t)},checkPoint:function(e,t,n,i,a,s,o,l){var u=l==="auto"?this.cornerLength:l;if($s(e,t,this.points,s,o,i,a-2*u,[0,-1],n)||$s(e,t,this.points,s,o,i-2*u,a,[0,-1],n))return!0;var c=this.generateCutTrianglePts(i,a,s,o);return li(e,t,c.topLeft)||li(e,t,c.topRight)||li(e,t,c.bottomRight)||li(e,t,c.bottomLeft)}}};Qs.generateBarrel=function(){return this.nodeShapes.barrel={renderer:this,name:"barrel",points:jr(4,0),draw:function(e,t,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,t,n,i,a)},intersectLine:function(e,t,n,i,a,s,o,l){var u=.15,c=.5,h=.85,d=this.generateBarrelBezierPts(n+2*o,i+2*o,e,t),f=function(v){var g=oc({x:v[0],y:v[1]},{x:v[2],y:v[3]},{x:v[4],y:v[5]},u),y=oc({x:v[0],y:v[1]},{x:v[2],y:v[3]},{x:v[4],y:v[5]},c),_=oc({x:v[0],y:v[1]},{x:v[2],y:v[3]},{x:v[4],y:v[5]},h);return[v[0],v[1],g.x,g.y,y.x,y.y,_.x,_.y,v[4],v[5]]},p=[].concat(f(d.topLeft),f(d.topRight),f(d.bottomRight),f(d.bottomLeft));return Cf(a,s,p,e,t)},generateBarrelBezierPts:function(e,t,n,i){var a=t/2,s=e/2,o=n-s,l=n+s,u=i-a,c=i+a,h=Sw(e,t),d=h.heightOffset,f=h.widthOffset,p=h.ctrlPtOffsetPct*e,m={topLeft:[o,u+d,o+p,u,o+f,u],topRight:[l-f,u,l-p,u,l,u+d],bottomRight:[l,c-d,l-p,c,l-f,c],bottomLeft:[o+f,c,o+p,c,o,c-d]};return m.topLeft.isTop=!0,m.topRight.isTop=!0,m.bottomLeft.isBottom=!0,m.bottomRight.isBottom=!0,m},checkPoint:function(e,t,n,i,a,s,o,l){var u=Sw(i,a),c=u.heightOffset,h=u.widthOffset;if($s(e,t,this.points,s,o,i,a-2*c,[0,-1],n)||$s(e,t,this.points,s,o,i-2*h,a,[0,-1],n))return!0;for(var d=this.generateBarrelBezierPts(i,a,s,o),f=function(w,A,S){var C=S[4],R=S[2],P=S[0],M=S[5],N=S[1],D=Math.min(C,P),I=Math.max(C,P),L=Math.min(M,N),z=Math.max(M,N);if(D<=w&&w<=I&&L<=A&&A<=z){var B=r$(C,R,P),k=Kq(B[0],B[1],B[2],w),U=k.filter(function(G){return 0<=G&&G<=1});if(U.length>0)return U[0]}return null},p=Object.keys(d),m=0;m<p.length;m++){var v=p[m],g=d[v],y=f(e,t,g);if(y!=null){var _=g[5],x=g[3],E=g[1],T=gr(_,x,E,y);if(g.isTop&&T<=t||g.isBottom&&t<=T)return!0}}return!1}}};Qs.generateBottomRoundrectangle=function(){return this.nodeShapes["bottom-round-rectangle"]=this.nodeShapes.bottomroundrectangle={renderer:this,name:"bottom-round-rectangle",points:jr(4,0),draw:function(e,t,n,i,a,s){this.renderer.nodeShapeImpl(this.name,e,t,n,i,a,this.points,s)},intersectLine:function(e,t,n,i,a,s,o,l){var u=e-(n/2+o),c=t-(i/2+o),h=c,d=e+(n/2+o),f=So(a,s,e,t,u,c,d,h,!1);return f.length>0?f:yk(a,s,e,t,n,i,o,l)},checkPoint:function(e,t,n,i,a,s,o,l){l=l==="auto"?Hl(i,a):l;var u=2*l;if($s(e,t,this.points,s,o,i,a-u,[0,-1],n)||$s(e,t,this.points,s,o,i-u,a,[0,-1],n))return!0;var c=i/2+2*n,h=a/2+2*n,d=[s-c,o-h,s-c,o,s+c,o,s+c,o-h];return!!(li(e,t,d)||Il(e,t,u,u,s+i/2-l,o+a/2-l,n)||Il(e,t,u,u,s-i/2+l,o+a/2-l,n))}}};Qs.registerNodeShapes=function(){var r=this.nodeShapes={},e=this;this.generateEllipse(),this.generatePolygon("triangle",jr(3,0)),this.generateRoundPolygon("round-triangle",jr(3,0)),this.generatePolygon("rectangle",jr(4,0)),r.square=r.rectangle,this.generateRoundRectangle(),this.generateCutRectangle(),this.generateBarrel(),this.generateBottomRoundrectangle();{var t=[0,1,1,0,0,-1,-1,0];this.generatePolygon("diamond",t),this.generateRoundPolygon("round-diamond",t)}this.generatePolygon("pentagon",jr(5,0)),this.generateRoundPolygon("round-pentagon",jr(5,0)),this.generatePolygon("hexagon",jr(6,0)),this.generateRoundPolygon("round-hexagon",jr(6,0)),this.generatePolygon("heptagon",jr(7,0)),this.generateRoundPolygon("round-heptagon",jr(7,0)),this.generatePolygon("octagon",jr(8,0)),this.generateRoundPolygon("round-octagon",jr(8,0));var n=new Array(20);{var i=ww(5,0),a=ww(5,Math.PI/5),s=.5*(3-Math.sqrt(5));s*=1.57;for(var o=0;o<a.length/2;o++)a[o*2]*=s,a[o*2+1]*=s;for(var o=0;o<20/4;o++)n[o*4]=i[o*2],n[o*4+1]=i[o*2+1],n[o*4+2]=a[o*2],n[o*4+3]=a[o*2+1]}n=_k(n),this.generatePolygon("star",n),this.generatePolygon("vee",[-1,-1,0,-.333,1,-1,0,1]),this.generatePolygon("rhomboid",[-1,-1,.333,-1,1,1,-.333,1]),this.generatePolygon("right-rhomboid",[-.333,-1,1,-1,.333,1,-1,1]),this.nodeShapes.concavehexagon=this.generatePolygon("concave-hexagon",[-1,-.95,-.75,0,-1,.95,1,.95,.75,0,1,-.95]);{var l=[-1,-1,.25,-1,1,0,.25,1,-1,1];this.generatePolygon("tag",l),this.generateRoundPolygon("round-tag",l)}r.makePolygon=function(u){var c=u.join("$"),h="polygon-"+c,d;return(d=this[h])?d:e.generatePolygon(h,u)}};var Ed={};Ed.timeToRender=function(){return this.redrawTotalTime/this.redrawCount};Ed.redraw=function(r){r=r||dk();var e=this;e.averageRedrawTime===void 0&&(e.averageRedrawTime=0),e.lastRedrawTime===void 0&&(e.lastRedrawTime=0),e.lastDrawTime===void 0&&(e.lastDrawTime=0),e.requestedFrame=!0,e.renderOptions=r};Ed.beforeRender=function(r,e){if(!this.destroyed){e==null&&Nn("Priority is not optional for beforeRender");var t=this.beforeRenderCallbacks;t.push({fn:r,priority:e}),t.sort(function(n,i){return i.priority-n.priority})}};var gN=function(e,t,n){for(var i=e.beforeRenderCallbacks,a=0;a<i.length;a++)i[a].fn(t,n)};Ed.startRenderLoop=function(){var r=this,e=r.cy;if(!r.renderLoopStarted){r.renderLoopStarted=!0;var t=function(i){if(!r.destroyed){if(!e.batching())if(r.requestedFrame&&!r.skipFrame){gN(r,!0,i);var a=qs();r.render(r.renderOptions);var s=r.lastDrawTime=qs();r.averageRedrawTime===void 0&&(r.averageRedrawTime=s-a),r.redrawCount===void 0&&(r.redrawCount=0),r.redrawCount++,r.redrawTotalTime===void 0&&(r.redrawTotalTime=0);var o=s-a;r.redrawTotalTime+=o,r.lastRedrawTime=o,r.averageRedrawTime=r.averageRedrawTime/2+o/2,r.requestedFrame=!1}else gN(r,!1,i);r.skipFrame=!1,Ug(t)}};Ug(t)}};var _X=function(e){this.init(e)},_3=_X,eh=_3.prototype;eh.clientFunctions=["redrawHint","render","renderTo","matchCanvasSize","nodeShapeImpl","arrowShapeImpl"];eh.init=function(r){var e=this;e.options=r,e.cy=r.cy;var t=e.container=r.cy.container(),n=e.cy.window();if(n){var i=n.document,a=i.head,s="__________cytoscape_stylesheet",o="__________cytoscape_container",l=i.getElementById(s)!=null;if(t.className.indexOf(o)<0&&(t.className=(t.className||"")+" "+o),!l){var u=i.createElement("style");u.id=s,u.textContent="."+o+" { position: relative; }",a.insertBefore(u,a.children[0])}var c=n.getComputedStyle(t),h=c.getPropertyValue("position");h==="static"&&nn("A Cytoscape container has style position:static and so can not use UI extensions properly")}e.selection=[void 0,void 0,void 0,void 0,0],e.bezierProjPcts=[.05,.225,.4,.5,.6,.775,.95],e.hoverData={down:null,last:null,downTime:null,triggerMode:null,dragging:!1,initialPan:[null,null],capture:!1},e.dragData={possibleDragElements:[]},e.touchData={start:null,capture:!1,startPosition:[null,null,null,null,null,null],singleTouchStartTime:null,singleTouchMoved:!0,now:[null,null,null,null,null,null],earlier:[null,null,null,null,null,null]},e.redraws=0,e.showFps=r.showFps,e.debug=r.debug,e.webgl=r.webgl,e.hideEdgesOnViewport=r.hideEdgesOnViewport,e.textureOnViewport=r.textureOnViewport,e.wheelSensitivity=r.wheelSensitivity,e.motionBlurEnabled=r.motionBlur,e.forcedPixelRatio=et(r.pixelRatio)?r.pixelRatio:null,e.motionBlur=r.motionBlur,e.motionBlurOpacity=r.motionBlurOpacity,e.motionBlurTransparency=1-e.motionBlurOpacity,e.motionBlurPxRatio=1,e.mbPxRBlurry=1,e.minMbLowQualFrames=4,e.fullQualityMb=!1,e.clearedForMotionBlur=[],e.desktopTapThreshold=r.desktopTapThreshold,e.desktopTapThreshold2=r.desktopTapThreshold*r.desktopTapThreshold,e.touchTapThreshold=r.touchTapThreshold,e.touchTapThreshold2=r.touchTapThreshold*r.touchTapThreshold,e.tapholdDuration=500,e.bindings=[],e.beforeRenderCallbacks=[],e.beforeRenderPriorities={animations:400,eleCalcs:300,eleTxrDeq:200,lyrTxrDeq:150,lyrTxrSkip:100},e.registerNodeShapes(),e.registerArrowShapes(),e.registerCalculationListeners()};eh.notify=function(r,e){var t=this,n=t.cy;if(!this.destroyed){if(r==="init"){t.load();return}if(r==="destroy"){t.destroy();return}(r==="add"||r==="remove"||r==="move"&&n.hasCompoundNodes()||r==="load"||r==="zorder"||r==="mount")&&t.invalidateCachedZSortedEles(),r==="viewport"&&t.redrawHint("select",!0),r==="gc"&&t.redrawHint("gc",!0),(r==="load"||r==="resize"||r==="mount")&&(t.invalidateContainerClientCoordsCache(),t.matchCanvasSize(t.container)),t.redrawHint("eles",!0),t.redrawHint("drag",!0),this.startRenderLoop(),this.redraw()}};eh.destroy=function(){var r=this;r.destroyed=!0,r.cy.stopAnimationLoop();for(var e=0;e<r.bindings.length;e++){var t=r.bindings[e],n=t,i=n.target;(i.off||i.removeEventListener).apply(i,n.args)}if(r.bindings=[],r.beforeRenderCallbacks=[],r.onUpdateEleCalcsFns=[],r.removeObserver&&r.removeObserver.disconnect(),r.styleObserver&&r.styleObserver.disconnect(),r.resizeObserver&&r.resizeObserver.disconnect(),r.labelCalcDiv)try{document.body.removeChild(r.labelCalcDiv)}catch{}};eh.isHeadless=function(){return!1};[jS,m3,y3,Jc,Qs,Ed].forEach(function(r){mt(eh,r)});var u0=1e3/60,x3={setupDequeueing:function(e){return function(){var n=this,i=this.renderer;if(!n.dequeueingSetup){n.dequeueingSetup=!0;var a=md(function(){i.redrawHint("eles",!0),i.redrawHint("drag",!0),i.redraw()},e.deqRedrawThreshold),s=function(u,c){var h=qs(),d=i.averageRedrawTime,f=i.lastRedrawTime,p=[],m=i.cy.extent(),v=i.getPixelRatio();for(u||i.flushRenderedStyleQueue();;){var g=qs(),y=g-h,_=g-c;if(f<u0){var x=u0-(u?d:0);if(_>=e.deqFastCost*x)break}else if(u){if(y>=e.deqCost*f||y>=e.deqAvgCost*d)break}else if(_>=e.deqNoDrawCost*u0)break;var E=e.deq(n,v,m);if(E.length>0)for(var T=0;T<E.length;T++)p.push(E[T]);else break}p.length>0&&(e.onDeqd(n,p),!u&&e.shouldRedraw(n,p,v,m)&&a())},o=e.priority||OS;i.beforeRender(s,o(n))}}}},xX=function(){function r(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:kg;jo(this,r),this.idsByKey=new Os,this.keyForId=new Os,this.cachesByLvl=new Os,this.lvls=[],this.getKey=e,this.doesEleInvalidateKey=t}return Ko(r,[{key:"getIdsFor",value:function(t){t==null&&Nn("Can not get id list for null key");var n=this.idsByKey,i=this.idsByKey.get(t);return i||(i=new jc,n.set(t,i)),i}},{key:"addIdForKey",value:function(t,n){t!=null&&this.getIdsFor(t).add(n)}},{key:"deleteIdForKey",value:function(t,n){t!=null&&this.getIdsFor(t).delete(n)}},{key:"getNumberOfIdsForKey",value:function(t){return t==null?0:this.getIdsFor(t).size}},{key:"updateKeyMappingFor",value:function(t){var n=t.id(),i=this.keyForId.get(n),a=this.getKey(t);this.deleteIdForKey(i,n),this.addIdForKey(a,n),this.keyForId.set(n,a)}},{key:"deleteKeyMappingFor",value:function(t){var n=t.id(),i=this.keyForId.get(n);this.deleteIdForKey(i,n),this.keyForId.delete(n)}},{key:"keyHasChangedFor",value:function(t){var n=t.id(),i=this.keyForId.get(n),a=this.getKey(t);return i!==a}},{key:"isInvalid",value:function(t){return this.keyHasChangedFor(t)||this.doesEleInvalidateKey(t)}},{key:"getCachesAt",value:function(t){var n=this.cachesByLvl,i=this.lvls,a=n.get(t);return a||(a=new Os,n.set(t,a),i.push(t)),a}},{key:"getCache",value:function(t,n){return this.getCachesAt(n).get(t)}},{key:"get",value:function(t,n){var i=this.getKey(t),a=this.getCache(i,n);return a!=null&&this.updateKeyMappingFor(t),a}},{key:"getForCachedKey",value:function(t,n){var i=this.keyForId.get(t.id()),a=this.getCache(i,n);return a}},{key:"hasCache",value:function(t,n){return this.getCachesAt(n).has(t)}},{key:"has",value:function(t,n){var i=this.getKey(t);return this.hasCache(i,n)}},{key:"setCache",value:function(t,n,i){i.key=t,this.getCachesAt(n).set(t,i)}},{key:"set",value:function(t,n,i){var a=this.getKey(t);this.setCache(a,n,i),this.updateKeyMappingFor(t)}},{key:"deleteCache",value:function(t,n){this.getCachesAt(n).delete(t)}},{key:"delete",value:function(t,n){var i=this.getKey(t);this.deleteCache(i,n)}},{key:"invalidateKey",value:function(t){var n=this;this.lvls.forEach(function(i){return n.deleteCache(t,i)})}},{key:"invalidate",value:function(t){var n=t.id(),i=this.keyForId.get(n);this.deleteKeyMappingFor(t);var a=this.doesEleInvalidateKey(t);return a&&this.invalidateKey(i),a||this.getNumberOfIdsForKey(i)===0}}])}(),vN=25,ap=50,xg=-4,Uw=3,b3=7.99,bX=8,EX=1024,TX=1024,wX=1024,SX=.2,AX=.8,MX=10,CX=.15,RX=.1,NX=.9,PX=.9,DX=100,LX=1,Zu={dequeue:"dequeue",downscale:"downscale",highQuality:"highQuality"},IX=cr({getKey:null,doesEleInvalidateKey:kg,drawElement:null,getBoundingBox:null,getRotationPoint:null,getRotationOffset:null,isVisible:ck,allowEdgeTxrCaching:!0,allowParentTxrCaching:!0}),Jh=function(e,t){var n=this;n.renderer=e,n.onDequeues=[];var i=IX(t);mt(n,i),n.lookup=new xX(i.getKey,i.doesEleInvalidateKey),n.setupDequeueing()},hr=Jh.prototype;hr.reasons=Zu;hr.getTextureQueue=function(r){var e=this;return e.eleImgCaches=e.eleImgCaches||{},e.eleImgCaches[r]=e.eleImgCaches[r]||[]};hr.getRetiredTextureQueue=function(r){var e=this,t=e.eleImgCaches.retired=e.eleImgCaches.retired||{},n=t[r]=t[r]||[];return n};hr.getElementQueue=function(){var r=this,e=r.eleCacheQueue=r.eleCacheQueue||new yd(function(t,n){return n.reqs-t.reqs});return e};hr.getElementKeyToQueue=function(){var r=this,e=r.eleKeyToCacheQueue=r.eleKeyToCacheQueue||{};return e};hr.getElement=function(r,e,t,n,i){var a=this,s=this.renderer,o=s.cy.zoom(),l=this.lookup;if(!e||e.w===0||e.h===0||isNaN(e.w)||isNaN(e.h)||!r.visible()||r.removed()||!a.allowEdgeTxrCaching&&r.isEdge()||!a.allowParentTxrCaching&&r.isParent())return null;if(n==null&&(n=Math.ceil(BS(o*t))),n<xg)n=xg;else if(o>=b3||n>Uw)return null;var u=Math.pow(2,n),c=e.h*u,h=e.w*u,d=s.eleTextBiggerThanMin(r,u);if(!this.isVisible(r,d))return null;var f=l.get(r,n);if(f&&f.invalidated&&(f.invalidated=!1,f.texture.invalidatedWidth-=f.width),f)return f;var p;if(c<=vN?p=vN:c<=ap?p=ap:p=Math.ceil(c/ap)*ap,c>wX||h>TX)return null;var m=a.getTextureQueue(p),v=m[m.length-2],g=function(){return a.recycleTexture(p,h)||a.addTexture(p,h)};v||(v=m[m.length-1]),v||(v=g()),v.width-v.usedWidth<h&&(v=g());for(var y=function(D){return D&&D.scaledLabelShown===d},_=i&&i===Zu.dequeue,x=i&&i===Zu.highQuality,E=i&&i===Zu.downscale,T,b=n+1;b<=Uw;b++){var w=l.get(r,b);if(w){T=w;break}}var A=T&&T.level===n+1?T:null,S=function(){v.context.drawImage(A.texture.canvas,A.x,0,A.width,A.height,v.usedWidth,0,h,c)};if(v.context.setTransform(1,0,0,1,0,0),v.context.clearRect(v.usedWidth,0,h,p),y(A))S();else if(y(T))if(x){for(var C=T.level;C>n;C--)A=a.getElement(r,e,t,C,Zu.downscale);S()}else return a.queueElement(r,T.level-1),T;else{var R;if(!_&&!x&&!E)for(var P=n-1;P>=xg;P--){var M=l.get(r,P);if(M){R=M;break}}if(y(R))return a.queueElement(r,n),R;v.context.translate(v.usedWidth,0),v.context.scale(u,u),this.drawElement(v.context,r,e,d,!1),v.context.scale(1/u,1/u),v.context.translate(-v.usedWidth,0)}return f={x:v.usedWidth,texture:v,level:n,scale:u,width:h,height:c,scaledLabelShown:d},v.usedWidth+=Math.ceil(h+bX),v.eleCaches.push(f),l.set(r,n,f),a.checkTextureFullness(v),f};hr.invalidateElements=function(r){for(var e=0;e<r.length;e++)this.invalidateElement(r[e])};hr.invalidateElement=function(r){var e=this,t=e.lookup,n=[],i=t.isInvalid(r);if(!!i){for(var a=xg;a<=Uw;a++){var s=t.getForCachedKey(r,a);s&&n.push(s)}var o=t.invalidate(r);if(o)for(var l=0;l<n.length;l++){var u=n[l],c=u.texture;c.invalidatedWidth+=u.width,u.invalidated=!0,e.checkTextureUtility(c)}e.removeFromQueue(r)}};hr.checkTextureUtility=function(r){r.invalidatedWidth>=SX*r.width&&this.retireTexture(r)};hr.checkTextureFullness=function(r){var e=this,t=e.getTextureQueue(r.height);r.usedWidth/r.width>AX&&r.fullnessChecks>=MX?ko(t,r):r.fullnessChecks++};hr.retireTexture=function(r){var e=this,t=r.height,n=e.getTextureQueue(t),i=this.lookup;ko(n,r),r.retired=!0;for(var a=r.eleCaches,s=0;s<a.length;s++){var o=a[s];i.deleteCache(o.key,o.level)}FS(a);var l=e.getRetiredTextureQueue(t);l.push(r)};hr.addTexture=function(r,e){var t=this,n=t.getTextureQueue(r),i={};return n.push(i),i.eleCaches=[],i.height=r,i.width=Math.max(EX,e),i.usedWidth=0,i.invalidatedWidth=0,i.fullnessChecks=0,i.canvas=t.renderer.makeOffscreenCanvas(i.width,i.height),i.context=i.canvas.getContext("2d"),i};hr.recycleTexture=function(r,e){for(var t=this,n=t.getTextureQueue(r),i=t.getRetiredTextureQueue(r),a=0;a<i.length;a++){var s=i[a];if(s.width>=e)return s.retired=!1,s.usedWidth=0,s.invalidatedWidth=0,s.fullnessChecks=0,FS(s.eleCaches),s.context.setTransform(1,0,0,1,0,0),s.context.clearRect(0,0,s.width,s.height),ko(i,s),n.push(s),s}};hr.queueElement=function(r,e){var t=this,n=t.getElementQueue(),i=t.getElementKeyToQueue(),a=this.getKey(r),s=i[a];if(s)s.level=Math.max(s.level,e),s.eles.merge(r),s.reqs++,n.updateItem(s);else{var o={eles:r.spawn().merge(r),level:e,reqs:1,key:a};n.push(o),i[a]=o}};hr.dequeue=function(r){for(var e=this,t=e.getElementQueue(),n=e.getElementKeyToQueue(),i=[],a=e.lookup,s=0;s<LX&&t.size()>0;s++){var o=t.pop(),l=o.key,u=o.eles[0],c=a.hasCache(u,o.level);if(n[l]=null,c)continue;i.push(o);var h=e.getBoundingBox(u);e.getElement(u,h,r,o.level,Zu.dequeue)}return i};hr.removeFromQueue=function(r){var e=this,t=e.getElementQueue(),n=e.getElementKeyToQueue(),i=this.getKey(r),a=n[i];a!=null&&(a.eles.length===1?(a.reqs=IS,t.updateItem(a),t.pop(),n[i]=null):a.eles.unmerge(r))};hr.onDequeue=function(r){this.onDequeues.push(r)};hr.offDequeue=function(r){ko(this.onDequeues,r)};hr.setupDequeueing=x3.setupDequeueing({deqRedrawThreshold:DX,deqCost:CX,deqAvgCost:RX,deqNoDrawCost:NX,deqFastCost:PX,deq:function(e,t,n){return e.dequeue(t,n)},onDeqd:function(e,t){for(var n=0;n<e.onDequeues.length;n++){var i=e.onDequeues[n];i(t)}},shouldRedraw:function(e,t,n,i){for(var a=0;a<t.length;a++)for(var s=t[a].eles,o=0;o<s.length;o++){var l=s[o].boundingBox();if(US(l,i))return!0}return!1},priority:function(e){return e.renderer.beforeRenderPriorities.eleTxrDeq}});var OX=1,hf=-4,Xg=2,FX=3.99,BX=50,UX=50,kX=.15,GX=.1,zX=.9,VX=.9,HX=1,mN=250,WX=4e3*4e3,yN=32767,qX=!0,E3=function(e){var t=this,n=t.renderer=e,i=n.cy;t.layersByLevel={},t.firstGet=!0,t.lastInvalidationTime=qs()-2*mN,t.skipping=!1,t.eleTxrDeqs=i.collection(),t.scheduleElementRefinement=md(function(){t.refineElementTextures(t.eleTxrDeqs),t.eleTxrDeqs.unmerge(t.eleTxrDeqs)},UX),n.beforeRender(function(s,o){o-t.lastInvalidationTime<=mN?t.skipping=!0:t.skipping=!1},n.beforeRenderPriorities.lyrTxrSkip);var a=function(o,l){return l.reqs-o.reqs};t.layersQueue=new yd(a),t.setupDequeueing()},Pr=E3.prototype,_N=0,$X=Math.pow(2,53)-1;Pr.makeLayer=function(r,e){var t=Math.pow(2,e),n=Math.ceil(r.w*t),i=Math.ceil(r.h*t),a=this.renderer.makeOffscreenCanvas(n,i),s={id:_N=++_N%$X,bb:r,level:e,width:n,height:i,canvas:a,context:a.getContext("2d"),eles:[],elesQueue:[],reqs:0},o=s.context,l=-s.bb.x1,u=-s.bb.y1;return o.scale(t,t),o.translate(l,u),s};Pr.getLayers=function(r,e,t){var n=this,i=n.renderer,a=i.cy,s=a.zoom(),o=n.firstGet;if(n.firstGet=!1,t==null){if(t=Math.ceil(BS(s*e)),t<hf)t=hf;else if(s>=FX||t>Xg)return null}n.validateLayersElesOrdering(t,r);var l=n.layersByLevel,u=Math.pow(2,t),c=l[t]=l[t]||[],h,d=n.levelIsComplete(t,r),f,p=function(){var S=function(N){if(n.validateLayersElesOrdering(N,r),n.levelIsComplete(N,r))return f=l[N],!0},C=function(N){if(!f)for(var D=t+N;hf<=D&&D<=Xg&&!S(D);D+=N);};C(1),C(-1);for(var R=c.length-1;R>=0;R--){var P=c[R];P.invalid&&ko(c,P)}};if(!d)p();else return c;var m=function(){if(!h){h=bi();for(var S=0;S<r.length;S++)vk(h,r[S].boundingBox())}return h},v=function(S){S=S||{};var C=S.after;m();var R=Math.ceil(h.w*u),P=Math.ceil(h.h*u);if(R>yN||P>yN)return null;var M=R*P;if(M>WX)return null;var N=n.makeLayer(h,t);if(C!=null){var D=c.indexOf(C)+1;c.splice(D,0,N)}else(S.insert===void 0||S.insert)&&c.unshift(N);return N};if(n.skipping&&!o)return null;for(var g=null,y=r.length/OX,_=!o,x=0;x<r.length;x++){var E=r[x],T=E._private.rscratch,b=T.imgLayerCaches=T.imgLayerCaches||{},w=b[t];if(w){g=w;continue}if((!g||g.eles.length>=y||!mk(g.bb,E.boundingBox()))&&(g=v({insert:!0,after:g}),!g))return null;f||_?n.queueLayer(g,E):n.drawEleInLayer(g,E,t,e),g.eles.push(E),b[t]=g}return f||(_?null:c)};Pr.getEleLevelForLayerLevel=function(r,e){return r};Pr.drawEleInLayer=function(r,e,t,n){var i=this,a=this.renderer,s=r.context,o=e.boundingBox();o.w===0||o.h===0||!e.visible()||(t=i.getEleLevelForLayerLevel(t,n),a.setImgSmoothing(s,!1),a.drawCachedElement(s,e,null,null,t,qX),a.setImgSmoothing(s,!0))};Pr.levelIsComplete=function(r,e){var t=this,n=t.layersByLevel[r];if(!n||n.length===0)return!1;for(var i=0,a=0;a<n.length;a++){var s=n[a];if(s.reqs>0||s.invalid)return!1;i+=s.eles.length}return i===e.length};Pr.validateLayersElesOrdering=function(r,e){var t=this.layersByLevel[r];if(!!t)for(var n=0;n<t.length;n++){for(var i=t[n],a=-1,s=0;s<e.length;s++)if(i.eles[0]===e[s]){a=s;break}if(a<0){this.invalidateLayer(i);continue}for(var o=a,s=0;s<i.eles.length;s++)if(i.eles[s]!==e[o+s]){this.invalidateLayer(i);break}}};Pr.updateElementsInLayers=function(r,e){for(var t=this,n=dd(r[0]),i=0;i<r.length;i++)for(var a=n?null:r[i],s=n?r[i]:r[i].ele,o=s._private.rscratch,l=o.imgLayerCaches=o.imgLayerCaches||{},u=hf;u<=Xg;u++){var c=l[u];!c||a&&t.getEleLevelForLayerLevel(c.level)!==a.level||e(c,s,a)}};Pr.haveLayers=function(){for(var r=this,e=!1,t=hf;t<=Xg;t++){var n=r.layersByLevel[t];if(n&&n.length>0){e=!0;break}}return e};Pr.invalidateElements=function(r){var e=this;r.length!==0&&(e.lastInvalidationTime=qs(),!(r.length===0||!e.haveLayers())&&e.updateElementsInLayers(r,function(n,i,a){e.invalidateLayer(n)}))};Pr.invalidateLayer=function(r){if(this.lastInvalidationTime=qs(),!r.invalid){var e=r.level,t=r.eles,n=this.layersByLevel[e];ko(n,r),r.elesQueue=[],r.invalid=!0,r.replacement&&(r.replacement.invalid=!0);for(var i=0;i<t.length;i++){var a=t[i]._private.rscratch.imgLayerCaches;a&&(a[e]=null)}}};Pr.refineElementTextures=function(r){var e=this;e.updateElementsInLayers(r,function(n,i,a){var s=n.replacement;if(s||(s=n.replacement=e.makeLayer(n.bb,n.level),s.replaces=n,s.eles=n.eles),!s.reqs)for(var o=0;o<s.eles.length;o++)e.queueLayer(s,s.eles[o])})};Pr.enqueueElementRefinement=function(r){this.eleTxrDeqs.merge(r),this.scheduleElementRefinement()};Pr.queueLayer=function(r,e){var t=this,n=t.layersQueue,i=r.elesQueue,a=i.hasId=i.hasId||{};if(!r.replacement){if(e){if(a[e.id()])return;i.push(e),a[e.id()]=!0}r.reqs?(r.reqs++,n.updateItem(r)):(r.reqs=1,n.push(r))}};Pr.dequeue=function(r){for(var e=this,t=e.layersQueue,n=[],i=0;i<HX&&t.size()!==0;){var a=t.peek();if(a.replacement){t.pop();continue}if(a.replaces&&a!==a.replaces.replacement){t.pop();continue}if(a.invalid){t.pop();continue}var s=a.elesQueue.shift();s&&(e.drawEleInLayer(a,s,a.level,r),i++),n.length===0&&n.push(!0),a.elesQueue.length===0&&(t.pop(),a.reqs=0,a.replaces&&e.applyLayerReplacement(a),e.requestRedraw())}return n};Pr.applyLayerReplacement=function(r){var e=this,t=e.layersByLevel[r.level],n=r.replaces,i=t.indexOf(n);if(!(i<0||n.invalid)){t[i]=r;for(var a=0;a<r.eles.length;a++){var s=r.eles[a]._private,o=s.imgLayerCaches=s.imgLayerCaches||{};o&&(o[r.level]=r)}e.requestRedraw()}};Pr.requestRedraw=md(function(){var r=this.renderer;r.redrawHint("eles",!0),r.redrawHint("drag",!0),r.redraw()},100);Pr.setupDequeueing=x3.setupDequeueing({deqRedrawThreshold:BX,deqCost:kX,deqAvgCost:GX,deqNoDrawCost:zX,deqFastCost:VX,deq:function(e,t){return e.dequeue(t)},onDeqd:OS,shouldRedraw:ck,priority:function(e){return e.renderer.beforeRenderPriorities.lyrTxrDeq}});var T3={},xN;function XX(r,e){for(var t=0;t<e.length;t++){var n=e[t];r.lineTo(n.x,n.y)}}function YX(r,e,t){for(var n,i=0;i<e.length;i++){var a=e[i];i===0&&(n=a),r.lineTo(a.x,a.y)}r.quadraticCurveTo(t.x,t.y,n.x,n.y)}function bN(r,e,t){r.beginPath&&r.beginPath();for(var n=e,i=0;i<n.length;i++){var a=n[i];r.lineTo(a.x,a.y)}var s=t,o=t[0];r.moveTo(o.x,o.y);for(var i=1;i<s.length;i++){var a=s[i];r.lineTo(a.x,a.y)}r.closePath&&r.closePath()}function jX(r,e,t,n,i){r.beginPath&&r.beginPath(),r.arc(t,n,i,0,Math.PI*2,!1);var a=e,s=a[0];r.moveTo(s.x,s.y);for(var o=0;o<a.length;o++){var l=a[o];r.lineTo(l.x,l.y)}r.closePath&&r.closePath()}function KX(r,e,t,n){r.arc(e,t,n,0,Math.PI*2,!1)}T3.arrowShapeImpl=function(r){return(xN||(xN={polygon:XX,"triangle-backcurve":YX,"triangle-tee":bN,"circle-triangle":jX,"triangle-cross":bN,circle:KX}))[r]};var hs={};hs.drawElement=function(r,e,t,n,i,a){var s=this;e.isNode()?s.drawNode(r,e,t,n,i,a):s.drawEdge(r,e,t,n,i,a)};hs.drawElementOverlay=function(r,e){var t=this;e.isNode()?t.drawNodeOverlay(r,e):t.drawEdgeOverlay(r,e)};hs.drawElementUnderlay=function(r,e){var t=this;e.isNode()?t.drawNodeUnderlay(r,e):t.drawEdgeUnderlay(r,e)};hs.drawCachedElementPortion=function(r,e,t,n,i,a,s,o){var l=this,u=t.getBoundingBox(e);if(!(u.w===0||u.h===0)){var c=t.getElement(e,u,n,i,a);if(c!=null){var h=o(l,e);if(h===0)return;var d=s(l,e),f=u.x1,p=u.y1,m=u.w,v=u.h,g,y,_,x,E;if(d!==0){var T=t.getRotationPoint(e);_=T.x,x=T.y,r.translate(_,x),r.rotate(d),E=l.getImgSmoothing(r),E||l.setImgSmoothing(r,!0);var b=t.getRotationOffset(e);g=b.x,y=b.y}else g=f,y=p;var w;h!==1&&(w=r.globalAlpha,r.globalAlpha=w*h),r.drawImage(c.texture.canvas,c.x,0,c.width,c.height,g,y,m,v),h!==1&&(r.globalAlpha=w),d!==0&&(r.rotate(-d),r.translate(-_,-x),E||l.setImgSmoothing(r,!1))}else t.drawElement(r,e)}};var QX=function(){return 0},ZX=function(e,t){return e.getTextAngle(t,null)},JX=function(e,t){return e.getTextAngle(t,"source")},eY=function(e,t){return e.getTextAngle(t,"target")},tY=function(e,t){return t.effectiveOpacity()},c0=function(e,t){return t.pstyle("text-opacity").pfValue*t.effectiveOpacity()};hs.drawCachedElement=function(r,e,t,n,i,a){var s=this,o=s.data,l=o.eleTxrCache,u=o.lblTxrCache,c=o.slbTxrCache,h=o.tlbTxrCache,d=e.boundingBox(),f=a===!0?l.reasons.highQuality:null;if(!(d.w===0||d.h===0||!e.visible())&&(!n||US(d,n))){var p=e.isEdge(),m=e.element()._private.rscratch.badLine;s.drawElementUnderlay(r,e),s.drawCachedElementPortion(r,e,l,t,i,f,QX,tY),(!p||!m)&&s.drawCachedElementPortion(r,e,u,t,i,f,ZX,c0),p&&!m&&(s.drawCachedElementPortion(r,e,c,t,i,f,JX,c0),s.drawCachedElementPortion(r,e,h,t,i,f,eY,c0)),s.drawElementOverlay(r,e)}};hs.drawElements=function(r,e){for(var t=this,n=0;n<e.length;n++){var i=e[n];t.drawElement(r,i)}};hs.drawCachedElements=function(r,e,t,n){for(var i=this,a=0;a<e.length;a++){var s=e[a];i.drawCachedElement(r,s,t,n)}};hs.drawCachedNodes=function(r,e,t,n){for(var i=this,a=0;a<e.length;a++){var s=e[a];!s.isNode()||i.drawCachedElement(r,s,t,n)}};hs.drawLayeredElements=function(r,e,t,n){var i=this,a=i.data.lyrTxrCache.getLayers(e,t);if(a)for(var s=0;s<a.length;s++){var o=a[s],l=o.bb;l.w===0||l.h===0||r.drawImage(o.canvas,l.x1,l.y1,l.w,l.h)}else i.drawCachedElements(r,e,t,n)};var Zs={};Zs.drawEdge=function(r,e,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this,o=e._private.rscratch;if(!(a&&!e.visible())&&!(o.badLine||o.allpts==null||isNaN(o.allpts[0]))){var l;t&&(l=t,r.translate(-l.x1,-l.y1));var u=a?e.pstyle("opacity").value:1,c=a?e.pstyle("line-opacity").value:1,h=e.pstyle("curve-style").value,d=e.pstyle("line-style").value,f=e.pstyle("width").pfValue,p=e.pstyle("line-cap").value,m=e.pstyle("line-outline-width").value,v=e.pstyle("line-outline-color").value,g=u*c,y=u*c,_=function(){var N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:g;h==="straight-triangle"?(s.eleStrokeStyle(r,e,N),s.drawEdgeTrianglePath(e,r,o.allpts)):(r.lineWidth=f,r.lineCap=p,s.eleStrokeStyle(r,e,N),s.drawEdgePath(e,r,o.allpts,d),r.lineCap="butt")},x=function(){var N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:g;if(r.lineWidth=f+m,r.lineCap=p,m>0)s.colorStrokeStyle(r,v[0],v[1],v[2],N);else{r.lineCap="butt";return}h==="straight-triangle"?s.drawEdgeTrianglePath(e,r,o.allpts):(s.drawEdgePath(e,r,o.allpts,d),r.lineCap="butt")},E=function(){!i||s.drawEdgeOverlay(r,e)},T=function(){!i||s.drawEdgeUnderlay(r,e)},b=function(){var N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:y;s.drawArrowheads(r,e,N)},w=function(){s.drawElementText(r,e,null,n)};r.lineJoin="round";var A=e.pstyle("ghost").value==="yes";if(A){var S=e.pstyle("ghost-offset-x").pfValue,C=e.pstyle("ghost-offset-y").pfValue,R=e.pstyle("ghost-opacity").value,P=g*R;r.translate(S,C),_(P),b(P),r.translate(-S,-C)}else x();T(),_(),b(),E(),w(),t&&r.translate(l.x1,l.y1)}};var w3=function(e){if(!["overlay","underlay"].includes(e))throw new Error("Invalid state");return function(t,n){if(!!n.visible()){var i=n.pstyle("".concat(e,"-opacity")).value;if(i!==0){var a=this,s=a.usePaths(),o=n._private.rscratch,l=n.pstyle("".concat(e,"-padding")).pfValue,u=2*l,c=n.pstyle("".concat(e,"-color")).value;t.lineWidth=u,o.edgeType==="self"&&!s?t.lineCap="butt":t.lineCap="round",a.colorStrokeStyle(t,c[0],c[1],c[2],i),a.drawEdgePath(n,t,o.allpts,"solid")}}}};Zs.drawEdgeOverlay=w3("overlay");Zs.drawEdgeUnderlay=w3("underlay");Zs.drawEdgePath=function(r,e,t,n){var i=r._private.rscratch,a=e,s,o=!1,l=this.usePaths(),u=r.pstyle("line-dash-pattern").pfValue,c=r.pstyle("line-dash-offset").pfValue;if(l){var h=t.join("$"),d=i.pathCacheKey&&i.pathCacheKey===h;d?(s=e=i.pathCache,o=!0):(s=e=new Path2D,i.pathCacheKey=h,i.pathCache=s)}if(a.setLineDash)switch(n){case"dotted":a.setLineDash([1,1]);break;case"dashed":a.setLineDash(u),a.lineDashOffset=c;break;case"solid":a.setLineDash([]);break}if(!o&&!i.badLine)switch(e.beginPath&&e.beginPath(),e.moveTo(t[0],t[1]),i.edgeType){case"bezier":case"self":case"compound":case"multibezier":for(var f=2;f+3<t.length;f+=4)e.quadraticCurveTo(t[f],t[f+1],t[f+2],t[f+3]);break;case"straight":case"haystack":for(var p=2;p+1<t.length;p+=2)e.lineTo(t[p],t[p+1]);break;case"segments":if(i.isRound){var m=Na(i.roundCorners),v;try{for(m.s();!(v=m.n()).done;){var g=v.value;f3(e,g)}}catch(_){m.e(_)}finally{m.f()}e.lineTo(t[t.length-2],t[t.length-1])}else for(var y=2;y+1<t.length;y+=2)e.lineTo(t[y],t[y+1]);break}e=a,l?e.stroke(s):e.stroke(),e.setLineDash&&e.setLineDash([])};Zs.drawEdgeTrianglePath=function(r,e,t){e.fillStyle=e.strokeStyle;for(var n=r.pstyle("width").pfValue,i=0;i+1<t.length;i+=2){var a=[t[i+2]-t[i],t[i+3]-t[i+1]],s=Math.sqrt(a[0]*a[0]+a[1]*a[1]),o=[a[1]/s,-a[0]/s],l=[o[0]*n/2,o[1]*n/2];e.beginPath(),e.moveTo(t[i]-l[0],t[i+1]-l[1]),e.lineTo(t[i]+l[0],t[i+1]+l[1]),e.lineTo(t[i+2],t[i+3]),e.closePath(),e.fill()}};Zs.drawArrowheads=function(r,e,t){var n=e._private.rscratch,i=n.edgeType==="haystack";i||this.drawArrowhead(r,e,"source",n.arrowStartX,n.arrowStartY,n.srcArrowAngle,t),this.drawArrowhead(r,e,"mid-target",n.midX,n.midY,n.midtgtArrowAngle,t),this.drawArrowhead(r,e,"mid-source",n.midX,n.midY,n.midsrcArrowAngle,t),i||this.drawArrowhead(r,e,"target",n.arrowEndX,n.arrowEndY,n.tgtArrowAngle,t)};Zs.drawArrowhead=function(r,e,t,n,i,a,s){if(!(isNaN(n)||n==null||isNaN(i)||i==null||isNaN(a)||a==null)){var o=this,l=e.pstyle(t+"-arrow-shape").value;if(l!=="none"){var u=e.pstyle(t+"-arrow-fill").value==="hollow"?"both":"filled",c=e.pstyle(t+"-arrow-fill").value,h=e.pstyle("width").pfValue,d=e.pstyle(t+"-arrow-width"),f=d.value==="match-line"?h:d.pfValue;d.units==="%"&&(f*=h);var p=e.pstyle("opacity").value;s===void 0&&(s=p);var m=r.globalCompositeOperation;(s!==1||c==="hollow")&&(r.globalCompositeOperation="destination-out",o.colorFillStyle(r,255,255,255,1),o.colorStrokeStyle(r,255,255,255,1),o.drawArrowShape(e,r,u,h,l,f,n,i,a),r.globalCompositeOperation=m);var v=e.pstyle(t+"-arrow-color").value;o.colorFillStyle(r,v[0],v[1],v[2],s),o.colorStrokeStyle(r,v[0],v[1],v[2],s),o.drawArrowShape(e,r,c,h,l,f,n,i,a)}}};Zs.drawArrowShape=function(r,e,t,n,i,a,s,o,l){var u=this,c=this.usePaths()&&i!=="triangle-cross",h=!1,d,f=e,p={x:s,y:o},m=r.pstyle("arrow-scale").value,v=this.getArrowWidth(n,m),g=u.arrowShapes[i];if(c){var y=u.arrowPathCache=u.arrowPathCache||[],_=Uo(i),x=y[_];x!=null?(d=e=x,h=!0):(d=e=new Path2D,y[_]=d)}h||(e.beginPath&&e.beginPath(),c?g.draw(e,1,0,{x:0,y:0},1):g.draw(e,v,l,p,n),e.closePath&&e.closePath()),e=f,c&&(e.translate(s,o),e.rotate(l),e.scale(v,v)),(t==="filled"||t==="both")&&(c?e.fill(d):e.fill()),(t==="hollow"||t==="both")&&(e.lineWidth=a/(c?v:1),e.lineJoin="miter",c?e.stroke(d):e.stroke()),c&&(e.scale(1/v,1/v),e.rotate(-l),e.translate(-s,-o))};var ZS={};ZS.safeDrawImage=function(r,e,t,n,i,a,s,o,l,u){if(!(i<=0||a<=0||l<=0||u<=0))try{r.drawImage(e,t,n,i,a,s,o,l,u)}catch(c){nn(c)}};ZS.drawInscribedImage=function(r,e,t,n,i){var a=this,s=t.position(),o=s.x,l=s.y,u=t.cy().style(),c=u.getIndexedStyle.bind(u),h=c(t,"background-fit","value",n),d=c(t,"background-repeat","value",n),f=t.width(),p=t.height(),m=t.padding()*2,v=f+(c(t,"background-width-relative-to","value",n)==="inner"?0:m),g=p+(c(t,"background-height-relative-to","value",n)==="inner"?0:m),y=t._private.rscratch,_=c(t,"background-clip","value",n),x=_==="node",E=c(t,"background-image-opacity","value",n)*i,T=c(t,"background-image-smoothing","value",n),b=t.pstyle("corner-radius").value;b!=="auto"&&(b=t.pstyle("corner-radius").pfValue);var w=e.width||e.cachedW,A=e.height||e.cachedH;(w==null||A==null)&&(document.body.appendChild(e),w=e.cachedW=e.width||e.offsetWidth,A=e.cachedH=e.height||e.offsetHeight,document.body.removeChild(e));var S=w,C=A;if(c(t,"background-width","value",n)!=="auto"&&(c(t,"background-width","units",n)==="%"?S=c(t,"background-width","pfValue",n)*v:S=c(t,"background-width","pfValue",n)),c(t,"background-height","value",n)!=="auto"&&(c(t,"background-height","units",n)==="%"?C=c(t,"background-height","pfValue",n)*g:C=c(t,"background-height","pfValue",n)),!(S===0||C===0)){if(h==="contain"){var R=Math.min(v/S,g/C);S*=R,C*=R}else if(h==="cover"){var R=Math.max(v/S,g/C);S*=R,C*=R}var P=o-v/2,M=c(t,"background-position-x","units",n),N=c(t,"background-position-x","pfValue",n);M==="%"?P+=(v-S)*N:P+=N;var D=c(t,"background-offset-x","units",n),I=c(t,"background-offset-x","pfValue",n);D==="%"?P+=(v-S)*I:P+=I;var L=l-g/2,z=c(t,"background-position-y","units",n),B=c(t,"background-position-y","pfValue",n);z==="%"?L+=(g-C)*B:L+=B;var k=c(t,"background-offset-y","units",n),U=c(t,"background-offset-y","pfValue",n);k==="%"?L+=(g-C)*U:L+=U,y.pathCache&&(P-=o,L-=l,o=0,l=0);var G=r.globalAlpha;r.globalAlpha=E;var O=a.getImgSmoothing(r),F=!1;if(T==="no"&&O?(a.setImgSmoothing(r,!1),F=!0):T==="yes"&&!O&&(a.setImgSmoothing(r,!0),F=!0),d==="no-repeat")x&&(r.save(),y.pathCache?r.clip(y.pathCache):(a.nodeShapes[a.getNodeShape(t)].draw(r,o,l,v,g,b,y),r.clip())),a.safeDrawImage(r,e,0,0,w,A,P,L,S,C),x&&r.restore();else{var V=r.createPattern(e,d);r.fillStyle=V,a.nodeShapes[a.getNodeShape(t)].draw(r,o,l,v,g,b,y),r.translate(P,L),r.fill(),r.translate(-P,-L)}r.globalAlpha=G,F&&a.setImgSmoothing(r,O)}};var nu={};nu.eleTextBiggerThanMin=function(r,e){if(!e){var t=r.cy().zoom(),n=this.getPixelRatio(),i=Math.ceil(BS(t*n));e=Math.pow(2,i)}var a=r.pstyle("font-size").pfValue*e,s=r.pstyle("min-zoomed-font-size").pfValue;return!(a<s)};nu.drawElementText=function(r,e,t,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this;if(n==null){if(a&&!s.eleTextBiggerThanMin(e))return}else if(n===!1)return;if(e.isNode()){var o=e.pstyle("label");if(!o||!o.value)return;var l=s.getLabelJustification(e);r.textAlign=l,r.textBaseline="bottom"}else{var u=e.element()._private.rscratch.badLine,c=e.pstyle("label"),h=e.pstyle("source-label"),d=e.pstyle("target-label");if(u||(!c||!c.value)&&(!h||!h.value)&&(!d||!d.value))return;r.textAlign="center",r.textBaseline="bottom"}var f=!t,p;t&&(p=t,r.translate(-p.x1,-p.y1)),i==null?(s.drawText(r,e,null,f,a),e.isEdge()&&(s.drawText(r,e,"source",f,a),s.drawText(r,e,"target",f,a))):s.drawText(r,e,i,f,a),t&&r.translate(p.x1,p.y1)};nu.getFontCache=function(r){var e;this.fontCaches=this.fontCaches||[];for(var t=0;t<this.fontCaches.length;t++)if(e=this.fontCaches[t],e.context===r)return e;return e={context:r},this.fontCaches.push(e),e};nu.setupTextStyle=function(r,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,n=e.pstyle("font-style").strValue,i=e.pstyle("font-size").pfValue+"px",a=e.pstyle("font-family").strValue,s=e.pstyle("font-weight").strValue,o=t?e.effectiveOpacity()*e.pstyle("text-opacity").value:1,l=e.pstyle("text-outline-opacity").value*o,u=e.pstyle("color").value,c=e.pstyle("text-outline-color").value;r.font=n+" "+s+" "+i+" "+a,r.lineJoin="round",this.colorFillStyle(r,u[0],u[1],u[2],o),this.colorStrokeStyle(r,c[0],c[1],c[2],l)};function h0(r,e,t,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:5,s=arguments.length>6?arguments[6]:void 0;r.beginPath(),r.moveTo(e+a,t),r.lineTo(e+n-a,t),r.quadraticCurveTo(e+n,t,e+n,t+a),r.lineTo(e+n,t+i-a),r.quadraticCurveTo(e+n,t+i,e+n-a,t+i),r.lineTo(e+a,t+i),r.quadraticCurveTo(e,t+i,e,t+i-a),r.lineTo(e,t+a),r.quadraticCurveTo(e,t,e+a,t),r.closePath(),s?r.stroke():r.fill()}nu.getTextAngle=function(r,e){var t,n=r._private,i=n.rscratch,a=e?e+"-":"",s=r.pstyle(a+"text-rotation");if(s.strValue==="autorotate"){var o=Qi(i,"labelAngle",e);t=r.isEdge()?o:0}else s.strValue==="none"?t=0:t=s.pfValue;return t};nu.drawText=function(r,e,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=e._private,s=a.rscratch,o=i?e.effectiveOpacity():1;if(!(i&&(o===0||e.pstyle("text-opacity").value===0))){t==="main"&&(t=null);var l=Qi(s,"labelX",t),u=Qi(s,"labelY",t),c,h,d=this.getLabelText(e,t);if(d!=null&&d!==""&&!isNaN(l)&&!isNaN(u)){this.setupTextStyle(r,e,i);var f=t?t+"-":"",p=Qi(s,"labelWidth",t),m=Qi(s,"labelHeight",t),v=e.pstyle(f+"text-margin-x").pfValue,g=e.pstyle(f+"text-margin-y").pfValue,y=e.isEdge(),_=e.pstyle("text-halign").value,x=e.pstyle("text-valign").value;y&&(_="center",x="center"),l+=v,u+=g;var E;switch(n?E=this.getTextAngle(e,t):E=0,E!==0&&(c=l,h=u,r.translate(c,h),r.rotate(E),l=0,u=0),x){case"top":break;case"center":u+=m/2;break;case"bottom":u+=m;break}var T=e.pstyle("text-background-opacity").value,b=e.pstyle("text-border-opacity").value,w=e.pstyle("text-border-width").pfValue,A=e.pstyle("text-background-padding").pfValue,S=e.pstyle("text-background-shape").strValue,C=S.indexOf("round")===0,R=2;if(T>0||w>0&&b>0){var P=l-A;switch(_){case"left":P-=p;break;case"center":P-=p/2;break}var M=u-m-A,N=p+2*A,D=m+2*A;if(T>0){var I=r.fillStyle,L=e.pstyle("text-background-color").value;r.fillStyle="rgba("+L[0]+","+L[1]+","+L[2]+","+T*o+")",C?h0(r,P,M,N,D,R):r.fillRect(P,M,N,D),r.fillStyle=I}if(w>0&&b>0){var z=r.strokeStyle,B=r.lineWidth,k=e.pstyle("text-border-color").value,U=e.pstyle("text-border-style").value;if(r.strokeStyle="rgba("+k[0]+","+k[1]+","+k[2]+","+b*o+")",r.lineWidth=w,r.setLineDash)switch(U){case"dotted":r.setLineDash([1,1]);break;case"dashed":r.setLineDash([4,2]);break;case"double":r.lineWidth=w/4,r.setLineDash([]);break;case"solid":r.setLineDash([]);break}if(C?h0(r,P,M,N,D,R,"stroke"):r.strokeRect(P,M,N,D),U==="double"){var G=w/2;C?h0(r,P+G,M+G,N-G*2,D-G*2,R,"stroke"):r.strokeRect(P+G,M+G,N-G*2,D-G*2)}r.setLineDash&&r.setLineDash([]),r.lineWidth=B,r.strokeStyle=z}}var O=2*e.pstyle("text-outline-width").pfValue;if(O>0&&(r.lineWidth=O),e.pstyle("text-wrap").value==="wrap"){var F=Qi(s,"labelWrapCachedLines",t),V=Qi(s,"labelLineHeight",t),$=p/2,Z=this.getLabelJustification(e);switch(Z==="auto"||(_==="left"?Z==="left"?l+=-p:Z==="center"&&(l+=-$):_==="center"?Z==="left"?l+=-$:Z==="right"&&(l+=$):_==="right"&&(Z==="center"?l+=$:Z==="right"&&(l+=p))),x){case"top":u-=(F.length-1)*V;break;case"center":case"bottom":u-=(F.length-1)*V;break}for(var Y=0;Y<F.length;Y++)O>0&&r.strokeText(F[Y],l,u),r.fillText(F[Y],l,u),u+=V}else O>0&&r.strokeText(d,l,u),r.fillText(d,l,u);E!==0&&(r.rotate(-E),r.translate(-c,-h))}}};var th={};th.drawNode=function(r,e,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,s=this,o,l,u=e._private,c=u.rscratch,h=e.position();if(!(!et(h.x)||!et(h.y))&&!(a&&!e.visible())){var d=a?e.effectiveOpacity():1,f=s.usePaths(),p,m=!1,v=e.padding();o=e.width()+2*v,l=e.height()+2*v;var g;t&&(g=t,r.translate(-g.x1,-g.y1));for(var y=e.pstyle("background-image"),_=y.value,x=new Array(_.length),E=new Array(_.length),T=0,b=0;b<_.length;b++){var w=_[b],A=x[b]=w!=null&&w!=="none";if(A){var S=e.cy().style().getIndexedStyle(e,"background-image-crossorigin","value",b);T++,E[b]=s.getCachedImage(w,S,function(){u.backgroundTimestamp=Date.now(),e.emitAndNotify("background")})}}var C=e.pstyle("background-blacken").value,R=e.pstyle("border-width").pfValue,P=e.pstyle("background-opacity").value*d,M=e.pstyle("border-color").value,N=e.pstyle("border-style").value,D=e.pstyle("border-join").value,I=e.pstyle("border-cap").value,L=e.pstyle("border-position").value,z=e.pstyle("border-dash-pattern").pfValue,B=e.pstyle("border-dash-offset").pfValue,k=e.pstyle("border-opacity").value*d,U=e.pstyle("outline-width").pfValue,G=e.pstyle("outline-color").value,O=e.pstyle("outline-style").value,F=e.pstyle("outline-opacity").value*d,V=e.pstyle("outline-offset").value,$=e.pstyle("corner-radius").value;$!=="auto"&&($=e.pstyle("corner-radius").pfValue);var Z=function(){var ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:P;s.eleFillStyle(r,e,ce)},Y=function(){var ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:k;s.colorStrokeStyle(r,M[0],M[1],M[2],ce)},X=function(){var ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:F;s.colorStrokeStyle(r,G[0],G[1],G[2],ce)},K=function(ce,ae,ie,ee){var he=s.nodePathCache=s.nodePathCache||[],ge=uk(ie==="polygon"?ie+","+ee.join(","):ie,""+ae,""+ce,""+$),Te=he[ge],Se,Oe=!1;return Te!=null?(Se=Te,Oe=!0,c.pathCache=Se):(Se=new Path2D,he[ge]=c.pathCache=Se),{path:Se,cacheHit:Oe}},se=e.pstyle("shape").strValue,oe=e.pstyle("shape-polygon-points").pfValue;if(f){r.translate(h.x,h.y);var W=K(o,l,se,oe);p=W.path,m=W.cacheHit}var Ne=function(){if(!m){var ce=h;f&&(ce={x:0,y:0}),s.nodeShapes[s.getNodeShape(e)].draw(p||r,ce.x,ce.y,o,l,$,c)}f?r.fill(p):r.fill()},Be=function(){for(var ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:d,ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,ie=u.backgrounding,ee=0,he=0;he<E.length;he++){var ge=e.cy().style().getIndexedStyle(e,"background-image-containment","value",he);if(ae&&ge==="over"||!ae&&ge==="inside"){ee++;continue}x[he]&&E[he].complete&&!E[he].error&&(ee++,s.drawInscribedImage(r,E[he],e,he,ce))}u.backgrounding=ee!==T,ie!==u.backgrounding&&e.updateStyle(!1)},we=function(){var ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,ae=arguments.length>1&&arguments[1]!==void 0?arguments[1]:d;s.hasPie(e)&&(s.drawPie(r,e,ae),ce&&(f||s.nodeShapes[s.getNodeShape(e)].draw(r,h.x,h.y,o,l,$,c)))},pe=function(){var ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:d,ae=(C>0?C:-C)*ce,ie=C>0?0:255;C!==0&&(s.colorFillStyle(r,ie,ie,ie,ae),f?r.fill(p):r.fill())},Me=function(){if(R>0){if(r.lineWidth=R,r.lineCap=I,r.lineJoin=D,r.setLineDash)switch(N){case"dotted":r.setLineDash([1,1]);break;case"dashed":r.setLineDash(z),r.lineDashOffset=B;break;case"solid":case"double":r.setLineDash([]);break}if(L!=="center"){if(r.save(),r.lineWidth*=2,L==="inside")f?r.clip(p):r.clip();else{var ce=new Path2D;ce.rect(-o/2-R,-l/2-R,o+2*R,l+2*R),ce.addPath(p),r.clip(ce,"evenodd")}f?r.stroke(p):r.stroke(),r.restore()}else f?r.stroke(p):r.stroke();if(N==="double"){r.lineWidth=R/3;var ae=r.globalCompositeOperation;r.globalCompositeOperation="destination-out",f?r.stroke(p):r.stroke(),r.globalCompositeOperation=ae}r.setLineDash&&r.setLineDash([])}},Ae=function(){if(U>0){if(r.lineWidth=U,r.lineCap="butt",r.setLineDash)switch(O){case"dotted":r.setLineDash([1,1]);break;case"dashed":r.setLineDash([4,2]);break;case"solid":case"double":r.setLineDash([]);break}var ce=h;f&&(ce={x:0,y:0});var ae=s.getNodeShape(e),ie=R;L==="inside"&&(ie=0),L==="outside"&&(ie*=2);var ee=(o+ie+(U+V))/o,he=(l+ie+(U+V))/l,ge=o*ee,Te=l*he,Se=s.nodeShapes[ae].points,Oe;if(f){var J=K(ge,Te,ae,Se);Oe=J.path}if(ae==="ellipse")s.drawEllipsePath(Oe||r,ce.x,ce.y,ge,Te);else if(["round-diamond","round-heptagon","round-hexagon","round-octagon","round-pentagon","round-polygon","round-triangle","round-tag"].includes(ae)){var ve=0,ue=0,_e=0;ae==="round-diamond"?ve=(ie+V+U)*1.4:ae==="round-heptagon"?(ve=(ie+V+U)*1.075,_e=-(ie/2+V+U)/35):ae==="round-hexagon"?ve=(ie+V+U)*1.12:ae==="round-pentagon"?(ve=(ie+V+U)*1.13,_e=-(ie/2+V+U)/15):ae==="round-tag"?(ve=(ie+V+U)*1.12,ue=(ie/2+U+V)*.07):ae==="round-triangle"&&(ve=(ie+V+U)*(Math.PI/2),_e=-(ie+V/2+U)/Math.PI),ve!==0&&(ee=(o+ve)/o,ge=o*ee,["round-hexagon","round-tag"].includes(ae)||(he=(l+ve)/l,Te=l*he)),$=$==="auto"?xk(ge,Te):$;for(var ke=ge/2,Ie=Te/2,je=$+(ie+U+V)/2,$e=new Array(Se.length/2),Xe=new Array(Se.length/2),Je=0;Je<Se.length/2;Je++)$e[Je]={x:ce.x+ue+ke*Se[Je*2],y:ce.y+_e+Ie*Se[Je*2+1]};var nt,at,Xt,gt,vt=$e.length;for(at=$e[vt-1],nt=0;nt<vt;nt++)Xt=$e[nt%vt],gt=$e[(nt+1)%vt],Xe[nt]=KS(at,Xt,gt,je),at=Xt,Xt=gt;s.drawRoundPolygonPath(Oe||r,ce.x+ue,ce.y+_e,o*ee,l*he,Se,Xe)}else if(["roundrectangle","round-rectangle"].includes(ae))$=$==="auto"?Hl(ge,Te):$,s.drawRoundRectanglePath(Oe||r,ce.x,ce.y,ge,Te,$+(ie+U+V)/2);else if(["cutrectangle","cut-rectangle"].includes(ae))$=$==="auto"?kS():$,s.drawCutRectanglePath(Oe||r,ce.x,ce.y,ge,Te,null,$+(ie+U+V)/4);else if(["bottomroundrectangle","bottom-round-rectangle"].includes(ae))$=$==="auto"?Hl(ge,Te):$,s.drawBottomRoundRectanglePath(Oe||r,ce.x,ce.y,ge,Te,$+(ie+U+V)/2);else if(ae==="barrel")s.drawBarrelPath(Oe||r,ce.x,ce.y,ge,Te);else if(ae.startsWith("polygon")||["rhomboid","right-rhomboid","round-tag","tag","vee"].includes(ae)){var pn=(ie+U+V)/o;Se=Gg(zg(Se,pn)),s.drawPolygonPath(Oe||r,ce.x,ce.y,o,l,Se)}else{var Ft=(ie+U+V)/o;Se=Gg(zg(Se,-Ft)),s.drawPolygonPath(Oe||r,ce.x,ce.y,o,l,Se)}if(f?r.stroke(Oe):r.stroke(),O==="double"){r.lineWidth=ie/3;var Gt=r.globalCompositeOperation;r.globalCompositeOperation="destination-out",f?r.stroke(Oe):r.stroke(),r.globalCompositeOperation=Gt}r.setLineDash&&r.setLineDash([])}},j=function(){i&&s.drawNodeOverlay(r,e,h,o,l)},H=function(){i&&s.drawNodeUnderlay(r,e,h,o,l)},te=function(){s.drawElementText(r,e,null,n)},me=e.pstyle("ghost").value==="yes";if(me){var Ee=e.pstyle("ghost-offset-x").pfValue,le=e.pstyle("ghost-offset-y").pfValue,q=e.pstyle("ghost-opacity").value,ne=q*d;r.translate(Ee,le),X(),Ae(),Z(q*P),Ne(),Be(ne,!0),Y(q*k),Me(),we(C!==0||R!==0),Be(ne,!1),pe(ne),r.translate(-Ee,-le)}f&&r.translate(-h.x,-h.y),H(),f&&r.translate(h.x,h.y),X(),Ae(),Z(),Ne(),Be(d,!0),Y(),Me(),we(C!==0||R!==0),Be(d,!1),pe(),f&&r.translate(-h.x,-h.y),te(),j(),t&&r.translate(g.x1,g.y1)}};var S3=function(e){if(!["overlay","underlay"].includes(e))throw new Error("Invalid state");return function(t,n,i,a,s){var o=this;if(!!n.visible()){var l=n.pstyle("".concat(e,"-padding")).pfValue,u=n.pstyle("".concat(e,"-opacity")).value,c=n.pstyle("".concat(e,"-color")).value,h=n.pstyle("".concat(e,"-shape")).value,d=n.pstyle("".concat(e,"-corner-radius")).value;if(u>0){if(i=i||n.position(),a==null||s==null){var f=n.padding();a=n.width()+2*f,s=n.height()+2*f}o.colorFillStyle(t,c[0],c[1],c[2],u),o.nodeShapes[h].draw(t,i.x,i.y,a+l*2,s+l*2,d),t.fill()}}}};th.drawNodeOverlay=S3("overlay");th.drawNodeUnderlay=S3("underlay");th.hasPie=function(r){return r=r[0],r._private.hasPie};th.drawPie=function(r,e,t,n){e=e[0],n=n||e.position();var i=e.cy().style(),a=e.pstyle("pie-size"),s=n.x,o=n.y,l=e.width(),u=e.height(),c=Math.min(l,u)/2,h=0,d=this.usePaths();d&&(s=0,o=0),a.units==="%"?c=c*a.pfValue:a.pfValue!==void 0&&(c=a.pfValue/2);for(var f=1;f<=i.pieBackgroundN;f++){var p=e.pstyle("pie-"+f+"-background-size").value,m=e.pstyle("pie-"+f+"-background-color").value,v=e.pstyle("pie-"+f+"-background-opacity").value*t,g=p/100;g+h>1&&(g=1-h);var y=1.5*Math.PI+2*Math.PI*h,_=2*Math.PI*g,x=y+_;p===0||h>=1||h+g>1||(r.beginPath(),r.moveTo(s,o),r.arc(s,o,c,y,x),r.closePath(),this.colorFillStyle(r,m[0],m[1],m[2],v),r.fill(),h+=g)}};var ti={},nY=100;ti.getPixelRatio=function(){var r=this.data.contexts[0];if(this.forcedPixelRatio!=null)return this.forcedPixelRatio;var e=this.cy.window(),t=r.backingStorePixelRatio||r.webkitBackingStorePixelRatio||r.mozBackingStorePixelRatio||r.msBackingStorePixelRatio||r.oBackingStorePixelRatio||r.backingStorePixelRatio||1;return(e.devicePixelRatio||1)/t};ti.paintCache=function(r){for(var e=this.paintCaches=this.paintCaches||[],t=!0,n,i=0;i<e.length;i++)if(n=e[i],n.context===r){t=!1;break}return t&&(n={context:r},e.push(n)),n};ti.createGradientStyleFor=function(r,e,t,n,i){var a,s=this.usePaths(),o=t.pstyle(e+"-gradient-stop-colors").value,l=t.pstyle(e+"-gradient-stop-positions").pfValue;if(n==="radial-gradient")if(t.isEdge()){var u=t.sourceEndpoint(),c=t.targetEndpoint(),h=t.midpoint(),d=Vl(u,h),f=Vl(c,h);a=r.createRadialGradient(h.x,h.y,0,h.x,h.y,Math.max(d,f))}else{var p=s?{x:0,y:0}:t.position(),m=t.paddedWidth(),v=t.paddedHeight();a=r.createRadialGradient(p.x,p.y,0,p.x,p.y,Math.max(m,v))}else if(t.isEdge()){var g=t.sourceEndpoint(),y=t.targetEndpoint();a=r.createLinearGradient(g.x,g.y,y.x,y.y)}else{var _=s?{x:0,y:0}:t.position(),x=t.paddedWidth(),E=t.paddedHeight(),T=x/2,b=E/2,w=t.pstyle("background-gradient-direction").value;switch(w){case"to-bottom":a=r.createLinearGradient(_.x,_.y-b,_.x,_.y+b);break;case"to-top":a=r.createLinearGradient(_.x,_.y+b,_.x,_.y-b);break;case"to-left":a=r.createLinearGradient(_.x+T,_.y,_.x-T,_.y);break;case"to-right":a=r.createLinearGradient(_.x-T,_.y,_.x+T,_.y);break;case"to-bottom-right":case"to-right-bottom":a=r.createLinearGradient(_.x-T,_.y-b,_.x+T,_.y+b);break;case"to-top-right":case"to-right-top":a=r.createLinearGradient(_.x-T,_.y+b,_.x+T,_.y-b);break;case"to-bottom-left":case"to-left-bottom":a=r.createLinearGradient(_.x+T,_.y-b,_.x-T,_.y+b);break;case"to-top-left":case"to-left-top":a=r.createLinearGradient(_.x+T,_.y+b,_.x-T,_.y-b);break}}if(!a)return null;for(var A=l.length===o.length,S=o.length,C=0;C<S;C++)a.addColorStop(A?l[C]:C/(S-1),"rgba("+o[C][0]+","+o[C][1]+","+o[C][2]+","+i+")");return a};ti.gradientFillStyle=function(r,e,t,n){var i=this.createGradientStyleFor(r,"background",e,t,n);if(!i)return null;r.fillStyle=i};ti.colorFillStyle=function(r,e,t,n,i){r.fillStyle="rgba("+e+","+t+","+n+","+i+")"};ti.eleFillStyle=function(r,e,t){var n=e.pstyle("background-fill").value;if(n==="linear-gradient"||n==="radial-gradient")this.gradientFillStyle(r,e,n,t);else{var i=e.pstyle("background-color").value;this.colorFillStyle(r,i[0],i[1],i[2],t)}};ti.gradientStrokeStyle=function(r,e,t,n){var i=this.createGradientStyleFor(r,"line",e,t,n);if(!i)return null;r.strokeStyle=i};ti.colorStrokeStyle=function(r,e,t,n,i){r.strokeStyle="rgba("+e+","+t+","+n+","+i+")"};ti.eleStrokeStyle=function(r,e,t){var n=e.pstyle("line-fill").value;if(n==="linear-gradient"||n==="radial-gradient")this.gradientStrokeStyle(r,e,n,t);else{var i=e.pstyle("line-color").value;this.colorStrokeStyle(r,i[0],i[1],i[2],t)}};ti.matchCanvasSize=function(r){var e=this,t=e.data,n=e.findContainerClientCoords(),i=n[2],a=n[3],s=e.getPixelRatio(),o=e.motionBlurPxRatio;(r===e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_NODE]||r===e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_DRAG])&&(s=o);var l=i*s,u=a*s,c;if(!(l===e.canvasWidth&&u===e.canvasHeight)){e.fontCaches=null;var h=t.canvasContainer;h.style.width=i+"px",h.style.height=a+"px";for(var d=0;d<e.CANVAS_LAYERS;d++)c=t.canvases[d],c.width=l,c.height=u,c.style.width=i+"px",c.style.height=a+"px";for(var d=0;d<e.BUFFER_COUNT;d++)c=t.bufferCanvases[d],c.width=l,c.height=u,c.style.width=i+"px",c.style.height=a+"px";e.textureMult=1,s<=1&&(c=t.bufferCanvases[e.TEXTURE_BUFFER],e.textureMult=2,c.width=l*e.textureMult,c.height=u*e.textureMult),e.canvasWidth=l,e.canvasHeight=u,e.pixelRatio=s}};ti.renderTo=function(r,e,t,n){this.render({forcedContext:r,forcedZoom:e,forcedPan:t,drawAllLayers:!0,forcedPxRatio:n})};ti.clearCanvas=function(){var r=this,e=r.data;function t(n){n.clearRect(0,0,r.canvasWidth,r.canvasHeight)}t(e.contexts[r.NODE]),t(e.contexts[r.DRAG])};ti.render=function(r){var e=this;r=r||dk();var t=e.cy,n=r.forcedContext,i=r.drawAllLayers,a=r.drawOnlyNodeLayer,s=r.forcedZoom,o=r.forcedPan,l=r.forcedPxRatio===void 0?this.getPixelRatio():r.forcedPxRatio,u=e.data,c=u.canvasNeedsRedraw,h=e.textureOnViewport&&!n&&(e.pinching||e.hoverData.dragging||e.swipePanning||e.data.wheelZooming),d=r.motionBlur!==void 0?r.motionBlur:e.motionBlur,f=e.motionBlurPxRatio,p=t.hasCompoundNodes(),m=e.hoverData.draggingEles,v=!!(e.hoverData.selecting||e.touchData.selecting);d=d&&!n&&e.motionBlurEnabled&&!v;var g=d;n||(e.prevPxRatio!==l&&(e.invalidateContainerClientCoordsCache(),e.matchCanvasSize(e.container),e.redrawHint("eles",!0),e.redrawHint("drag",!0)),e.prevPxRatio=l),!n&&e.motionBlurTimeout&&clearTimeout(e.motionBlurTimeout),d&&(e.mbFrames==null&&(e.mbFrames=0),e.mbFrames++,e.mbFrames<3&&(g=!1),e.mbFrames>e.minMbLowQualFrames&&(e.motionBlurPxRatio=e.mbPxRBlurry)),e.clearingMotionBlur&&(e.motionBlurPxRatio=1),e.textureDrawLastFrame&&!h&&(c[e.NODE]=!0,c[e.SELECT_BOX]=!0);var y=t.style(),_=t.zoom(),x=s!==void 0?s:_,E=t.pan(),T={x:E.x,y:E.y},b={zoom:_,pan:{x:E.x,y:E.y}},w=e.prevViewport,A=w===void 0||b.zoom!==w.zoom||b.pan.x!==w.pan.x||b.pan.y!==w.pan.y;!A&&!(m&&!p)&&(e.motionBlurPxRatio=1),o&&(T=o),x*=l,T.x*=l,T.y*=l;var S=e.getCachedZSortedEles();function C(Y,X,K,se,oe){var W=Y.globalCompositeOperation;Y.globalCompositeOperation="destination-out",e.colorFillStyle(Y,255,255,255,e.motionBlurTransparency),Y.fillRect(X,K,se,oe),Y.globalCompositeOperation=W}function R(Y,X){var K,se,oe,W;!e.clearingMotionBlur&&(Y===u.bufferContexts[e.MOTIONBLUR_BUFFER_NODE]||Y===u.bufferContexts[e.MOTIONBLUR_BUFFER_DRAG])?(K={x:E.x*f,y:E.y*f},se=_*f,oe=e.canvasWidth*f,W=e.canvasHeight*f):(K=T,se=x,oe=e.canvasWidth,W=e.canvasHeight),Y.setTransform(1,0,0,1,0,0),X==="motionBlur"?C(Y,0,0,oe,W):!n&&(X===void 0||X)&&Y.clearRect(0,0,oe,W),i||(Y.translate(K.x,K.y),Y.scale(se,se)),o&&Y.translate(o.x,o.y),s&&Y.scale(s,s)}if(h||(e.textureDrawLastFrame=!1),h){if(e.textureDrawLastFrame=!0,!e.textureCache){e.textureCache={},e.textureCache.bb=t.mutableElements().boundingBox(),e.textureCache.texture=e.data.bufferCanvases[e.TEXTURE_BUFFER];var P=e.data.bufferContexts[e.TEXTURE_BUFFER];P.setTransform(1,0,0,1,0,0),P.clearRect(0,0,e.canvasWidth*e.textureMult,e.canvasHeight*e.textureMult),e.render({forcedContext:P,drawOnlyNodeLayer:!0,forcedPxRatio:l*e.textureMult});var b=e.textureCache.viewport={zoom:t.zoom(),pan:t.pan(),width:e.canvasWidth,height:e.canvasHeight};b.mpan={x:(0-b.pan.x)/b.zoom,y:(0-b.pan.y)/b.zoom}}c[e.DRAG]=!1,c[e.NODE]=!1;var M=u.contexts[e.NODE],N=e.textureCache.texture,b=e.textureCache.viewport;M.setTransform(1,0,0,1,0,0),d?C(M,0,0,b.width,b.height):M.clearRect(0,0,b.width,b.height);var D=y.core("outside-texture-bg-color").value,I=y.core("outside-texture-bg-opacity").value;e.colorFillStyle(M,D[0],D[1],D[2],I),M.fillRect(0,0,b.width,b.height);var _=t.zoom();R(M,!1),M.clearRect(b.mpan.x,b.mpan.y,b.width/b.zoom/l,b.height/b.zoom/l),M.drawImage(N,b.mpan.x,b.mpan.y,b.width/b.zoom/l,b.height/b.zoom/l)}else e.textureOnViewport&&!n&&(e.textureCache=null);var L=t.extent(),z=e.pinching||e.hoverData.dragging||e.swipePanning||e.data.wheelZooming||e.hoverData.draggingEles||e.cy.animated(),B=e.hideEdgesOnViewport&&z,k=[];if(k[e.NODE]=!c[e.NODE]&&d&&!e.clearedForMotionBlur[e.NODE]||e.clearingMotionBlur,k[e.NODE]&&(e.clearedForMotionBlur[e.NODE]=!0),k[e.DRAG]=!c[e.DRAG]&&d&&!e.clearedForMotionBlur[e.DRAG]||e.clearingMotionBlur,k[e.DRAG]&&(e.clearedForMotionBlur[e.DRAG]=!0),c[e.NODE]||i||a||k[e.NODE]){var U=d&&!k[e.NODE]&&f!==1,M=n||(U?e.data.bufferContexts[e.MOTIONBLUR_BUFFER_NODE]:u.contexts[e.NODE]),G=d&&!U?"motionBlur":void 0;R(M,G),B?e.drawCachedNodes(M,S.nondrag,l,L):e.drawLayeredElements(M,S.nondrag,l,L),e.debug&&e.drawDebugPoints(M,S.nondrag),!i&&!d&&(c[e.NODE]=!1)}if(!a&&(c[e.DRAG]||i||k[e.DRAG])){var U=d&&!k[e.DRAG]&&f!==1,M=n||(U?e.data.bufferContexts[e.MOTIONBLUR_BUFFER_DRAG]:u.contexts[e.DRAG]);R(M,d&&!U?"motionBlur":void 0),B?e.drawCachedNodes(M,S.drag,l,L):e.drawCachedElements(M,S.drag,l,L),e.debug&&e.drawDebugPoints(M,S.drag),!i&&!d&&(c[e.DRAG]=!1)}if(this.drawSelectionRectangle(r,R),d&&f!==1){var O=u.contexts[e.NODE],F=e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_NODE],V=u.contexts[e.DRAG],$=e.data.bufferCanvases[e.MOTIONBLUR_BUFFER_DRAG],Z=function(X,K,se){X.setTransform(1,0,0,1,0,0),se||!g?X.clearRect(0,0,e.canvasWidth,e.canvasHeight):C(X,0,0,e.canvasWidth,e.canvasHeight);var oe=f;X.drawImage(K,0,0,e.canvasWidth*oe,e.canvasHeight*oe,0,0,e.canvasWidth,e.canvasHeight)};(c[e.NODE]||k[e.NODE])&&(Z(O,F,k[e.NODE]),c[e.NODE]=!1),(c[e.DRAG]||k[e.DRAG])&&(Z(V,$,k[e.DRAG]),c[e.DRAG]=!1)}e.prevViewport=b,e.clearingMotionBlur&&(e.clearingMotionBlur=!1,e.motionBlurCleared=!0,e.motionBlur=!0),d&&(e.motionBlurTimeout=setTimeout(function(){e.motionBlurTimeout=null,e.clearedForMotionBlur[e.NODE]=!1,e.clearedForMotionBlur[e.DRAG]=!1,e.motionBlur=!1,e.clearingMotionBlur=!h,e.mbFrames=0,c[e.NODE]=!0,c[e.DRAG]=!0,e.redraw()},nY)),n||t.emit("render")};var Th;ti.drawSelectionRectangle=function(r,e){var t=this,n=t.cy,i=t.data,a=n.style(),s=r.drawOnlyNodeLayer,o=r.drawAllLayers,l=i.canvasNeedsRedraw,u=r.forcedContext;if(t.showFps||!s&&l[t.SELECT_BOX]&&!o){var c=u||i.contexts[t.SELECT_BOX];if(e(c),t.selection[4]==1&&(t.hoverData.selecting||t.touchData.selecting)){var h=t.cy.zoom(),d=a.core("selection-box-border-width").value/h;c.lineWidth=d,c.fillStyle="rgba("+a.core("selection-box-color").value[0]+","+a.core("selection-box-color").value[1]+","+a.core("selection-box-color").value[2]+","+a.core("selection-box-opacity").value+")",c.fillRect(t.selection[0],t.selection[1],t.selection[2]-t.selection[0],t.selection[3]-t.selection[1]),d>0&&(c.strokeStyle="rgba("+a.core("selection-box-border-color").value[0]+","+a.core("selection-box-border-color").value[1]+","+a.core("selection-box-border-color").value[2]+","+a.core("selection-box-opacity").value+")",c.strokeRect(t.selection[0],t.selection[1],t.selection[2]-t.selection[0],t.selection[3]-t.selection[1]))}if(i.bgActivePosistion&&!t.hoverData.selecting){var h=t.cy.zoom(),f=i.bgActivePosistion;c.fillStyle="rgba("+a.core("active-bg-color").value[0]+","+a.core("active-bg-color").value[1]+","+a.core("active-bg-color").value[2]+","+a.core("active-bg-opacity").value+")",c.beginPath(),c.arc(f.x,f.y,a.core("active-bg-size").pfValue/h,0,2*Math.PI),c.fill()}var p=t.lastRedrawTime;if(t.showFps&&p){p=Math.round(p);var m=Math.round(1e3/p),v="1 frame = "+p+" ms = "+m+" fps";if(c.setTransform(1,0,0,1,0,0),c.fillStyle="rgba(255, 0, 0, 0.75)",c.strokeStyle="rgba(255, 0, 0, 0.75)",c.font="30px Arial",!Th){var g=c.measureText(v);Th=g.actualBoundingBoxAscent}c.fillText(v,0,Th);var y=60;c.strokeRect(0,Th+10,250,20),c.fillRect(0,Th+10,250*Math.min(m/y,1),20)}o||(l[t.SELECT_BOX]=!1)}};function EN(r,e,t){var n=r.createShader(e);if(r.shaderSource(n,t),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS))throw new Error(r.getShaderInfoLog(n));return n}function rY(r,e,t){var n=EN(r,r.VERTEX_SHADER,e),i=EN(r,r.FRAGMENT_SHADER,t),a=r.createProgram();if(r.attachShader(a,n),r.attachShader(a,i),r.linkProgram(a),!r.getProgramParameter(a,r.LINK_STATUS))throw new Error("Could not initialize shaders");return a}function iY(r,e,t){t===void 0&&(t=e);var n=r.makeOffscreenCanvas(e,t),i=n.context=n.getContext("2d");return n.clear=function(){return i.clearRect(0,0,n.width,n.height)},n.clear(),n}function JS(r){var e=r.pixelRatio,t=r.cy.zoom(),n=r.cy.pan();return{zoom:t*e,pan:{x:n.x*e,y:n.y*e}}}function aY(r,e,t,n,i){var a=n*t+e.x,s=i*t+e.y;return s=Math.round(r.canvasHeight-s),[a,s]}function wh(r,e,t){var n=r[0]/255,i=r[1]/255,a=r[2]/255,s=e,o=t||new Array(4);return o[0]=n*s,o[1]=i*s,o[2]=a*s,o[3]=s,o}function _u(r,e){var t=e||new Array(4);return t[0]=(r>>0&255)/255,t[1]=(r>>8&255)/255,t[2]=(r>>16&255)/255,t[3]=(r>>24&255)/255,t}function sY(r){return r[0]+(r[1]<<8)+(r[2]<<16)+(r[3]<<24)}function oY(r,e){var t=r.createTexture();return t.buffer=function(n){r.bindTexture(r.TEXTURE_2D,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_NEAREST),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n),r.generateMipmap(r.TEXTURE_2D),r.bindTexture(r.TEXTURE_2D,null)},t.deleteTexture=function(){r.deleteTexture(t)},t}function A3(r,e){switch(e){case"float":return[1,r.FLOAT,4];case"vec2":return[2,r.FLOAT,4];case"vec3":return[3,r.FLOAT,4];case"vec4":return[4,r.FLOAT,4];case"int":return[1,r.INT,4];case"ivec2":return[2,r.INT,4]}}function M3(r,e,t){switch(e){case r.FLOAT:return new Float32Array(t);case r.INT:return new Int32Array(t)}}function lY(r,e,t,n,i,a){switch(e){case r.FLOAT:return new Float32Array(t.buffer,a*n,i);case r.INT:return new Int32Array(t.buffer,a*n,i)}}function uY(r,e,t,n){var i=A3(r,e),a=vr(i,2),s=a[0],o=a[1],l=M3(r,o,n),u=r.createBuffer();return r.bindBuffer(r.ARRAY_BUFFER,u),r.bufferData(r.ARRAY_BUFFER,l,r.STATIC_DRAW),o===r.FLOAT?r.vertexAttribPointer(t,s,o,!1,0,0):o===r.INT&&r.vertexAttribIPointer(t,s,o,0,0),r.enableVertexAttribArray(t),r.bindBuffer(r.ARRAY_BUFFER,null),u}function uo(r,e,t,n){var i=A3(r,t),a=vr(i,3),s=a[0],o=a[1],l=a[2],u=M3(r,o,e*s),c=s*l,h=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,h),r.bufferData(r.ARRAY_BUFFER,e*c,r.DYNAMIC_DRAW),r.enableVertexAttribArray(n),o===r.FLOAT?r.vertexAttribPointer(n,s,o,!1,c,0):o===r.INT&&r.vertexAttribIPointer(n,s,o,c,0),r.vertexAttribDivisor(n,1),r.bindBuffer(r.ARRAY_BUFFER,null);for(var d=new Array(e),f=0;f<e;f++)d[f]=lY(r,o,u,c,s,f);return h.dataArray=u,h.stride=c,h.size=s,h.getView=function(p){return d[p]},h.setPoint=function(p,m,v){var g=d[p];g[0]=m,g[1]=v},h.bufferSubData=function(p){r.bindBuffer(r.ARRAY_BUFFER,h),p?r.bufferSubData(r.ARRAY_BUFFER,0,u,0,p*s):r.bufferSubData(r.ARRAY_BUFFER,0,u)},h}function cY(r,e,t){for(var n=9,i=new Float32Array(e*n),a=new Array(e),s=0;s<e;s++){var o=s*n*4;a[s]=new Float32Array(i.buffer,o,n)}var l=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,l),r.bufferData(r.ARRAY_BUFFER,i.byteLength,r.DYNAMIC_DRAW);for(var u=0;u<3;u++){var c=t+u;r.enableVertexAttribArray(c),r.vertexAttribPointer(c,3,r.FLOAT,!1,3*12,u*12),r.vertexAttribDivisor(c,1)}return r.bindBuffer(r.ARRAY_BUFFER,null),l.getMatrixView=function(h){return a[h]},l.setData=function(h,d){a[d].set(h,0)},l.bufferSubData=function(){r.bindBuffer(r.ARRAY_BUFFER,l),r.bufferSubData(r.ARRAY_BUFFER,0,i)},l}function hY(r){var e=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,e);var t=r.createTexture();return r.bindTexture(r.TEXTURE_2D,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),r.bindFramebuffer(r.FRAMEBUFFER,null),e.setFramebufferAttachmentSizes=function(n,i){r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n,i,0,r.RGBA,r.UNSIGNED_BYTE,null)},e}var TN=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function bg(){var r=new TN(9);return TN!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function C3(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function fY(r,e,t){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=t[0],f=t[1],p=t[2],m=t[3],v=t[4],g=t[5],y=t[6],_=t[7],x=t[8];return r[0]=d*n+f*s+p*u,r[1]=d*i+f*o+p*c,r[2]=d*a+f*l+p*h,r[3]=m*n+v*s+g*u,r[4]=m*i+v*o+g*c,r[5]=m*a+v*l+g*h,r[6]=y*n+_*s+x*u,r[7]=y*i+_*o+x*c,r[8]=y*a+_*l+x*h,r}function Yg(r,e,t){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=t[0],f=t[1];return r[0]=n,r[1]=i,r[2]=a,r[3]=s,r[4]=o,r[5]=l,r[6]=d*n+f*s+u,r[7]=d*i+f*o+c,r[8]=d*a+f*l+h,r}function R3(r,e,t){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=Math.sin(t),f=Math.cos(t);return r[0]=f*n+d*s,r[1]=f*i+d*o,r[2]=f*a+d*l,r[3]=f*s-d*n,r[4]=f*o-d*i,r[5]=f*l-d*a,r[6]=u,r[7]=c,r[8]=h,r}function eA(r,e,t){var n=t[0],i=t[1];return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=i*e[3],r[4]=i*e[4],r[5]=i*e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function dY(r,e,t){return r[0]=2/e,r[1]=0,r[2]=0,r[3]=0,r[4]=-2/t,r[5]=0,r[6]=-1,r[7]=1,r[8]=1,r}var ff={SCREEN:{name:"screen",screen:!0},PICKING:{name:"picking",picking:!0}},wN=cr({texRows:24}),xu=cr({collection:"default",getKey:null,drawElement:null,getBoundingBox:null,getRotation:null,getRotationPoint:null,getRotationOffset:null,isVisible:function(){return!0},getPadding:0}),pY=function(){function r(e,t,n,i){jo(this,r),this.debugID=Math.floor(Math.random()*1e4),this.r=e,this.texSize=t,this.texRows=n,this.texHeight=Math.floor(t/n),this.enableWrapping=!0,this.locked=!1,this.texture=null,this.needsBuffer=!0,this.freePointer={x:0,row:0},this.keyToLocation=new Map,this.canvas=i(e,t,t),this.scratch=i(e,t,this.texHeight,"scratch")}return Ko(r,[{key:"lock",value:function(){this.locked=!0}},{key:"getKeys",value:function(){return new Set(this.keyToLocation.keys())}},{key:"getScale",value:function(t){var n=t.w,i=t.h,a=this.texHeight,s=this.texSize,o=a/i,l=n*o,u=i*o;return l>s&&(o=s/n,l=n*o,u=i*o),{scale:o,texW:l,texH:u}}},{key:"draw",value:function(t,n,i){var a=this;if(this.locked)throw new Error("can't draw, atlas is locked");var s=this.texSize,o=this.texRows,l=this.texHeight,u=this.getScale(n),c=u.scale,h=u.texW,d=u.texH,f=[null,null],p=function(_,x){if(i&&x){var E=x.context,T=_.x,b=_.row,w=T,A=l*b;E.save(),E.translate(w,A),E.scale(c,c),i(E,n),E.restore()}},m=function(){p(a.freePointer,a.canvas),f[0]={x:a.freePointer.x,y:a.freePointer.row*l,w:h,h:d},f[1]={x:a.freePointer.x+h,y:a.freePointer.row*l,w:0,h:d},a.freePointer.x+=h,a.freePointer.x==s&&(a.freePointer.x=0,a.freePointer.row++)},v=function(){var _=a.scratch,x=a.canvas;_.clear(),p({x:0,row:0},_);var E=s-a.freePointer.x,T=h-E,b=l;{var w=a.freePointer.x,A=a.freePointer.row*l,S=E;x.context.drawImage(_,0,0,S,b,w,A,S,b),f[0]={x:w,y:A,w:S,h:d}}{var C=E,R=(a.freePointer.row+1)*l,P=T;x&&x.context.drawImage(_,C,0,P,b,0,R,P,b),f[1]={x:0,y:R,w:P,h:d}}a.freePointer.x=T,a.freePointer.row++},g=function(){a.freePointer.x=0,a.freePointer.row++};if(this.freePointer.x+h<=s)m();else{if(this.freePointer.row>=o-1)return!1;this.freePointer.x===s?(g(),m()):this.enableWrapping?v():(g(),m())}return this.keyToLocation.set(t,f),this.needsBuffer=!0,f}},{key:"getOffsets",value:function(t){return this.keyToLocation.get(t)}},{key:"isEmpty",value:function(){return this.freePointer.x===0&&this.freePointer.row===0}},{key:"canFit",value:function(t){if(this.locked)return!1;var n=this.texSize,i=this.texRows,a=this.getScale(t),s=a.texW;return this.freePointer.x+s>n?this.freePointer.row<i-1:!0}},{key:"bufferIfNeeded",value:function(t){this.texture||(this.texture=oY(t,this.debugID)),this.needsBuffer&&(this.texture.buffer(this.canvas),this.needsBuffer=!1,this.locked&&(this.canvas=null,this.scratch=null))}},{key:"dispose",value:function(){this.texture&&(this.texture.deleteTexture(),this.texture=null),this.canvas=null,this.scratch=null,this.locked=!0}}])}(),gY=function(){function r(e,t,n,i){jo(this,r),this.r=e,this.texSize=t,this.texRows=n,this.createTextureCanvas=i,this.atlases=[],this.styleKeyToAtlas=new Map,this.markedKeys=new Set}return Ko(r,[{key:"getKeys",value:function(){return new Set(this.styleKeyToAtlas.keys())}},{key:"_createAtlas",value:function(){var t=this.r,n=this.texSize,i=this.texRows,a=this.createTextureCanvas;return new pY(t,n,i,a)}},{key:"_getScratchCanvas",value:function(){if(!this.scratch){var t=this.r,n=this.texSize,i=this.texRows,a=this.createTextureCanvas,s=Math.floor(n/i);this.scratch=a(t,n,s,"scratch")}return this.scratch}},{key:"draw",value:function(t,n,i){var a=this.styleKeyToAtlas.get(t);return a||(a=this.atlases[this.atlases.length-1],(!a||!a.canFit(n))&&(a&&a.lock(),a=this._createAtlas(),this.atlases.push(a)),a.draw(t,n,i),this.styleKeyToAtlas.set(t,a)),a}},{key:"getAtlas",value:function(t){return this.styleKeyToAtlas.get(t)}},{key:"hasAtlas",value:function(t){return this.styleKeyToAtlas.has(t)}},{key:"markKeyForGC",value:function(t){this.markedKeys.add(t)}},{key:"gc",value:function(){var t=this,n=this.markedKeys;if(n.size===0){console.log("nothing to garbage collect");return}var i=[],a=new Map,s=null,o=Na(this.atlases),l;try{var u=function(){var h=l.value,d=h.getKeys(),f=vY(n,d);if(f.size===0)return i.push(h),d.forEach(function(E){return a.set(E,h)}),1;s||(s=t._createAtlas(),i.push(s));var p=Na(d),m;try{for(p.s();!(m=p.n()).done;){var v=m.value;if(!f.has(v)){var g=h.getOffsets(v),y=vr(g,2),_=y[0],x=y[1];s.canFit({w:_.w+x.w,h:_.h})||(s.lock(),s=t._createAtlas(),i.push(s)),t._copyTextureToNewAtlas(v,h,s),a.set(v,s)}}}catch(E){p.e(E)}finally{p.f()}h.dispose()};for(o.s();!(l=o.n()).done;)u()}catch(c){o.e(c)}finally{o.f()}this.atlases=i,this.styleKeyToAtlas=a,this.markedKeys=new Set}},{key:"_copyTextureToNewAtlas",value:function(t,n,i){var a=n.getOffsets(t),s=vr(a,2),o=s[0],l=s[1];if(l.w===0)i.draw(t,o,function(d){d.drawImage(n.canvas,o.x,o.y,o.w,o.h,0,0,o.w,o.h)});else{var u=this._getScratchCanvas();u.clear(),u.context.drawImage(n.canvas,o.x,o.y,o.w,o.h,0,0,o.w,o.h),u.context.drawImage(n.canvas,l.x,l.y,l.w,l.h,o.w,0,l.w,l.h);var c=o.w+l.w,h=o.h;i.draw(t,{w:c,h},function(d){d.drawImage(u,0,0,c,h,0,0,c,h)})}}},{key:"getCounts",value:function(){return{keyCount:this.styleKeyToAtlas.size,atlasCount:new Set(this.styleKeyToAtlas.values()).size}}}])}();function vY(r,e){return r.intersection?r.intersection(e):new Set(jU(r).filter(function(t){return e.has(t)}))}var mY=function(){function r(e,t){jo(this,r),this.r=e,this.globalOptions=t,this.atlasSize=t.webglTexSize,this.maxAtlasesPerBatch=t.webglTexPerBatch,this.renderTypes=new Map,this.collections=new Map,this.typeAndIdToKey=new Map,this.batchAtlases=[]}return Ko(r,[{key:"getAtlasSize",value:function(){return this.atlasSize}},{key:"getMaxAtlasesPerBatch",value:function(){return this.maxAtlasesPerBatch}},{key:"addAtlasCollection",value:function(t,n){var i=this.globalOptions,a=i.webglTexSize,s=i.createTextureCanvas,o=n.texRows,l=this._cacheScratchCanvas(s),u=new gY(this.r,a,o,l);this.collections.set(t,u)}},{key:"addRenderType",value:function(t,n){var i=n.collection;if(!this.collections.has(i))throw new Error("invalid atlas collection name '".concat(i,"'"));var a=this.collections.get(i),s=mt({type:t,atlasCollection:a},n);this.renderTypes.set(t,s)}},{key:"getRenderTypeOpts",value:function(t){return this.renderTypes.get(t)}},{key:"getAtlasCollection",value:function(t){return this.collections.get(t)}},{key:"_cacheScratchCanvas",value:function(t){var n=-1,i=-1,a=null;return function(s,o,l,u){return u?((!a||o!=n||l!=i)&&(n=o,i=l,a=t(s,o,l)),a):t(s,o,l)}}},{key:"_key",value:function(t,n){return"".concat(t,"-").concat(n)}},{key:"invalidate",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.forceRedraw,a=i===void 0?!1:i,s=n.filterEle,o=s===void 0?function(){return!0}:s,l=n.filterType,u=l===void 0?function(){return!0}:l,c=!1,h=!1,d=Na(t),f;try{for(d.s();!(f=d.n()).done;){var p=f.value;if(o(p)){var m=Na(this.renderTypes.values()),v;try{for(m.s();!(v=m.n()).done;){var g=v.value,y=g.type;if(u(y)){var _=g.getKey(p),x=this.collections.get(g.collection);if(a)x.markKeyForGC(_),h=!0;else{var E=g.getID?g.getID(p):p.id(),T=this._key(y,E),b=this.typeAndIdToKey.get(T);b!==void 0&&b!==_&&(this.typeAndIdToKey.delete(T),x.markKeyForGC(b),c=!0)}}}}catch(w){m.e(w)}finally{m.f()}}}}catch(w){d.e(w)}finally{d.f()}return h&&(this.gc(),c=!1),c}},{key:"gc",value:function(){var t=Na(this.collections.values()),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;i.gc()}}catch(a){t.e(a)}finally{t.f()}}},{key:"getOrCreateAtlas",value:function(t,n,i){var a=this.renderTypes.get(n),s=a.getKey(t);i||(i=a.getBoundingBox(t));var o=this.collections.get(a.collection),l=!1,u=o.draw(s,i,function(d){a.drawElement(d,t,i,!0,!0),l=!0});if(l){var c=a.getID?a.getID(t):t.id(),h=this._key(n,c);this.typeAndIdToKey.set(h,s)}return u}},{key:"startBatch",value:function(){this.batchAtlases=[]}},{key:"getAtlasCount",value:function(){return this.batchAtlases.length}},{key:"getAtlases",value:function(){return this.batchAtlases}},{key:"canAddToCurrentBatch",value:function(t,n){if(this.batchAtlases.length===this.maxAtlasesPerBatch){var i=this.renderTypes.get(n),a=i.getKey(t),s=this.collections.get(i.collection),o=s.getAtlas(a);return Boolean(o)&&this.batchAtlases.includes(o)}return!0}},{key:"getAtlasIndexForBatch",value:function(t){var n=this.batchAtlases.indexOf(t);if(n<0){if(this.batchAtlases.length===this.maxAtlasesPerBatch)return;this.batchAtlases.push(t),n=this.batchAtlases.length-1}return n}},{key:"getIndexArray",value:function(){return Array.from({length:this.maxAtlasesPerBatch},function(t,n){return n})}},{key:"getAtlasInfo",value:function(t,n){var i=this.renderTypes.get(n),a=i.getBoundingBox(t),s=this.getOrCreateAtlas(t,n,a),o=this.getAtlasIndexForBatch(s);if(o!==void 0){var l=i.getKey(t),u=s.getOffsets(l),c=vr(u,2),h=c[0],d=c[1];return{index:o,tex1:h,tex2:d,bb:a}}}},{key:"setTransformMatrix",value:function(t,n,i,a){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,o=this.getRenderTypeOpts(i),l=o.getPadding?o.getPadding(t):0;if(a){var u=a.bb,c=a.tex1,h=a.tex2,d=c.w/(c.w+h.w);s||(d=1-d);var f=this.getAdjustedBB(u,l,s,d);this._applyTransformMatrix(n,f,o,t)}else{var p=o.getBoundingBox(t),m=this.getAdjustedBB(p,l,!0,1);this._applyTransformMatrix(n,m,o,t)}}},{key:"_applyTransformMatrix",value:function(t,n,i,a){var s,o;C3(t);var l=i.getRotation?i.getRotation(a):0;if(l!==0){var u=i.getRotationPoint(a),c=u.x,h=u.y;Yg(t,t,[c,h]),R3(t,t,l);var d=i.getRotationOffset(a);s=d.x+n.xOffset,o=d.y}else s=n.x1,o=n.y1;Yg(t,t,[s,o]),eA(t,t,[n.w,n.h])}},{key:"getAdjustedBB",value:function(t,n,i,a){var s=t.x1,o=t.y1,l=t.w,u=t.h;n&&(s-=n,o-=n,l+=2*n,u+=2*n);var c=0,h=l*a;return i&&a<1?l=h:!i&&a<1&&(c=l-h,s+=c,l=h),{x1:s,y1:o,w:l,h:u,xOffset:c}}},{key:"getDebugInfo",value:function(){var t=[],n=Na(this.collections),i;try{for(n.s();!(i=n.n()).done;){var a=vr(i.value,2),s=a[0],o=a[1],l=o.getCounts(),u=l.keyCount,c=l.atlasCount;t.push({type:s,keyCount:u,atlasCount:c})}}catch(h){n.e(h)}finally{n.f()}return t}}])}(),sp=0,SN=1,AN=2,f0=3,MN=4,yY=function(){function r(e,t,n){jo(this,r),this.r=e,this.gl=t,this.maxInstances=n.webglBatchSize,this.atlasSize=n.webglTexSize,this.bgColor=n.bgColor,this.debug=n.webglDebug,this.batchDebugInfo=[],n.enableWrapping=!0,n.createTextureCanvas=iY,this.atlasManager=new mY(e,n),this.program=this.createShaderProgram(ff.SCREEN),this.pickingProgram=this.createShaderProgram(ff.PICKING),this.vao=this.createVAO()}return Ko(r,[{key:"addAtlasCollection",value:function(t,n){this.atlasManager.addAtlasCollection(t,n)}},{key:"addAtlasRenderType",value:function(t,n){this.atlasManager.addRenderType(t,n)}},{key:"invalidate",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.type,a=this.atlasManager;return i?a.invalidate(t,{filterType:function(o){return o===i},forceRedraw:!0}):a.invalidate(t)}},{key:"gc",value:function(){this.atlasManager.gc()}},{key:"createShaderProgram",value:function(t){var n=this.gl,i=`#version 300 es
      precision highp float;

      uniform mat3 uPanZoomMatrix;
      uniform int  uAtlasSize;
      
      // instanced
      in vec2 aPosition; 

      in mat3 aTransform;

      // what are we rendering?
      in int aVertType;

      // for picking
      in vec4 aIndex;
      
      // For textures
      in int aAtlasId; // which shader unit/atlas to use
      in vec4 aTex; // x/y/w/h of texture in atlas

      // for edges
      in vec4 aPointAPointB;
      in vec4 aPointCPointD;
      in float aLineWidth;
      in vec4 aColor;

      out vec2 vTexCoord;
      out vec4 vColor;
      flat out int vAtlasId;
      flat out vec4 vIndex;
      flat out int vVertType;

      void main(void) {
        int vid = gl_VertexID;
        vec2 position = aPosition;

        if(aVertType == `.concat(sp,`) {
          float texX = aTex.x;
          float texY = aTex.y;
          float texW = aTex.z;
          float texH = aTex.w;

          int vid = gl_VertexID;

          if(vid == 1 || vid == 2 || vid == 4) {
            texX += texW;
          }
          if(vid == 2 || vid == 4 || vid == 5) {
            texY += texH;
          }

          float d = float(uAtlasSize);
          vTexCoord = vec2(texX / d, texY / d); // tex coords must be between 0 and 1

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
        }
        else if(aVertType == `).concat(MN,`) {
          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
          vColor = aColor;
        }
        else if(aVertType == `).concat(SN,`) {
          vec2 source = aPointAPointB.xy;
          vec2 target = aPointAPointB.zw;

          // adjust the geometry so that the line is centered on the edge
          position.y = position.y - 0.5;

          vec2 xBasis = target - source;
          vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));
          vec2 point = source + xBasis * position.x + yBasis * aLineWidth * position.y;

          gl_Position = vec4(uPanZoomMatrix * vec3(point, 1.0), 1.0);
          vColor = aColor;
        } 
        else if(aVertType == `).concat(AN,`) {
          vec2 pointA = aPointAPointB.xy;
          vec2 pointB = aPointAPointB.zw;
          vec2 pointC = aPointCPointD.xy;
          vec2 pointD = aPointCPointD.zw;

          // adjust the geometry so that the line is centered on the edge
          position.y = position.y - 0.5;

          vec2 p0 = pointA;
          vec2 p1 = pointB;
          vec2 p2 = pointC;
          vec2 pos = position;
          if(position.x == 1.0) {
            p0 = pointD;
            p1 = pointC;
            p2 = pointB;
            pos = vec2(0.0, -position.y);
          }

          vec2 p01 = p1 - p0;
          vec2 p12 = p2 - p1;
          vec2 p21 = p1 - p2;

          // Find the normal vector.
          vec2 tangent = normalize(normalize(p12) + normalize(p01));
          vec2 normal = vec2(-tangent.y, tangent.x);

          // Find the vector perpendicular to p0 -> p1.
          vec2 p01Norm = normalize(vec2(-p01.y, p01.x));

          // Determine the bend direction.
          float sigma = sign(dot(p01 + p21, normal));
          float width = aLineWidth;

          if(sign(pos.y) == -sigma) {
            // This is an intersecting vertex. Adjust the position so that there's no overlap.
            vec2 point = 0.5 * width * normal * -sigma / dot(normal, p01Norm);
            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);
          } else {
            // This is a non-intersecting vertex. Treat it like a mitre join.
            vec2 point = 0.5 * width * normal * sigma * dot(normal, p01Norm);
            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);
          }

          vColor = aColor;
        } 
        else if(aVertType == `).concat(f0,` && vid < 3) {
          // massage the first triangle into an edge arrow
          if(vid == 0)
            position = vec2(-0.15, -0.3);
          if(vid == 1)
            position = vec2( 0.0,   0.0);
          if(vid == 2)
            position = vec2( 0.15, -0.3);

          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);
          vColor = aColor;
        }
        else {
          gl_Position = vec4(2.0, 0.0, 0.0, 1.0); // discard vertex by putting it outside webgl clip space
        }

        vAtlasId = aAtlasId;
        vIndex = aIndex;
        vVertType = aVertType;
      }
    `),a=this.atlasManager.getIndexArray(),s=`#version 300 es
      precision highp float;

      // define texture unit for each node in the batch
      `.concat(a.map(function(u){return"uniform sampler2D uTexture".concat(u,";")}).join(`
	`),`

      uniform vec4 uBGColor;

      in vec2 vTexCoord;
      in vec4 vColor;
      flat in int vAtlasId;
      flat in vec4 vIndex;
      flat in int vVertType;

      out vec4 outColor;

      void main(void) {
        if(vVertType == `).concat(sp,`) {
          `).concat(a.map(function(u){return"if(vAtlasId == ".concat(u,") outColor = texture(uTexture").concat(u,", vTexCoord);")}).join(`
	else `),`
        } else if(vVertType == `).concat(f0,`) {
          // blend arrow color with background (using premultiplied alpha)
          outColor.rgb = vColor.rgb + (uBGColor.rgb * (1.0 - vColor.a)); 
          outColor.a = 1.0; // make opaque, masks out line under arrow
        } else {
          outColor = vColor;
        }

        `).concat(t.picking?`if(outColor.a == 0.0) discard;
             else outColor = vIndex;`:"",`
      }
    `),o=rY(n,i,s);o.aPosition=n.getAttribLocation(o,"aPosition"),o.aIndex=n.getAttribLocation(o,"aIndex"),o.aVertType=n.getAttribLocation(o,"aVertType"),o.aTransform=n.getAttribLocation(o,"aTransform"),o.aAtlasId=n.getAttribLocation(o,"aAtlasId"),o.aTex=n.getAttribLocation(o,"aTex"),o.aPointAPointB=n.getAttribLocation(o,"aPointAPointB"),o.aPointCPointD=n.getAttribLocation(o,"aPointCPointD"),o.aLineWidth=n.getAttribLocation(o,"aLineWidth"),o.aColor=n.getAttribLocation(o,"aColor"),o.uPanZoomMatrix=n.getUniformLocation(o,"uPanZoomMatrix"),o.uAtlasSize=n.getUniformLocation(o,"uAtlasSize"),o.uBGColor=n.getUniformLocation(o,"uBGColor"),o.uTextures=[];for(var l=0;l<this.atlasManager.getMaxAtlasesPerBatch();l++)o.uTextures.push(n.getUniformLocation(o,"uTexture".concat(l)));return o}},{key:"createVAO",value:function(){var t=[0,0,1,0,1,1,0,0,1,1,0,1];this.vertexCount=t.length/2;var n=this.maxInstances,i=this.gl,a=this.program,s=i.createVertexArray();return i.bindVertexArray(s),uY(i,"vec2",a.aPosition,t),this.transformBuffer=cY(i,n,a.aTransform),this.indexBuffer=uo(i,n,"vec4",a.aIndex),this.vertTypeBuffer=uo(i,n,"int",a.aVertType),this.atlasIdBuffer=uo(i,n,"int",a.aAtlasId),this.texBuffer=uo(i,n,"vec4",a.aTex),this.pointAPointBBuffer=uo(i,n,"vec4",a.aPointAPointB),this.pointCPointDBuffer=uo(i,n,"vec4",a.aPointCPointD),this.lineWidthBuffer=uo(i,n,"float",a.aLineWidth),this.colorBuffer=uo(i,n,"vec4",a.aColor),i.bindVertexArray(null),s}},{key:"buffers",get:function(){var t=this;return this._buffers||(this._buffers=Object.keys(this).filter(function(n){return n.endsWith("Buffer")}).map(function(n){return t[n]})),this._buffers}},{key:"startFrame",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ff.SCREEN;this.panZoomMatrix=t,this.renderTarget=n,this.batchDebugInfo=[],this.wrappedCount=0,this.rectangleCount=0,this.startBatch()}},{key:"startBatch",value:function(){this.instanceCount=0,this.atlasManager.startBatch()}},{key:"endFrame",value:function(){this.endBatch()}},{key:"getTempMatrix",value:function(){return this.tempMatrix=this.tempMatrix||bg()}},{key:"drawTexture",value:function(t,n,i){var a=this.atlasManager;if(!!t.visible()&&!!a.getRenderTypeOpts(i).isVisible(t)){a.canAddToCurrentBatch(t,i)||this.endBatch(),this.instanceCount+1>=this.maxInstances&&this.endBatch();var s=this.instanceCount;this.vertTypeBuffer.getView(s)[0]=sp;var o=this.indexBuffer.getView(s);_u(n,o);var l=a.getAtlasInfo(t,i),u=l.index,c=l.tex1,h=l.tex2;h.w>0&&this.wrappedCount++;for(var d=!0,f=0,p=[c,h];f<p.length;f++){var m=p[f];if(m.w!=0){var v=this.instanceCount;this.vertTypeBuffer.getView(v)[0]=sp;var g=this.indexBuffer.getView(v);_u(n,g);var y=this.atlasIdBuffer.getView(v);y[0]=u;var _=this.texBuffer.getView(v);_[0]=m.x,_[1]=m.y,_[2]=m.w,_[3]=m.h;var x=this.transformBuffer.getMatrixView(v);a.setTransformMatrix(t,x,i,l,d),this.instanceCount++}d=!1}this.instanceCount>=this.maxInstances&&this.endBatch()}}},{key:"drawSimpleRectangle",value:function(t,n,i){if(!!t.visible()){var a=this.atlasManager,s=this.instanceCount;this.vertTypeBuffer.getView(s)[0]=MN;var o=this.indexBuffer.getView(s);_u(n,o);var l=t.pstyle("background-color").value,u=t.pstyle("background-opacity").value,c=this.colorBuffer.getView(s);wh(l,u,c);var h=this.transformBuffer.getMatrixView(s);a.setTransformMatrix(t,h,i),this.rectangleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}},{key:"drawEdgeArrow",value:function(t,n,i){if(!!t.visible()){var a=t._private.rscratch,s,o,l;if(i==="source"?(s=a.arrowStartX,o=a.arrowStartY,l=a.srcArrowAngle):(s=a.arrowEndX,o=a.arrowEndY,l=a.tgtArrowAngle),!(isNaN(s)||s==null||isNaN(o)||o==null||isNaN(l)||l==null)){var u=t.pstyle(i+"-arrow-shape").value;if(u!=="none"){var c=t.pstyle(i+"-arrow-color").value,h=t.pstyle("opacity").value,d=t.pstyle("line-opacity").value,f=h*d,p=t.pstyle("width").pfValue,m=t.pstyle("arrow-scale").value,v=this.r.getArrowWidth(p,m),g=this.instanceCount,y=this.transformBuffer.getMatrixView(g);C3(y),Yg(y,y,[s,o]),eA(y,y,[v,v]),R3(y,y,l),this.vertTypeBuffer.getView(g)[0]=f0;var _=this.indexBuffer.getView(g);_u(n,_);var x=this.colorBuffer.getView(g);wh(c,f,x),this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}},{key:"drawEdgeLine",value:function(t,n){if(!!t.visible()){var i=this.getEdgePoints(t);if(!!i){var a=t.pstyle("opacity").value,s=t.pstyle("line-opacity").value,o=t.pstyle("width").pfValue,l=t.pstyle("line-color").value,u=a*s;if(i.length/2+this.instanceCount>this.maxInstances&&this.endBatch(),i.length==4){var c=this.instanceCount;this.vertTypeBuffer.getView(c)[0]=SN;var h=this.indexBuffer.getView(c);_u(n,h);var d=this.colorBuffer.getView(c);wh(l,u,d);var f=this.lineWidthBuffer.getView(c);f[0]=o;var p=this.pointAPointBBuffer.getView(c);p[0]=i[0],p[1]=i[1],p[2]=i[2],p[3]=i[3],this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}else for(var m=0;m<i.length-2;m+=2){var v=this.instanceCount;this.vertTypeBuffer.getView(v)[0]=AN;var g=this.indexBuffer.getView(v);_u(n,g);var y=this.colorBuffer.getView(v);wh(l,u,y);var _=this.lineWidthBuffer.getView(v);_[0]=o;var x=i[m-2],E=i[m-1],T=i[m],b=i[m+1],w=i[m+2],A=i[m+3],S=i[m+4],C=i[m+5];m==0&&(x=2*T-w+.001,E=2*b-A+.001),m==i.length-4&&(S=2*w-T+.001,C=2*A-b+.001);var R=this.pointAPointBBuffer.getView(v);R[0]=x,R[1]=E,R[2]=T,R[3]=b;var P=this.pointCPointDBuffer.getView(v);P[0]=w,P[1]=A,P[2]=S,P[3]=C,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}},{key:"getEdgePoints",value:function(t){var n=t._private.rscratch;if(!(n.badLine||n.allpts==null||isNaN(n.allpts[0]))){var i=n.allpts;if(i.length==4)return i;var a=this.getNumSegments(t);return this.getCurveSegmentPoints(i,a)}}},{key:"getNumSegments",value:function(t){var n=15;return Math.min(Math.max(n,5),this.maxInstances)}},{key:"getCurveSegmentPoints",value:function(t,n){if(t.length==4)return t;for(var i=Array((n+1)*2),a=0;a<=n;a++)if(a==0)i[0]=t[0],i[1]=t[1];else if(a==n)i[a*2]=t[t.length-2],i[a*2+1]=t[t.length-1];else{var s=a/n;this.setCurvePoint(t,s,i,a*2)}return i}},{key:"setCurvePoint",value:function(t,n,i,a){if(t.length<=2)i[a]=t[0],i[a+1]=t[1];else{for(var s=Array(t.length-2),o=0;o<s.length;o+=2){var l=(1-n)*t[o]+n*t[o+2],u=(1-n)*t[o+1]+n*t[o+3];s[o]=l,s[o+1]=u}return this.setCurvePoint(s,n,i,a)}}},{key:"endBatch",value:function(){var t=this.gl,n=this.vao,i=this.vertexCount,a=this.instanceCount;if(a!==0){var s=this.renderTarget.picking?this.pickingProgram:this.program;t.useProgram(s),t.bindVertexArray(n);var o=Na(this.buffers),l;try{for(o.s();!(l=o.n()).done;){var u=l.value;u.bufferSubData(a)}}catch(p){o.e(p)}finally{o.f()}for(var c=this.atlasManager.getAtlases(),h=0;h<c.length;h++)c[h].bufferIfNeeded(t);for(var d=0;d<c.length;d++)t.activeTexture(t.TEXTURE0+d),t.bindTexture(t.TEXTURE_2D,c[d].texture),t.uniform1i(s.uTextures[d],d);t.uniformMatrix3fv(s.uPanZoomMatrix,!1,this.panZoomMatrix),t.uniform1i(s.uAtlasSize,this.atlasManager.getAtlasSize());var f=wh(this.bgColor,1);t.uniform4fv(s.uBGColor,f),t.drawArraysInstanced(t.TRIANGLES,0,i,a),t.bindVertexArray(null),t.bindTexture(t.TEXTURE_2D,null),this.debug&&this.batchDebugInfo.push({count:a,atlasCount:c.length}),this.startBatch()}}},{key:"getDebugInfo",value:function(){var t=this.atlasManager.getDebugInfo(),n=t.reduce(function(s,o){return s+o.atlasCount},0),i=this.batchDebugInfo,a=i.reduce(function(s,o){return s+o.count},0);return{atlasInfo:t,totalAtlases:n,wrappedCount:this.wrappedCount,rectangleCount:this.rectangleCount,batchCount:i.length,batchInfo:i,totalInstances:a}}}])}();function CN(r,e){return"rgba(".concat(r[0],", ").concat(r[1],", ").concat(r[2],", ").concat(e,")")}var _Y=function(){function r(e){jo(this,r),this.r=e}return Ko(r,[{key:"getStyleKey",value:function(t,n){var i=this.getStyle(t,n),a=i.shape,s=i.opacity,o=i.color;if(!a)return null;var l=n.width(),u=n.height(),c=CN(o,s);return Uo("".concat(a,"-").concat(l,"-").concat(u,"-").concat(c))}},{key:"isVisible",value:function(t,n){var i=n.pstyle("".concat(t,"-opacity")).value;return i>0}},{key:"getStyle",value:function(t,n){var i=n.pstyle("".concat(t,"-opacity")).value,a=n.pstyle("".concat(t,"-color")).value,s=n.pstyle("".concat(t,"-shape")).value;return{opacity:i,color:a,shape:s}}},{key:"getPadding",value:function(t,n){return n.pstyle("".concat(t,"-padding")).pfValue}},{key:"draw",value:function(t,n,i,a){if(!!this.isVisible(t,i)){var s=this.r,o=a.w,l=a.h,u=o/2,c=l/2,h=this.getStyle(t,i),d=h.shape,f=h.color,p=h.opacity;n.save(),n.fillStyle=CN(f,p),d==="round-rectangle"||d==="roundrectangle"?s.drawRoundRectanglePath(n,u,c,o,l,"auto"):d==="ellipse"&&s.drawEllipsePath(n,u,c,o,l),n.fill(),n.restore()}}}])}(),N3={};N3.initWebgl=function(r,e){var t=this,n=t.data.contexts[t.WEBGL];r.bgColor=xY(t),r.webglTexSize=Math.min(r.webglTexSize,n.getParameter(n.MAX_TEXTURE_SIZE)),r.webglTexRows=Math.min(r.webglTexRows,54),r.webglTexRowsNodes=Math.min(r.webglTexRowsNodes,54),r.webglBatchSize=Math.min(r.webglBatchSize,16384),r.webglTexPerBatch=Math.min(r.webglTexPerBatch,n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)),t.webglDebug=r.webglDebug,t.webglDebugShowAtlases=r.webglDebugShowAtlases,t.pickingFrameBuffer=hY(n),t.pickingFrameBuffer.needsDraw=!0;var i=function(u){return function(c){return t.getTextAngle(c,u)}},a=function(u){return function(c){var h=c.pstyle(u);return h&&h.value}};t.drawing=new yY(t,n,r);var s=new _Y(t);t.drawing.addAtlasCollection("node",wN({texRows:r.webglTexRowsNodes})),t.drawing.addAtlasCollection("label",wN({texRows:r.webglTexRows})),t.drawing.addAtlasRenderType("node-body",xu({collection:"node",getKey:e.getStyleKey,getBoundingBox:e.getElementBox,drawElement:e.drawElement})),t.drawing.addAtlasRenderType("label",xu({collection:"label",getKey:e.getLabelKey,getBoundingBox:e.getLabelBox,drawElement:e.drawLabel,getRotation:i(null),getRotationPoint:e.getLabelRotationPoint,getRotationOffset:e.getLabelRotationOffset,isVisible:a("label")})),t.drawing.addAtlasRenderType("node-overlay",xu({collection:"node",getBoundingBox:e.getElementBox,getKey:function(u){return s.getStyleKey("overlay",u)},drawElement:function(u,c,h){return s.draw("overlay",u,c,h)},isVisible:function(u){return s.isVisible("overlay",u)},getPadding:function(u){return s.getPadding("overlay",u)}})),t.drawing.addAtlasRenderType("node-underlay",xu({collection:"node",getBoundingBox:e.getElementBox,getKey:function(u){return s.getStyleKey("underlay",u)},drawElement:function(u,c,h){return s.draw("underlay",u,c,h)},isVisible:function(u){return s.isVisible("underlay",u)},getPadding:function(u){return s.getPadding("underlay",u)}})),t.drawing.addAtlasRenderType("edge-source-label",xu({collection:"label",getKey:e.getSourceLabelKey,getBoundingBox:e.getSourceLabelBox,drawElement:e.drawSourceLabel,getRotation:i("source"),getRotationPoint:e.getSourceLabelRotationPoint,getRotationOffset:e.getSourceLabelRotationOffset,isVisible:a("source-label")})),t.drawing.addAtlasRenderType("edge-target-label",xu({collection:"label",getKey:e.getTargetLabelKey,getBoundingBox:e.getTargetLabelBox,drawElement:e.drawTargetLabel,getRotation:i("target"),getRotationPoint:e.getTargetLabelRotationPoint,getRotationOffset:e.getTargetLabelRotationOffset,isVisible:a("target-label")}));var o=md(function(){console.log("garbage collect flag set"),t.data.gc=!0},1e4);t.onUpdateEleCalcs(function(l,u){var c=!1;u&&u.length>0&&(c|=t.drawing.invalidate(u)),c&&o()}),bY(t)};function xY(r){var e=r.cy.container(),t=e&&e.style&&e.style.backgroundColor||"white";return nk(t)}function bY(r){{var e=r.render;r.render=function(a){a=a||{};var s=r.cy;r.webgl&&(s.zoom()>b3?(EY(r),e.call(r,a)):(TY(r),D3(r,a,ff.SCREEN)))}}{var t=r.matchCanvasSize;r.matchCanvasSize=function(a){t.call(r,a),r.pickingFrameBuffer.setFramebufferAttachmentSizes(r.canvasWidth,r.canvasHeight),r.pickingFrameBuffer.needsDraw=!0}}r.findNearestElements=function(a,s,o,l){return RY(r,a,s)};{var n=r.invalidateCachedZSortedEles;r.invalidateCachedZSortedEles=function(){n.call(r),r.pickingFrameBuffer.needsDraw=!0}}{var i=r.notify;r.notify=function(a,s){i.call(r,a,s),a==="viewport"||a==="bounds"?r.pickingFrameBuffer.needsDraw=!0:a==="background"&&r.drawing.invalidate(s,{type:"node-body"})}}}function EY(r){var e=r.data.contexts[r.WEBGL];e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}function TY(r){var e=function(n){n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,r.canvasWidth,r.canvasHeight),n.restore()};e(r.data.contexts[r.NODE]),e(r.data.contexts[r.DRAG])}function wY(r){var e=r.canvasWidth,t=r.canvasHeight,n=JS(r),i=n.pan,a=n.zoom,s=bg();Yg(s,s,[i.x,i.y]),eA(s,s,[a,a]);var o=bg();dY(o,e,t);var l=bg();return fY(l,o,s),l}function P3(r,e){var t=r.canvasWidth,n=r.canvasHeight,i=JS(r),a=i.pan,s=i.zoom;e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t,n),e.translate(a.x,a.y),e.scale(s,s)}function SY(r,e){r.drawSelectionRectangle(e,function(t){return P3(r,t)})}function AY(r){var e=r.data.contexts[r.NODE];e.save(),P3(r,e),e.strokeStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.moveTo(-1e3,0),e.lineTo(1e3,0),e.stroke(),e.beginPath(),e.moveTo(0,-1e3),e.lineTo(0,1e3),e.stroke(),e.restore()}function MY(r){var e=function(i,a,s){for(var o=i.atlasManager.getAtlasCollection(a),l=r.data.contexts[r.NODE],u=.125,c=o.atlases,h=0;h<c.length;h++){var d=c[h],f=d.canvas;if(f){var p=f.width,m=f.height,v=p*h,g=f.height*s;l.save(),l.scale(u,u),l.drawImage(f,v,g),l.strokeStyle="black",l.rect(v,g,p,m),l.stroke(),l.restore()}}},t=0;e(r.drawing,"node",t++),e(r.drawing,"label",t++)}function CY(r,e,t,n,i){var a,s,o,l,u=JS(r),c=u.pan,h=u.zoom;{var d=aY(r,c,h,e,t),f=vr(d,2),p=f[0],m=f[1],v=6;a=p-v/2,s=m-v/2,o=v,l=v}if(o===0||l===0)return[];var g=r.data.contexts[r.WEBGL];g.bindFramebuffer(g.FRAMEBUFFER,r.pickingFrameBuffer),r.pickingFrameBuffer.needsDraw&&(g.viewport(0,0,g.canvas.width,g.canvas.height),D3(r,null,ff.PICKING),r.pickingFrameBuffer.needsDraw=!1);var y=o*l,_=new Uint8Array(y*4);g.readPixels(a,s,o,l,g.RGBA,g.UNSIGNED_BYTE,_),g.bindFramebuffer(g.FRAMEBUFFER,null);for(var x=new Set,E=0;E<y;E++){var T=_.slice(E*4,E*4+4),b=sY(T)-1;b>=0&&x.add(b)}return x}function RY(r,e,t){var n=CY(r,e,t),i=r.getCachedZSortedEles(),a,s,o=Na(n),l;try{for(o.s();!(l=o.n()).done;){var u=l.value,c=i[u];if(!a&&c.isNode()&&(a=c),!s&&c.isEdge()&&(s=c),a&&s)break}}catch(h){o.e(h)}finally{o.f()}return[a,s].filter(Boolean)}function NY(r){return r.pstyle("shape").value==="rectangle"&&r.pstyle("background-fill").value==="solid"&&r.pstyle("border-width").pfValue===0&&r.pstyle("background-image").strValue==="none"}function d0(r,e,t){var n=r.drawing;e+=1,t.isNode()?(n.drawTexture(t,e,"node-underlay"),NY(t)?n.drawSimpleRectangle(t,e,"node-body"):n.drawTexture(t,e,"node-body"),n.drawTexture(t,e,"label"),n.drawTexture(t,e,"node-overlay")):(n.drawEdgeLine(t,e),n.drawEdgeArrow(t,e,"source"),n.drawEdgeArrow(t,e,"target"),n.drawTexture(t,e,"label"),n.drawTexture(t,e,"edge-source-label"),n.drawTexture(t,e,"edge-target-label"))}function D3(r,e,t){var n;r.webglDebug&&(n=performance.now());var i=r.drawing,a=0;if(t.screen&&r.data.canvasNeedsRedraw[r.SELECT_BOX]&&SY(r,e),r.data.canvasNeedsRedraw[r.NODE]||t.picking){var s=r.data.contexts[r.WEBGL];t.screen?(s.clearColor(0,0,0,0),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA)):s.disable(s.BLEND),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.viewport(0,0,s.canvas.width,s.canvas.height);var o=wY(r),l=r.getCachedZSortedEles();if(a=l.length,i.startFrame(o,t),t.screen){for(var u=0;u<l.nondrag.length;u++)d0(r,u,l.nondrag[u]);for(var c=0;c<l.drag.length;c++)d0(r,c,l.drag[c])}else if(t.picking)for(var h=0;h<l.length;h++)d0(r,h,l[h]);i.endFrame(),t.screen&&r.webglDebugShowAtlases&&(AY(r),MY(r)),r.data.canvasNeedsRedraw[r.NODE]=!1,r.data.canvasNeedsRedraw[r.DRAG]=!1}if(r.webglDebug){var d=performance.now(),f=!1,p=Math.ceil(d-n),m=i.getDebugInfo(),v=["".concat(a," elements"),"".concat(m.totalInstances," instances"),"".concat(m.batchCount," batches"),"".concat(m.totalAtlases," atlases"),"".concat(m.wrappedCount," wrapped textures"),"".concat(m.rectangleCount," simple rectangles")].join(", ");if(f)console.log("WebGL (".concat(t.name,") - time ").concat(p,"ms, ").concat(v));else{console.log("WebGL (".concat(t.name,") - frame time ").concat(p,"ms")),console.log("Totals:"),console.log("  ".concat(v)),console.log("Texture Atlases Used:");var g=m.atlasInfo,y=Na(g),_;try{for(y.s();!(_=y.n()).done;){var x=_.value;console.log("  ".concat(x.type,": ").concat(x.keyCount," keys, ").concat(x.atlasCount," atlases"))}}catch(E){y.e(E)}finally{y.f()}console.log("")}}r.data.gc&&(console.log("Garbage Collect!"),r.data.gc=!1,i.gc())}var Zo={};Zo.drawPolygonPath=function(r,e,t,n,i,a){var s=n/2,o=i/2;r.beginPath&&r.beginPath(),r.moveTo(e+s*a[0],t+o*a[1]);for(var l=1;l<a.length/2;l++)r.lineTo(e+s*a[l*2],t+o*a[l*2+1]);r.closePath()};Zo.drawRoundPolygonPath=function(r,e,t,n,i,a,s){s.forEach(function(o){return f3(r,o)}),r.closePath()};Zo.drawRoundRectanglePath=function(r,e,t,n,i,a){var s=n/2,o=i/2,l=a==="auto"?Hl(n,i):Math.min(a,o,s);r.beginPath&&r.beginPath(),r.moveTo(e,t-o),r.arcTo(e+s,t-o,e+s,t,l),r.arcTo(e+s,t+o,e,t+o,l),r.arcTo(e-s,t+o,e-s,t,l),r.arcTo(e-s,t-o,e,t-o,l),r.lineTo(e,t-o),r.closePath()};Zo.drawBottomRoundRectanglePath=function(r,e,t,n,i,a){var s=n/2,o=i/2,l=a==="auto"?Hl(n,i):a;r.beginPath&&r.beginPath(),r.moveTo(e,t-o),r.lineTo(e+s,t-o),r.lineTo(e+s,t),r.arcTo(e+s,t+o,e,t+o,l),r.arcTo(e-s,t+o,e-s,t,l),r.lineTo(e-s,t-o),r.lineTo(e,t-o),r.closePath()};Zo.drawCutRectanglePath=function(r,e,t,n,i,a,s){var o=n/2,l=i/2,u=s==="auto"?kS():s;r.beginPath&&r.beginPath(),r.moveTo(e-o+u,t-l),r.lineTo(e+o-u,t-l),r.lineTo(e+o,t-l+u),r.lineTo(e+o,t+l-u),r.lineTo(e+o-u,t+l),r.lineTo(e-o+u,t+l),r.lineTo(e-o,t+l-u),r.lineTo(e-o,t-l+u),r.closePath()};Zo.drawBarrelPath=function(r,e,t,n,i){var a=n/2,s=i/2,o=e-a,l=e+a,u=t-s,c=t+s,h=Sw(n,i),d=h.widthOffset,f=h.heightOffset,p=h.ctrlPtOffsetPct*d;r.beginPath&&r.beginPath(),r.moveTo(o,u+f),r.lineTo(o,c-f),r.quadraticCurveTo(o+p,c,o+d,c),r.lineTo(l-d,c),r.quadraticCurveTo(l-p,c,l,c-f),r.lineTo(l,u+f),r.quadraticCurveTo(l-p,u,l-d,u),r.lineTo(o+d,u),r.quadraticCurveTo(o+p,u,o,u+f),r.closePath()};var RN=Math.sin(0),NN=Math.cos(0),kw={},Gw={},L3=Math.PI/40;for(var bu=0*Math.PI;bu<2*Math.PI;bu+=L3)kw[bu]=Math.sin(bu),Gw[bu]=Math.cos(bu);Zo.drawEllipsePath=function(r,e,t,n,i){if(r.beginPath&&r.beginPath(),r.ellipse)r.ellipse(e,t,n/2,i/2,0,0,2*Math.PI);else for(var a,s,o=n/2,l=i/2,u=0*Math.PI;u<2*Math.PI;u+=L3)a=e-o*kw[u]*RN+o*Gw[u]*NN,s=t+l*Gw[u]*RN+l*kw[u]*NN,u===0?r.moveTo(a,s):r.lineTo(a,s);r.closePath()};var Td={};Td.createBuffer=function(r,e){var t=document.createElement("canvas");return t.width=r,t.height=e,[t,t.getContext("2d")]};Td.bufferCanvasImage=function(r){var e=this.cy,t=e.mutableElements(),n=t.boundingBox(),i=this.findContainerClientCoords(),a=r.full?Math.ceil(n.w):i[2],s=r.full?Math.ceil(n.h):i[3],o=et(r.maxWidth)||et(r.maxHeight),l=this.getPixelRatio(),u=1;if(r.scale!==void 0)a*=r.scale,s*=r.scale,u=r.scale;else if(o){var c=1/0,h=1/0;et(r.maxWidth)&&(c=u*r.maxWidth/a),et(r.maxHeight)&&(h=u*r.maxHeight/s),u=Math.min(c,h),a*=u,s*=u}o||(a*=l,s*=l,u*=l);var d=document.createElement("canvas");d.width=a,d.height=s,d.style.width=a+"px",d.style.height=s+"px";var f=d.getContext("2d");if(a>0&&s>0){f.clearRect(0,0,a,s),f.globalCompositeOperation="source-over";var p=this.getCachedZSortedEles();if(r.full)f.translate(-n.x1*u,-n.y1*u),f.scale(u,u),this.drawElements(f,p),f.scale(1/u,1/u),f.translate(n.x1*u,n.y1*u);else{var m=e.pan(),v={x:m.x*u,y:m.y*u};u*=e.zoom(),f.translate(v.x,v.y),f.scale(u,u),this.drawElements(f,p),f.scale(1/u,1/u),f.translate(-v.x,-v.y)}r.bg&&(f.globalCompositeOperation="destination-over",f.fillStyle=r.bg,f.rect(0,0,a,s),f.fill())}return d};function PY(r,e){for(var t=atob(r),n=new ArrayBuffer(t.length),i=new Uint8Array(n),a=0;a<t.length;a++)i[a]=t.charCodeAt(a);return new Blob([n],{type:e})}function PN(r){var e=r.indexOf(",");return r.substr(e+1)}function I3(r,e,t){var n=function(){return e.toDataURL(t,r.quality)};switch(r.output){case"blob-promise":return new Kc(function(i,a){try{e.toBlob(function(s){s!=null?i(s):a(new Error("`canvas.toBlob()` sent a null value in its callback"))},t,r.quality)}catch(s){a(s)}});case"blob":return PY(PN(n()),t);case"base64":return PN(n());case"base64uri":default:return n()}}Td.png=function(r){return I3(r,this.bufferCanvasImage(r),"image/png")};Td.jpg=function(r){return I3(r,this.bufferCanvasImage(r),"image/jpeg")};var O3={};O3.nodeShapeImpl=function(r,e,t,n,i,a,s,o){switch(r){case"ellipse":return this.drawEllipsePath(e,t,n,i,a);case"polygon":return this.drawPolygonPath(e,t,n,i,a,s);case"round-polygon":return this.drawRoundPolygonPath(e,t,n,i,a,s,o);case"roundrectangle":case"round-rectangle":return this.drawRoundRectanglePath(e,t,n,i,a,o);case"cutrectangle":case"cut-rectangle":return this.drawCutRectanglePath(e,t,n,i,a,s,o);case"bottomroundrectangle":case"bottom-round-rectangle":return this.drawBottomRoundRectanglePath(e,t,n,i,a,o);case"barrel":return this.drawBarrelPath(e,t,n,i,a)}};var DY=F3,Ot=F3.prototype;Ot.CANVAS_LAYERS=3;Ot.SELECT_BOX=0;Ot.DRAG=1;Ot.NODE=2;Ot.WEBGL=3;Ot.CANVAS_TYPES=["2d","2d","2d","webgl2"];Ot.BUFFER_COUNT=3;Ot.TEXTURE_BUFFER=0;Ot.MOTIONBLUR_BUFFER_NODE=1;Ot.MOTIONBLUR_BUFFER_DRAG=2;function F3(r){var e=this,t=e.cy.window(),n=t.document;r.webgl&&(Ot.CANVAS_LAYERS=e.CANVAS_LAYERS=4,console.log("webgl rendering enabled")),e.data={canvases:new Array(Ot.CANVAS_LAYERS),contexts:new Array(Ot.CANVAS_LAYERS),canvasNeedsRedraw:new Array(Ot.CANVAS_LAYERS),bufferCanvases:new Array(Ot.BUFFER_COUNT),bufferContexts:new Array(Ot.CANVAS_LAYERS)};var i="-webkit-tap-highlight-color",a="rgba(0,0,0,0)";e.data.canvasContainer=n.createElement("div");var s=e.data.canvasContainer.style;e.data.canvasContainer.style[i]=a,s.position="relative",s.zIndex="0",s.overflow="hidden";var o=r.cy.container();o.appendChild(e.data.canvasContainer),o.style[i]=a;var l={"-webkit-user-select":"none","-moz-user-select":"-moz-none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","outline-style":"none"};UW()&&(l["-ms-touch-action"]="none",l["touch-action"]="none");for(var u=0;u<Ot.CANVAS_LAYERS;u++){var c=e.data.canvases[u]=n.createElement("canvas"),h=Ot.CANVAS_TYPES[u];e.data.contexts[u]=c.getContext(h),e.data.contexts[u]||Nn("Could not create canvas of type "+h),Object.keys(l).forEach(function(Y){c.style[Y]=l[Y]}),c.style.position="absolute",c.setAttribute("data-id","layer"+u),c.style.zIndex=String(Ot.CANVAS_LAYERS-u),e.data.canvasContainer.appendChild(c),e.data.canvasNeedsRedraw[u]=!1}e.data.topCanvas=e.data.canvases[0],e.data.canvases[Ot.NODE].setAttribute("data-id","layer"+Ot.NODE+"-node"),e.data.canvases[Ot.SELECT_BOX].setAttribute("data-id","layer"+Ot.SELECT_BOX+"-selectbox"),e.data.canvases[Ot.DRAG].setAttribute("data-id","layer"+Ot.DRAG+"-drag"),e.data.canvases[Ot.WEBGL]&&e.data.canvases[Ot.WEBGL].setAttribute("data-id","layer"+Ot.WEBGL+"-webgl");for(var u=0;u<Ot.BUFFER_COUNT;u++)e.data.bufferCanvases[u]=n.createElement("canvas"),e.data.bufferContexts[u]=e.data.bufferCanvases[u].getContext("2d"),e.data.bufferCanvases[u].style.position="absolute",e.data.bufferCanvases[u].setAttribute("data-id","buffer"+u),e.data.bufferCanvases[u].style.zIndex=String(-u-1),e.data.bufferCanvases[u].style.visibility="hidden";e.pathsEnabled=!0;var d=bi(),f=function(X){return{x:(X.x1+X.x2)/2,y:(X.y1+X.y2)/2}},p=function(X){return{x:-X.w/2,y:-X.h/2}},m=function(X){var K=X[0]._private,se=K.oldBackgroundTimestamp===K.backgroundTimestamp;return!se},v=function(X){return X[0]._private.nodeKey},g=function(X){return X[0]._private.labelStyleKey},y=function(X){return X[0]._private.sourceLabelStyleKey},_=function(X){return X[0]._private.targetLabelStyleKey},x=function(X,K,se,oe,W){return e.drawElement(X,K,se,!1,!1,W)},E=function(X,K,se,oe,W){return e.drawElementText(X,K,se,oe,"main",W)},T=function(X,K,se,oe,W){return e.drawElementText(X,K,se,oe,"source",W)},b=function(X,K,se,oe,W){return e.drawElementText(X,K,se,oe,"target",W)},w=function(X){return X.boundingBox(),X[0]._private.bodyBounds},A=function(X){return X.boundingBox(),X[0]._private.labelBounds.main||d},S=function(X){return X.boundingBox(),X[0]._private.labelBounds.source||d},C=function(X){return X.boundingBox(),X[0]._private.labelBounds.target||d},R=function(X,K){return K},P=function(X){return f(w(X))},M=function(X,K,se){var oe=X?X+"-":"";return{x:K.x+se.pstyle(oe+"text-margin-x").pfValue,y:K.y+se.pstyle(oe+"text-margin-y").pfValue}},N=function(X,K,se){var oe=X[0]._private.rscratch;return{x:oe[K],y:oe[se]}},D=function(X){return M("",N(X,"labelX","labelY"),X)},I=function(X){return M("source",N(X,"sourceLabelX","sourceLabelY"),X)},L=function(X){return M("target",N(X,"targetLabelX","targetLabelY"),X)},z=function(X){return p(w(X))},B=function(X){return p(S(X))},k=function(X){return p(C(X))},U=function(X){var K=A(X),se=p(A(X));if(X.isNode()){switch(X.pstyle("text-halign").value){case"left":se.x=-K.w-(K.leftPad||0);break;case"right":se.x=-(K.rightPad||0);break}switch(X.pstyle("text-valign").value){case"top":se.y=-K.h-(K.topPad||0);break;case"bottom":se.y=-(K.botPad||0);break}}return se},G=e.data.eleTxrCache=new Jh(e,{getKey:v,doesEleInvalidateKey:m,drawElement:x,getBoundingBox:w,getRotationPoint:P,getRotationOffset:z,allowEdgeTxrCaching:!1,allowParentTxrCaching:!1}),O=e.data.lblTxrCache=new Jh(e,{getKey:g,drawElement:E,getBoundingBox:A,getRotationPoint:D,getRotationOffset:U,isVisible:R}),F=e.data.slbTxrCache=new Jh(e,{getKey:y,drawElement:T,getBoundingBox:S,getRotationPoint:I,getRotationOffset:B,isVisible:R}),V=e.data.tlbTxrCache=new Jh(e,{getKey:_,drawElement:b,getBoundingBox:C,getRotationPoint:L,getRotationOffset:k,isVisible:R}),$=e.data.lyrTxrCache=new E3(e);e.onUpdateEleCalcs(function(X,K){G.invalidateElements(K),O.invalidateElements(K),F.invalidateElements(K),V.invalidateElements(K),$.invalidateElements(K);for(var se=0;se<K.length;se++){var oe=K[se]._private;oe.oldBackgroundTimestamp=oe.backgroundTimestamp}});var Z=function(X){for(var K=0;K<X.length;K++)$.enqueueElementRefinement(X[K].ele)};G.onDequeue(Z),O.onDequeue(Z),F.onDequeue(Z),V.onDequeue(Z),r.webgl&&e.initWebgl(r,{getStyleKey:v,getLabelKey:g,getSourceLabelKey:y,getTargetLabelKey:_,drawElement:x,drawLabel:E,drawSourceLabel:T,drawTargetLabel:b,getElementBox:w,getLabelBox:A,getSourceLabelBox:S,getTargetLabelBox:C,getElementRotationPoint:P,getElementRotationOffset:z,getLabelRotationPoint:D,getSourceLabelRotationPoint:I,getTargetLabelRotationPoint:L,getLabelRotationOffset:U,getSourceLabelRotationOffset:B,getTargetLabelRotationOffset:k})}Ot.redrawHint=function(r,e){var t=this;switch(r){case"eles":t.data.canvasNeedsRedraw[Ot.NODE]=e;break;case"drag":t.data.canvasNeedsRedraw[Ot.DRAG]=e;break;case"select":t.data.canvasNeedsRedraw[Ot.SELECT_BOX]=e;break;case"gc":t.data.gc=!0;break}};var LY=typeof Path2D<"u";Ot.path2dEnabled=function(r){if(r===void 0)return this.pathsEnabled;this.pathsEnabled=!!r};Ot.usePaths=function(){return LY&&this.pathsEnabled};Ot.setImgSmoothing=function(r,e){r.imageSmoothingEnabled!=null?r.imageSmoothingEnabled=e:(r.webkitImageSmoothingEnabled=e,r.mozImageSmoothingEnabled=e,r.msImageSmoothingEnabled=e)};Ot.getImgSmoothing=function(r){return r.imageSmoothingEnabled!=null?r.imageSmoothingEnabled:r.webkitImageSmoothingEnabled||r.mozImageSmoothingEnabled||r.msImageSmoothingEnabled};Ot.makeOffscreenCanvas=function(r,e){var t;if((typeof OffscreenCanvas>"u"?"undefined":sr(OffscreenCanvas))!=="undefined")t=new OffscreenCanvas(r,e);else{var n=this.cy.window(),i=n.document;t=i.createElement("canvas"),t.width=r,t.height=e}return t};[T3,hs,Zs,ZS,nu,th,ti,N3,Zo,Td,O3].forEach(function(r){mt(Ot,r)});var IY=[{name:"null",impl:u3},{name:"base",impl:_3},{name:"canvas",impl:DY}],OY=[{type:"layout",extensions:dX},{type:"renderer",extensions:IY}],B3={},U3={};function k3(r,e,t){var n=t,i=function(w){nn("Can not register `"+e+"` for `"+r+"` since `"+w+"` already exists in the prototype and can not be overridden")};if(r==="core"){if(Df.prototype[e])return i(e);Df.prototype[e]=t}else if(r==="collection"){if(Cr.prototype[e])return i(e);Cr.prototype[e]=t}else if(r==="layout"){for(var a=function(w){this.options=w,t.call(this,w),$t(this._private)||(this._private={}),this._private.cy=w.cy,this._private.listeners=[],this.createEmitter()},s=a.prototype=Object.create(t.prototype),o=[],l=0;l<o.length;l++){var u=o[l];s[u]=s[u]||function(){return this}}s.start&&!s.run?s.run=function(){return this.start(),this}:!s.start&&s.run&&(s.start=function(){return this.run(),this});var c=t.prototype.stop;s.stop=function(){var b=this.options;if(b&&b.animate){var w=this.animations;if(w)for(var A=0;A<w.length;A++)w[A].stop()}return c?c.call(this):this.emit("layoutstop"),this},s.destroy||(s.destroy=function(){return this}),s.cy=function(){return this._private.cy};var h=function(w){return w._private.cy},d={addEventFields:function(w,A){A.layout=w,A.cy=h(w),A.target=w},bubble:function(){return!0},parent:function(w){return h(w)}};mt(s,{createEmitter:function(){return this._private.emitter=new Nv(d,this),this},emitter:function(){return this._private.emitter},on:function(w,A){return this.emitter().on(w,A),this},one:function(w,A){return this.emitter().one(w,A),this},once:function(w,A){return this.emitter().one(w,A),this},removeListener:function(w,A){return this.emitter().removeListener(w,A),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},emit:function(w,A){return this.emitter().emit(w,A),this}}),tn.eventAliasesOn(s),n=a}else if(r==="renderer"&&e!=="null"&&e!=="base"){var f=G3("renderer","base"),p=f.prototype,m=t,v=t.prototype,g=function(){f.apply(this,arguments),m.apply(this,arguments)},y=g.prototype;for(var _ in p){var x=p[_],E=v[_]!=null;if(E)return i(_);y[_]=x}for(var T in v)y[T]=v[T];p.clientFunctions.forEach(function(b){y[b]=y[b]||function(){Nn("Renderer does not implement `renderer."+b+"()` on its prototype")}}),n=g}else if(r==="__proto__"||r==="constructor"||r==="prototype")return Nn(r+" is an illegal type to be registered, possibly lead to prototype pollutions");return rk({map:B3,keys:[r,e],value:n})}function G3(r,e){return ik({map:B3,keys:[r,e]})}function FY(r,e,t,n,i){return rk({map:U3,keys:[r,e,t,n],value:i})}function BY(r,e,t,n){return ik({map:U3,keys:[r,e,t,n]})}var zw=function(){if(arguments.length===2)return G3.apply(null,arguments);if(arguments.length===3)return k3.apply(null,arguments);if(arguments.length===4)return BY.apply(null,arguments);if(arguments.length===5)return FY.apply(null,arguments);Nn("Invalid extension access syntax")};Df.prototype.extension=zw;OY.forEach(function(r){r.extensions.forEach(function(e){k3(r.type,e.name,e.impl)})});var jg=function(){if(!(this instanceof jg))return new jg;this.length=0},$l=jg.prototype;$l.instanceString=function(){return"stylesheet"};$l.selector=function(r){var e=this.length++;return this[e]={selector:r,properties:[]},this};$l.css=function(r,e){var t=this.length-1;if(dt(r))this[t].properties.push({name:r,value:e});else if($t(r))for(var n=r,i=Object.keys(n),a=0;a<i.length;a++){var s=i[a],o=n[s];if(o!=null){var l=xr.properties[s]||xr.properties[xv(s)];if(l!=null){var u=l.name,c=o;this[t].properties.push({name:u,value:c})}}}return this};$l.style=$l.css;$l.generateStyle=function(r){var e=new xr(r);return this.appendToStyle(e)};$l.appendToStyle=function(r){for(var e=0;e<this.length;e++){var t=this[e],n=t.selector,i=t.properties;r.selector(n);for(var a=0;a<i.length;a++){var s=i[a];r.css(s.name,s.value)}}return r};var UY="3.31.2",Ma=function(e){if(e===void 0&&(e={}),$t(e))return new Df(e);if(dt(e))return zw.apply(zw,arguments)};Ma.use=function(r){var e=Array.prototype.slice.call(arguments,1);return e.unshift(Ma),r.apply(null,e),this};Ma.warnings=function(r){return hk(r)};Ma.version=UY;Ma.stylesheet=Ma.Stylesheet=jg;var z3={exports:{}},p0={exports:{}},g0={exports:{}},DN;function V3(){return DN||(DN=1,function(r,e){(function(n,i){r.exports=i()})(Ui,function(){return function(t){var n={};function i(a){if(n[a])return n[a].exports;var s=n[a]={i:a,l:!1,exports:{}};return t[a].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=n,i.i=function(a){return a},i.d=function(a,s,o){i.o(a,s)||Object.defineProperty(a,s,{configurable:!1,enumerable:!0,get:o})},i.n=function(a){var s=a&&a.__esModule?function(){return a.default}:function(){return a};return i.d(s,"a",s),s},i.o=function(a,s){return Object.prototype.hasOwnProperty.call(a,s)},i.p="",i(i.s=26)}([function(t,n,i){function a(){}a.QUALITY=1,a.DEFAULT_CREATE_BENDS_AS_NEEDED=!1,a.DEFAULT_INCREMENTAL=!1,a.DEFAULT_ANIMATION_ON_LAYOUT=!0,a.DEFAULT_ANIMATION_DURING_LAYOUT=!1,a.DEFAULT_ANIMATION_PERIOD=50,a.DEFAULT_UNIFORM_LEAF_NODE_SIZES=!1,a.DEFAULT_GRAPH_MARGIN=15,a.NODE_DIMENSIONS_INCLUDE_LABELS=!1,a.SIMPLE_NODE_SIZE=40,a.SIMPLE_NODE_HALF_SIZE=a.SIMPLE_NODE_SIZE/2,a.EMPTY_COMPOUND_NODE_SIZE=40,a.MIN_EDGE_LENGTH=1,a.WORLD_BOUNDARY=1e6,a.INITIAL_WORLD_BOUNDARY=a.WORLD_BOUNDARY/1e3,a.WORLD_CENTER_X=1200,a.WORLD_CENTER_Y=900,t.exports=a},function(t,n,i){var a=i(2),s=i(8),o=i(9);function l(c,h,d){a.call(this,d),this.isOverlapingSourceAndTarget=!1,this.vGraphObject=d,this.bendpoints=[],this.source=c,this.target=h}l.prototype=Object.create(a.prototype);for(var u in a)l[u]=a[u];l.prototype.getSource=function(){return this.source},l.prototype.getTarget=function(){return this.target},l.prototype.isInterGraph=function(){return this.isInterGraph},l.prototype.getLength=function(){return this.length},l.prototype.isOverlapingSourceAndTarget=function(){return this.isOverlapingSourceAndTarget},l.prototype.getBendpoints=function(){return this.bendpoints},l.prototype.getLca=function(){return this.lca},l.prototype.getSourceInLca=function(){return this.sourceInLca},l.prototype.getTargetInLca=function(){return this.targetInLca},l.prototype.getOtherEnd=function(c){if(this.source===c)return this.target;if(this.target===c)return this.source;throw"Node is not incident with this edge"},l.prototype.getOtherEndInGraph=function(c,h){for(var d=this.getOtherEnd(c),f=h.getGraphManager().getRoot();;){if(d.getOwner()==h)return d;if(d.getOwner()==f)break;d=d.getOwner().getParent()}return null},l.prototype.updateLength=function(){var c=new Array(4);this.isOverlapingSourceAndTarget=s.getIntersection(this.target.getRect(),this.source.getRect(),c),this.isOverlapingSourceAndTarget||(this.lengthX=c[0]-c[2],this.lengthY=c[1]-c[3],Math.abs(this.lengthX)<1&&(this.lengthX=o.sign(this.lengthX)),Math.abs(this.lengthY)<1&&(this.lengthY=o.sign(this.lengthY)),this.length=Math.sqrt(this.lengthX*this.lengthX+this.lengthY*this.lengthY))},l.prototype.updateLengthSimple=function(){this.lengthX=this.target.getCenterX()-this.source.getCenterX(),this.lengthY=this.target.getCenterY()-this.source.getCenterY(),Math.abs(this.lengthX)<1&&(this.lengthX=o.sign(this.lengthX)),Math.abs(this.lengthY)<1&&(this.lengthY=o.sign(this.lengthY)),this.length=Math.sqrt(this.lengthX*this.lengthX+this.lengthY*this.lengthY)},t.exports=l},function(t,n,i){function a(s){this.vGraphObject=s}t.exports=a},function(t,n,i){var a=i(2),s=i(10),o=i(13),l=i(0),u=i(16),c=i(4);function h(f,p,m,v){m==null&&v==null&&(v=p),a.call(this,v),f.graphManager!=null&&(f=f.graphManager),this.estimatedSize=s.MIN_VALUE,this.inclusionTreeDepth=s.MAX_VALUE,this.vGraphObject=v,this.edges=[],this.graphManager=f,m!=null&&p!=null?this.rect=new o(p.x,p.y,m.width,m.height):this.rect=new o}h.prototype=Object.create(a.prototype);for(var d in a)h[d]=a[d];h.prototype.getEdges=function(){return this.edges},h.prototype.getChild=function(){return this.child},h.prototype.getOwner=function(){return this.owner},h.prototype.getWidth=function(){return this.rect.width},h.prototype.setWidth=function(f){this.rect.width=f},h.prototype.getHeight=function(){return this.rect.height},h.prototype.setHeight=function(f){this.rect.height=f},h.prototype.getCenterX=function(){return this.rect.x+this.rect.width/2},h.prototype.getCenterY=function(){return this.rect.y+this.rect.height/2},h.prototype.getCenter=function(){return new c(this.rect.x+this.rect.width/2,this.rect.y+this.rect.height/2)},h.prototype.getLocation=function(){return new c(this.rect.x,this.rect.y)},h.prototype.getRect=function(){return this.rect},h.prototype.getDiagonal=function(){return Math.sqrt(this.rect.width*this.rect.width+this.rect.height*this.rect.height)},h.prototype.getHalfTheDiagonal=function(){return Math.sqrt(this.rect.height*this.rect.height+this.rect.width*this.rect.width)/2},h.prototype.setRect=function(f,p){this.rect.x=f.x,this.rect.y=f.y,this.rect.width=p.width,this.rect.height=p.height},h.prototype.setCenter=function(f,p){this.rect.x=f-this.rect.width/2,this.rect.y=p-this.rect.height/2},h.prototype.setLocation=function(f,p){this.rect.x=f,this.rect.y=p},h.prototype.moveBy=function(f,p){this.rect.x+=f,this.rect.y+=p},h.prototype.getEdgeListToNode=function(f){var p=[],m=this;return m.edges.forEach(function(v){if(v.target==f){if(v.source!=m)throw"Incorrect edge source!";p.push(v)}}),p},h.prototype.getEdgesBetween=function(f){var p=[],m=this;return m.edges.forEach(function(v){if(!(v.source==m||v.target==m))throw"Incorrect edge source and/or target";(v.target==f||v.source==f)&&p.push(v)}),p},h.prototype.getNeighborsList=function(){var f=new Set,p=this;return p.edges.forEach(function(m){if(m.source==p)f.add(m.target);else{if(m.target!=p)throw"Incorrect incidency!";f.add(m.source)}}),f},h.prototype.withChildren=function(){var f=new Set,p,m;if(f.add(this),this.child!=null)for(var v=this.child.getNodes(),g=0;g<v.length;g++)p=v[g],m=p.withChildren(),m.forEach(function(y){f.add(y)});return f},h.prototype.getNoOfChildren=function(){var f=0,p;if(this.child==null)f=1;else for(var m=this.child.getNodes(),v=0;v<m.length;v++)p=m[v],f+=p.getNoOfChildren();return f==0&&(f=1),f},h.prototype.getEstimatedSize=function(){if(this.estimatedSize==s.MIN_VALUE)throw"assert failed";return this.estimatedSize},h.prototype.calcEstimatedSize=function(){return this.child==null?this.estimatedSize=(this.rect.width+this.rect.height)/2:(this.estimatedSize=this.child.calcEstimatedSize(),this.rect.width=this.estimatedSize,this.rect.height=this.estimatedSize,this.estimatedSize)},h.prototype.scatter=function(){var f,p,m=-l.INITIAL_WORLD_BOUNDARY,v=l.INITIAL_WORLD_BOUNDARY;f=l.WORLD_CENTER_X+u.nextDouble()*(v-m)+m;var g=-l.INITIAL_WORLD_BOUNDARY,y=l.INITIAL_WORLD_BOUNDARY;p=l.WORLD_CENTER_Y+u.nextDouble()*(y-g)+g,this.rect.x=f,this.rect.y=p},h.prototype.updateBounds=function(){if(this.getChild()==null)throw"assert failed";if(this.getChild().getNodes().length!=0){var f=this.getChild();if(f.updateBounds(!0),this.rect.x=f.getLeft(),this.rect.y=f.getTop(),this.setWidth(f.getRight()-f.getLeft()),this.setHeight(f.getBottom()-f.getTop()),l.NODE_DIMENSIONS_INCLUDE_LABELS){var p=f.getRight()-f.getLeft(),m=f.getBottom()-f.getTop();this.labelWidth>p&&(this.rect.x-=(this.labelWidth-p)/2,this.setWidth(this.labelWidth)),this.labelHeight>m&&(this.labelPos=="center"?this.rect.y-=(this.labelHeight-m)/2:this.labelPos=="top"&&(this.rect.y-=this.labelHeight-m),this.setHeight(this.labelHeight))}}},h.prototype.getInclusionTreeDepth=function(){if(this.inclusionTreeDepth==s.MAX_VALUE)throw"assert failed";return this.inclusionTreeDepth},h.prototype.transform=function(f){var p=this.rect.x;p>l.WORLD_BOUNDARY?p=l.WORLD_BOUNDARY:p<-l.WORLD_BOUNDARY&&(p=-l.WORLD_BOUNDARY);var m=this.rect.y;m>l.WORLD_BOUNDARY?m=l.WORLD_BOUNDARY:m<-l.WORLD_BOUNDARY&&(m=-l.WORLD_BOUNDARY);var v=new c(p,m),g=f.inverseTransformPoint(v);this.setLocation(g.x,g.y)},h.prototype.getLeft=function(){return this.rect.x},h.prototype.getRight=function(){return this.rect.x+this.rect.width},h.prototype.getTop=function(){return this.rect.y},h.prototype.getBottom=function(){return this.rect.y+this.rect.height},h.prototype.getParent=function(){return this.owner==null?null:this.owner.getParent()},t.exports=h},function(t,n,i){function a(s,o){s==null&&o==null?(this.x=0,this.y=0):(this.x=s,this.y=o)}a.prototype.getX=function(){return this.x},a.prototype.getY=function(){return this.y},a.prototype.setX=function(s){this.x=s},a.prototype.setY=function(s){this.y=s},a.prototype.getDifference=function(s){return new DimensionD(this.x-s.x,this.y-s.y)},a.prototype.getCopy=function(){return new a(this.x,this.y)},a.prototype.translate=function(s){return this.x+=s.width,this.y+=s.height,this},t.exports=a},function(t,n,i){var a=i(2),s=i(10),o=i(0),l=i(6),u=i(3),c=i(1),h=i(13),d=i(12),f=i(11);function p(v,g,y){a.call(this,y),this.estimatedSize=s.MIN_VALUE,this.margin=o.DEFAULT_GRAPH_MARGIN,this.edges=[],this.nodes=[],this.isConnected=!1,this.parent=v,g!=null&&g instanceof l?this.graphManager=g:g!=null&&g instanceof Layout&&(this.graphManager=g.graphManager)}p.prototype=Object.create(a.prototype);for(var m in a)p[m]=a[m];p.prototype.getNodes=function(){return this.nodes},p.prototype.getEdges=function(){return this.edges},p.prototype.getGraphManager=function(){return this.graphManager},p.prototype.getParent=function(){return this.parent},p.prototype.getLeft=function(){return this.left},p.prototype.getRight=function(){return this.right},p.prototype.getTop=function(){return this.top},p.prototype.getBottom=function(){return this.bottom},p.prototype.isConnected=function(){return this.isConnected},p.prototype.add=function(v,g,y){if(g==null&&y==null){var _=v;if(this.graphManager==null)throw"Graph has no graph mgr!";if(this.getNodes().indexOf(_)>-1)throw"Node already in graph!";return _.owner=this,this.getNodes().push(_),_}else{var x=v;if(!(this.getNodes().indexOf(g)>-1&&this.getNodes().indexOf(y)>-1))throw"Source or target not in graph!";if(!(g.owner==y.owner&&g.owner==this))throw"Both owners must be this graph!";return g.owner!=y.owner?null:(x.source=g,x.target=y,x.isInterGraph=!1,this.getEdges().push(x),g.edges.push(x),y!=g&&y.edges.push(x),x)}},p.prototype.remove=function(v){var g=v;if(v instanceof u){if(g==null)throw"Node is null!";if(!(g.owner!=null&&g.owner==this))throw"Owner graph is invalid!";if(this.graphManager==null)throw"Owner graph manager is invalid!";for(var y=g.edges.slice(),_,x=y.length,E=0;E<x;E++)_=y[E],_.isInterGraph?this.graphManager.remove(_):_.source.owner.remove(_);var T=this.nodes.indexOf(g);if(T==-1)throw"Node not in owner node list!";this.nodes.splice(T,1)}else if(v instanceof c){var _=v;if(_==null)throw"Edge is null!";if(!(_.source!=null&&_.target!=null))throw"Source and/or target is null!";if(!(_.source.owner!=null&&_.target.owner!=null&&_.source.owner==this&&_.target.owner==this))throw"Source and/or target owner is invalid!";var b=_.source.edges.indexOf(_),w=_.target.edges.indexOf(_);if(!(b>-1&&w>-1))throw"Source and/or target doesn't know this edge!";_.source.edges.splice(b,1),_.target!=_.source&&_.target.edges.splice(w,1);var T=_.source.owner.getEdges().indexOf(_);if(T==-1)throw"Not in owner's edge list!";_.source.owner.getEdges().splice(T,1)}},p.prototype.updateLeftTop=function(){for(var v=s.MAX_VALUE,g=s.MAX_VALUE,y,_,x,E=this.getNodes(),T=E.length,b=0;b<T;b++){var w=E[b];y=w.getTop(),_=w.getLeft(),v>y&&(v=y),g>_&&(g=_)}return v==s.MAX_VALUE?null:(E[0].getParent().paddingLeft!=null?x=E[0].getParent().paddingLeft:x=this.margin,this.left=g-x,this.top=v-x,new d(this.left,this.top))},p.prototype.updateBounds=function(v){for(var g=s.MAX_VALUE,y=-s.MAX_VALUE,_=s.MAX_VALUE,x=-s.MAX_VALUE,E,T,b,w,A,S=this.nodes,C=S.length,R=0;R<C;R++){var P=S[R];v&&P.child!=null&&P.updateBounds(),E=P.getLeft(),T=P.getRight(),b=P.getTop(),w=P.getBottom(),g>E&&(g=E),y<T&&(y=T),_>b&&(_=b),x<w&&(x=w)}var M=new h(g,_,y-g,x-_);g==s.MAX_VALUE&&(this.left=this.parent.getLeft(),this.right=this.parent.getRight(),this.top=this.parent.getTop(),this.bottom=this.parent.getBottom()),S[0].getParent().paddingLeft!=null?A=S[0].getParent().paddingLeft:A=this.margin,this.left=M.x-A,this.right=M.x+M.width+A,this.top=M.y-A,this.bottom=M.y+M.height+A},p.calculateBounds=function(v){for(var g=s.MAX_VALUE,y=-s.MAX_VALUE,_=s.MAX_VALUE,x=-s.MAX_VALUE,E,T,b,w,A=v.length,S=0;S<A;S++){var C=v[S];E=C.getLeft(),T=C.getRight(),b=C.getTop(),w=C.getBottom(),g>E&&(g=E),y<T&&(y=T),_>b&&(_=b),x<w&&(x=w)}var R=new h(g,_,y-g,x-_);return R},p.prototype.getInclusionTreeDepth=function(){return this==this.graphManager.getRoot()?1:this.parent.getInclusionTreeDepth()},p.prototype.getEstimatedSize=function(){if(this.estimatedSize==s.MIN_VALUE)throw"assert failed";return this.estimatedSize},p.prototype.calcEstimatedSize=function(){for(var v=0,g=this.nodes,y=g.length,_=0;_<y;_++){var x=g[_];v+=x.calcEstimatedSize()}return v==0?this.estimatedSize=o.EMPTY_COMPOUND_NODE_SIZE:this.estimatedSize=v/Math.sqrt(this.nodes.length),this.estimatedSize},p.prototype.updateConnected=function(){var v=this;if(this.nodes.length==0){this.isConnected=!0;return}var g=new f,y=new Set,_=this.nodes[0],x,E,T=_.withChildren();for(T.forEach(function(R){g.push(R),y.add(R)});g.length!==0;){_=g.shift(),x=_.getEdges();for(var b=x.length,w=0;w<b;w++){var A=x[w];if(E=A.getOtherEndInGraph(_,this),E!=null&&!y.has(E)){var S=E.withChildren();S.forEach(function(R){g.push(R),y.add(R)})}}}if(this.isConnected=!1,y.size>=this.nodes.length){var C=0;y.forEach(function(R){R.owner==v&&C++}),C==this.nodes.length&&(this.isConnected=!0)}},t.exports=p},function(t,n,i){var a,s=i(1);function o(l){a=i(5),this.layout=l,this.graphs=[],this.edges=[]}o.prototype.addRoot=function(){var l=this.layout.newGraph(),u=this.layout.newNode(null),c=this.add(l,u);return this.setRootGraph(c),this.rootGraph},o.prototype.add=function(l,u,c,h,d){if(c==null&&h==null&&d==null){if(l==null)throw"Graph is null!";if(u==null)throw"Parent node is null!";if(this.graphs.indexOf(l)>-1)throw"Graph already in this graph mgr!";if(this.graphs.push(l),l.parent!=null)throw"Already has a parent!";if(u.child!=null)throw"Already has a child!";return l.parent=u,u.child=l,l}else{d=c,h=u,c=l;var f=h.getOwner(),p=d.getOwner();if(!(f!=null&&f.getGraphManager()==this))throw"Source not in this graph mgr!";if(!(p!=null&&p.getGraphManager()==this))throw"Target not in this graph mgr!";if(f==p)return c.isInterGraph=!1,f.add(c,h,d);if(c.isInterGraph=!0,c.source=h,c.target=d,this.edges.indexOf(c)>-1)throw"Edge already in inter-graph edge list!";if(this.edges.push(c),!(c.source!=null&&c.target!=null))throw"Edge source and/or target is null!";if(!(c.source.edges.indexOf(c)==-1&&c.target.edges.indexOf(c)==-1))throw"Edge already in source and/or target incidency list!";return c.source.edges.push(c),c.target.edges.push(c),c}},o.prototype.remove=function(l){if(l instanceof a){var u=l;if(u.getGraphManager()!=this)throw"Graph not in this graph mgr";if(!(u==this.rootGraph||u.parent!=null&&u.parent.graphManager==this))throw"Invalid parent node!";var c=[];c=c.concat(u.getEdges());for(var h,d=c.length,f=0;f<d;f++)h=c[f],u.remove(h);var p=[];p=p.concat(u.getNodes());var m;d=p.length;for(var f=0;f<d;f++)m=p[f],u.remove(m);u==this.rootGraph&&this.setRootGraph(null);var v=this.graphs.indexOf(u);this.graphs.splice(v,1),u.parent=null}else if(l instanceof s){if(h=l,h==null)throw"Edge is null!";if(!h.isInterGraph)throw"Not an inter-graph edge!";if(!(h.source!=null&&h.target!=null))throw"Source and/or target is null!";if(!(h.source.edges.indexOf(h)!=-1&&h.target.edges.indexOf(h)!=-1))throw"Source and/or target doesn't know this edge!";var v=h.source.edges.indexOf(h);if(h.source.edges.splice(v,1),v=h.target.edges.indexOf(h),h.target.edges.splice(v,1),!(h.source.owner!=null&&h.source.owner.getGraphManager()!=null))throw"Edge owner graph or owner graph manager is null!";if(h.source.owner.getGraphManager().edges.indexOf(h)==-1)throw"Not in owner graph manager's edge list!";var v=h.source.owner.getGraphManager().edges.indexOf(h);h.source.owner.getGraphManager().edges.splice(v,1)}},o.prototype.updateBounds=function(){this.rootGraph.updateBounds(!0)},o.prototype.getGraphs=function(){return this.graphs},o.prototype.getAllNodes=function(){if(this.allNodes==null){for(var l=[],u=this.getGraphs(),c=u.length,h=0;h<c;h++)l=l.concat(u[h].getNodes());this.allNodes=l}return this.allNodes},o.prototype.resetAllNodes=function(){this.allNodes=null},o.prototype.resetAllEdges=function(){this.allEdges=null},o.prototype.resetAllNodesToApplyGravitation=function(){this.allNodesToApplyGravitation=null},o.prototype.getAllEdges=function(){if(this.allEdges==null){var l=[],u=this.getGraphs();u.length;for(var c=0;c<u.length;c++)l=l.concat(u[c].getEdges());l=l.concat(this.edges),this.allEdges=l}return this.allEdges},o.prototype.getAllNodesToApplyGravitation=function(){return this.allNodesToApplyGravitation},o.prototype.setAllNodesToApplyGravitation=function(l){if(this.allNodesToApplyGravitation!=null)throw"assert failed";this.allNodesToApplyGravitation=l},o.prototype.getRoot=function(){return this.rootGraph},o.prototype.setRootGraph=function(l){if(l.getGraphManager()!=this)throw"Root not in this graph mgr!";this.rootGraph=l,l.parent==null&&(l.parent=this.layout.newNode("Root node"))},o.prototype.getLayout=function(){return this.layout},o.prototype.isOneAncestorOfOther=function(l,u){if(!(l!=null&&u!=null))throw"assert failed";if(l==u)return!0;var c=l.getOwner(),h;do{if(h=c.getParent(),h==null)break;if(h==u)return!0;if(c=h.getOwner(),c==null)break}while(!0);c=u.getOwner();do{if(h=c.getParent(),h==null)break;if(h==l)return!0;if(c=h.getOwner(),c==null)break}while(!0);return!1},o.prototype.calcLowestCommonAncestors=function(){for(var l,u,c,h,d,f=this.getAllEdges(),p=f.length,m=0;m<p;m++){if(l=f[m],u=l.source,c=l.target,l.lca=null,l.sourceInLca=u,l.targetInLca=c,u==c){l.lca=u.getOwner();continue}for(h=u.getOwner();l.lca==null;){for(l.targetInLca=c,d=c.getOwner();l.lca==null;){if(d==h){l.lca=d;break}if(d==this.rootGraph)break;if(l.lca!=null)throw"assert failed";l.targetInLca=d.getParent(),d=l.targetInLca.getOwner()}if(h==this.rootGraph)break;l.lca==null&&(l.sourceInLca=h.getParent(),h=l.sourceInLca.getOwner())}if(l.lca==null)throw"assert failed"}},o.prototype.calcLowestCommonAncestor=function(l,u){if(l==u)return l.getOwner();var c=l.getOwner();do{if(c==null)break;var h=u.getOwner();do{if(h==null)break;if(h==c)return h;h=h.getParent().getOwner()}while(!0);c=c.getParent().getOwner()}while(!0);return c},o.prototype.calcInclusionTreeDepths=function(l,u){l==null&&u==null&&(l=this.rootGraph,u=1);for(var c,h=l.getNodes(),d=h.length,f=0;f<d;f++)c=h[f],c.inclusionTreeDepth=u,c.child!=null&&this.calcInclusionTreeDepths(c.child,u+1)},o.prototype.includesInvalidEdge=function(){for(var l,u=this.edges.length,c=0;c<u;c++)if(l=this.edges[c],this.isOneAncestorOfOther(l.source,l.target))return!0;return!1},t.exports=o},function(t,n,i){var a=i(0);function s(){}for(var o in a)s[o]=a[o];s.MAX_ITERATIONS=2500,s.DEFAULT_EDGE_LENGTH=50,s.DEFAULT_SPRING_STRENGTH=.45,s.DEFAULT_REPULSION_STRENGTH=4500,s.DEFAULT_GRAVITY_STRENGTH=.4,s.DEFAULT_COMPOUND_GRAVITY_STRENGTH=1,s.DEFAULT_GRAVITY_RANGE_FACTOR=3.8,s.DEFAULT_COMPOUND_GRAVITY_RANGE_FACTOR=1.5,s.DEFAULT_USE_SMART_IDEAL_EDGE_LENGTH_CALCULATION=!0,s.DEFAULT_USE_SMART_REPULSION_RANGE_CALCULATION=!0,s.DEFAULT_COOLING_FACTOR_INCREMENTAL=.3,s.COOLING_ADAPTATION_FACTOR=.33,s.ADAPTATION_LOWER_NODE_LIMIT=1e3,s.ADAPTATION_UPPER_NODE_LIMIT=5e3,s.MAX_NODE_DISPLACEMENT_INCREMENTAL=100,s.MAX_NODE_DISPLACEMENT=s.MAX_NODE_DISPLACEMENT_INCREMENTAL*3,s.MIN_REPULSION_DIST=s.DEFAULT_EDGE_LENGTH/10,s.CONVERGENCE_CHECK_PERIOD=100,s.PER_LEVEL_IDEAL_EDGE_LENGTH_FACTOR=.1,s.MIN_EDGE_LENGTH=1,s.GRID_CALCULATION_CHECK_PERIOD=10,t.exports=s},function(t,n,i){var a=i(12);function s(){}s.calcSeparationAmount=function(o,l,u,c){if(!o.intersects(l))throw"assert failed";var h=new Array(2);this.decideDirectionsForOverlappingNodes(o,l,h),u[0]=Math.min(o.getRight(),l.getRight())-Math.max(o.x,l.x),u[1]=Math.min(o.getBottom(),l.getBottom())-Math.max(o.y,l.y),o.getX()<=l.getX()&&o.getRight()>=l.getRight()?u[0]+=Math.min(l.getX()-o.getX(),o.getRight()-l.getRight()):l.getX()<=o.getX()&&l.getRight()>=o.getRight()&&(u[0]+=Math.min(o.getX()-l.getX(),l.getRight()-o.getRight())),o.getY()<=l.getY()&&o.getBottom()>=l.getBottom()?u[1]+=Math.min(l.getY()-o.getY(),o.getBottom()-l.getBottom()):l.getY()<=o.getY()&&l.getBottom()>=o.getBottom()&&(u[1]+=Math.min(o.getY()-l.getY(),l.getBottom()-o.getBottom()));var d=Math.abs((l.getCenterY()-o.getCenterY())/(l.getCenterX()-o.getCenterX()));l.getCenterY()===o.getCenterY()&&l.getCenterX()===o.getCenterX()&&(d=1);var f=d*u[0],p=u[1]/d;u[0]<p?p=u[0]:f=u[1],u[0]=-1*h[0]*(p/2+c),u[1]=-1*h[1]*(f/2+c)},s.decideDirectionsForOverlappingNodes=function(o,l,u){o.getCenterX()<l.getCenterX()?u[0]=-1:u[0]=1,o.getCenterY()<l.getCenterY()?u[1]=-1:u[1]=1},s.getIntersection2=function(o,l,u){var c=o.getCenterX(),h=o.getCenterY(),d=l.getCenterX(),f=l.getCenterY();if(o.intersects(l))return u[0]=c,u[1]=h,u[2]=d,u[3]=f,!0;var p=o.getX(),m=o.getY(),v=o.getRight(),g=o.getX(),y=o.getBottom(),_=o.getRight(),x=o.getWidthHalf(),E=o.getHeightHalf(),T=l.getX(),b=l.getY(),w=l.getRight(),A=l.getX(),S=l.getBottom(),C=l.getRight(),R=l.getWidthHalf(),P=l.getHeightHalf(),M=!1,N=!1;if(c===d){if(h>f)return u[0]=c,u[1]=m,u[2]=d,u[3]=S,!1;if(h<f)return u[0]=c,u[1]=y,u[2]=d,u[3]=b,!1}else if(h===f){if(c>d)return u[0]=p,u[1]=h,u[2]=w,u[3]=f,!1;if(c<d)return u[0]=v,u[1]=h,u[2]=T,u[3]=f,!1}else{var D=o.height/o.width,I=l.height/l.width,L=(f-h)/(d-c),z=void 0,B=void 0,k=void 0,U=void 0,G=void 0,O=void 0;if(-D===L?c>d?(u[0]=g,u[1]=y,M=!0):(u[0]=v,u[1]=m,M=!0):D===L&&(c>d?(u[0]=p,u[1]=m,M=!0):(u[0]=_,u[1]=y,M=!0)),-I===L?d>c?(u[2]=A,u[3]=S,N=!0):(u[2]=w,u[3]=b,N=!0):I===L&&(d>c?(u[2]=T,u[3]=b,N=!0):(u[2]=C,u[3]=S,N=!0)),M&&N)return!1;if(c>d?h>f?(z=this.getCardinalDirection(D,L,4),B=this.getCardinalDirection(I,L,2)):(z=this.getCardinalDirection(-D,L,3),B=this.getCardinalDirection(-I,L,1)):h>f?(z=this.getCardinalDirection(-D,L,1),B=this.getCardinalDirection(-I,L,3)):(z=this.getCardinalDirection(D,L,2),B=this.getCardinalDirection(I,L,4)),!M)switch(z){case 1:U=m,k=c+-E/L,u[0]=k,u[1]=U;break;case 2:k=_,U=h+x*L,u[0]=k,u[1]=U;break;case 3:U=y,k=c+E/L,u[0]=k,u[1]=U;break;case 4:k=g,U=h+-x*L,u[0]=k,u[1]=U;break}if(!N)switch(B){case 1:O=b,G=d+-P/L,u[2]=G,u[3]=O;break;case 2:G=C,O=f+R*L,u[2]=G,u[3]=O;break;case 3:O=S,G=d+P/L,u[2]=G,u[3]=O;break;case 4:G=A,O=f+-R*L,u[2]=G,u[3]=O;break}}return!1},s.getCardinalDirection=function(o,l,u){return o>l?u:1+u%4},s.getIntersection=function(o,l,u,c){if(c==null)return this.getIntersection2(o,l,u);var h=o.x,d=o.y,f=l.x,p=l.y,m=u.x,v=u.y,g=c.x,y=c.y,_=void 0,x=void 0,E=void 0,T=void 0,b=void 0,w=void 0,A=void 0,S=void 0,C=void 0;return E=p-d,b=h-f,A=f*d-h*p,T=y-v,w=m-g,S=g*v-m*y,C=E*w-T*b,C===0?null:(_=(b*S-w*A)/C,x=(T*A-E*S)/C,new a(_,x))},s.angleOfVector=function(o,l,u,c){var h=void 0;return o!==u?(h=Math.atan((c-l)/(u-o)),u<o?h+=Math.PI:c<l&&(h+=this.TWO_PI)):c<l?h=this.ONE_AND_HALF_PI:h=this.HALF_PI,h},s.doIntersect=function(o,l,u,c){var h=o.x,d=o.y,f=l.x,p=l.y,m=u.x,v=u.y,g=c.x,y=c.y,_=(f-h)*(y-v)-(g-m)*(p-d);if(_===0)return!1;var x=((y-v)*(g-h)+(m-g)*(y-d))/_,E=((d-p)*(g-h)+(f-h)*(y-d))/_;return 0<x&&x<1&&0<E&&E<1},s.HALF_PI=.5*Math.PI,s.ONE_AND_HALF_PI=1.5*Math.PI,s.TWO_PI=2*Math.PI,s.THREE_PI=3*Math.PI,t.exports=s},function(t,n,i){function a(){}a.sign=function(s){return s>0?1:s<0?-1:0},a.floor=function(s){return s<0?Math.ceil(s):Math.floor(s)},a.ceil=function(s){return s<0?Math.floor(s):Math.ceil(s)},t.exports=a},function(t,n,i){function a(){}a.MAX_VALUE=2147483647,a.MIN_VALUE=-2147483648,t.exports=a},function(t,n,i){var a=function(){function h(d,f){for(var p=0;p<f.length;p++){var m=f[p];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(d,m.key,m)}}return function(d,f,p){return f&&h(d.prototype,f),p&&h(d,p),d}}();function s(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")}var o=function(d){return{value:d,next:null,prev:null}},l=function(d,f,p,m){return d!==null?d.next=f:m.head=f,p!==null?p.prev=f:m.tail=f,f.prev=d,f.next=p,m.length++,f},u=function(d,f){var p=d.prev,m=d.next;return p!==null?p.next=m:f.head=m,m!==null?m.prev=p:f.tail=p,d.prev=d.next=null,f.length--,d},c=function(){function h(d){var f=this;s(this,h),this.length=0,this.head=null,this.tail=null,d!=null&&d.forEach(function(p){return f.push(p)})}return a(h,[{key:"size",value:function(){return this.length}},{key:"insertBefore",value:function(f,p){return l(p.prev,o(f),p,this)}},{key:"insertAfter",value:function(f,p){return l(p,o(f),p.next,this)}},{key:"insertNodeBefore",value:function(f,p){return l(p.prev,f,p,this)}},{key:"insertNodeAfter",value:function(f,p){return l(p,f,p.next,this)}},{key:"push",value:function(f){return l(this.tail,o(f),null,this)}},{key:"unshift",value:function(f){return l(null,o(f),this.head,this)}},{key:"remove",value:function(f){return u(f,this)}},{key:"pop",value:function(){return u(this.tail,this).value}},{key:"popNode",value:function(){return u(this.tail,this)}},{key:"shift",value:function(){return u(this.head,this).value}},{key:"shiftNode",value:function(){return u(this.head,this)}},{key:"get_object_at",value:function(f){if(f<=this.length()){for(var p=1,m=this.head;p<f;)m=m.next,p++;return m.value}}},{key:"set_object_at",value:function(f,p){if(f<=this.length()){for(var m=1,v=this.head;m<f;)v=v.next,m++;v.value=p}}}]),h}();t.exports=c},function(t,n,i){function a(s,o,l){this.x=null,this.y=null,s==null&&o==null&&l==null?(this.x=0,this.y=0):typeof s=="number"&&typeof o=="number"&&l==null?(this.x=s,this.y=o):s.constructor.name=="Point"&&o==null&&l==null&&(l=s,this.x=l.x,this.y=l.y)}a.prototype.getX=function(){return this.x},a.prototype.getY=function(){return this.y},a.prototype.getLocation=function(){return new a(this.x,this.y)},a.prototype.setLocation=function(s,o,l){s.constructor.name=="Point"&&o==null&&l==null?(l=s,this.setLocation(l.x,l.y)):typeof s=="number"&&typeof o=="number"&&l==null&&(parseInt(s)==s&&parseInt(o)==o?this.move(s,o):(this.x=Math.floor(s+.5),this.y=Math.floor(o+.5)))},a.prototype.move=function(s,o){this.x=s,this.y=o},a.prototype.translate=function(s,o){this.x+=s,this.y+=o},a.prototype.equals=function(s){if(s.constructor.name=="Point"){var o=s;return this.x==o.x&&this.y==o.y}return this==s},a.prototype.toString=function(){return new a().constructor.name+"[x="+this.x+",y="+this.y+"]"},t.exports=a},function(t,n,i){function a(s,o,l,u){this.x=0,this.y=0,this.width=0,this.height=0,s!=null&&o!=null&&l!=null&&u!=null&&(this.x=s,this.y=o,this.width=l,this.height=u)}a.prototype.getX=function(){return this.x},a.prototype.setX=function(s){this.x=s},a.prototype.getY=function(){return this.y},a.prototype.setY=function(s){this.y=s},a.prototype.getWidth=function(){return this.width},a.prototype.setWidth=function(s){this.width=s},a.prototype.getHeight=function(){return this.height},a.prototype.setHeight=function(s){this.height=s},a.prototype.getRight=function(){return this.x+this.width},a.prototype.getBottom=function(){return this.y+this.height},a.prototype.intersects=function(s){return!(this.getRight()<s.x||this.getBottom()<s.y||s.getRight()<this.x||s.getBottom()<this.y)},a.prototype.getCenterX=function(){return this.x+this.width/2},a.prototype.getMinX=function(){return this.getX()},a.prototype.getMaxX=function(){return this.getX()+this.width},a.prototype.getCenterY=function(){return this.y+this.height/2},a.prototype.getMinY=function(){return this.getY()},a.prototype.getMaxY=function(){return this.getY()+this.height},a.prototype.getWidthHalf=function(){return this.width/2},a.prototype.getHeightHalf=function(){return this.height/2},t.exports=a},function(t,n,i){var a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o};function s(){}s.lastID=0,s.createID=function(o){return s.isPrimitive(o)?o:(o.uniqueID!=null||(o.uniqueID=s.getString(),s.lastID++),o.uniqueID)},s.getString=function(o){return o==null&&(o=s.lastID),"Object#"+o},s.isPrimitive=function(o){var l=typeof o>"u"?"undefined":a(o);return o==null||l!="object"&&l!="function"},t.exports=s},function(t,n,i){function a(m){if(Array.isArray(m)){for(var v=0,g=Array(m.length);v<m.length;v++)g[v]=m[v];return g}else return Array.from(m)}var s=i(0),o=i(6),l=i(3),u=i(1),c=i(5),h=i(4),d=i(17),f=i(27);function p(m){f.call(this),this.layoutQuality=s.QUALITY,this.createBendsAsNeeded=s.DEFAULT_CREATE_BENDS_AS_NEEDED,this.incremental=s.DEFAULT_INCREMENTAL,this.animationOnLayout=s.DEFAULT_ANIMATION_ON_LAYOUT,this.animationDuringLayout=s.DEFAULT_ANIMATION_DURING_LAYOUT,this.animationPeriod=s.DEFAULT_ANIMATION_PERIOD,this.uniformLeafNodeSizes=s.DEFAULT_UNIFORM_LEAF_NODE_SIZES,this.edgeToDummyNodes=new Map,this.graphManager=new o(this),this.isLayoutFinished=!1,this.isSubLayout=!1,this.isRemoteUse=!1,m!=null&&(this.isRemoteUse=m)}p.RANDOM_SEED=1,p.prototype=Object.create(f.prototype),p.prototype.getGraphManager=function(){return this.graphManager},p.prototype.getAllNodes=function(){return this.graphManager.getAllNodes()},p.prototype.getAllEdges=function(){return this.graphManager.getAllEdges()},p.prototype.getAllNodesToApplyGravitation=function(){return this.graphManager.getAllNodesToApplyGravitation()},p.prototype.newGraphManager=function(){var m=new o(this);return this.graphManager=m,m},p.prototype.newGraph=function(m){return new c(null,this.graphManager,m)},p.prototype.newNode=function(m){return new l(this.graphManager,m)},p.prototype.newEdge=function(m){return new u(null,null,m)},p.prototype.checkLayoutSuccess=function(){return this.graphManager.getRoot()==null||this.graphManager.getRoot().getNodes().length==0||this.graphManager.includesInvalidEdge()},p.prototype.runLayout=function(){this.isLayoutFinished=!1,this.tilingPreLayout&&this.tilingPreLayout(),this.initParameters();var m;return this.checkLayoutSuccess()?m=!1:m=this.layout(),s.ANIMATE==="during"?!1:(m&&(this.isSubLayout||this.doPostLayout()),this.tilingPostLayout&&this.tilingPostLayout(),this.isLayoutFinished=!0,m)},p.prototype.doPostLayout=function(){this.incremental||this.transform(),this.update()},p.prototype.update2=function(){if(this.createBendsAsNeeded&&(this.createBendpointsFromDummyNodes(),this.graphManager.resetAllEdges()),!this.isRemoteUse){for(var m=this.graphManager.getAllEdges(),v=0;v<m.length;v++)m[v];for(var g=this.graphManager.getRoot().getNodes(),v=0;v<g.length;v++)g[v];this.update(this.graphManager.getRoot())}},p.prototype.update=function(m){if(m==null)this.update2();else if(m instanceof l){var v=m;if(v.getChild()!=null)for(var g=v.getChild().getNodes(),y=0;y<g.length;y++)update(g[y]);if(v.vGraphObject!=null){var _=v.vGraphObject;_.update(v)}}else if(m instanceof u){var x=m;if(x.vGraphObject!=null){var E=x.vGraphObject;E.update(x)}}else if(m instanceof c){var T=m;if(T.vGraphObject!=null){var b=T.vGraphObject;b.update(T)}}},p.prototype.initParameters=function(){this.isSubLayout||(this.layoutQuality=s.QUALITY,this.animationDuringLayout=s.DEFAULT_ANIMATION_DURING_LAYOUT,this.animationPeriod=s.DEFAULT_ANIMATION_PERIOD,this.animationOnLayout=s.DEFAULT_ANIMATION_ON_LAYOUT,this.incremental=s.DEFAULT_INCREMENTAL,this.createBendsAsNeeded=s.DEFAULT_CREATE_BENDS_AS_NEEDED,this.uniformLeafNodeSizes=s.DEFAULT_UNIFORM_LEAF_NODE_SIZES),this.animationDuringLayout&&(this.animationOnLayout=!1)},p.prototype.transform=function(m){if(m==null)this.transform(new h(0,0));else{var v=new d,g=this.graphManager.getRoot().updateLeftTop();if(g!=null){v.setWorldOrgX(m.x),v.setWorldOrgY(m.y),v.setDeviceOrgX(g.x),v.setDeviceOrgY(g.y);for(var y=this.getAllNodes(),_,x=0;x<y.length;x++)_=y[x],_.transform(v)}}},p.prototype.positionNodesRandomly=function(m){if(m==null)this.positionNodesRandomly(this.getGraphManager().getRoot()),this.getGraphManager().getRoot().updateBounds(!0);else for(var v,g,y=m.getNodes(),_=0;_<y.length;_++)v=y[_],g=v.getChild(),g==null||g.getNodes().length==0?v.scatter():(this.positionNodesRandomly(g),v.updateBounds())},p.prototype.getFlatForest=function(){for(var m=[],v=!0,g=this.graphManager.getRoot().getNodes(),y=!0,_=0;_<g.length;_++)g[_].getChild()!=null&&(y=!1);if(!y)return m;var x=new Set,E=[],T=new Map,b=[];for(b=b.concat(g);b.length>0&&v;){for(E.push(b[0]);E.length>0&&v;){var w=E[0];E.splice(0,1),x.add(w);for(var A=w.getEdges(),_=0;_<A.length;_++){var S=A[_].getOtherEnd(w);if(T.get(w)!=S)if(!x.has(S))E.push(S),T.set(S,w);else{v=!1;break}}}if(!v)m=[];else{var C=[].concat(a(x));m.push(C);for(var _=0;_<C.length;_++){var R=C[_],P=b.indexOf(R);P>-1&&b.splice(P,1)}x=new Set,T=new Map}}return m},p.prototype.createDummyNodesForBendpoints=function(m){for(var v=[],g=m.source,y=this.graphManager.calcLowestCommonAncestor(m.source,m.target),_=0;_<m.bendpoints.length;_++){var x=this.newNode(null);x.setRect(new Point(0,0),new Dimension(1,1)),y.add(x);var E=this.newEdge(null);this.graphManager.add(E,g,x),v.add(x),g=x}var E=this.newEdge(null);return this.graphManager.add(E,g,m.target),this.edgeToDummyNodes.set(m,v),m.isInterGraph()?this.graphManager.remove(m):y.remove(m),v},p.prototype.createBendpointsFromDummyNodes=function(){var m=[];m=m.concat(this.graphManager.getAllEdges()),m=[].concat(a(this.edgeToDummyNodes.keys())).concat(m);for(var v=0;v<m.length;v++){var g=m[v];if(g.bendpoints.length>0){for(var y=this.edgeToDummyNodes.get(g),_=0;_<y.length;_++){var x=y[_],E=new h(x.getCenterX(),x.getCenterY()),T=g.bendpoints.get(_);T.x=E.x,T.y=E.y,x.getOwner().remove(x)}this.graphManager.add(g,g.source,g.target)}}},p.transform=function(m,v,g,y){if(g!=null&&y!=null){var _=v;if(m<=50){var x=v/g;_-=(v-x)/50*(50-m)}else{var E=v*y;_+=(E-v)/50*(m-50)}return _}else{var T,b;return m<=50?(T=9*v/500,b=v/10):(T=9*v/50,b=-8*v),T*m+b}},p.findCenterOfTree=function(m){var v=[];v=v.concat(m);var g=[],y=new Map,_=!1,x=null;(v.length==1||v.length==2)&&(_=!0,x=v[0]);for(var E=0;E<v.length;E++){var T=v[E],b=T.getNeighborsList().size;y.set(T,T.getNeighborsList().size),b==1&&g.push(T)}var w=[];for(w=w.concat(g);!_;){var A=[];A=A.concat(w),w=[];for(var E=0;E<v.length;E++){var T=v[E],S=v.indexOf(T);S>=0&&v.splice(S,1);var C=T.getNeighborsList();C.forEach(function(M){if(g.indexOf(M)<0){var N=y.get(M),D=N-1;D==1&&w.push(M),y.set(M,D)}})}g=g.concat(w),(v.length==1||v.length==2)&&(_=!0,x=v[0])}return x},p.prototype.setGraphManager=function(m){this.graphManager=m},t.exports=p},function(t,n,i){function a(){}a.seed=1,a.x=0,a.nextDouble=function(){return a.x=Math.sin(a.seed++)*1e4,a.x-Math.floor(a.x)},t.exports=a},function(t,n,i){var a=i(4);function s(o,l){this.lworldOrgX=0,this.lworldOrgY=0,this.ldeviceOrgX=0,this.ldeviceOrgY=0,this.lworldExtX=1,this.lworldExtY=1,this.ldeviceExtX=1,this.ldeviceExtY=1}s.prototype.getWorldOrgX=function(){return this.lworldOrgX},s.prototype.setWorldOrgX=function(o){this.lworldOrgX=o},s.prototype.getWorldOrgY=function(){return this.lworldOrgY},s.prototype.setWorldOrgY=function(o){this.lworldOrgY=o},s.prototype.getWorldExtX=function(){return this.lworldExtX},s.prototype.setWorldExtX=function(o){this.lworldExtX=o},s.prototype.getWorldExtY=function(){return this.lworldExtY},s.prototype.setWorldExtY=function(o){this.lworldExtY=o},s.prototype.getDeviceOrgX=function(){return this.ldeviceOrgX},s.prototype.setDeviceOrgX=function(o){this.ldeviceOrgX=o},s.prototype.getDeviceOrgY=function(){return this.ldeviceOrgY},s.prototype.setDeviceOrgY=function(o){this.ldeviceOrgY=o},s.prototype.getDeviceExtX=function(){return this.ldeviceExtX},s.prototype.setDeviceExtX=function(o){this.ldeviceExtX=o},s.prototype.getDeviceExtY=function(){return this.ldeviceExtY},s.prototype.setDeviceExtY=function(o){this.ldeviceExtY=o},s.prototype.transformX=function(o){var l=0,u=this.lworldExtX;return u!=0&&(l=this.ldeviceOrgX+(o-this.lworldOrgX)*this.ldeviceExtX/u),l},s.prototype.transformY=function(o){var l=0,u=this.lworldExtY;return u!=0&&(l=this.ldeviceOrgY+(o-this.lworldOrgY)*this.ldeviceExtY/u),l},s.prototype.inverseTransformX=function(o){var l=0,u=this.ldeviceExtX;return u!=0&&(l=this.lworldOrgX+(o-this.ldeviceOrgX)*this.lworldExtX/u),l},s.prototype.inverseTransformY=function(o){var l=0,u=this.ldeviceExtY;return u!=0&&(l=this.lworldOrgY+(o-this.ldeviceOrgY)*this.lworldExtY/u),l},s.prototype.inverseTransformPoint=function(o){var l=new a(this.inverseTransformX(o.x),this.inverseTransformY(o.y));return l},t.exports=s},function(t,n,i){function a(f){if(Array.isArray(f)){for(var p=0,m=Array(f.length);p<f.length;p++)m[p]=f[p];return m}else return Array.from(f)}var s=i(15),o=i(7),l=i(0),u=i(8),c=i(9);function h(){s.call(this),this.useSmartIdealEdgeLengthCalculation=o.DEFAULT_USE_SMART_IDEAL_EDGE_LENGTH_CALCULATION,this.idealEdgeLength=o.DEFAULT_EDGE_LENGTH,this.springConstant=o.DEFAULT_SPRING_STRENGTH,this.repulsionConstant=o.DEFAULT_REPULSION_STRENGTH,this.gravityConstant=o.DEFAULT_GRAVITY_STRENGTH,this.compoundGravityConstant=o.DEFAULT_COMPOUND_GRAVITY_STRENGTH,this.gravityRangeFactor=o.DEFAULT_GRAVITY_RANGE_FACTOR,this.compoundGravityRangeFactor=o.DEFAULT_COMPOUND_GRAVITY_RANGE_FACTOR,this.displacementThresholdPerNode=3*o.DEFAULT_EDGE_LENGTH/100,this.coolingFactor=o.DEFAULT_COOLING_FACTOR_INCREMENTAL,this.initialCoolingFactor=o.DEFAULT_COOLING_FACTOR_INCREMENTAL,this.totalDisplacement=0,this.oldTotalDisplacement=0,this.maxIterations=o.MAX_ITERATIONS}h.prototype=Object.create(s.prototype);for(var d in s)h[d]=s[d];h.prototype.initParameters=function(){s.prototype.initParameters.call(this,arguments),this.totalIterations=0,this.notAnimatedIterations=0,this.useFRGridVariant=o.DEFAULT_USE_SMART_REPULSION_RANGE_CALCULATION,this.grid=[]},h.prototype.calcIdealEdgeLengths=function(){for(var f,p,m,v,g,y,_=this.getGraphManager().getAllEdges(),x=0;x<_.length;x++)f=_[x],f.idealLength=this.idealEdgeLength,f.isInterGraph&&(m=f.getSource(),v=f.getTarget(),g=f.getSourceInLca().getEstimatedSize(),y=f.getTargetInLca().getEstimatedSize(),this.useSmartIdealEdgeLengthCalculation&&(f.idealLength+=g+y-2*l.SIMPLE_NODE_SIZE),p=f.getLca().getInclusionTreeDepth(),f.idealLength+=o.DEFAULT_EDGE_LENGTH*o.PER_LEVEL_IDEAL_EDGE_LENGTH_FACTOR*(m.getInclusionTreeDepth()+v.getInclusionTreeDepth()-2*p))},h.prototype.initSpringEmbedder=function(){var f=this.getAllNodes().length;this.incremental?(f>o.ADAPTATION_LOWER_NODE_LIMIT&&(this.coolingFactor=Math.max(this.coolingFactor*o.COOLING_ADAPTATION_FACTOR,this.coolingFactor-(f-o.ADAPTATION_LOWER_NODE_LIMIT)/(o.ADAPTATION_UPPER_NODE_LIMIT-o.ADAPTATION_LOWER_NODE_LIMIT)*this.coolingFactor*(1-o.COOLING_ADAPTATION_FACTOR))),this.maxNodeDisplacement=o.MAX_NODE_DISPLACEMENT_INCREMENTAL):(f>o.ADAPTATION_LOWER_NODE_LIMIT?this.coolingFactor=Math.max(o.COOLING_ADAPTATION_FACTOR,1-(f-o.ADAPTATION_LOWER_NODE_LIMIT)/(o.ADAPTATION_UPPER_NODE_LIMIT-o.ADAPTATION_LOWER_NODE_LIMIT)*(1-o.COOLING_ADAPTATION_FACTOR)):this.coolingFactor=1,this.initialCoolingFactor=this.coolingFactor,this.maxNodeDisplacement=o.MAX_NODE_DISPLACEMENT),this.maxIterations=Math.max(this.getAllNodes().length*5,this.maxIterations),this.totalDisplacementThreshold=this.displacementThresholdPerNode*this.getAllNodes().length,this.repulsionRange=this.calcRepulsionRange()},h.prototype.calcSpringForces=function(){for(var f=this.getAllEdges(),p,m=0;m<f.length;m++)p=f[m],this.calcSpringForce(p,p.idealLength)},h.prototype.calcRepulsionForces=function(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,m,v,g,y,_=this.getAllNodes(),x;if(this.useFRGridVariant)for(this.totalIterations%o.GRID_CALCULATION_CHECK_PERIOD==1&&f&&this.updateGrid(),x=new Set,m=0;m<_.length;m++)g=_[m],this.calculateRepulsionForceOfANode(g,x,f,p),x.add(g);else for(m=0;m<_.length;m++)for(g=_[m],v=m+1;v<_.length;v++)y=_[v],g.getOwner()==y.getOwner()&&this.calcRepulsionForce(g,y)},h.prototype.calcGravitationalForces=function(){for(var f,p=this.getAllNodesToApplyGravitation(),m=0;m<p.length;m++)f=p[m],this.calcGravitationalForce(f)},h.prototype.moveNodes=function(){for(var f=this.getAllNodes(),p,m=0;m<f.length;m++)p=f[m],p.move()},h.prototype.calcSpringForce=function(f,p){var m=f.getSource(),v=f.getTarget(),g,y,_,x;if(this.uniformLeafNodeSizes&&m.getChild()==null&&v.getChild()==null)f.updateLengthSimple();else if(f.updateLength(),f.isOverlapingSourceAndTarget)return;g=f.getLength(),g!=0&&(y=this.springConstant*(g-p),_=y*(f.lengthX/g),x=y*(f.lengthY/g),m.springForceX+=_,m.springForceY+=x,v.springForceX-=_,v.springForceY-=x)},h.prototype.calcRepulsionForce=function(f,p){var m=f.getRect(),v=p.getRect(),g=new Array(2),y=new Array(4),_,x,E,T,b,w,A;if(m.intersects(v)){u.calcSeparationAmount(m,v,g,o.DEFAULT_EDGE_LENGTH/2),w=2*g[0],A=2*g[1];var S=f.noOfChildren*p.noOfChildren/(f.noOfChildren+p.noOfChildren);f.repulsionForceX-=S*w,f.repulsionForceY-=S*A,p.repulsionForceX+=S*w,p.repulsionForceY+=S*A}else this.uniformLeafNodeSizes&&f.getChild()==null&&p.getChild()==null?(_=v.getCenterX()-m.getCenterX(),x=v.getCenterY()-m.getCenterY()):(u.getIntersection(m,v,y),_=y[2]-y[0],x=y[3]-y[1]),Math.abs(_)<o.MIN_REPULSION_DIST&&(_=c.sign(_)*o.MIN_REPULSION_DIST),Math.abs(x)<o.MIN_REPULSION_DIST&&(x=c.sign(x)*o.MIN_REPULSION_DIST),E=_*_+x*x,T=Math.sqrt(E),b=this.repulsionConstant*f.noOfChildren*p.noOfChildren/E,w=b*_/T,A=b*x/T,f.repulsionForceX-=w,f.repulsionForceY-=A,p.repulsionForceX+=w,p.repulsionForceY+=A},h.prototype.calcGravitationalForce=function(f){var p,m,v,g,y,_,x,E;p=f.getOwner(),m=(p.getRight()+p.getLeft())/2,v=(p.getTop()+p.getBottom())/2,g=f.getCenterX()-m,y=f.getCenterY()-v,_=Math.abs(g)+f.getWidth()/2,x=Math.abs(y)+f.getHeight()/2,f.getOwner()==this.graphManager.getRoot()?(E=p.getEstimatedSize()*this.gravityRangeFactor,(_>E||x>E)&&(f.gravitationForceX=-this.gravityConstant*g,f.gravitationForceY=-this.gravityConstant*y)):(E=p.getEstimatedSize()*this.compoundGravityRangeFactor,(_>E||x>E)&&(f.gravitationForceX=-this.gravityConstant*g*this.compoundGravityConstant,f.gravitationForceY=-this.gravityConstant*y*this.compoundGravityConstant))},h.prototype.isConverged=function(){var f,p=!1;return this.totalIterations>this.maxIterations/3&&(p=Math.abs(this.totalDisplacement-this.oldTotalDisplacement)<2),f=this.totalDisplacement<this.totalDisplacementThreshold,this.oldTotalDisplacement=this.totalDisplacement,f||p},h.prototype.animate=function(){this.animationDuringLayout&&!this.isSubLayout&&(this.notAnimatedIterations==this.animationPeriod?(this.update(),this.notAnimatedIterations=0):this.notAnimatedIterations++)},h.prototype.calcNoOfChildrenForAllNodes=function(){for(var f,p=this.graphManager.getAllNodes(),m=0;m<p.length;m++)f=p[m],f.noOfChildren=f.getNoOfChildren()},h.prototype.calcGrid=function(f){var p=0,m=0;p=parseInt(Math.ceil((f.getRight()-f.getLeft())/this.repulsionRange)),m=parseInt(Math.ceil((f.getBottom()-f.getTop())/this.repulsionRange));for(var v=new Array(p),g=0;g<p;g++)v[g]=new Array(m);for(var g=0;g<p;g++)for(var y=0;y<m;y++)v[g][y]=new Array;return v},h.prototype.addNodeToGrid=function(f,p,m){var v=0,g=0,y=0,_=0;v=parseInt(Math.floor((f.getRect().x-p)/this.repulsionRange)),g=parseInt(Math.floor((f.getRect().width+f.getRect().x-p)/this.repulsionRange)),y=parseInt(Math.floor((f.getRect().y-m)/this.repulsionRange)),_=parseInt(Math.floor((f.getRect().height+f.getRect().y-m)/this.repulsionRange));for(var x=v;x<=g;x++)for(var E=y;E<=_;E++)this.grid[x][E].push(f),f.setGridCoordinates(v,g,y,_)},h.prototype.updateGrid=function(){var f,p,m=this.getAllNodes();for(this.grid=this.calcGrid(this.graphManager.getRoot()),f=0;f<m.length;f++)p=m[f],this.addNodeToGrid(p,this.graphManager.getRoot().getLeft(),this.graphManager.getRoot().getTop())},h.prototype.calculateRepulsionForceOfANode=function(f,p,m,v){if(this.totalIterations%o.GRID_CALCULATION_CHECK_PERIOD==1&&m||v){var g=new Set;f.surrounding=new Array;for(var y,_=this.grid,x=f.startX-1;x<f.finishX+2;x++)for(var E=f.startY-1;E<f.finishY+2;E++)if(!(x<0||E<0||x>=_.length||E>=_[0].length)){for(var T=0;T<_[x][E].length;T++)if(y=_[x][E][T],!(f.getOwner()!=y.getOwner()||f==y)&&!p.has(y)&&!g.has(y)){var b=Math.abs(f.getCenterX()-y.getCenterX())-(f.getWidth()/2+y.getWidth()/2),w=Math.abs(f.getCenterY()-y.getCenterY())-(f.getHeight()/2+y.getHeight()/2);b<=this.repulsionRange&&w<=this.repulsionRange&&g.add(y)}}f.surrounding=[].concat(a(g))}for(x=0;x<f.surrounding.length;x++)this.calcRepulsionForce(f,f.surrounding[x])},h.prototype.calcRepulsionRange=function(){return 0},t.exports=h},function(t,n,i){var a=i(1),s=i(7);function o(u,c,h){a.call(this,u,c,h),this.idealLength=s.DEFAULT_EDGE_LENGTH}o.prototype=Object.create(a.prototype);for(var l in a)o[l]=a[l];t.exports=o},function(t,n,i){var a=i(3);function s(l,u,c,h){a.call(this,l,u,c,h),this.springForceX=0,this.springForceY=0,this.repulsionForceX=0,this.repulsionForceY=0,this.gravitationForceX=0,this.gravitationForceY=0,this.displacementX=0,this.displacementY=0,this.startX=0,this.finishX=0,this.startY=0,this.finishY=0,this.surrounding=[]}s.prototype=Object.create(a.prototype);for(var o in a)s[o]=a[o];s.prototype.setGridCoordinates=function(l,u,c,h){this.startX=l,this.finishX=u,this.startY=c,this.finishY=h},t.exports=s},function(t,n,i){function a(s,o){this.width=0,this.height=0,s!==null&&o!==null&&(this.height=o,this.width=s)}a.prototype.getWidth=function(){return this.width},a.prototype.setWidth=function(s){this.width=s},a.prototype.getHeight=function(){return this.height},a.prototype.setHeight=function(s){this.height=s},t.exports=a},function(t,n,i){var a=i(14);function s(){this.map={},this.keys=[]}s.prototype.put=function(o,l){var u=a.createID(o);this.contains(u)||(this.map[u]=l,this.keys.push(o))},s.prototype.contains=function(o){return a.createID(o),this.map[o]!=null},s.prototype.get=function(o){var l=a.createID(o);return this.map[l]},s.prototype.keySet=function(){return this.keys},t.exports=s},function(t,n,i){var a=i(14);function s(){this.set={}}s.prototype.add=function(o){var l=a.createID(o);this.contains(l)||(this.set[l]=o)},s.prototype.remove=function(o){delete this.set[a.createID(o)]},s.prototype.clear=function(){this.set={}},s.prototype.contains=function(o){return this.set[a.createID(o)]==o},s.prototype.isEmpty=function(){return this.size()===0},s.prototype.size=function(){return Object.keys(this.set).length},s.prototype.addAllTo=function(o){for(var l=Object.keys(this.set),u=l.length,c=0;c<u;c++)o.push(this.set[l[c]])},s.prototype.size=function(){return Object.keys(this.set).length},s.prototype.addAll=function(o){for(var l=o.length,u=0;u<l;u++){var c=o[u];this.add(c)}},t.exports=s},function(t,n,i){var a=function(){function u(c,h){for(var d=0;d<h.length;d++){var f=h[d];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(c,f.key,f)}}return function(c,h,d){return h&&u(c.prototype,h),d&&u(c,d),c}}();function s(u,c){if(!(u instanceof c))throw new TypeError("Cannot call a class as a function")}var o=i(11),l=function(){function u(c,h){s(this,u),(h!==null||h!==void 0)&&(this.compareFunction=this._defaultCompareFunction);var d=void 0;c instanceof o?d=c.size():d=c.length,this._quicksort(c,0,d-1)}return a(u,[{key:"_quicksort",value:function(h,d,f){if(d<f){var p=this._partition(h,d,f);this._quicksort(h,d,p),this._quicksort(h,p+1,f)}}},{key:"_partition",value:function(h,d,f){for(var p=this._get(h,d),m=d,v=f;;){for(;this.compareFunction(p,this._get(h,v));)v--;for(;this.compareFunction(this._get(h,m),p);)m++;if(m<v)this._swap(h,m,v),m++,v--;else return v}}},{key:"_get",value:function(h,d){return h instanceof o?h.get_object_at(d):h[d]}},{key:"_set",value:function(h,d,f){h instanceof o?h.set_object_at(d,f):h[d]=f}},{key:"_swap",value:function(h,d,f){var p=this._get(h,d);this._set(h,d,this._get(h,f)),this._set(h,f,p)}},{key:"_defaultCompareFunction",value:function(h,d){return d>h}}]),u}();t.exports=l},function(t,n,i){var a=function(){function l(u,c){for(var h=0;h<c.length;h++){var d=c[h];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(u,d.key,d)}}return function(u,c,h){return c&&l(u.prototype,c),h&&l(u,h),u}}();function s(l,u){if(!(l instanceof u))throw new TypeError("Cannot call a class as a function")}var o=function(){function l(u,c){var h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:-1;s(this,l),this.sequence1=u,this.sequence2=c,this.match_score=h,this.mismatch_penalty=d,this.gap_penalty=f,this.iMax=u.length+1,this.jMax=c.length+1,this.grid=new Array(this.iMax);for(var p=0;p<this.iMax;p++){this.grid[p]=new Array(this.jMax);for(var m=0;m<this.jMax;m++)this.grid[p][m]=0}this.tracebackGrid=new Array(this.iMax);for(var v=0;v<this.iMax;v++){this.tracebackGrid[v]=new Array(this.jMax);for(var g=0;g<this.jMax;g++)this.tracebackGrid[v][g]=[null,null,null]}this.alignments=[],this.score=-1,this.computeGrids()}return a(l,[{key:"getScore",value:function(){return this.score}},{key:"getAlignments",value:function(){return this.alignments}},{key:"computeGrids",value:function(){for(var c=1;c<this.jMax;c++)this.grid[0][c]=this.grid[0][c-1]+this.gap_penalty,this.tracebackGrid[0][c]=[!1,!1,!0];for(var h=1;h<this.iMax;h++)this.grid[h][0]=this.grid[h-1][0]+this.gap_penalty,this.tracebackGrid[h][0]=[!1,!0,!1];for(var d=1;d<this.iMax;d++)for(var f=1;f<this.jMax;f++){var p=void 0;this.sequence1[d-1]===this.sequence2[f-1]?p=this.grid[d-1][f-1]+this.match_score:p=this.grid[d-1][f-1]+this.mismatch_penalty;var m=this.grid[d-1][f]+this.gap_penalty,v=this.grid[d][f-1]+this.gap_penalty,g=[p,m,v],y=this.arrayAllMaxIndexes(g);this.grid[d][f]=g[y[0]],this.tracebackGrid[d][f]=[y.includes(0),y.includes(1),y.includes(2)]}this.score=this.grid[this.iMax-1][this.jMax-1]}},{key:"alignmentTraceback",value:function(){var c=[];for(c.push({pos:[this.sequence1.length,this.sequence2.length],seq1:"",seq2:""});c[0];){var h=c[0],d=this.tracebackGrid[h.pos[0]][h.pos[1]];d[0]&&c.push({pos:[h.pos[0]-1,h.pos[1]-1],seq1:this.sequence1[h.pos[0]-1]+h.seq1,seq2:this.sequence2[h.pos[1]-1]+h.seq2}),d[1]&&c.push({pos:[h.pos[0]-1,h.pos[1]],seq1:this.sequence1[h.pos[0]-1]+h.seq1,seq2:"-"+h.seq2}),d[2]&&c.push({pos:[h.pos[0],h.pos[1]-1],seq1:"-"+h.seq1,seq2:this.sequence2[h.pos[1]-1]+h.seq2}),h.pos[0]===0&&h.pos[1]===0&&this.alignments.push({sequence1:h.seq1,sequence2:h.seq2}),c.shift()}return this.alignments}},{key:"getAllIndexes",value:function(c,h){for(var d=[],f=-1;(f=c.indexOf(h,f+1))!==-1;)d.push(f);return d}},{key:"arrayAllMaxIndexes",value:function(c){return this.getAllIndexes(c,Math.max.apply(null,c))}}]),l}();t.exports=o},function(t,n,i){var a=function(){};a.FDLayout=i(18),a.FDLayoutConstants=i(7),a.FDLayoutEdge=i(19),a.FDLayoutNode=i(20),a.DimensionD=i(21),a.HashMap=i(22),a.HashSet=i(23),a.IGeometry=i(8),a.IMath=i(9),a.Integer=i(10),a.Point=i(12),a.PointD=i(4),a.RandomSeed=i(16),a.RectangleD=i(13),a.Transform=i(17),a.UniqueIDGeneretor=i(14),a.Quicksort=i(24),a.LinkedList=i(11),a.LGraphObject=i(2),a.LGraph=i(5),a.LEdge=i(1),a.LGraphManager=i(6),a.LNode=i(3),a.Layout=i(15),a.LayoutConstants=i(0),a.NeedlemanWunsch=i(25),t.exports=a},function(t,n,i){function a(){this.listeners=[]}var s=a.prototype;s.addListener=function(o,l){this.listeners.push({event:o,callback:l})},s.removeListener=function(o,l){for(var u=this.listeners.length;u>=0;u--){var c=this.listeners[u];c.event===o&&c.callback===l&&this.listeners.splice(u,1)}},s.emit=function(o,l){for(var u=0;u<this.listeners.length;u++){var c=this.listeners[u];o===c.event&&c.callback(l)}},t.exports=a}])})}(g0)),g0.exports}var LN;function kY(){return LN||(LN=1,function(r,e){(function(n,i){r.exports=i(V3())})(Ui,function(t){return function(n){var i={};function a(s){if(i[s])return i[s].exports;var o=i[s]={i:s,l:!1,exports:{}};return n[s].call(o.exports,o,o.exports,a),o.l=!0,o.exports}return a.m=n,a.c=i,a.i=function(s){return s},a.d=function(s,o,l){a.o(s,o)||Object.defineProperty(s,o,{configurable:!1,enumerable:!0,get:l})},a.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return a.d(o,"a",o),o},a.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)},a.p="",a(a.s=6)}([function(n,i){n.exports=t},function(n,i,a){var s=a(0).LGraph;function o(u,c,h){s.call(this,u,c,h),this.inOrder=void 0,this.currentIndex=0,this.nodeSeparation=void 0,this.stack=[],this.perimeter=0,this.centerX=0,this.centerY=0,this.radius=0}o.prototype=Object.create(s.prototype);for(var l in s)o[l]=s[l];o.prototype.initOrdering=function(){this.inOrder=[]},o.prototype.getOrder=function(){return this.inOrder},o.prototype.getCenterX=function(){return this.centerX},o.prototype.getCenterY=function(){return this.centerY},o.prototype.getRadius=function(){return this.radius},o.prototype.getSize=function(){return this.getNodes().length},o.prototype.getTotalCrossingOfCircle=function(){var u=this,c=0;for(var h in u.inOrder){var d=h.getTotalCrossingOfEdges();if(d===-1)return-1;c+=d}return c/4},o.prototype.hasFinishedOrdering=function(){return this.currentIndex===this.getNodes().length},o.prototype.getNodeSeparation=function(){return this.nodeSeparation},o.prototype.setNodeSeparation=function(u){this.nodeSeparation=u},o.prototype.correctAngles=function(){var u=this;u.currentIndex=0,u.inOrder.forEach(function(c){return u.putInOrder(c)})},o.prototype.putInOrder=function(u){for(var c=this,h=c.getNodes(),d=!1,f=0;f<h.length;f++)if(h[f].id==u.id){d=!0;break}if(!d)throw"The node must be a member of LGraph";c.inOrder[c.currentIndex]=u,u.setIndex(c.currentIndex),c.currentIndex===0?u.setAngle(0):u.setAngle(c.inOrder[c.currentIndex-1].getAngle()+2*Math.PI*(u.getDiagonal()/2+c.nodeSeparation+c.inOrder[c.currentIndex-1].getDiagonal()/2)/c.perimeter),c.currentIndex++},o.prototype.findNodeToPlace=function(){var u=this,c=void 0;if(u.stack.length===0)c=u.findUnorderedSmallestDegreeNode();else{for(var h=!1;!h&&u.stack.length!==0;)c=u.stack.pop(),h=!c.isOrdered();h||(c=void 0)}if(c===void 0&&(c=u.findUnorderedSmallestDegreeNode()),c!==void 0)for(var d=c.getNeighborsSortedByDegree(),f=d.length-1;f>=0;f--){var p=d[f];p.isOrdered()||u.stack.push(p)}return c},o.prototype.calculateRadius=function(){var u=this,c=0;u.getNodes().forEach(function(d){return c+=Math.sqrt(d.getWidth()*d.getWidth()+d.getHeight()*d.getHeight())}),u.perimeter=c+u.getNodes().length*u.nodeSeparation;var h=u.perimeter/(2*Math.PI);u.getParent().setWidth(2*h),u.getParent().setHeight(2*h),u.getParent().setCenter(u.getParent().getWidth(),u.getParent().getHeight()),u.centerX=u.getParent().getCenterX(),u.centerY=u.getParent().getCenterY(),u.radius=u.getParent().getHeight()/2},o.prototype.calculateEdgeCrossingsOfNodes=function(){this.getNodes().forEach(function(u){return u.calculateTotalCrossing()})},o.prototype.loadOldIndicesOfNodes=function(){for(var u=this,c=0;c<this.inOrder.length;c++)u.inOrder[c].setIndex(c)},o.prototype.reOrderVertices=function(){var u=this;this.getNodes().forEach(function(c){return u.inOrder[c.getIndex()]=c})},o.prototype.findUnorderedSmallestDegreeNode=function(){var u=Number.MAX_SAFE_INTEGER,c=void 0;return this.getNodes().forEach(function(h){h.getDegree()<u&&!h.isOrdered()&&(u=h.getDegree(),c=h)}),c},n.exports=o},function(n,i,a){var s=a(0).LayoutConstants;function o(){}for(var l in s)o[l]=s[l];o.DEFAULT_NODE_SEPARATION=60,n.exports=o},function(n,i,a){var s=a(0).LEdge;function o(u,c,h){s.call(this,u,c,h)}o.prototype=Object.create(s.prototype);for(var l in s)o[l]=s[l];o.prototype.getOtherEnd=function(u){return s.prototype.getOtherEnd(u)},o.prototype.crossesWithEdge=function(u){var c=this,h=c.getSource().getIndex(),d=c.getTarget().getIndex(),f=u.getSource().getIndex(),p=u.getTarget().getIndex();if(h===-1||d===-1||f===-1||p===-1)return!1;var m=u.getSource().getCircDistWithTheNode(c.getSource()),v=u.getTarget().getCircDistWithTheNode(c.getSource()),g=c.getTarget().getCircDistWithTheNode(c.getSource());return g<Math.max(m,v)&&g>Math.min(m,v)&&v!==0&&m!==0},o.prototype.crossingWithEdge=function(u){var c=this,h=c.crossesWithEdge(u);return h?1:0},o.prototype.calculateTotalCrossingWithList=function(u){var c=this,h=0;return u.forEach(function(d){return h+=c.crossingWithEdge(d)}),h},n.exports=o},function(n,i,a){var s=a(0).LNode;a(0).Quicksort;function o(u,c,h,d){h!==void 0&&d!==void 0?s.call(this,u,c,h,d):s.call(this,u,c),this.angle=0,this.circleIndex=-1,this.totalCrossingOfEdges=-1,this.isCrossingNumberValid=!1}o.prototype=Object.create(s.prototype);for(var l in s)o[l]=s[l];o.prototype.getCircle=function(){return this.getOwner()},o.prototype.setIndex=function(u){this.circleIndex=u,this.isCrossingNumberValid=!1},o.prototype.getIndex=function(){return this.circleIndex},o.prototype.getNeighborsSortedByDegree=function(){var u=this,c=Array.from(u.getNeighborsList());return c=c.filter(function(h){return h.getIndex()===-1}),c.sort(function(h,d){return h.getDegree()-d.getDegree()}),c},o.prototype.getDegree=function(){return this.getEdges().length},o.prototype.isOrdered=function(){return this.getIndex()>-1},o.prototype.setAngle=function(u){this.angle=u},o.prototype.getAngle=function(){return this.angle},o.prototype.getCircDistWithTheNode=function(u){var c=this,h=u.getIndex();if(h===-1||c.getIndex()===-1)return-1;var d=c.getIndex()-h;return d<0&&(d+=c.getCircle().getSize()),d},o.prototype.getCrossingNumberWithNode=function(u){var c=this,h=0;return c.getEdges().forEach(function(d){u.getEdges().forEach(function(f){h+=d.crossingWithEdge(f)})}),h},o.prototype.getTotalCrossingOfEdges=function(){var u=this;return u.isCrossingNumberValid||(u.calculateTotalCrossing(),u.isCrossingNumberValid=!0),u.totalCrossingOfEdges},o.prototype.calculateTotalCrossing=function(){var u=this,c=0,h=[];h.push.apply(h,u.getCircle().getEdges()),h=h.filter(function(d){return u.getEdges().indexOf(d)<0}),u.getEdges().forEach(function(d){return c+=d.calculateTotalCrossingWithList(h)}),u.totalCrossingOfEdges=c},n.exports=o},function(n,i,a){var s=a(0).Layout,o=a(2),l=a(1),u=a(4),c=a(3);function h(){s.call(this),this.nodeSeparation=o.DEFAULT_NODE_SEPARATION}h.prototype=Object.create(s.prototype);for(var d in s)h[d]=s[d];h.prototype.newGraph=function(f){return this.avsdfCircle=new l(null,this.graphManager,f),this.avsdfCircle},h.prototype.newNode=function(f){return new u(this.graphManager,f)},h.prototype.newEdge=function(f){return new c(null,null,f)},h.prototype.getPositionsData=function(){for(var f=this.graphManager.getAllNodes(),p={},m=0;m<f.length;m++){var v=f[m].rect,g=f[m].id;p[g]={id:g,x:v.getCenterX(),y:v.getCenterY(),w:v.width,h:v.height}}return p},h.prototype.layout=function(){var f=this;if(f.graphManager.getGraphs().length>1)return!1;var p=this.avsdfCircle;for(p.setNodeSeparation(this.nodeSeparation),p.calculateRadius(),p.initOrdering();!p.hasFinishedOrdering();){var m=p.findNodeToPlace();p.putInOrder(m)}return!0},h.prototype.updateNodeAngles=function(){this.graphManager.getRoot().correctAngles()},h.prototype.updateNodeCoordinates=function(){var f=this.graphManager.getRoot();f.getNodes().forEach(function(p){p.setCenter(f.getCenterX()+f.getRadius()*Math.cos(p.getAngle()),f.getCenterY()+f.getRadius()*Math.sin(p.getAngle()))})},h.prototype.initPostProcess=function(){this.avsdfCircle.calculateEdgeCrossingsOfNodes();var f=this.avsdfCircle.getNodes();return f.sort(function(p,m){return m.getTotalCrossingOfEdges()-p.getTotalCrossingOfEdges()}),f},h.prototype.oneStepPostProcess=function(f){for(var p=this,m=f.getTotalCrossingOfEdges(),v=void 0,g=Array.from(f.getNeighborsList()),y=0;y<g.length;y++){var _=g[y],x=f.getIndex(),E=(_.getIndex()+1)%p.avsdfCircle.getSize();if(x!==E){f.setIndex(E),x<f.getIndex()&&(x+=p.avsdfCircle.getSize());for(var T=f.getIndex();T<x;){var b=p.avsdfCircle.getOrder()[T%p.avsdfCircle.getSize()];b.setIndex((b.getIndex()+1)%p.avsdfCircle.getSize()),T+=1}f.calculateTotalCrossing(),v=f.getTotalCrossingOfEdges(),v>=m?p.avsdfCircle.loadOldIndicesOfNodes():(p.avsdfCircle.reOrderVertices(),m=v)}}},n.exports=h},function(n,i,a){var s={};s.layoutBase=a(0),s.AVSDFConstants=a(2),s.AVSDFEdge=a(3),s.AVSDFCircle=a(1),s.AVSDFLayout=a(5),s.AVSDFNode=a(4),n.exports=s}])})}(p0)),p0.exports}var v0={exports:{}},IN;function GY(){return IN||(IN=1,function(r,e){(function(n,i){r.exports=i(V3())})(Ui,function(t){return function(n){var i={};function a(s){if(i[s])return i[s].exports;var o=i[s]={i:s,l:!1,exports:{}};return n[s].call(o.exports,o,o.exports,a),o.l=!0,o.exports}return a.m=n,a.c=i,a.i=function(s){return s},a.d=function(s,o,l){a.o(s,o)||Object.defineProperty(s,o,{configurable:!1,enumerable:!0,get:l})},a.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return a.d(o,"a",o),o},a.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)},a.p="",a(a.s=7)}([function(n,i){n.exports=t},function(n,i,a){var s=a(0).FDLayoutConstants;function o(){}for(var l in s)o[l]=s[l];o.DEFAULT_USE_MULTI_LEVEL_SCALING=!1,o.DEFAULT_RADIAL_SEPARATION=s.DEFAULT_EDGE_LENGTH,o.DEFAULT_COMPONENT_SEPERATION=60,o.TILE=!0,o.TILING_PADDING_VERTICAL=10,o.TILING_PADDING_HORIZONTAL=10,o.TREE_REDUCTION_ON_INCREMENTAL=!1,n.exports=o},function(n,i,a){var s=a(0).FDLayoutEdge;function o(u,c,h){s.call(this,u,c,h)}o.prototype=Object.create(s.prototype);for(var l in s)o[l]=s[l];n.exports=o},function(n,i,a){var s=a(0).LGraph;function o(u,c,h){s.call(this,u,c,h)}o.prototype=Object.create(s.prototype);for(var l in s)o[l]=s[l];n.exports=o},function(n,i,a){var s=a(0).LGraphManager;function o(u){s.call(this,u)}o.prototype=Object.create(s.prototype);for(var l in s)o[l]=s[l];n.exports=o},function(n,i,a){var s=a(0).FDLayoutNode,o=a(0).IMath;function l(c,h,d,f){s.call(this,c,h,d,f)}l.prototype=Object.create(s.prototype);for(var u in s)l[u]=s[u];l.prototype.move=function(){var c=this.graphManager.getLayout();this.displacementX=c.coolingFactor*(this.springForceX+this.repulsionForceX+this.gravitationForceX)/this.noOfChildren,this.displacementY=c.coolingFactor*(this.springForceY+this.repulsionForceY+this.gravitationForceY)/this.noOfChildren,Math.abs(this.displacementX)>c.coolingFactor*c.maxNodeDisplacement&&(this.displacementX=c.coolingFactor*c.maxNodeDisplacement*o.sign(this.displacementX)),Math.abs(this.displacementY)>c.coolingFactor*c.maxNodeDisplacement&&(this.displacementY=c.coolingFactor*c.maxNodeDisplacement*o.sign(this.displacementY)),this.child==null?this.moveBy(this.displacementX,this.displacementY):this.child.getNodes().length==0?this.moveBy(this.displacementX,this.displacementY):this.propogateDisplacementToChildren(this.displacementX,this.displacementY),c.totalDisplacement+=Math.abs(this.displacementX)+Math.abs(this.displacementY),this.springForceX=0,this.springForceY=0,this.repulsionForceX=0,this.repulsionForceY=0,this.gravitationForceX=0,this.gravitationForceY=0,this.displacementX=0,this.displacementY=0},l.prototype.propogateDisplacementToChildren=function(c,h){for(var d=this.getChild().getNodes(),f,p=0;p<d.length;p++)f=d[p],f.getChild()==null?(f.moveBy(c,h),f.displacementX+=c,f.displacementY+=h):f.propogateDisplacementToChildren(c,h)},l.prototype.setPred1=function(c){this.pred1=c},l.prototype.getPred1=function(){return pred1},l.prototype.getPred2=function(){return pred2},l.prototype.setNext=function(c){this.next=c},l.prototype.getNext=function(){return next},l.prototype.setProcessed=function(c){this.processed=c},l.prototype.isProcessed=function(){return processed},n.exports=l},function(n,i,a){var s=a(0).FDLayout,o=a(4),l=a(3),u=a(5),c=a(2),h=a(1),d=a(0).FDLayoutConstants,f=a(0).LayoutConstants,p=a(0).Point,m=a(0).PointD,v=a(0).Layout,g=a(0).Integer,y=a(0).IGeometry,_=a(0).LGraph,x=a(0).Transform;function E(){s.call(this),this.toBeTiled={}}E.prototype=Object.create(s.prototype);for(var T in s)E[T]=s[T];E.prototype.newGraphManager=function(){var b=new o(this);return this.graphManager=b,b},E.prototype.newGraph=function(b){return new l(null,this.graphManager,b)},E.prototype.newNode=function(b){return new u(this.graphManager,b)},E.prototype.newEdge=function(b){return new c(null,null,b)},E.prototype.initParameters=function(){s.prototype.initParameters.call(this,arguments),this.isSubLayout||(h.DEFAULT_EDGE_LENGTH<10?this.idealEdgeLength=10:this.idealEdgeLength=h.DEFAULT_EDGE_LENGTH,this.useSmartIdealEdgeLengthCalculation=h.DEFAULT_USE_SMART_IDEAL_EDGE_LENGTH_CALCULATION,this.springConstant=d.DEFAULT_SPRING_STRENGTH,this.repulsionConstant=d.DEFAULT_REPULSION_STRENGTH,this.gravityConstant=d.DEFAULT_GRAVITY_STRENGTH,this.compoundGravityConstant=d.DEFAULT_COMPOUND_GRAVITY_STRENGTH,this.gravityRangeFactor=d.DEFAULT_GRAVITY_RANGE_FACTOR,this.compoundGravityRangeFactor=d.DEFAULT_COMPOUND_GRAVITY_RANGE_FACTOR,this.prunedNodesAll=[],this.growTreeIterations=0,this.afterGrowthIterations=0,this.isTreeGrowing=!1,this.isGrowthFinished=!1,this.coolingCycle=0,this.maxCoolingCycle=this.maxIterations/d.CONVERGENCE_CHECK_PERIOD,this.finalTemperature=d.CONVERGENCE_CHECK_PERIOD/this.maxIterations,this.coolingAdjuster=1)},E.prototype.layout=function(){var b=f.DEFAULT_CREATE_BENDS_AS_NEEDED;return b&&(this.createBendpoints(),this.graphManager.resetAllEdges()),this.level=0,this.classicLayout()},E.prototype.classicLayout=function(){if(this.nodesWithGravity=this.calculateNodesToApplyGravitationTo(),this.graphManager.setAllNodesToApplyGravitation(this.nodesWithGravity),this.calcNoOfChildrenForAllNodes(),this.graphManager.calcLowestCommonAncestors(),this.graphManager.calcInclusionTreeDepths(),this.graphManager.getRoot().calcEstimatedSize(),this.calcIdealEdgeLengths(),this.incremental){if(h.TREE_REDUCTION_ON_INCREMENTAL){this.reduceTrees(),this.graphManager.resetAllNodesToApplyGravitation();var w=new Set(this.getAllNodes()),A=this.nodesWithGravity.filter(function(R){return w.has(R)});this.graphManager.setAllNodesToApplyGravitation(A)}}else{var b=this.getFlatForest();if(b.length>0)this.positionNodesRadially(b);else{this.reduceTrees(),this.graphManager.resetAllNodesToApplyGravitation();var w=new Set(this.getAllNodes()),A=this.nodesWithGravity.filter(function(S){return w.has(S)});this.graphManager.setAllNodesToApplyGravitation(A),this.positionNodesRandomly()}}return this.initSpringEmbedder(),this.runSpringEmbedder(),!0},E.prototype.tick=function(){if(this.totalIterations++,this.totalIterations===this.maxIterations&&!this.isTreeGrowing&&!this.isGrowthFinished)if(this.prunedNodesAll.length>0)this.isTreeGrowing=!0;else return!0;if(this.totalIterations%d.CONVERGENCE_CHECK_PERIOD==0&&!this.isTreeGrowing&&!this.isGrowthFinished){if(this.isConverged())if(this.prunedNodesAll.length>0)this.isTreeGrowing=!0;else return!0;this.coolingCycle++,this.layoutQuality==0?this.coolingAdjuster=this.coolingCycle:this.layoutQuality==1&&(this.coolingAdjuster=this.coolingCycle/3),this.coolingFactor=Math.max(this.initialCoolingFactor-Math.pow(this.coolingCycle,Math.log(100*(this.initialCoolingFactor-this.finalTemperature))/Math.log(this.maxCoolingCycle))/100*this.coolingAdjuster,this.finalTemperature),this.animationPeriod=Math.ceil(this.initialAnimationPeriod*Math.sqrt(this.coolingFactor))}if(this.isTreeGrowing){if(this.growTreeIterations%10==0)if(this.prunedNodesAll.length>0){this.graphManager.updateBounds(),this.updateGrid(),this.growTree(this.prunedNodesAll),this.graphManager.resetAllNodesToApplyGravitation();var b=new Set(this.getAllNodes()),w=this.nodesWithGravity.filter(function(C){return b.has(C)});this.graphManager.setAllNodesToApplyGravitation(w),this.graphManager.updateBounds(),this.updateGrid(),this.coolingFactor=d.DEFAULT_COOLING_FACTOR_INCREMENTAL}else this.isTreeGrowing=!1,this.isGrowthFinished=!0;this.growTreeIterations++}if(this.isGrowthFinished){if(this.isConverged())return!0;this.afterGrowthIterations%10==0&&(this.graphManager.updateBounds(),this.updateGrid()),this.coolingFactor=d.DEFAULT_COOLING_FACTOR_INCREMENTAL*((100-this.afterGrowthIterations)/100),this.afterGrowthIterations++}var A=!this.isTreeGrowing&&!this.isGrowthFinished,S=this.growTreeIterations%10==1&&this.isTreeGrowing||this.afterGrowthIterations%10==1&&this.isGrowthFinished;return this.totalDisplacement=0,this.graphManager.updateBounds(),this.calcSpringForces(),this.calcRepulsionForces(A,S),this.calcGravitationalForces(),this.moveNodes(),this.animate(),!1},E.prototype.getPositionsData=function(){for(var b=this.graphManager.getAllNodes(),w={},A=0;A<b.length;A++){var S=b[A].rect,C=b[A].id;w[C]={id:C,x:S.getCenterX(),y:S.getCenterY(),w:S.width,h:S.height}}return w},E.prototype.runSpringEmbedder=function(){this.initialAnimationPeriod=25,this.animationPeriod=this.initialAnimationPeriod;var b=!1;if(d.ANIMATE==="during")this.emit("layoutstarted");else{for(;!b;)b=this.tick();this.graphManager.updateBounds()}},E.prototype.calculateNodesToApplyGravitationTo=function(){var b=[],w,A=this.graphManager.getGraphs(),S=A.length,C;for(C=0;C<S;C++)w=A[C],w.updateConnected(),w.isConnected||(b=b.concat(w.getNodes()));return b},E.prototype.createBendpoints=function(){var b=[];b=b.concat(this.graphManager.getAllEdges());var w=new Set,A;for(A=0;A<b.length;A++){var S=b[A];if(!w.has(S)){var C=S.getSource(),R=S.getTarget();if(C==R)S.getBendpoints().push(new m),S.getBendpoints().push(new m),this.createDummyNodesForBendpoints(S),w.add(S);else{var P=[];if(P=P.concat(C.getEdgeListToNode(R)),P=P.concat(R.getEdgeListToNode(C)),!w.has(P[0])){if(P.length>1){var M;for(M=0;M<P.length;M++){var N=P[M];N.getBendpoints().push(new m),this.createDummyNodesForBendpoints(N)}}P.forEach(function(D){w.add(D)})}}}if(w.size==b.length)break}},E.prototype.positionNodesRadially=function(b){for(var w=new p(0,0),A=Math.ceil(Math.sqrt(b.length)),S=0,C=0,R=0,P=new m(0,0),M=0;M<b.length;M++){M%A==0&&(R=0,C=S,M!=0&&(C+=h.DEFAULT_COMPONENT_SEPERATION),S=0);var N=b[M],D=v.findCenterOfTree(N);w.x=R,w.y=C,P=E.radialLayout(N,D,w),P.y>S&&(S=Math.floor(P.y)),R=Math.floor(P.x+h.DEFAULT_COMPONENT_SEPERATION)}this.transform(new m(f.WORLD_CENTER_X-P.x/2,f.WORLD_CENTER_Y-P.y/2))},E.radialLayout=function(b,w,A){var S=Math.max(this.maxDiagonalInTree(b),h.DEFAULT_RADIAL_SEPARATION);E.branchRadialLayout(w,null,0,359,0,S);var C=_.calculateBounds(b),R=new x;R.setDeviceOrgX(C.getMinX()),R.setDeviceOrgY(C.getMinY()),R.setWorldOrgX(A.x),R.setWorldOrgY(A.y);for(var P=0;P<b.length;P++){var M=b[P];M.transform(R)}var N=new m(C.getMaxX(),C.getMaxY());return R.inverseTransformPoint(N)},E.branchRadialLayout=function(b,w,A,S,C,R){var P=(S-A+1)/2;P<0&&(P+=180);var M=(P+A)%360,N=M*y.TWO_PI/360,D=C*Math.cos(N),I=C*Math.sin(N);b.setCenter(D,I);var L=[];L=L.concat(b.getEdges());var z=L.length;w!=null&&z--;for(var B=0,k=L.length,U,G=b.getEdgesBetween(w);G.length>1;){var O=G[0];G.splice(0,1);var F=L.indexOf(O);F>=0&&L.splice(F,1),k--,z--}w!=null?U=(L.indexOf(G[0])+1)%k:U=0;for(var V=Math.abs(S-A)/z,$=U;B!=z;$=++$%k){var Z=L[$].getOtherEnd(b);if(Z!=w){var Y=(A+B*V)%360,X=(Y+V)%360;E.branchRadialLayout(Z,b,Y,X,C+R,R),B++}}},E.maxDiagonalInTree=function(b){for(var w=g.MIN_VALUE,A=0;A<b.length;A++){var S=b[A],C=S.getDiagonal();C>w&&(w=C)}return w},E.prototype.calcRepulsionRange=function(){return 2*(this.level+1)*this.idealEdgeLength},E.prototype.groupZeroDegreeMembers=function(){var b=this,w={};this.memberGroups={},this.idToDummyNode={};for(var A=[],S=this.graphManager.getAllNodes(),C=0;C<S.length;C++){var R=S[C],P=R.getParent();this.getNodeDegreeWithChildren(R)===0&&(P.id==null||!this.getToBeTiled(P))&&A.push(R)}for(var C=0;C<A.length;C++){var R=A[C],M=R.getParent().id;typeof w[M]>"u"&&(w[M]=[]),w[M]=w[M].concat(R)}Object.keys(w).forEach(function(N){if(w[N].length>1){var D="DummyCompound_"+N;b.memberGroups[D]=w[N];var I=w[N][0].getParent(),L=new u(b.graphManager);L.id=D,L.paddingLeft=I.paddingLeft||0,L.paddingRight=I.paddingRight||0,L.paddingBottom=I.paddingBottom||0,L.paddingTop=I.paddingTop||0,b.idToDummyNode[D]=L;var z=b.getGraphManager().add(b.newGraph(),L),B=I.getChild();B.add(L);for(var k=0;k<w[N].length;k++){var U=w[N][k];B.remove(U),z.add(U)}}})},E.prototype.clearCompounds=function(){var b={},w={};this.performDFSOnCompounds();for(var A=0;A<this.compoundOrder.length;A++)w[this.compoundOrder[A].id]=this.compoundOrder[A],b[this.compoundOrder[A].id]=[].concat(this.compoundOrder[A].getChild().getNodes()),this.graphManager.remove(this.compoundOrder[A].getChild()),this.compoundOrder[A].child=null;this.graphManager.resetAllNodes(),this.tileCompoundMembers(b,w)},E.prototype.clearZeroDegreeMembers=function(){var b=this,w=this.tiledZeroDegreePack=[];Object.keys(this.memberGroups).forEach(function(A){var S=b.idToDummyNode[A];w[A]=b.tileNodes(b.memberGroups[A],S.paddingLeft+S.paddingRight),S.rect.width=w[A].width,S.rect.height=w[A].height})},E.prototype.repopulateCompounds=function(){for(var b=this.compoundOrder.length-1;b>=0;b--){var w=this.compoundOrder[b],A=w.id,S=w.paddingLeft,C=w.paddingTop;this.adjustLocations(this.tiledMemberPack[A],w.rect.x,w.rect.y,S,C)}},E.prototype.repopulateZeroDegreeMembers=function(){var b=this,w=this.tiledZeroDegreePack;Object.keys(w).forEach(function(A){var S=b.idToDummyNode[A],C=S.paddingLeft,R=S.paddingTop;b.adjustLocations(w[A],S.rect.x,S.rect.y,C,R)})},E.prototype.getToBeTiled=function(b){var w=b.id;if(this.toBeTiled[w]!=null)return this.toBeTiled[w];var A=b.getChild();if(A==null)return this.toBeTiled[w]=!1,!1;for(var S=A.getNodes(),C=0;C<S.length;C++){var R=S[C];if(this.getNodeDegree(R)>0)return this.toBeTiled[w]=!1,!1;if(R.getChild()==null){this.toBeTiled[R.id]=!1;continue}if(!this.getToBeTiled(R))return this.toBeTiled[w]=!1,!1}return this.toBeTiled[w]=!0,!0},E.prototype.getNodeDegree=function(b){b.id;for(var w=b.getEdges(),A=0,S=0;S<w.length;S++){var C=w[S];C.getSource().id!==C.getTarget().id&&(A=A+1)}return A},E.prototype.getNodeDegreeWithChildren=function(b){var w=this.getNodeDegree(b);if(b.getChild()==null)return w;for(var A=b.getChild().getNodes(),S=0;S<A.length;S++){var C=A[S];w+=this.getNodeDegreeWithChildren(C)}return w},E.prototype.performDFSOnCompounds=function(){this.compoundOrder=[],this.fillCompexOrderByDFS(this.graphManager.getRoot().getNodes())},E.prototype.fillCompexOrderByDFS=function(b){for(var w=0;w<b.length;w++){var A=b[w];A.getChild()!=null&&this.fillCompexOrderByDFS(A.getChild().getNodes()),this.getToBeTiled(A)&&this.compoundOrder.push(A)}},E.prototype.adjustLocations=function(b,w,A,S,C){w+=S,A+=C;for(var R=w,P=0;P<b.rows.length;P++){var M=b.rows[P];w=R;for(var N=0,D=0;D<M.length;D++){var I=M[D];I.rect.x=w,I.rect.y=A,w+=I.rect.width+b.horizontalPadding,I.rect.height>N&&(N=I.rect.height)}A+=N+b.verticalPadding}},E.prototype.tileCompoundMembers=function(b,w){var A=this;this.tiledMemberPack=[],Object.keys(b).forEach(function(S){var C=w[S];A.tiledMemberPack[S]=A.tileNodes(b[S],C.paddingLeft+C.paddingRight),C.rect.width=A.tiledMemberPack[S].width,C.rect.height=A.tiledMemberPack[S].height})},E.prototype.tileNodes=function(b,w){var A=h.TILING_PADDING_VERTICAL,S=h.TILING_PADDING_HORIZONTAL,C={rows:[],rowWidth:[],rowHeight:[],width:0,height:w,verticalPadding:A,horizontalPadding:S};b.sort(function(M,N){return M.rect.width*M.rect.height>N.rect.width*N.rect.height?-1:M.rect.width*M.rect.height<N.rect.width*N.rect.height?1:0});for(var R=0;R<b.length;R++){var P=b[R];C.rows.length==0?this.insertNodeToRow(C,P,0,w):this.canAddHorizontal(C,P.rect.width,P.rect.height)?this.insertNodeToRow(C,P,this.getShortestRowIndex(C),w):this.insertNodeToRow(C,P,C.rows.length,w),this.shiftToLastRow(C)}return C},E.prototype.insertNodeToRow=function(b,w,A,S){var C=S;if(A==b.rows.length){var R=[];b.rows.push(R),b.rowWidth.push(C),b.rowHeight.push(0)}var P=b.rowWidth[A]+w.rect.width;b.rows[A].length>0&&(P+=b.horizontalPadding),b.rowWidth[A]=P,b.width<P&&(b.width=P);var M=w.rect.height;A>0&&(M+=b.verticalPadding);var N=0;M>b.rowHeight[A]&&(N=b.rowHeight[A],b.rowHeight[A]=M,N=b.rowHeight[A]-N),b.height+=N,b.rows[A].push(w)},E.prototype.getShortestRowIndex=function(b){for(var w=-1,A=Number.MAX_VALUE,S=0;S<b.rows.length;S++)b.rowWidth[S]<A&&(w=S,A=b.rowWidth[S]);return w},E.prototype.getLongestRowIndex=function(b){for(var w=-1,A=Number.MIN_VALUE,S=0;S<b.rows.length;S++)b.rowWidth[S]>A&&(w=S,A=b.rowWidth[S]);return w},E.prototype.canAddHorizontal=function(b,w,A){var S=this.getShortestRowIndex(b);if(S<0)return!0;var C=b.rowWidth[S];if(C+b.horizontalPadding+w<=b.width)return!0;var R=0;b.rowHeight[S]<A&&S>0&&(R=A+b.verticalPadding-b.rowHeight[S]);var P;b.width-C>=w+b.horizontalPadding?P=(b.height+R)/(C+w+b.horizontalPadding):P=(b.height+R)/b.width,R=A+b.verticalPadding;var M;return b.width<w?M=(b.height+R)/w:M=(b.height+R)/b.width,M<1&&(M=1/M),P<1&&(P=1/P),P<M},E.prototype.shiftToLastRow=function(b){var w=this.getLongestRowIndex(b),A=b.rowWidth.length-1,S=b.rows[w],C=S[S.length-1],R=C.width+b.horizontalPadding;if(b.width-b.rowWidth[A]>R&&w!=A){S.splice(-1,1),b.rows[A].push(C),b.rowWidth[w]=b.rowWidth[w]-R,b.rowWidth[A]=b.rowWidth[A]+R,b.width=b.rowWidth[instance.getLongestRowIndex(b)];for(var P=Number.MIN_VALUE,M=0;M<S.length;M++)S[M].height>P&&(P=S[M].height);w>0&&(P+=b.verticalPadding);var N=b.rowHeight[w]+b.rowHeight[A];b.rowHeight[w]=P,b.rowHeight[A]<C.height+b.verticalPadding&&(b.rowHeight[A]=C.height+b.verticalPadding);var D=b.rowHeight[w]+b.rowHeight[A];b.height+=D-N,this.shiftToLastRow(b)}},E.prototype.tilingPreLayout=function(){h.TILE&&(this.groupZeroDegreeMembers(),this.clearCompounds(),this.clearZeroDegreeMembers())},E.prototype.tilingPostLayout=function(){h.TILE&&(this.repopulateZeroDegreeMembers(),this.repopulateCompounds())},E.prototype.reduceTrees=function(){for(var b=[],w=!0,A;w;){var S=this.graphManager.getAllNodes(),C=[];w=!1;for(var R=0;R<S.length;R++)A=S[R],A.getEdges().length==1&&!A.getEdges()[0].isInterGraph&&A.getChild()==null&&(C.push([A,A.getEdges()[0],A.getOwner()]),w=!0);if(w==!0){for(var P=[],M=0;M<C.length;M++)C[M][0].getEdges().length==1&&(P.push(C[M]),C[M][0].getOwner().remove(C[M][0]));b.push(P),this.graphManager.resetAllNodes(),this.graphManager.resetAllEdges()}}this.prunedNodesAll=b},E.prototype.growTree=function(b){for(var w=b.length,A=b[w-1],S,C=0;C<A.length;C++)S=A[C],this.findPlaceforPrunedNode(S),S[2].add(S[0]),S[2].add(S[1],S[1].source,S[1].target);b.splice(b.length-1,1),this.graphManager.resetAllNodes(),this.graphManager.resetAllEdges()},E.prototype.findPlaceforPrunedNode=function(b){var w,A,S=b[0];S==b[1].source?A=b[1].target:A=b[1].source;var C=A.startX,R=A.finishX,P=A.startY,M=A.finishY,N=0,D=0,I=0,L=0,z=[N,I,D,L];if(P>0)for(var B=C;B<=R;B++)z[0]+=this.grid[B][P-1].length+this.grid[B][P].length-1;if(R<this.grid.length-1)for(var B=P;B<=M;B++)z[1]+=this.grid[R+1][B].length+this.grid[R][B].length-1;if(M<this.grid[0].length-1)for(var B=C;B<=R;B++)z[2]+=this.grid[B][M+1].length+this.grid[B][M].length-1;if(C>0)for(var B=P;B<=M;B++)z[3]+=this.grid[C-1][B].length+this.grid[C][B].length-1;for(var k=g.MAX_VALUE,U,G,O=0;O<z.length;O++)z[O]<k?(k=z[O],U=1,G=O):z[O]==k&&U++;if(U==3&&k==0)z[0]==0&&z[1]==0&&z[2]==0?w=1:z[0]==0&&z[1]==0&&z[3]==0?w=0:z[0]==0&&z[2]==0&&z[3]==0?w=3:z[1]==0&&z[2]==0&&z[3]==0&&(w=2);else if(U==2&&k==0){var F=Math.floor(Math.random()*2);z[0]==0&&z[1]==0?F==0?w=0:w=1:z[0]==0&&z[2]==0?F==0?w=0:w=2:z[0]==0&&z[3]==0?F==0?w=0:w=3:z[1]==0&&z[2]==0?F==0?w=1:w=2:z[1]==0&&z[3]==0?F==0?w=1:w=3:F==0?w=2:w=3}else if(U==4&&k==0){var F=Math.floor(Math.random()*4);w=F}else w=G;w==0?S.setCenter(A.getCenterX(),A.getCenterY()-A.getHeight()/2-d.DEFAULT_EDGE_LENGTH-S.getHeight()/2):w==1?S.setCenter(A.getCenterX()+A.getWidth()/2+d.DEFAULT_EDGE_LENGTH+S.getWidth()/2,A.getCenterY()):w==2?S.setCenter(A.getCenterX(),A.getCenterY()+A.getHeight()/2+d.DEFAULT_EDGE_LENGTH+S.getHeight()/2):S.setCenter(A.getCenterX()-A.getWidth()/2-d.DEFAULT_EDGE_LENGTH-S.getWidth()/2,A.getCenterY())},n.exports=E},function(n,i,a){var s={};s.layoutBase=a(0),s.CoSEConstants=a(1),s.CoSEEdge=a(2),s.CoSEGraph=a(3),s.CoSEGraphManager=a(4),s.CoSELayout=a(6),s.CoSENode=a(5),n.exports=s}])})}(v0)),v0.exports}(function(r,e){(function(n,i){r.exports=i(kY(),GY())})(Ui,function(t,n){return function(i){var a={};function s(o){if(a[o])return a[o].exports;var l=a[o]={i:o,l:!1,exports:{}};return i[o].call(l.exports,l,l.exports,s),l.l=!0,l.exports}return s.m=i,s.c=a,s.i=function(o){return o},s.d=function(o,l,u){s.o(o,l)||Object.defineProperty(o,l,{configurable:!1,enumerable:!0,get:u})},s.n=function(o){var l=o&&o.__esModule?function(){return o.default}:function(){return o};return s.d(l,"a",l),l},s.o=function(o,l){return Object.prototype.hasOwnProperty.call(o,l)},s.p="",s(s.s=15)}([function(i,a){i.exports=t},function(i,a,s){var o=s(0).layoutBase.FDLayoutConstants;function l(){}for(var u in o)l[u]=o[u];l.DEFAULT_SPRING_STRENGTH=1.5*o.DEFAULT_SPRING_STRENGTH,l.DEFAULT_NODE_SEPARATION=o.DEFAULT_EDGE_LENGTH/4,l.DEFAULT_IDEAL_INTER_CLUSTER_EDGE_LENGTH_COEFF=1.4,l.DEFAULT_ALLOW_NODES_INSIDE_CIRCLE=!1,l.DEFAULT_MAX_RATIO_OF_NODES_INSIDE_CIRCLE=.1,l.DEFAULT_INNER_EDGE_LENGTH=o.DEFAULT_EDGE_LENGTH/3,l.MAX_ROTATION_ANGLE=Math.PI/36,l.MIN_ROTATION_ANGLE=-l.MAX_ROTATION_ANGLE,l.SWAP_IDLE_DURATION=45,l.SWAP_PREPERATION_DURATION=5,l.SWAP_PERIOD=l.SWAP_IDLE_DURATION+l.SWAP_PREPERATION_DURATION,l.SWAP_HISTORY_CLEARANCE_PERIOD=6*l.SWAP_PERIOD,l.MIN_DISPLACEMENT_FOR_SWAP=6,l.REVERSE_PERIOD=25,i.exports=l},function(i,a,s){i.exports=Object.assign!=null?Object.assign.bind(Object):function(o){for(var l=arguments.length,u=Array(l>1?l-1:0),c=1;c<l;c++)u[c-1]=arguments[c];return u.forEach(function(h){Object.keys(h).forEach(function(d){return o[d]=h[d]})}),o}},function(i,a){i.exports=n},function(i,a,s){i.exports=s(16)},function(i,a,s){var o=s(0).layoutBase.LGraph,l=s(0).layoutBase.IGeometry,u=s(0).layoutBase.NeedlemanWunsch,c=s(14),h=s(1),d=s(8),f=s(9);function p(v,g,y){o.call(this,v,g,y),this.intraClusterEdges=null,this.interClusterEdges=null,this.inNodes=[],this.outNodes=[],this.onCircleNodes=[],this.inCircleNodes=[],this.radius=0,this.orderMatrix=null,this.mayBeReversed=!0}p.prototype=Object.create(o.prototype);for(var m in o)p[m]=o[m];p.prototype.setRadius=function(v){this.radius=v},p.prototype.getRadius=function(){return this.radius},p.prototype.getInNodes=function(){return this.inNodes},p.prototype.getOutNodes=function(){return this.outNodes},p.prototype.getOnCircleNodes=function(){return this.onCircleNodes},p.prototype.getInCircleNodes=function(){return this.inCircleNodes},p.prototype.setMayNotBeReversed=function(){this.mayBeReversed=!1},p.prototype.getMayBeReversed=function(){return this.mayBeReversed},p.prototype.getChildAt=function(v){return this.onCircleNodes[v]},p.prototype.getInterClusterEdges=function(){var v=this;return this.interClusterEdges===null&&(this.interClusterEdges=[],this.outNodes.forEach(function(g){for(var y=g.getOnCircleNodeExt().getInterClusterEdges(),_=0;_<y.length;_++)v.interClusterEdges.push(y[_])})),this.interClusterEdges},p.prototype.getIntraClusterEdges=function(){var v=this;if(this.intraClusterEdges===null){this.intraClusterEdges=[];var g=this.getEdges();g.forEach(function(y){y.isIntraEdge()&&v.intraClusterEdges.push(y)})}return this.intraClusterEdges},p.prototype.calculateParentNodeDimension=function(){for(var v=this,g=Number.MIN_SAFE_INTEGER,y=0;y<this.onCircleNodes.length;y++){var _=this.onCircleNodes[y];_.getWidth()>g&&(g=_.getWidth()),_.getHeight()>g&&(g=_.getHeight())}var x=2*(v.radius+v.margin)+g,E=v.getParent();E.setHeight(x),E.setWidth(x)},p.prototype.computeOrderMatrix=function(){var v=this.onCircleNodes.length;this.orderMatrix=new Array(v);for(var g=0;g<this.orderMatrix.length;g++)this.orderMatrix[g]=new Array(v);for(var y=0;y<v;y++)for(var _=0;_<v;_++)if(_>y){var x=this.onCircleNodes[_].getOnCircleNodeExt().getAngle()-this.onCircleNodes[y].getOnCircleNodeExt().getAngle();x<0&&(x+=l.TWO_PI),x<=Math.PI?(this.orderMatrix[y][_]=!0,this.orderMatrix[_][y]=!1):(this.orderMatrix[y][_]=!1,this.orderMatrix[_][y]=!0)}},p.prototype.rotate=function(){var v=this.getParent(),g=this.getOnCircleNodes().length,y=v.rotationAmount/g,_=this.getGraphManager().getLayout();if(y!==0){var x=y/this.radius;x>h.MAX_ROTATION_ANGLE?x=h.MAX_ROTATION_ANGLE:x<h.MIN_ROTATION_ANGLE&&(x=h.MIN_ROTATION_ANGLE);for(var E=0;E<g;E++){var T=this.getChildAt(E),b=T.getOnCircleNodeExt();b.setAngle(b.getAngle()+x),b.updatePosition()}_.totalDisplacement+=v.rotationAmount,v.rotationAmount=0}},p.prototype.getOrder=function(v,g){return this.orderMatrix[v.getOnCircleNodeExt().getIndex()][g.getOnCircleNodeExt().getIndex()]},p.prototype.getThisEnd=function(v){var g=v.getSource(),y=v.getTarget();return g.getOwner()===this?g:y},p.prototype.getOtherEnd=function(v){var g=v.getSource(),y=v.getTarget();return g.getOwner()===this?y:g},p.prototype.decomposeForce=function(v){var g=void 0;if(v.displacementX!==0||v.displacementY!==0){var y=this.getParent(),_=y.getCenterX(),x=y.getCenterY(),E=v.getCenterX(),T=v.getCenterY(),b=v.displacementX,w=v.displacementY,A=l.angleOfVector(_,x,E,T),S=l.angleOfVector(0,0,b,w),C=A+Math.PI,R=void 0;Math.PI<=C&&C<l.TWO_PI?R=A<=S&&S<C:(C-=l.TWO_PI,R=!(C<=S&&S<A));var P=Math.abs(A-S),M=Math.sqrt(b*b+w*w),N=Math.abs(Math.sin(P)*M);R||(N=-N),g=new c(N,b,w)}else g=new c(0,0,0);return g},p.prototype.swapNodes=function(v,g){var y=v,_=g,x=v.getOnCircleNodeExt(),E=g.getOnCircleNodeExt();if(y.getOnCircleNodeExt().getIndex()>g.getOnCircleNodeExt().getIndex()&&(y=g,_=v),y.getOnCircleNodeExt().getPrevNode()===_){var T=_;_=y,y=T}var b=y.getOnCircleNodeExt(),w=_.getOnCircleNodeExt(),A=b.getPrevNode(),S=this.getGraphManager().getLayout(),C=S.getNodeSeparation(),R=(A.getOnCircleNodeExt().getAngle()+(A.getHalfTheDiagonal()+_.getHalfTheDiagonal()+C)/this.radius)%(2*Math.PI);w.setAngle(R),R=(w.getAngle()+(_.getHalfTheDiagonal()+y.getHalfTheDiagonal()+C)/this.radius)%(2*Math.PI),b.setAngle(R),b.updatePosition(),w.updatePosition();var P=x.getIndex();x.setIndex(E.getIndex()),E.setIndex(P),this.getOnCircleNodes()[x.getIndex()]=v,this.getOnCircleNodes()[E.getIndex()]=g,x.updateSwappingConditions(),E.updateSwappingConditions(),x.getNextNode()===g?(x.getPrevNode().getOnCircleNodeExt().updateSwappingConditions(),E.getNextNode().getOnCircleNodeExt().updateSwappingConditions()):(x.getNextNode().getOnCircleNodeExt().updateSwappingConditions(),E.getPrevNode().getOnCircleNodeExt().updateSwappingConditions())},p.prototype.checkAndReverseIfReverseIsBetter=function(){for(var v=this.getInterClusterEdges(),g=new Array(v.length),y=void 0,_=this.getParent().getCenter(),x=void 0,E=void 0,T=void 0,b=void 0,w=this.onCircleNodes.length,A=new Array(w),S=0;S<w;S++)A[S]=0;for(var C=0,R=0;R<v.length;R++)x=v[R],T=this.getOtherEnd(x),b=T.getCenter(),y=l.angleOfVector(_.x,_.y,b.x,b.y),g[R]=new d(x,y),E=this.getThisEnd(x),A[E.getOnCircleNodeExt().getIndex()]++,A[E.getOnCircleNodeExt().getIndex()]>1&&C++;for(var P=this.onCircleNodes,M=w+C,N=new Array(2*M),D=new Array(2*M),I=void 0,L=-1,z=0;z<w;z++){I=P[z],A[z]===0&&(A[z]=1);for(var B=0;B<A[z];B++)L++,N[L]=N[M+L]=D[M-1-L]=D[2*M-1-L]=I.getOnCircleNodeExt().getCharCode()}new f(this,g);for(var k=new Array(g.length),U=0;U<g.length;U++)x=g[U].getEdge(),E=this.getThisEnd(x),k[U]=E.getOnCircleNodeExt().getCharCode();var G=this.computeAlignmentScore(N,k);if(G!==-1){var O=this.computeAlignmentScore(D,k);if(O!==-1&&O>G)return this.reverseNodes(),this.setMayNotBeReversed(),!0}return!1},p.prototype.computeAlignmentScore=function(v,g){var y=new u(v,g,20,-1,-2);return y.getScore()},p.prototype.reverseNodes=function(){for(var v=this.getOnCircleNodes(),g=this.getOnCircleNodes().length,y=0;y<g;y++){var _=v[y],x=_.getOnCircleNodeExt();x.setIndex((g-x.getIndex())%g)}this.reCalculateNodeAnglesAndPositions()},p.prototype.moveOnCircleNodeInside=function(v){var g=this.onCircleNodes.indexOf(v);g>-1&&this.onCircleNodes.splice(g,1),this.inCircleNodes.push(v);for(var y=0;y<this.onCircleNodes.length;y++){var _=this.onCircleNodes[y];_.getOnCircleNodeExt().setIndex(y)}v.setAsNonOnCircleNode(),this.reCalculateCircleSizeAndRadius(),this.reCalculateNodeAnglesAndPositions(),v.setCenter(this.getParent().getCenterX(),this.getParent().getCenterY())},p.prototype.reCalculateCircleSizeAndRadius=function(){for(var v=0,g=this.getOnCircleNodes(),y=0;y<g.length;y++){var _=g[y],x=_.getWidth()*_.getWidth()+_.getHeight()*_.getHeight();v+=Math.sqrt(x)}var E=this.getGraphManager().getLayout(),T=E.getNodeSeparation(),b=v+this.getOnCircleNodes().length*T;this.radius=b/(2*Math.PI),this.calculateParentNodeDimension()},p.prototype.reCalculateNodeAnglesAndPositions=function(){var v=this.getGraphManager().getLayout(),g=v.getNodeSeparation(),y=this.onCircleNodes;y.sort(function(A,S){return A.getOnCircleNodeExt().getIndex()-S.getOnCircleNodeExt().getIndex()});for(var _=this.getParent().getCenterX(),x=this.getParent().getCenterY(),E=0;E<y.length;E++){var T=y[E],b=void 0;if(E===0)b=0;else{var w=y[E-1];b=w.getOnCircleNodeExt().getAngle()+(T.getHalfTheDiagonal()+g+w.getHalfTheDiagonal())/this.radius}T.getOnCircleNodeExt().setAngle(b),T.setCenter(_+this.radius*Math.cos(b),x+this.radius*Math.sin(b))}},i.exports=p},function(i,a,s){var o=s(0).layoutBase.FDLayoutEdge;function l(c,h,d){o.call(this,c,h,d),this.isIntraCluster=!0}l.prototype=Object.create(o.prototype);for(var u in o)l[u]=o[u];l.prototype.isIntraEdge=function(){return this.isIntraCluster},l.prototype.crossesWithEdge=function(c){var h=!1,d=this.getSource().getOnCircleNodeExt(),f=this.getTarget().getOnCircleNodeExt(),p=c.getSource().getOnCircleNodeExt(),m=c.getTarget().getOnCircleNodeExt(),v=-1,g=-1,y=-1,_=-1;if(d!==null&&(v=d.getIndex()),f!==null&&(g=f.getIndex()),p!==null&&(y=p.getIndex()),m!==null&&(_=m.getIndex()),!this.isInterGraph&&!c.isInterGraph)if(this.source.getOwner()!==this.target.getOwner())h=!1;else{(v===-1||g===-1||y===-1||_===-1)&&(h=!1);var x=p.getCircDistWithTheNode(d),E=m.getCircDistWithTheNode(d),T=f.getCircDistWithTheNode(d);T<Math.max(x,E)&&T>Math.min(x,E)&&E!==0&&x!==0&&(h=!0)}else h=!0;return h},l.prototype.calculateTotalCrossingWithList=function(c){for(var h=0,d=0;d<c.length;d++)h+=this.crossingWithEdge(c[d]);return h},l.prototype.crossingWithEdge=function(c){var h=this.crossesWithEdge(c),d=0;return h&&(d=1),d},i.exports=l},function(i,a,s){var o=s(0).layoutBase.LGraphManager;function l(c){o.call(this,c),this.onCircleNodes=[],this.inCircleNodes=[],this.nonOnCircleNodes=[]}l.prototype=Object.create(o.prototype);for(var u in o)l[u]=o[u];l.prototype.getOnCircleNodes=function(){return this.onCircleNodes},l.prototype.getInCircleNodes=function(){return this.inCircleNodes},l.prototype.getNonOnCircleNodes=function(){return this.nonOnCircleNodes},l.prototype.setOnCircleNodes=function(c){this.onCircleNodes=c},l.prototype.setInCircleNodes=function(c){this.inCircleNodes=c},l.prototype.setNonOnCircleNodes=function(c){this.nonOnCircleNodes=c},i.exports=l},function(i,a,s){function o(l,u){this.edge=l,this.angle=u}o.prototype=Object.create(null),o.prototype.getEdge=function(){return this.edge},o.prototype.getAngle=function(){return this.angle},i.exports=o},function(i,a,s){var o=function(){function c(h,d){for(var f=0;f<d.length;f++){var p=d[f];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(h,p.key,p)}}return function(h,d,f){return d&&c(h.prototype,d),f&&c(h,f),h}}();function l(c,h){if(!(c instanceof h))throw new TypeError("Cannot call a class as a function")}var u=function(){function c(h,d){l(this,c),this.ownerCircle=h,this._quicksort(d,0,d.length-1)}return o(c,[{key:"compareFunction",value:function(d,f){return f.getAngle()>d.getAngle()?!0:f.getAngle()===d.getAngle()?d===f?!1:this.ownerCircle.getOrder(this.ownerCircle.getThisEnd(d.getEdge()),this.ownerCircle.getThisEnd(f.getEdge())):!1}},{key:"_quicksort",value:function(d,f,p){if(f<p){var m=this._partition(d,f,p);this._quicksort(d,f,m),this._quicksort(d,m+1,p)}}},{key:"_partition",value:function(d,f,p){for(var m=this._get(d,f),v=f,g=p;;){for(;this.compareFunction(m,this._get(d,g));)g--;for(;this.compareFunction(this._get(d,v),m);)v++;if(v<g)this._swap(d,v,g),v++,g--;else return g}}},{key:"_get",value:function(d,f){return d[f]}},{key:"_set",value:function(d,f,p){d[f]=p}},{key:"_swap",value:function(d,f,p){var m=this._get(d,f);this._set(d,f,this._get(d,p)),this._set(d,p,m)}}]),c}();i.exports=u},function(i,a,s){var o=s(0).layoutBase.FDLayout,l=s(0).layoutBase.HashMap,u=s(0).layoutBase.PointD,c=s(0).layoutBase.DimensionD,h=s(0).AVSDFConstants,d=s(0).AVSDFLayout,f=s(3).CoSELayout;s(3).CoSEConstants;var p=s(1),m=s(7),v=s(5),g=s(11),y=s(6),_=s(13);function x(){o.call(this),this.incremental=p.INCREMENTAL,this.nodeSeparation=p.DEFAULT_NODE_SEPARATION,this.idealInterClusterEdgeLengthCoefficient=p.DEFAULT_IDEAL_INTER_CLUSTER_EDGE_LENGTH_COEFF,this.allowNodesInsideCircle=p.DEFAULT_ALLOW_NODES_INSIDE_CIRCLE,this.maxRatioOfNodesInsideCircle=p.DEFAULT_MAX_RATIO_OF_NODES_INSIDE_CIRCLE,this.step=x.STEP_NOT_STARTED,this.phase=x.PHASE_NOT_STARTED,this.swappedPairsInLastIteration=[],this.iterations=0,this.oldTotalDisplacement=0,this.coolingCycle=0,this.maxCoolingCycle=this.maxIterations/p.CONVERGENCE_CHECK_PERIOD}x.prototype=Object.create(o.prototype);for(var E in o)x[E]=o[E];x.STEP_NOT_STARTED=0,x.STEP_1=1,x.STEP_2=2,x.STEP_3=3,x.STEP_4=4,x.STEP_5=5,x.PHASE_NOT_STARTED=0,x.PHASE_SWAP_PREPERATION=1,x.PHASE_PERFORM_SWAP=2,x.PHASE_OTHER=3,x.prototype.newGraphManager=function(){return this.graphManager=new m(this),this.graphManager},x.prototype.newCircleLGraph=function(T){return new v(null,this.graphManager,T)},x.prototype.newNode=function(T,b){return new g(this.graphManager,T,b,null)},x.prototype.newCiSEOnCircleNode=function(T,b){var w=this.newNode(T,b);return w.setAsOnCircleNode(),w},x.prototype.newEdge=function(T,b,w){return new y(T,b,w)},x.prototype.getNodeSeparation=function(){return this.nodeSeparation},x.prototype.convertToClusteredGraph=function(T,b,w){for(var A=this,S=this,C={},R=this.graphManager.getRoot(),P=new l,M=0;M<T.length;M++)P.put(T[M].data("id"),T[M]);if(typeof w=="function"){for(var N=[],D=[],I=0;I<T.length;I++){var L=w(T[I]);if(L>0&&L!==null&&L!==void 0){var z=N.indexOf(L);z>-1?D[z].push(T[I].data("id")):(N.push(L),D.push([T[I].data("id")]))}}w=D}for(var B=function(we){if(w[we].length===0)return"continue";var pe=A.newNode(null);pe.setClusterId(we),R.add(pe);var Me=A.newCircleLGraph(null);A.graphManager.add(Me,pe),Me.margin=Me.margin+15,w[we].forEach(function(Ae){var j=P.get(Ae),H=j.layoutDimensions({nodeDimensionsIncludeLabels:!1}),te=S.newCiSEOnCircleNode(new u(j.position("x")-H.w/2,j.position("y")-H.h/2),new c(parseFloat(H.w),parseFloat(H.h)));te.setId(Ae),te.setClusterId(we),Me.getOnCircleNodes().push(te),Me.add(te),Me.getInNodes().push(te),C[te.getId()]=te})},k=0;k<w.length;k++)var U=B(k);for(var G=function(we){var pe=!1;if(w.forEach(function(H){H.includes(T[we].data("id"))&&(pe=!0)}),!pe){var Me=T[we],Ae=Me.layoutDimensions({nodeDimensionsIncludeLabels:!1}),j=A.newNode(new u(Me.position("x")-Ae.w/2,Me.position("y")-Ae.h/2),new c(parseFloat(Ae.w),parseFloat(Ae.h)));j.setClusterId(-1),j.setId(T[we].data("id")),R.add(j),C[j.getId()]=j}},O=0;O<T.length;O++)G(O);for(var F=0;F<b.length;F++){var V=b[F],$=C[V.data("source")],Z=C[V.data("target")],Y=$.getClusterId(),X=Z.getClusterId();if($!==Z){var K=S.newEdge($,Z,null);Y===X&&Y!==-1&&X!==-1?(K.isIntraCluster=!0,K.getSource().getOwner().add(K,K.getSource(),K.getTarget())):(K.isIntraCluster=!1,this.graphManager.add(K,K.getSource(),K.getTarget()))}}for(var se=[],oe=[],W=this.graphManager.getAllNodes(),Ne=0;Ne<W.length;Ne++)W[Ne].getOnCircleNodeExt()?se.push(W[Ne]):oe.push(W[Ne]);return this.graphManager.setOnCircleNodes(se),this.graphManager.setNonOnCircleNodes(oe),this.graphManager.edges.forEach(function(Be){var we=Be.getSource(),pe=Be.getTarget(),Me=we.getClusterId(),Ae=pe.getClusterId();if(Me!==-1){var j=we.getOwner(),H=j.getInNodes().indexOf(we);H>-1&&(j.getInNodes().splice(H,1),j.getOutNodes().push(we))}if(Ae!==-1){var te=pe.getOwner(),me=te.getInNodes().indexOf(pe);me>-1&&(te.getInNodes().splice(me,1),te.getOutNodes().push(pe))}}),C},x.prototype.doStep1=function(){this.step=x.STEP_1,this.phase=x.PHASE_OTHER;for(var T=new l,b=this.graphManager.getGraphs(),w=0;w<b.length;w++){var A=b[w];if(A instanceof v){h.DEFAULT_NODE_SEPARATION=this.nodeSeparation;for(var S=new d,C=S.graphManager.addRoot(),R=A.getOnCircleNodes(),P=0;P<R.length;P++){var M=R[P],N=S.newNode(null),D=M.getLocation();N.setLocation(D.x,D.y),N.setWidth(M.getWidth()),N.setHeight(M.getHeight()),C.add(N),T.put(M,N)}for(var I=this.getAllEdges(),L=0;L<I.length;L++){var z=I[L];if(R.includes(z.getSource())&&R.includes(z.getTarget())){var B=T.get(z.getSource()),k=T.get(z.getTarget()),U=S.newEdge("");C.add(U,B,k)}}S.layout();for(var G=S.initPostProcess(),O=0;O<G.length;O++)S.oneStepPostProcess(G[O]);S.updateNodeAngles(),S.updateNodeCoordinates();for(var F=0;F<R.length;F++){var V=R[F],$=T.get(V),Z=$.getLocation();V.setLocation(Z.x,Z.y),V.getOnCircleNodeExt().setIndex($.getIndex()),V.getOnCircleNodeExt().setAngle($.getAngle())}if(R.sort(function(K,se){return K.getOnCircleNodeExt().getIndex()-se.getOnCircleNodeExt().getIndex()}),C.getNodes().length>0){var Y=A.getParent(),X=C.getParent();Y.setLocation(X.getLocation().x,X.getLocation().y),A.setRadius(C.getRadius()),A.calculateParentNodeDimension()}}}},x.prototype.doStep2=function(){this.step=x.STEP_2,this.phase=x.PHASE_OTHER;var T=[],b=new l,w=new l,A=new f;A.isSubLayout=!1,A.useMultiLevelScaling=!1,A.useFRGridVariant=!0,A.springConstant*=1.5;for(var S=A.newGraphManager(),C=S.addRoot(),R=this.graphManager.getNonOnCircleNodes(),P=0;P<R.length;P++){var M=R[P],N=A.newNode(null),D=M.getLocation();N.setLocation(D.x,D.y),N.setWidth(M.getWidth()),N.setHeight(M.getHeight()),M.getChild()!=null&&(N.setWidth(1.2*N.getWidth()),N.setHeight(1.2*N.getHeight())),N.id=P,C.add(N),T.push(N),b.put(M,N)}for(var I=new Array(T.length),L=0;L<I.length;L++)I[L]=new Array(T.length);for(var z=this.graphManager.getAllEdges(),B=0;B<z.length;B++){var k=z[B],U=k.getSource(),G=k.getTarget();U.getOnCircleNodeExt()!=null&&(U=k.getSource().getOwner().getParent()),G.getOnCircleNodeExt()!=null&&(G=k.getTarget().getOwner().getParent());var O=b.get(U),F=b.get(G),V=T.indexOf(O),$=T.indexOf(F),Z=void 0;V!==$&&(I[V][$]==null&&I[$][V]==null?(Z=A.newEdge(null),C.add(Z,O,F),w.put(Z,[]),I[V][$]=Z,I[$][V]=Z):Z=I[V][$],w.get(Z).push(k))}A.runLayout();for(var Y=0;Y<R.length;Y++){var X=R[Y],K=b.get(X),se=K.getLocation();X.setLocation(se.x,se.y)}for(var oe=this.graphManager.getOnCircleNodes(),W=0;W<oe.length;W++){var Ne=oe[W],Be=Ne.getLocation(),we=Ne.getOwner().getParent().getLocation();Ne.setLocation(Be.x+we.x,Be.y+we.y)}},x.prototype.step3Init=function(){this.step=x.STEP_3,this.phase=x.PHASE_OTHER,this.initSpringEmbedder(),this.coolingCycle=0},x.prototype.step4Init=function(){this.step=x.STEP_4,this.phase=x.PHASE_OTHER,this.initSpringEmbedder();for(var T=0;T<this.graphManager.getOnCircleNodes().length;T++)this.graphManager.getOnCircleNodes()[T].getOnCircleNodeExt().updateSwappingConditions();this.coolingCycle=0},x.prototype.step5Init=function(){this.step=x.STEP_5,this.phase=x.PHASE_OTHER,this.initSpringEmbedder(),this.coolingCycle=0},x.prototype.runSpringEmbedderTick=function(){if(this.iterations++,this.totalIterations=this.iterations,this.iterations%p.CONVERGENCE_CHECK_PERIOD===0){var T=this.step!==x.STEP_4||this.iterations>this.maxIterations/4;if(T&&this.isConverged())return!0;this.coolingFactor=this.initialCoolingFactor*((this.maxIterations-this.iterations)/this.maxIterations)}if(this.totalDisplacement=0,this.step===x.STEP_3)this.iterations%p.REVERSE_PERIOD===0&&this.checkAndReverseIfReverseIsBetter();else if(this.step===x.STEP_4){this.iterations%p.SWAP_HISTORY_CLEARANCE_PERIOD===0&&(this.swappedPairsInLastIteration=[]);var b=this.iterations%p.SWAP_PERIOD;b>=p.SWAP_IDLE_DURATION?this.phase=x.PHASE_SWAP_PREPERATION:b===0?this.phase=x.PHASE_PERFORM_SWAP:this.phase=x.PHASE_OTHER}return this.calcSpringForces(),this.calcRepulsionForces(),this.calcGravitationalForces(),this.calcTotalForces(),this.moveNodes(),this.iterations>=this.maxIterations},x.prototype.prepareCirclesForReversal=function(){var T=this.graphManager.getRoot().getNodes();T.forEach(function(b){var w=b.getChild();w!=null&&(w.getInterClusterEdges().length<2&&w.setMayNotBeReversed(),w.computeOrderMatrix())})},x.prototype.calcIdealEdgeLengths=function(T){for(var b=this.graphManager.getAllEdges(),w=0;w<b.length;w++){var A=b[w];T?A.idealLength=1.5*this.idealEdgeLength*this.idealInterClusterEdgeLengthCoefficient:A.idealLength=this.idealEdgeLength*this.idealInterClusterEdgeLengthCoefficient}for(var S=this.graphManager.getInCircleNodes(),C=0;C<S.length;C++){var R=S[C];R.getEdges().forEach(function(P){P.idealLength=p.DEFAULT_INNER_EDGE_LENGTH})}},x.prototype.calcSpringForces=function(){for(var T=this.graphManager.getAllEdges(),b=0;b<T.length;b++){var w=T[b],A=w.getSource(),S=w.getTarget();w.isIntraCluster&&A.getOnCircleNodeExt()!=null&&S.getOnCircleNodeExt()!=null||this.calcSpringForce(w,w.idealLength)}},x.prototype.calcRepulsionForces=function(){for(var T=this.graphManager.getNonOnCircleNodes(),b=0;b<T.length;b++)for(var w=T[b],A=b+1;A<T.length;A++){var S=T[A];this.calcRepulsionForce(w,S)}for(var C=this.graphManager.getInCircleNodes(),R=0;R<C.length;R++)for(var P=C[R],M=P.getOwner(),N=M.getNodes(),D=0;D<N.length;D++){var I=N[D];I!==P&&this.calcRepulsionForce(P,I)}},x.prototype.calcGravitationalForces=function(){if(!this.graphManager.rootGraph.isConnected)for(var T=this.graphManager.getNonOnCircleNodes(),b=0;b<T.length;b++){var w=T[b];this.calcGravitationalForce(w)}for(var A=this.graphManager.getInCircleNodes(),S=0;S<A.length;S++){var C=A[S];this.calcGravitationalForce(C)}},x.prototype.calcTotalForces=function(){for(var T=this.graphManager.getAllNodes(),b=0;b<T.length;b++){var w=T[b];w.displacementX=this.coolingFactor*(w.springForceX+w.repulsionForceX+w.gravitationForceX),w.displacementY=this.coolingFactor*(w.springForceY+w.repulsionForceY+w.gravitationForceY),w.rotationAmount=0,w.springForceX=0,w.springForceY=0,w.repulsionForceX=0,w.repulsionForceY=0,w.gravitationForceX=0,w.gravitationForceY=0}for(var A=this.graphManager.getOnCircleNodes(),S=0;S<A.length;S++){var C=A[S],R=C.getOwner().getParent(),P=C.getOwner().decomposeForce(C);this.phase===x.PHASE_SWAP_PREPERATION&&C.getOnCircleNodeExt().addDisplacementForSwap(P.getRotationAmount()),R.displacementX+=P.getDisplacementX(),R.displacementY+=P.getDisplacementY(),C.displacementX=0,C.displacementY=0,R.rotationAmount+=P.getRotationAmount(),C.rotationAmount=0}},x.prototype.moveNodes=function(){if(this.phase!==x.PHASE_PERFORM_SWAP){for(var T=this.graphManager.getNonOnCircleNodes(),b=0;b<T.length;b++)T[b].move(),T[b].getChild()!==null&&T[b].getChild()!==void 0&&T[b].getChild().rotate();for(var w=this.graphManager.getInCircleNodes(),A=void 0,S=0;S<w.length;S++)A=w[S],A.displacementX/=20,A.displacementY/=20,A.move()}else{for(var C=this.graphManager.getOnCircleNodes(),R=C.length,P=[],M=[],N=[],D=[],I=void 0,L=void 0,z=void 0,B=void 0,k=void 0,U=void 0,G=void 0,O=void 0,F=0;F<R;F++)if(I=C[F],L=I.getOnCircleNodeExt().getNextNode(),z=I.getOnCircleNodeExt(),B=L.getOnCircleNodeExt(),!(!z.canSwapWithNext||!B.canSwapWithPrev)&&(k=z.getDisplacementForSwap(),U=B.getDisplacementForSwap(),G=k-U,!(G<0))){O=k>0&&U>0||k<0&&U<0;var V=new _(I,L,G,O);k===0||U===0?M.push(V):P.push(V)}var $=void 0,Z=!0,Y=void 0;for(P.sort(function(we,pe){return we.getDiscrepancy()-pe.getDiscrepancy()});Z&&P.length>0;){if($=P[P.length-1],I=$.getFirstNode(),L=$.getSecondNode(),z=I.getOnCircleNodeExt(),B=L.getOnCircleNodeExt(),this.isSwappedPreviously($)){P.pop(),D.push($);continue}var X=z.getInterClusterIntersections(B);$.swap(),Y=!1;var K=z.getInterClusterIntersections(B);if(Y=K>X,!Y&&K===X&&(Y=$.inSameDirection()||$.getDiscrepancy()<p.MIN_DISPLACEMENT_FOR_SWAP),Y){$.swap(),P.pop();continue}N.push($.getFirstNode()),N.push($.getSecondNode()),D.push($),Z=!1}for(var se=0;se<M.length;se++){var oe=M[se];oe.inSameDirection()||oe.getDiscrepancy()<p.MIN_DISPLACEMENT_FOR_SWAP||N.includes(oe.getFirstNode())||N.includes(oe.getSecondNode())||(this.isSwappedPreviously(oe)||(oe.swap(),N.push(oe.getFirstNode()),N.push(oe.getSecondNode())),D.push(oe))}this.swappedPairsInLastIteration=[];for(var W=0;W<D.length;W++)this.swappedPairsInLastIteration.push(D[W]);for(var Ne=void 0,Be=0;Be<R;Be++)Ne=C[Be],Ne.getOnCircleNodeExt().setDisplacementForSwap(0)}},x.prototype.isSwappedPreviously=function(T){for(var b=0;b<this.swappedPairsInLastIteration.length;b++){var w=this.swappedPairsInLastIteration[b];if(w.getFirstNode()===T.getFirstNode()&&w.getSecondNode()===T.getSecondNode()||w.getSecondNode()===T.getFirstNode()&&w.getFirstNode()===T.getSecondNode())return!0}return!1},x.prototype.checkAndReverseIfReverseIsBetter=function(){for(var T=this.getGraphManager(),b=T.getRoot().getNodes(),w=void 0,A=void 0,S=0;S<b.length;S++)if(w=b[S],A=w.getChild(),A!=null&&A.getMayBeReversed()&&A.getNodes().length<=52&&A.checkAndReverseIfReverseIsBetter())return!0;return!1},x.prototype.findAndMoveInnerNodes=function(){if(!!this.allowNodesInsideCircle)for(var T=this.graphManager.getGraphs(),b=0;b<T.length;b++){var w=T[b],A=0;if(w!==this.getGraphManager().getRoot())for(var S=w.getNodes().length*this.maxRatioOfNodesInsideCircle,C=this.findInnerNode(w);C!=null&&A<S;)this.moveInnerNode(C),A++,A<S&&(C=this.findInnerNode(w))}},x.prototype.findInnerNode=function(T){var b=null,w=T.getOnCircleNodes().length,A=T.getOnCircleNodes();A.sort(function(U,G){return U.getEdges().length-G.getEdges().length});for(var S=w-1;S>=0&&b==null;S--){var C=A[S];if(C.getOnCircleNodeExt().getInterClusterEdges().length===0){var R=this.findMinimalSpanningSegment(C);if(R.length!==0){for(var P=!1,M=0;M<R.length;M++){var N=R[M];if(P)break;for(var D=N.getNeighborsList(),I=0;I<D.length;I++){var L=D[I];if(L!==C&&L.getOwner()===T&&L.getOnCircleNodeExt()!=null&&L.getOnCircleNodeExt()!=null){var z=N.getOnCircleNodeExt().getIndex(),B=L.getOnCircleNodeExt().getIndex(),k=z-B;if(k+=w,k%=w,k>1&&(k=B-z,k+=w,k%=w),k>1){P=!0;break}}}}P||(b=C)}}}return b},x.prototype.moveInnerNode=function(T){var b=T.getOwner();b.moveOnCircleNodeInside(T);var w=this.graphManager.getOnCircleNodes(),A=w.indexOf(T);A>-1&&w.splice(A,1),this.graphManager.inCircleNodes.push(T)},x.prototype.findMinimalSpanningSegment=function(T){var b=[],w=T.getOnCircleNeighbors();if(w.length===0)return b;w.sort(function(G,O){return G.getOnCircleNodeExt().getIndex()-O.getOnCircleNodeExt().getIndex()});var A=T.getOwner().getOnCircleNodes();A.sort(function(G,O){return G.getOnCircleNodeExt().getIndex()-O.getOnCircleNodeExt().getIndex()});var S=null,C=null,R=A.length,P=A.length,M=w.length,N=void 0,D=void 0,I=void 0,L=void 0,z=void 0;for(N=0;N<M;N++)D=(N-1+M)%M,I=w[N],L=w[D],z=(L.getOnCircleNodeExt().getIndex()-I.getOnCircleNodeExt().getIndex()+P)%P+1,z<R&&(S=I,C=L,R=z);for(var B=!1,k=S;!B;)if(k!==T&&b.push(k),k===C)B=!0;else{var U=k.getOnCircleNodeExt().getIndex()+1;U===A.length&&(U=0),k=A[U]}return b},i.exports=x},function(i,a,s){var o=s(0).layoutBase.FDLayoutNode,l=s(0).layoutBase.IMath,u=s(1),c=s(12);function h(f,p,m,v){o.call(this,f,p,m,v),this.rotationAmount=null,this.onCircleNodeExt=null,this.clusterID=null,this.ID=null}h.prototype=Object.create(o.prototype);for(var d in o)h[d]=o[d];h.prototype.setClusterId=function(f){this.clusterID=f},h.prototype.getClusterId=function(){return this.clusterID},h.prototype.setId=function(f){this.ID=f},h.prototype.getId=function(){return this.ID},h.prototype.setAsOnCircleNode=function(){return this.onCircleNodeExt=new c(this),this.onCircleNodeExt},h.prototype.setAsNonOnCircleNode=function(){this.onCircleNodeExt=null},h.prototype.getOnCircleNodeExt=function(){return this.onCircleNodeExt},h.prototype.getLimitedDisplacement=function(f){return Math.abs(f)>u.MAX_NODE_DISPLACEMENT&&(f=u.MAX_NODE_DISPLACEMENT*l.sign(f)),f},h.prototype.getOnCircleNeighbors=function(){for(var f=Array.from(this.getNeighborsList()),p=[],m=0;m<f.length;m++){var v=f[m];v.getOnCircleNodeExt()!==null&&v.getClusterId()===this.getClusterId()&&p.push(v)}return p},h.prototype.getNoOfChildren=function(){return this.getChild()===null||this.getChild()===void 0?1:this.getChild().getNodes().length},h.prototype.move=function(){var f=this.getOwner().getGraphManager().getLayout();if(this.displacementX=this.getLimitedDisplacement(this.displacementX),this.displacementY=this.getLimitedDisplacement(this.displacementY),this.getChild()!==null&&this.getChild()!==void 0){var p=this.getChild().getNodes().length;this.displacementX/=p,this.displacementY/=p;for(var m=this.getChild().getNodes(),v=0;v<m.length;v++){var g=m[v];g.moveBy(this.displacementX,this.displacementY),f.totalDisplacement+=Math.abs(this.displacementX)+Math.abs(this.displacementY)}}this.moveBy(this.displacementX,this.displacementY),f.totalDisplacement+=Math.abs(this.displacementX)+Math.abs(this.displacementY),this.getChild()!==null&&this.getChild()!==void 0&&this.getChild().updateBounds(!0)},h.prototype.reset=function(){this.displacementX=0,this.displacementY=0},i.exports=h},function(i,a,s){var o=s(0).layoutBase.IGeometry;function l(u){this.ciseNode=u,this.intraClusterEdges=null,this.interClusterEdges=null,this.angle=-1,this.orderIndex=-1,this.canSwapWithNext=null,this.canSwapWithPrevious=null,this.displacementForSwap=null}l.prototype=Object.create(null),l.prototype.getCiseNode=function(){return this.ciseNode},l.prototype.getAngle=function(){return this.angle},l.prototype.setAngle=function(u){this.angle=u%o.TWO_PI,this.angle<0&&(this.angle+=o.TWO_PI)},l.prototype.getIndex=function(){return this.orderIndex},l.prototype.setIndex=function(u){this.orderIndex=u},l.prototype.getCharCode=function(){var u=void 0;return this.orderIndex<26?u=String.fromCharCode(97+this.orderIndex):this.orderIndex<52?u=String.fromCharCode(65+this.orderIndex):u="?",u},l.prototype.getNextNode=function(){var u=this.ciseNode.getOwner(),c=u.getOnCircleNodes().length,h=this.orderIndex+1;return h===c&&(h=0),u.getOnCircleNodes()[h]},l.prototype.getPrevNode=function(){var u=this.ciseNode.getOwner(),c=this.orderIndex-1;return c===-1&&(c=u.getOnCircleNodes().length-1),u.getOnCircleNodes()[c]},l.prototype.getNextNodeExt=function(){return this.getNextNode().getOnCircleNodeExt()},l.prototype.prevNextNodeExt=function(){return this.getPrevNode().getOnCircleNodeExt()},l.prototype.canSwapWithNext=function(){return this.canSwapWithNext},l.prototype.canSwapWithPrev=function(){return this.canSwapWithPrev},l.prototype.getDisplacementForSwap=function(){return this.displacementForSwap},l.prototype.setDisplacementForSwap=function(u){this.displacementForSwap=u},l.prototype.addDisplacementForSwap=function(u){this.displacementForSwap=u},l.prototype.updatePosition=function(){var u=this.ciseNode.getOwner(),c=u.getParent(),h=c.getCenterX(),d=c.getCenterY(),f=u.getRadius()*Math.cos(this.angle),p=u.getRadius()*Math.sin(this.angle);this.ciseNode.setCenter(h+f,d+p)},l.prototype.getCircDistWithTheNode=function(u){var c=u.getIndex();if(c===-1||this.getIndex()===-1)return-1;var h=this.getIndex()-c;return h<0&&(h+=this.ciseNode.getOwner().getOnCircleNodes().length),h},l.prototype.calculateTotalCrossing=function(){var u=this.getIntraClusterEdges(),c=0,h=[];return this.ciseNode.getOwner().getIntraClusterEdges().forEach(function(d){h.push(d)}),this.ciseNode.getEdges().forEach(function(d){var f=h.indexOf(d);f>-1&&h.splice(f,1)}),u.forEach(function(d){c+=d.calculateTotalCrossingWithList(h)}),c},l.prototype.updateSwappingConditions=function(){var u=this.calculateTotalCrossing(),c=this.orderIndex,h=this.getNextNode().getOnCircleNodeExt();this.orderIndex=h.getIndex(),h.setIndex(c);var d=this.calculateTotalCrossing();this.canSwapWithNext=d<=u,h.setIndex(this.orderIndex),this.setIndex(c);var f=this.getPrevNode().getOnCircleNodeExt();this.orderIndex=f.getIndex(),f.setIndex(c),d=this.calculateTotalCrossing(),this.canSwapWithPrevious=d<=u,f.setIndex(this.orderIndex),this.setIndex(c)},l.prototype.swapWith=function(u){this.ciseNode.getOwner().swapNodes(this.ciseNode,u.ciseNode)},l.prototype.getInterClusterIntersections=function(u){for(var c=0,h=this.getInterClusterEdges(),d=u.getInterClusterEdges(),f=0;f<h.length;f++)for(var p=h[f],m=this.ciseNode.getCenter(),v=p.getOtherEnd(this.ciseNode).getCenter(),g=0;g<d.length;g++){var y=d[g],_=u.ciseNode.getCenter(),x=y.getOtherEnd(u.ciseNode).getCenter();if(p.getOtherEnd(this.ciseNode)!==y.getOtherEnd(u.ciseNode)){var E=o.doIntersect(m,v,_,x);E&&c++}}return c},l.prototype.getInterClusterEdges=function(){if(this.interClusterEdges===null){this.interClusterEdges=[];for(var u=this.ciseNode.getEdges(),c=0;c<u.length;c++){var h=u[c];h.isIntraCluster||this.interClusterEdges.push(h)}}return this.interClusterEdges},l.prototype.getIntraClusterEdges=function(){if(this.intraClusterEdges===null){this.intraClusterEdges=[];for(var u=this.ciseNode.getEdges(),c=0;c<u.length;c++){var h=u[c];h.isIntraCluster&&this.intraClusterEdges.push(h)}}return this.intraClusterEdges},i.exports=l},function(i,a,s){function o(l,u,c,h){this.firstNode=l,this.secondNode=u,this.discrepancy=c,this.inSameDir=h}o.prototype=Object.create,o.prototype.getDiscrepancy=function(){return this.discrepancy},o.prototype.inSameDirection=function(){return this.inSameDir},o.prototype.getFirstNode=function(){return this.firstNode},o.prototype.getSecondNode=function(){return this.secondNode},o.prototype.compareTo=function(l){return this.getDiscrepancy()-l.getDiscrepancy()},o.prototype.swap=function(){this.getFirstNode().getOnCircleNodeExt().swapWith(this.getSecondNode().getOnCircleNodeExt())},o.prototype.equals=function(l){var u=l instanceof o;if(u){var c=l;u&=this.firstNode.equals(c.getFirstNode())&&this.secondNode.equals(c.getSecondNode())||this.secondNode.equals(c.getFirstNode())&&this.firstNode.equals(c.getSecondNode())}return u},o.prototype.hashCode=function(){return this.firstNode.hashCode()+this.secondNode.hashCode()},o.prototype.toString=function(){var l="Swap: "+this.getFirstNode().label;return l+="<->"+this.getSecondNode().label,l+=", "+this.getDiscrepancy(),l},i.exports=o},function(i,a,s){function o(l,u,c){this.rotationAmount=l,this.displacementX=u,this.displacementY=c}o.prototype.getRotationAmount=function(){return this.rotationAmount},o.prototype.setRotationAmount=function(l){this.rotationAmount=l},o.prototype.getDisplacementX=function(){return this.displacementX},o.prototype.setDisplacementX=function(l){this.displacementX=l},o.prototype.getDisplacementY=function(){return this.displacementY},o.prototype.setDisplacementY=function(l){this.displacementY=l},i.exports=o},function(i,a,s){var o=s(4),l=function(c){!c||c("layout","cise",o)};typeof cytoscape<"u"&&l(cytoscape),i.exports=l},function(i,a,s){var o=function(){function _(x,E){for(var T=0;T<E.length;T++){var b=E[T];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(x,b.key,b)}}return function(x,E,T){return E&&_(x.prototype,E),T&&_(x,T),x}}(),l=function _(x,E,T){x===null&&(x=Function.prototype);var b=Object.getOwnPropertyDescriptor(x,E);if(b===void 0){var w=Object.getPrototypeOf(x);return w===null?void 0:_(w,E,T)}else{if("value"in b)return b.value;var A=b.get;return A===void 0?void 0:A.call(T)}};function u(_,x){if(!(_ instanceof x))throw new TypeError("Cannot call a class as a function")}function c(_,x){if(!_)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return x&&(typeof x=="object"||typeof x=="function")?x:_}function h(_,x){if(typeof x!="function"&&x!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof x);_.prototype=Object.create(x&&x.prototype,{constructor:{value:_,enumerable:!1,writable:!0,configurable:!0}}),x&&(Object.setPrototypeOf?Object.setPrototypeOf(_,x):_.__proto__=x)}var d=s(10),f=s(1),p=s(0).layoutBase.FDLayoutConstants,m=s(18),v=m.defaults,g=s(2),y=function(_){h(x,_);function x(E){u(this,x);var T=c(this,(x.__proto__||Object.getPrototypeOf(x)).call(this,g({},v,E)));return E.nodeSeparation!==null&&E.nodeSeparation!==void 0?f.DEFAULT_NODE_SEPARATION=E.nodeSeparation:f.DEFAULT_NODE_SEPARATION=p.DEFAULT_EDGE_LENGTH/4,E.idealInterClusterEdgeLengthCoefficient!==null&&E.idealInterClusterEdgeLengthCoefficient!==void 0?f.DEFAULT_IDEAL_INTER_CLUSTER_EDGE_LENGTH_COEFF=E.idealInterClusterEdgeLengthCoefficient:f.DEFAULT_IDEAL_INTER_CLUSTER_EDGE_LENGTH_COEFF=1.4,E.allowNodesInsideCircle!==null&&E.allowNodesInsideCircle!==void 0?f.DEFAULT_ALLOW_NODES_INSIDE_CIRCLE=E.allowNodesInsideCircle:f.DEFAULT_ALLOW_NODES_INSIDE_CIRCLE=!1,E.maxRatioOfNodesInsideCircle!==null&&E.maxRatioOfNodesInsideCircle!==void 0?f.DEFAULT_MAX_RATIO_OF_NODES_INSIDE_CIRCLE=E.maxRatioOfNodesInsideCircle:f.DEFAULT_MAX_RATIO_OF_NODES_INSIDE_CIRCLE=.1,E.springCoeff!==null&&E.springCoeff!==void 0?f.DEFAULT_SPRING_STRENGTH=E.springCoeff:f.DEFAULT_SPRING_STRENGTH=1.5*p.DEFAULT_SPRING_STRENGTH,E.nodeRepulsion!=null&&(f.DEFAULT_REPULSION_STRENGTH=p.DEFAULT_REPULSION_STRENGTH=E.nodeRepulsion),E.gravity!=null&&(f.DEFAULT_GRAVITY_STRENGTH=p.DEFAULT_GRAVITY_STRENGTH=E.gravity),E.gravityRange!=null&&(f.DEFAULT_GRAVITY_RANGE_FACTOR=p.DEFAULT_GRAVITY_RANGE_FACTOR=E.gravityRange),E.maxRatioOfNodesInsideCircle!==null&&E.maxRatioOfNodesInsideCircle!==void 0?f.DEFAULT_MAX_RATIO_OF_NODES_INSIDE_CIRCLE=E.maxRatioOfNodesInsideCircle:f.DEFAULT_MAX_RATIO_OF_NODES_INSIDE_CIRCLE=.1,T}return o(x,[{key:"prerun",value:function(){var T=this.state,b=[[]];this.options.clusters!==null&&this.options.clusters!==void 0&&(b=this.options.clusters);var w=T.nodes,A=T.edges,S=this.ciseLayout=new d,C=this.graphManager=S.newGraphManager(),R=this.root=C.addRoot();this.idToLNode=S.convertToClusteredGraph(w,A,b),R.updateConnected(),R.calcEstimatedSize(),S.calcNoOfChildrenForAllNodes(),S.doStep1(),S.doStep2(),R.updateBounds(!0),R.estimatedSize=Math.max(R.right-R.left,R.bottom-R.top),S.prepareCirclesForReversal(),S.calcIdealEdgeLengths(!1),this.initializerIndex=0,this.isDone=!1,this.isStepDone=!1,this.timeToSwitchNextStep=!0}},{key:"tick",value:function(){var T=this,b=this,w=this.state;if(w.nodes.forEach(function(A){var S=T.getScratch(A),C=b.idToLNode[A.data("id")];S.x=C.getCenterX(),S.y=C.getCenterY()}),this.timeToSwitchNextStep){switch(this.initializerIndex){case 0:this.ciseLayout.step5Init();break;case 1:this.ciseLayout.step3Init();break;case 2:this.ciseLayout.step5Init();break;case 3:this.ciseLayout.step4Init();break;case 4:this.ciseLayout.findAndMoveInnerNodes(),this.ciseLayout.calcIdealEdgeLengths(!0),this.ciseLayout.step5Init();break}this.initializerIndex++,this.ciseLayout.iterations=0,this.ciseLayout.totalDisplacement=1e3,this.timeToSwitchNextStep=!1}return this.isStepDone=this.ciseLayout.runSpringEmbedderTick(),this.isStepDone&&this.initializerIndex<5&&(this.timeToSwitchNextStep=!0),this.isStepDone&&this.timeToSwitchNextStep===!1&&(this.isDone=!0),this.isDone}},{key:"postrun",value:function(){}},{key:"destroy",value:function(){return l(x.prototype.__proto__||Object.getPrototypeOf(x.prototype),"destroy",this).call(this),this}}]),x}(m);i.exports=y},function(i,a,s){i.exports=Object.freeze({animate:!1,refresh:10,maxIterations:2500,maxSimulationTime:5e3,ungrabifyWhileSimulating:!1,fit:!0,padding:30,boundingBox:void 0,ready:function(){},stop:function(){},randomize:!1,infinite:!1})},function(i,a,s){var o=function(){function _(x,E){for(var T=0;T<E.length;T++){var b=E[T];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(x,b.key,b)}}return function(x,E,T){return E&&_(x.prototype,E),T&&_(x,T),x}}();function l(_,x){if(!(_ instanceof x))throw new TypeError("Cannot call a class as a function")}var u=s(2),c=s(17),h=s(19),d=s(20),f=d.setInitialPositionState,p=d.refreshPositions,m=d.getNodePositionData,v=s(21),g=v.multitick,y=function(){function _(x){l(this,_);var E=this.options=u({},c,x),T=this.state=u({},E,{layout:this,nodes:E.eles.nodes(),edges:E.eles.edges(),tickIndex:0,firstUpdate:!0});T.animateEnd=E.animate&&E.animate==="end",T.animateContinuously=E.animate&&!T.animateEnd}return o(_,[{key:"getScratch",value:function(E){var T=this.state.name,b=E.scratch(T);return b||(b={},E.scratch(T,b)),b}},{key:"run",value:function(){var E=this,T=this.state;if(T.tickIndex=0,T.firstUpdate=!0,T.startTime=Date.now(),T.running=!0,T.currentBoundingBox=h(T.boundingBox,T.cy),T.ready&&E.one("ready",T.ready),T.stop&&E.one("stop",T.stop),T.nodes.forEach(function(U){return f(U,T)}),E.prerun(T),T.animateContinuously){var b=function(G){if(!!T.ungrabifyWhileSimulating){var O=m(G,T).grabbable=G.grabbable();O&&G.ungrabify()}},w=function(G){if(!!T.ungrabifyWhileSimulating){var O=m(G,T).grabbable;O&&G.grabify()}},A=function(G){return m(G,T).grabbed=G.grabbed()},S=function(G){var O=G.target;A(O)},C=S,R=function(G){var O=G.target,F=m(O,T),V=O.position();F.x=V.x,F.y=V.y},P=function(G){G.on("grab",S),G.on("free",C),G.on("drag",R)},M=function(G){G.removeListener("grab",S),G.removeListener("free",C),G.removeListener("drag",R)},N=function(){T.fit&&T.animateContinuously&&T.cy.fit(T.padding)},D=function(){p(T.nodes,T),N(),requestAnimationFrame(I)},I=function(){g(T,D,L)},L=function(){p(T.nodes,T),N(),T.nodes.forEach(function(G){w(G),M(G)}),T.running=!1,E.emit("layoutstop")};E.emit("layoutstart"),T.nodes.forEach(function(U){b(U),P(U)}),I()}else{for(var z=!1,B=function(){},k=function(){return z=!0};!z;)g(T,B,k);T.eles.layoutPositions(this,T,function(U){var G=m(U,T);return{x:G.x,y:G.y}})}return E.postrun(T),this}},{key:"prerun",value:function(){}},{key:"postrun",value:function(){}},{key:"tick",value:function(){}},{key:"stop",value:function(){return this.state.running=!1,this}},{key:"destroy",value:function(){return this}}]),_}();i.exports=y},function(i,a,s){i.exports=function(o,l){return o==null?o={x1:0,y1:0,w:l.width(),h:l.height()}:o={x1:o.x1,x2:o.x2,y1:o.y1,y2:o.y2,w:o.w,h:o.h},o.x2==null&&(o.x2=o.x1+o.w),o.w==null&&(o.w=o.x2-o.x1),o.y2==null&&(o.y2=o.y1+o.h),o.h==null&&(o.h=o.y2-o.y1),o}},function(i,a,s){var o=s(2),l=function(d,f){var p=d.position(),m=f.currentBoundingBox,v=d.scratch(f.name);v==null&&(v={},d.scratch(f.name,v)),o(v,f.randomize?{x:m.x1+Math.round(Math.random()*m.w),y:m.y1+Math.round(Math.random()*m.h)}:{x:p.x,y:p.y}),v.locked=d.locked()},u=function(d,f){return d.scratch(f.name)},c=function(d,f){d.positions(function(p){var m=p.scratch(f.name);return{x:m.x,y:m.y}})};i.exports={setInitialPositionState:l,getNodePositionData:u,refreshPositions:c}},function(i,a,s){var o=function(){},l=function(h){var d=h,f=h.layout,p=f.tick(d);return d.firstUpdate&&(d.animateContinuously&&d.layout.emit("layoutready"),d.firstUpdate=!1),d.tickIndex++,!d.infinite&&p},u=function(h){for(var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:o,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:o,p=!1,m=h,v=0;v<m.refresh&&(p=!m.running||l(m),!p);v++);p?f():d()};i.exports={tick:l,multitick:u}}])})})(z3);const zY=CS(z3.exports);var H3={exports:{}},m0={exports:{}},y0={exports:{}},ON;function VY(){return ON||(ON=1,function(r,e){(function(n,i){r.exports=i()})(Ui,function(){return function(t){var n={};function i(a){if(n[a])return n[a].exports;var s=n[a]={i:a,l:!1,exports:{}};return t[a].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=n,i.i=function(a){return a},i.d=function(a,s,o){i.o(a,s)||Object.defineProperty(a,s,{configurable:!1,enumerable:!0,get:o})},i.n=function(a){var s=a&&a.__esModule?function(){return a.default}:function(){return a};return i.d(s,"a",s),s},i.o=function(a,s){return Object.prototype.hasOwnProperty.call(a,s)},i.p="",i(i.s=28)}([function(t,n,i){function a(){}a.QUALITY=1,a.DEFAULT_CREATE_BENDS_AS_NEEDED=!1,a.DEFAULT_INCREMENTAL=!1,a.DEFAULT_ANIMATION_ON_LAYOUT=!0,a.DEFAULT_ANIMATION_DURING_LAYOUT=!1,a.DEFAULT_ANIMATION_PERIOD=50,a.DEFAULT_UNIFORM_LEAF_NODE_SIZES=!1,a.DEFAULT_GRAPH_MARGIN=15,a.NODE_DIMENSIONS_INCLUDE_LABELS=!1,a.SIMPLE_NODE_SIZE=40,a.SIMPLE_NODE_HALF_SIZE=a.SIMPLE_NODE_SIZE/2,a.EMPTY_COMPOUND_NODE_SIZE=40,a.MIN_EDGE_LENGTH=1,a.WORLD_BOUNDARY=1e6,a.INITIAL_WORLD_BOUNDARY=a.WORLD_BOUNDARY/1e3,a.WORLD_CENTER_X=1200,a.WORLD_CENTER_Y=900,t.exports=a},function(t,n,i){var a=i(2),s=i(8),o=i(9);function l(c,h,d){a.call(this,d),this.isOverlapingSourceAndTarget=!1,this.vGraphObject=d,this.bendpoints=[],this.source=c,this.target=h}l.prototype=Object.create(a.prototype);for(var u in a)l[u]=a[u];l.prototype.getSource=function(){return this.source},l.prototype.getTarget=function(){return this.target},l.prototype.isInterGraph=function(){return this.isInterGraph},l.prototype.getLength=function(){return this.length},l.prototype.isOverlapingSourceAndTarget=function(){return this.isOverlapingSourceAndTarget},l.prototype.getBendpoints=function(){return this.bendpoints},l.prototype.getLca=function(){return this.lca},l.prototype.getSourceInLca=function(){return this.sourceInLca},l.prototype.getTargetInLca=function(){return this.targetInLca},l.prototype.getOtherEnd=function(c){if(this.source===c)return this.target;if(this.target===c)return this.source;throw"Node is not incident with this edge"},l.prototype.getOtherEndInGraph=function(c,h){for(var d=this.getOtherEnd(c),f=h.getGraphManager().getRoot();;){if(d.getOwner()==h)return d;if(d.getOwner()==f)break;d=d.getOwner().getParent()}return null},l.prototype.updateLength=function(){var c=new Array(4);this.isOverlapingSourceAndTarget=s.getIntersection(this.target.getRect(),this.source.getRect(),c),this.isOverlapingSourceAndTarget||(this.lengthX=c[0]-c[2],this.lengthY=c[1]-c[3],Math.abs(this.lengthX)<1&&(this.lengthX=o.sign(this.lengthX)),Math.abs(this.lengthY)<1&&(this.lengthY=o.sign(this.lengthY)),this.length=Math.sqrt(this.lengthX*this.lengthX+this.lengthY*this.lengthY))},l.prototype.updateLengthSimple=function(){this.lengthX=this.target.getCenterX()-this.source.getCenterX(),this.lengthY=this.target.getCenterY()-this.source.getCenterY(),Math.abs(this.lengthX)<1&&(this.lengthX=o.sign(this.lengthX)),Math.abs(this.lengthY)<1&&(this.lengthY=o.sign(this.lengthY)),this.length=Math.sqrt(this.lengthX*this.lengthX+this.lengthY*this.lengthY)},t.exports=l},function(t,n,i){function a(s){this.vGraphObject=s}t.exports=a},function(t,n,i){var a=i(2),s=i(10),o=i(13),l=i(0),u=i(16),c=i(5);function h(f,p,m,v){m==null&&v==null&&(v=p),a.call(this,v),f.graphManager!=null&&(f=f.graphManager),this.estimatedSize=s.MIN_VALUE,this.inclusionTreeDepth=s.MAX_VALUE,this.vGraphObject=v,this.edges=[],this.graphManager=f,m!=null&&p!=null?this.rect=new o(p.x,p.y,m.width,m.height):this.rect=new o}h.prototype=Object.create(a.prototype);for(var d in a)h[d]=a[d];h.prototype.getEdges=function(){return this.edges},h.prototype.getChild=function(){return this.child},h.prototype.getOwner=function(){return this.owner},h.prototype.getWidth=function(){return this.rect.width},h.prototype.setWidth=function(f){this.rect.width=f},h.prototype.getHeight=function(){return this.rect.height},h.prototype.setHeight=function(f){this.rect.height=f},h.prototype.getCenterX=function(){return this.rect.x+this.rect.width/2},h.prototype.getCenterY=function(){return this.rect.y+this.rect.height/2},h.prototype.getCenter=function(){return new c(this.rect.x+this.rect.width/2,this.rect.y+this.rect.height/2)},h.prototype.getLocation=function(){return new c(this.rect.x,this.rect.y)},h.prototype.getRect=function(){return this.rect},h.prototype.getDiagonal=function(){return Math.sqrt(this.rect.width*this.rect.width+this.rect.height*this.rect.height)},h.prototype.getHalfTheDiagonal=function(){return Math.sqrt(this.rect.height*this.rect.height+this.rect.width*this.rect.width)/2},h.prototype.setRect=function(f,p){this.rect.x=f.x,this.rect.y=f.y,this.rect.width=p.width,this.rect.height=p.height},h.prototype.setCenter=function(f,p){this.rect.x=f-this.rect.width/2,this.rect.y=p-this.rect.height/2},h.prototype.setLocation=function(f,p){this.rect.x=f,this.rect.y=p},h.prototype.moveBy=function(f,p){this.rect.x+=f,this.rect.y+=p},h.prototype.getEdgeListToNode=function(f){var p=[],m=this;return m.edges.forEach(function(v){if(v.target==f){if(v.source!=m)throw"Incorrect edge source!";p.push(v)}}),p},h.prototype.getEdgesBetween=function(f){var p=[],m=this;return m.edges.forEach(function(v){if(!(v.source==m||v.target==m))throw"Incorrect edge source and/or target";(v.target==f||v.source==f)&&p.push(v)}),p},h.prototype.getNeighborsList=function(){var f=new Set,p=this;return p.edges.forEach(function(m){if(m.source==p)f.add(m.target);else{if(m.target!=p)throw"Incorrect incidency!";f.add(m.source)}}),f},h.prototype.withChildren=function(){var f=new Set,p,m;if(f.add(this),this.child!=null)for(var v=this.child.getNodes(),g=0;g<v.length;g++)p=v[g],m=p.withChildren(),m.forEach(function(y){f.add(y)});return f},h.prototype.getNoOfChildren=function(){var f=0,p;if(this.child==null)f=1;else for(var m=this.child.getNodes(),v=0;v<m.length;v++)p=m[v],f+=p.getNoOfChildren();return f==0&&(f=1),f},h.prototype.getEstimatedSize=function(){if(this.estimatedSize==s.MIN_VALUE)throw"assert failed";return this.estimatedSize},h.prototype.calcEstimatedSize=function(){return this.child==null?this.estimatedSize=(this.rect.width+this.rect.height)/2:(this.estimatedSize=this.child.calcEstimatedSize(),this.rect.width=this.estimatedSize,this.rect.height=this.estimatedSize,this.estimatedSize)},h.prototype.scatter=function(){var f,p,m=-l.INITIAL_WORLD_BOUNDARY,v=l.INITIAL_WORLD_BOUNDARY;f=l.WORLD_CENTER_X+u.nextDouble()*(v-m)+m;var g=-l.INITIAL_WORLD_BOUNDARY,y=l.INITIAL_WORLD_BOUNDARY;p=l.WORLD_CENTER_Y+u.nextDouble()*(y-g)+g,this.rect.x=f,this.rect.y=p},h.prototype.updateBounds=function(){if(this.getChild()==null)throw"assert failed";if(this.getChild().getNodes().length!=0){var f=this.getChild();if(f.updateBounds(!0),this.rect.x=f.getLeft(),this.rect.y=f.getTop(),this.setWidth(f.getRight()-f.getLeft()),this.setHeight(f.getBottom()-f.getTop()),l.NODE_DIMENSIONS_INCLUDE_LABELS){var p=f.getRight()-f.getLeft(),m=f.getBottom()-f.getTop();this.labelWidth&&(this.labelPosHorizontal=="left"?(this.rect.x-=this.labelWidth,this.setWidth(p+this.labelWidth)):this.labelPosHorizontal=="center"&&this.labelWidth>p?(this.rect.x-=(this.labelWidth-p)/2,this.setWidth(this.labelWidth)):this.labelPosHorizontal=="right"&&this.setWidth(p+this.labelWidth)),this.labelHeight&&(this.labelPosVertical=="top"?(this.rect.y-=this.labelHeight,this.setHeight(m+this.labelHeight)):this.labelPosVertical=="center"&&this.labelHeight>m?(this.rect.y-=(this.labelHeight-m)/2,this.setHeight(this.labelHeight)):this.labelPosVertical=="bottom"&&this.setHeight(m+this.labelHeight))}}},h.prototype.getInclusionTreeDepth=function(){if(this.inclusionTreeDepth==s.MAX_VALUE)throw"assert failed";return this.inclusionTreeDepth},h.prototype.transform=function(f){var p=this.rect.x;p>l.WORLD_BOUNDARY?p=l.WORLD_BOUNDARY:p<-l.WORLD_BOUNDARY&&(p=-l.WORLD_BOUNDARY);var m=this.rect.y;m>l.WORLD_BOUNDARY?m=l.WORLD_BOUNDARY:m<-l.WORLD_BOUNDARY&&(m=-l.WORLD_BOUNDARY);var v=new c(p,m),g=f.inverseTransformPoint(v);this.setLocation(g.x,g.y)},h.prototype.getLeft=function(){return this.rect.x},h.prototype.getRight=function(){return this.rect.x+this.rect.width},h.prototype.getTop=function(){return this.rect.y},h.prototype.getBottom=function(){return this.rect.y+this.rect.height},h.prototype.getParent=function(){return this.owner==null?null:this.owner.getParent()},t.exports=h},function(t,n,i){var a=i(0);function s(){}for(var o in a)s[o]=a[o];s.MAX_ITERATIONS=2500,s.DEFAULT_EDGE_LENGTH=50,s.DEFAULT_SPRING_STRENGTH=.45,s.DEFAULT_REPULSION_STRENGTH=4500,s.DEFAULT_GRAVITY_STRENGTH=.4,s.DEFAULT_COMPOUND_GRAVITY_STRENGTH=1,s.DEFAULT_GRAVITY_RANGE_FACTOR=3.8,s.DEFAULT_COMPOUND_GRAVITY_RANGE_FACTOR=1.5,s.DEFAULT_USE_SMART_IDEAL_EDGE_LENGTH_CALCULATION=!0,s.DEFAULT_USE_SMART_REPULSION_RANGE_CALCULATION=!0,s.DEFAULT_COOLING_FACTOR_INCREMENTAL=.3,s.COOLING_ADAPTATION_FACTOR=.33,s.ADAPTATION_LOWER_NODE_LIMIT=1e3,s.ADAPTATION_UPPER_NODE_LIMIT=5e3,s.MAX_NODE_DISPLACEMENT_INCREMENTAL=100,s.MAX_NODE_DISPLACEMENT=s.MAX_NODE_DISPLACEMENT_INCREMENTAL*3,s.MIN_REPULSION_DIST=s.DEFAULT_EDGE_LENGTH/10,s.CONVERGENCE_CHECK_PERIOD=100,s.PER_LEVEL_IDEAL_EDGE_LENGTH_FACTOR=.1,s.MIN_EDGE_LENGTH=1,s.GRID_CALCULATION_CHECK_PERIOD=10,t.exports=s},function(t,n,i){function a(s,o){s==null&&o==null?(this.x=0,this.y=0):(this.x=s,this.y=o)}a.prototype.getX=function(){return this.x},a.prototype.getY=function(){return this.y},a.prototype.setX=function(s){this.x=s},a.prototype.setY=function(s){this.y=s},a.prototype.getDifference=function(s){return new DimensionD(this.x-s.x,this.y-s.y)},a.prototype.getCopy=function(){return new a(this.x,this.y)},a.prototype.translate=function(s){return this.x+=s.width,this.y+=s.height,this},t.exports=a},function(t,n,i){var a=i(2),s=i(10),o=i(0),l=i(7),u=i(3),c=i(1),h=i(13),d=i(12),f=i(11);function p(v,g,y){a.call(this,y),this.estimatedSize=s.MIN_VALUE,this.margin=o.DEFAULT_GRAPH_MARGIN,this.edges=[],this.nodes=[],this.isConnected=!1,this.parent=v,g!=null&&g instanceof l?this.graphManager=g:g!=null&&g instanceof Layout&&(this.graphManager=g.graphManager)}p.prototype=Object.create(a.prototype);for(var m in a)p[m]=a[m];p.prototype.getNodes=function(){return this.nodes},p.prototype.getEdges=function(){return this.edges},p.prototype.getGraphManager=function(){return this.graphManager},p.prototype.getParent=function(){return this.parent},p.prototype.getLeft=function(){return this.left},p.prototype.getRight=function(){return this.right},p.prototype.getTop=function(){return this.top},p.prototype.getBottom=function(){return this.bottom},p.prototype.isConnected=function(){return this.isConnected},p.prototype.add=function(v,g,y){if(g==null&&y==null){var _=v;if(this.graphManager==null)throw"Graph has no graph mgr!";if(this.getNodes().indexOf(_)>-1)throw"Node already in graph!";return _.owner=this,this.getNodes().push(_),_}else{var x=v;if(!(this.getNodes().indexOf(g)>-1&&this.getNodes().indexOf(y)>-1))throw"Source or target not in graph!";if(!(g.owner==y.owner&&g.owner==this))throw"Both owners must be this graph!";return g.owner!=y.owner?null:(x.source=g,x.target=y,x.isInterGraph=!1,this.getEdges().push(x),g.edges.push(x),y!=g&&y.edges.push(x),x)}},p.prototype.remove=function(v){var g=v;if(v instanceof u){if(g==null)throw"Node is null!";if(!(g.owner!=null&&g.owner==this))throw"Owner graph is invalid!";if(this.graphManager==null)throw"Owner graph manager is invalid!";for(var y=g.edges.slice(),_,x=y.length,E=0;E<x;E++)_=y[E],_.isInterGraph?this.graphManager.remove(_):_.source.owner.remove(_);var T=this.nodes.indexOf(g);if(T==-1)throw"Node not in owner node list!";this.nodes.splice(T,1)}else if(v instanceof c){var _=v;if(_==null)throw"Edge is null!";if(!(_.source!=null&&_.target!=null))throw"Source and/or target is null!";if(!(_.source.owner!=null&&_.target.owner!=null&&_.source.owner==this&&_.target.owner==this))throw"Source and/or target owner is invalid!";var b=_.source.edges.indexOf(_),w=_.target.edges.indexOf(_);if(!(b>-1&&w>-1))throw"Source and/or target doesn't know this edge!";_.source.edges.splice(b,1),_.target!=_.source&&_.target.edges.splice(w,1);var T=_.source.owner.getEdges().indexOf(_);if(T==-1)throw"Not in owner's edge list!";_.source.owner.getEdges().splice(T,1)}},p.prototype.updateLeftTop=function(){for(var v=s.MAX_VALUE,g=s.MAX_VALUE,y,_,x,E=this.getNodes(),T=E.length,b=0;b<T;b++){var w=E[b];y=w.getTop(),_=w.getLeft(),v>y&&(v=y),g>_&&(g=_)}return v==s.MAX_VALUE?null:(E[0].getParent().paddingLeft!=null?x=E[0].getParent().paddingLeft:x=this.margin,this.left=g-x,this.top=v-x,new d(this.left,this.top))},p.prototype.updateBounds=function(v){for(var g=s.MAX_VALUE,y=-s.MAX_VALUE,_=s.MAX_VALUE,x=-s.MAX_VALUE,E,T,b,w,A,S=this.nodes,C=S.length,R=0;R<C;R++){var P=S[R];v&&P.child!=null&&P.updateBounds(),E=P.getLeft(),T=P.getRight(),b=P.getTop(),w=P.getBottom(),g>E&&(g=E),y<T&&(y=T),_>b&&(_=b),x<w&&(x=w)}var M=new h(g,_,y-g,x-_);g==s.MAX_VALUE&&(this.left=this.parent.getLeft(),this.right=this.parent.getRight(),this.top=this.parent.getTop(),this.bottom=this.parent.getBottom()),S[0].getParent().paddingLeft!=null?A=S[0].getParent().paddingLeft:A=this.margin,this.left=M.x-A,this.right=M.x+M.width+A,this.top=M.y-A,this.bottom=M.y+M.height+A},p.calculateBounds=function(v){for(var g=s.MAX_VALUE,y=-s.MAX_VALUE,_=s.MAX_VALUE,x=-s.MAX_VALUE,E,T,b,w,A=v.length,S=0;S<A;S++){var C=v[S];E=C.getLeft(),T=C.getRight(),b=C.getTop(),w=C.getBottom(),g>E&&(g=E),y<T&&(y=T),_>b&&(_=b),x<w&&(x=w)}var R=new h(g,_,y-g,x-_);return R},p.prototype.getInclusionTreeDepth=function(){return this==this.graphManager.getRoot()?1:this.parent.getInclusionTreeDepth()},p.prototype.getEstimatedSize=function(){if(this.estimatedSize==s.MIN_VALUE)throw"assert failed";return this.estimatedSize},p.prototype.calcEstimatedSize=function(){for(var v=0,g=this.nodes,y=g.length,_=0;_<y;_++){var x=g[_];v+=x.calcEstimatedSize()}return v==0?this.estimatedSize=o.EMPTY_COMPOUND_NODE_SIZE:this.estimatedSize=v/Math.sqrt(this.nodes.length),this.estimatedSize},p.prototype.updateConnected=function(){var v=this;if(this.nodes.length==0){this.isConnected=!0;return}var g=new f,y=new Set,_=this.nodes[0],x,E,T=_.withChildren();for(T.forEach(function(R){g.push(R),y.add(R)});g.length!==0;){_=g.shift(),x=_.getEdges();for(var b=x.length,w=0;w<b;w++){var A=x[w];if(E=A.getOtherEndInGraph(_,this),E!=null&&!y.has(E)){var S=E.withChildren();S.forEach(function(R){g.push(R),y.add(R)})}}}if(this.isConnected=!1,y.size>=this.nodes.length){var C=0;y.forEach(function(R){R.owner==v&&C++}),C==this.nodes.length&&(this.isConnected=!0)}},t.exports=p},function(t,n,i){var a,s=i(1);function o(l){a=i(6),this.layout=l,this.graphs=[],this.edges=[]}o.prototype.addRoot=function(){var l=this.layout.newGraph(),u=this.layout.newNode(null),c=this.add(l,u);return this.setRootGraph(c),this.rootGraph},o.prototype.add=function(l,u,c,h,d){if(c==null&&h==null&&d==null){if(l==null)throw"Graph is null!";if(u==null)throw"Parent node is null!";if(this.graphs.indexOf(l)>-1)throw"Graph already in this graph mgr!";if(this.graphs.push(l),l.parent!=null)throw"Already has a parent!";if(u.child!=null)throw"Already has a child!";return l.parent=u,u.child=l,l}else{d=c,h=u,c=l;var f=h.getOwner(),p=d.getOwner();if(!(f!=null&&f.getGraphManager()==this))throw"Source not in this graph mgr!";if(!(p!=null&&p.getGraphManager()==this))throw"Target not in this graph mgr!";if(f==p)return c.isInterGraph=!1,f.add(c,h,d);if(c.isInterGraph=!0,c.source=h,c.target=d,this.edges.indexOf(c)>-1)throw"Edge already in inter-graph edge list!";if(this.edges.push(c),!(c.source!=null&&c.target!=null))throw"Edge source and/or target is null!";if(!(c.source.edges.indexOf(c)==-1&&c.target.edges.indexOf(c)==-1))throw"Edge already in source and/or target incidency list!";return c.source.edges.push(c),c.target.edges.push(c),c}},o.prototype.remove=function(l){if(l instanceof a){var u=l;if(u.getGraphManager()!=this)throw"Graph not in this graph mgr";if(!(u==this.rootGraph||u.parent!=null&&u.parent.graphManager==this))throw"Invalid parent node!";var c=[];c=c.concat(u.getEdges());for(var h,d=c.length,f=0;f<d;f++)h=c[f],u.remove(h);var p=[];p=p.concat(u.getNodes());var m;d=p.length;for(var f=0;f<d;f++)m=p[f],u.remove(m);u==this.rootGraph&&this.setRootGraph(null);var v=this.graphs.indexOf(u);this.graphs.splice(v,1),u.parent=null}else if(l instanceof s){if(h=l,h==null)throw"Edge is null!";if(!h.isInterGraph)throw"Not an inter-graph edge!";if(!(h.source!=null&&h.target!=null))throw"Source and/or target is null!";if(!(h.source.edges.indexOf(h)!=-1&&h.target.edges.indexOf(h)!=-1))throw"Source and/or target doesn't know this edge!";var v=h.source.edges.indexOf(h);if(h.source.edges.splice(v,1),v=h.target.edges.indexOf(h),h.target.edges.splice(v,1),!(h.source.owner!=null&&h.source.owner.getGraphManager()!=null))throw"Edge owner graph or owner graph manager is null!";if(h.source.owner.getGraphManager().edges.indexOf(h)==-1)throw"Not in owner graph manager's edge list!";var v=h.source.owner.getGraphManager().edges.indexOf(h);h.source.owner.getGraphManager().edges.splice(v,1)}},o.prototype.updateBounds=function(){this.rootGraph.updateBounds(!0)},o.prototype.getGraphs=function(){return this.graphs},o.prototype.getAllNodes=function(){if(this.allNodes==null){for(var l=[],u=this.getGraphs(),c=u.length,h=0;h<c;h++)l=l.concat(u[h].getNodes());this.allNodes=l}return this.allNodes},o.prototype.resetAllNodes=function(){this.allNodes=null},o.prototype.resetAllEdges=function(){this.allEdges=null},o.prototype.resetAllNodesToApplyGravitation=function(){this.allNodesToApplyGravitation=null},o.prototype.getAllEdges=function(){if(this.allEdges==null){var l=[],u=this.getGraphs();u.length;for(var c=0;c<u.length;c++)l=l.concat(u[c].getEdges());l=l.concat(this.edges),this.allEdges=l}return this.allEdges},o.prototype.getAllNodesToApplyGravitation=function(){return this.allNodesToApplyGravitation},o.prototype.setAllNodesToApplyGravitation=function(l){if(this.allNodesToApplyGravitation!=null)throw"assert failed";this.allNodesToApplyGravitation=l},o.prototype.getRoot=function(){return this.rootGraph},o.prototype.setRootGraph=function(l){if(l.getGraphManager()!=this)throw"Root not in this graph mgr!";this.rootGraph=l,l.parent==null&&(l.parent=this.layout.newNode("Root node"))},o.prototype.getLayout=function(){return this.layout},o.prototype.isOneAncestorOfOther=function(l,u){if(!(l!=null&&u!=null))throw"assert failed";if(l==u)return!0;var c=l.getOwner(),h;do{if(h=c.getParent(),h==null)break;if(h==u)return!0;if(c=h.getOwner(),c==null)break}while(!0);c=u.getOwner();do{if(h=c.getParent(),h==null)break;if(h==l)return!0;if(c=h.getOwner(),c==null)break}while(!0);return!1},o.prototype.calcLowestCommonAncestors=function(){for(var l,u,c,h,d,f=this.getAllEdges(),p=f.length,m=0;m<p;m++){if(l=f[m],u=l.source,c=l.target,l.lca=null,l.sourceInLca=u,l.targetInLca=c,u==c){l.lca=u.getOwner();continue}for(h=u.getOwner();l.lca==null;){for(l.targetInLca=c,d=c.getOwner();l.lca==null;){if(d==h){l.lca=d;break}if(d==this.rootGraph)break;if(l.lca!=null)throw"assert failed";l.targetInLca=d.getParent(),d=l.targetInLca.getOwner()}if(h==this.rootGraph)break;l.lca==null&&(l.sourceInLca=h.getParent(),h=l.sourceInLca.getOwner())}if(l.lca==null)throw"assert failed"}},o.prototype.calcLowestCommonAncestor=function(l,u){if(l==u)return l.getOwner();var c=l.getOwner();do{if(c==null)break;var h=u.getOwner();do{if(h==null)break;if(h==c)return h;h=h.getParent().getOwner()}while(!0);c=c.getParent().getOwner()}while(!0);return c},o.prototype.calcInclusionTreeDepths=function(l,u){l==null&&u==null&&(l=this.rootGraph,u=1);for(var c,h=l.getNodes(),d=h.length,f=0;f<d;f++)c=h[f],c.inclusionTreeDepth=u,c.child!=null&&this.calcInclusionTreeDepths(c.child,u+1)},o.prototype.includesInvalidEdge=function(){for(var l,u=[],c=this.edges.length,h=0;h<c;h++)l=this.edges[h],this.isOneAncestorOfOther(l.source,l.target)&&u.push(l);for(var h=0;h<u.length;h++)this.remove(u[h]);return!1},t.exports=o},function(t,n,i){var a=i(12);function s(){}s.calcSeparationAmount=function(o,l,u,c){if(!o.intersects(l))throw"assert failed";var h=new Array(2);this.decideDirectionsForOverlappingNodes(o,l,h),u[0]=Math.min(o.getRight(),l.getRight())-Math.max(o.x,l.x),u[1]=Math.min(o.getBottom(),l.getBottom())-Math.max(o.y,l.y),o.getX()<=l.getX()&&o.getRight()>=l.getRight()?u[0]+=Math.min(l.getX()-o.getX(),o.getRight()-l.getRight()):l.getX()<=o.getX()&&l.getRight()>=o.getRight()&&(u[0]+=Math.min(o.getX()-l.getX(),l.getRight()-o.getRight())),o.getY()<=l.getY()&&o.getBottom()>=l.getBottom()?u[1]+=Math.min(l.getY()-o.getY(),o.getBottom()-l.getBottom()):l.getY()<=o.getY()&&l.getBottom()>=o.getBottom()&&(u[1]+=Math.min(o.getY()-l.getY(),l.getBottom()-o.getBottom()));var d=Math.abs((l.getCenterY()-o.getCenterY())/(l.getCenterX()-o.getCenterX()));l.getCenterY()===o.getCenterY()&&l.getCenterX()===o.getCenterX()&&(d=1);var f=d*u[0],p=u[1]/d;u[0]<p?p=u[0]:f=u[1],u[0]=-1*h[0]*(p/2+c),u[1]=-1*h[1]*(f/2+c)},s.decideDirectionsForOverlappingNodes=function(o,l,u){o.getCenterX()<l.getCenterX()?u[0]=-1:u[0]=1,o.getCenterY()<l.getCenterY()?u[1]=-1:u[1]=1},s.getIntersection2=function(o,l,u){var c=o.getCenterX(),h=o.getCenterY(),d=l.getCenterX(),f=l.getCenterY();if(o.intersects(l))return u[0]=c,u[1]=h,u[2]=d,u[3]=f,!0;var p=o.getX(),m=o.getY(),v=o.getRight(),g=o.getX(),y=o.getBottom(),_=o.getRight(),x=o.getWidthHalf(),E=o.getHeightHalf(),T=l.getX(),b=l.getY(),w=l.getRight(),A=l.getX(),S=l.getBottom(),C=l.getRight(),R=l.getWidthHalf(),P=l.getHeightHalf(),M=!1,N=!1;if(c===d){if(h>f)return u[0]=c,u[1]=m,u[2]=d,u[3]=S,!1;if(h<f)return u[0]=c,u[1]=y,u[2]=d,u[3]=b,!1}else if(h===f){if(c>d)return u[0]=p,u[1]=h,u[2]=w,u[3]=f,!1;if(c<d)return u[0]=v,u[1]=h,u[2]=T,u[3]=f,!1}else{var D=o.height/o.width,I=l.height/l.width,L=(f-h)/(d-c),z=void 0,B=void 0,k=void 0,U=void 0,G=void 0,O=void 0;if(-D===L?c>d?(u[0]=g,u[1]=y,M=!0):(u[0]=v,u[1]=m,M=!0):D===L&&(c>d?(u[0]=p,u[1]=m,M=!0):(u[0]=_,u[1]=y,M=!0)),-I===L?d>c?(u[2]=A,u[3]=S,N=!0):(u[2]=w,u[3]=b,N=!0):I===L&&(d>c?(u[2]=T,u[3]=b,N=!0):(u[2]=C,u[3]=S,N=!0)),M&&N)return!1;if(c>d?h>f?(z=this.getCardinalDirection(D,L,4),B=this.getCardinalDirection(I,L,2)):(z=this.getCardinalDirection(-D,L,3),B=this.getCardinalDirection(-I,L,1)):h>f?(z=this.getCardinalDirection(-D,L,1),B=this.getCardinalDirection(-I,L,3)):(z=this.getCardinalDirection(D,L,2),B=this.getCardinalDirection(I,L,4)),!M)switch(z){case 1:U=m,k=c+-E/L,u[0]=k,u[1]=U;break;case 2:k=_,U=h+x*L,u[0]=k,u[1]=U;break;case 3:U=y,k=c+E/L,u[0]=k,u[1]=U;break;case 4:k=g,U=h+-x*L,u[0]=k,u[1]=U;break}if(!N)switch(B){case 1:O=b,G=d+-P/L,u[2]=G,u[3]=O;break;case 2:G=C,O=f+R*L,u[2]=G,u[3]=O;break;case 3:O=S,G=d+P/L,u[2]=G,u[3]=O;break;case 4:G=A,O=f+-R*L,u[2]=G,u[3]=O;break}}return!1},s.getCardinalDirection=function(o,l,u){return o>l?u:1+u%4},s.getIntersection=function(o,l,u,c){if(c==null)return this.getIntersection2(o,l,u);var h=o.x,d=o.y,f=l.x,p=l.y,m=u.x,v=u.y,g=c.x,y=c.y,_=void 0,x=void 0,E=void 0,T=void 0,b=void 0,w=void 0,A=void 0,S=void 0,C=void 0;return E=p-d,b=h-f,A=f*d-h*p,T=y-v,w=m-g,S=g*v-m*y,C=E*w-T*b,C===0?null:(_=(b*S-w*A)/C,x=(T*A-E*S)/C,new a(_,x))},s.angleOfVector=function(o,l,u,c){var h=void 0;return o!==u?(h=Math.atan((c-l)/(u-o)),u<o?h+=Math.PI:c<l&&(h+=this.TWO_PI)):c<l?h=this.ONE_AND_HALF_PI:h=this.HALF_PI,h},s.doIntersect=function(o,l,u,c){var h=o.x,d=o.y,f=l.x,p=l.y,m=u.x,v=u.y,g=c.x,y=c.y,_=(f-h)*(y-v)-(g-m)*(p-d);if(_===0)return!1;var x=((y-v)*(g-h)+(m-g)*(y-d))/_,E=((d-p)*(g-h)+(f-h)*(y-d))/_;return 0<x&&x<1&&0<E&&E<1},s.findCircleLineIntersections=function(o,l,u,c,h,d,f){var p=(u-o)*(u-o)+(c-l)*(c-l),m=2*((o-h)*(u-o)+(l-d)*(c-l)),v=(o-h)*(o-h)+(l-d)*(l-d)-f*f,g=m*m-4*p*v;if(g>=0){var y=(-m+Math.sqrt(m*m-4*p*v))/(2*p),_=(-m-Math.sqrt(m*m-4*p*v))/(2*p),x=null;return y>=0&&y<=1?[y]:_>=0&&_<=1?[_]:x}else return null},s.HALF_PI=.5*Math.PI,s.ONE_AND_HALF_PI=1.5*Math.PI,s.TWO_PI=2*Math.PI,s.THREE_PI=3*Math.PI,t.exports=s},function(t,n,i){function a(){}a.sign=function(s){return s>0?1:s<0?-1:0},a.floor=function(s){return s<0?Math.ceil(s):Math.floor(s)},a.ceil=function(s){return s<0?Math.floor(s):Math.ceil(s)},t.exports=a},function(t,n,i){function a(){}a.MAX_VALUE=2147483647,a.MIN_VALUE=-2147483648,t.exports=a},function(t,n,i){var a=function(){function h(d,f){for(var p=0;p<f.length;p++){var m=f[p];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(d,m.key,m)}}return function(d,f,p){return f&&h(d.prototype,f),p&&h(d,p),d}}();function s(h,d){if(!(h instanceof d))throw new TypeError("Cannot call a class as a function")}var o=function(d){return{value:d,next:null,prev:null}},l=function(d,f,p,m){return d!==null?d.next=f:m.head=f,p!==null?p.prev=f:m.tail=f,f.prev=d,f.next=p,m.length++,f},u=function(d,f){var p=d.prev,m=d.next;return p!==null?p.next=m:f.head=m,m!==null?m.prev=p:f.tail=p,d.prev=d.next=null,f.length--,d},c=function(){function h(d){var f=this;s(this,h),this.length=0,this.head=null,this.tail=null,d!=null&&d.forEach(function(p){return f.push(p)})}return a(h,[{key:"size",value:function(){return this.length}},{key:"insertBefore",value:function(f,p){return l(p.prev,o(f),p,this)}},{key:"insertAfter",value:function(f,p){return l(p,o(f),p.next,this)}},{key:"insertNodeBefore",value:function(f,p){return l(p.prev,f,p,this)}},{key:"insertNodeAfter",value:function(f,p){return l(p,f,p.next,this)}},{key:"push",value:function(f){return l(this.tail,o(f),null,this)}},{key:"unshift",value:function(f){return l(null,o(f),this.head,this)}},{key:"remove",value:function(f){return u(f,this)}},{key:"pop",value:function(){return u(this.tail,this).value}},{key:"popNode",value:function(){return u(this.tail,this)}},{key:"shift",value:function(){return u(this.head,this).value}},{key:"shiftNode",value:function(){return u(this.head,this)}},{key:"get_object_at",value:function(f){if(f<=this.length()){for(var p=1,m=this.head;p<f;)m=m.next,p++;return m.value}}},{key:"set_object_at",value:function(f,p){if(f<=this.length()){for(var m=1,v=this.head;m<f;)v=v.next,m++;v.value=p}}}]),h}();t.exports=c},function(t,n,i){function a(s,o,l){this.x=null,this.y=null,s==null&&o==null&&l==null?(this.x=0,this.y=0):typeof s=="number"&&typeof o=="number"&&l==null?(this.x=s,this.y=o):s.constructor.name=="Point"&&o==null&&l==null&&(l=s,this.x=l.x,this.y=l.y)}a.prototype.getX=function(){return this.x},a.prototype.getY=function(){return this.y},a.prototype.getLocation=function(){return new a(this.x,this.y)},a.prototype.setLocation=function(s,o,l){s.constructor.name=="Point"&&o==null&&l==null?(l=s,this.setLocation(l.x,l.y)):typeof s=="number"&&typeof o=="number"&&l==null&&(parseInt(s)==s&&parseInt(o)==o?this.move(s,o):(this.x=Math.floor(s+.5),this.y=Math.floor(o+.5)))},a.prototype.move=function(s,o){this.x=s,this.y=o},a.prototype.translate=function(s,o){this.x+=s,this.y+=o},a.prototype.equals=function(s){if(s.constructor.name=="Point"){var o=s;return this.x==o.x&&this.y==o.y}return this==s},a.prototype.toString=function(){return new a().constructor.name+"[x="+this.x+",y="+this.y+"]"},t.exports=a},function(t,n,i){function a(s,o,l,u){this.x=0,this.y=0,this.width=0,this.height=0,s!=null&&o!=null&&l!=null&&u!=null&&(this.x=s,this.y=o,this.width=l,this.height=u)}a.prototype.getX=function(){return this.x},a.prototype.setX=function(s){this.x=s},a.prototype.getY=function(){return this.y},a.prototype.setY=function(s){this.y=s},a.prototype.getWidth=function(){return this.width},a.prototype.setWidth=function(s){this.width=s},a.prototype.getHeight=function(){return this.height},a.prototype.setHeight=function(s){this.height=s},a.prototype.getRight=function(){return this.x+this.width},a.prototype.getBottom=function(){return this.y+this.height},a.prototype.intersects=function(s){return!(this.getRight()<s.x||this.getBottom()<s.y||s.getRight()<this.x||s.getBottom()<this.y)},a.prototype.getCenterX=function(){return this.x+this.width/2},a.prototype.getMinX=function(){return this.getX()},a.prototype.getMaxX=function(){return this.getX()+this.width},a.prototype.getCenterY=function(){return this.y+this.height/2},a.prototype.getMinY=function(){return this.getY()},a.prototype.getMaxY=function(){return this.getY()+this.height},a.prototype.getWidthHalf=function(){return this.width/2},a.prototype.getHeightHalf=function(){return this.height/2},t.exports=a},function(t,n,i){var a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o};function s(){}s.lastID=0,s.createID=function(o){return s.isPrimitive(o)?o:(o.uniqueID!=null||(o.uniqueID=s.getString(),s.lastID++),o.uniqueID)},s.getString=function(o){return o==null&&(o=s.lastID),"Object#"+o},s.isPrimitive=function(o){var l=typeof o>"u"?"undefined":a(o);return o==null||l!="object"&&l!="function"},t.exports=s},function(t,n,i){function a(m){if(Array.isArray(m)){for(var v=0,g=Array(m.length);v<m.length;v++)g[v]=m[v];return g}else return Array.from(m)}var s=i(0),o=i(7),l=i(3),u=i(1),c=i(6),h=i(5),d=i(17),f=i(29);function p(m){f.call(this),this.layoutQuality=s.QUALITY,this.createBendsAsNeeded=s.DEFAULT_CREATE_BENDS_AS_NEEDED,this.incremental=s.DEFAULT_INCREMENTAL,this.animationOnLayout=s.DEFAULT_ANIMATION_ON_LAYOUT,this.animationDuringLayout=s.DEFAULT_ANIMATION_DURING_LAYOUT,this.animationPeriod=s.DEFAULT_ANIMATION_PERIOD,this.uniformLeafNodeSizes=s.DEFAULT_UNIFORM_LEAF_NODE_SIZES,this.edgeToDummyNodes=new Map,this.graphManager=new o(this),this.isLayoutFinished=!1,this.isSubLayout=!1,this.isRemoteUse=!1,m!=null&&(this.isRemoteUse=m)}p.RANDOM_SEED=1,p.prototype=Object.create(f.prototype),p.prototype.getGraphManager=function(){return this.graphManager},p.prototype.getAllNodes=function(){return this.graphManager.getAllNodes()},p.prototype.getAllEdges=function(){return this.graphManager.getAllEdges()},p.prototype.getAllNodesToApplyGravitation=function(){return this.graphManager.getAllNodesToApplyGravitation()},p.prototype.newGraphManager=function(){var m=new o(this);return this.graphManager=m,m},p.prototype.newGraph=function(m){return new c(null,this.graphManager,m)},p.prototype.newNode=function(m){return new l(this.graphManager,m)},p.prototype.newEdge=function(m){return new u(null,null,m)},p.prototype.checkLayoutSuccess=function(){return this.graphManager.getRoot()==null||this.graphManager.getRoot().getNodes().length==0||this.graphManager.includesInvalidEdge()},p.prototype.runLayout=function(){this.isLayoutFinished=!1,this.tilingPreLayout&&this.tilingPreLayout(),this.initParameters();var m;return this.checkLayoutSuccess()?m=!1:m=this.layout(),s.ANIMATE==="during"?!1:(m&&(this.isSubLayout||this.doPostLayout()),this.tilingPostLayout&&this.tilingPostLayout(),this.isLayoutFinished=!0,m)},p.prototype.doPostLayout=function(){this.incremental||this.transform(),this.update()},p.prototype.update2=function(){if(this.createBendsAsNeeded&&(this.createBendpointsFromDummyNodes(),this.graphManager.resetAllEdges()),!this.isRemoteUse){for(var m=this.graphManager.getAllEdges(),v=0;v<m.length;v++)m[v];for(var g=this.graphManager.getRoot().getNodes(),v=0;v<g.length;v++)g[v];this.update(this.graphManager.getRoot())}},p.prototype.update=function(m){if(m==null)this.update2();else if(m instanceof l){var v=m;if(v.getChild()!=null)for(var g=v.getChild().getNodes(),y=0;y<g.length;y++)update(g[y]);if(v.vGraphObject!=null){var _=v.vGraphObject;_.update(v)}}else if(m instanceof u){var x=m;if(x.vGraphObject!=null){var E=x.vGraphObject;E.update(x)}}else if(m instanceof c){var T=m;if(T.vGraphObject!=null){var b=T.vGraphObject;b.update(T)}}},p.prototype.initParameters=function(){this.isSubLayout||(this.layoutQuality=s.QUALITY,this.animationDuringLayout=s.DEFAULT_ANIMATION_DURING_LAYOUT,this.animationPeriod=s.DEFAULT_ANIMATION_PERIOD,this.animationOnLayout=s.DEFAULT_ANIMATION_ON_LAYOUT,this.incremental=s.DEFAULT_INCREMENTAL,this.createBendsAsNeeded=s.DEFAULT_CREATE_BENDS_AS_NEEDED,this.uniformLeafNodeSizes=s.DEFAULT_UNIFORM_LEAF_NODE_SIZES),this.animationDuringLayout&&(this.animationOnLayout=!1)},p.prototype.transform=function(m){if(m==null)this.transform(new h(0,0));else{var v=new d,g=this.graphManager.getRoot().updateLeftTop();if(g!=null){v.setWorldOrgX(m.x),v.setWorldOrgY(m.y),v.setDeviceOrgX(g.x),v.setDeviceOrgY(g.y);for(var y=this.getAllNodes(),_,x=0;x<y.length;x++)_=y[x],_.transform(v)}}},p.prototype.positionNodesRandomly=function(m){if(m==null)this.positionNodesRandomly(this.getGraphManager().getRoot()),this.getGraphManager().getRoot().updateBounds(!0);else for(var v,g,y=m.getNodes(),_=0;_<y.length;_++)v=y[_],g=v.getChild(),g==null||g.getNodes().length==0?v.scatter():(this.positionNodesRandomly(g),v.updateBounds())},p.prototype.getFlatForest=function(){for(var m=[],v=!0,g=this.graphManager.getRoot().getNodes(),y=!0,_=0;_<g.length;_++)g[_].getChild()!=null&&(y=!1);if(!y)return m;var x=new Set,E=[],T=new Map,b=[];for(b=b.concat(g);b.length>0&&v;){for(E.push(b[0]);E.length>0&&v;){var w=E[0];E.splice(0,1),x.add(w);for(var A=w.getEdges(),_=0;_<A.length;_++){var S=A[_].getOtherEnd(w);if(T.get(w)!=S)if(!x.has(S))E.push(S),T.set(S,w);else{v=!1;break}}}if(!v)m=[];else{var C=[].concat(a(x));m.push(C);for(var _=0;_<C.length;_++){var R=C[_],P=b.indexOf(R);P>-1&&b.splice(P,1)}x=new Set,T=new Map}}return m},p.prototype.createDummyNodesForBendpoints=function(m){for(var v=[],g=m.source,y=this.graphManager.calcLowestCommonAncestor(m.source,m.target),_=0;_<m.bendpoints.length;_++){var x=this.newNode(null);x.setRect(new Point(0,0),new Dimension(1,1)),y.add(x);var E=this.newEdge(null);this.graphManager.add(E,g,x),v.add(x),g=x}var E=this.newEdge(null);return this.graphManager.add(E,g,m.target),this.edgeToDummyNodes.set(m,v),m.isInterGraph()?this.graphManager.remove(m):y.remove(m),v},p.prototype.createBendpointsFromDummyNodes=function(){var m=[];m=m.concat(this.graphManager.getAllEdges()),m=[].concat(a(this.edgeToDummyNodes.keys())).concat(m);for(var v=0;v<m.length;v++){var g=m[v];if(g.bendpoints.length>0){for(var y=this.edgeToDummyNodes.get(g),_=0;_<y.length;_++){var x=y[_],E=new h(x.getCenterX(),x.getCenterY()),T=g.bendpoints.get(_);T.x=E.x,T.y=E.y,x.getOwner().remove(x)}this.graphManager.add(g,g.source,g.target)}}},p.transform=function(m,v,g,y){if(g!=null&&y!=null){var _=v;if(m<=50){var x=v/g;_-=(v-x)/50*(50-m)}else{var E=v*y;_+=(E-v)/50*(m-50)}return _}else{var T,b;return m<=50?(T=9*v/500,b=v/10):(T=9*v/50,b=-8*v),T*m+b}},p.findCenterOfTree=function(m){var v=[];v=v.concat(m);var g=[],y=new Map,_=!1,x=null;(v.length==1||v.length==2)&&(_=!0,x=v[0]);for(var E=0;E<v.length;E++){var T=v[E],b=T.getNeighborsList().size;y.set(T,T.getNeighborsList().size),b==1&&g.push(T)}var w=[];for(w=w.concat(g);!_;){var A=[];A=A.concat(w),w=[];for(var E=0;E<v.length;E++){var T=v[E],S=v.indexOf(T);S>=0&&v.splice(S,1);var C=T.getNeighborsList();C.forEach(function(M){if(g.indexOf(M)<0){var N=y.get(M),D=N-1;D==1&&w.push(M),y.set(M,D)}})}g=g.concat(w),(v.length==1||v.length==2)&&(_=!0,x=v[0])}return x},p.prototype.setGraphManager=function(m){this.graphManager=m},t.exports=p},function(t,n,i){function a(){}a.seed=1,a.x=0,a.nextDouble=function(){return a.x=Math.sin(a.seed++)*1e4,a.x-Math.floor(a.x)},t.exports=a},function(t,n,i){var a=i(5);function s(o,l){this.lworldOrgX=0,this.lworldOrgY=0,this.ldeviceOrgX=0,this.ldeviceOrgY=0,this.lworldExtX=1,this.lworldExtY=1,this.ldeviceExtX=1,this.ldeviceExtY=1}s.prototype.getWorldOrgX=function(){return this.lworldOrgX},s.prototype.setWorldOrgX=function(o){this.lworldOrgX=o},s.prototype.getWorldOrgY=function(){return this.lworldOrgY},s.prototype.setWorldOrgY=function(o){this.lworldOrgY=o},s.prototype.getWorldExtX=function(){return this.lworldExtX},s.prototype.setWorldExtX=function(o){this.lworldExtX=o},s.prototype.getWorldExtY=function(){return this.lworldExtY},s.prototype.setWorldExtY=function(o){this.lworldExtY=o},s.prototype.getDeviceOrgX=function(){return this.ldeviceOrgX},s.prototype.setDeviceOrgX=function(o){this.ldeviceOrgX=o},s.prototype.getDeviceOrgY=function(){return this.ldeviceOrgY},s.prototype.setDeviceOrgY=function(o){this.ldeviceOrgY=o},s.prototype.getDeviceExtX=function(){return this.ldeviceExtX},s.prototype.setDeviceExtX=function(o){this.ldeviceExtX=o},s.prototype.getDeviceExtY=function(){return this.ldeviceExtY},s.prototype.setDeviceExtY=function(o){this.ldeviceExtY=o},s.prototype.transformX=function(o){var l=0,u=this.lworldExtX;return u!=0&&(l=this.ldeviceOrgX+(o-this.lworldOrgX)*this.ldeviceExtX/u),l},s.prototype.transformY=function(o){var l=0,u=this.lworldExtY;return u!=0&&(l=this.ldeviceOrgY+(o-this.lworldOrgY)*this.ldeviceExtY/u),l},s.prototype.inverseTransformX=function(o){var l=0,u=this.ldeviceExtX;return u!=0&&(l=this.lworldOrgX+(o-this.ldeviceOrgX)*this.lworldExtX/u),l},s.prototype.inverseTransformY=function(o){var l=0,u=this.ldeviceExtY;return u!=0&&(l=this.lworldOrgY+(o-this.ldeviceOrgY)*this.lworldExtY/u),l},s.prototype.inverseTransformPoint=function(o){var l=new a(this.inverseTransformX(o.x),this.inverseTransformY(o.y));return l},t.exports=s},function(t,n,i){function a(f){if(Array.isArray(f)){for(var p=0,m=Array(f.length);p<f.length;p++)m[p]=f[p];return m}else return Array.from(f)}var s=i(15),o=i(4),l=i(0),u=i(8),c=i(9);function h(){s.call(this),this.useSmartIdealEdgeLengthCalculation=o.DEFAULT_USE_SMART_IDEAL_EDGE_LENGTH_CALCULATION,this.gravityConstant=o.DEFAULT_GRAVITY_STRENGTH,this.compoundGravityConstant=o.DEFAULT_COMPOUND_GRAVITY_STRENGTH,this.gravityRangeFactor=o.DEFAULT_GRAVITY_RANGE_FACTOR,this.compoundGravityRangeFactor=o.DEFAULT_COMPOUND_GRAVITY_RANGE_FACTOR,this.displacementThresholdPerNode=3*o.DEFAULT_EDGE_LENGTH/100,this.coolingFactor=o.DEFAULT_COOLING_FACTOR_INCREMENTAL,this.initialCoolingFactor=o.DEFAULT_COOLING_FACTOR_INCREMENTAL,this.totalDisplacement=0,this.oldTotalDisplacement=0,this.maxIterations=o.MAX_ITERATIONS}h.prototype=Object.create(s.prototype);for(var d in s)h[d]=s[d];h.prototype.initParameters=function(){s.prototype.initParameters.call(this,arguments),this.totalIterations=0,this.notAnimatedIterations=0,this.useFRGridVariant=o.DEFAULT_USE_SMART_REPULSION_RANGE_CALCULATION,this.grid=[]},h.prototype.calcIdealEdgeLengths=function(){for(var f,p,m,v,g,y,_,x=this.getGraphManager().getAllEdges(),E=0;E<x.length;E++)f=x[E],p=f.idealLength,f.isInterGraph&&(v=f.getSource(),g=f.getTarget(),y=f.getSourceInLca().getEstimatedSize(),_=f.getTargetInLca().getEstimatedSize(),this.useSmartIdealEdgeLengthCalculation&&(f.idealLength+=y+_-2*l.SIMPLE_NODE_SIZE),m=f.getLca().getInclusionTreeDepth(),f.idealLength+=p*o.PER_LEVEL_IDEAL_EDGE_LENGTH_FACTOR*(v.getInclusionTreeDepth()+g.getInclusionTreeDepth()-2*m))},h.prototype.initSpringEmbedder=function(){var f=this.getAllNodes().length;this.incremental?(f>o.ADAPTATION_LOWER_NODE_LIMIT&&(this.coolingFactor=Math.max(this.coolingFactor*o.COOLING_ADAPTATION_FACTOR,this.coolingFactor-(f-o.ADAPTATION_LOWER_NODE_LIMIT)/(o.ADAPTATION_UPPER_NODE_LIMIT-o.ADAPTATION_LOWER_NODE_LIMIT)*this.coolingFactor*(1-o.COOLING_ADAPTATION_FACTOR))),this.maxNodeDisplacement=o.MAX_NODE_DISPLACEMENT_INCREMENTAL):(f>o.ADAPTATION_LOWER_NODE_LIMIT?this.coolingFactor=Math.max(o.COOLING_ADAPTATION_FACTOR,1-(f-o.ADAPTATION_LOWER_NODE_LIMIT)/(o.ADAPTATION_UPPER_NODE_LIMIT-o.ADAPTATION_LOWER_NODE_LIMIT)*(1-o.COOLING_ADAPTATION_FACTOR)):this.coolingFactor=1,this.initialCoolingFactor=this.coolingFactor,this.maxNodeDisplacement=o.MAX_NODE_DISPLACEMENT),this.maxIterations=Math.max(this.getAllNodes().length*5,this.maxIterations),this.displacementThresholdPerNode=3*o.DEFAULT_EDGE_LENGTH/100,this.totalDisplacementThreshold=this.displacementThresholdPerNode*this.getAllNodes().length,this.repulsionRange=this.calcRepulsionRange()},h.prototype.calcSpringForces=function(){for(var f=this.getAllEdges(),p,m=0;m<f.length;m++)p=f[m],this.calcSpringForce(p,p.idealLength)},h.prototype.calcRepulsionForces=function(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,m,v,g,y,_=this.getAllNodes(),x;if(this.useFRGridVariant)for(this.totalIterations%o.GRID_CALCULATION_CHECK_PERIOD==1&&f&&this.updateGrid(),x=new Set,m=0;m<_.length;m++)g=_[m],this.calculateRepulsionForceOfANode(g,x,f,p),x.add(g);else for(m=0;m<_.length;m++)for(g=_[m],v=m+1;v<_.length;v++)y=_[v],g.getOwner()==y.getOwner()&&this.calcRepulsionForce(g,y)},h.prototype.calcGravitationalForces=function(){for(var f,p=this.getAllNodesToApplyGravitation(),m=0;m<p.length;m++)f=p[m],this.calcGravitationalForce(f)},h.prototype.moveNodes=function(){for(var f=this.getAllNodes(),p,m=0;m<f.length;m++)p=f[m],p.move()},h.prototype.calcSpringForce=function(f,p){var m=f.getSource(),v=f.getTarget(),g,y,_,x;if(this.uniformLeafNodeSizes&&m.getChild()==null&&v.getChild()==null)f.updateLengthSimple();else if(f.updateLength(),f.isOverlapingSourceAndTarget)return;g=f.getLength(),g!=0&&(y=f.edgeElasticity*(g-p),_=y*(f.lengthX/g),x=y*(f.lengthY/g),m.springForceX+=_,m.springForceY+=x,v.springForceX-=_,v.springForceY-=x)},h.prototype.calcRepulsionForce=function(f,p){var m=f.getRect(),v=p.getRect(),g=new Array(2),y=new Array(4),_,x,E,T,b,w,A;if(m.intersects(v)){u.calcSeparationAmount(m,v,g,o.DEFAULT_EDGE_LENGTH/2),w=2*g[0],A=2*g[1];var S=f.noOfChildren*p.noOfChildren/(f.noOfChildren+p.noOfChildren);f.repulsionForceX-=S*w,f.repulsionForceY-=S*A,p.repulsionForceX+=S*w,p.repulsionForceY+=S*A}else this.uniformLeafNodeSizes&&f.getChild()==null&&p.getChild()==null?(_=v.getCenterX()-m.getCenterX(),x=v.getCenterY()-m.getCenterY()):(u.getIntersection(m,v,y),_=y[2]-y[0],x=y[3]-y[1]),Math.abs(_)<o.MIN_REPULSION_DIST&&(_=c.sign(_)*o.MIN_REPULSION_DIST),Math.abs(x)<o.MIN_REPULSION_DIST&&(x=c.sign(x)*o.MIN_REPULSION_DIST),E=_*_+x*x,T=Math.sqrt(E),b=(f.nodeRepulsion/2+p.nodeRepulsion/2)*f.noOfChildren*p.noOfChildren/E,w=b*_/T,A=b*x/T,f.repulsionForceX-=w,f.repulsionForceY-=A,p.repulsionForceX+=w,p.repulsionForceY+=A},h.prototype.calcGravitationalForce=function(f){var p,m,v,g,y,_,x,E;p=f.getOwner(),m=(p.getRight()+p.getLeft())/2,v=(p.getTop()+p.getBottom())/2,g=f.getCenterX()-m,y=f.getCenterY()-v,_=Math.abs(g)+f.getWidth()/2,x=Math.abs(y)+f.getHeight()/2,f.getOwner()==this.graphManager.getRoot()?(E=p.getEstimatedSize()*this.gravityRangeFactor,(_>E||x>E)&&(f.gravitationForceX=-this.gravityConstant*g,f.gravitationForceY=-this.gravityConstant*y)):(E=p.getEstimatedSize()*this.compoundGravityRangeFactor,(_>E||x>E)&&(f.gravitationForceX=-this.gravityConstant*g*this.compoundGravityConstant,f.gravitationForceY=-this.gravityConstant*y*this.compoundGravityConstant))},h.prototype.isConverged=function(){var f,p=!1;return this.totalIterations>this.maxIterations/3&&(p=Math.abs(this.totalDisplacement-this.oldTotalDisplacement)<2),f=this.totalDisplacement<this.totalDisplacementThreshold,this.oldTotalDisplacement=this.totalDisplacement,f||p},h.prototype.animate=function(){this.animationDuringLayout&&!this.isSubLayout&&(this.notAnimatedIterations==this.animationPeriod?(this.update(),this.notAnimatedIterations=0):this.notAnimatedIterations++)},h.prototype.calcNoOfChildrenForAllNodes=function(){for(var f,p=this.graphManager.getAllNodes(),m=0;m<p.length;m++)f=p[m],f.noOfChildren=f.getNoOfChildren()},h.prototype.calcGrid=function(f){var p=0,m=0;p=parseInt(Math.ceil((f.getRight()-f.getLeft())/this.repulsionRange)),m=parseInt(Math.ceil((f.getBottom()-f.getTop())/this.repulsionRange));for(var v=new Array(p),g=0;g<p;g++)v[g]=new Array(m);for(var g=0;g<p;g++)for(var y=0;y<m;y++)v[g][y]=new Array;return v},h.prototype.addNodeToGrid=function(f,p,m){var v=0,g=0,y=0,_=0;v=parseInt(Math.floor((f.getRect().x-p)/this.repulsionRange)),g=parseInt(Math.floor((f.getRect().width+f.getRect().x-p)/this.repulsionRange)),y=parseInt(Math.floor((f.getRect().y-m)/this.repulsionRange)),_=parseInt(Math.floor((f.getRect().height+f.getRect().y-m)/this.repulsionRange));for(var x=v;x<=g;x++)for(var E=y;E<=_;E++)this.grid[x][E].push(f),f.setGridCoordinates(v,g,y,_)},h.prototype.updateGrid=function(){var f,p,m=this.getAllNodes();for(this.grid=this.calcGrid(this.graphManager.getRoot()),f=0;f<m.length;f++)p=m[f],this.addNodeToGrid(p,this.graphManager.getRoot().getLeft(),this.graphManager.getRoot().getTop())},h.prototype.calculateRepulsionForceOfANode=function(f,p,m,v){if(this.totalIterations%o.GRID_CALCULATION_CHECK_PERIOD==1&&m||v){var g=new Set;f.surrounding=new Array;for(var y,_=this.grid,x=f.startX-1;x<f.finishX+2;x++)for(var E=f.startY-1;E<f.finishY+2;E++)if(!(x<0||E<0||x>=_.length||E>=_[0].length)){for(var T=0;T<_[x][E].length;T++)if(y=_[x][E][T],!(f.getOwner()!=y.getOwner()||f==y)&&!p.has(y)&&!g.has(y)){var b=Math.abs(f.getCenterX()-y.getCenterX())-(f.getWidth()/2+y.getWidth()/2),w=Math.abs(f.getCenterY()-y.getCenterY())-(f.getHeight()/2+y.getHeight()/2);b<=this.repulsionRange&&w<=this.repulsionRange&&g.add(y)}}f.surrounding=[].concat(a(g))}for(x=0;x<f.surrounding.length;x++)this.calcRepulsionForce(f,f.surrounding[x])},h.prototype.calcRepulsionRange=function(){return 0},t.exports=h},function(t,n,i){var a=i(1),s=i(4);function o(u,c,h){a.call(this,u,c,h),this.idealLength=s.DEFAULT_EDGE_LENGTH,this.edgeElasticity=s.DEFAULT_SPRING_STRENGTH}o.prototype=Object.create(a.prototype);for(var l in a)o[l]=a[l];t.exports=o},function(t,n,i){var a=i(3),s=i(4);function o(u,c,h,d){a.call(this,u,c,h,d),this.nodeRepulsion=s.DEFAULT_REPULSION_STRENGTH,this.springForceX=0,this.springForceY=0,this.repulsionForceX=0,this.repulsionForceY=0,this.gravitationForceX=0,this.gravitationForceY=0,this.displacementX=0,this.displacementY=0,this.startX=0,this.finishX=0,this.startY=0,this.finishY=0,this.surrounding=[]}o.prototype=Object.create(a.prototype);for(var l in a)o[l]=a[l];o.prototype.setGridCoordinates=function(u,c,h,d){this.startX=u,this.finishX=c,this.startY=h,this.finishY=d},t.exports=o},function(t,n,i){function a(s,o){this.width=0,this.height=0,s!==null&&o!==null&&(this.height=o,this.width=s)}a.prototype.getWidth=function(){return this.width},a.prototype.setWidth=function(s){this.width=s},a.prototype.getHeight=function(){return this.height},a.prototype.setHeight=function(s){this.height=s},t.exports=a},function(t,n,i){var a=i(14);function s(){this.map={},this.keys=[]}s.prototype.put=function(o,l){var u=a.createID(o);this.contains(u)||(this.map[u]=l,this.keys.push(o))},s.prototype.contains=function(o){return a.createID(o),this.map[o]!=null},s.prototype.get=function(o){var l=a.createID(o);return this.map[l]},s.prototype.keySet=function(){return this.keys},t.exports=s},function(t,n,i){var a=i(14);function s(){this.set={}}s.prototype.add=function(o){var l=a.createID(o);this.contains(l)||(this.set[l]=o)},s.prototype.remove=function(o){delete this.set[a.createID(o)]},s.prototype.clear=function(){this.set={}},s.prototype.contains=function(o){return this.set[a.createID(o)]==o},s.prototype.isEmpty=function(){return this.size()===0},s.prototype.size=function(){return Object.keys(this.set).length},s.prototype.addAllTo=function(o){for(var l=Object.keys(this.set),u=l.length,c=0;c<u;c++)o.push(this.set[l[c]])},s.prototype.size=function(){return Object.keys(this.set).length},s.prototype.addAll=function(o){for(var l=o.length,u=0;u<l;u++){var c=o[u];this.add(c)}},t.exports=s},function(t,n,i){function a(){}a.multMat=function(s,o){for(var l=[],u=0;u<s.length;u++){l[u]=[];for(var c=0;c<o[0].length;c++){l[u][c]=0;for(var h=0;h<s[0].length;h++)l[u][c]+=s[u][h]*o[h][c]}}return l},a.transpose=function(s){for(var o=[],l=0;l<s[0].length;l++){o[l]=[];for(var u=0;u<s.length;u++)o[l][u]=s[u][l]}return o},a.multCons=function(s,o){for(var l=[],u=0;u<s.length;u++)l[u]=s[u]*o;return l},a.minusOp=function(s,o){for(var l=[],u=0;u<s.length;u++)l[u]=s[u]-o[u];return l},a.dotProduct=function(s,o){for(var l=0,u=0;u<s.length;u++)l+=s[u]*o[u];return l},a.mag=function(s){return Math.sqrt(this.dotProduct(s,s))},a.normalize=function(s){for(var o=[],l=this.mag(s),u=0;u<s.length;u++)o[u]=s[u]/l;return o},a.multGamma=function(s){for(var o=[],l=0,u=0;u<s.length;u++)l+=s[u];l*=-1/s.length;for(var c=0;c<s.length;c++)o[c]=l+s[c];return o},a.multL=function(s,o,l){for(var u=[],c=[],h=[],d=0;d<o[0].length;d++){for(var f=0,p=0;p<o.length;p++)f+=-.5*o[p][d]*s[p];c[d]=f}for(var m=0;m<l.length;m++){for(var v=0,g=0;g<l.length;g++)v+=l[m][g]*c[g];h[m]=v}for(var y=0;y<o.length;y++){for(var _=0,x=0;x<o[0].length;x++)_+=o[y][x]*h[x];u[y]=_}return u},t.exports=a},function(t,n,i){var a=function(){function u(c,h){for(var d=0;d<h.length;d++){var f=h[d];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(c,f.key,f)}}return function(c,h,d){return h&&u(c.prototype,h),d&&u(c,d),c}}();function s(u,c){if(!(u instanceof c))throw new TypeError("Cannot call a class as a function")}var o=i(11),l=function(){function u(c,h){s(this,u),(h!==null||h!==void 0)&&(this.compareFunction=this._defaultCompareFunction);var d=void 0;c instanceof o?d=c.size():d=c.length,this._quicksort(c,0,d-1)}return a(u,[{key:"_quicksort",value:function(h,d,f){if(d<f){var p=this._partition(h,d,f);this._quicksort(h,d,p),this._quicksort(h,p+1,f)}}},{key:"_partition",value:function(h,d,f){for(var p=this._get(h,d),m=d,v=f;;){for(;this.compareFunction(p,this._get(h,v));)v--;for(;this.compareFunction(this._get(h,m),p);)m++;if(m<v)this._swap(h,m,v),m++,v--;else return v}}},{key:"_get",value:function(h,d){return h instanceof o?h.get_object_at(d):h[d]}},{key:"_set",value:function(h,d,f){h instanceof o?h.set_object_at(d,f):h[d]=f}},{key:"_swap",value:function(h,d,f){var p=this._get(h,d);this._set(h,d,this._get(h,f)),this._set(h,f,p)}},{key:"_defaultCompareFunction",value:function(h,d){return d>h}}]),u}();t.exports=l},function(t,n,i){function a(){}a.svd=function(s){this.U=null,this.V=null,this.s=null,this.m=0,this.n=0,this.m=s.length,this.n=s[0].length;var o=Math.min(this.m,this.n);this.s=function(gt){for(var vt=[];gt-- >0;)vt.push(0);return vt}(Math.min(this.m+1,this.n)),this.U=function(gt){var vt=function pn(Ft){if(Ft.length==0)return 0;for(var Gt=[],Rt=0;Rt<Ft[0];Rt++)Gt.push(pn(Ft.slice(1)));return Gt};return vt(gt)}([this.m,o]),this.V=function(gt){var vt=function pn(Ft){if(Ft.length==0)return 0;for(var Gt=[],Rt=0;Rt<Ft[0];Rt++)Gt.push(pn(Ft.slice(1)));return Gt};return vt(gt)}([this.n,this.n]);for(var l=function(gt){for(var vt=[];gt-- >0;)vt.push(0);return vt}(this.n),u=function(gt){for(var vt=[];gt-- >0;)vt.push(0);return vt}(this.m),c=!0,h=Math.min(this.m-1,this.n),d=Math.max(0,Math.min(this.n-2,this.m)),f=0;f<Math.max(h,d);f++){if(f<h){this.s[f]=0;for(var p=f;p<this.m;p++)this.s[f]=a.hypot(this.s[f],s[p][f]);if(this.s[f]!==0){s[f][f]<0&&(this.s[f]=-this.s[f]);for(var m=f;m<this.m;m++)s[m][f]/=this.s[f];s[f][f]+=1}this.s[f]=-this.s[f]}for(var v=f+1;v<this.n;v++){if(function(gt,vt){return gt&&vt}(f<h,this.s[f]!==0)){for(var g=0,y=f;y<this.m;y++)g+=s[y][f]*s[y][v];g=-g/s[f][f];for(var _=f;_<this.m;_++)s[_][v]+=g*s[_][f]}l[v]=s[f][v]}if(function(gt,vt){return gt&&vt}(c,f<h))for(var x=f;x<this.m;x++)this.U[x][f]=s[x][f];if(f<d){l[f]=0;for(var E=f+1;E<this.n;E++)l[f]=a.hypot(l[f],l[E]);if(l[f]!==0){l[f+1]<0&&(l[f]=-l[f]);for(var T=f+1;T<this.n;T++)l[T]/=l[f];l[f+1]+=1}if(l[f]=-l[f],function(gt,vt){return gt&&vt}(f+1<this.m,l[f]!==0)){for(var b=f+1;b<this.m;b++)u[b]=0;for(var w=f+1;w<this.n;w++)for(var A=f+1;A<this.m;A++)u[A]+=l[w]*s[A][w];for(var S=f+1;S<this.n;S++)for(var C=-l[S]/l[f+1],R=f+1;R<this.m;R++)s[R][S]+=C*u[R]}for(var P=f+1;P<this.n;P++)this.V[P][f]=l[P]}}var M=Math.min(this.n,this.m+1);h<this.n&&(this.s[h]=s[h][h]),this.m<M&&(this.s[M-1]=0),d+1<M&&(l[d]=s[d][M-1]),l[M-1]=0;{for(var N=h;N<o;N++){for(var D=0;D<this.m;D++)this.U[D][N]=0;this.U[N][N]=1}for(var I=h-1;I>=0;I--)if(this.s[I]!==0){for(var L=I+1;L<o;L++){for(var z=0,B=I;B<this.m;B++)z+=this.U[B][I]*this.U[B][L];z=-z/this.U[I][I];for(var k=I;k<this.m;k++)this.U[k][L]+=z*this.U[k][I]}for(var U=I;U<this.m;U++)this.U[U][I]=-this.U[U][I];this.U[I][I]=1+this.U[I][I];for(var G=0;G<I-1;G++)this.U[G][I]=0}else{for(var O=0;O<this.m;O++)this.U[O][I]=0;this.U[I][I]=1}}for(var F=this.n-1;F>=0;F--){if(function(gt,vt){return gt&&vt}(F<d,l[F]!==0))for(var V=F+1;V<o;V++){for(var $=0,Z=F+1;Z<this.n;Z++)$+=this.V[Z][F]*this.V[Z][V];$=-$/this.V[F+1][F];for(var Y=F+1;Y<this.n;Y++)this.V[Y][V]+=$*this.V[Y][F]}for(var X=0;X<this.n;X++)this.V[X][F]=0;this.V[F][F]=1}for(var K=M-1,se=Math.pow(2,-52),oe=Math.pow(2,-966);M>0;){var W=void 0,Ne=void 0;for(W=M-2;W>=-1&&W!==-1;W--)if(Math.abs(l[W])<=oe+se*(Math.abs(this.s[W])+Math.abs(this.s[W+1]))){l[W]=0;break}if(W===M-2)Ne=4;else{var Be=void 0;for(Be=M-1;Be>=W&&Be!==W;Be--){var we=(Be!==M?Math.abs(l[Be]):0)+(Be!==W+1?Math.abs(l[Be-1]):0);if(Math.abs(this.s[Be])<=oe+se*we){this.s[Be]=0;break}}Be===W?Ne=3:Be===M-1?Ne=1:(Ne=2,W=Be)}switch(W++,Ne){case 1:{var pe=l[M-2];l[M-2]=0;for(var Me=M-2;Me>=W;Me--){var Ae=a.hypot(this.s[Me],pe),j=this.s[Me]/Ae,H=pe/Ae;this.s[Me]=Ae,Me!==W&&(pe=-H*l[Me-1],l[Me-1]=j*l[Me-1]);for(var te=0;te<this.n;te++)Ae=j*this.V[te][Me]+H*this.V[te][M-1],this.V[te][M-1]=-H*this.V[te][Me]+j*this.V[te][M-1],this.V[te][Me]=Ae}}break;case 2:{var me=l[W-1];l[W-1]=0;for(var Ee=W;Ee<M;Ee++){var le=a.hypot(this.s[Ee],me),q=this.s[Ee]/le,ne=me/le;this.s[Ee]=le,me=-ne*l[Ee],l[Ee]=q*l[Ee];for(var fe=0;fe<this.m;fe++)le=q*this.U[fe][Ee]+ne*this.U[fe][W-1],this.U[fe][W-1]=-ne*this.U[fe][Ee]+q*this.U[fe][W-1],this.U[fe][Ee]=le}}break;case 3:{var ce=Math.max(Math.max(Math.max(Math.max(Math.abs(this.s[M-1]),Math.abs(this.s[M-2])),Math.abs(l[M-2])),Math.abs(this.s[W])),Math.abs(l[W])),ae=this.s[M-1]/ce,ie=this.s[M-2]/ce,ee=l[M-2]/ce,he=this.s[W]/ce,ge=l[W]/ce,Te=((ie+ae)*(ie-ae)+ee*ee)/2,Se=ae*ee*(ae*ee),Oe=0;(function(gt,vt){return gt||vt})(Te!==0,Se!==0)&&(Oe=Math.sqrt(Te*Te+Se),Te<0&&(Oe=-Oe),Oe=Se/(Te+Oe));for(var J=(he+ae)*(he-ae)+Oe,ve=he*ge,ue=W;ue<M-1;ue++){var _e=a.hypot(J,ve),ke=J/_e,Ie=ve/_e;ue!==W&&(l[ue-1]=_e),J=ke*this.s[ue]+Ie*l[ue],l[ue]=ke*l[ue]-Ie*this.s[ue],ve=Ie*this.s[ue+1],this.s[ue+1]=ke*this.s[ue+1];for(var je=0;je<this.n;je++)_e=ke*this.V[je][ue]+Ie*this.V[je][ue+1],this.V[je][ue+1]=-Ie*this.V[je][ue]+ke*this.V[je][ue+1],this.V[je][ue]=_e;if(_e=a.hypot(J,ve),ke=J/_e,Ie=ve/_e,this.s[ue]=_e,J=ke*l[ue]+Ie*this.s[ue+1],this.s[ue+1]=-Ie*l[ue]+ke*this.s[ue+1],ve=Ie*l[ue+1],l[ue+1]=ke*l[ue+1],ue<this.m-1)for(var $e=0;$e<this.m;$e++)_e=ke*this.U[$e][ue]+Ie*this.U[$e][ue+1],this.U[$e][ue+1]=-Ie*this.U[$e][ue]+ke*this.U[$e][ue+1],this.U[$e][ue]=_e}l[M-2]=J}break;case 4:{if(this.s[W]<=0){this.s[W]=this.s[W]<0?-this.s[W]:0;for(var Xe=0;Xe<=K;Xe++)this.V[Xe][W]=-this.V[Xe][W]}for(;W<K&&!(this.s[W]>=this.s[W+1]);){var Je=this.s[W];if(this.s[W]=this.s[W+1],this.s[W+1]=Je,W<this.n-1)for(var nt=0;nt<this.n;nt++)Je=this.V[nt][W+1],this.V[nt][W+1]=this.V[nt][W],this.V[nt][W]=Je;if(W<this.m-1)for(var at=0;at<this.m;at++)Je=this.U[at][W+1],this.U[at][W+1]=this.U[at][W],this.U[at][W]=Je;W++}M--}break}}var Xt={U:this.U,V:this.V,S:this.s};return Xt},a.hypot=function(s,o){var l=void 0;return Math.abs(s)>Math.abs(o)?(l=o/s,l=Math.abs(s)*Math.sqrt(1+l*l)):o!=0?(l=s/o,l=Math.abs(o)*Math.sqrt(1+l*l)):l=0,l},t.exports=a},function(t,n,i){var a=function(){function l(u,c){for(var h=0;h<c.length;h++){var d=c[h];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(u,d.key,d)}}return function(u,c,h){return c&&l(u.prototype,c),h&&l(u,h),u}}();function s(l,u){if(!(l instanceof u))throw new TypeError("Cannot call a class as a function")}var o=function(){function l(u,c){var h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:-1,f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:-1;s(this,l),this.sequence1=u,this.sequence2=c,this.match_score=h,this.mismatch_penalty=d,this.gap_penalty=f,this.iMax=u.length+1,this.jMax=c.length+1,this.grid=new Array(this.iMax);for(var p=0;p<this.iMax;p++){this.grid[p]=new Array(this.jMax);for(var m=0;m<this.jMax;m++)this.grid[p][m]=0}this.tracebackGrid=new Array(this.iMax);for(var v=0;v<this.iMax;v++){this.tracebackGrid[v]=new Array(this.jMax);for(var g=0;g<this.jMax;g++)this.tracebackGrid[v][g]=[null,null,null]}this.alignments=[],this.score=-1,this.computeGrids()}return a(l,[{key:"getScore",value:function(){return this.score}},{key:"getAlignments",value:function(){return this.alignments}},{key:"computeGrids",value:function(){for(var c=1;c<this.jMax;c++)this.grid[0][c]=this.grid[0][c-1]+this.gap_penalty,this.tracebackGrid[0][c]=[!1,!1,!0];for(var h=1;h<this.iMax;h++)this.grid[h][0]=this.grid[h-1][0]+this.gap_penalty,this.tracebackGrid[h][0]=[!1,!0,!1];for(var d=1;d<this.iMax;d++)for(var f=1;f<this.jMax;f++){var p=void 0;this.sequence1[d-1]===this.sequence2[f-1]?p=this.grid[d-1][f-1]+this.match_score:p=this.grid[d-1][f-1]+this.mismatch_penalty;var m=this.grid[d-1][f]+this.gap_penalty,v=this.grid[d][f-1]+this.gap_penalty,g=[p,m,v],y=this.arrayAllMaxIndexes(g);this.grid[d][f]=g[y[0]],this.tracebackGrid[d][f]=[y.includes(0),y.includes(1),y.includes(2)]}this.score=this.grid[this.iMax-1][this.jMax-1]}},{key:"alignmentTraceback",value:function(){var c=[];for(c.push({pos:[this.sequence1.length,this.sequence2.length],seq1:"",seq2:""});c[0];){var h=c[0],d=this.tracebackGrid[h.pos[0]][h.pos[1]];d[0]&&c.push({pos:[h.pos[0]-1,h.pos[1]-1],seq1:this.sequence1[h.pos[0]-1]+h.seq1,seq2:this.sequence2[h.pos[1]-1]+h.seq2}),d[1]&&c.push({pos:[h.pos[0]-1,h.pos[1]],seq1:this.sequence1[h.pos[0]-1]+h.seq1,seq2:"-"+h.seq2}),d[2]&&c.push({pos:[h.pos[0],h.pos[1]-1],seq1:"-"+h.seq1,seq2:this.sequence2[h.pos[1]-1]+h.seq2}),h.pos[0]===0&&h.pos[1]===0&&this.alignments.push({sequence1:h.seq1,sequence2:h.seq2}),c.shift()}return this.alignments}},{key:"getAllIndexes",value:function(c,h){for(var d=[],f=-1;(f=c.indexOf(h,f+1))!==-1;)d.push(f);return d}},{key:"arrayAllMaxIndexes",value:function(c){return this.getAllIndexes(c,Math.max.apply(null,c))}}]),l}();t.exports=o},function(t,n,i){var a=function(){};a.FDLayout=i(18),a.FDLayoutConstants=i(4),a.FDLayoutEdge=i(19),a.FDLayoutNode=i(20),a.DimensionD=i(21),a.HashMap=i(22),a.HashSet=i(23),a.IGeometry=i(8),a.IMath=i(9),a.Integer=i(10),a.Point=i(12),a.PointD=i(5),a.RandomSeed=i(16),a.RectangleD=i(13),a.Transform=i(17),a.UniqueIDGeneretor=i(14),a.Quicksort=i(25),a.LinkedList=i(11),a.LGraphObject=i(2),a.LGraph=i(6),a.LEdge=i(1),a.LGraphManager=i(7),a.LNode=i(3),a.Layout=i(15),a.LayoutConstants=i(0),a.NeedlemanWunsch=i(27),a.Matrix=i(24),a.SVD=i(26),t.exports=a},function(t,n,i){function a(){this.listeners=[]}var s=a.prototype;s.addListener=function(o,l){this.listeners.push({event:o,callback:l})},s.removeListener=function(o,l){for(var u=this.listeners.length;u>=0;u--){var c=this.listeners[u];c.event===o&&c.callback===l&&this.listeners.splice(u,1)}},s.emit=function(o,l){for(var u=0;u<this.listeners.length;u++){var c=this.listeners[u];o===c.event&&c.callback(l)}},t.exports=a}])})}(y0)),y0.exports}var FN;function HY(){return FN||(FN=1,function(r,e){(function(n,i){r.exports=i(VY())})(Ui,function(t){return(()=>{var n={45:(o,l,u)=>{var c={};c.layoutBase=u(551),c.CoSEConstants=u(806),c.CoSEEdge=u(767),c.CoSEGraph=u(880),c.CoSEGraphManager=u(578),c.CoSELayout=u(765),c.CoSENode=u(991),c.ConstraintHandler=u(902),o.exports=c},806:(o,l,u)=>{var c=u(551).FDLayoutConstants;function h(){}for(var d in c)h[d]=c[d];h.DEFAULT_USE_MULTI_LEVEL_SCALING=!1,h.DEFAULT_RADIAL_SEPARATION=c.DEFAULT_EDGE_LENGTH,h.DEFAULT_COMPONENT_SEPERATION=60,h.TILE=!0,h.TILING_PADDING_VERTICAL=10,h.TILING_PADDING_HORIZONTAL=10,h.TRANSFORM_ON_CONSTRAINT_HANDLING=!0,h.ENFORCE_CONSTRAINTS=!0,h.APPLY_LAYOUT=!0,h.RELAX_MOVEMENT_ON_CONSTRAINTS=!0,h.TREE_REDUCTION_ON_INCREMENTAL=!0,h.PURE_INCREMENTAL=h.DEFAULT_INCREMENTAL,o.exports=h},767:(o,l,u)=>{var c=u(551).FDLayoutEdge;function h(f,p,m){c.call(this,f,p,m)}h.prototype=Object.create(c.prototype);for(var d in c)h[d]=c[d];o.exports=h},880:(o,l,u)=>{var c=u(551).LGraph;function h(f,p,m){c.call(this,f,p,m)}h.prototype=Object.create(c.prototype);for(var d in c)h[d]=c[d];o.exports=h},578:(o,l,u)=>{var c=u(551).LGraphManager;function h(f){c.call(this,f)}h.prototype=Object.create(c.prototype);for(var d in c)h[d]=c[d];o.exports=h},765:(o,l,u)=>{var c=u(551).FDLayout,h=u(578),d=u(880),f=u(991),p=u(767),m=u(806),v=u(902),g=u(551).FDLayoutConstants,y=u(551).LayoutConstants,_=u(551).Point,x=u(551).PointD,E=u(551).DimensionD,T=u(551).Layout,b=u(551).Integer,w=u(551).IGeometry,A=u(551).LGraph,S=u(551).Transform,C=u(551).LinkedList;function R(){c.call(this),this.toBeTiled={},this.constraints={}}R.prototype=Object.create(c.prototype);for(var P in c)R[P]=c[P];R.prototype.newGraphManager=function(){var M=new h(this);return this.graphManager=M,M},R.prototype.newGraph=function(M){return new d(null,this.graphManager,M)},R.prototype.newNode=function(M){return new f(this.graphManager,M)},R.prototype.newEdge=function(M){return new p(null,null,M)},R.prototype.initParameters=function(){c.prototype.initParameters.call(this,arguments),this.isSubLayout||(m.DEFAULT_EDGE_LENGTH<10?this.idealEdgeLength=10:this.idealEdgeLength=m.DEFAULT_EDGE_LENGTH,this.useSmartIdealEdgeLengthCalculation=m.DEFAULT_USE_SMART_IDEAL_EDGE_LENGTH_CALCULATION,this.gravityConstant=g.DEFAULT_GRAVITY_STRENGTH,this.compoundGravityConstant=g.DEFAULT_COMPOUND_GRAVITY_STRENGTH,this.gravityRangeFactor=g.DEFAULT_GRAVITY_RANGE_FACTOR,this.compoundGravityRangeFactor=g.DEFAULT_COMPOUND_GRAVITY_RANGE_FACTOR,this.prunedNodesAll=[],this.growTreeIterations=0,this.afterGrowthIterations=0,this.isTreeGrowing=!1,this.isGrowthFinished=!1)},R.prototype.initSpringEmbedder=function(){c.prototype.initSpringEmbedder.call(this),this.coolingCycle=0,this.maxCoolingCycle=this.maxIterations/g.CONVERGENCE_CHECK_PERIOD,this.finalTemperature=.04,this.coolingAdjuster=1},R.prototype.layout=function(){var M=y.DEFAULT_CREATE_BENDS_AS_NEEDED;return M&&(this.createBendpoints(),this.graphManager.resetAllEdges()),this.level=0,this.classicLayout()},R.prototype.classicLayout=function(){if(this.nodesWithGravity=this.calculateNodesToApplyGravitationTo(),this.graphManager.setAllNodesToApplyGravitation(this.nodesWithGravity),this.calcNoOfChildrenForAllNodes(),this.graphManager.calcLowestCommonAncestors(),this.graphManager.calcInclusionTreeDepths(),this.graphManager.getRoot().calcEstimatedSize(),this.calcIdealEdgeLengths(),this.incremental){if(m.TREE_REDUCTION_ON_INCREMENTAL){this.reduceTrees(),this.graphManager.resetAllNodesToApplyGravitation();var N=new Set(this.getAllNodes()),D=this.nodesWithGravity.filter(function(z){return N.has(z)});this.graphManager.setAllNodesToApplyGravitation(D)}}else{var M=this.getFlatForest();if(M.length>0)this.positionNodesRadially(M);else{this.reduceTrees(),this.graphManager.resetAllNodesToApplyGravitation();var N=new Set(this.getAllNodes()),D=this.nodesWithGravity.filter(function(I){return N.has(I)});this.graphManager.setAllNodesToApplyGravitation(D),this.positionNodesRandomly()}}return Object.keys(this.constraints).length>0&&(v.handleConstraints(this),this.initConstraintVariables()),this.initSpringEmbedder(),m.APPLY_LAYOUT&&this.runSpringEmbedder(),!0},R.prototype.tick=function(){if(this.totalIterations++,this.totalIterations===this.maxIterations&&!this.isTreeGrowing&&!this.isGrowthFinished)if(this.prunedNodesAll.length>0)this.isTreeGrowing=!0;else return!0;if(this.totalIterations%g.CONVERGENCE_CHECK_PERIOD==0&&!this.isTreeGrowing&&!this.isGrowthFinished){if(this.isConverged())if(this.prunedNodesAll.length>0)this.isTreeGrowing=!0;else return!0;this.coolingCycle++,this.layoutQuality==0?this.coolingAdjuster=this.coolingCycle:this.layoutQuality==1&&(this.coolingAdjuster=this.coolingCycle/3),this.coolingFactor=Math.max(this.initialCoolingFactor-Math.pow(this.coolingCycle,Math.log(100*(this.initialCoolingFactor-this.finalTemperature))/Math.log(this.maxCoolingCycle))/100*this.coolingAdjuster,this.finalTemperature),this.animationPeriod=Math.ceil(this.initialAnimationPeriod*Math.sqrt(this.coolingFactor))}if(this.isTreeGrowing){if(this.growTreeIterations%10==0)if(this.prunedNodesAll.length>0){this.graphManager.updateBounds(),this.updateGrid(),this.growTree(this.prunedNodesAll),this.graphManager.resetAllNodesToApplyGravitation();var M=new Set(this.getAllNodes()),N=this.nodesWithGravity.filter(function(L){return M.has(L)});this.graphManager.setAllNodesToApplyGravitation(N),this.graphManager.updateBounds(),this.updateGrid(),m.PURE_INCREMENTAL?this.coolingFactor=g.DEFAULT_COOLING_FACTOR_INCREMENTAL/2:this.coolingFactor=g.DEFAULT_COOLING_FACTOR_INCREMENTAL}else this.isTreeGrowing=!1,this.isGrowthFinished=!0;this.growTreeIterations++}if(this.isGrowthFinished){if(this.isConverged())return!0;this.afterGrowthIterations%10==0&&(this.graphManager.updateBounds(),this.updateGrid()),m.PURE_INCREMENTAL?this.coolingFactor=g.DEFAULT_COOLING_FACTOR_INCREMENTAL/2*((100-this.afterGrowthIterations)/100):this.coolingFactor=g.DEFAULT_COOLING_FACTOR_INCREMENTAL*((100-this.afterGrowthIterations)/100),this.afterGrowthIterations++}var D=!this.isTreeGrowing&&!this.isGrowthFinished,I=this.growTreeIterations%10==1&&this.isTreeGrowing||this.afterGrowthIterations%10==1&&this.isGrowthFinished;return this.totalDisplacement=0,this.graphManager.updateBounds(),this.calcSpringForces(),this.calcRepulsionForces(D,I),this.calcGravitationalForces(),this.moveNodes(),this.animate(),!1},R.prototype.getPositionsData=function(){for(var M=this.graphManager.getAllNodes(),N={},D=0;D<M.length;D++){var I=M[D].rect,L=M[D].id;N[L]={id:L,x:I.getCenterX(),y:I.getCenterY(),w:I.width,h:I.height}}return N},R.prototype.runSpringEmbedder=function(){this.initialAnimationPeriod=25,this.animationPeriod=this.initialAnimationPeriod;var M=!1;if(g.ANIMATE==="during")this.emit("layoutstarted");else{for(;!M;)M=this.tick();this.graphManager.updateBounds()}},R.prototype.moveNodes=function(){for(var M=this.getAllNodes(),N,D=0;D<M.length;D++)N=M[D],N.calculateDisplacement();Object.keys(this.constraints).length>0&&this.updateDisplacements();for(var D=0;D<M.length;D++)N=M[D],N.move()},R.prototype.initConstraintVariables=function(){var M=this;this.idToNodeMap=new Map,this.fixedNodeSet=new Set;for(var N=this.graphManager.getAllNodes(),D=0;D<N.length;D++){var I=N[D];this.idToNodeMap.set(I.id,I)}var L=function Y(X){for(var K=X.getChild().getNodes(),se,oe=0,W=0;W<K.length;W++)se=K[W],se.getChild()==null?M.fixedNodeSet.has(se.id)&&(oe+=100):oe+=Y(se);return oe};if(this.constraints.fixedNodeConstraint){this.constraints.fixedNodeConstraint.forEach(function(K){M.fixedNodeSet.add(K.nodeId)});for(var N=this.graphManager.getAllNodes(),I,D=0;D<N.length;D++)if(I=N[D],I.getChild()!=null){var z=L(I);z>0&&(I.fixedNodeWeight=z)}}if(this.constraints.relativePlacementConstraint){var B=new Map,k=new Map;if(this.dummyToNodeForVerticalAlignment=new Map,this.dummyToNodeForHorizontalAlignment=new Map,this.fixedNodesOnHorizontal=new Set,this.fixedNodesOnVertical=new Set,this.fixedNodeSet.forEach(function(Y){M.fixedNodesOnHorizontal.add(Y),M.fixedNodesOnVertical.add(Y)}),this.constraints.alignmentConstraint){if(this.constraints.alignmentConstraint.vertical)for(var U=this.constraints.alignmentConstraint.vertical,D=0;D<U.length;D++)this.dummyToNodeForVerticalAlignment.set("dummy"+D,[]),U[D].forEach(function(X){B.set(X,"dummy"+D),M.dummyToNodeForVerticalAlignment.get("dummy"+D).push(X),M.fixedNodeSet.has(X)&&M.fixedNodesOnHorizontal.add("dummy"+D)});if(this.constraints.alignmentConstraint.horizontal)for(var G=this.constraints.alignmentConstraint.horizontal,D=0;D<G.length;D++)this.dummyToNodeForHorizontalAlignment.set("dummy"+D,[]),G[D].forEach(function(X){k.set(X,"dummy"+D),M.dummyToNodeForHorizontalAlignment.get("dummy"+D).push(X),M.fixedNodeSet.has(X)&&M.fixedNodesOnVertical.add("dummy"+D)})}if(m.RELAX_MOVEMENT_ON_CONSTRAINTS)this.shuffle=function(Y){var X,K,se;for(se=Y.length-1;se>=2*Y.length/3;se--)X=Math.floor(Math.random()*(se+1)),K=Y[se],Y[se]=Y[X],Y[X]=K;return Y},this.nodesInRelativeHorizontal=[],this.nodesInRelativeVertical=[],this.nodeToRelativeConstraintMapHorizontal=new Map,this.nodeToRelativeConstraintMapVertical=new Map,this.nodeToTempPositionMapHorizontal=new Map,this.nodeToTempPositionMapVertical=new Map,this.constraints.relativePlacementConstraint.forEach(function(Y){if(Y.left){var X=B.has(Y.left)?B.get(Y.left):Y.left,K=B.has(Y.right)?B.get(Y.right):Y.right;M.nodesInRelativeHorizontal.includes(X)||(M.nodesInRelativeHorizontal.push(X),M.nodeToRelativeConstraintMapHorizontal.set(X,[]),M.dummyToNodeForVerticalAlignment.has(X)?M.nodeToTempPositionMapHorizontal.set(X,M.idToNodeMap.get(M.dummyToNodeForVerticalAlignment.get(X)[0]).getCenterX()):M.nodeToTempPositionMapHorizontal.set(X,M.idToNodeMap.get(X).getCenterX())),M.nodesInRelativeHorizontal.includes(K)||(M.nodesInRelativeHorizontal.push(K),M.nodeToRelativeConstraintMapHorizontal.set(K,[]),M.dummyToNodeForVerticalAlignment.has(K)?M.nodeToTempPositionMapHorizontal.set(K,M.idToNodeMap.get(M.dummyToNodeForVerticalAlignment.get(K)[0]).getCenterX()):M.nodeToTempPositionMapHorizontal.set(K,M.idToNodeMap.get(K).getCenterX())),M.nodeToRelativeConstraintMapHorizontal.get(X).push({right:K,gap:Y.gap}),M.nodeToRelativeConstraintMapHorizontal.get(K).push({left:X,gap:Y.gap})}else{var se=k.has(Y.top)?k.get(Y.top):Y.top,oe=k.has(Y.bottom)?k.get(Y.bottom):Y.bottom;M.nodesInRelativeVertical.includes(se)||(M.nodesInRelativeVertical.push(se),M.nodeToRelativeConstraintMapVertical.set(se,[]),M.dummyToNodeForHorizontalAlignment.has(se)?M.nodeToTempPositionMapVertical.set(se,M.idToNodeMap.get(M.dummyToNodeForHorizontalAlignment.get(se)[0]).getCenterY()):M.nodeToTempPositionMapVertical.set(se,M.idToNodeMap.get(se).getCenterY())),M.nodesInRelativeVertical.includes(oe)||(M.nodesInRelativeVertical.push(oe),M.nodeToRelativeConstraintMapVertical.set(oe,[]),M.dummyToNodeForHorizontalAlignment.has(oe)?M.nodeToTempPositionMapVertical.set(oe,M.idToNodeMap.get(M.dummyToNodeForHorizontalAlignment.get(oe)[0]).getCenterY()):M.nodeToTempPositionMapVertical.set(oe,M.idToNodeMap.get(oe).getCenterY())),M.nodeToRelativeConstraintMapVertical.get(se).push({bottom:oe,gap:Y.gap}),M.nodeToRelativeConstraintMapVertical.get(oe).push({top:se,gap:Y.gap})}});else{var O=new Map,F=new Map;this.constraints.relativePlacementConstraint.forEach(function(Y){if(Y.left){var X=B.has(Y.left)?B.get(Y.left):Y.left,K=B.has(Y.right)?B.get(Y.right):Y.right;O.has(X)?O.get(X).push(K):O.set(X,[K]),O.has(K)?O.get(K).push(X):O.set(K,[X])}else{var se=k.has(Y.top)?k.get(Y.top):Y.top,oe=k.has(Y.bottom)?k.get(Y.bottom):Y.bottom;F.has(se)?F.get(se).push(oe):F.set(se,[oe]),F.has(oe)?F.get(oe).push(se):F.set(oe,[se])}});var V=function(X,K){var se=[],oe=[],W=new C,Ne=new Set,Be=0;return X.forEach(function(we,pe){if(!Ne.has(pe)){se[Be]=[],oe[Be]=!1;var Me=pe;for(W.push(Me),Ne.add(Me),se[Be].push(Me);W.length!=0;){Me=W.shift(),K.has(Me)&&(oe[Be]=!0);var Ae=X.get(Me);Ae.forEach(function(j){Ne.has(j)||(W.push(j),Ne.add(j),se[Be].push(j))})}Be++}}),{components:se,isFixed:oe}},$=V(O,M.fixedNodesOnHorizontal);this.componentsOnHorizontal=$.components,this.fixedComponentsOnHorizontal=$.isFixed;var Z=V(F,M.fixedNodesOnVertical);this.componentsOnVertical=Z.components,this.fixedComponentsOnVertical=Z.isFixed}}},R.prototype.updateDisplacements=function(){var M=this;if(this.constraints.fixedNodeConstraint&&this.constraints.fixedNodeConstraint.forEach(function(Z){var Y=M.idToNodeMap.get(Z.nodeId);Y.displacementX=0,Y.displacementY=0}),this.constraints.alignmentConstraint){if(this.constraints.alignmentConstraint.vertical)for(var N=this.constraints.alignmentConstraint.vertical,D=0;D<N.length;D++){for(var I=0,L=0;L<N[D].length;L++){if(this.fixedNodeSet.has(N[D][L])){I=0;break}I+=this.idToNodeMap.get(N[D][L]).displacementX}for(var z=I/N[D].length,L=0;L<N[D].length;L++)this.idToNodeMap.get(N[D][L]).displacementX=z}if(this.constraints.alignmentConstraint.horizontal)for(var B=this.constraints.alignmentConstraint.horizontal,D=0;D<B.length;D++){for(var k=0,L=0;L<B[D].length;L++){if(this.fixedNodeSet.has(B[D][L])){k=0;break}k+=this.idToNodeMap.get(B[D][L]).displacementY}for(var U=k/B[D].length,L=0;L<B[D].length;L++)this.idToNodeMap.get(B[D][L]).displacementY=U}}if(this.constraints.relativePlacementConstraint)if(m.RELAX_MOVEMENT_ON_CONSTRAINTS)this.totalIterations%10==0&&(this.shuffle(this.nodesInRelativeHorizontal),this.shuffle(this.nodesInRelativeVertical)),this.nodesInRelativeHorizontal.forEach(function(Z){if(!M.fixedNodesOnHorizontal.has(Z)){var Y=0;M.dummyToNodeForVerticalAlignment.has(Z)?Y=M.idToNodeMap.get(M.dummyToNodeForVerticalAlignment.get(Z)[0]).displacementX:Y=M.idToNodeMap.get(Z).displacementX,M.nodeToRelativeConstraintMapHorizontal.get(Z).forEach(function(X){if(X.right){var K=M.nodeToTempPositionMapHorizontal.get(X.right)-M.nodeToTempPositionMapHorizontal.get(Z)-Y;K<X.gap&&(Y-=X.gap-K)}else{var K=M.nodeToTempPositionMapHorizontal.get(Z)-M.nodeToTempPositionMapHorizontal.get(X.left)+Y;K<X.gap&&(Y+=X.gap-K)}}),M.nodeToTempPositionMapHorizontal.set(Z,M.nodeToTempPositionMapHorizontal.get(Z)+Y),M.dummyToNodeForVerticalAlignment.has(Z)?M.dummyToNodeForVerticalAlignment.get(Z).forEach(function(X){M.idToNodeMap.get(X).displacementX=Y}):M.idToNodeMap.get(Z).displacementX=Y}}),this.nodesInRelativeVertical.forEach(function(Z){if(!M.fixedNodesOnHorizontal.has(Z)){var Y=0;M.dummyToNodeForHorizontalAlignment.has(Z)?Y=M.idToNodeMap.get(M.dummyToNodeForHorizontalAlignment.get(Z)[0]).displacementY:Y=M.idToNodeMap.get(Z).displacementY,M.nodeToRelativeConstraintMapVertical.get(Z).forEach(function(X){if(X.bottom){var K=M.nodeToTempPositionMapVertical.get(X.bottom)-M.nodeToTempPositionMapVertical.get(Z)-Y;K<X.gap&&(Y-=X.gap-K)}else{var K=M.nodeToTempPositionMapVertical.get(Z)-M.nodeToTempPositionMapVertical.get(X.top)+Y;K<X.gap&&(Y+=X.gap-K)}}),M.nodeToTempPositionMapVertical.set(Z,M.nodeToTempPositionMapVertical.get(Z)+Y),M.dummyToNodeForHorizontalAlignment.has(Z)?M.dummyToNodeForHorizontalAlignment.get(Z).forEach(function(X){M.idToNodeMap.get(X).displacementY=Y}):M.idToNodeMap.get(Z).displacementY=Y}});else{for(var D=0;D<this.componentsOnHorizontal.length;D++){var G=this.componentsOnHorizontal[D];if(this.fixedComponentsOnHorizontal[D])for(var L=0;L<G.length;L++)this.dummyToNodeForVerticalAlignment.has(G[L])?this.dummyToNodeForVerticalAlignment.get(G[L]).forEach(function(X){M.idToNodeMap.get(X).displacementX=0}):this.idToNodeMap.get(G[L]).displacementX=0;else{for(var O=0,F=0,L=0;L<G.length;L++)if(this.dummyToNodeForVerticalAlignment.has(G[L])){var V=this.dummyToNodeForVerticalAlignment.get(G[L]);O+=V.length*this.idToNodeMap.get(V[0]).displacementX,F+=V.length}else O+=this.idToNodeMap.get(G[L]).displacementX,F++;for(var $=O/F,L=0;L<G.length;L++)this.dummyToNodeForVerticalAlignment.has(G[L])?this.dummyToNodeForVerticalAlignment.get(G[L]).forEach(function(X){M.idToNodeMap.get(X).displacementX=$}):this.idToNodeMap.get(G[L]).displacementX=$}}for(var D=0;D<this.componentsOnVertical.length;D++){var G=this.componentsOnVertical[D];if(this.fixedComponentsOnVertical[D])for(var L=0;L<G.length;L++)this.dummyToNodeForHorizontalAlignment.has(G[L])?this.dummyToNodeForHorizontalAlignment.get(G[L]).forEach(function(K){M.idToNodeMap.get(K).displacementY=0}):this.idToNodeMap.get(G[L]).displacementY=0;else{for(var O=0,F=0,L=0;L<G.length;L++)if(this.dummyToNodeForHorizontalAlignment.has(G[L])){var V=this.dummyToNodeForHorizontalAlignment.get(G[L]);O+=V.length*this.idToNodeMap.get(V[0]).displacementY,F+=V.length}else O+=this.idToNodeMap.get(G[L]).displacementY,F++;for(var $=O/F,L=0;L<G.length;L++)this.dummyToNodeForHorizontalAlignment.has(G[L])?this.dummyToNodeForHorizontalAlignment.get(G[L]).forEach(function(W){M.idToNodeMap.get(W).displacementY=$}):this.idToNodeMap.get(G[L]).displacementY=$}}}},R.prototype.calculateNodesToApplyGravitationTo=function(){var M=[],N,D=this.graphManager.getGraphs(),I=D.length,L;for(L=0;L<I;L++)N=D[L],N.updateConnected(),N.isConnected||(M=M.concat(N.getNodes()));return M},R.prototype.createBendpoints=function(){var M=[];M=M.concat(this.graphManager.getAllEdges());var N=new Set,D;for(D=0;D<M.length;D++){var I=M[D];if(!N.has(I)){var L=I.getSource(),z=I.getTarget();if(L==z)I.getBendpoints().push(new x),I.getBendpoints().push(new x),this.createDummyNodesForBendpoints(I),N.add(I);else{var B=[];if(B=B.concat(L.getEdgeListToNode(z)),B=B.concat(z.getEdgeListToNode(L)),!N.has(B[0])){if(B.length>1){var k;for(k=0;k<B.length;k++){var U=B[k];U.getBendpoints().push(new x),this.createDummyNodesForBendpoints(U)}}B.forEach(function(G){N.add(G)})}}}if(N.size==M.length)break}},R.prototype.positionNodesRadially=function(M){for(var N=new _(0,0),D=Math.ceil(Math.sqrt(M.length)),I=0,L=0,z=0,B=new x(0,0),k=0;k<M.length;k++){k%D==0&&(z=0,L=I,k!=0&&(L+=m.DEFAULT_COMPONENT_SEPERATION),I=0);var U=M[k],G=T.findCenterOfTree(U);N.x=z,N.y=L,B=R.radialLayout(U,G,N),B.y>I&&(I=Math.floor(B.y)),z=Math.floor(B.x+m.DEFAULT_COMPONENT_SEPERATION)}this.transform(new x(y.WORLD_CENTER_X-B.x/2,y.WORLD_CENTER_Y-B.y/2))},R.radialLayout=function(M,N,D){var I=Math.max(this.maxDiagonalInTree(M),m.DEFAULT_RADIAL_SEPARATION);R.branchRadialLayout(N,null,0,359,0,I);var L=A.calculateBounds(M),z=new S;z.setDeviceOrgX(L.getMinX()),z.setDeviceOrgY(L.getMinY()),z.setWorldOrgX(D.x),z.setWorldOrgY(D.y);for(var B=0;B<M.length;B++){var k=M[B];k.transform(z)}var U=new x(L.getMaxX(),L.getMaxY());return z.inverseTransformPoint(U)},R.branchRadialLayout=function(M,N,D,I,L,z){var B=(I-D+1)/2;B<0&&(B+=180);var k=(B+D)%360,U=k*w.TWO_PI/360,G=L*Math.cos(U),O=L*Math.sin(U);M.setCenter(G,O);var F=[];F=F.concat(M.getEdges());var V=F.length;N!=null&&V--;for(var $=0,Z=F.length,Y,X=M.getEdgesBetween(N);X.length>1;){var K=X[0];X.splice(0,1);var se=F.indexOf(K);se>=0&&F.splice(se,1),Z--,V--}N!=null?Y=(F.indexOf(X[0])+1)%Z:Y=0;for(var oe=Math.abs(I-D)/V,W=Y;$!=V;W=++W%Z){var Ne=F[W].getOtherEnd(M);if(Ne!=N){var Be=(D+$*oe)%360,we=(Be+oe)%360;R.branchRadialLayout(Ne,M,Be,we,L+z,z),$++}}},R.maxDiagonalInTree=function(M){for(var N=b.MIN_VALUE,D=0;D<M.length;D++){var I=M[D],L=I.getDiagonal();L>N&&(N=L)}return N},R.prototype.calcRepulsionRange=function(){return 2*(this.level+1)*this.idealEdgeLength},R.prototype.groupZeroDegreeMembers=function(){var M=this,N={};this.memberGroups={},this.idToDummyNode={};for(var D=[],I=this.graphManager.getAllNodes(),L=0;L<I.length;L++){var z=I[L],B=z.getParent();this.getNodeDegreeWithChildren(z)===0&&(B.id==null||!this.getToBeTiled(B))&&D.push(z)}for(var L=0;L<D.length;L++){var z=D[L],k=z.getParent().id;typeof N[k]>"u"&&(N[k]=[]),N[k]=N[k].concat(z)}Object.keys(N).forEach(function(U){if(N[U].length>1){var G="DummyCompound_"+U;M.memberGroups[G]=N[U];var O=N[U][0].getParent(),F=new f(M.graphManager);F.id=G,F.paddingLeft=O.paddingLeft||0,F.paddingRight=O.paddingRight||0,F.paddingBottom=O.paddingBottom||0,F.paddingTop=O.paddingTop||0,M.idToDummyNode[G]=F;var V=M.getGraphManager().add(M.newGraph(),F),$=O.getChild();$.add(F);for(var Z=0;Z<N[U].length;Z++){var Y=N[U][Z];$.remove(Y),V.add(Y)}}})},R.prototype.clearCompounds=function(){var M={},N={};this.performDFSOnCompounds();for(var D=0;D<this.compoundOrder.length;D++)N[this.compoundOrder[D].id]=this.compoundOrder[D],M[this.compoundOrder[D].id]=[].concat(this.compoundOrder[D].getChild().getNodes()),this.graphManager.remove(this.compoundOrder[D].getChild()),this.compoundOrder[D].child=null;this.graphManager.resetAllNodes(),this.tileCompoundMembers(M,N)},R.prototype.clearZeroDegreeMembers=function(){var M=this,N=this.tiledZeroDegreePack=[];Object.keys(this.memberGroups).forEach(function(D){var I=M.idToDummyNode[D];if(N[D]=M.tileNodes(M.memberGroups[D],I.paddingLeft+I.paddingRight),I.rect.width=N[D].width,I.rect.height=N[D].height,I.setCenter(N[D].centerX,N[D].centerY),I.labelMarginLeft=0,I.labelMarginTop=0,m.NODE_DIMENSIONS_INCLUDE_LABELS){var L=I.rect.width,z=I.rect.height;I.labelWidth&&(I.labelPosHorizontal=="left"?(I.rect.x-=I.labelWidth,I.setWidth(L+I.labelWidth),I.labelMarginLeft=I.labelWidth):I.labelPosHorizontal=="center"&&I.labelWidth>L?(I.rect.x-=(I.labelWidth-L)/2,I.setWidth(I.labelWidth),I.labelMarginLeft=(I.labelWidth-L)/2):I.labelPosHorizontal=="right"&&I.setWidth(L+I.labelWidth)),I.labelHeight&&(I.labelPosVertical=="top"?(I.rect.y-=I.labelHeight,I.setHeight(z+I.labelHeight),I.labelMarginTop=I.labelHeight):I.labelPosVertical=="center"&&I.labelHeight>z?(I.rect.y-=(I.labelHeight-z)/2,I.setHeight(I.labelHeight),I.labelMarginTop=(I.labelHeight-z)/2):I.labelPosVertical=="bottom"&&I.setHeight(z+I.labelHeight))}})},R.prototype.repopulateCompounds=function(){for(var M=this.compoundOrder.length-1;M>=0;M--){var N=this.compoundOrder[M],D=N.id,I=N.paddingLeft,L=N.paddingTop,z=N.labelMarginLeft,B=N.labelMarginTop;this.adjustLocations(this.tiledMemberPack[D],N.rect.x,N.rect.y,I,L,z,B)}},R.prototype.repopulateZeroDegreeMembers=function(){var M=this,N=this.tiledZeroDegreePack;Object.keys(N).forEach(function(D){var I=M.idToDummyNode[D],L=I.paddingLeft,z=I.paddingTop,B=I.labelMarginLeft,k=I.labelMarginTop;M.adjustLocations(N[D],I.rect.x,I.rect.y,L,z,B,k)})},R.prototype.getToBeTiled=function(M){var N=M.id;if(this.toBeTiled[N]!=null)return this.toBeTiled[N];var D=M.getChild();if(D==null)return this.toBeTiled[N]=!1,!1;for(var I=D.getNodes(),L=0;L<I.length;L++){var z=I[L];if(this.getNodeDegree(z)>0)return this.toBeTiled[N]=!1,!1;if(z.getChild()==null){this.toBeTiled[z.id]=!1;continue}if(!this.getToBeTiled(z))return this.toBeTiled[N]=!1,!1}return this.toBeTiled[N]=!0,!0},R.prototype.getNodeDegree=function(M){M.id;for(var N=M.getEdges(),D=0,I=0;I<N.length;I++){var L=N[I];L.getSource().id!==L.getTarget().id&&(D=D+1)}return D},R.prototype.getNodeDegreeWithChildren=function(M){var N=this.getNodeDegree(M);if(M.getChild()==null)return N;for(var D=M.getChild().getNodes(),I=0;I<D.length;I++){var L=D[I];N+=this.getNodeDegreeWithChildren(L)}return N},R.prototype.performDFSOnCompounds=function(){this.compoundOrder=[],this.fillCompexOrderByDFS(this.graphManager.getRoot().getNodes())},R.prototype.fillCompexOrderByDFS=function(M){for(var N=0;N<M.length;N++){var D=M[N];D.getChild()!=null&&this.fillCompexOrderByDFS(D.getChild().getNodes()),this.getToBeTiled(D)&&this.compoundOrder.push(D)}},R.prototype.adjustLocations=function(M,N,D,I,L,z,B){N+=I+z,D+=L+B;for(var k=N,U=0;U<M.rows.length;U++){var G=M.rows[U];N=k;for(var O=0,F=0;F<G.length;F++){var V=G[F];V.rect.x=N,V.rect.y=D,N+=V.rect.width+M.horizontalPadding,V.rect.height>O&&(O=V.rect.height)}D+=O+M.verticalPadding}},R.prototype.tileCompoundMembers=function(M,N){var D=this;this.tiledMemberPack=[],Object.keys(M).forEach(function(I){var L=N[I];if(D.tiledMemberPack[I]=D.tileNodes(M[I],L.paddingLeft+L.paddingRight),L.rect.width=D.tiledMemberPack[I].width,L.rect.height=D.tiledMemberPack[I].height,L.setCenter(D.tiledMemberPack[I].centerX,D.tiledMemberPack[I].centerY),L.labelMarginLeft=0,L.labelMarginTop=0,m.NODE_DIMENSIONS_INCLUDE_LABELS){var z=L.rect.width,B=L.rect.height;L.labelWidth&&(L.labelPosHorizontal=="left"?(L.rect.x-=L.labelWidth,L.setWidth(z+L.labelWidth),L.labelMarginLeft=L.labelWidth):L.labelPosHorizontal=="center"&&L.labelWidth>z?(L.rect.x-=(L.labelWidth-z)/2,L.setWidth(L.labelWidth),L.labelMarginLeft=(L.labelWidth-z)/2):L.labelPosHorizontal=="right"&&L.setWidth(z+L.labelWidth)),L.labelHeight&&(L.labelPosVertical=="top"?(L.rect.y-=L.labelHeight,L.setHeight(B+L.labelHeight),L.labelMarginTop=L.labelHeight):L.labelPosVertical=="center"&&L.labelHeight>B?(L.rect.y-=(L.labelHeight-B)/2,L.setHeight(L.labelHeight),L.labelMarginTop=(L.labelHeight-B)/2):L.labelPosVertical=="bottom"&&L.setHeight(B+L.labelHeight))}})},R.prototype.tileNodes=function(M,N){var D=this.tileNodesByFavoringDim(M,N,!0),I=this.tileNodesByFavoringDim(M,N,!1),L=this.getOrgRatio(D),z=this.getOrgRatio(I),B;return z<L?B=I:B=D,B},R.prototype.getOrgRatio=function(M){var N=M.width,D=M.height,I=N/D;return I<1&&(I=1/I),I},R.prototype.calcIdealRowWidth=function(M,N){var D=m.TILING_PADDING_VERTICAL,I=m.TILING_PADDING_HORIZONTAL,L=M.length,z=0,B=0,k=0;M.forEach(function(Z){z+=Z.getWidth(),B+=Z.getHeight(),Z.getWidth()>k&&(k=Z.getWidth())});var U=z/L,G=B/L,O=Math.pow(D-I,2)+4*(U+I)*(G+D)*L,F=(I-D+Math.sqrt(O))/(2*(U+I)),V;N?(V=Math.ceil(F),V==F&&V++):V=Math.floor(F);var $=V*(U+I)-I;return k>$&&($=k),$+=I*2,$},R.prototype.tileNodesByFavoringDim=function(M,N,D){var I=m.TILING_PADDING_VERTICAL,L=m.TILING_PADDING_HORIZONTAL,z=m.TILING_COMPARE_BY,B={rows:[],rowWidth:[],rowHeight:[],width:0,height:N,verticalPadding:I,horizontalPadding:L,centerX:0,centerY:0};z&&(B.idealRowWidth=this.calcIdealRowWidth(M,D));var k=function(Y){return Y.rect.width*Y.rect.height},U=function(Y,X){return k(X)-k(Y)};M.sort(function(Z,Y){var X=U;return B.idealRowWidth?(X=z,X(Z.id,Y.id)):X(Z,Y)});for(var G=0,O=0,F=0;F<M.length;F++){var V=M[F];G+=V.getCenterX(),O+=V.getCenterY()}B.centerX=G/M.length,B.centerY=O/M.length;for(var F=0;F<M.length;F++){var V=M[F];if(B.rows.length==0)this.insertNodeToRow(B,V,0,N);else if(this.canAddHorizontal(B,V.rect.width,V.rect.height)){var $=B.rows.length-1;B.idealRowWidth||($=this.getShortestRowIndex(B)),this.insertNodeToRow(B,V,$,N)}else this.insertNodeToRow(B,V,B.rows.length,N);this.shiftToLastRow(B)}return B},R.prototype.insertNodeToRow=function(M,N,D,I){var L=I;if(D==M.rows.length){var z=[];M.rows.push(z),M.rowWidth.push(L),M.rowHeight.push(0)}var B=M.rowWidth[D]+N.rect.width;M.rows[D].length>0&&(B+=M.horizontalPadding),M.rowWidth[D]=B,M.width<B&&(M.width=B);var k=N.rect.height;D>0&&(k+=M.verticalPadding);var U=0;k>M.rowHeight[D]&&(U=M.rowHeight[D],M.rowHeight[D]=k,U=M.rowHeight[D]-U),M.height+=U,M.rows[D].push(N)},R.prototype.getShortestRowIndex=function(M){for(var N=-1,D=Number.MAX_VALUE,I=0;I<M.rows.length;I++)M.rowWidth[I]<D&&(N=I,D=M.rowWidth[I]);return N},R.prototype.getLongestRowIndex=function(M){for(var N=-1,D=Number.MIN_VALUE,I=0;I<M.rows.length;I++)M.rowWidth[I]>D&&(N=I,D=M.rowWidth[I]);return N},R.prototype.canAddHorizontal=function(M,N,D){if(M.idealRowWidth){var I=M.rows.length-1,L=M.rowWidth[I];return L+N+M.horizontalPadding<=M.idealRowWidth}var z=this.getShortestRowIndex(M);if(z<0)return!0;var B=M.rowWidth[z];if(B+M.horizontalPadding+N<=M.width)return!0;var k=0;M.rowHeight[z]<D&&z>0&&(k=D+M.verticalPadding-M.rowHeight[z]);var U;M.width-B>=N+M.horizontalPadding?U=(M.height+k)/(B+N+M.horizontalPadding):U=(M.height+k)/M.width,k=D+M.verticalPadding;var G;return M.width<N?G=(M.height+k)/N:G=(M.height+k)/M.width,G<1&&(G=1/G),U<1&&(U=1/U),U<G},R.prototype.shiftToLastRow=function(M){var N=this.getLongestRowIndex(M),D=M.rowWidth.length-1,I=M.rows[N],L=I[I.length-1],z=L.width+M.horizontalPadding;if(M.width-M.rowWidth[D]>z&&N!=D){I.splice(-1,1),M.rows[D].push(L),M.rowWidth[N]=M.rowWidth[N]-z,M.rowWidth[D]=M.rowWidth[D]+z,M.width=M.rowWidth[instance.getLongestRowIndex(M)];for(var B=Number.MIN_VALUE,k=0;k<I.length;k++)I[k].height>B&&(B=I[k].height);N>0&&(B+=M.verticalPadding);var U=M.rowHeight[N]+M.rowHeight[D];M.rowHeight[N]=B,M.rowHeight[D]<L.height+M.verticalPadding&&(M.rowHeight[D]=L.height+M.verticalPadding);var G=M.rowHeight[N]+M.rowHeight[D];M.height+=G-U,this.shiftToLastRow(M)}},R.prototype.tilingPreLayout=function(){m.TILE&&(this.groupZeroDegreeMembers(),this.clearCompounds(),this.clearZeroDegreeMembers())},R.prototype.tilingPostLayout=function(){m.TILE&&(this.repopulateZeroDegreeMembers(),this.repopulateCompounds())},R.prototype.reduceTrees=function(){for(var M=[],N=!0,D;N;){var I=this.graphManager.getAllNodes(),L=[];N=!1;for(var z=0;z<I.length;z++)if(D=I[z],D.getEdges().length==1&&!D.getEdges()[0].isInterGraph&&D.getChild()==null){if(m.PURE_INCREMENTAL){var B=D.getEdges()[0].getOtherEnd(D),k=new E(D.getCenterX()-B.getCenterX(),D.getCenterY()-B.getCenterY());L.push([D,D.getEdges()[0],D.getOwner(),k])}else L.push([D,D.getEdges()[0],D.getOwner()]);N=!0}if(N==!0){for(var U=[],G=0;G<L.length;G++)L[G][0].getEdges().length==1&&(U.push(L[G]),L[G][0].getOwner().remove(L[G][0]));M.push(U),this.graphManager.resetAllNodes(),this.graphManager.resetAllEdges()}}this.prunedNodesAll=M},R.prototype.growTree=function(M){for(var N=M.length,D=M[N-1],I,L=0;L<D.length;L++)I=D[L],this.findPlaceforPrunedNode(I),I[2].add(I[0]),I[2].add(I[1],I[1].source,I[1].target);M.splice(M.length-1,1),this.graphManager.resetAllNodes(),this.graphManager.resetAllEdges()},R.prototype.findPlaceforPrunedNode=function(M){var N,D,I=M[0];if(I==M[1].source?D=M[1].target:D=M[1].source,m.PURE_INCREMENTAL)I.setCenter(D.getCenterX()+M[3].getWidth(),D.getCenterY()+M[3].getHeight());else{var L=D.startX,z=D.finishX,B=D.startY,k=D.finishY,U=0,G=0,O=0,F=0,V=[U,O,G,F];if(B>0)for(var $=L;$<=z;$++)V[0]+=this.grid[$][B-1].length+this.grid[$][B].length-1;if(z<this.grid.length-1)for(var $=B;$<=k;$++)V[1]+=this.grid[z+1][$].length+this.grid[z][$].length-1;if(k<this.grid[0].length-1)for(var $=L;$<=z;$++)V[2]+=this.grid[$][k+1].length+this.grid[$][k].length-1;if(L>0)for(var $=B;$<=k;$++)V[3]+=this.grid[L-1][$].length+this.grid[L][$].length-1;for(var Z=b.MAX_VALUE,Y,X,K=0;K<V.length;K++)V[K]<Z?(Z=V[K],Y=1,X=K):V[K]==Z&&Y++;if(Y==3&&Z==0)V[0]==0&&V[1]==0&&V[2]==0?N=1:V[0]==0&&V[1]==0&&V[3]==0?N=0:V[0]==0&&V[2]==0&&V[3]==0?N=3:V[1]==0&&V[2]==0&&V[3]==0&&(N=2);else if(Y==2&&Z==0){var se=Math.floor(Math.random()*2);V[0]==0&&V[1]==0?se==0?N=0:N=1:V[0]==0&&V[2]==0?se==0?N=0:N=2:V[0]==0&&V[3]==0?se==0?N=0:N=3:V[1]==0&&V[2]==0?se==0?N=1:N=2:V[1]==0&&V[3]==0?se==0?N=1:N=3:se==0?N=2:N=3}else if(Y==4&&Z==0){var se=Math.floor(Math.random()*4);N=se}else N=X;N==0?I.setCenter(D.getCenterX(),D.getCenterY()-D.getHeight()/2-g.DEFAULT_EDGE_LENGTH-I.getHeight()/2):N==1?I.setCenter(D.getCenterX()+D.getWidth()/2+g.DEFAULT_EDGE_LENGTH+I.getWidth()/2,D.getCenterY()):N==2?I.setCenter(D.getCenterX(),D.getCenterY()+D.getHeight()/2+g.DEFAULT_EDGE_LENGTH+I.getHeight()/2):I.setCenter(D.getCenterX()-D.getWidth()/2-g.DEFAULT_EDGE_LENGTH-I.getWidth()/2,D.getCenterY())}},o.exports=R},991:(o,l,u)=>{var c=u(551).FDLayoutNode,h=u(551).IMath;function d(p,m,v,g){c.call(this,p,m,v,g)}d.prototype=Object.create(c.prototype);for(var f in c)d[f]=c[f];d.prototype.calculateDisplacement=function(){var p=this.graphManager.getLayout();this.getChild()!=null&&this.fixedNodeWeight?(this.displacementX+=p.coolingFactor*(this.springForceX+this.repulsionForceX+this.gravitationForceX)/this.fixedNodeWeight,this.displacementY+=p.coolingFactor*(this.springForceY+this.repulsionForceY+this.gravitationForceY)/this.fixedNodeWeight):(this.displacementX+=p.coolingFactor*(this.springForceX+this.repulsionForceX+this.gravitationForceX)/this.noOfChildren,this.displacementY+=p.coolingFactor*(this.springForceY+this.repulsionForceY+this.gravitationForceY)/this.noOfChildren),Math.abs(this.displacementX)>p.coolingFactor*p.maxNodeDisplacement&&(this.displacementX=p.coolingFactor*p.maxNodeDisplacement*h.sign(this.displacementX)),Math.abs(this.displacementY)>p.coolingFactor*p.maxNodeDisplacement&&(this.displacementY=p.coolingFactor*p.maxNodeDisplacement*h.sign(this.displacementY)),this.child&&this.child.getNodes().length>0&&this.propogateDisplacementToChildren(this.displacementX,this.displacementY)},d.prototype.propogateDisplacementToChildren=function(p,m){for(var v=this.getChild().getNodes(),g,y=0;y<v.length;y++)g=v[y],g.getChild()==null?(g.displacementX+=p,g.displacementY+=m):g.propogateDisplacementToChildren(p,m)},d.prototype.move=function(){var p=this.graphManager.getLayout();(this.child==null||this.child.getNodes().length==0)&&(this.moveBy(this.displacementX,this.displacementY),p.totalDisplacement+=Math.abs(this.displacementX)+Math.abs(this.displacementY)),this.springForceX=0,this.springForceY=0,this.repulsionForceX=0,this.repulsionForceY=0,this.gravitationForceX=0,this.gravitationForceY=0,this.displacementX=0,this.displacementY=0},d.prototype.setPred1=function(p){this.pred1=p},d.prototype.getPred1=function(){return pred1},d.prototype.getPred2=function(){return pred2},d.prototype.setNext=function(p){this.next=p},d.prototype.getNext=function(){return next},d.prototype.setProcessed=function(p){this.processed=p},d.prototype.isProcessed=function(){return processed},o.exports=d},902:(o,l,u)=>{function c(v){if(Array.isArray(v)){for(var g=0,y=Array(v.length);g<v.length;g++)y[g]=v[g];return y}else return Array.from(v)}var h=u(806),d=u(551).LinkedList,f=u(551).Matrix,p=u(551).SVD;function m(){}m.handleConstraints=function(v){var g={};g.fixedNodeConstraint=v.constraints.fixedNodeConstraint,g.alignmentConstraint=v.constraints.alignmentConstraint,g.relativePlacementConstraint=v.constraints.relativePlacementConstraint;for(var y=new Map,_=new Map,x=[],E=[],T=v.getAllNodes(),b=0,w=0;w<T.length;w++){var A=T[w];A.getChild()==null&&(_.set(A.id,b++),x.push(A.getCenterX()),E.push(A.getCenterY()),y.set(A.id,A))}g.relativePlacementConstraint&&g.relativePlacementConstraint.forEach(function(ie){!ie.gap&&ie.gap!=0&&(ie.left?ie.gap=h.DEFAULT_EDGE_LENGTH+y.get(ie.left).getWidth()/2+y.get(ie.right).getWidth()/2:ie.gap=h.DEFAULT_EDGE_LENGTH+y.get(ie.top).getHeight()/2+y.get(ie.bottom).getHeight()/2)});var S=function(ee,he){return{x:ee.x-he.x,y:ee.y-he.y}},C=function(ee){var he=0,ge=0;return ee.forEach(function(Te){he+=x[_.get(Te)],ge+=E[_.get(Te)]}),{x:he/ee.size,y:ge/ee.size}},R=function(ee,he,ge,Te,Se){function Oe($e,Xe){var Je=new Set($e),nt=!0,at=!1,Xt=void 0;try{for(var gt=Xe[Symbol.iterator](),vt;!(nt=(vt=gt.next()).done);nt=!0){var pn=vt.value;Je.add(pn)}}catch(Ft){at=!0,Xt=Ft}finally{try{!nt&&gt.return&&gt.return()}finally{if(at)throw Xt}}return Je}var J=new Map;ee.forEach(function($e,Xe){J.set(Xe,0)}),ee.forEach(function($e,Xe){$e.forEach(function(Je){J.set(Je.id,J.get(Je.id)+1)})});var ve=new Map,ue=new Map,_e=new d;J.forEach(function($e,Xe){$e==0?(_e.push(Xe),ge||(he=="horizontal"?ve.set(Xe,_.has(Xe)?x[_.get(Xe)]:Te.get(Xe)):ve.set(Xe,_.has(Xe)?E[_.get(Xe)]:Te.get(Xe)))):ve.set(Xe,Number.NEGATIVE_INFINITY),ge&&ue.set(Xe,new Set([Xe]))}),ge&&Se.forEach(function($e){var Xe=[];if($e.forEach(function(at){ge.has(at)&&Xe.push(at)}),Xe.length>0){var Je=0;Xe.forEach(function(at){he=="horizontal"?(ve.set(at,_.has(at)?x[_.get(at)]:Te.get(at)),Je+=ve.get(at)):(ve.set(at,_.has(at)?E[_.get(at)]:Te.get(at)),Je+=ve.get(at))}),Je=Je/Xe.length,$e.forEach(function(at){ge.has(at)||ve.set(at,Je)})}else{var nt=0;$e.forEach(function(at){he=="horizontal"?nt+=_.has(at)?x[_.get(at)]:Te.get(at):nt+=_.has(at)?E[_.get(at)]:Te.get(at)}),nt=nt/$e.length,$e.forEach(function(at){ve.set(at,nt)})}});for(var ke=function(){var Xe=_e.shift(),Je=ee.get(Xe);Je.forEach(function(nt){if(ve.get(nt.id)<ve.get(Xe)+nt.gap)if(ge&&ge.has(nt.id)){var at=void 0;if(he=="horizontal"?at=_.has(nt.id)?x[_.get(nt.id)]:Te.get(nt.id):at=_.has(nt.id)?E[_.get(nt.id)]:Te.get(nt.id),ve.set(nt.id,at),at<ve.get(Xe)+nt.gap){var Xt=ve.get(Xe)+nt.gap-at;ue.get(Xe).forEach(function(gt){ve.set(gt,ve.get(gt)-Xt)})}}else ve.set(nt.id,ve.get(Xe)+nt.gap);J.set(nt.id,J.get(nt.id)-1),J.get(nt.id)==0&&_e.push(nt.id),ge&&ue.set(nt.id,Oe(ue.get(Xe),ue.get(nt.id)))})};_e.length!=0;)ke();if(ge){var Ie=new Set;ee.forEach(function($e,Xe){$e.length==0&&Ie.add(Xe)});var je=[];ue.forEach(function($e,Xe){if(Ie.has(Xe)){var Je=!1,nt=!0,at=!1,Xt=void 0;try{for(var gt=$e[Symbol.iterator](),vt;!(nt=(vt=gt.next()).done);nt=!0){var pn=vt.value;ge.has(pn)&&(Je=!0)}}catch(Rt){at=!0,Xt=Rt}finally{try{!nt&&gt.return&&gt.return()}finally{if(at)throw Xt}}if(!Je){var Ft=!1,Gt=void 0;je.forEach(function(Rt,fr){Rt.has([].concat(c($e))[0])&&(Ft=!0,Gt=fr)}),Ft?$e.forEach(function(Rt){je[Gt].add(Rt)}):je.push(new Set($e))}}}),je.forEach(function($e,Xe){var Je=Number.POSITIVE_INFINITY,nt=Number.POSITIVE_INFINITY,at=Number.NEGATIVE_INFINITY,Xt=Number.NEGATIVE_INFINITY,gt=!0,vt=!1,pn=void 0;try{for(var Ft=$e[Symbol.iterator](),Gt;!(gt=(Gt=Ft.next()).done);gt=!0){var Rt=Gt.value,fr=void 0;he=="horizontal"?fr=_.has(Rt)?x[_.get(Rt)]:Te.get(Rt):fr=_.has(Rt)?E[_.get(Rt)]:Te.get(Rt);var Dn=ve.get(Rt);fr<Je&&(Je=fr),fr>at&&(at=fr),Dn<nt&&(nt=Dn),Dn>Xt&&(Xt=Dn)}}catch(qa){vt=!0,pn=qa}finally{try{!gt&&Ft.return&&Ft.return()}finally{if(vt)throw pn}}var ps=(Je+at)/2-(nt+Xt)/2,Wi=!0,Va=!1,Ha=void 0;try{for(var pa=$e[Symbol.iterator](),ao;!(Wi=(ao=pa.next()).done);Wi=!0){var Wa=ao.value;ve.set(Wa,ve.get(Wa)+ps)}}catch(qa){Va=!0,Ha=qa}finally{try{!Wi&&pa.return&&pa.return()}finally{if(Va)throw Ha}}})}return ve},P=function(ee){var he=0,ge=0,Te=0,Se=0;if(ee.forEach(function(ue){ue.left?x[_.get(ue.left)]-x[_.get(ue.right)]>=0?he++:ge++:E[_.get(ue.top)]-E[_.get(ue.bottom)]>=0?Te++:Se++}),he>ge&&Te>Se)for(var Oe=0;Oe<_.size;Oe++)x[Oe]=-1*x[Oe],E[Oe]=-1*E[Oe];else if(he>ge)for(var J=0;J<_.size;J++)x[J]=-1*x[J];else if(Te>Se)for(var ve=0;ve<_.size;ve++)E[ve]=-1*E[ve]},M=function(ee){var he=[],ge=new d,Te=new Set,Se=0;return ee.forEach(function(Oe,J){if(!Te.has(J)){he[Se]=[];var ve=J;for(ge.push(ve),Te.add(ve),he[Se].push(ve);ge.length!=0;){ve=ge.shift();var ue=ee.get(ve);ue.forEach(function(_e){Te.has(_e.id)||(ge.push(_e.id),Te.add(_e.id),he[Se].push(_e.id))})}Se++}}),he},N=function(ee){var he=new Map;return ee.forEach(function(ge,Te){he.set(Te,[])}),ee.forEach(function(ge,Te){ge.forEach(function(Se){he.get(Te).push(Se),he.get(Se.id).push({id:Te,gap:Se.gap,direction:Se.direction})})}),he},D=function(ee){var he=new Map;return ee.forEach(function(ge,Te){he.set(Te,[])}),ee.forEach(function(ge,Te){ge.forEach(function(Se){he.get(Se.id).push({id:Te,gap:Se.gap,direction:Se.direction})})}),he},I=[],L=[],z=!1,B=!1,k=new Set,U=new Map,G=new Map,O=[];if(g.fixedNodeConstraint&&g.fixedNodeConstraint.forEach(function(ie){k.add(ie.nodeId)}),g.relativePlacementConstraint&&(g.relativePlacementConstraint.forEach(function(ie){ie.left?(U.has(ie.left)?U.get(ie.left).push({id:ie.right,gap:ie.gap,direction:"horizontal"}):U.set(ie.left,[{id:ie.right,gap:ie.gap,direction:"horizontal"}]),U.has(ie.right)||U.set(ie.right,[])):(U.has(ie.top)?U.get(ie.top).push({id:ie.bottom,gap:ie.gap,direction:"vertical"}):U.set(ie.top,[{id:ie.bottom,gap:ie.gap,direction:"vertical"}]),U.has(ie.bottom)||U.set(ie.bottom,[]))}),G=N(U),O=M(G)),h.TRANSFORM_ON_CONSTRAINT_HANDLING){if(g.fixedNodeConstraint&&g.fixedNodeConstraint.length>1)g.fixedNodeConstraint.forEach(function(ie,ee){I[ee]=[ie.position.x,ie.position.y],L[ee]=[x[_.get(ie.nodeId)],E[_.get(ie.nodeId)]]}),z=!0;else if(g.alignmentConstraint)(function(){var ie=0;if(g.alignmentConstraint.vertical){for(var ee=g.alignmentConstraint.vertical,he=function(ve){var ue=new Set;ee[ve].forEach(function(Ie){ue.add(Ie)});var _e=new Set([].concat(c(ue)).filter(function(Ie){return k.has(Ie)})),ke=void 0;_e.size>0?ke=x[_.get(_e.values().next().value)]:ke=C(ue).x,ee[ve].forEach(function(Ie){I[ie]=[ke,E[_.get(Ie)]],L[ie]=[x[_.get(Ie)],E[_.get(Ie)]],ie++})},ge=0;ge<ee.length;ge++)he(ge);z=!0}if(g.alignmentConstraint.horizontal){for(var Te=g.alignmentConstraint.horizontal,Se=function(ve){var ue=new Set;Te[ve].forEach(function(Ie){ue.add(Ie)});var _e=new Set([].concat(c(ue)).filter(function(Ie){return k.has(Ie)})),ke=void 0;_e.size>0?ke=x[_.get(_e.values().next().value)]:ke=C(ue).y,Te[ve].forEach(function(Ie){I[ie]=[x[_.get(Ie)],ke],L[ie]=[x[_.get(Ie)],E[_.get(Ie)]],ie++})},Oe=0;Oe<Te.length;Oe++)Se(Oe);z=!0}g.relativePlacementConstraint&&(B=!0)})();else if(g.relativePlacementConstraint){for(var F=0,V=0,$=0;$<O.length;$++)O[$].length>F&&(F=O[$].length,V=$);if(F<G.size/2)P(g.relativePlacementConstraint),z=!1,B=!1;else{var Z=new Map,Y=new Map,X=[];O[V].forEach(function(ie){U.get(ie).forEach(function(ee){ee.direction=="horizontal"?(Z.has(ie)?Z.get(ie).push(ee):Z.set(ie,[ee]),Z.has(ee.id)||Z.set(ee.id,[]),X.push({left:ie,right:ee.id})):(Y.has(ie)?Y.get(ie).push(ee):Y.set(ie,[ee]),Y.has(ee.id)||Y.set(ee.id,[]),X.push({top:ie,bottom:ee.id}))})}),P(X),B=!1;var K=R(Z,"horizontal"),se=R(Y,"vertical");O[V].forEach(function(ie,ee){L[ee]=[x[_.get(ie)],E[_.get(ie)]],I[ee]=[],K.has(ie)?I[ee][0]=K.get(ie):I[ee][0]=x[_.get(ie)],se.has(ie)?I[ee][1]=se.get(ie):I[ee][1]=E[_.get(ie)]}),z=!0}}if(z){for(var oe=void 0,W=f.transpose(I),Ne=f.transpose(L),Be=0;Be<W.length;Be++)W[Be]=f.multGamma(W[Be]),Ne[Be]=f.multGamma(Ne[Be]);var we=f.multMat(W,f.transpose(Ne)),pe=p.svd(we);oe=f.multMat(pe.V,f.transpose(pe.U));for(var Me=0;Me<_.size;Me++){var Ae=[x[Me],E[Me]],j=[oe[0][0],oe[1][0]],H=[oe[0][1],oe[1][1]];x[Me]=f.dotProduct(Ae,j),E[Me]=f.dotProduct(Ae,H)}B&&P(g.relativePlacementConstraint)}}if(h.ENFORCE_CONSTRAINTS){if(g.fixedNodeConstraint&&g.fixedNodeConstraint.length>0){var te={x:0,y:0};g.fixedNodeConstraint.forEach(function(ie,ee){var he={x:x[_.get(ie.nodeId)],y:E[_.get(ie.nodeId)]},ge=ie.position,Te=S(ge,he);te.x+=Te.x,te.y+=Te.y}),te.x/=g.fixedNodeConstraint.length,te.y/=g.fixedNodeConstraint.length,x.forEach(function(ie,ee){x[ee]+=te.x}),E.forEach(function(ie,ee){E[ee]+=te.y}),g.fixedNodeConstraint.forEach(function(ie){x[_.get(ie.nodeId)]=ie.position.x,E[_.get(ie.nodeId)]=ie.position.y})}if(g.alignmentConstraint){if(g.alignmentConstraint.vertical)for(var me=g.alignmentConstraint.vertical,Ee=function(ee){var he=new Set;me[ee].forEach(function(Se){he.add(Se)});var ge=new Set([].concat(c(he)).filter(function(Se){return k.has(Se)})),Te=void 0;ge.size>0?Te=x[_.get(ge.values().next().value)]:Te=C(he).x,he.forEach(function(Se){k.has(Se)||(x[_.get(Se)]=Te)})},le=0;le<me.length;le++)Ee(le);if(g.alignmentConstraint.horizontal)for(var q=g.alignmentConstraint.horizontal,ne=function(ee){var he=new Set;q[ee].forEach(function(Se){he.add(Se)});var ge=new Set([].concat(c(he)).filter(function(Se){return k.has(Se)})),Te=void 0;ge.size>0?Te=E[_.get(ge.values().next().value)]:Te=C(he).y,he.forEach(function(Se){k.has(Se)||(E[_.get(Se)]=Te)})},fe=0;fe<q.length;fe++)ne(fe)}g.relativePlacementConstraint&&function(){var ie=new Map,ee=new Map,he=new Map,ge=new Map,Te=new Map,Se=new Map,Oe=new Set,J=new Set;if(k.forEach(function(rt){Oe.add(rt),J.add(rt)}),g.alignmentConstraint){if(g.alignmentConstraint.vertical)for(var ve=g.alignmentConstraint.vertical,ue=function(Ve){he.set("dummy"+Ve,[]),ve[Ve].forEach(function(ut){ie.set(ut,"dummy"+Ve),he.get("dummy"+Ve).push(ut),k.has(ut)&&Oe.add("dummy"+Ve)}),Te.set("dummy"+Ve,x[_.get(ve[Ve][0])])},_e=0;_e<ve.length;_e++)ue(_e);if(g.alignmentConstraint.horizontal)for(var ke=g.alignmentConstraint.horizontal,Ie=function(Ve){ge.set("dummy"+Ve,[]),ke[Ve].forEach(function(ut){ee.set(ut,"dummy"+Ve),ge.get("dummy"+Ve).push(ut),k.has(ut)&&J.add("dummy"+Ve)}),Se.set("dummy"+Ve,E[_.get(ke[Ve][0])])},je=0;je<ke.length;je++)Ie(je)}var $e=new Map,Xe=new Map,Je=function(Ve){U.get(Ve).forEach(function(ut){var It=void 0,Vt=void 0;ut.direction=="horizontal"?(It=ie.get(Ve)?ie.get(Ve):Ve,ie.get(ut.id)?Vt={id:ie.get(ut.id),gap:ut.gap,direction:ut.direction}:Vt=ut,$e.has(It)?$e.get(It).push(Vt):$e.set(It,[Vt]),$e.has(Vt.id)||$e.set(Vt.id,[])):(It=ee.get(Ve)?ee.get(Ve):Ve,ee.get(ut.id)?Vt={id:ee.get(ut.id),gap:ut.gap,direction:ut.direction}:Vt=ut,Xe.has(It)?Xe.get(It).push(Vt):Xe.set(It,[Vt]),Xe.has(Vt.id)||Xe.set(Vt.id,[]))})},nt=!0,at=!1,Xt=void 0;try{for(var gt=U.keys()[Symbol.iterator](),vt;!(nt=(vt=gt.next()).done);nt=!0){var pn=vt.value;Je(pn)}}catch(rt){at=!0,Xt=rt}finally{try{!nt&&gt.return&&gt.return()}finally{if(at)throw Xt}}var Ft=N($e),Gt=N(Xe),Rt=M(Ft),fr=M(Gt),Dn=D($e),ps=D(Xe),Wi=[],Va=[];Rt.forEach(function(rt,Ve){Wi[Ve]=[],rt.forEach(function(ut){Dn.get(ut).length==0&&Wi[Ve].push(ut)})}),fr.forEach(function(rt,Ve){Va[Ve]=[],rt.forEach(function(ut){ps.get(ut).length==0&&Va[Ve].push(ut)})});var Ha=R($e,"horizontal",Oe,Te,Wi),pa=R(Xe,"vertical",J,Se,Va),ao=function(Ve){he.get(Ve)?he.get(Ve).forEach(function(ut){x[_.get(ut)]=Ha.get(Ve)}):x[_.get(Ve)]=Ha.get(Ve)},Wa=!0,qa=!1,Q=void 0;try{for(var ye=Ha.keys()[Symbol.iterator](),Ce;!(Wa=(Ce=ye.next()).done);Wa=!0){var Re=Ce.value;ao(Re)}}catch(rt){qa=!0,Q=rt}finally{try{!Wa&&ye.return&&ye.return()}finally{if(qa)throw Q}}var xe=function(Ve){ge.get(Ve)?ge.get(Ve).forEach(function(ut){E[_.get(ut)]=pa.get(Ve)}):E[_.get(Ve)]=pa.get(Ve)},ze=!0,Ke=!1,st=void 0;try{for(var ot=pa.keys()[Symbol.iterator](),pt;!(ze=(pt=ot.next()).done);ze=!0){var Re=pt.value;xe(Re)}}catch(rt){Ke=!0,st=rt}finally{try{!ze&&ot.return&&ot.return()}finally{if(Ke)throw st}}}()}for(var ce=0;ce<T.length;ce++){var ae=T[ce];ae.getChild()==null&&ae.setCenter(x[_.get(ae.id)],E[_.get(ae.id)])}},o.exports=m},551:o=>{o.exports=t}},i={};function a(o){var l=i[o];if(l!==void 0)return l.exports;var u=i[o]={exports:{}};return n[o](u,u.exports,a),u.exports}var s=a(45);return s})()})}(m0)),m0.exports}(function(r,e){(function(n,i){r.exports=i(HY())})(Ui,function(t){return(()=>{var n={658:o=>{o.exports=Object.assign!=null?Object.assign.bind(Object):function(l){for(var u=arguments.length,c=Array(u>1?u-1:0),h=1;h<u;h++)c[h-1]=arguments[h];return c.forEach(function(d){Object.keys(d).forEach(function(f){return l[f]=d[f]})}),l}},548:(o,l,u)=>{var c=function(){function f(p,m){var v=[],g=!0,y=!1,_=void 0;try{for(var x=p[Symbol.iterator](),E;!(g=(E=x.next()).done)&&(v.push(E.value),!(m&&v.length===m));g=!0);}catch(T){y=!0,_=T}finally{try{!g&&x.return&&x.return()}finally{if(y)throw _}}return v}return function(p,m){if(Array.isArray(p))return p;if(Symbol.iterator in Object(p))return f(p,m);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=u(140).layoutBase.LinkedList,d={};d.getTopMostNodes=function(f){for(var p={},m=0;m<f.length;m++)p[f[m].id()]=!0;var v=f.filter(function(g,y){typeof g=="number"&&(g=y);for(var _=g.parent()[0];_!=null;){if(p[_.id()])return!1;_=_.parent()[0]}return!0});return v},d.connectComponents=function(f,p,m,v){var g=new h,y=new Set,_=[],x=void 0,E=void 0,T=void 0,b=!1,w=1,A=[],S=[],C=function(){var P=f.collection();S.push(P);var M=m[0],N=f.collection();N.merge(M).merge(M.descendants().intersection(p)),_.push(M),N.forEach(function(L){g.push(L),y.add(L),P.merge(L)});for(var D=function(){M=g.shift();var z=f.collection();M.neighborhood().nodes().forEach(function(G){p.intersection(M.edgesWith(G)).length>0&&z.merge(G)});for(var B=0;B<z.length;B++){var k=z[B];if(x=m.intersection(k.union(k.ancestors())),x!=null&&!y.has(x[0])){var U=x.union(x.descendants());U.forEach(function(G){g.push(G),y.add(G),P.merge(G),m.has(G)&&_.push(G)})}}};g.length!=0;)D();if(P.forEach(function(L){p.intersection(L.connectedEdges()).forEach(function(z){P.has(z.source())&&P.has(z.target())&&P.merge(z)})}),_.length==m.length&&(b=!0),!b||b&&w>1){E=_[0],T=E.connectedEdges().length,_.forEach(function(L){L.connectedEdges().length<T&&(T=L.connectedEdges().length,E=L)}),A.push(E.id());var I=f.collection();I.merge(_[0]),_.forEach(function(L){I.merge(L)}),_=[],m=m.difference(I),w++}};do C();while(!b);return v&&A.length>0&&v.set("dummy"+(v.size+1),A),S},d.relocateComponent=function(f,p,m){if(!m.fixedNodeConstraint){var v=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,y=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY;if(m.quality=="draft"){var x=!0,E=!1,T=void 0;try{for(var b=p.nodeIndexes[Symbol.iterator](),w;!(x=(w=b.next()).done);x=!0){var A=w.value,S=c(A,2),C=S[0],R=S[1],P=m.cy.getElementById(C);if(P){var M=P.boundingBox(),N=p.xCoords[R]-M.w/2,D=p.xCoords[R]+M.w/2,I=p.yCoords[R]-M.h/2,L=p.yCoords[R]+M.h/2;N<v&&(v=N),D>g&&(g=D),I<y&&(y=I),L>_&&(_=L)}}}catch(G){E=!0,T=G}finally{try{!x&&b.return&&b.return()}finally{if(E)throw T}}var z=f.x-(g+v)/2,B=f.y-(_+y)/2;p.xCoords=p.xCoords.map(function(G){return G+z}),p.yCoords=p.yCoords.map(function(G){return G+B})}else{Object.keys(p).forEach(function(G){var O=p[G],F=O.getRect().x,V=O.getRect().x+O.getRect().width,$=O.getRect().y,Z=O.getRect().y+O.getRect().height;F<v&&(v=F),V>g&&(g=V),$<y&&(y=$),Z>_&&(_=Z)});var k=f.x-(g+v)/2,U=f.y-(_+y)/2;Object.keys(p).forEach(function(G){var O=p[G];O.setCenter(O.getCenterX()+k,O.getCenterY()+U)})}}},d.calcBoundingBox=function(f,p,m,v){for(var g=Number.MAX_SAFE_INTEGER,y=Number.MIN_SAFE_INTEGER,_=Number.MAX_SAFE_INTEGER,x=Number.MIN_SAFE_INTEGER,E=void 0,T=void 0,b=void 0,w=void 0,A=f.descendants().not(":parent"),S=A.length,C=0;C<S;C++){var R=A[C];E=p[v.get(R.id())]-R.width()/2,T=p[v.get(R.id())]+R.width()/2,b=m[v.get(R.id())]-R.height()/2,w=m[v.get(R.id())]+R.height()/2,g>E&&(g=E),y<T&&(y=T),_>b&&(_=b),x<w&&(x=w)}var P={};return P.topLeftX=g,P.topLeftY=_,P.width=y-g,P.height=x-_,P},d.calcParentsWithoutChildren=function(f,p){var m=f.collection();return p.nodes(":parent").forEach(function(v){var g=!1;v.children().forEach(function(y){y.css("display")!="none"&&(g=!0)}),g||m.merge(v)}),m},o.exports=d},816:(o,l,u)=>{var c=u(548),h=u(140).CoSELayout,d=u(140).CoSENode,f=u(140).layoutBase.PointD,p=u(140).layoutBase.DimensionD,m=u(140).layoutBase.LayoutConstants,v=u(140).layoutBase.FDLayoutConstants,g=u(140).CoSEConstants,y=function(x,E){var T=x.cy,b=x.eles,w=b.nodes(),A=b.edges(),S=void 0,C=void 0,R=void 0,P={};x.randomize&&(S=E.nodeIndexes,C=E.xCoords,R=E.yCoords);var M=function(G){return typeof G=="function"},N=function(G,O){return M(G)?G(O):G},D=c.calcParentsWithoutChildren(T,b),I=function U(G,O,F,V){for(var $=O.length,Z=0;Z<$;Z++){var Y=O[Z],X=null;Y.intersection(D).length==0&&(X=Y.children());var K=void 0,se=Y.layoutDimensions({nodeDimensionsIncludeLabels:V.nodeDimensionsIncludeLabels});if(Y.outerWidth()!=null&&Y.outerHeight()!=null)if(V.randomize)if(!Y.isParent())K=G.add(new d(F.graphManager,new f(C[S.get(Y.id())]-se.w/2,R[S.get(Y.id())]-se.h/2),new p(parseFloat(se.w),parseFloat(se.h))));else{var oe=c.calcBoundingBox(Y,C,R,S);Y.intersection(D).length==0?K=G.add(new d(F.graphManager,new f(oe.topLeftX,oe.topLeftY),new p(oe.width,oe.height))):K=G.add(new d(F.graphManager,new f(oe.topLeftX,oe.topLeftY),new p(parseFloat(se.w),parseFloat(se.h))))}else K=G.add(new d(F.graphManager,new f(Y.position("x")-se.w/2,Y.position("y")-se.h/2),new p(parseFloat(se.w),parseFloat(se.h))));else K=G.add(new d(this.graphManager));if(K.id=Y.data("id"),K.nodeRepulsion=N(V.nodeRepulsion,Y),K.paddingLeft=parseInt(Y.css("padding")),K.paddingTop=parseInt(Y.css("padding")),K.paddingRight=parseInt(Y.css("padding")),K.paddingBottom=parseInt(Y.css("padding")),V.nodeDimensionsIncludeLabels&&(K.labelWidth=Y.boundingBox({includeLabels:!0,includeNodes:!1,includeOverlays:!1}).w,K.labelHeight=Y.boundingBox({includeLabels:!0,includeNodes:!1,includeOverlays:!1}).h,K.labelPosVertical=Y.css("text-valign"),K.labelPosHorizontal=Y.css("text-halign")),P[Y.data("id")]=K,isNaN(K.rect.x)&&(K.rect.x=0),isNaN(K.rect.y)&&(K.rect.y=0),X!=null&&X.length>0){var W=void 0;W=F.getGraphManager().add(F.newGraph(),K),U(W,X,F,V)}}},L=function(G,O,F){for(var V=0,$=0,Z=0;Z<F.length;Z++){var Y=F[Z],X=P[Y.data("source")],K=P[Y.data("target")];if(X&&K&&X!==K&&X.getEdgesBetween(K).length==0){var se=O.add(G.newEdge(),X,K);se.id=Y.id(),se.idealLength=N(x.idealEdgeLength,Y),se.edgeElasticity=N(x.edgeElasticity,Y),V+=se.idealLength,$++}}x.idealEdgeLength!=null&&($>0?g.DEFAULT_EDGE_LENGTH=v.DEFAULT_EDGE_LENGTH=V/$:M(x.idealEdgeLength)?g.DEFAULT_EDGE_LENGTH=v.DEFAULT_EDGE_LENGTH=50:g.DEFAULT_EDGE_LENGTH=v.DEFAULT_EDGE_LENGTH=x.idealEdgeLength,g.MIN_REPULSION_DIST=v.MIN_REPULSION_DIST=v.DEFAULT_EDGE_LENGTH/10,g.DEFAULT_RADIAL_SEPARATION=v.DEFAULT_EDGE_LENGTH)},z=function(G,O){O.fixedNodeConstraint&&(G.constraints.fixedNodeConstraint=O.fixedNodeConstraint),O.alignmentConstraint&&(G.constraints.alignmentConstraint=O.alignmentConstraint),O.relativePlacementConstraint&&(G.constraints.relativePlacementConstraint=O.relativePlacementConstraint)};x.nestingFactor!=null&&(g.PER_LEVEL_IDEAL_EDGE_LENGTH_FACTOR=v.PER_LEVEL_IDEAL_EDGE_LENGTH_FACTOR=x.nestingFactor),x.gravity!=null&&(g.DEFAULT_GRAVITY_STRENGTH=v.DEFAULT_GRAVITY_STRENGTH=x.gravity),x.numIter!=null&&(g.MAX_ITERATIONS=v.MAX_ITERATIONS=x.numIter),x.gravityRange!=null&&(g.DEFAULT_GRAVITY_RANGE_FACTOR=v.DEFAULT_GRAVITY_RANGE_FACTOR=x.gravityRange),x.gravityCompound!=null&&(g.DEFAULT_COMPOUND_GRAVITY_STRENGTH=v.DEFAULT_COMPOUND_GRAVITY_STRENGTH=x.gravityCompound),x.gravityRangeCompound!=null&&(g.DEFAULT_COMPOUND_GRAVITY_RANGE_FACTOR=v.DEFAULT_COMPOUND_GRAVITY_RANGE_FACTOR=x.gravityRangeCompound),x.initialEnergyOnIncremental!=null&&(g.DEFAULT_COOLING_FACTOR_INCREMENTAL=v.DEFAULT_COOLING_FACTOR_INCREMENTAL=x.initialEnergyOnIncremental),x.tilingCompareBy!=null&&(g.TILING_COMPARE_BY=x.tilingCompareBy),x.quality=="proof"?m.QUALITY=2:m.QUALITY=0,g.NODE_DIMENSIONS_INCLUDE_LABELS=v.NODE_DIMENSIONS_INCLUDE_LABELS=m.NODE_DIMENSIONS_INCLUDE_LABELS=x.nodeDimensionsIncludeLabels,g.DEFAULT_INCREMENTAL=v.DEFAULT_INCREMENTAL=m.DEFAULT_INCREMENTAL=!x.randomize,g.ANIMATE=v.ANIMATE=m.ANIMATE=x.animate,g.TILE=x.tile,g.TILING_PADDING_VERTICAL=typeof x.tilingPaddingVertical=="function"?x.tilingPaddingVertical.call():x.tilingPaddingVertical,g.TILING_PADDING_HORIZONTAL=typeof x.tilingPaddingHorizontal=="function"?x.tilingPaddingHorizontal.call():x.tilingPaddingHorizontal,g.DEFAULT_INCREMENTAL=v.DEFAULT_INCREMENTAL=m.DEFAULT_INCREMENTAL=!0,g.PURE_INCREMENTAL=!x.randomize,m.DEFAULT_UNIFORM_LEAF_NODE_SIZES=x.uniformNodeDimensions,x.step=="transformed"&&(g.TRANSFORM_ON_CONSTRAINT_HANDLING=!0,g.ENFORCE_CONSTRAINTS=!1,g.APPLY_LAYOUT=!1),x.step=="enforced"&&(g.TRANSFORM_ON_CONSTRAINT_HANDLING=!1,g.ENFORCE_CONSTRAINTS=!0,g.APPLY_LAYOUT=!1),x.step=="cose"&&(g.TRANSFORM_ON_CONSTRAINT_HANDLING=!1,g.ENFORCE_CONSTRAINTS=!1,g.APPLY_LAYOUT=!0),x.step=="all"&&(x.randomize?g.TRANSFORM_ON_CONSTRAINT_HANDLING=!0:g.TRANSFORM_ON_CONSTRAINT_HANDLING=!1,g.ENFORCE_CONSTRAINTS=!0,g.APPLY_LAYOUT=!0),x.fixedNodeConstraint||x.alignmentConstraint||x.relativePlacementConstraint?g.TREE_REDUCTION_ON_INCREMENTAL=!1:g.TREE_REDUCTION_ON_INCREMENTAL=!0;var B=new h,k=B.newGraphManager();return I(k.addRoot(),c.getTopMostNodes(w),B,x),L(B,k,A),z(B,x),B.runLayout(),P};o.exports={coseLayout:y}},212:(o,l,u)=>{var c=function(){function x(E,T){for(var b=0;b<T.length;b++){var w=T[b];w.enumerable=w.enumerable||!1,w.configurable=!0,"value"in w&&(w.writable=!0),Object.defineProperty(E,w.key,w)}}return function(E,T,b){return T&&x(E.prototype,T),b&&x(E,b),E}}();function h(x,E){if(!(x instanceof E))throw new TypeError("Cannot call a class as a function")}var d=u(658),f=u(548),p=u(657),m=p.spectralLayout,v=u(816),g=v.coseLayout,y=Object.freeze({quality:"default",randomize:!0,animate:!0,animationDuration:1e3,animationEasing:void 0,fit:!0,padding:30,nodeDimensionsIncludeLabels:!1,uniformNodeDimensions:!1,packComponents:!0,step:"all",samplingType:!0,sampleSize:25,nodeSeparation:75,piTol:1e-7,nodeRepulsion:function(E){return 4500},idealEdgeLength:function(E){return 50},edgeElasticity:function(E){return .45},nestingFactor:.1,gravity:.25,numIter:2500,tile:!0,tilingCompareBy:void 0,tilingPaddingVertical:10,tilingPaddingHorizontal:10,gravityRangeCompound:1.5,gravityCompound:1,gravityRange:3.8,initialEnergyOnIncremental:.3,fixedNodeConstraint:void 0,alignmentConstraint:void 0,relativePlacementConstraint:void 0,ready:function(){},stop:function(){}}),_=function(){function x(E){h(this,x),this.options=d({},y,E)}return c(x,[{key:"run",value:function(){var T=this,b=this.options,w=b.cy,A=b.eles,S=[],C=[],R=void 0,P=[];b.fixedNodeConstraint&&(!Array.isArray(b.fixedNodeConstraint)||b.fixedNodeConstraint.length==0)&&(b.fixedNodeConstraint=void 0),b.alignmentConstraint&&(b.alignmentConstraint.vertical&&(!Array.isArray(b.alignmentConstraint.vertical)||b.alignmentConstraint.vertical.length==0)&&(b.alignmentConstraint.vertical=void 0),b.alignmentConstraint.horizontal&&(!Array.isArray(b.alignmentConstraint.horizontal)||b.alignmentConstraint.horizontal.length==0)&&(b.alignmentConstraint.horizontal=void 0)),b.relativePlacementConstraint&&(!Array.isArray(b.relativePlacementConstraint)||b.relativePlacementConstraint.length==0)&&(b.relativePlacementConstraint=void 0);var M=b.fixedNodeConstraint||b.alignmentConstraint||b.relativePlacementConstraint;M&&(b.tile=!1,b.packComponents=!1);var N=void 0,D=!1;if(w.layoutUtilities&&b.packComponents&&(N=w.layoutUtilities("get"),N||(N=w.layoutUtilities()),D=!0),A.nodes().length>0)if(D){var z=f.getTopMostNodes(b.eles.nodes());if(R=f.connectComponents(w,b.eles,z),R.forEach(function(we){var pe=we.boundingBox();P.push({x:pe.x1+pe.w/2,y:pe.y1+pe.h/2})}),b.randomize&&R.forEach(function(we){b.eles=we,S.push(m(b))}),b.quality=="default"||b.quality=="proof"){var B=w.collection();if(b.tile){var k=new Map,U=[],G=[],O=0,F={nodeIndexes:k,xCoords:U,yCoords:G},V=[];if(R.forEach(function(we,pe){we.edges().length==0&&(we.nodes().forEach(function(Me,Ae){B.merge(we.nodes()[Ae]),Me.isParent()||(F.nodeIndexes.set(we.nodes()[Ae].id(),O++),F.xCoords.push(we.nodes()[0].position().x),F.yCoords.push(we.nodes()[0].position().y))}),V.push(pe))}),B.length>1){var $=B.boundingBox();P.push({x:$.x1+$.w/2,y:$.y1+$.h/2}),R.push(B),S.push(F);for(var Z=V.length-1;Z>=0;Z--)R.splice(V[Z],1),S.splice(V[Z],1),P.splice(V[Z],1)}}R.forEach(function(we,pe){b.eles=we,C.push(g(b,S[pe])),f.relocateComponent(P[pe],C[pe],b)})}else R.forEach(function(we,pe){f.relocateComponent(P[pe],S[pe],b)});var Y=new Set;if(R.length>1){var X=[],K=A.filter(function(we){return we.css("display")=="none"});R.forEach(function(we,pe){var Me=void 0;if(b.quality=="draft"&&(Me=S[pe].nodeIndexes),we.nodes().not(K).length>0){var Ae={};Ae.edges=[],Ae.nodes=[];var j=void 0;we.nodes().not(K).forEach(function(H){if(b.quality=="draft")if(!H.isParent())j=Me.get(H.id()),Ae.nodes.push({x:S[pe].xCoords[j]-H.boundingbox().w/2,y:S[pe].yCoords[j]-H.boundingbox().h/2,width:H.boundingbox().w,height:H.boundingbox().h});else{var te=f.calcBoundingBox(H,S[pe].xCoords,S[pe].yCoords,Me);Ae.nodes.push({x:te.topLeftX,y:te.topLeftY,width:te.width,height:te.height})}else C[pe][H.id()]&&Ae.nodes.push({x:C[pe][H.id()].getLeft(),y:C[pe][H.id()].getTop(),width:C[pe][H.id()].getWidth(),height:C[pe][H.id()].getHeight()})}),we.edges().forEach(function(H){var te=H.source(),me=H.target();if(te.css("display")!="none"&&me.css("display")!="none")if(b.quality=="draft"){var Ee=Me.get(te.id()),le=Me.get(me.id()),q=[],ne=[];if(te.isParent()){var fe=f.calcBoundingBox(te,S[pe].xCoords,S[pe].yCoords,Me);q.push(fe.topLeftX+fe.width/2),q.push(fe.topLeftY+fe.height/2)}else q.push(S[pe].xCoords[Ee]),q.push(S[pe].yCoords[Ee]);if(me.isParent()){var ce=f.calcBoundingBox(me,S[pe].xCoords,S[pe].yCoords,Me);ne.push(ce.topLeftX+ce.width/2),ne.push(ce.topLeftY+ce.height/2)}else ne.push(S[pe].xCoords[le]),ne.push(S[pe].yCoords[le]);Ae.edges.push({startX:q[0],startY:q[1],endX:ne[0],endY:ne[1]})}else C[pe][te.id()]&&C[pe][me.id()]&&Ae.edges.push({startX:C[pe][te.id()].getCenterX(),startY:C[pe][te.id()].getCenterY(),endX:C[pe][me.id()].getCenterX(),endY:C[pe][me.id()].getCenterY()})}),Ae.nodes.length>0&&(X.push(Ae),Y.add(pe))}});var se=N.packComponents(X,b.randomize).shifts;if(b.quality=="draft")S.forEach(function(we,pe){var Me=we.xCoords.map(function(j){return j+se[pe].dx}),Ae=we.yCoords.map(function(j){return j+se[pe].dy});we.xCoords=Me,we.yCoords=Ae});else{var oe=0;Y.forEach(function(we){Object.keys(C[we]).forEach(function(pe){var Me=C[we][pe];Me.setCenter(Me.getCenterX()+se[oe].dx,Me.getCenterY()+se[oe].dy)}),oe++})}}}else{var I=b.eles.boundingBox();if(P.push({x:I.x1+I.w/2,y:I.y1+I.h/2}),b.randomize){var L=m(b);S.push(L)}b.quality=="default"||b.quality=="proof"?(C.push(g(b,S[0])),f.relocateComponent(P[0],C[0],b)):f.relocateComponent(P[0],S[0],b)}var W=function(pe,Me){if(b.quality=="default"||b.quality=="proof"){typeof pe=="number"&&(pe=Me);var Ae=void 0,j=void 0,H=pe.data("id");return C.forEach(function(me){H in me&&(Ae={x:me[H].getRect().getCenterX(),y:me[H].getRect().getCenterY()},j=me[H])}),b.nodeDimensionsIncludeLabels&&(j.labelWidth&&(j.labelPosHorizontal=="left"?Ae.x+=j.labelWidth/2:j.labelPosHorizontal=="right"&&(Ae.x-=j.labelWidth/2)),j.labelHeight&&(j.labelPosVertical=="top"?Ae.y+=j.labelHeight/2:j.labelPosVertical=="bottom"&&(Ae.y-=j.labelHeight/2))),Ae==null&&(Ae={x:pe.position("x"),y:pe.position("y")}),{x:Ae.x,y:Ae.y}}else{var te=void 0;return S.forEach(function(me){var Ee=me.nodeIndexes.get(pe.id());Ee!=null&&(te={x:me.xCoords[Ee],y:me.yCoords[Ee]})}),te==null&&(te={x:pe.position("x"),y:pe.position("y")}),{x:te.x,y:te.y}}};if(b.quality=="default"||b.quality=="proof"||b.randomize){var Ne=f.calcParentsWithoutChildren(w,A),Be=A.filter(function(we){return we.css("display")=="none"});b.eles=A.not(Be),A.nodes().not(":parent").not(Be).layoutPositions(T,b,W),Ne.length>0&&Ne.forEach(function(we){we.position(W(we))})}else console.log("If randomize option is set to false, then quality option must be 'default' or 'proof'.")}}]),x}();o.exports=_},657:(o,l,u)=>{var c=u(548),h=u(140).layoutBase.Matrix,d=u(140).layoutBase.SVD,f=function(m){var v=m.cy,g=m.eles,y=g.nodes(),_=g.nodes(":parent"),x=new Map,E=new Map,T=new Map,b=[],w=[],A=[],S=[],C=[],R=[],P=[],M=[],N=void 0,D=1e8,I=1e-9,L=m.piTol,z=m.samplingType,B=m.nodeSeparation,k=void 0,U=function(){for(var ee=0,he=0,ge=!1;he<k;){ee=Math.floor(Math.random()*N),ge=!1;for(var Te=0;Te<he;Te++)if(S[Te]==ee){ge=!0;break}if(!ge)S[he]=ee,he++;else continue}},G=function(ee,he,ge){for(var Te=[],Se=0,Oe=0,J=0,ve=void 0,ue=[],_e=0,ke=1,Ie=0;Ie<N;Ie++)ue[Ie]=D;for(Te[Oe]=ee,ue[ee]=0;Oe>=Se;){J=Te[Se++];for(var je=b[J],$e=0;$e<je.length;$e++)ve=E.get(je[$e]),ue[ve]==D&&(ue[ve]=ue[J]+1,Te[++Oe]=ve);R[J][he]=ue[J]*B}if(ge){for(var Xe=0;Xe<N;Xe++)R[Xe][he]<C[Xe]&&(C[Xe]=R[Xe][he]);for(var Je=0;Je<N;Je++)C[Je]>_e&&(_e=C[Je],ke=Je)}return ke},O=function(ee){var he=void 0;if(ee){he=Math.floor(Math.random()*N);for(var Te=0;Te<N;Te++)C[Te]=D;for(var Se=0;Se<k;Se++)S[Se]=he,he=G(he,Se,ee)}else{U();for(var ge=0;ge<k;ge++)G(S[ge],ge,ee)}for(var Oe=0;Oe<N;Oe++)for(var J=0;J<k;J++)R[Oe][J]*=R[Oe][J];for(var ve=0;ve<k;ve++)P[ve]=[];for(var ue=0;ue<k;ue++)for(var _e=0;_e<k;_e++)P[ue][_e]=R[S[_e]][ue]},F=function(){for(var ee=d.svd(P),he=ee.S,ge=ee.U,Te=ee.V,Se=he[0]*he[0]*he[0],Oe=[],J=0;J<k;J++){Oe[J]=[];for(var ve=0;ve<k;ve++)Oe[J][ve]=0,J==ve&&(Oe[J][ve]=he[J]/(he[J]*he[J]+Se/(he[J]*he[J])))}M=h.multMat(h.multMat(Te,Oe),h.transpose(ge))},V=function(){for(var ee=void 0,he=void 0,ge=[],Te=[],Se=[],Oe=[],J=0;J<N;J++)ge[J]=Math.random(),Te[J]=Math.random();ge=h.normalize(ge),Te=h.normalize(Te);for(var ve=I,ue=I,_e=void 0;;){for(var ke=0;ke<N;ke++)Se[ke]=ge[ke];if(ge=h.multGamma(h.multL(h.multGamma(Se),R,M)),ee=h.dotProduct(Se,ge),ge=h.normalize(ge),ve=h.dotProduct(Se,ge),_e=Math.abs(ve/ue),_e<=1+L&&_e>=1)break;ue=ve}for(var Ie=0;Ie<N;Ie++)Se[Ie]=ge[Ie];for(ue=I;;){for(var je=0;je<N;je++)Oe[je]=Te[je];if(Oe=h.minusOp(Oe,h.multCons(Se,h.dotProduct(Se,Oe))),Te=h.multGamma(h.multL(h.multGamma(Oe),R,M)),he=h.dotProduct(Oe,Te),Te=h.normalize(Te),ve=h.dotProduct(Oe,Te),_e=Math.abs(ve/ue),_e<=1+L&&_e>=1)break;ue=ve}for(var $e=0;$e<N;$e++)Oe[$e]=Te[$e];w=h.multCons(Se,Math.sqrt(Math.abs(ee))),A=h.multCons(Oe,Math.sqrt(Math.abs(he)))};c.connectComponents(v,g,c.getTopMostNodes(y),x),_.forEach(function(ie){c.connectComponents(v,g,c.getTopMostNodes(ie.descendants().intersection(g)),x)});for(var $=0,Z=0;Z<y.length;Z++)y[Z].isParent()||E.set(y[Z].id(),$++);var Y=!0,X=!1,K=void 0;try{for(var se=x.keys()[Symbol.iterator](),oe;!(Y=(oe=se.next()).done);Y=!0){var W=oe.value;E.set(W,$++)}}catch(ie){X=!0,K=ie}finally{try{!Y&&se.return&&se.return()}finally{if(X)throw K}}for(var Ne=0;Ne<E.size;Ne++)b[Ne]=[];_.forEach(function(ie){for(var ee=ie.children().intersection(g);ee.nodes(":childless").length==0;)ee=ee.nodes()[0].children().intersection(g);var he=0,ge=ee.nodes(":childless")[0].connectedEdges().length;ee.nodes(":childless").forEach(function(Te,Se){Te.connectedEdges().length<ge&&(ge=Te.connectedEdges().length,he=Se)}),T.set(ie.id(),ee.nodes(":childless")[he].id())}),y.forEach(function(ie){var ee=void 0;ie.isParent()?ee=E.get(T.get(ie.id())):ee=E.get(ie.id()),ie.neighborhood().nodes().forEach(function(he){g.intersection(ie.edgesWith(he)).length>0&&(he.isParent()?b[ee].push(T.get(he.id())):b[ee].push(he.id()))})});var Be=function(ee){var he=E.get(ee),ge=void 0;x.get(ee).forEach(function(Te){v.getElementById(Te).isParent()?ge=T.get(Te):ge=Te,b[he].push(ge),b[E.get(ge)].push(ee)})},we=!0,pe=!1,Me=void 0;try{for(var Ae=x.keys()[Symbol.iterator](),j;!(we=(j=Ae.next()).done);we=!0){var H=j.value;Be(H)}}catch(ie){pe=!0,Me=ie}finally{try{!we&&Ae.return&&Ae.return()}finally{if(pe)throw Me}}N=E.size;var te=void 0;if(N>2){k=N<m.sampleSize?N:m.sampleSize;for(var me=0;me<N;me++)R[me]=[];for(var Ee=0;Ee<k;Ee++)M[Ee]=[];return m.quality=="draft"||m.step=="all"?(O(z),F(),V(),te={nodeIndexes:E,xCoords:w,yCoords:A}):(E.forEach(function(ie,ee){w.push(v.getElementById(ee).position("x")),A.push(v.getElementById(ee).position("y"))}),te={nodeIndexes:E,xCoords:w,yCoords:A}),te}else{var le=E.keys(),q=v.getElementById(le.next().value),ne=q.position(),fe=q.outerWidth();if(w.push(ne.x),A.push(ne.y),N==2){var ce=v.getElementById(le.next().value),ae=ce.outerWidth();w.push(ne.x+fe/2+ae/2+m.idealEdgeLength),A.push(ne.y)}return te={nodeIndexes:E,xCoords:w,yCoords:A},te}};o.exports={spectralLayout:f}},579:(o,l,u)=>{var c=u(212),h=function(f){!f||f("layout","fcose",c)};typeof cytoscape<"u"&&h(cytoscape),o.exports=h},140:o=>{o.exports=t}},i={};function a(o){var l=i[o];if(l!==void 0)return l.exports;var u=i[o]={exports:{}};return n[o](u,u.exports,a),u.exports}var s=a(579);return s})()})})(H3);const WY=H3.exports;var W3={exports:{}};function qY(r,e){var t,n=1;r==null&&(r=0),e==null&&(e=0);function i(){var a,s=t.length,o,l=0,u=0;for(a=0;a<s;++a)o=t[a],l+=o.x,u+=o.y;for(l=(l/s-r)*n,u=(u/s-e)*n,a=0;a<s;++a)o=t[a],o.x-=l,o.y-=u}return i.initialize=function(a){t=a},i.x=function(a){return arguments.length?(r=+a,i):r},i.y=function(a){return arguments.length?(e=+a,i):e},i.strength=function(a){return arguments.length?(n=+a,i):n},i}function $Y(r){const e=+this._x.call(null,r),t=+this._y.call(null,r);return q3(this.cover(e,t),e,t,r)}function q3(r,e,t,n){if(isNaN(e)||isNaN(t))return r;var i,a=r._root,s={data:n},o=r._x0,l=r._y0,u=r._x1,c=r._y1,h,d,f,p,m,v,g,y;if(!a)return r._root=s,r;for(;a.length;)if((m=e>=(h=(o+u)/2))?o=h:u=h,(v=t>=(d=(l+c)/2))?l=d:c=d,i=a,!(a=a[g=v<<1|m]))return i[g]=s,r;if(f=+r._x.call(null,a.data),p=+r._y.call(null,a.data),e===f&&t===p)return s.next=a,i?i[g]=s:r._root=s,r;do i=i?i[g]=new Array(4):r._root=new Array(4),(m=e>=(h=(o+u)/2))?o=h:u=h,(v=t>=(d=(l+c)/2))?l=d:c=d;while((g=v<<1|m)===(y=(p>=d)<<1|f>=h));return i[y]=a,i[g]=s,r}function XY(r){var e,t,n=r.length,i,a,s=new Array(n),o=new Array(n),l=1/0,u=1/0,c=-1/0,h=-1/0;for(t=0;t<n;++t)isNaN(i=+this._x.call(null,e=r[t]))||isNaN(a=+this._y.call(null,e))||(s[t]=i,o[t]=a,i<l&&(l=i),i>c&&(c=i),a<u&&(u=a),a>h&&(h=a));if(l>c||u>h)return this;for(this.cover(l,u).cover(c,h),t=0;t<n;++t)q3(this,s[t],o[t],r[t]);return this}function YY(r,e){if(isNaN(r=+r)||isNaN(e=+e))return this;var t=this._x0,n=this._y0,i=this._x1,a=this._y1;if(isNaN(t))i=(t=Math.floor(r))+1,a=(n=Math.floor(e))+1;else{for(var s=i-t||1,o=this._root,l,u;t>r||r>=i||n>e||e>=a;)switch(u=(e<n)<<1|r<t,l=new Array(4),l[u]=o,o=l,s*=2,u){case 0:i=t+s,a=n+s;break;case 1:t=i-s,a=n+s;break;case 2:i=t+s,n=a-s;break;case 3:t=i-s,n=a-s;break}this._root&&this._root.length&&(this._root=o)}return this._x0=t,this._y0=n,this._x1=i,this._y1=a,this}function jY(){var r=[];return this.visit(function(e){if(!e.length)do r.push(e.data);while(e=e.next)}),r}function KY(r){return arguments.length?this.cover(+r[0][0],+r[0][1]).cover(+r[1][0],+r[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Kr(r,e,t,n,i){this.node=r,this.x0=e,this.y0=t,this.x1=n,this.y1=i}function QY(r,e,t){var n,i=this._x0,a=this._y0,s,o,l,u,c=this._x1,h=this._y1,d=[],f=this._root,p,m;for(f&&d.push(new Kr(f,i,a,c,h)),t==null?t=1/0:(i=r-t,a=e-t,c=r+t,h=e+t,t*=t);p=d.pop();)if(!(!(f=p.node)||(s=p.x0)>c||(o=p.y0)>h||(l=p.x1)<i||(u=p.y1)<a))if(f.length){var v=(s+l)/2,g=(o+u)/2;d.push(new Kr(f[3],v,g,l,u),new Kr(f[2],s,g,v,u),new Kr(f[1],v,o,l,g),new Kr(f[0],s,o,v,g)),(m=(e>=g)<<1|r>=v)&&(p=d[d.length-1],d[d.length-1]=d[d.length-1-m],d[d.length-1-m]=p)}else{var y=r-+this._x.call(null,f.data),_=e-+this._y.call(null,f.data),x=y*y+_*_;if(x<t){var E=Math.sqrt(t=x);i=r-E,a=e-E,c=r+E,h=e+E,n=f.data}}return n}function ZY(r){if(isNaN(c=+this._x.call(null,r))||isNaN(h=+this._y.call(null,r)))return this;var e,t=this._root,n,i,a,s=this._x0,o=this._y0,l=this._x1,u=this._y1,c,h,d,f,p,m,v,g;if(!t)return this;if(t.length)for(;;){if((p=c>=(d=(s+l)/2))?s=d:l=d,(m=h>=(f=(o+u)/2))?o=f:u=f,e=t,!(t=t[v=m<<1|p]))return this;if(!t.length)break;(e[v+1&3]||e[v+2&3]||e[v+3&3])&&(n=e,g=v)}for(;t.data!==r;)if(i=t,!(t=t.next))return this;return(a=t.next)&&delete t.next,i?(a?i.next=a:delete i.next,this):e?(a?e[v]=a:delete e[v],(t=e[0]||e[1]||e[2]||e[3])&&t===(e[3]||e[2]||e[1]||e[0])&&!t.length&&(n?n[g]=t:this._root=t),this):(this._root=a,this)}function JY(r){for(var e=0,t=r.length;e<t;++e)this.remove(r[e]);return this}function e9(){return this._root}function t9(){var r=0;return this.visit(function(e){if(!e.length)do++r;while(e=e.next)}),r}function n9(r){var e=[],t,n=this._root,i,a,s,o,l;for(n&&e.push(new Kr(n,this._x0,this._y0,this._x1,this._y1));t=e.pop();)if(!r(n=t.node,a=t.x0,s=t.y0,o=t.x1,l=t.y1)&&n.length){var u=(a+o)/2,c=(s+l)/2;(i=n[3])&&e.push(new Kr(i,u,c,o,l)),(i=n[2])&&e.push(new Kr(i,a,c,u,l)),(i=n[1])&&e.push(new Kr(i,u,s,o,c)),(i=n[0])&&e.push(new Kr(i,a,s,u,c))}return this}function r9(r){var e=[],t=[],n;for(this._root&&e.push(new Kr(this._root,this._x0,this._y0,this._x1,this._y1));n=e.pop();){var i=n.node;if(i.length){var a,s=n.x0,o=n.y0,l=n.x1,u=n.y1,c=(s+l)/2,h=(o+u)/2;(a=i[0])&&e.push(new Kr(a,s,o,c,h)),(a=i[1])&&e.push(new Kr(a,c,o,l,h)),(a=i[2])&&e.push(new Kr(a,s,h,c,u)),(a=i[3])&&e.push(new Kr(a,c,h,l,u))}t.push(n)}for(;n=t.pop();)r(n.node,n.x0,n.y0,n.x1,n.y1);return this}function i9(r){return r[0]}function a9(r){return arguments.length?(this._x=r,this):this._x}function s9(r){return r[1]}function o9(r){return arguments.length?(this._y=r,this):this._y}function Uv(r,e,t){var n=new tA(e==null?i9:e,t==null?s9:t,NaN,NaN,NaN,NaN);return r==null?n:n.addAll(r)}function tA(r,e,t,n,i,a){this._x=r,this._y=e,this._x0=t,this._y0=n,this._x1=i,this._y1=a,this._root=void 0}function BN(r){for(var e={data:r.data},t=e;r=r.next;)t=t.next={data:r.data};return e}var ni=Uv.prototype=tA.prototype;ni.copy=function(){var r=new tA(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,t,n;if(!e)return r;if(!e.length)return r._root=BN(e),r;for(t=[{source:e,target:r._root=new Array(4)}];e=t.pop();)for(var i=0;i<4;++i)(n=e.source[i])&&(n.length?t.push({source:n,target:e.target[i]=new Array(4)}):e.target[i]=BN(n));return r};ni.add=$Y;ni.addAll=XY;ni.cover=YY;ni.data=jY;ni.extent=KY;ni.find=QY;ni.remove=ZY;ni.removeAll=JY;ni.root=e9;ni.size=t9;ni.visit=n9;ni.visitAfter=r9;ni.x=a9;ni.y=o9;function rr(r){return function(){return r}}function Ao(r){return(r()-.5)*1e-6}function l9(r){return r.x+r.vx}function u9(r){return r.y+r.vy}function c9(r){var e,t,n,i=1,a=1;typeof r!="function"&&(r=rr(r==null?1:+r));function s(){for(var u,c=e.length,h,d,f,p,m,v,g=0;g<a;++g)for(h=Uv(e,l9,u9).visitAfter(o),u=0;u<c;++u)d=e[u],m=t[d.index],v=m*m,f=d.x+d.vx,p=d.y+d.vy,h.visit(y);function y(_,x,E,T,b){var w=_.data,A=_.r,S=m+A;if(w){if(w.index>d.index){var C=f-w.x-w.vx,R=p-w.y-w.vy,P=C*C+R*R;P<S*S&&(C===0&&(C=Ao(n),P+=C*C),R===0&&(R=Ao(n),P+=R*R),P=(S-(P=Math.sqrt(P)))/P*i,d.vx+=(C*=P)*(S=(A*=A)/(v+A)),d.vy+=(R*=P)*S,w.vx-=C*(S=1-S),w.vy-=R*S)}return}return x>f+S||T<f-S||E>p+S||b<p-S}}function o(u){if(u.data)return u.r=t[u.data.index];for(var c=u.r=0;c<4;++c)u[c]&&u[c].r>u.r&&(u.r=u[c].r)}function l(){if(!!e){var u,c=e.length,h;for(t=new Array(c),u=0;u<c;++u)h=e[u],t[h.index]=+r(h,u,e)}}return s.initialize=function(u,c){e=u,n=c,l()},s.iterations=function(u){return arguments.length?(a=+u,s):a},s.strength=function(u){return arguments.length?(i=+u,s):i},s.radius=function(u){return arguments.length?(r=typeof u=="function"?u:rr(+u),l(),s):r},s}function h9(r){return r.index}function UN(r,e){var t=r.get(e);if(!t)throw new Error("node not found: "+e);return t}function f9(r){var e=h9,t=h,n,i=rr(30),a,s,o,l,u,c=1;r==null&&(r=[]);function h(v){return 1/Math.min(o[v.source.index],o[v.target.index])}function d(v){for(var g=0,y=r.length;g<c;++g)for(var _=0,x,E,T,b,w,A,S;_<y;++_)x=r[_],E=x.source,T=x.target,b=T.x+T.vx-E.x-E.vx||Ao(u),w=T.y+T.vy-E.y-E.vy||Ao(u),A=Math.sqrt(b*b+w*w),A=(A-a[_])/A*v*n[_],b*=A,w*=A,T.vx-=b*(S=l[_]),T.vy-=w*S,E.vx+=b*(S=1-S),E.vy+=w*S}function f(){if(!!s){var v,g=s.length,y=r.length,_=new Map(s.map((E,T)=>[e(E,T,s),E])),x;for(v=0,o=new Array(g);v<y;++v)x=r[v],x.index=v,typeof x.source!="object"&&(x.source=UN(_,x.source)),typeof x.target!="object"&&(x.target=UN(_,x.target)),o[x.source.index]=(o[x.source.index]||0)+1,o[x.target.index]=(o[x.target.index]||0)+1;for(v=0,l=new Array(y);v<y;++v)x=r[v],l[v]=o[x.source.index]/(o[x.source.index]+o[x.target.index]);n=new Array(y),p(),a=new Array(y),m()}}function p(){if(!!s)for(var v=0,g=r.length;v<g;++v)n[v]=+t(r[v],v,r)}function m(){if(!!s)for(var v=0,g=r.length;v<g;++v)a[v]=+i(r[v],v,r)}return d.initialize=function(v,g){s=v,u=g,f()},d.links=function(v){return arguments.length?(r=v,f(),d):r},d.id=function(v){return arguments.length?(e=v,d):e},d.iterations=function(v){return arguments.length?(c=+v,d):c},d.strength=function(v){return arguments.length?(t=typeof v=="function"?v:rr(+v),p(),d):t},d.distance=function(v){return arguments.length?(i=typeof v=="function"?v:rr(+v),m(),d):i},d}var d9={value:()=>{}};function nA(){for(var r=0,e=arguments.length,t={},n;r<e;++r){if(!(n=arguments[r]+"")||n in t||/[\s.]/.test(n))throw new Error("illegal type: "+n);t[n]=[]}return new Eg(t)}function Eg(r){this._=r}function p9(r,e){return r.trim().split(/^|\s+/).map(function(t){var n="",i=t.indexOf(".");if(i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}})}Eg.prototype=nA.prototype={constructor:Eg,on:function(r,e){var t=this._,n=p9(r+"",t),i,a=-1,s=n.length;if(arguments.length<2){for(;++a<s;)if((i=(r=n[a]).type)&&(i=g9(t[i],r.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<s;)if(i=(r=n[a]).type)t[i]=kN(t[i],r.name,e);else if(e==null)for(i in t)t[i]=kN(t[i],r.name,null);return this},copy:function(){var r={},e=this._;for(var t in e)r[t]=e[t].slice();return new Eg(r)},call:function(r,e){if((i=arguments.length-2)>0)for(var t=new Array(i),n=0,i,a;n<i;++n)t[n]=arguments[n+2];if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(a=this._[r],n=0,i=a.length;n<i;++n)a[n].value.apply(e,t)},apply:function(r,e,t){if(!this._.hasOwnProperty(r))throw new Error("unknown type: "+r);for(var n=this._[r],i=0,a=n.length;i<a;++i)n[i].value.apply(e,t)}};function g9(r,e){for(var t=0,n=r.length,i;t<n;++t)if((i=r[t]).name===e)return i.value}function kN(r,e,t){for(var n=0,i=r.length;n<i;++n)if(r[n].name===e){r[n]=d9,r=r.slice(0,n).concat(r.slice(n+1));break}return t!=null&&r.push({name:e,value:t}),r}var Tc=0,ef=0,Sh=0,$3=1e3,Kg,tf,Qg=0,Xl=0,kv=0,If=typeof performance=="object"&&performance.now?performance:Date,X3=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(r){setTimeout(r,17)};function Y3(){return Xl||(X3(v9),Xl=If.now()+kv)}function v9(){Xl=0}function Vw(){this._call=this._time=this._next=null}Vw.prototype=rA.prototype={constructor:Vw,restart:function(r,e,t){if(typeof r!="function")throw new TypeError("callback is not a function");t=(t==null?Y3():+t)+(e==null?0:+e),!this._next&&tf!==this&&(tf?tf._next=this:Kg=this,tf=this),this._call=r,this._time=t,Hw()},stop:function(){this._call&&(this._call=null,this._time=1/0,Hw())}};function rA(r,e,t){var n=new Vw;return n.restart(r,e,t),n}function m9(){Y3(),++Tc;for(var r=Kg,e;r;)(e=Xl-r._time)>=0&&r._call.call(null,e),r=r._next;--Tc}function GN(){Xl=(Qg=If.now())+kv,Tc=ef=0;try{m9()}finally{Tc=0,_9(),Xl=0}}function y9(){var r=If.now(),e=r-Qg;e>$3&&(kv-=e,Qg=r)}function _9(){for(var r,e=Kg,t,n=1/0;e;)e._call?(n>e._time&&(n=e._time),r=e,e=e._next):(t=e._next,e._next=null,e=r?r._next=t:Kg=t);tf=r,Hw(n)}function Hw(r){if(!Tc){ef&&(ef=clearTimeout(ef));var e=r-Xl;e>24?(r<1/0&&(ef=setTimeout(GN,r-If.now()-kv)),Sh&&(Sh=clearInterval(Sh))):(Sh||(Qg=If.now(),Sh=setInterval(y9,$3)),Tc=1,X3(GN))}}const x9=1664525,b9=1013904223,zN=4294967296;function E9(){let r=1;return()=>(r=(x9*r+b9)%zN)/zN}function T9(r){return r.x}function w9(r){return r.y}var S9=10,A9=Math.PI*(3-Math.sqrt(5));function M9(r){var e,t=1,n=.001,i=1-Math.pow(n,1/300),a=0,s=.6,o=new Map,l=rA(h),u=nA("tick","end"),c=E9();r==null&&(r=[]);function h(){d(),u.call("tick",e),t<n&&(l.stop(),u.call("end",e))}function d(m){var v,g=r.length,y;m===void 0&&(m=1);for(var _=0;_<m;++_)for(t+=(a-t)*i,o.forEach(function(x){x(t)}),v=0;v<g;++v)y=r[v],y.fx==null?y.x+=y.vx*=s:(y.x=y.fx,y.vx=0),y.fy==null?y.y+=y.vy*=s:(y.y=y.fy,y.vy=0);return e}function f(){for(var m=0,v=r.length,g;m<v;++m){if(g=r[m],g.index=m,g.fx!=null&&(g.x=g.fx),g.fy!=null&&(g.y=g.fy),isNaN(g.x)||isNaN(g.y)){var y=S9*Math.sqrt(.5+m),_=m*A9;g.x=y*Math.cos(_),g.y=y*Math.sin(_)}(isNaN(g.vx)||isNaN(g.vy))&&(g.vx=g.vy=0)}}function p(m){return m.initialize&&m.initialize(r,c),m}return f(),e={tick:d,restart:function(){return l.restart(h),e},stop:function(){return l.stop(),e},nodes:function(m){return arguments.length?(r=m,f(),o.forEach(p),e):r},alpha:function(m){return arguments.length?(t=+m,e):t},alphaMin:function(m){return arguments.length?(n=+m,e):n},alphaDecay:function(m){return arguments.length?(i=+m,e):+i},alphaTarget:function(m){return arguments.length?(a=+m,e):a},velocityDecay:function(m){return arguments.length?(s=1-m,e):1-s},randomSource:function(m){return arguments.length?(c=m,o.forEach(p),e):c},force:function(m,v){return arguments.length>1?(v==null?o.delete(m):o.set(m,p(v)),e):o.get(m)},find:function(m,v,g){var y=0,_=r.length,x,E,T,b,w;for(g==null?g=1/0:g*=g,y=0;y<_;++y)b=r[y],x=m-b.x,E=v-b.y,T=x*x+E*E,T<g&&(w=b,g=T);return w},on:function(m,v){return arguments.length>1?(u.on(m,v),e):u.on(m)}}}function C9(){var r,e,t,n,i=rr(-30),a,s=1,o=1/0,l=.81;function u(f){var p,m=r.length,v=Uv(r,T9,w9).visitAfter(h);for(n=f,p=0;p<m;++p)e=r[p],v.visit(d)}function c(){if(!!r){var f,p=r.length,m;for(a=new Array(p),f=0;f<p;++f)m=r[f],a[m.index]=+i(m,f,r)}}function h(f){var p=0,m,v,g=0,y,_,x;if(f.length){for(y=_=x=0;x<4;++x)(m=f[x])&&(v=Math.abs(m.value))&&(p+=m.value,g+=v,y+=v*m.x,_+=v*m.y);f.x=y/g,f.y=_/g}else{m=f,m.x=m.data.x,m.y=m.data.y;do p+=a[m.data.index];while(m=m.next)}f.value=p}function d(f,p,m,v){if(!f.value)return!0;var g=f.x-e.x,y=f.y-e.y,_=v-p,x=g*g+y*y;if(_*_/l<x)return x<o&&(g===0&&(g=Ao(t),x+=g*g),y===0&&(y=Ao(t),x+=y*y),x<s&&(x=Math.sqrt(s*x)),e.vx+=g*f.value*n/x,e.vy+=y*f.value*n/x),!0;if(f.length||x>=o)return;(f.data!==e||f.next)&&(g===0&&(g=Ao(t),x+=g*g),y===0&&(y=Ao(t),x+=y*y),x<s&&(x=Math.sqrt(s*x)));do f.data!==e&&(_=a[f.data.index]*n/x,e.vx+=g*_,e.vy+=y*_);while(f=f.next)}return u.initialize=function(f,p){r=f,t=p,c()},u.strength=function(f){return arguments.length?(i=typeof f=="function"?f:rr(+f),c(),u):i},u.distanceMin=function(f){return arguments.length?(s=f*f,u):Math.sqrt(s)},u.distanceMax=function(f){return arguments.length?(o=f*f,u):Math.sqrt(o)},u.theta=function(f){return arguments.length?(l=f*f,u):Math.sqrt(l)},u}function R9(r,e,t){var n,i=rr(.1),a,s;typeof r!="function"&&(r=rr(+r)),e==null&&(e=0),t==null&&(t=0);function o(u){for(var c=0,h=n.length;c<h;++c){var d=n[c],f=d.x-e||1e-6,p=d.y-t||1e-6,m=Math.sqrt(f*f+p*p),v=(s[c]-m)*a[c]*u/m;d.vx+=f*v,d.vy+=p*v}}function l(){if(!!n){var u,c=n.length;for(a=new Array(c),s=new Array(c),u=0;u<c;++u)s[u]=+r(n[u],u,n),a[u]=isNaN(s[u])?0:+i(n[u],u,n)}}return o.initialize=function(u){n=u,l()},o.strength=function(u){return arguments.length?(i=typeof u=="function"?u:rr(+u),l(),o):i},o.radius=function(u){return arguments.length?(r=typeof u=="function"?u:rr(+u),l(),o):r},o.x=function(u){return arguments.length?(e=+u,o):e},o.y=function(u){return arguments.length?(t=+u,o):t},o}function N9(r){var e=rr(.1),t,n,i;typeof r!="function"&&(r=rr(r==null?0:+r));function a(o){for(var l=0,u=t.length,c;l<u;++l)c=t[l],c.vx+=(i[l]-c.x)*n[l]*o}function s(){if(!!t){var o,l=t.length;for(n=new Array(l),i=new Array(l),o=0;o<l;++o)n[o]=isNaN(i[o]=+r(t[o],o,t))?0:+e(t[o],o,t)}}return a.initialize=function(o){t=o,s()},a.strength=function(o){return arguments.length?(e=typeof o=="function"?o:rr(+o),s(),a):e},a.x=function(o){return arguments.length?(r=typeof o=="function"?o:rr(+o),s(),a):r},a}function P9(r){var e=rr(.1),t,n,i;typeof r!="function"&&(r=rr(r==null?0:+r));function a(o){for(var l=0,u=t.length,c;l<u;++l)c=t[l],c.vy+=(i[l]-c.y)*n[l]*o}function s(){if(!!t){var o,l=t.length;for(n=new Array(l),i=new Array(l),o=0;o<l;++o)n[o]=isNaN(i[o]=+r(t[o],o,t))?0:+e(t[o],o,t)}}return a.initialize=function(o){t=o,s()},a.strength=function(o){return arguments.length?(e=typeof o=="function"?o:rr(+o),s(),a):e},a.y=function(o){return arguments.length?(r=typeof o=="function"?o:rr(+o),s(),a):r},a}const D9=Object.freeze(Object.defineProperty({__proto__:null,forceCenter:qY,forceCollide:c9,forceLink:f9,forceManyBody:C9,forceRadial:R9,forceSimulation:M9,forceX:N9,forceY:P9},Symbol.toStringTag,{value:"Module"})),L9=XH(D9);(function(r,e){(function(n,i){r.exports=i(L9)})(Ui,function(t){return function(n){var i={};function a(s){if(i[s])return i[s].exports;var o=i[s]={i:s,l:!1,exports:{}};return n[s].call(o.exports,o,o.exports,a),o.l=!0,o.exports}return a.m=n,a.c=i,a.i=function(s){return s},a.d=function(s,o,l){a.o(s,o)||Object.defineProperty(s,o,{configurable:!1,enumerable:!0,get:l})},a.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return a.d(o,"a",o),o},a.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)},a.p="",a(a.s=3)}([function(n,i,a){var s=function(){function d(f,p){for(var m=0;m<p.length;m++){var v=p[m];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(f,v.key,v)}}return function(f,p,m){return p&&d(f.prototype,p),m&&d(f,m),f}}();function o(d,f){if(!(d instanceof f))throw new TypeError("Cannot call a class as a function")}var l=a(2),u=a(4),c=a(1),h=function(){function d(f){o(this,d);var p=this.options=c({},l,f);this.state=c({},p,{layout:this,nodes:p.eles.nodes(),edges:p.eles.edges(),progress:0,iterations:0,startTime:0}),this.simulation=null,this.removeCytoscapeEvents=null,this.destroyedEvent=null}return s(d,[{key:"makeBoundingBox",value:function(p,m){return p==null?p={x1:0,y1:0,w:m.width(),h:m.height()}:p={x1:p.x1,x2:p.x2,y1:p.y1,y2:p.y2,w:p.w,h:p.h},p.x2==null&&(p.x2=p.x1+p.w),p.w==null&&(p.w=p.x2-p.x1),p.y2==null&&(p.y2=p.y1+p.h),p.h==null&&(p.h=p.y2-p.y1),p}},{key:"setInitialPositionState",value:function(p,m){var v=p.position(),g=m.currentBoundingBox,y=p.scratch(m.name);y==null&&(y={},p.scratch(m.name,y)),c(y,m.randomize?{x:g.x1+Math.round(Math.random()*g.w),y:g.y1+Math.round(Math.random()*g.h)}:{x:v.x,y:v.y}),p.locked()&&c(y,{fx:v.x,fy:v.y})}},{key:"refreshPositions",value:function(p,m,v){p.positions(function(g){var y=g.scratch(m.name);return{x:y.x,y:y.y}}),v&&m.cy.fit(m.padding)}},{key:"getScratch",value:function(p){var m=this.state.name,v=p.scratch(m);return v||(v={},p.scratch(m,v)),v}},{key:"ungrabify",value:function(p){var m=this;!this.state.ungrabifyWhileSimulating||(p.filter(function(v){var g=m.getScratch(v).grabbable=v.grabbable();return g}),p.ungrabify())}},{key:"regrabify",value:function(p){var m=this;!this.state.ungrabifyWhileSimulating||(p.filter(function(v){var g=m.getScratch(v).grabbable;return g}),p.grabify())}},{key:"tick",value:function(){var p=this.state;p.progress+=1/Math.ceil(Math.log(this.simulation.alphaMin())/Math.log(1-this.simulation.alphaDecay())),p.iterations++;var m=p.maxIterations&&!p.infinite?p.iterations/p.maxIterations:0,v=Date.now()-p.startTime,g=p.maxSimulationTime&&!p.infinite?v/p.maxSimulationTime:0,y=Math.max(m,g,p.progress);if(y=y>1?1:y,y>=1){this.end(!p.infinite);return}p.tick&&p.tick(y),p.animate&&this.refreshPositions(p.nodes,p,p.fit)}},{key:"end",value:function(p){var m=this.state;this.refreshPositions(m.nodes,m,m.fit),this.emit("layoutstop",m.cy),this.reset(p)}},{key:"reset",value:function(p){this.simulation&&this.simulation.stop();var m=this.state;return this.destroyedEvent&&this.destroyedEvent(),(p||!m.infinite)&&this.removeCytoscapeEvents&&this.removeCytoscapeEvents(),m.animate&&this.regrabify(m.nodes),this}},{key:"run",value:function(){var p=this;this.reset();var m=this,v=this.state,g=!1;if(v.currentBoundingBox=this.makeBoundingBox(v.boundingBox,v.cy),v.ready&&m.one("layoutready",v.ready),v.stop&&m.one("layoutstop",v.stop),v.nodes.forEach(function(M){return p.setInitialPositionState(M,v)}),g||(g=!0,m.emit("layoutready")),!m.simulation){var y=v.nodes.map(function(M){return c(m.getScratch(M),M.data())}),_=v.edges.map(function(M){return c({},M.data())});m.simulation=u.forceSimulation(y),v.alpha&&m.simulation.alpha(v.alpha),v.alphaMin&&m.simulation.alphaMin(v.alphaMin),v.alphaDecay&&m.simulation.alphaDecay(v.alphaDecay),v.alphaTarget&&m.simulation.alphaTarget(v.alphaTarget),v.velocityDecay&&m.simulation.velocityDecay(v.velocityDecay);var x=u.forceCollide();v.collideRadius&&x.radius(v.collideRadius),v.collideStrength&&x.strength(v.collideStrength),v.collideIterations&&x.iterations(v.collideIterations);var E=u.forceLink(_);v.linkId&&E.id(v.linkId),v.linkDistance&&E.distance(v.linkDistance),v.linkStrength&&E.strength(v.linkStrength),v.linkIterations&&E.iterations(v.linkIterations);var T=u.forceManyBody();v.manyBodyStrength&&T.strength(v.manyBodyStrength),v.manyBodyTheta&&T.theta(v.manyBodyTheta),v.manyBodyDistanceMin&&T.distanceMin(v.manyBodyDistanceMin),v.manyBodyDistanceMax&&T.distanceMax(v.manyBodyDistanceMax);var b=u.forceX();v.xX&&b.x(v.xX),v.xStrength&&b.strength(v.xStrength);var w=u.forceY();v.yY&&w.y(v.yY),v.yStrength&&w.strength(v.yStrength);var A=null;(v.radialRadius||v.radialStrength||v.radialX||v.radialY)&&(A=u.forceRadial(),v.radialRadius&&A.radius(v.radialRadius),v.radialStrength&&A.strength(v.radialStrength),v.radialX&&A.x(v.radialX),v.radialY&&A.y(v.radialY));var S=u.forceCenter(v.currentBoundingBox.w/2,v.currentBoundingBox.h/2);m.simulation.force("collide",x).force("link",E).force("many-body",T).force("x",b).force("y",w).force("center",S),A&&m.simulation.force("radius",A),m.simulation.on("tick",function(){m.tick()}).on("end",function(){m.end()})}if(!m.destroyedEvent){var C=void 0;v.cy.one("destroy",C=function(){m.stop()}),m.destroyedEvent=function(){v.cy.off("destroy",C),m.destroyedEvent=null}}if(m.prerun(v),m.emit("layoutstart"),v.progress=0,v.iterations=0,v.startTime=Date.now(),v.animate){var R=Math.abs((v.alpha||1)-(v.alphaTarget||0))/3;if(!m.removeCytoscapeEvents){var P=function(N){var D=this,I=D.position(),L=N.cyTarget===D||N.target===D;if(!!L){var z=m.getScratch(D);v.progress=0,v.iterations=0,v.startTime=Date.now(),z.x=I.x,z.y=I.y,N.type==="grab"?m.simulation.alphaTarget(R).restart():N.type==="unlock"||N.type==="free"?(v.fixedAfterDragging?(z.fx=I.x,z.fy=I.y):(delete z.fx,delete z.fy),m.simulation.alphaTarget(R).restart()):(z.fx=I.x,z.fy=I.y)}};m.removeCytoscapeEvents=function(){v.nodes.off("grab free drag lock unlock",P),m.removeCytoscapeEvents=null},v.nodes.on("grab free drag lock unlock",P)}m.ungrabify(v.nodes)}return m.postrun(v),this}},{key:"prerun",value:function(){}},{key:"postrun",value:function(){}},{key:"stop",value:function(){return this.reset(!0)}}]),d}();n.exports=h},function(n,i,a){n.exports=Object.assign!=null?Object.assign.bind(Object):function(s){for(var o=arguments.length,l=Array(o>1?o-1:0),u=1;u<o;u++)l[u-1]=arguments[u];return l.forEach(function(c){Object.keys(c).forEach(function(h){return s[h]=c[h]})}),s}},function(n,i,a){n.exports=Object.freeze({animate:!0,maxIterations:0,maxSimulationTime:0,ungrabifyWhileSimulating:!1,fixedAfterDragging:!1,fit:!1,padding:30,boundingBox:void 0,alpha:void 0,alphaMin:void 0,alphaDecay:void 0,alphaTarget:void 0,velocityDecay:void 0,collideRadius:void 0,collideStrength:void 0,collideIterations:void 0,linkId:void 0,linkDistance:30,linkStrength:void 0,linkIterations:void 0,manyBodyStrength:void 0,manyBodyTheta:void 0,manyBodyDistanceMin:void 0,manyBodyDistanceMax:void 0,xStrength:void 0,xX:void 0,yStrength:void 0,yY:void 0,radialStrength:void 0,radialRadius:void 0,radialX:void 0,radialY:void 0,ready:function(){},stop:function(){},tick:function(){},randomize:!1,infinite:!1})},function(n,i,a){var s=a(0),o=function(u){!u||u("layout","d3-force",s)};typeof cytoscape<"u"&&o(cytoscape),n.exports=o},function(n,i){n.exports=t}])})})(W3);const I9=CS(W3.exports);var j3={exports:{}},_0,VN;function O9(){if(VN)return _0;VN=1;function r(){this.__data__=[],this.size=0}return _0=r,_0}var x0,HN;function nh(){if(HN)return x0;HN=1;function r(e,t){return e===t||e!==e&&t!==t}return x0=r,x0}var b0,WN;function Gv(){if(WN)return b0;WN=1;var r=nh();function e(t,n){for(var i=t.length;i--;)if(r(t[i][0],n))return i;return-1}return b0=e,b0}var E0,qN;function F9(){if(qN)return E0;qN=1;var r=Gv(),e=Array.prototype,t=e.splice;function n(i){var a=this.__data__,s=r(a,i);if(s<0)return!1;var o=a.length-1;return s==o?a.pop():t.call(a,s,1),--this.size,!0}return E0=n,E0}var T0,$N;function B9(){if($N)return T0;$N=1;var r=Gv();function e(t){var n=this.__data__,i=r(n,t);return i<0?void 0:n[i][1]}return T0=e,T0}var w0,XN;function U9(){if(XN)return w0;XN=1;var r=Gv();function e(t){return r(this.__data__,t)>-1}return w0=e,w0}var S0,YN;function k9(){if(YN)return S0;YN=1;var r=Gv();function e(t,n){var i=this.__data__,a=r(i,t);return a<0?(++this.size,i.push([t,n])):i[a][1]=n,this}return S0=e,S0}var A0,jN;function zv(){if(jN)return A0;jN=1;var r=O9(),e=F9(),t=B9(),n=U9(),i=k9();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=r,a.prototype.delete=e,a.prototype.get=t,a.prototype.has=n,a.prototype.set=i,A0=a,A0}var M0,KN;function G9(){if(KN)return M0;KN=1;var r=zv();function e(){this.__data__=new r,this.size=0}return M0=e,M0}var C0,QN;function z9(){if(QN)return C0;QN=1;function r(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}return C0=r,C0}var R0,ZN;function V9(){if(ZN)return R0;ZN=1;function r(e){return this.__data__.get(e)}return R0=r,R0}var N0,JN;function H9(){if(JN)return N0;JN=1;function r(e){return this.__data__.has(e)}return N0=r,N0}var P0,eP;function K3(){if(eP)return P0;eP=1;var r=typeof Ui=="object"&&Ui&&Ui.Object===Object&&Ui;return P0=r,P0}var D0,tP;function Ga(){if(tP)return D0;tP=1;var r=K3(),e=typeof self=="object"&&self&&self.Object===Object&&self,t=r||e||Function("return this")();return D0=t,D0}var L0,nP;function rh(){if(nP)return L0;nP=1;var r=Ga(),e=r.Symbol;return L0=e,L0}var I0,rP;function W9(){if(rP)return I0;rP=1;var r=rh(),e=Object.prototype,t=e.hasOwnProperty,n=e.toString,i=r?r.toStringTag:void 0;function a(s){var o=t.call(s,i),l=s[i];try{s[i]=void 0;var u=!0}catch{}var c=n.call(s);return u&&(o?s[i]=l:delete s[i]),c}return I0=a,I0}var O0,iP;function q9(){if(iP)return O0;iP=1;var r=Object.prototype,e=r.toString;function t(n){return e.call(n)}return O0=t,O0}var F0,aP;function ru(){if(aP)return F0;aP=1;var r=rh(),e=W9(),t=q9(),n="[object Null]",i="[object Undefined]",a=r?r.toStringTag:void 0;function s(o){return o==null?o===void 0?i:n:a&&a in Object(o)?e(o):t(o)}return F0=s,F0}var B0,sP;function fa(){if(sP)return B0;sP=1;function r(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}return B0=r,B0}var U0,oP;function wd(){if(oP)return U0;oP=1;var r=ru(),e=fa(),t="[object AsyncFunction]",n="[object Function]",i="[object GeneratorFunction]",a="[object Proxy]";function s(o){if(!e(o))return!1;var l=r(o);return l==n||l==i||l==t||l==a}return U0=s,U0}var k0,lP;function $9(){if(lP)return k0;lP=1;var r=Ga(),e=r["__core-js_shared__"];return k0=e,k0}var G0,uP;function X9(){if(uP)return G0;uP=1;var r=$9(),e=function(){var n=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function t(n){return!!e&&e in n}return G0=t,G0}var z0,cP;function Q3(){if(cP)return z0;cP=1;var r=Function.prototype,e=r.toString;function t(n){if(n!=null){try{return e.call(n)}catch{}try{return n+""}catch{}}return""}return z0=t,z0}var V0,hP;function Y9(){if(hP)return V0;hP=1;var r=wd(),e=X9(),t=fa(),n=Q3(),i=/[\\^$.*+?()[\]{}|]/g,a=/^\[object .+?Constructor\]$/,s=Function.prototype,o=Object.prototype,l=s.toString,u=o.hasOwnProperty,c=RegExp("^"+l.call(u).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function h(d){if(!t(d)||e(d))return!1;var f=r(d)?c:a;return f.test(n(d))}return V0=h,V0}var H0,fP;function j9(){if(fP)return H0;fP=1;function r(e,t){return e==null?void 0:e[t]}return H0=r,H0}var W0,dP;function iu(){if(dP)return W0;dP=1;var r=Y9(),e=j9();function t(n,i){var a=e(n,i);return r(a)?a:void 0}return W0=t,W0}var q0,pP;function iA(){if(pP)return q0;pP=1;var r=iu(),e=Ga(),t=r(e,"Map");return q0=t,q0}var $0,gP;function Vv(){if(gP)return $0;gP=1;var r=iu(),e=r(Object,"create");return $0=e,$0}var X0,vP;function K9(){if(vP)return X0;vP=1;var r=Vv();function e(){this.__data__=r?r(null):{},this.size=0}return X0=e,X0}var Y0,mP;function Q9(){if(mP)return Y0;mP=1;function r(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}return Y0=r,Y0}var j0,yP;function Z9(){if(yP)return j0;yP=1;var r=Vv(),e="__lodash_hash_undefined__",t=Object.prototype,n=t.hasOwnProperty;function i(a){var s=this.__data__;if(r){var o=s[a];return o===e?void 0:o}return n.call(s,a)?s[a]:void 0}return j0=i,j0}var K0,_P;function J9(){if(_P)return K0;_P=1;var r=Vv(),e=Object.prototype,t=e.hasOwnProperty;function n(i){var a=this.__data__;return r?a[i]!==void 0:t.call(a,i)}return K0=n,K0}var Q0,xP;function e7(){if(xP)return Q0;xP=1;var r=Vv(),e="__lodash_hash_undefined__";function t(n,i){var a=this.__data__;return this.size+=this.has(n)?0:1,a[n]=r&&i===void 0?e:i,this}return Q0=t,Q0}var Z0,bP;function t7(){if(bP)return Z0;bP=1;var r=K9(),e=Q9(),t=Z9(),n=J9(),i=e7();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=r,a.prototype.delete=e,a.prototype.get=t,a.prototype.has=n,a.prototype.set=i,Z0=a,Z0}var J0,EP;function n7(){if(EP)return J0;EP=1;var r=t7(),e=zv(),t=iA();function n(){this.size=0,this.__data__={hash:new r,map:new(t||e),string:new r}}return J0=n,J0}var e_,TP;function r7(){if(TP)return e_;TP=1;function r(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}return e_=r,e_}var t_,wP;function Hv(){if(wP)return t_;wP=1;var r=r7();function e(t,n){var i=t.__data__;return r(n)?i[typeof n=="string"?"string":"hash"]:i.map}return t_=e,t_}var n_,SP;function i7(){if(SP)return n_;SP=1;var r=Hv();function e(t){var n=r(this,t).delete(t);return this.size-=n?1:0,n}return n_=e,n_}var r_,AP;function a7(){if(AP)return r_;AP=1;var r=Hv();function e(t){return r(this,t).get(t)}return r_=e,r_}var i_,MP;function s7(){if(MP)return i_;MP=1;var r=Hv();function e(t){return r(this,t).has(t)}return i_=e,i_}var a_,CP;function o7(){if(CP)return a_;CP=1;var r=Hv();function e(t,n){var i=r(this,t),a=i.size;return i.set(t,n),this.size+=i.size==a?0:1,this}return a_=e,a_}var s_,RP;function aA(){if(RP)return s_;RP=1;var r=n7(),e=i7(),t=a7(),n=s7(),i=o7();function a(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var u=s[o];this.set(u[0],u[1])}}return a.prototype.clear=r,a.prototype.delete=e,a.prototype.get=t,a.prototype.has=n,a.prototype.set=i,s_=a,s_}var o_,NP;function l7(){if(NP)return o_;NP=1;var r=zv(),e=iA(),t=aA(),n=200;function i(a,s){var o=this.__data__;if(o instanceof r){var l=o.__data__;if(!e||l.length<n-1)return l.push([a,s]),this.size=++o.size,this;o=this.__data__=new t(l)}return o.set(a,s),this.size=o.size,this}return o_=i,o_}var l_,PP;function Wv(){if(PP)return l_;PP=1;var r=zv(),e=G9(),t=z9(),n=V9(),i=H9(),a=l7();function s(o){var l=this.__data__=new r(o);this.size=l.size}return s.prototype.clear=e,s.prototype.delete=t,s.prototype.get=n,s.prototype.has=i,s.prototype.set=a,l_=s,l_}var u_,DP;function sA(){if(DP)return u_;DP=1;function r(e,t){for(var n=-1,i=e==null?0:e.length;++n<i&&t(e[n],n,e)!==!1;);return e}return u_=r,u_}var c_,LP;function Z3(){if(LP)return c_;LP=1;var r=iu(),e=function(){try{var t=r(Object,"defineProperty");return t({},"",{}),t}catch{}}();return c_=e,c_}var h_,IP;function qv(){if(IP)return h_;IP=1;var r=Z3();function e(t,n,i){n=="__proto__"&&r?r(t,n,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[n]=i}return h_=e,h_}var f_,OP;function $v(){if(OP)return f_;OP=1;var r=qv(),e=nh(),t=Object.prototype,n=t.hasOwnProperty;function i(a,s,o){var l=a[s];(!(n.call(a,s)&&e(l,o))||o===void 0&&!(s in a))&&r(a,s,o)}return f_=i,f_}var d_,FP;function Sd(){if(FP)return d_;FP=1;var r=$v(),e=qv();function t(n,i,a,s){var o=!a;a||(a={});for(var l=-1,u=i.length;++l<u;){var c=i[l],h=s?s(a[c],n[c],c,a,n):void 0;h===void 0&&(h=n[c]),o?e(a,c,h):r(a,c,h)}return a}return d_=t,d_}var p_,BP;function u7(){if(BP)return p_;BP=1;function r(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}return p_=r,p_}var g_,UP;function fs(){if(UP)return g_;UP=1;function r(e){return e!=null&&typeof e=="object"}return g_=r,g_}var v_,kP;function c7(){if(kP)return v_;kP=1;var r=ru(),e=fs(),t="[object Arguments]";function n(i){return e(i)&&r(i)==t}return v_=n,v_}var m_,GP;function Ad(){if(GP)return m_;GP=1;var r=c7(),e=fs(),t=Object.prototype,n=t.hasOwnProperty,i=t.propertyIsEnumerable,a=r(function(){return arguments}())?r:function(s){return e(s)&&n.call(s,"callee")&&!i.call(s,"callee")};return m_=a,m_}var y_,zP;function Kn(){if(zP)return y_;zP=1;var r=Array.isArray;return y_=r,y_}var op={exports:{}},__,VP;function h7(){if(VP)return __;VP=1;function r(){return!1}return __=r,__}var HP;function ih(){return HP||(HP=1,function(r,e){var t=Ga(),n=h7(),i=e&&!e.nodeType&&e,a=i&&!0&&r&&!r.nodeType&&r,s=a&&a.exports===i,o=s?t.Buffer:void 0,l=o?o.isBuffer:void 0,u=l||n;r.exports=u}(op,op.exports)),op.exports}var x_,WP;function Xv(){if(WP)return x_;WP=1;var r=9007199254740991,e=/^(?:0|[1-9]\d*)$/;function t(n,i){var a=typeof n;return i=i==null?r:i,!!i&&(a=="number"||a!="symbol"&&e.test(n))&&n>-1&&n%1==0&&n<i}return x_=t,x_}var b_,qP;function oA(){if(qP)return b_;qP=1;var r=9007199254740991;function e(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=r}return b_=e,b_}var E_,$P;function f7(){if($P)return E_;$P=1;var r=ru(),e=oA(),t=fs(),n="[object Arguments]",i="[object Array]",a="[object Boolean]",s="[object Date]",o="[object Error]",l="[object Function]",u="[object Map]",c="[object Number]",h="[object Object]",d="[object RegExp]",f="[object Set]",p="[object String]",m="[object WeakMap]",v="[object ArrayBuffer]",g="[object DataView]",y="[object Float32Array]",_="[object Float64Array]",x="[object Int8Array]",E="[object Int16Array]",T="[object Int32Array]",b="[object Uint8Array]",w="[object Uint8ClampedArray]",A="[object Uint16Array]",S="[object Uint32Array]",C={};C[y]=C[_]=C[x]=C[E]=C[T]=C[b]=C[w]=C[A]=C[S]=!0,C[n]=C[i]=C[v]=C[a]=C[g]=C[s]=C[o]=C[l]=C[u]=C[c]=C[h]=C[d]=C[f]=C[p]=C[m]=!1;function R(P){return t(P)&&e(P.length)&&!!C[r(P)]}return E_=R,E_}var T_,XP;function Yv(){if(XP)return T_;XP=1;function r(e){return function(t){return e(t)}}return T_=r,T_}var lp={exports:{}},YP;function lA(){return YP||(YP=1,function(r,e){var t=K3(),n=e&&!e.nodeType&&e,i=n&&!0&&r&&!r.nodeType&&r,a=i&&i.exports===n,s=a&&t.process,o=function(){try{var l=i&&i.require&&i.require("util").types;return l||s&&s.binding&&s.binding("util")}catch{}}();r.exports=o}(lp,lp.exports)),lp.exports}var w_,jP;function Md(){if(jP)return w_;jP=1;var r=f7(),e=Yv(),t=lA(),n=t&&t.isTypedArray,i=n?e(n):r;return w_=i,w_}var S_,KP;function J3(){if(KP)return S_;KP=1;var r=u7(),e=Ad(),t=Kn(),n=ih(),i=Xv(),a=Md(),s=Object.prototype,o=s.hasOwnProperty;function l(u,c){var h=t(u),d=!h&&e(u),f=!h&&!d&&n(u),p=!h&&!d&&!f&&a(u),m=h||d||f||p,v=m?r(u.length,String):[],g=v.length;for(var y in u)(c||o.call(u,y))&&!(m&&(y=="length"||f&&(y=="offset"||y=="parent")||p&&(y=="buffer"||y=="byteLength"||y=="byteOffset")||i(y,g)))&&v.push(y);return v}return S_=l,S_}var A_,QP;function jv(){if(QP)return A_;QP=1;var r=Object.prototype;function e(t){var n=t&&t.constructor,i=typeof n=="function"&&n.prototype||r;return t===i}return A_=e,A_}var M_,ZP;function eG(){if(ZP)return M_;ZP=1;function r(e,t){return function(n){return e(t(n))}}return M_=r,M_}var C_,JP;function d7(){if(JP)return C_;JP=1;var r=eG(),e=r(Object.keys,Object);return C_=e,C_}var R_,eD;function uA(){if(eD)return R_;eD=1;var r=jv(),e=d7(),t=Object.prototype,n=t.hasOwnProperty;function i(a){if(!r(a))return e(a);var s=[];for(var o in Object(a))n.call(a,o)&&o!="constructor"&&s.push(o);return s}return R_=i,R_}var N_,tD;function Js(){if(tD)return N_;tD=1;var r=wd(),e=oA();function t(n){return n!=null&&e(n.length)&&!r(n)}return N_=t,N_}var P_,nD;function Jo(){if(nD)return P_;nD=1;var r=J3(),e=uA(),t=Js();function n(i){return t(i)?r(i):e(i)}return P_=n,P_}var D_,rD;function p7(){if(rD)return D_;rD=1;var r=Sd(),e=Jo();function t(n,i){return n&&r(i,e(i),n)}return D_=t,D_}var L_,iD;function g7(){if(iD)return L_;iD=1;function r(e){var t=[];if(e!=null)for(var n in Object(e))t.push(n);return t}return L_=r,L_}var I_,aD;function v7(){if(aD)return I_;aD=1;var r=fa(),e=jv(),t=g7(),n=Object.prototype,i=n.hasOwnProperty;function a(s){if(!r(s))return t(s);var o=e(s),l=[];for(var u in s)u=="constructor"&&(o||!i.call(s,u))||l.push(u);return l}return I_=a,I_}var O_,sD;function au(){if(sD)return O_;sD=1;var r=J3(),e=v7(),t=Js();function n(i){return t(i)?r(i,!0):e(i)}return O_=n,O_}var F_,oD;function m7(){if(oD)return F_;oD=1;var r=Sd(),e=au();function t(n,i){return n&&r(i,e(i),n)}return F_=t,F_}var up={exports:{}},lD;function tG(){return lD||(lD=1,function(r,e){var t=Ga(),n=e&&!e.nodeType&&e,i=n&&!0&&r&&!r.nodeType&&r,a=i&&i.exports===n,s=a?t.Buffer:void 0,o=s?s.allocUnsafe:void 0;function l(u,c){if(c)return u.slice();var h=u.length,d=o?o(h):new u.constructor(h);return u.copy(d),d}r.exports=l}(up,up.exports)),up.exports}var B_,uD;function nG(){if(uD)return B_;uD=1;function r(e,t){var n=-1,i=e.length;for(t||(t=Array(i));++n<i;)t[n]=e[n];return t}return B_=r,B_}var U_,cD;function rG(){if(cD)return U_;cD=1;function r(e,t){for(var n=-1,i=e==null?0:e.length,a=0,s=[];++n<i;){var o=e[n];t(o,n,e)&&(s[a++]=o)}return s}return U_=r,U_}var k_,hD;function iG(){if(hD)return k_;hD=1;function r(){return[]}return k_=r,k_}var G_,fD;function cA(){if(fD)return G_;fD=1;var r=rG(),e=iG(),t=Object.prototype,n=t.propertyIsEnumerable,i=Object.getOwnPropertySymbols,a=i?function(s){return s==null?[]:(s=Object(s),r(i(s),function(o){return n.call(s,o)}))}:e;return G_=a,G_}var z_,dD;function y7(){if(dD)return z_;dD=1;var r=Sd(),e=cA();function t(n,i){return r(n,e(n),i)}return z_=t,z_}var V_,pD;function hA(){if(pD)return V_;pD=1;function r(e,t){for(var n=-1,i=t.length,a=e.length;++n<i;)e[a+n]=t[n];return e}return V_=r,V_}var H_,gD;function Kv(){if(gD)return H_;gD=1;var r=eG(),e=r(Object.getPrototypeOf,Object);return H_=e,H_}var W_,vD;function aG(){if(vD)return W_;vD=1;var r=hA(),e=Kv(),t=cA(),n=iG(),i=Object.getOwnPropertySymbols,a=i?function(s){for(var o=[];s;)r(o,t(s)),s=e(s);return o}:n;return W_=a,W_}var q_,mD;function _7(){if(mD)return q_;mD=1;var r=Sd(),e=aG();function t(n,i){return r(n,e(n),i)}return q_=t,q_}var $_,yD;function sG(){if(yD)return $_;yD=1;var r=hA(),e=Kn();function t(n,i,a){var s=i(n);return e(n)?s:r(s,a(n))}return $_=t,$_}var X_,_D;function oG(){if(_D)return X_;_D=1;var r=sG(),e=cA(),t=Jo();function n(i){return r(i,t,e)}return X_=n,X_}var Y_,xD;function x7(){if(xD)return Y_;xD=1;var r=sG(),e=aG(),t=au();function n(i){return r(i,t,e)}return Y_=n,Y_}var j_,bD;function b7(){if(bD)return j_;bD=1;var r=iu(),e=Ga(),t=r(e,"DataView");return j_=t,j_}var K_,ED;function E7(){if(ED)return K_;ED=1;var r=iu(),e=Ga(),t=r(e,"Promise");return K_=t,K_}var Q_,TD;function lG(){if(TD)return Q_;TD=1;var r=iu(),e=Ga(),t=r(e,"Set");return Q_=t,Q_}var Z_,wD;function T7(){if(wD)return Z_;wD=1;var r=iu(),e=Ga(),t=r(e,"WeakMap");return Z_=t,Z_}var J_,SD;function ah(){if(SD)return J_;SD=1;var r=b7(),e=iA(),t=E7(),n=lG(),i=T7(),a=ru(),s=Q3(),o="[object Map]",l="[object Object]",u="[object Promise]",c="[object Set]",h="[object WeakMap]",d="[object DataView]",f=s(r),p=s(e),m=s(t),v=s(n),g=s(i),y=a;return(r&&y(new r(new ArrayBuffer(1)))!=d||e&&y(new e)!=o||t&&y(t.resolve())!=u||n&&y(new n)!=c||i&&y(new i)!=h)&&(y=function(_){var x=a(_),E=x==l?_.constructor:void 0,T=E?s(E):"";if(T)switch(T){case f:return d;case p:return o;case m:return u;case v:return c;case g:return h}return x}),J_=y,J_}var ex,AD;function w7(){if(AD)return ex;AD=1;var r=Object.prototype,e=r.hasOwnProperty;function t(n){var i=n.length,a=new n.constructor(i);return i&&typeof n[0]=="string"&&e.call(n,"index")&&(a.index=n.index,a.input=n.input),a}return ex=t,ex}var tx,MD;function uG(){if(MD)return tx;MD=1;var r=Ga(),e=r.Uint8Array;return tx=e,tx}var nx,CD;function fA(){if(CD)return nx;CD=1;var r=uG();function e(t){var n=new t.constructor(t.byteLength);return new r(n).set(new r(t)),n}return nx=e,nx}var rx,RD;function S7(){if(RD)return rx;RD=1;var r=fA();function e(t,n){var i=n?r(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}return rx=e,rx}var ix,ND;function A7(){if(ND)return ix;ND=1;var r=/\w*$/;function e(t){var n=new t.constructor(t.source,r.exec(t));return n.lastIndex=t.lastIndex,n}return ix=e,ix}var ax,PD;function M7(){if(PD)return ax;PD=1;var r=rh(),e=r?r.prototype:void 0,t=e?e.valueOf:void 0;function n(i){return t?Object(t.call(i)):{}}return ax=n,ax}var sx,DD;function cG(){if(DD)return sx;DD=1;var r=fA();function e(t,n){var i=n?r(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}return sx=e,sx}var ox,LD;function C7(){if(LD)return ox;LD=1;var r=fA(),e=S7(),t=A7(),n=M7(),i=cG(),a="[object Boolean]",s="[object Date]",o="[object Map]",l="[object Number]",u="[object RegExp]",c="[object Set]",h="[object String]",d="[object Symbol]",f="[object ArrayBuffer]",p="[object DataView]",m="[object Float32Array]",v="[object Float64Array]",g="[object Int8Array]",y="[object Int16Array]",_="[object Int32Array]",x="[object Uint8Array]",E="[object Uint8ClampedArray]",T="[object Uint16Array]",b="[object Uint32Array]";function w(A,S,C){var R=A.constructor;switch(S){case f:return r(A);case a:case s:return new R(+A);case p:return e(A,C);case m:case v:case g:case y:case _:case x:case E:case T:case b:return i(A,C);case o:return new R;case l:case h:return new R(A);case u:return t(A);case c:return new R;case d:return n(A)}}return ox=w,ox}var lx,ID;function hG(){if(ID)return lx;ID=1;var r=fa(),e=Object.create,t=function(){function n(){}return function(i){if(!r(i))return{};if(e)return e(i);n.prototype=i;var a=new n;return n.prototype=void 0,a}}();return lx=t,lx}var ux,OD;function fG(){if(OD)return ux;OD=1;var r=hG(),e=Kv(),t=jv();function n(i){return typeof i.constructor=="function"&&!t(i)?r(e(i)):{}}return ux=n,ux}var cx,FD;function R7(){if(FD)return cx;FD=1;var r=ah(),e=fs(),t="[object Map]";function n(i){return e(i)&&r(i)==t}return cx=n,cx}var hx,BD;function N7(){if(BD)return hx;BD=1;var r=R7(),e=Yv(),t=lA(),n=t&&t.isMap,i=n?e(n):r;return hx=i,hx}var fx,UD;function P7(){if(UD)return fx;UD=1;var r=ah(),e=fs(),t="[object Set]";function n(i){return e(i)&&r(i)==t}return fx=n,fx}var dx,kD;function D7(){if(kD)return dx;kD=1;var r=P7(),e=Yv(),t=lA(),n=t&&t.isSet,i=n?e(n):r;return dx=i,dx}var px,GD;function dG(){if(GD)return px;GD=1;var r=Wv(),e=sA(),t=$v(),n=p7(),i=m7(),a=tG(),s=nG(),o=y7(),l=_7(),u=oG(),c=x7(),h=ah(),d=w7(),f=C7(),p=fG(),m=Kn(),v=ih(),g=N7(),y=fa(),_=D7(),x=Jo(),E=au(),T=1,b=2,w=4,A="[object Arguments]",S="[object Array]",C="[object Boolean]",R="[object Date]",P="[object Error]",M="[object Function]",N="[object GeneratorFunction]",D="[object Map]",I="[object Number]",L="[object Object]",z="[object RegExp]",B="[object Set]",k="[object String]",U="[object Symbol]",G="[object WeakMap]",O="[object ArrayBuffer]",F="[object DataView]",V="[object Float32Array]",$="[object Float64Array]",Z="[object Int8Array]",Y="[object Int16Array]",X="[object Int32Array]",K="[object Uint8Array]",se="[object Uint8ClampedArray]",oe="[object Uint16Array]",W="[object Uint32Array]",Ne={};Ne[A]=Ne[S]=Ne[O]=Ne[F]=Ne[C]=Ne[R]=Ne[V]=Ne[$]=Ne[Z]=Ne[Y]=Ne[X]=Ne[D]=Ne[I]=Ne[L]=Ne[z]=Ne[B]=Ne[k]=Ne[U]=Ne[K]=Ne[se]=Ne[oe]=Ne[W]=!0,Ne[P]=Ne[M]=Ne[G]=!1;function Be(we,pe,Me,Ae,j,H){var te,me=pe&T,Ee=pe&b,le=pe&w;if(Me&&(te=j?Me(we,Ae,j,H):Me(we)),te!==void 0)return te;if(!y(we))return we;var q=m(we);if(q){if(te=d(we),!me)return s(we,te)}else{var ne=h(we),fe=ne==M||ne==N;if(v(we))return a(we,me);if(ne==L||ne==A||fe&&!j){if(te=Ee||fe?{}:p(we),!me)return Ee?l(we,i(te,we)):o(we,n(te,we))}else{if(!Ne[ne])return j?we:{};te=f(we,ne,me)}}H||(H=new r);var ce=H.get(we);if(ce)return ce;H.set(we,te),_(we)?we.forEach(function(ee){te.add(Be(ee,pe,Me,ee,we,H))}):g(we)&&we.forEach(function(ee,he){te.set(he,Be(ee,pe,Me,he,we,H))});var ae=le?Ee?c:u:Ee?E:x,ie=q?void 0:ae(we);return e(ie||we,function(ee,he){ie&&(he=ee,ee=we[he]),t(te,he,Be(ee,pe,Me,he,we,H))}),te}return px=Be,px}var gx,zD;function L7(){if(zD)return gx;zD=1;var r=dG(),e=4;function t(n){return r(n,e)}return gx=t,gx}var vx,VD;function dA(){if(VD)return vx;VD=1;function r(e){return function(){return e}}return vx=r,vx}var mx={exports:{}},yx,HD;function I7(){if(HD)return yx;HD=1;function r(e){return function(t,n,i){for(var a=-1,s=Object(t),o=i(t),l=o.length;l--;){var u=o[e?l:++a];if(n(s[u],u,s)===!1)break}return t}}return yx=r,yx}var _x,WD;function pA(){if(WD)return _x;WD=1;var r=I7(),e=r();return _x=e,_x}var xx,qD;function gA(){if(qD)return xx;qD=1;var r=pA(),e=Jo();function t(n,i){return n&&r(n,i,e)}return xx=t,xx}var bx,$D;function O7(){if($D)return bx;$D=1;var r=Js();function e(t,n){return function(i,a){if(i==null)return i;if(!r(i))return t(i,a);for(var s=i.length,o=n?s:-1,l=Object(i);(n?o--:++o<s)&&a(l[o],o,l)!==!1;);return i}}return bx=e,bx}var Ex,XD;function Qv(){if(XD)return Ex;XD=1;var r=gA(),e=O7(),t=e(r);return Ex=t,Ex}var Tx,YD;function su(){if(YD)return Tx;YD=1;function r(e){return e}return Tx=r,Tx}var wx,jD;function pG(){if(jD)return wx;jD=1;var r=su();function e(t){return typeof t=="function"?t:r}return wx=e,wx}var Sx,KD;function gG(){if(KD)return Sx;KD=1;var r=sA(),e=Qv(),t=pG(),n=Kn();function i(a,s){var o=n(a)?r:e;return o(a,t(s))}return Sx=i,Sx}var QD;function vG(){return QD||(QD=1,function(r){r.exports=gG()}(mx)),mx.exports}var Ax,ZD;function F7(){if(ZD)return Ax;ZD=1;var r=Qv();function e(t,n){var i=[];return r(t,function(a,s,o){n(a,s,o)&&i.push(a)}),i}return Ax=e,Ax}var Mx,JD;function B7(){if(JD)return Mx;JD=1;var r="__lodash_hash_undefined__";function e(t){return this.__data__.set(t,r),this}return Mx=e,Mx}var Cx,eL;function U7(){if(eL)return Cx;eL=1;function r(e){return this.__data__.has(e)}return Cx=r,Cx}var Rx,tL;function mG(){if(tL)return Rx;tL=1;var r=aA(),e=B7(),t=U7();function n(i){var a=-1,s=i==null?0:i.length;for(this.__data__=new r;++a<s;)this.add(i[a])}return n.prototype.add=n.prototype.push=e,n.prototype.has=t,Rx=n,Rx}var Nx,nL;function k7(){if(nL)return Nx;nL=1;function r(e,t){for(var n=-1,i=e==null?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}return Nx=r,Nx}var Px,rL;function yG(){if(rL)return Px;rL=1;function r(e,t){return e.has(t)}return Px=r,Px}var Dx,iL;function _G(){if(iL)return Dx;iL=1;var r=mG(),e=k7(),t=yG(),n=1,i=2;function a(s,o,l,u,c,h){var d=l&n,f=s.length,p=o.length;if(f!=p&&!(d&&p>f))return!1;var m=h.get(s),v=h.get(o);if(m&&v)return m==o&&v==s;var g=-1,y=!0,_=l&i?new r:void 0;for(h.set(s,o),h.set(o,s);++g<f;){var x=s[g],E=o[g];if(u)var T=d?u(E,x,g,o,s,h):u(x,E,g,s,o,h);if(T!==void 0){if(T)continue;y=!1;break}if(_){if(!e(o,function(b,w){if(!t(_,w)&&(x===b||c(x,b,l,u,h)))return _.push(w)})){y=!1;break}}else if(!(x===E||c(x,E,l,u,h))){y=!1;break}}return h.delete(s),h.delete(o),y}return Dx=a,Dx}var Lx,aL;function G7(){if(aL)return Lx;aL=1;function r(e){var t=-1,n=Array(e.size);return e.forEach(function(i,a){n[++t]=[a,i]}),n}return Lx=r,Lx}var Ix,sL;function vA(){if(sL)return Ix;sL=1;function r(e){var t=-1,n=Array(e.size);return e.forEach(function(i){n[++t]=i}),n}return Ix=r,Ix}var Ox,oL;function z7(){if(oL)return Ox;oL=1;var r=rh(),e=uG(),t=nh(),n=_G(),i=G7(),a=vA(),s=1,o=2,l="[object Boolean]",u="[object Date]",c="[object Error]",h="[object Map]",d="[object Number]",f="[object RegExp]",p="[object Set]",m="[object String]",v="[object Symbol]",g="[object ArrayBuffer]",y="[object DataView]",_=r?r.prototype:void 0,x=_?_.valueOf:void 0;function E(T,b,w,A,S,C,R){switch(w){case y:if(T.byteLength!=b.byteLength||T.byteOffset!=b.byteOffset)return!1;T=T.buffer,b=b.buffer;case g:return!(T.byteLength!=b.byteLength||!C(new e(T),new e(b)));case l:case u:case d:return t(+T,+b);case c:return T.name==b.name&&T.message==b.message;case f:case m:return T==b+"";case h:var P=i;case p:var M=A&s;if(P||(P=a),T.size!=b.size&&!M)return!1;var N=R.get(T);if(N)return N==b;A|=o,R.set(T,b);var D=n(P(T),P(b),A,S,C,R);return R.delete(T),D;case v:if(x)return x.call(T)==x.call(b)}return!1}return Ox=E,Ox}var Fx,lL;function V7(){if(lL)return Fx;lL=1;var r=oG(),e=1,t=Object.prototype,n=t.hasOwnProperty;function i(a,s,o,l,u,c){var h=o&e,d=r(a),f=d.length,p=r(s),m=p.length;if(f!=m&&!h)return!1;for(var v=f;v--;){var g=d[v];if(!(h?g in s:n.call(s,g)))return!1}var y=c.get(a),_=c.get(s);if(y&&_)return y==s&&_==a;var x=!0;c.set(a,s),c.set(s,a);for(var E=h;++v<f;){g=d[v];var T=a[g],b=s[g];if(l)var w=h?l(b,T,g,s,a,c):l(T,b,g,a,s,c);if(!(w===void 0?T===b||u(T,b,o,l,c):w)){x=!1;break}E||(E=g=="constructor")}if(x&&!E){var A=a.constructor,S=s.constructor;A!=S&&"constructor"in a&&"constructor"in s&&!(typeof A=="function"&&A instanceof A&&typeof S=="function"&&S instanceof S)&&(x=!1)}return c.delete(a),c.delete(s),x}return Fx=i,Fx}var Bx,uL;function H7(){if(uL)return Bx;uL=1;var r=Wv(),e=_G(),t=z7(),n=V7(),i=ah(),a=Kn(),s=ih(),o=Md(),l=1,u="[object Arguments]",c="[object Array]",h="[object Object]",d=Object.prototype,f=d.hasOwnProperty;function p(m,v,g,y,_,x){var E=a(m),T=a(v),b=E?c:i(m),w=T?c:i(v);b=b==u?h:b,w=w==u?h:w;var A=b==h,S=w==h,C=b==w;if(C&&s(m)){if(!s(v))return!1;E=!0,A=!1}if(C&&!A)return x||(x=new r),E||o(m)?e(m,v,g,y,_,x):t(m,v,b,g,y,_,x);if(!(g&l)){var R=A&&f.call(m,"__wrapped__"),P=S&&f.call(v,"__wrapped__");if(R||P){var M=R?m.value():m,N=P?v.value():v;return x||(x=new r),_(M,N,g,y,x)}}return C?(x||(x=new r),n(m,v,g,y,_,x)):!1}return Bx=p,Bx}var Ux,cL;function xG(){if(cL)return Ux;cL=1;var r=H7(),e=fs();function t(n,i,a,s,o){return n===i?!0:n==null||i==null||!e(n)&&!e(i)?n!==n&&i!==i:r(n,i,a,s,t,o)}return Ux=t,Ux}var kx,hL;function W7(){if(hL)return kx;hL=1;var r=Wv(),e=xG(),t=1,n=2;function i(a,s,o,l){var u=o.length,c=u,h=!l;if(a==null)return!c;for(a=Object(a);u--;){var d=o[u];if(h&&d[2]?d[1]!==a[d[0]]:!(d[0]in a))return!1}for(;++u<c;){d=o[u];var f=d[0],p=a[f],m=d[1];if(h&&d[2]){if(p===void 0&&!(f in a))return!1}else{var v=new r;if(l)var g=l(p,m,f,a,s,v);if(!(g===void 0?e(m,p,t|n,l,v):g))return!1}}return!0}return kx=i,kx}var Gx,fL;function bG(){if(fL)return Gx;fL=1;var r=fa();function e(t){return t===t&&!r(t)}return Gx=e,Gx}var zx,dL;function q7(){if(dL)return zx;dL=1;var r=bG(),e=Jo();function t(n){for(var i=e(n),a=i.length;a--;){var s=i[a],o=n[s];i[a]=[s,o,r(o)]}return i}return zx=t,zx}var Vx,pL;function EG(){if(pL)return Vx;pL=1;function r(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}return Vx=r,Vx}var Hx,gL;function $7(){if(gL)return Hx;gL=1;var r=W7(),e=q7(),t=EG();function n(i){var a=e(i);return a.length==1&&a[0][2]?t(a[0][0],a[0][1]):function(s){return s===i||r(s,i,a)}}return Hx=n,Hx}var Wx,vL;function sh(){if(vL)return Wx;vL=1;var r=ru(),e=fs(),t="[object Symbol]";function n(i){return typeof i=="symbol"||e(i)&&r(i)==t}return Wx=n,Wx}var qx,mL;function mA(){if(mL)return qx;mL=1;var r=Kn(),e=sh(),t=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/;function i(a,s){if(r(a))return!1;var o=typeof a;return o=="number"||o=="symbol"||o=="boolean"||a==null||e(a)?!0:n.test(a)||!t.test(a)||s!=null&&a in Object(s)}return qx=i,qx}var $x,yL;function X7(){if(yL)return $x;yL=1;var r=aA(),e="Expected a function";function t(n,i){if(typeof n!="function"||i!=null&&typeof i!="function")throw new TypeError(e);var a=function(){var s=arguments,o=i?i.apply(this,s):s[0],l=a.cache;if(l.has(o))return l.get(o);var u=n.apply(this,s);return a.cache=l.set(o,u)||l,u};return a.cache=new(t.Cache||r),a}return t.Cache=r,$x=t,$x}var Xx,_L;function Y7(){if(_L)return Xx;_L=1;var r=X7(),e=500;function t(n){var i=r(n,function(s){return a.size===e&&a.clear(),s}),a=i.cache;return i}return Xx=t,Xx}var Yx,xL;function j7(){if(xL)return Yx;xL=1;var r=Y7(),e=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,t=/\\(\\)?/g,n=r(function(i){var a=[];return i.charCodeAt(0)===46&&a.push(""),i.replace(e,function(s,o,l,u){a.push(l?u.replace(t,"$1"):o||s)}),a});return Yx=n,Yx}var jx,bL;function Zv(){if(bL)return jx;bL=1;function r(e,t){for(var n=-1,i=e==null?0:e.length,a=Array(i);++n<i;)a[n]=t(e[n],n,e);return a}return jx=r,jx}var Kx,EL;function K7(){if(EL)return Kx;EL=1;var r=rh(),e=Zv(),t=Kn(),n=sh(),i=1/0,a=r?r.prototype:void 0,s=a?a.toString:void 0;function o(l){if(typeof l=="string")return l;if(t(l))return e(l,o)+"";if(n(l))return s?s.call(l):"";var u=l+"";return u=="0"&&1/l==-i?"-0":u}return Kx=o,Kx}var Qx,TL;function TG(){if(TL)return Qx;TL=1;var r=K7();function e(t){return t==null?"":r(t)}return Qx=e,Qx}var Zx,wL;function Jv(){if(wL)return Zx;wL=1;var r=Kn(),e=mA(),t=j7(),n=TG();function i(a,s){return r(a)?a:e(a,s)?[a]:t(n(a))}return Zx=i,Zx}var Jx,SL;function Cd(){if(SL)return Jx;SL=1;var r=sh(),e=1/0;function t(n){if(typeof n=="string"||r(n))return n;var i=n+"";return i=="0"&&1/n==-e?"-0":i}return Jx=t,Jx}var eb,AL;function em(){if(AL)return eb;AL=1;var r=Jv(),e=Cd();function t(n,i){i=r(i,n);for(var a=0,s=i.length;n!=null&&a<s;)n=n[e(i[a++])];return a&&a==s?n:void 0}return eb=t,eb}var tb,ML;function Q7(){if(ML)return tb;ML=1;var r=em();function e(t,n,i){var a=t==null?void 0:r(t,n);return a===void 0?i:a}return tb=e,tb}var nb,CL;function Z7(){if(CL)return nb;CL=1;function r(e,t){return e!=null&&t in Object(e)}return nb=r,nb}var rb,RL;function wG(){if(RL)return rb;RL=1;var r=Jv(),e=Ad(),t=Kn(),n=Xv(),i=oA(),a=Cd();function s(o,l,u){l=r(l,o);for(var c=-1,h=l.length,d=!1;++c<h;){var f=a(l[c]);if(!(d=o!=null&&u(o,f)))break;o=o[f]}return d||++c!=h?d:(h=o==null?0:o.length,!!h&&i(h)&&n(f,h)&&(t(o)||e(o)))}return rb=s,rb}var ib,NL;function SG(){if(NL)return ib;NL=1;var r=Z7(),e=wG();function t(n,i){return n!=null&&e(n,i,r)}return ib=t,ib}var ab,PL;function J7(){if(PL)return ab;PL=1;var r=xG(),e=Q7(),t=SG(),n=mA(),i=bG(),a=EG(),s=Cd(),o=1,l=2;function u(c,h){return n(c)&&i(h)?a(s(c),h):function(d){var f=e(d,c);return f===void 0&&f===h?t(d,c):r(h,f,o|l)}}return ab=u,ab}var sb,DL;function AG(){if(DL)return sb;DL=1;function r(e){return function(t){return t==null?void 0:t[e]}}return sb=r,sb}var ob,LL;function ej(){if(LL)return ob;LL=1;var r=em();function e(t){return function(n){return r(n,t)}}return ob=e,ob}var lb,IL;function tj(){if(IL)return lb;IL=1;var r=AG(),e=ej(),t=mA(),n=Cd();function i(a){return t(a)?r(n(a)):e(a)}return lb=i,lb}var ub,OL;function eo(){if(OL)return ub;OL=1;var r=$7(),e=J7(),t=su(),n=Kn(),i=tj();function a(s){return typeof s=="function"?s:s==null?t:typeof s=="object"?n(s)?e(s[0],s[1]):r(s):i(s)}return ub=a,ub}var cb,FL;function MG(){if(FL)return cb;FL=1;var r=rG(),e=F7(),t=eo(),n=Kn();function i(a,s){var o=n(a)?r:e;return o(a,t(s,3))}return cb=i,cb}var hb,BL;function nj(){if(BL)return hb;BL=1;var r=Object.prototype,e=r.hasOwnProperty;function t(n,i){return n!=null&&e.call(n,i)}return hb=t,hb}var fb,UL;function CG(){if(UL)return fb;UL=1;var r=nj(),e=wG();function t(n,i){return n!=null&&e(n,i,r)}return fb=t,fb}var db,kL;function rj(){if(kL)return db;kL=1;var r=uA(),e=ah(),t=Ad(),n=Kn(),i=Js(),a=ih(),s=jv(),o=Md(),l="[object Map]",u="[object Set]",c=Object.prototype,h=c.hasOwnProperty;function d(f){if(f==null)return!0;if(i(f)&&(n(f)||typeof f=="string"||typeof f.splice=="function"||a(f)||o(f)||t(f)))return!f.length;var p=e(f);if(p==l||p==u)return!f.size;if(s(f))return!r(f).length;for(var m in f)if(h.call(f,m))return!1;return!0}return db=d,db}var pb,GL;function RG(){if(GL)return pb;GL=1;function r(e){return e===void 0}return pb=r,pb}var gb,zL;function NG(){if(zL)return gb;zL=1;var r=Qv(),e=Js();function t(n,i){var a=-1,s=e(n)?Array(n.length):[];return r(n,function(o,l,u){s[++a]=i(o,l,u)}),s}return gb=t,gb}var vb,VL;function PG(){if(VL)return vb;VL=1;var r=Zv(),e=eo(),t=NG(),n=Kn();function i(a,s){var o=n(a)?r:t;return o(a,e(s,3))}return vb=i,vb}var mb,HL;function ij(){if(HL)return mb;HL=1;function r(e,t,n,i){var a=-1,s=e==null?0:e.length;for(i&&s&&(n=e[++a]);++a<s;)n=t(n,e[a],a,e);return n}return mb=r,mb}var yb,WL;function aj(){if(WL)return yb;WL=1;function r(e,t,n,i,a){return a(e,function(s,o,l){n=i?(i=!1,s):t(n,s,o,l)}),n}return yb=r,yb}var _b,qL;function DG(){if(qL)return _b;qL=1;var r=ij(),e=Qv(),t=eo(),n=aj(),i=Kn();function a(s,o,l){var u=i(s)?r:n,c=arguments.length<3;return u(s,t(o,4),l,c,e)}return _b=a,_b}var xb,$L;function sj(){if($L)return xb;$L=1;var r=ru(),e=Kn(),t=fs(),n="[object String]";function i(a){return typeof a=="string"||!e(a)&&t(a)&&r(a)==n}return xb=i,xb}var bb,XL;function oj(){if(XL)return bb;XL=1;var r=AG(),e=r("length");return bb=e,bb}var Eb,YL;function lj(){if(YL)return Eb;YL=1;var r="\\ud800-\\udfff",e="\\u0300-\\u036f",t="\\ufe20-\\ufe2f",n="\\u20d0-\\u20ff",i=e+t+n,a="\\ufe0e\\ufe0f",s="\\u200d",o=RegExp("["+s+r+i+a+"]");function l(u){return o.test(u)}return Eb=l,Eb}var Tb,jL;function uj(){if(jL)return Tb;jL=1;var r="\\ud800-\\udfff",e="\\u0300-\\u036f",t="\\ufe20-\\ufe2f",n="\\u20d0-\\u20ff",i=e+t+n,a="\\ufe0e\\ufe0f",s="["+r+"]",o="["+i+"]",l="\\ud83c[\\udffb-\\udfff]",u="(?:"+o+"|"+l+")",c="[^"+r+"]",h="(?:\\ud83c[\\udde6-\\uddff]){2}",d="[\\ud800-\\udbff][\\udc00-\\udfff]",f="\\u200d",p=u+"?",m="["+a+"]?",v="(?:"+f+"(?:"+[c,h,d].join("|")+")"+m+p+")*",g=m+p+v,y="(?:"+[c+o+"?",o,h,d,s].join("|")+")",_=RegExp(l+"(?="+l+")|"+y+g,"g");function x(E){for(var T=_.lastIndex=0;_.test(E);)++T;return T}return Tb=x,Tb}var wb,KL;function cj(){if(KL)return wb;KL=1;var r=oj(),e=lj(),t=uj();function n(i){return e(i)?t(i):r(i)}return wb=n,wb}var Sb,QL;function hj(){if(QL)return Sb;QL=1;var r=uA(),e=ah(),t=Js(),n=sj(),i=cj(),a="[object Map]",s="[object Set]";function o(l){if(l==null)return 0;if(t(l))return n(l)?i(l):l.length;var u=e(l);return u==a||u==s?l.size:r(l).length}return Sb=o,Sb}var Ab,ZL;function fj(){if(ZL)return Ab;ZL=1;var r=sA(),e=hG(),t=gA(),n=eo(),i=Kv(),a=Kn(),s=ih(),o=wd(),l=fa(),u=Md();function c(h,d,f){var p=a(h),m=p||s(h)||u(h);if(d=n(d,4),f==null){var v=h&&h.constructor;m?f=p?new v:[]:l(h)?f=o(v)?e(i(h)):{}:f={}}return(m?r:t)(h,function(g,y,_){return d(f,g,y,_)}),f}return Ab=c,Ab}var Mb,JL;function dj(){if(JL)return Mb;JL=1;var r=rh(),e=Ad(),t=Kn(),n=r?r.isConcatSpreadable:void 0;function i(a){return t(a)||e(a)||!!(n&&a&&a[n])}return Mb=i,Mb}var Cb,eI;function yA(){if(eI)return Cb;eI=1;var r=hA(),e=dj();function t(n,i,a,s,o){var l=-1,u=n.length;for(a||(a=e),o||(o=[]);++l<u;){var c=n[l];i>0&&a(c)?i>1?t(c,i-1,a,s,o):r(o,c):s||(o[o.length]=c)}return o}return Cb=t,Cb}var Rb,tI;function pj(){if(tI)return Rb;tI=1;function r(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}return Rb=r,Rb}var Nb,nI;function LG(){if(nI)return Nb;nI=1;var r=pj(),e=Math.max;function t(n,i,a){return i=e(i===void 0?n.length-1:i,0),function(){for(var s=arguments,o=-1,l=e(s.length-i,0),u=Array(l);++o<l;)u[o]=s[i+o];o=-1;for(var c=Array(i+1);++o<i;)c[o]=s[o];return c[i]=a(u),r(n,this,c)}}return Nb=t,Nb}var Pb,rI;function gj(){if(rI)return Pb;rI=1;var r=dA(),e=Z3(),t=su(),n=e?function(i,a){return e(i,"toString",{configurable:!0,enumerable:!1,value:r(a),writable:!0})}:t;return Pb=n,Pb}var Db,iI;function vj(){if(iI)return Db;iI=1;var r=800,e=16,t=Date.now;function n(i){var a=0,s=0;return function(){var o=t(),l=e-(o-s);if(s=o,l>0){if(++a>=r)return arguments[0]}else a=0;return i.apply(void 0,arguments)}}return Db=n,Db}var Lb,aI;function IG(){if(aI)return Lb;aI=1;var r=gj(),e=vj(),t=e(r);return Lb=t,Lb}var Ib,sI;function tm(){if(sI)return Ib;sI=1;var r=su(),e=LG(),t=IG();function n(i,a){return t(e(i,a,r),i+"")}return Ib=n,Ib}var Ob,oI;function OG(){if(oI)return Ob;oI=1;function r(e,t,n,i){for(var a=e.length,s=n+(i?1:-1);i?s--:++s<a;)if(t(e[s],s,e))return s;return-1}return Ob=r,Ob}var Fb,lI;function mj(){if(lI)return Fb;lI=1;function r(e){return e!==e}return Fb=r,Fb}var Bb,uI;function yj(){if(uI)return Bb;uI=1;function r(e,t,n){for(var i=n-1,a=e.length;++i<a;)if(e[i]===t)return i;return-1}return Bb=r,Bb}var Ub,cI;function _j(){if(cI)return Ub;cI=1;var r=OG(),e=mj(),t=yj();function n(i,a,s){return a===a?t(i,a,s):r(i,e,s)}return Ub=n,Ub}var kb,hI;function xj(){if(hI)return kb;hI=1;var r=_j();function e(t,n){var i=t==null?0:t.length;return!!i&&r(t,n,0)>-1}return kb=e,kb}var Gb,fI;function bj(){if(fI)return Gb;fI=1;function r(e,t,n){for(var i=-1,a=e==null?0:e.length;++i<a;)if(n(t,e[i]))return!0;return!1}return Gb=r,Gb}var zb,dI;function Ej(){if(dI)return zb;dI=1;function r(){}return zb=r,zb}var Vb,pI;function Tj(){if(pI)return Vb;pI=1;var r=lG(),e=Ej(),t=vA(),n=1/0,i=r&&1/t(new r([,-0]))[1]==n?function(a){return new r(a)}:e;return Vb=i,Vb}var Hb,gI;function wj(){if(gI)return Hb;gI=1;var r=mG(),e=xj(),t=bj(),n=yG(),i=Tj(),a=vA(),s=200;function o(l,u,c){var h=-1,d=e,f=l.length,p=!0,m=[],v=m;if(c)p=!1,d=t;else if(f>=s){var g=u?null:i(l);if(g)return a(g);p=!1,d=n,v=new r}else v=u?[]:m;e:for(;++h<f;){var y=l[h],_=u?u(y):y;if(y=c||y!==0?y:0,p&&_===_){for(var x=v.length;x--;)if(v[x]===_)continue e;u&&v.push(_),m.push(y)}else d(v,_,c)||(v!==m&&v.push(_),m.push(y))}return m}return Hb=o,Hb}var Wb,vI;function FG(){if(vI)return Wb;vI=1;var r=Js(),e=fs();function t(n){return e(n)&&r(n)}return Wb=t,Wb}var qb,mI;function Sj(){if(mI)return qb;mI=1;var r=yA(),e=tm(),t=wj(),n=FG(),i=e(function(a){return t(r(a,1,n,!0))});return qb=i,qb}var $b,yI;function Aj(){if(yI)return $b;yI=1;var r=Zv();function e(t,n){return r(n,function(i){return t[i]})}return $b=e,$b}var Xb,_I;function BG(){if(_I)return Xb;_I=1;var r=Aj(),e=Jo();function t(n){return n==null?[]:r(n,e(n))}return Xb=t,Xb}var Yb,xI;function da(){if(xI)return Yb;xI=1;var r;if(typeof RS=="function")try{r={clone:L7(),constant:dA(),each:vG(),filter:MG(),has:CG(),isArray:Kn(),isEmpty:rj(),isFunction:wd(),isUndefined:RG(),keys:Jo(),map:PG(),reduce:DG(),size:hj(),transform:fj(),union:Sj(),values:BG()}}catch{}return r||(r=window._),Yb=r,Yb}var jb,bI;function _A(){if(bI)return jb;bI=1;var r=da();jb=i;var e="\0",t="\0",n="";function i(c){this._isDirected=r.has(c,"directed")?c.directed:!0,this._isMultigraph=r.has(c,"multigraph")?c.multigraph:!1,this._isCompound=r.has(c,"compound")?c.compound:!1,this._label=void 0,this._defaultNodeLabelFn=r.constant(void 0),this._defaultEdgeLabelFn=r.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[t]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}i.prototype._nodeCount=0,i.prototype._edgeCount=0,i.prototype.isDirected=function(){return this._isDirected},i.prototype.isMultigraph=function(){return this._isMultigraph},i.prototype.isCompound=function(){return this._isCompound},i.prototype.setGraph=function(c){return this._label=c,this},i.prototype.graph=function(){return this._label},i.prototype.setDefaultNodeLabel=function(c){return r.isFunction(c)||(c=r.constant(c)),this._defaultNodeLabelFn=c,this},i.prototype.nodeCount=function(){return this._nodeCount},i.prototype.nodes=function(){return r.keys(this._nodes)},i.prototype.sources=function(){var c=this;return r.filter(this.nodes(),function(h){return r.isEmpty(c._in[h])})},i.prototype.sinks=function(){var c=this;return r.filter(this.nodes(),function(h){return r.isEmpty(c._out[h])})},i.prototype.setNodes=function(c,h){var d=arguments,f=this;return r.each(c,function(p){d.length>1?f.setNode(p,h):f.setNode(p)}),this},i.prototype.setNode=function(c,h){return r.has(this._nodes,c)?(arguments.length>1&&(this._nodes[c]=h),this):(this._nodes[c]=arguments.length>1?h:this._defaultNodeLabelFn(c),this._isCompound&&(this._parent[c]=t,this._children[c]={},this._children[t][c]=!0),this._in[c]={},this._preds[c]={},this._out[c]={},this._sucs[c]={},++this._nodeCount,this)},i.prototype.node=function(c){return this._nodes[c]},i.prototype.hasNode=function(c){return r.has(this._nodes,c)},i.prototype.removeNode=function(c){var h=this;if(r.has(this._nodes,c)){var d=function(f){h.removeEdge(h._edgeObjs[f])};delete this._nodes[c],this._isCompound&&(this._removeFromParentsChildList(c),delete this._parent[c],r.each(this.children(c),function(f){h.setParent(f)}),delete this._children[c]),r.each(r.keys(this._in[c]),d),delete this._in[c],delete this._preds[c],r.each(r.keys(this._out[c]),d),delete this._out[c],delete this._sucs[c],--this._nodeCount}return this},i.prototype.setParent=function(c,h){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(r.isUndefined(h))h=t;else{h+="";for(var d=h;!r.isUndefined(d);d=this.parent(d))if(d===c)throw new Error("Setting "+h+" as parent of "+c+" would create a cycle");this.setNode(h)}return this.setNode(c),this._removeFromParentsChildList(c),this._parent[c]=h,this._children[h][c]=!0,this},i.prototype._removeFromParentsChildList=function(c){delete this._children[this._parent[c]][c]},i.prototype.parent=function(c){if(this._isCompound){var h=this._parent[c];if(h!==t)return h}},i.prototype.children=function(c){if(r.isUndefined(c)&&(c=t),this._isCompound){var h=this._children[c];if(h)return r.keys(h)}else{if(c===t)return this.nodes();if(this.hasNode(c))return[]}},i.prototype.predecessors=function(c){var h=this._preds[c];if(h)return r.keys(h)},i.prototype.successors=function(c){var h=this._sucs[c];if(h)return r.keys(h)},i.prototype.neighbors=function(c){var h=this.predecessors(c);if(h)return r.union(h,this.successors(c))},i.prototype.isLeaf=function(c){var h;return this.isDirected()?h=this.successors(c):h=this.neighbors(c),h.length===0},i.prototype.filterNodes=function(c){var h=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});h.setGraph(this.graph());var d=this;r.each(this._nodes,function(m,v){c(v)&&h.setNode(v,m)}),r.each(this._edgeObjs,function(m){h.hasNode(m.v)&&h.hasNode(m.w)&&h.setEdge(m,d.edge(m))});var f={};function p(m){var v=d.parent(m);return v===void 0||h.hasNode(v)?(f[m]=v,v):v in f?f[v]:p(v)}return this._isCompound&&r.each(h.nodes(),function(m){h.setParent(m,p(m))}),h},i.prototype.setDefaultEdgeLabel=function(c){return r.isFunction(c)||(c=r.constant(c)),this._defaultEdgeLabelFn=c,this},i.prototype.edgeCount=function(){return this._edgeCount},i.prototype.edges=function(){return r.values(this._edgeObjs)},i.prototype.setPath=function(c,h){var d=this,f=arguments;return r.reduce(c,function(p,m){return f.length>1?d.setEdge(p,m,h):d.setEdge(p,m),m}),this},i.prototype.setEdge=function(){var c,h,d,f,p=!1,m=arguments[0];typeof m=="object"&&m!==null&&"v"in m?(c=m.v,h=m.w,d=m.name,arguments.length===2&&(f=arguments[1],p=!0)):(c=m,h=arguments[1],d=arguments[3],arguments.length>2&&(f=arguments[2],p=!0)),c=""+c,h=""+h,r.isUndefined(d)||(d=""+d);var v=o(this._isDirected,c,h,d);if(r.has(this._edgeLabels,v))return p&&(this._edgeLabels[v]=f),this;if(!r.isUndefined(d)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(c),this.setNode(h),this._edgeLabels[v]=p?f:this._defaultEdgeLabelFn(c,h,d);var g=l(this._isDirected,c,h,d);return c=g.v,h=g.w,Object.freeze(g),this._edgeObjs[v]=g,a(this._preds[h],c),a(this._sucs[c],h),this._in[h][v]=g,this._out[c][v]=g,this._edgeCount++,this},i.prototype.edge=function(c,h,d){var f=arguments.length===1?u(this._isDirected,arguments[0]):o(this._isDirected,c,h,d);return this._edgeLabels[f]},i.prototype.hasEdge=function(c,h,d){var f=arguments.length===1?u(this._isDirected,arguments[0]):o(this._isDirected,c,h,d);return r.has(this._edgeLabels,f)},i.prototype.removeEdge=function(c,h,d){var f=arguments.length===1?u(this._isDirected,arguments[0]):o(this._isDirected,c,h,d),p=this._edgeObjs[f];return p&&(c=p.v,h=p.w,delete this._edgeLabels[f],delete this._edgeObjs[f],s(this._preds[h],c),s(this._sucs[c],h),delete this._in[h][f],delete this._out[c][f],this._edgeCount--),this},i.prototype.inEdges=function(c,h){var d=this._in[c];if(d){var f=r.values(d);return h?r.filter(f,function(p){return p.v===h}):f}},i.prototype.outEdges=function(c,h){var d=this._out[c];if(d){var f=r.values(d);return h?r.filter(f,function(p){return p.w===h}):f}},i.prototype.nodeEdges=function(c,h){var d=this.inEdges(c,h);if(d)return d.concat(this.outEdges(c,h))};function a(c,h){c[h]?c[h]++:c[h]=1}function s(c,h){--c[h]||delete c[h]}function o(c,h,d,f){var p=""+h,m=""+d;if(!c&&p>m){var v=p;p=m,m=v}return p+n+m+n+(r.isUndefined(f)?e:f)}function l(c,h,d,f){var p=""+h,m=""+d;if(!c&&p>m){var v=p;p=m,m=v}var g={v:p,w:m};return f&&(g.name=f),g}function u(c,h){return o(c,h.v,h.w,h.name)}return jb}var Kb,EI;function Mj(){return EI||(EI=1,Kb="2.1.8"),Kb}var Qb,TI;function Cj(){return TI||(TI=1,Qb={Graph:_A(),version:Mj()}),Qb}var Zb,wI;function Rj(){if(wI)return Zb;wI=1;var r=da(),e=_A();Zb={write:t,read:a};function t(s){var o={options:{directed:s.isDirected(),multigraph:s.isMultigraph(),compound:s.isCompound()},nodes:n(s),edges:i(s)};return r.isUndefined(s.graph())||(o.value=r.clone(s.graph())),o}function n(s){return r.map(s.nodes(),function(o){var l=s.node(o),u=s.parent(o),c={v:o};return r.isUndefined(l)||(c.value=l),r.isUndefined(u)||(c.parent=u),c})}function i(s){return r.map(s.edges(),function(o){var l=s.edge(o),u={v:o.v,w:o.w};return r.isUndefined(o.name)||(u.name=o.name),r.isUndefined(l)||(u.value=l),u})}function a(s){var o=new e(s.options).setGraph(s.value);return r.each(s.nodes,function(l){o.setNode(l.v,l.value),l.parent&&o.setParent(l.v,l.parent)}),r.each(s.edges,function(l){o.setEdge({v:l.v,w:l.w,name:l.name},l.value)}),o}return Zb}var Jb,SI;function Nj(){if(SI)return Jb;SI=1;var r=da();Jb=e;function e(t){var n={},i=[],a;function s(o){r.has(n,o)||(n[o]=!0,a.push(o),r.each(t.successors(o),s),r.each(t.predecessors(o),s))}return r.each(t.nodes(),function(o){a=[],s(o),a.length&&i.push(a)}),i}return Jb}var eE,AI;function UG(){if(AI)return eE;AI=1;var r=da();eE=e;function e(){this._arr=[],this._keyIndices={}}return e.prototype.size=function(){return this._arr.length},e.prototype.keys=function(){return this._arr.map(function(t){return t.key})},e.prototype.has=function(t){return r.has(this._keyIndices,t)},e.prototype.priority=function(t){var n=this._keyIndices[t];if(n!==void 0)return this._arr[n].priority},e.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key},e.prototype.add=function(t,n){var i=this._keyIndices;if(t=String(t),!r.has(i,t)){var a=this._arr,s=a.length;return i[t]=s,a.push({key:t,priority:n}),this._decrease(s),!0}return!1},e.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var t=this._arr.pop();return delete this._keyIndices[t.key],this._heapify(0),t.key},e.prototype.decrease=function(t,n){var i=this._keyIndices[t];if(n>this._arr[i].priority)throw new Error("New priority is greater than current priority. Key: "+t+" Old: "+this._arr[i].priority+" New: "+n);this._arr[i].priority=n,this._decrease(i)},e.prototype._heapify=function(t){var n=this._arr,i=2*t,a=i+1,s=t;i<n.length&&(s=n[i].priority<n[s].priority?i:s,a<n.length&&(s=n[a].priority<n[s].priority?a:s),s!==t&&(this._swap(t,s),this._heapify(s)))},e.prototype._decrease=function(t){for(var n=this._arr,i=n[t].priority,a;t!==0&&(a=t>>1,!(n[a].priority<i));)this._swap(t,a),t=a},e.prototype._swap=function(t,n){var i=this._arr,a=this._keyIndices,s=i[t],o=i[n];i[t]=o,i[n]=s,a[o.key]=t,a[s.key]=n},eE}var tE,MI;function kG(){if(MI)return tE;MI=1;var r=da(),e=UG();tE=n;var t=r.constant(1);function n(a,s,o,l){return i(a,String(s),o||t,l||function(u){return a.outEdges(u)})}function i(a,s,o,l){var u={},c=new e,h,d,f=function(p){var m=p.v!==h?p.v:p.w,v=u[m],g=o(p),y=d.distance+g;if(g<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+p+" Weight: "+g);y<v.distance&&(v.distance=y,v.predecessor=h,c.decrease(m,y))};for(a.nodes().forEach(function(p){var m=p===s?0:Number.POSITIVE_INFINITY;u[p]={distance:m},c.add(p,m)});c.size()>0&&(h=c.removeMin(),d=u[h],d.distance!==Number.POSITIVE_INFINITY);)l(h).forEach(f);return u}return tE}var nE,CI;function Pj(){if(CI)return nE;CI=1;var r=kG(),e=da();nE=t;function t(n,i,a){return e.transform(n.nodes(),function(s,o){s[o]=r(n,o,i,a)},{})}return nE}var rE,RI;function GG(){if(RI)return rE;RI=1;var r=da();rE=e;function e(t){var n=0,i=[],a={},s=[];function o(l){var u=a[l]={onStack:!0,lowlink:n,index:n++};if(i.push(l),t.successors(l).forEach(function(d){r.has(a,d)?a[d].onStack&&(u.lowlink=Math.min(u.lowlink,a[d].index)):(o(d),u.lowlink=Math.min(u.lowlink,a[d].lowlink))}),u.lowlink===u.index){var c=[],h;do h=i.pop(),a[h].onStack=!1,c.push(h);while(l!==h);s.push(c)}}return t.nodes().forEach(function(l){r.has(a,l)||o(l)}),s}return rE}var iE,NI;function Dj(){if(NI)return iE;NI=1;var r=da(),e=GG();iE=t;function t(n){return r.filter(e(n),function(i){return i.length>1||i.length===1&&n.hasEdge(i[0],i[0])})}return iE}var aE,PI;function Lj(){if(PI)return aE;PI=1;var r=da();aE=t;var e=r.constant(1);function t(i,a,s){return n(i,a||e,s||function(o){return i.outEdges(o)})}function n(i,a,s){var o={},l=i.nodes();return l.forEach(function(u){o[u]={},o[u][u]={distance:0},l.forEach(function(c){u!==c&&(o[u][c]={distance:Number.POSITIVE_INFINITY})}),s(u).forEach(function(c){var h=c.v===u?c.w:c.v,d=a(c);o[u][h]={distance:d,predecessor:u}})}),l.forEach(function(u){var c=o[u];l.forEach(function(h){var d=o[h];l.forEach(function(f){var p=d[u],m=c[f],v=d[f],g=p.distance+m.distance;g<v.distance&&(v.distance=g,v.predecessor=m.predecessor)})})}),o}return aE}var sE,DI;function zG(){if(DI)return sE;DI=1;var r=da();sE=e,e.CycleException=t;function e(n){var i={},a={},s=[];function o(l){if(r.has(a,l))throw new t;r.has(i,l)||(a[l]=!0,i[l]=!0,r.each(n.predecessors(l),o),delete a[l],s.push(l))}if(r.each(n.sinks(),o),r.size(i)!==n.nodeCount())throw new t;return s}function t(){}return t.prototype=new Error,sE}var oE,LI;function Ij(){if(LI)return oE;LI=1;var r=zG();oE=e;function e(t){try{r(t)}catch(n){if(n instanceof r.CycleException)return!1;throw n}return!0}return oE}var lE,II;function VG(){if(II)return lE;II=1;var r=da();lE=e;function e(n,i,a){r.isArray(i)||(i=[i]);var s=(n.isDirected()?n.successors:n.neighbors).bind(n),o=[],l={};return r.each(i,function(u){if(!n.hasNode(u))throw new Error("Graph does not have node: "+u);t(n,u,a==="post",l,s,o)}),o}function t(n,i,a,s,o,l){r.has(s,i)||(s[i]=!0,a||l.push(i),r.each(o(i),function(u){t(n,u,a,s,o,l)}),a&&l.push(i))}return lE}var uE,OI;function Oj(){if(OI)return uE;OI=1;var r=VG();uE=e;function e(t,n){return r(t,n,"post")}return uE}var cE,FI;function Fj(){if(FI)return cE;FI=1;var r=VG();cE=e;function e(t,n){return r(t,n,"pre")}return cE}var hE,BI;function Bj(){if(BI)return hE;BI=1;var r=da(),e=_A(),t=UG();hE=n;function n(i,a){var s=new e,o={},l=new t,u;function c(d){var f=d.v===u?d.w:d.v,p=l.priority(f);if(p!==void 0){var m=a(d);m<p&&(o[f]=u,l.decrease(f,m))}}if(i.nodeCount()===0)return s;r.each(i.nodes(),function(d){l.add(d,Number.POSITIVE_INFINITY),s.setNode(d)}),l.decrease(i.nodes()[0],0);for(var h=!1;l.size()>0;){if(u=l.removeMin(),r.has(o,u))s.setEdge(u,o[u]);else{if(h)throw new Error("Input graph is not connected: "+i);h=!0}i.nodeEdges(u).forEach(c)}return s}return hE}var fE,UI;function Uj(){return UI||(UI=1,fE={components:Nj(),dijkstra:kG(),dijkstraAll:Pj(),findCycles:Dj(),floydWarshall:Lj(),isAcyclic:Ij(),postorder:Oj(),preorder:Fj(),prim:Bj(),tarjan:GG(),topsort:zG()}),fE}var dE,kI;function kj(){if(kI)return dE;kI=1;var r=Cj();return dE={Graph:r.Graph,json:Rj(),alg:Uj(),version:r.version},dE}var pE,GI;function Ba(){if(GI)return pE;GI=1;var r;if(typeof RS=="function")try{r=kj()}catch{}return r||(r=window.graphlib),pE=r,pE}var gE,zI;function Gj(){if(zI)return gE;zI=1;var r=dG(),e=1,t=4;function n(i){return r(i,e|t)}return gE=n,gE}var vE,VI;function nm(){if(VI)return vE;VI=1;var r=nh(),e=Js(),t=Xv(),n=fa();function i(a,s,o){if(!n(o))return!1;var l=typeof s;return(l=="number"?e(o)&&t(s,o.length):l=="string"&&s in o)?r(o[s],a):!1}return vE=i,vE}var mE,HI;function zj(){if(HI)return mE;HI=1;var r=tm(),e=nh(),t=nm(),n=au(),i=Object.prototype,a=i.hasOwnProperty,s=r(function(o,l){o=Object(o);var u=-1,c=l.length,h=c>2?l[2]:void 0;for(h&&t(l[0],l[1],h)&&(c=1);++u<c;)for(var d=l[u],f=n(d),p=-1,m=f.length;++p<m;){var v=f[p],g=o[v];(g===void 0||e(g,i[v])&&!a.call(o,v))&&(o[v]=d[v])}return o});return mE=s,mE}var yE,WI;function Vj(){if(WI)return yE;WI=1;var r=eo(),e=Js(),t=Jo();function n(i){return function(a,s,o){var l=Object(a);if(!e(a)){var u=r(s,3);a=t(a),s=function(h){return u(l[h],h,l)}}var c=i(a,s,o);return c>-1?l[u?a[c]:c]:void 0}}return yE=n,yE}var _E,qI;function Hj(){if(qI)return _E;qI=1;var r=/\s/;function e(t){for(var n=t.length;n--&&r.test(t.charAt(n)););return n}return _E=e,_E}var xE,$I;function Wj(){if($I)return xE;$I=1;var r=Hj(),e=/^\s+/;function t(n){return n&&n.slice(0,r(n)+1).replace(e,"")}return xE=t,xE}var bE,XI;function qj(){if(XI)return bE;XI=1;var r=Wj(),e=fa(),t=sh(),n=0/0,i=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,s=/^0o[0-7]+$/i,o=parseInt;function l(u){if(typeof u=="number")return u;if(t(u))return n;if(e(u)){var c=typeof u.valueOf=="function"?u.valueOf():u;u=e(c)?c+"":c}if(typeof u!="string")return u===0?u:+u;u=r(u);var h=a.test(u);return h||s.test(u)?o(u.slice(2),h?2:8):i.test(u)?n:+u}return bE=l,bE}var EE,YI;function HG(){if(YI)return EE;YI=1;var r=qj(),e=1/0,t=17976931348623157e292;function n(i){if(!i)return i===0?i:0;if(i=r(i),i===e||i===-e){var a=i<0?-1:1;return a*t}return i===i?i:0}return EE=n,EE}var TE,jI;function $j(){if(jI)return TE;jI=1;var r=HG();function e(t){var n=r(t),i=n%1;return n===n?i?n-i:n:0}return TE=e,TE}var wE,KI;function Xj(){if(KI)return wE;KI=1;var r=OG(),e=eo(),t=$j(),n=Math.max;function i(a,s,o){var l=a==null?0:a.length;if(!l)return-1;var u=o==null?0:t(o);return u<0&&(u=n(l+u,0)),r(a,e(s,3),u)}return wE=i,wE}var SE,QI;function Yj(){if(QI)return SE;QI=1;var r=Vj(),e=Xj(),t=r(e);return SE=t,SE}var AE,ZI;function WG(){if(ZI)return AE;ZI=1;var r=yA();function e(t){var n=t==null?0:t.length;return n?r(t,1):[]}return AE=e,AE}var ME,JI;function jj(){if(JI)return ME;JI=1;var r=pA(),e=pG(),t=au();function n(i,a){return i==null?i:r(i,e(a),t)}return ME=n,ME}var CE,e2;function Kj(){if(e2)return CE;e2=1;function r(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}return CE=r,CE}var RE,t2;function Qj(){if(t2)return RE;t2=1;var r=qv(),e=gA(),t=eo();function n(i,a){var s={};return a=t(a,3),e(i,function(o,l,u){r(s,l,a(o,l,u))}),s}return RE=n,RE}var NE,n2;function xA(){if(n2)return NE;n2=1;var r=sh();function e(t,n,i){for(var a=-1,s=t.length;++a<s;){var o=t[a],l=n(o);if(l!=null&&(u===void 0?l===l&&!r(l):i(l,u)))var u=l,c=o}return c}return NE=e,NE}var PE,r2;function Zj(){if(r2)return PE;r2=1;function r(e,t){return e>t}return PE=r,PE}var DE,i2;function Jj(){if(i2)return DE;i2=1;var r=xA(),e=Zj(),t=su();function n(i){return i&&i.length?r(i,t,e):void 0}return DE=n,DE}var LE,a2;function qG(){if(a2)return LE;a2=1;var r=qv(),e=nh();function t(n,i,a){(a!==void 0&&!e(n[i],a)||a===void 0&&!(i in n))&&r(n,i,a)}return LE=t,LE}var IE,s2;function eK(){if(s2)return IE;s2=1;var r=ru(),e=Kv(),t=fs(),n="[object Object]",i=Function.prototype,a=Object.prototype,s=i.toString,o=a.hasOwnProperty,l=s.call(Object);function u(c){if(!t(c)||r(c)!=n)return!1;var h=e(c);if(h===null)return!0;var d=o.call(h,"constructor")&&h.constructor;return typeof d=="function"&&d instanceof d&&s.call(d)==l}return IE=u,IE}var OE,o2;function $G(){if(o2)return OE;o2=1;function r(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}return OE=r,OE}var FE,l2;function tK(){if(l2)return FE;l2=1;var r=Sd(),e=au();function t(n){return r(n,e(n))}return FE=t,FE}var BE,u2;function nK(){if(u2)return BE;u2=1;var r=qG(),e=tG(),t=cG(),n=nG(),i=fG(),a=Ad(),s=Kn(),o=FG(),l=ih(),u=wd(),c=fa(),h=eK(),d=Md(),f=$G(),p=tK();function m(v,g,y,_,x,E,T){var b=f(v,y),w=f(g,y),A=T.get(w);if(A){r(v,y,A);return}var S=E?E(b,w,y+"",v,g,T):void 0,C=S===void 0;if(C){var R=s(w),P=!R&&l(w),M=!R&&!P&&d(w);S=w,R||P||M?s(b)?S=b:o(b)?S=n(b):P?(C=!1,S=e(w,!0)):M?(C=!1,S=t(w,!0)):S=[]:h(w)||a(w)?(S=b,a(b)?S=p(b):(!c(b)||u(b))&&(S=i(w))):C=!1}C&&(T.set(w,S),x(S,w,_,E,T),T.delete(w)),r(v,y,S)}return BE=m,BE}var UE,c2;function rK(){if(c2)return UE;c2=1;var r=Wv(),e=qG(),t=pA(),n=nK(),i=fa(),a=au(),s=$G();function o(l,u,c,h,d){l!==u&&t(u,function(f,p){if(d||(d=new r),i(f))n(l,u,p,c,o,h,d);else{var m=h?h(s(l,p),f,p+"",l,u,d):void 0;m===void 0&&(m=f),e(l,p,m)}},a)}return UE=o,UE}var kE,h2;function iK(){if(h2)return kE;h2=1;var r=tm(),e=nm();function t(n){return r(function(i,a){var s=-1,o=a.length,l=o>1?a[o-1]:void 0,u=o>2?a[2]:void 0;for(l=n.length>3&&typeof l=="function"?(o--,l):void 0,u&&e(a[0],a[1],u)&&(l=o<3?void 0:l,o=1),i=Object(i);++s<o;){var c=a[s];c&&n(i,c,s,l)}return i})}return kE=t,kE}var GE,f2;function aK(){if(f2)return GE;f2=1;var r=rK(),e=iK(),t=e(function(n,i,a){r(n,i,a)});return GE=t,GE}var zE,d2;function XG(){if(d2)return zE;d2=1;function r(e,t){return e<t}return zE=r,zE}var VE,p2;function sK(){if(p2)return VE;p2=1;var r=xA(),e=XG(),t=su();function n(i){return i&&i.length?r(i,t,e):void 0}return VE=n,VE}var HE,g2;function oK(){if(g2)return HE;g2=1;var r=xA(),e=eo(),t=XG();function n(i,a){return i&&i.length?r(i,e(a,2),t):void 0}return HE=n,HE}var WE,v2;function lK(){if(v2)return WE;v2=1;var r=Ga(),e=function(){return r.Date.now()};return WE=e,WE}var qE,m2;function uK(){if(m2)return qE;m2=1;var r=$v(),e=Jv(),t=Xv(),n=fa(),i=Cd();function a(s,o,l,u){if(!n(s))return s;o=e(o,s);for(var c=-1,h=o.length,d=h-1,f=s;f!=null&&++c<h;){var p=i(o[c]),m=l;if(p==="__proto__"||p==="constructor"||p==="prototype")return s;if(c!=d){var v=f[p];m=u?u(v,p,f):void 0,m===void 0&&(m=n(v)?v:t(o[c+1])?[]:{})}r(f,p,m),f=f[p]}return s}return qE=a,qE}var $E,y2;function cK(){if(y2)return $E;y2=1;var r=em(),e=uK(),t=Jv();function n(i,a,s){for(var o=-1,l=a.length,u={};++o<l;){var c=a[o],h=r(i,c);s(h,c)&&e(u,t(c,i),h)}return u}return $E=n,$E}var XE,_2;function hK(){if(_2)return XE;_2=1;var r=cK(),e=SG();function t(n,i){return r(n,i,function(a,s){return e(n,s)})}return XE=t,XE}var YE,x2;function fK(){if(x2)return YE;x2=1;var r=WG(),e=LG(),t=IG();function n(i){return t(e(i,void 0,r),i+"")}return YE=n,YE}var jE,b2;function dK(){if(b2)return jE;b2=1;var r=hK(),e=fK(),t=e(function(n,i){return n==null?{}:r(n,i)});return jE=t,jE}var KE,E2;function pK(){if(E2)return KE;E2=1;var r=Math.ceil,e=Math.max;function t(n,i,a,s){for(var o=-1,l=e(r((i-n)/(a||1)),0),u=Array(l);l--;)u[s?l:++o]=n,n+=a;return u}return KE=t,KE}var QE,T2;function gK(){if(T2)return QE;T2=1;var r=pK(),e=nm(),t=HG();function n(i){return function(a,s,o){return o&&typeof o!="number"&&e(a,s,o)&&(s=o=void 0),a=t(a),s===void 0?(s=a,a=0):s=t(s),o=o===void 0?a<s?1:-1:t(o),r(a,s,o,i)}}return QE=n,QE}var ZE,w2;function vK(){if(w2)return ZE;w2=1;var r=gK(),e=r();return ZE=e,ZE}var JE,S2;function mK(){if(S2)return JE;S2=1;function r(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}return JE=r,JE}var eT,A2;function yK(){if(A2)return eT;A2=1;var r=sh();function e(t,n){if(t!==n){var i=t!==void 0,a=t===null,s=t===t,o=r(t),l=n!==void 0,u=n===null,c=n===n,h=r(n);if(!u&&!h&&!o&&t>n||o&&l&&c&&!u&&!h||a&&l&&c||!i&&c||!s)return 1;if(!a&&!o&&!h&&t<n||h&&i&&s&&!a&&!o||u&&i&&s||!l&&s||!c)return-1}return 0}return eT=e,eT}var tT,M2;function _K(){if(M2)return tT;M2=1;var r=yK();function e(t,n,i){for(var a=-1,s=t.criteria,o=n.criteria,l=s.length,u=i.length;++a<l;){var c=r(s[a],o[a]);if(c){if(a>=u)return c;var h=i[a];return c*(h=="desc"?-1:1)}}return t.index-n.index}return tT=e,tT}var nT,C2;function xK(){if(C2)return nT;C2=1;var r=Zv(),e=em(),t=eo(),n=NG(),i=mK(),a=Yv(),s=_K(),o=su(),l=Kn();function u(c,h,d){h.length?h=r(h,function(m){return l(m)?function(v){return e(v,m.length===1?m[0]:m)}:m}):h=[o];var f=-1;h=r(h,a(t));var p=n(c,function(m,v,g){var y=r(h,function(_){return _(m)});return{criteria:y,index:++f,value:m}});return i(p,function(m,v){return s(m,v,d)})}return nT=u,nT}var rT,R2;function bK(){if(R2)return rT;R2=1;var r=yA(),e=xK(),t=tm(),n=nm(),i=t(function(a,s){if(a==null)return[];var o=s.length;return o>1&&n(a,s[0],s[1])?s=[]:o>2&&n(s[0],s[1],s[2])&&(s=[s[0]]),e(a,r(s,1),[])});return rT=i,rT}var iT,N2;function EK(){if(N2)return iT;N2=1;var r=TG(),e=0;function t(n){var i=++e;return r(n)+i}return iT=t,iT}var aT,P2;function TK(){if(P2)return aT;P2=1;function r(e,t,n){for(var i=-1,a=e.length,s=t.length,o={};++i<a;){var l=i<s?t[i]:void 0;n(o,e[i],l)}return o}return aT=r,aT}var sT,D2;function wK(){if(D2)return sT;D2=1;var r=$v(),e=TK();function t(n,i){return e(n||[],i||[],r)}return sT=t,sT}var oT,L2;function Mn(){if(L2)return oT;L2=1;var r;if(typeof RS=="function")try{r={cloneDeep:Gj(),constant:dA(),defaults:zj(),each:vG(),filter:MG(),find:Yj(),flatten:WG(),forEach:gG(),forIn:jj(),has:CG(),isUndefined:RG(),last:Kj(),map:PG(),mapValues:Qj(),max:Jj(),merge:aK(),min:sK(),minBy:oK(),now:lK(),pick:dK(),range:vK(),reduce:DG(),sortBy:bK(),uniqueId:EK(),values:BG(),zipObject:wK()}}catch{}return r||(r=window._),oT=r,oT}var lT,I2;function SK(){if(I2)return lT;I2=1,lT=r;function r(){var n={};n._next=n._prev=n,this._sentinel=n}r.prototype.dequeue=function(){var n=this._sentinel,i=n._prev;if(i!==n)return e(i),i},r.prototype.enqueue=function(n){var i=this._sentinel;n._prev&&n._next&&e(n),n._next=i._next,i._next._prev=n,i._next=n,n._prev=i},r.prototype.toString=function(){for(var n=[],i=this._sentinel,a=i._prev;a!==i;)n.push(JSON.stringify(a,t)),a=a._prev;return"["+n.join(", ")+"]"};function e(n){n._prev._next=n._next,n._next._prev=n._prev,delete n._next,delete n._prev}function t(n,i){if(n!=="_next"&&n!=="_prev")return i}return lT}var uT,O2;function AK(){if(O2)return uT;O2=1;var r=Mn(),e=Ba().Graph,t=SK();uT=i;var n=r.constant(1);function i(u,c){if(u.nodeCount()<=1)return[];var h=o(u,c||n),d=a(h.graph,h.buckets,h.zeroIdx);return r.flatten(r.map(d,function(f){return u.outEdges(f.v,f.w)}),!0)}function a(u,c,h){for(var d=[],f=c[c.length-1],p=c[0],m;u.nodeCount();){for(;m=p.dequeue();)s(u,c,h,m);for(;m=f.dequeue();)s(u,c,h,m);if(u.nodeCount()){for(var v=c.length-2;v>0;--v)if(m=c[v].dequeue(),m){d=d.concat(s(u,c,h,m,!0));break}}}return d}function s(u,c,h,d,f){var p=f?[]:void 0;return r.forEach(u.inEdges(d.v),function(m){var v=u.edge(m),g=u.node(m.v);f&&p.push({v:m.v,w:m.w}),g.out-=v,l(c,h,g)}),r.forEach(u.outEdges(d.v),function(m){var v=u.edge(m),g=m.w,y=u.node(g);y.in-=v,l(c,h,y)}),u.removeNode(d.v),p}function o(u,c){var h=new e,d=0,f=0;r.forEach(u.nodes(),function(v){h.setNode(v,{v,in:0,out:0})}),r.forEach(u.edges(),function(v){var g=h.edge(v.v,v.w)||0,y=c(v),_=g+y;h.setEdge(v.v,v.w,_),f=Math.max(f,h.node(v.v).out+=y),d=Math.max(d,h.node(v.w).in+=y)});var p=r.range(f+d+3).map(function(){return new t}),m=d+1;return r.forEach(h.nodes(),function(v){l(p,m,h.node(v))}),{graph:h,buckets:p,zeroIdx:m}}function l(u,c,h){h.out?h.in?u[h.out-h.in+c].enqueue(h):u[u.length-1].enqueue(h):u[0].enqueue(h)}return uT}var cT,F2;function MK(){if(F2)return cT;F2=1;var r=Mn(),e=AK();cT={run:t,undo:i};function t(a){var s=a.graph().acyclicer==="greedy"?e(a,o(a)):n(a);r.forEach(s,function(l){var u=a.edge(l);a.removeEdge(l),u.forwardName=l.name,u.reversed=!0,a.setEdge(l.w,l.v,u,r.uniqueId("rev"))});function o(l){return function(u){return l.edge(u).weight}}}function n(a){var s=[],o={},l={};function u(c){r.has(l,c)||(l[c]=!0,o[c]=!0,r.forEach(a.outEdges(c),function(h){r.has(o,h.w)?s.push(h):u(h.w)}),delete o[c])}return r.forEach(a.nodes(),u),s}function i(a){r.forEach(a.edges(),function(s){var o=a.edge(s);if(o.reversed){a.removeEdge(s);var l=o.forwardName;delete o.reversed,delete o.forwardName,a.setEdge(s.w,s.v,o,l)}})}return cT}var hT,B2;function mi(){if(B2)return hT;B2=1;var r=Mn(),e=Ba().Graph;hT={addDummyNode:t,simplify:n,asNonCompoundGraph:i,successorWeights:a,predecessorWeights:s,intersectRect:o,buildLayerMatrix:l,normalizeRanks:u,removeEmptyRanks:c,addBorderNode:h,maxRank:d,partition:f,time:p,notime:m};function t(v,g,y,_){var x;do x=r.uniqueId(_);while(v.hasNode(x));return y.dummy=g,v.setNode(x,y),x}function n(v){var g=new e().setGraph(v.graph());return r.forEach(v.nodes(),function(y){g.setNode(y,v.node(y))}),r.forEach(v.edges(),function(y){var _=g.edge(y.v,y.w)||{weight:0,minlen:1},x=v.edge(y);g.setEdge(y.v,y.w,{weight:_.weight+x.weight,minlen:Math.max(_.minlen,x.minlen)})}),g}function i(v){var g=new e({multigraph:v.isMultigraph()}).setGraph(v.graph());return r.forEach(v.nodes(),function(y){v.children(y).length||g.setNode(y,v.node(y))}),r.forEach(v.edges(),function(y){g.setEdge(y,v.edge(y))}),g}function a(v){var g=r.map(v.nodes(),function(y){var _={};return r.forEach(v.outEdges(y),function(x){_[x.w]=(_[x.w]||0)+v.edge(x).weight}),_});return r.zipObject(v.nodes(),g)}function s(v){var g=r.map(v.nodes(),function(y){var _={};return r.forEach(v.inEdges(y),function(x){_[x.v]=(_[x.v]||0)+v.edge(x).weight}),_});return r.zipObject(v.nodes(),g)}function o(v,g){var y=v.x,_=v.y,x=g.x-y,E=g.y-_,T=v.width/2,b=v.height/2;if(!x&&!E)throw new Error("Not possible to find intersection inside of the rectangle");var w,A;return Math.abs(E)*T>Math.abs(x)*b?(E<0&&(b=-b),w=b*x/E,A=b):(x<0&&(T=-T),w=T,A=T*E/x),{x:y+w,y:_+A}}function l(v){var g=r.map(r.range(d(v)+1),function(){return[]});return r.forEach(v.nodes(),function(y){var _=v.node(y),x=_.rank;r.isUndefined(x)||(g[x][_.order]=y)}),g}function u(v){var g=r.min(r.map(v.nodes(),function(y){return v.node(y).rank}));r.forEach(v.nodes(),function(y){var _=v.node(y);r.has(_,"rank")&&(_.rank-=g)})}function c(v){var g=r.min(r.map(v.nodes(),function(E){return v.node(E).rank})),y=[];r.forEach(v.nodes(),function(E){var T=v.node(E).rank-g;y[T]||(y[T]=[]),y[T].push(E)});var _=0,x=v.graph().nodeRankFactor;r.forEach(y,function(E,T){r.isUndefined(E)&&T%x!==0?--_:_&&r.forEach(E,function(b){v.node(b).rank+=_})})}function h(v,g,y,_){var x={width:0,height:0};return arguments.length>=4&&(x.rank=y,x.order=_),t(v,"border",x,g)}function d(v){return r.max(r.map(v.nodes(),function(g){var y=v.node(g).rank;if(!r.isUndefined(y))return y}))}function f(v,g){var y={lhs:[],rhs:[]};return r.forEach(v,function(_){g(_)?y.lhs.push(_):y.rhs.push(_)}),y}function p(v,g){var y=r.now();try{return g()}finally{console.log(v+" time: "+(r.now()-y)+"ms")}}function m(v,g){return g()}return hT}var fT,U2;function CK(){if(U2)return fT;U2=1;var r=Mn(),e=mi();fT={run:t,undo:i};function t(a){a.graph().dummyChains=[],r.forEach(a.edges(),function(s){n(a,s)})}function n(a,s){var o=s.v,l=a.node(o).rank,u=s.w,c=a.node(u).rank,h=s.name,d=a.edge(s),f=d.labelRank;if(c!==l+1){a.removeEdge(s);var p,m,v;for(v=0,++l;l<c;++v,++l)d.points=[],m={width:0,height:0,edgeLabel:d,edgeObj:s,rank:l},p=e.addDummyNode(a,"edge",m,"_d"),l===f&&(m.width=d.width,m.height=d.height,m.dummy="edge-label",m.labelpos=d.labelpos),a.setEdge(o,p,{weight:d.weight},h),v===0&&a.graph().dummyChains.push(p),o=p;a.setEdge(o,u,{weight:d.weight},h)}}function i(a){r.forEach(a.graph().dummyChains,function(s){var o=a.node(s),l=o.edgeLabel,u;for(a.setEdge(o.edgeObj,l);o.dummy;)u=a.successors(s)[0],a.removeNode(s),l.points.push({x:o.x,y:o.y}),o.dummy==="edge-label"&&(l.x=o.x,l.y=o.y,l.width=o.width,l.height=o.height),s=u,o=a.node(s)})}return fT}var dT,k2;function Zg(){if(k2)return dT;k2=1;var r=Mn();dT={longestPath:e,slack:t};function e(n){var i={};function a(s){var o=n.node(s);if(r.has(i,s))return o.rank;i[s]=!0;var l=r.min(r.map(n.outEdges(s),function(u){return a(u.w)-n.edge(u).minlen}));return(l===Number.POSITIVE_INFINITY||l===void 0||l===null)&&(l=0),o.rank=l}r.forEach(n.sources(),a)}function t(n,i){return n.node(i.w).rank-n.node(i.v).rank-n.edge(i).minlen}return dT}var pT,G2;function YG(){if(G2)return pT;G2=1;var r=Mn(),e=Ba().Graph,t=Zg().slack;pT=n;function n(o){var l=new e({directed:!1}),u=o.nodes()[0],c=o.nodeCount();l.setNode(u,{});for(var h,d;i(l,o)<c;)h=a(l,o),d=l.hasNode(h.v)?t(o,h):-t(o,h),s(l,o,d);return l}function i(o,l){function u(c){r.forEach(l.nodeEdges(c),function(h){var d=h.v,f=c===d?h.w:d;!o.hasNode(f)&&!t(l,h)&&(o.setNode(f,{}),o.setEdge(c,f,{}),u(f))})}return r.forEach(o.nodes(),u),o.nodeCount()}function a(o,l){return r.minBy(l.edges(),function(u){if(o.hasNode(u.v)!==o.hasNode(u.w))return t(l,u)})}function s(o,l,u){r.forEach(o.nodes(),function(c){l.node(c).rank+=u})}return pT}var gT,z2;function RK(){if(z2)return gT;z2=1;var r=Mn(),e=YG(),t=Zg().slack,n=Zg().longestPath,i=Ba().alg.preorder,a=Ba().alg.postorder,s=mi().simplify;gT=o,o.initLowLimValues=h,o.initCutValues=l,o.calcCutValue=c,o.leaveEdge=f,o.enterEdge=p,o.exchangeEdges=m;function o(_){_=s(_),n(_);var x=e(_);h(x),l(x,_);for(var E,T;E=f(x);)T=p(x,_,E),m(x,_,E,T)}function l(_,x){var E=a(_,_.nodes());E=E.slice(0,E.length-1),r.forEach(E,function(T){u(_,x,T)})}function u(_,x,E){var T=_.node(E),b=T.parent;_.edge(E,b).cutvalue=c(_,x,E)}function c(_,x,E){var T=_.node(E),b=T.parent,w=!0,A=x.edge(E,b),S=0;return A||(w=!1,A=x.edge(b,E)),S=A.weight,r.forEach(x.nodeEdges(E),function(C){var R=C.v===E,P=R?C.w:C.v;if(P!==b){var M=R===w,N=x.edge(C).weight;if(S+=M?N:-N,g(_,E,P)){var D=_.edge(E,P).cutvalue;S+=M?-D:D}}}),S}function h(_,x){arguments.length<2&&(x=_.nodes()[0]),d(_,{},1,x)}function d(_,x,E,T,b){var w=E,A=_.node(T);return x[T]=!0,r.forEach(_.neighbors(T),function(S){r.has(x,S)||(E=d(_,x,E,S,T))}),A.low=w,A.lim=E++,b?A.parent=b:delete A.parent,E}function f(_){return r.find(_.edges(),function(x){return _.edge(x).cutvalue<0})}function p(_,x,E){var T=E.v,b=E.w;x.hasEdge(T,b)||(T=E.w,b=E.v);var w=_.node(T),A=_.node(b),S=w,C=!1;w.lim>A.lim&&(S=A,C=!0);var R=r.filter(x.edges(),function(P){return C===y(_,_.node(P.v),S)&&C!==y(_,_.node(P.w),S)});return r.minBy(R,function(P){return t(x,P)})}function m(_,x,E,T){var b=E.v,w=E.w;_.removeEdge(b,w),_.setEdge(T.v,T.w,{}),h(_),l(_,x),v(_,x)}function v(_,x){var E=r.find(_.nodes(),function(b){return!x.node(b).parent}),T=i(_,E);T=T.slice(1),r.forEach(T,function(b){var w=_.node(b).parent,A=x.edge(b,w),S=!1;A||(A=x.edge(w,b),S=!0),x.node(b).rank=x.node(w).rank+(S?A.minlen:-A.minlen)})}function g(_,x,E){return _.hasEdge(x,E)}function y(_,x,E){return E.low<=x.lim&&x.lim<=E.lim}return gT}var vT,V2;function NK(){if(V2)return vT;V2=1;var r=Zg(),e=r.longestPath,t=YG(),n=RK();vT=i;function i(l){switch(l.graph().ranker){case"network-simplex":o(l);break;case"tight-tree":s(l);break;case"longest-path":a(l);break;default:o(l)}}var a=e;function s(l){e(l),t(l)}function o(l){n(l)}return vT}var mT,H2;function PK(){if(H2)return mT;H2=1;var r=Mn();mT=e;function e(i){var a=n(i);r.forEach(i.graph().dummyChains,function(s){for(var o=i.node(s),l=o.edgeObj,u=t(i,a,l.v,l.w),c=u.path,h=u.lca,d=0,f=c[d],p=!0;s!==l.w;){if(o=i.node(s),p){for(;(f=c[d])!==h&&i.node(f).maxRank<o.rank;)d++;f===h&&(p=!1)}if(!p){for(;d<c.length-1&&i.node(f=c[d+1]).minRank<=o.rank;)d++;f=c[d]}i.setParent(s,f),s=i.successors(s)[0]}})}function t(i,a,s,o){var l=[],u=[],c=Math.min(a[s].low,a[o].low),h=Math.max(a[s].lim,a[o].lim),d,f;d=s;do d=i.parent(d),l.push(d);while(d&&(a[d].low>c||h>a[d].lim));for(f=d,d=o;(d=i.parent(d))!==f;)u.push(d);return{path:l.concat(u.reverse()),lca:f}}function n(i){var a={},s=0;function o(l){var u=s;r.forEach(i.children(l),o),a[l]={low:u,lim:s++}}return r.forEach(i.children(),o),a}return mT}var yT,W2;function DK(){if(W2)return yT;W2=1;var r=Mn(),e=mi();yT={run:t,cleanup:s};function t(o){var l=e.addDummyNode(o,"root",{},"_root"),u=i(o),c=r.max(r.values(u))-1,h=2*c+1;o.graph().nestingRoot=l,r.forEach(o.edges(),function(f){o.edge(f).minlen*=h});var d=a(o)+1;r.forEach(o.children(),function(f){n(o,l,h,d,c,u,f)}),o.graph().nodeRankFactor=h}function n(o,l,u,c,h,d,f){var p=o.children(f);if(!p.length){f!==l&&o.setEdge(l,f,{weight:0,minlen:u});return}var m=e.addBorderNode(o,"_bt"),v=e.addBorderNode(o,"_bb"),g=o.node(f);o.setParent(m,f),g.borderTop=m,o.setParent(v,f),g.borderBottom=v,r.forEach(p,function(y){n(o,l,u,c,h,d,y);var _=o.node(y),x=_.borderTop?_.borderTop:y,E=_.borderBottom?_.borderBottom:y,T=_.borderTop?c:2*c,b=x!==E?1:h-d[f]+1;o.setEdge(m,x,{weight:T,minlen:b,nestingEdge:!0}),o.setEdge(E,v,{weight:T,minlen:b,nestingEdge:!0})}),o.parent(f)||o.setEdge(l,m,{weight:0,minlen:h+d[f]})}function i(o){var l={};function u(c,h){var d=o.children(c);d&&d.length&&r.forEach(d,function(f){u(f,h+1)}),l[c]=h}return r.forEach(o.children(),function(c){u(c,1)}),l}function a(o){return r.reduce(o.edges(),function(l,u){return l+o.edge(u).weight},0)}function s(o){var l=o.graph();o.removeNode(l.nestingRoot),delete l.nestingRoot,r.forEach(o.edges(),function(u){var c=o.edge(u);c.nestingEdge&&o.removeEdge(u)})}return yT}var _T,q2;function LK(){if(q2)return _T;q2=1;var r=Mn(),e=mi();_T=t;function t(i){function a(s){var o=i.children(s),l=i.node(s);if(o.length&&r.forEach(o,a),r.has(l,"minRank")){l.borderLeft=[],l.borderRight=[];for(var u=l.minRank,c=l.maxRank+1;u<c;++u)n(i,"borderLeft","_bl",s,l,u),n(i,"borderRight","_br",s,l,u)}}r.forEach(i.children(),a)}function n(i,a,s,o,l,u){var c={width:0,height:0,rank:u,borderType:a},h=l[a][u-1],d=e.addDummyNode(i,"border",c,s);l[a][u]=d,i.setParent(d,o),h&&i.setEdge(h,d,{weight:1})}return _T}var xT,$2;function IK(){if($2)return xT;$2=1;var r=Mn();xT={adjust:e,undo:t};function e(u){var c=u.graph().rankdir.toLowerCase();(c==="lr"||c==="rl")&&n(u)}function t(u){var c=u.graph().rankdir.toLowerCase();(c==="bt"||c==="rl")&&a(u),(c==="lr"||c==="rl")&&(o(u),n(u))}function n(u){r.forEach(u.nodes(),function(c){i(u.node(c))}),r.forEach(u.edges(),function(c){i(u.edge(c))})}function i(u){var c=u.width;u.width=u.height,u.height=c}function a(u){r.forEach(u.nodes(),function(c){s(u.node(c))}),r.forEach(u.edges(),function(c){var h=u.edge(c);r.forEach(h.points,s),r.has(h,"y")&&s(h)})}function s(u){u.y=-u.y}function o(u){r.forEach(u.nodes(),function(c){l(u.node(c))}),r.forEach(u.edges(),function(c){var h=u.edge(c);r.forEach(h.points,l),r.has(h,"x")&&l(h)})}function l(u){var c=u.x;u.x=u.y,u.y=c}return xT}var bT,X2;function OK(){if(X2)return bT;X2=1;var r=Mn();bT=e;function e(t){var n={},i=r.filter(t.nodes(),function(u){return!t.children(u).length}),a=r.max(r.map(i,function(u){return t.node(u).rank})),s=r.map(r.range(a+1),function(){return[]});function o(u){if(!r.has(n,u)){n[u]=!0;var c=t.node(u);s[c.rank].push(u),r.forEach(t.successors(u),o)}}var l=r.sortBy(i,function(u){return t.node(u).rank});return r.forEach(l,o),s}return bT}var ET,Y2;function FK(){if(Y2)return ET;Y2=1;var r=Mn();ET=e;function e(n,i){for(var a=0,s=1;s<i.length;++s)a+=t(n,i[s-1],i[s]);return a}function t(n,i,a){for(var s=r.zipObject(a,r.map(a,function(d,f){return f})),o=r.flatten(r.map(i,function(d){return r.sortBy(r.map(n.outEdges(d),function(f){return{pos:s[f.w],weight:n.edge(f).weight}}),"pos")}),!0),l=1;l<a.length;)l<<=1;var u=2*l-1;l-=1;var c=r.map(new Array(u),function(){return 0}),h=0;return r.forEach(o.forEach(function(d){var f=d.pos+l;c[f]+=d.weight;for(var p=0;f>0;)f%2&&(p+=c[f+1]),f=f-1>>1,c[f]+=d.weight;h+=d.weight*p})),h}return ET}var TT,j2;function BK(){if(j2)return TT;j2=1;var r=Mn();TT=e;function e(t,n){return r.map(n,function(i){var a=t.inEdges(i);if(a.length){var s=r.reduce(a,function(o,l){var u=t.edge(l),c=t.node(l.v);return{sum:o.sum+u.weight*c.order,weight:o.weight+u.weight}},{sum:0,weight:0});return{v:i,barycenter:s.sum/s.weight,weight:s.weight}}else return{v:i}})}return TT}var wT,K2;function UK(){if(K2)return wT;K2=1;var r=Mn();wT=e;function e(i,a){var s={};r.forEach(i,function(l,u){var c=s[l.v]={indegree:0,in:[],out:[],vs:[l.v],i:u};r.isUndefined(l.barycenter)||(c.barycenter=l.barycenter,c.weight=l.weight)}),r.forEach(a.edges(),function(l){var u=s[l.v],c=s[l.w];!r.isUndefined(u)&&!r.isUndefined(c)&&(c.indegree++,u.out.push(s[l.w]))});var o=r.filter(s,function(l){return!l.indegree});return t(o)}function t(i){var a=[];function s(u){return function(c){c.merged||(r.isUndefined(c.barycenter)||r.isUndefined(u.barycenter)||c.barycenter>=u.barycenter)&&n(u,c)}}function o(u){return function(c){c.in.push(u),--c.indegree===0&&i.push(c)}}for(;i.length;){var l=i.pop();a.push(l),r.forEach(l.in.reverse(),s(l)),r.forEach(l.out,o(l))}return r.map(r.filter(a,function(u){return!u.merged}),function(u){return r.pick(u,["vs","i","barycenter","weight"])})}function n(i,a){var s=0,o=0;i.weight&&(s+=i.barycenter*i.weight,o+=i.weight),a.weight&&(s+=a.barycenter*a.weight,o+=a.weight),i.vs=a.vs.concat(i.vs),i.barycenter=s/o,i.weight=o,i.i=Math.min(a.i,i.i),a.merged=!0}return wT}var ST,Q2;function kK(){if(Q2)return ST;Q2=1;var r=Mn(),e=mi();ST=t;function t(a,s){var o=e.partition(a,function(m){return r.has(m,"barycenter")}),l=o.lhs,u=r.sortBy(o.rhs,function(m){return-m.i}),c=[],h=0,d=0,f=0;l.sort(i(!!s)),f=n(c,u,f),r.forEach(l,function(m){f+=m.vs.length,c.push(m.vs),h+=m.barycenter*m.weight,d+=m.weight,f=n(c,u,f)});var p={vs:r.flatten(c,!0)};return d&&(p.barycenter=h/d,p.weight=d),p}function n(a,s,o){for(var l;s.length&&(l=r.last(s)).i<=o;)s.pop(),a.push(l.vs),o++;return o}function i(a){return function(s,o){return s.barycenter<o.barycenter?-1:s.barycenter>o.barycenter?1:a?o.i-s.i:s.i-o.i}}return ST}var AT,Z2;function GK(){if(Z2)return AT;Z2=1;var r=Mn(),e=BK(),t=UK(),n=kK();AT=i;function i(o,l,u,c){var h=o.children(l),d=o.node(l),f=d?d.borderLeft:void 0,p=d?d.borderRight:void 0,m={};f&&(h=r.filter(h,function(E){return E!==f&&E!==p}));var v=e(o,h);r.forEach(v,function(E){if(o.children(E.v).length){var T=i(o,E.v,u,c);m[E.v]=T,r.has(T,"barycenter")&&s(E,T)}});var g=t(v,u);a(g,m);var y=n(g,c);if(f&&(y.vs=r.flatten([f,y.vs,p],!0),o.predecessors(f).length)){var _=o.node(o.predecessors(f)[0]),x=o.node(o.predecessors(p)[0]);r.has(y,"barycenter")||(y.barycenter=0,y.weight=0),y.barycenter=(y.barycenter*y.weight+_.order+x.order)/(y.weight+2),y.weight+=2}return y}function a(o,l){r.forEach(o,function(u){u.vs=r.flatten(u.vs.map(function(c){return l[c]?l[c].vs:c}),!0)})}function s(o,l){r.isUndefined(o.barycenter)?(o.barycenter=l.barycenter,o.weight=l.weight):(o.barycenter=(o.barycenter*o.weight+l.barycenter*l.weight)/(o.weight+l.weight),o.weight+=l.weight)}return AT}var MT,J2;function zK(){if(J2)return MT;J2=1;var r=Mn(),e=Ba().Graph;MT=t;function t(i,a,s){var o=n(i),l=new e({compound:!0}).setGraph({root:o}).setDefaultNodeLabel(function(u){return i.node(u)});return r.forEach(i.nodes(),function(u){var c=i.node(u),h=i.parent(u);(c.rank===a||c.minRank<=a&&a<=c.maxRank)&&(l.setNode(u),l.setParent(u,h||o),r.forEach(i[s](u),function(d){var f=d.v===u?d.w:d.v,p=l.edge(f,u),m=r.isUndefined(p)?0:p.weight;l.setEdge(f,u,{weight:i.edge(d).weight+m})}),r.has(c,"minRank")&&l.setNode(u,{borderLeft:c.borderLeft[a],borderRight:c.borderRight[a]}))}),l}function n(i){for(var a;i.hasNode(a=r.uniqueId("_root")););return a}return MT}var CT,eO;function VK(){if(eO)return CT;eO=1;var r=Mn();CT=e;function e(t,n,i){var a={},s;r.forEach(i,function(o){for(var l=t.parent(o),u,c;l;){if(u=t.parent(l),u?(c=a[u],a[u]=l):(c=s,s=l),c&&c!==l){n.setEdge(c,l);return}l=u}})}return CT}var RT,tO;function HK(){if(tO)return RT;tO=1;var r=Mn(),e=OK(),t=FK(),n=GK(),i=zK(),a=VK(),s=Ba().Graph,o=mi();RT=l;function l(d){var f=o.maxRank(d),p=u(d,r.range(1,f+1),"inEdges"),m=u(d,r.range(f-1,-1,-1),"outEdges"),v=e(d);h(d,v);for(var g=Number.POSITIVE_INFINITY,y,_=0,x=0;x<4;++_,++x){c(_%2?p:m,_%4>=2),v=o.buildLayerMatrix(d);var E=t(d,v);E<g&&(x=0,y=r.cloneDeep(v),g=E)}h(d,y)}function u(d,f,p){return r.map(f,function(m){return i(d,m,p)})}function c(d,f){var p=new s;r.forEach(d,function(m){var v=m.graph().root,g=n(m,v,p,f);r.forEach(g.vs,function(y,_){m.node(y).order=_}),a(m,p,g.vs)})}function h(d,f){r.forEach(f,function(p){r.forEach(p,function(m,v){d.node(m).order=v})})}return RT}var NT,nO;function WK(){if(nO)return NT;nO=1;var r=Mn(),e=Ba().Graph,t=mi();NT={positionX:p,findType1Conflicts:n,findType2Conflicts:i,addConflict:s,hasConflict:o,verticalAlignment:l,horizontalCompaction:u,alignCoordinates:d,findSmallestWidthAlignment:h,balance:f};function n(g,y){var _={};function x(E,T){var b=0,w=0,A=E.length,S=r.last(T);return r.forEach(T,function(C,R){var P=a(g,C),M=P?g.node(P).order:A;(P||C===S)&&(r.forEach(T.slice(w,R+1),function(N){r.forEach(g.predecessors(N),function(D){var I=g.node(D),L=I.order;(L<b||M<L)&&!(I.dummy&&g.node(N).dummy)&&s(_,D,N)})}),w=R+1,b=M)}),T}return r.reduce(y,x),_}function i(g,y){var _={};function x(T,b,w,A,S){var C;r.forEach(r.range(b,w),function(R){C=T[R],g.node(C).dummy&&r.forEach(g.predecessors(C),function(P){var M=g.node(P);M.dummy&&(M.order<A||M.order>S)&&s(_,P,C)})})}function E(T,b){var w=-1,A,S=0;return r.forEach(b,function(C,R){if(g.node(C).dummy==="border"){var P=g.predecessors(C);P.length&&(A=g.node(P[0]).order,x(b,S,R,w,A),S=R,w=A)}x(b,S,b.length,A,T.length)}),b}return r.reduce(y,E),_}function a(g,y){if(g.node(y).dummy)return r.find(g.predecessors(y),function(_){return g.node(_).dummy})}function s(g,y,_){if(y>_){var x=y;y=_,_=x}var E=g[y];E||(g[y]=E={}),E[_]=!0}function o(g,y,_){if(y>_){var x=y;y=_,_=x}return r.has(g[y],_)}function l(g,y,_,x){var E={},T={},b={};return r.forEach(y,function(w){r.forEach(w,function(A,S){E[A]=A,T[A]=A,b[A]=S})}),r.forEach(y,function(w){var A=-1;r.forEach(w,function(S){var C=x(S);if(C.length){C=r.sortBy(C,function(D){return b[D]});for(var R=(C.length-1)/2,P=Math.floor(R),M=Math.ceil(R);P<=M;++P){var N=C[P];T[S]===S&&A<b[N]&&!o(_,S,N)&&(T[N]=S,T[S]=E[S]=E[N],A=b[N])}}})}),{root:E,align:T}}function u(g,y,_,x,E){var T={},b=c(g,y,_,E),w=E?"borderLeft":"borderRight";function A(R,P){for(var M=b.nodes(),N=M.pop(),D={};N;)D[N]?R(N):(D[N]=!0,M.push(N),M=M.concat(P(N))),N=M.pop()}function S(R){T[R]=b.inEdges(R).reduce(function(P,M){return Math.max(P,T[M.v]+b.edge(M))},0)}function C(R){var P=b.outEdges(R).reduce(function(N,D){return Math.min(N,T[D.w]-b.edge(D))},Number.POSITIVE_INFINITY),M=g.node(R);P!==Number.POSITIVE_INFINITY&&M.borderType!==w&&(T[R]=Math.max(T[R],P))}return A(S,b.predecessors.bind(b)),A(C,b.successors.bind(b)),r.forEach(x,function(R){T[R]=T[_[R]]}),T}function c(g,y,_,x){var E=new e,T=g.graph(),b=m(T.nodesep,T.edgesep,x);return r.forEach(y,function(w){var A;r.forEach(w,function(S){var C=_[S];if(E.setNode(C),A){var R=_[A],P=E.edge(R,C);E.setEdge(R,C,Math.max(b(g,S,A),P||0))}A=S})}),E}function h(g,y){return r.minBy(r.values(y),function(_){var x=Number.NEGATIVE_INFINITY,E=Number.POSITIVE_INFINITY;return r.forIn(_,function(T,b){var w=v(g,b)/2;x=Math.max(T+w,x),E=Math.min(T-w,E)}),x-E})}function d(g,y){var _=r.values(y),x=r.min(_),E=r.max(_);r.forEach(["u","d"],function(T){r.forEach(["l","r"],function(b){var w=T+b,A=g[w],S;if(A!==y){var C=r.values(A);S=b==="l"?x-r.min(C):E-r.max(C),S&&(g[w]=r.mapValues(A,function(R){return R+S}))}})})}function f(g,y){return r.mapValues(g.ul,function(_,x){if(y)return g[y.toLowerCase()][x];var E=r.sortBy(r.map(g,x));return(E[1]+E[2])/2})}function p(g){var y=t.buildLayerMatrix(g),_=r.merge(n(g,y),i(g,y)),x={},E;r.forEach(["u","d"],function(b){E=b==="u"?y:r.values(y).reverse(),r.forEach(["l","r"],function(w){w==="r"&&(E=r.map(E,function(R){return r.values(R).reverse()}));var A=(b==="u"?g.predecessors:g.successors).bind(g),S=l(g,E,_,A),C=u(g,E,S.root,S.align,w==="r");w==="r"&&(C=r.mapValues(C,function(R){return-R})),x[b+w]=C})});var T=h(g,x);return d(x,T),f(x,g.graph().align)}function m(g,y,_){return function(x,E,T){var b=x.node(E),w=x.node(T),A=0,S;if(A+=b.width/2,r.has(b,"labelpos"))switch(b.labelpos.toLowerCase()){case"l":S=-b.width/2;break;case"r":S=b.width/2;break}if(S&&(A+=_?S:-S),S=0,A+=(b.dummy?y:g)/2,A+=(w.dummy?y:g)/2,A+=w.width/2,r.has(w,"labelpos"))switch(w.labelpos.toLowerCase()){case"l":S=w.width/2;break;case"r":S=-w.width/2;break}return S&&(A+=_?S:-S),S=0,A}}function v(g,y){return g.node(y).width}return NT}var PT,rO;function qK(){if(rO)return PT;rO=1;var r=Mn(),e=mi(),t=WK().positionX;PT=n;function n(a){a=e.asNonCompoundGraph(a),i(a),r.forEach(t(a),function(s,o){a.node(o).x=s})}function i(a){var s=e.buildLayerMatrix(a),o=a.graph().ranksep,l=0;r.forEach(s,function(u){var c=r.max(r.map(u,function(h){return a.node(h).height}));r.forEach(u,function(h){a.node(h).y=l+c/2}),l+=c+o})}return PT}var DT,iO;function $K(){if(iO)return DT;iO=1;var r=Mn(),e=MK(),t=CK(),n=NK(),i=mi().normalizeRanks,a=PK(),s=mi().removeEmptyRanks,o=DK(),l=LK(),u=IK(),c=HK(),h=qK(),d=mi(),f=Ba().Graph;DT=p;function p(O,F){var V=F&&F.debugTiming?d.time:d.notime;V("layout",function(){var $=V("  buildLayoutGraph",function(){return A(O)});V("  runLayout",function(){m($,V)}),V("  updateInputGraph",function(){v(O,$)})})}function m(O,F){F("    makeSpaceForEdgeLabels",function(){S(O)}),F("    removeSelfEdges",function(){z(O)}),F("    acyclic",function(){e.run(O)}),F("    nestingGraph.run",function(){o.run(O)}),F("    rank",function(){n(d.asNonCompoundGraph(O))}),F("    injectEdgeLabelProxies",function(){C(O)}),F("    removeEmptyRanks",function(){s(O)}),F("    nestingGraph.cleanup",function(){o.cleanup(O)}),F("    normalizeRanks",function(){i(O)}),F("    assignRankMinMax",function(){R(O)}),F("    removeEdgeLabelProxies",function(){P(O)}),F("    normalize.run",function(){t.run(O)}),F("    parentDummyChains",function(){a(O)}),F("    addBorderSegments",function(){l(O)}),F("    order",function(){c(O)}),F("    insertSelfEdges",function(){B(O)}),F("    adjustCoordinateSystem",function(){u.adjust(O)}),F("    position",function(){h(O)}),F("    positionSelfEdges",function(){k(O)}),F("    removeBorderNodes",function(){L(O)}),F("    normalize.undo",function(){t.undo(O)}),F("    fixupEdgeLabelCoords",function(){D(O)}),F("    undoCoordinateSystem",function(){u.undo(O)}),F("    translateGraph",function(){M(O)}),F("    assignNodeIntersects",function(){N(O)}),F("    reversePoints",function(){I(O)}),F("    acyclic.undo",function(){e.undo(O)})}function v(O,F){r.forEach(O.nodes(),function(V){var $=O.node(V),Z=F.node(V);$&&($.x=Z.x,$.y=Z.y,F.children(V).length&&($.width=Z.width,$.height=Z.height))}),r.forEach(O.edges(),function(V){var $=O.edge(V),Z=F.edge(V);$.points=Z.points,r.has(Z,"x")&&($.x=Z.x,$.y=Z.y)}),O.graph().width=F.graph().width,O.graph().height=F.graph().height}var g=["nodesep","edgesep","ranksep","marginx","marginy"],y={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},_=["acyclicer","ranker","rankdir","align"],x=["width","height"],E={width:0,height:0},T=["minlen","weight","width","height","labeloffset"],b={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},w=["labelpos"];function A(O){var F=new f({multigraph:!0,compound:!0}),V=G(O.graph());return F.setGraph(r.merge({},y,U(V,g),r.pick(V,_))),r.forEach(O.nodes(),function($){var Z=G(O.node($));F.setNode($,r.defaults(U(Z,x),E)),F.setParent($,O.parent($))}),r.forEach(O.edges(),function($){var Z=G(O.edge($));F.setEdge($,r.merge({},b,U(Z,T),r.pick(Z,w)))}),F}function S(O){var F=O.graph();F.ranksep/=2,r.forEach(O.edges(),function(V){var $=O.edge(V);$.minlen*=2,$.labelpos.toLowerCase()!=="c"&&(F.rankdir==="TB"||F.rankdir==="BT"?$.width+=$.labeloffset:$.height+=$.labeloffset)})}function C(O){r.forEach(O.edges(),function(F){var V=O.edge(F);if(V.width&&V.height){var $=O.node(F.v),Z=O.node(F.w),Y={rank:(Z.rank-$.rank)/2+$.rank,e:F};d.addDummyNode(O,"edge-proxy",Y,"_ep")}})}function R(O){var F=0;r.forEach(O.nodes(),function(V){var $=O.node(V);$.borderTop&&($.minRank=O.node($.borderTop).rank,$.maxRank=O.node($.borderBottom).rank,F=r.max(F,$.maxRank))}),O.graph().maxRank=F}function P(O){r.forEach(O.nodes(),function(F){var V=O.node(F);V.dummy==="edge-proxy"&&(O.edge(V.e).labelRank=V.rank,O.removeNode(F))})}function M(O){var F=Number.POSITIVE_INFINITY,V=0,$=Number.POSITIVE_INFINITY,Z=0,Y=O.graph(),X=Y.marginx||0,K=Y.marginy||0;function se(oe){var W=oe.x,Ne=oe.y,Be=oe.width,we=oe.height;F=Math.min(F,W-Be/2),V=Math.max(V,W+Be/2),$=Math.min($,Ne-we/2),Z=Math.max(Z,Ne+we/2)}r.forEach(O.nodes(),function(oe){se(O.node(oe))}),r.forEach(O.edges(),function(oe){var W=O.edge(oe);r.has(W,"x")&&se(W)}),F-=X,$-=K,r.forEach(O.nodes(),function(oe){var W=O.node(oe);W.x-=F,W.y-=$}),r.forEach(O.edges(),function(oe){var W=O.edge(oe);r.forEach(W.points,function(Ne){Ne.x-=F,Ne.y-=$}),r.has(W,"x")&&(W.x-=F),r.has(W,"y")&&(W.y-=$)}),Y.width=V-F+X,Y.height=Z-$+K}function N(O){r.forEach(O.edges(),function(F){var V=O.edge(F),$=O.node(F.v),Z=O.node(F.w),Y,X;V.points?(Y=V.points[0],X=V.points[V.points.length-1]):(V.points=[],Y=Z,X=$),V.points.unshift(d.intersectRect($,Y)),V.points.push(d.intersectRect(Z,X))})}function D(O){r.forEach(O.edges(),function(F){var V=O.edge(F);if(r.has(V,"x"))switch((V.labelpos==="l"||V.labelpos==="r")&&(V.width-=V.labeloffset),V.labelpos){case"l":V.x-=V.width/2+V.labeloffset;break;case"r":V.x+=V.width/2+V.labeloffset;break}})}function I(O){r.forEach(O.edges(),function(F){var V=O.edge(F);V.reversed&&V.points.reverse()})}function L(O){r.forEach(O.nodes(),function(F){if(O.children(F).length){var V=O.node(F),$=O.node(V.borderTop),Z=O.node(V.borderBottom),Y=O.node(r.last(V.borderLeft)),X=O.node(r.last(V.borderRight));V.width=Math.abs(X.x-Y.x),V.height=Math.abs(Z.y-$.y),V.x=Y.x+V.width/2,V.y=$.y+V.height/2}}),r.forEach(O.nodes(),function(F){O.node(F).dummy==="border"&&O.removeNode(F)})}function z(O){r.forEach(O.edges(),function(F){if(F.v===F.w){var V=O.node(F.v);V.selfEdges||(V.selfEdges=[]),V.selfEdges.push({e:F,label:O.edge(F)}),O.removeEdge(F)}})}function B(O){var F=d.buildLayerMatrix(O);r.forEach(F,function(V){var $=0;r.forEach(V,function(Z,Y){var X=O.node(Z);X.order=Y+$,r.forEach(X.selfEdges,function(K){d.addDummyNode(O,"selfedge",{width:K.label.width,height:K.label.height,rank:X.rank,order:Y+ ++$,e:K.e,label:K.label},"_se")}),delete X.selfEdges})})}function k(O){r.forEach(O.nodes(),function(F){var V=O.node(F);if(V.dummy==="selfedge"){var $=O.node(V.e.v),Z=$.x+$.width/2,Y=$.y,X=V.x-Z,K=$.height/2;O.setEdge(V.e,V.label),O.removeNode(F),V.label.points=[{x:Z+2*X/3,y:Y-K},{x:Z+5*X/6,y:Y-K},{x:Z+X,y:Y},{x:Z+5*X/6,y:Y+K},{x:Z+2*X/3,y:Y+K}],V.label.x=V.x,V.label.y=V.y}})}function U(O,F){return r.mapValues(r.pick(O,F),Number)}function G(O){var F={};return r.forEach(O,function(V,$){F[$.toLowerCase()]=V}),F}return DT}var LT,aO;function XK(){if(aO)return LT;aO=1;var r=Mn(),e=mi(),t=Ba().Graph;LT={debugOrdering:n};function n(i){var a=e.buildLayerMatrix(i),s=new t({compound:!0,multigraph:!0}).setGraph({});return r.forEach(i.nodes(),function(o){s.setNode(o,{label:o}),s.setParent(o,"layer"+i.node(o).rank)}),r.forEach(i.edges(),function(o){s.setEdge(o.v,o.w,{},o.name)}),r.forEach(a,function(o,l){var u="layer"+l;s.setNode(u,{rank:"same"}),r.reduce(o,function(c,h){return s.setEdge(c,h,{style:"invis"}),h})}),s}return LT}var IT,sO;function YK(){return sO||(sO=1,IT="0.8.5"),IT}var OT,oO;function jK(){return oO||(oO=1,OT={graphlib:Ba(),layout:$K(),debug:XK(),util:{time:mi().time,notime:mi().notime},version:YK()}),OT}(function(r,e){(function(n,i){r.exports=i(jK())})(Ui,function(t){return function(n){var i={};function a(s){if(i[s])return i[s].exports;var o=i[s]={i:s,l:!1,exports:{}};return n[s].call(o.exports,o,o.exports,a),o.l=!0,o.exports}return a.m=n,a.c=i,a.d=function(s,o,l){a.o(s,o)||Object.defineProperty(s,o,{enumerable:!0,get:l})},a.r=function(s){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},a.t=function(s,o){if(o&1&&(s=a(s)),o&8||o&4&&typeof s=="object"&&s&&s.__esModule)return s;var l=Object.create(null);if(a.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:s}),o&2&&typeof s!="string")for(var u in s)a.d(l,u,function(c){return s[c]}.bind(null,u));return l},a.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return a.d(o,"a",o),o},a.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)},a.p="",a(a.s=0)}([function(n,i,a){var s=a(1),o=function(u){!u||u("layout","dagre",s)};typeof cytoscape<"u"&&o(cytoscape),n.exports=o},function(n,i,a){function s(d){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?s=function(p){return typeof p}:s=function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},s(d)}var o=function(f){return typeof f=="function"},l=a(2),u=a(3),c=a(4);function h(d){this.options=u({},l,d)}h.prototype.run=function(){var d=this.options,f=this,p=d.cy,m=d.eles,v=function(k,U){return o(U)?U.apply(k,[k]):U},g=d.boundingBox||{x1:0,y1:0,w:p.width(),h:p.height()};g.x2===void 0&&(g.x2=g.x1+g.w),g.w===void 0&&(g.w=g.x2-g.x1),g.y2===void 0&&(g.y2=g.y1+g.h),g.h===void 0&&(g.h=g.y2-g.y1);var y=new c.graphlib.Graph({multigraph:!0,compound:!0}),_={},x=function(k,U){U!=null&&(_[k]=U)};x("nodesep",d.nodeSep),x("edgesep",d.edgeSep),x("ranksep",d.rankSep),x("rankdir",d.rankDir),x("align",d.align),x("ranker",d.ranker),x("acyclicer",d.acyclicer),y.setGraph(_),y.setDefaultEdgeLabel(function(){return{}}),y.setDefaultNodeLabel(function(){return{}});var E=m.nodes();o(d.sort)&&(E=E.sort(d.sort));for(var T=0;T<E.length;T++){var b=E[T],w=b.layoutDimensions(d);y.setNode(b.id(),{width:w.w,height:w.h,name:b.id()})}for(var A=0;A<E.length;A++){var S=E[A];S.isChild()&&y.setParent(S.id(),S.parent().id())}var C=m.edges().stdFilter(function(B){return!B.source().isParent()&&!B.target().isParent()});o(d.sort)&&(C=C.sort(d.sort));for(var R=0;R<C.length;R++){var P=C[R];y.setEdge(P.source().id(),P.target().id(),{minlen:v(P,d.minLen),weight:v(P,d.edgeWeight),name:P.id()},P.id())}c.layout(y);for(var M=y.nodes(),N=0;N<M.length;N++){var D=M[N],I=y.node(D);p.getElementById(D).scratch().dagre=I}var L;d.boundingBox?(L={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0},E.forEach(function(B){var k=B.scratch().dagre;L.x1=Math.min(L.x1,k.x),L.x2=Math.max(L.x2,k.x),L.y1=Math.min(L.y1,k.y),L.y2=Math.max(L.y2,k.y)}),L.w=L.x2-L.x1,L.h=L.y2-L.y1):L=g;var z=function(k){if(d.boundingBox){var U=L.w===0?0:(k.x-L.x1)/L.w,G=L.h===0?0:(k.y-L.y1)/L.h;return{x:g.x1+U*g.w,y:g.y1+G*g.h}}else return k};return E.layoutPositions(f,d,function(B){B=s(B)==="object"?B:this;var k=B.scratch().dagre;return z({x:k.x,y:k.y})}),this},n.exports=h},function(n,i){var a={nodeSep:void 0,edgeSep:void 0,rankSep:void 0,rankDir:void 0,align:void 0,acyclicer:void 0,ranker:void 0,minLen:function(o){return 1},edgeWeight:function(o){return 1},fit:!0,padding:30,spacingFactor:void 0,nodeDimensionsIncludeLabels:!1,animate:!1,animateFilter:function(o,l){return!0},animationDuration:500,animationEasing:void 0,boundingBox:void 0,transform:function(o,l){return l},ready:function(){},sort:void 0,stop:function(){}};n.exports=a},function(n,i){n.exports=Object.assign!=null?Object.assign.bind(Object):function(a){for(var s=arguments.length,o=new Array(s>1?s-1:0),l=1;l<s;l++)o[l-1]=arguments[l];return o.forEach(function(u){Object.keys(u).forEach(function(c){return a[c]=u[c]})}),a}},function(n,i){n.exports=t}])})})(j3);const KK=CS(j3.exports);const QK=["id"],ZK={key:0,class:"header_category"},JK=["onClick"],eQ={key:1,class:"footer_options"},tQ={class:"options"},nQ=["onClick"],rQ={class:"options"},iQ=["onClick"],aQ=["id"],sQ={class:"progress-bar"},oQ={class:"progress-bar__outer"},lQ=["id"],uQ=["id"],cp=20,cQ={__name:"Cytoscape",props:{graphData:{type:Object,default:()=>({nodes:[],edges:[]})},prevData:{type:Object,default:()=>({nodes:[],edges:[]})}},emits:["nodeAndEdgeClick","getMoreData","updatePosition","sendCy"],setup(r,{expose:e,emit:t}){Ma.use(zY),Ma.use(WY),Ma.use(I9),Ma.use(KK);const n=t,i=ea(null),a=r,s={};s.whichComponent=si("whichComponentProps"),s.isShowOptions=si("isShowOptionsProps"),s.isAddEvents=si("isAddEventsProps"),s.isDbclickEvents=si("isDbclickEventsProps"),s.isDbclickhandle=si("isDbclickhandleProps"),s.isKnowlegeModel=si("isKnowlegeModelProps"),s.customPosition=si("customPositionProps"),s.isCalcColors=si("isCalcColorsProps"),s.isCxttapstart=si("isCxttapstartProps"),s.bluePrintId=si("bluePrintIdProps"),s.currentPathIdx=si("currentPathIdxProps"),s.pathsData=si("pathsDataProps"),s.startEndPoints=si("startEndPointsProps");const o=Wr({cy:null,types:[],style:{},currentType:"",typeColors:{},typeSizes:{},initFinalData:{},layout:"fcose",layoutOptions:{},paths:[],activePath:[],singleClickNode:[],singleClickEdge:{},ctxMenuVisible:!1,ctxData:{x:"",y:"",bluePrintId:"",data:null,orginData:null},currentDbclickNodeId:"",currenDbclickNodeData:[],markCurrentEvent:""});Og(()=>a.graphData,()=>{s.isDbclickhandle&&s.isDbclickhandle.value?f():l()},{deep:!0}),Og(()=>s.currentPathIdx,C=>{d(C.value)},{deep:!0});const l=()=>{let C=[];a.graphData.nodes.forEach(R=>C.push(R.label)),o.types=Array.from(new Set(a.graphData.nodes.map(R=>"class"+ta.exports(R.label||R.id)))),o.types.length&&o.types.map((R,P)=>{o.style[R]={}}),x(),o.types=S(C),o.initFinalData=pW(a.graphData,s.startEndPoints),o.layoutOptions=aC[o.layout],o.cy=Ma({container:i.value,elements:o.initFinalData,zoom:1,style:so,layout:s.customPosition?null:o.layoutOptions,minZoom:.2,maxZoom:2.5,wheelSensitivity:.2}),u(),n("sendCy",o.cy)},u=()=>{Object.keys(s.pathsData).length&&s.pathsData.value.length?c():h(),s.isCxttapstart&&p(),s.isDbclickEvents&&m(),s.customPosition&&g()},c=()=>{s.isAddEvents&&iC(o.cy,()=>{d(-1)}),s.pathsData.value.length&&(s.pathsData.value.map(C=>{let R=[];C.map((P,M)=>{M+1===C.length?(R.push(P.startId),R.push(P.endId)):R.push(P.startId)}),o.paths.push(R)}),d(s.currentPathIdx.value))},h=()=>{s.isAddEvents&&iC(o.cy,(C,R)=>{o.ctxMenuVisible=!1,o.cy.elements().map(P=>{P.removeClass("path-node-ctx")}),_W(C,o.cy,!0,R),!s.isKnowlegeModel&&(o.singleClickNode=[],o.singleClickEdge={},R?(o.singleClickEdge=o.cy.edges().filter(P=>P.id()===R.id()).data(),C.map(P=>o.singleClickNode.push(o.cy.$(`#${P}`).data()))):C.length&&o.singleClickNode.push(o.cy.$(`#${C[0]}`).data()),n("nodeAndEdgeClick",o.singleClickNode,o.singleClickEdge))})},d=C=>{o.selectedPathIdx=C,o.selectedPathIdx===-1?(o.activePath=[],$U(o.cy)):(o.activePath=o.paths[o.selectedPathIdx],gW(o.cy,o.activePath))},f=()=>{let C=null,R={nodes:[],edges:[]};a.prevData.nodes.length<=a.graphData.nodes.length?(C="add",R.nodes=a.graphData.nodes.filter(M=>!a.prevData.nodes.some(N=>N.id===M.id)),a.prevData.edges.length<=a.graphData.edges.length?R.edges=a.graphData.edges.filter(M=>!a.prevData.edges.some(N=>N.id===M.id)):(C="remove",R.edges=a.prevData.edges.filter(M=>!a.graphData.edges.some(N=>N.id===M.id)))):(C="remove",R.nodes=a.prevData.nodes.filter(M=>!a.graphData.nodes.some(N=>N.id===M.id)),R.edges=a.prevData.edges.filter(M=>!a.graphData.edges.some(N=>N.id===M.id)));let P=[];if(R.nodes.forEach(M=>{P.push({group:"nodes",data:M,classes:"class"+ta.exports(M.label)})}),R.edges.forEach(M=>{P.push({group:"edges",data:{source:M.source+"",target:M.target+"",id:"edges"+M.id,label:M.label,rootId:M.rootId?M.rootId:"",properties:{...M.properties}}})}),!!P.length){if(o.types=Array.from(new Set(a.graphData.nodes.map(M=>"class"+ta.exports(M.label||M.id)))),o.types.length&&o.types.map((M,N)=>{o.style[M]={}}),C==="add"){x();let M=[];if(a.graphData.nodes.map(N=>M.push(N.label)),o.types=S(M),o.cy.add(P),o.cy.style(so),_(o.layout,!0),!o.currentDbclickNodeId)return;setTimeout(()=>{o.markCurrentEvent==="rsc"&&(o.cy.nodes().removeClass("path-node-ctx"),o.cy.edges().removeClass("path-edge"),R.nodes.map(N=>{o.cy.nodes().map(D=>{D.id()===N.id&&D.addClass("path-node-ctx")})}),R.edges.map(N=>{o.cy.edges().map(D=>{(D.id()===`edges${N.id}`||D.id()===N.id)&&D.addClass("path-edge")})})),o.cy.nodes(`#${o.currentDbclickNodeId}`).style({"border-width":4,"border-color":"red"})},500)}else{x();let M=[];if(a.graphData.nodes.map(I=>M.push(I.label)),o.types=S(M),R.nodes.map(I=>{o.cy.nodes("#"+I.id).remove()}),R.edges.map(I=>{o.cy.edges("#edges"+I.id).remove()}),o.cy.style(so),_(o.layout,!0),!o.currenDbclickNodeData.length)return;const N=o.currenDbclickNodeData.filter(I=>I.id===o.currentDbclickNodeId),D=o.currenDbclickNodeData.findIndex(I=>I.id===o.currentDbclickNodeId);o.currenDbclickNodeData.splice(D,1),setTimeout(()=>{o.cy.nodes(`#${o.currentDbclickNodeId}`).style({"border-width":N[0].brWidth,"border-color":N[0].brColor})},500)}n("sendCy",o.cy)}},p=()=>{o.ctxMenuVisible=!1,mW(o.cy,(C,R,P)=>{document.oncontextmenu=new Function("event.returnValue=false"),C&&C.id&&(y({ctxTapRightData:C,type:R,nodePosition:P}),o.markCurrentEvent="rsc")})},m=()=>{vW(o.cy,C=>{n("getMoreData",{nodeData:C},s.whichComponent),v(C.id),o.markCurrentEvent="ldc"})},v=C=>{let R=!0;if(o.currentDbclickNodeId=C,o.currenDbclickNodeData.length&&o.currenDbclickNodeData.map(N=>{N.id===C&&(R=!1)}),!R)return;const M=o.cy.nodes(`#${C}`)[0]._private.style;o.currenDbclickNodeData.push({id:C,brColor:M["border-color"].strValue,brWidth:M["border-width"].value})},g=()=>{yW(o.cy,R=>{R.isNode&&R.isNode()&&n("updatePosition",R,o.cy)});const C=o.cy.nodes();for(const R of C)console.log(R),R._private.data.style.position&&R._private.data.style.position.x&&R._private.data.style.position.y&&R.position({x:R._private.data.style.position.x,y:R._private.data.style.position.y});o.cy.center()},y=async C=>{console.log(C),C.ctxTapRightData.id&&(o.ctxMenuVisible=!0,(document.documentElement.clientHeight-200)/2>C.nodePosition.y?(o.ctxData.x=C.nodePosition.x+"px",o.ctxData.y=C.nodePosition.y+"px"):(o.ctxData.x=C.nodePosition.x+"px",o.ctxData.y=C.nodePosition.y-320+"px"),o.ctxData={x:o.ctxData.x,y:o.ctxData.y,data:C.ctxTapRightData,type:C.type,bluePrintId:s.bluePrintId.value,originData:a.graphData})},_=(C,R)=>{o.layout===C&&!R||(o.layout=C,o.layoutOptions=aC[C],o.layout==="d3-force"&&xW(s.whichComponent,o.cy),o.cy.layout(o.layoutOptions).run())},x=()=>{if(s.isCalcColors)a.graphData.nodes.map(C=>{const R="class"+ta.exports(C.label);let P=E(C,R);so.push({selector:`.${R}`,style:P})});else{let C=0;o.types.forEach(R=>{if(typeof o.typeColors[R]>"u")o.typeSizes[R]=2,C>ol.length-1&&(C=0),o.typeColors[R]=C,C++,so.push({selector:`.${R}`,style:{"background-color":ol[o.typeColors[R]],"border-color":ll[o.typeColors[R]],"border-width":2,width:40,height:40}});else{const P=so.findIndex(N=>N.selector===R);P>-1&&so.splice(P,1);let M=A(R);so.push({selector:`.${R}`,style:M})}})}},E=(C,R)=>{let P={"background-color":C.style&&C.style.nodeColor,"border-color":C.style&&C.style.brColor,"border-width":2,width:C.style&&C.style.size,height:C.style&&C.style.size};return o.style[R]&&(P={...P,...o.style[R]}),P},T=C=>{if(o.currentType===C){o.currentType="";return}o.currentType=C},b=C=>{o.currentType!==""&&(o.typeColors[o.currentType]=C,o.style[o.currentType]||(o.style[o.currentType]={}),o.style[o.currentType]["background-color"]=ol[o.typeColors[o.currentType]],o.style[o.currentType]["border-color"]=ll[o.typeColors[o.currentType]],o.cy.$(`.${o.currentType}`).style({"background-color":ol[o.typeColors[o.currentType]],"border-color":ll[o.typeColors[o.currentType]]}))},w=C=>{o.currentType!==""&&(o.typeSizes[o.currentType]=C,o.style[o.currentType]||(o.style[o.currentType]={}),o.style[o.currentType].width=C*cp,o.style[o.currentType].height=C*cp,o.cy.$(`.${o.currentType}`).style({width:C*cp,height:C*cp}))},A=C=>{let R={"background-color":ol[o.typeColors[C]],"border-color":ll[o.typeColors[C]],"border-width":2,width:40,height:40};return o.style[C]&&(R={...R,...o.style[C]}),R},S=C=>{let R=[];return C.sort(),C.forEach((P,M)=>{P===C[M-1]?R[R.length-1].num++:R.push({key:P,class:"class"+ta.exports(P),num:1})}),R};return br(()=>{sessionStorage.setItem("graphMode","init")}),e({state:o,switchLayout:_}),(C,R)=>(Ye(),tt($n,null,[Ue("div",{class:"two_graph",ref_key:"cyRef",ref:i,id:`cyDom${s.whichComponent}`},null,8,QK),s.isShowOptions?(Ye(),tt("div",ZK,[(Ye(!0),tt($n,null,_r(o.types,(P,M)=>(Ye(),tt("span",{key:M,class:Mo(["category",{active:o.currentType===P.class}]),style:ia(`background: ${Nt(ol)[o.typeColors[P.class]]};border-color: ${Nt(ll)[o.typeColors[P.class]]};color: ${Nt(ll)[o.typeColors[P.class]]}`),onClick:N=>T(P.class)},Kt(P.key)+"("+Kt(P.num)+") ",15,JK))),128))])):on("",!0),o.currentType?(Ye(),tt("div",eQ,[R[0]||(R[0]=Ue("p",null,"\u989C\u8272\uFF1A",-1)),Ue("div",tQ,[(Ye(!0),tt($n,null,_r(Nt(ol),(P,M)=>(Ye(),tt("span",{key:M,class:Mo(["optionsColor",{active:o.typeColors[o.currentType]===M}]),style:ia(`background: ${P};border-color: ${Nt(ll)[M]}`),onClick:N=>b(M)},null,14,nQ))),128))]),R[1]||(R[1]=Ue("p",null,"\u5927\u5C0F\uFF1A",-1)),Ue("div",rQ,[(Ye(),tt($n,null,_r(4,P=>Ue("span",{key:P,class:Mo(["optionsColor optionsSize",{active:o.typeSizes[o.currentType]===P}]),style:ia(`width: ${(P+5)*2}px;height: ${(P+5)*2}px`),onClick:M=>w(P)},null,14,iQ)),64))])])):on("",!0),Is(Ue("div",{class:"cytoscape--container__loading",id:`progress-box${s.whichComponent}`},[Ue("div",sQ,[Ue("div",oQ,[Ue("div",{class:"progress-bar__inner",id:`progress-bar${s.whichComponent}`},null,8,lQ)]),Ue("div",{class:"progress-bar__text",id:`progress-text${s.whichComponent}`},null,8,uQ)])],8,aQ),[[Co,o.layout==="d3-force"&&a.graphData.nodes&&a.graphData.nodes.length]])],64))}},hQ=Nr(cQ,[["__scopeId","data-v-de8308c0"]]);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const oh="175",Ar={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Fs={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},jG=0,Ww=1,KG=2,fQ=0,bA=1,dQ=2,Fi=3,yi=0,dn=1,Qr=2,_i=0,aa=1,wc=2,Sc=3,Ac=4,hc=5,Br=100,EA=101,TA=102,QG=103,ZG=104,As=200,wA=201,SA=202,AA=203,Of=204,Ff=205,MA=206,CA=207,RA=208,NA=209,PA=210,pQ=211,gQ=212,vQ=213,mQ=214,Bf=0,Uf=1,kf=2,Ho=3,Gf=4,zf=5,Vf=6,Hf=7,Rd=0,JG=1,ez=2,xi=0,tz=1,nz=2,rz=3,iz=4,yQ=5,az=6,sz=7,DA=300,la=301,ua=302,Wo=303,qo=304,Yl=306,jl=1e3,ts=1001,Kl=1002,mn=1003,LA=1004,Bs=1005,ir=1006,fc=1007,fi=1008,In=1009,Ol=1010,Fl=1011,Pa=1012,mr=1013,hn=1014,Un=1015,kr=1016,rm=1017,im=1018,Gi=1020,am=35902,IA=1021,Nd=1022,On=1023,OA=1024,FA=1025,zi=1026,Vi=1027,Pd=1028,lh=1029,Ql=1030,uh=1031,_Q=1032,ch=1033,Bl=33776,Po=33777,Do=33778,Lo=33779,Wf=35840,qf=35841,$f=35842,Xf=35843,Yf=36196,Mc=37492,Cc=37496,Rc=37808,Nc=37809,Pc=37810,Dc=37811,Lc=37812,Ic=37813,Oc=37814,Fc=37815,Bc=37816,Uc=37817,kc=37818,Gc=37819,zc=37820,Vc=37821,Ul=36492,qw=36494,$w=36495,BA=36283,jf=36284,Kf=36285,Qf=36286,xQ=3200,bQ=3201,Xs=0,oz=1,Bi="",ft="srgb",is="srgb-linear",Jg="linear",en="srgb",EQ=0,El=7680,TQ=7681,wQ=7682,SQ=7683,AQ=34055,MQ=34056,CQ=5386,RQ=512,NQ=513,PQ=514,DQ=515,LQ=516,IQ=517,OQ=518,Xw=519,UA=512,sm=513,kA=514,om=515,GA=516,zA=517,VA=518,HA=519,ev=35044,Ju=35048,lO="300 es",di=2e3,$o=2001;class to{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const i=n[e];if(i!==void 0){const a=i.indexOf(t);a!==-1&&i.splice(a,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let a=0,s=i.length;a<s;a++)i[a].call(this,e);e.target=null}}}const Lr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let uO=1234567;const df=Math.PI/180,Zl=180/Math.PI;function Gs(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Lr[r&255]+Lr[r>>8&255]+Lr[r>>16&255]+Lr[r>>24&255]+"-"+Lr[e&255]+Lr[e>>8&255]+"-"+Lr[e>>16&15|64]+Lr[e>>24&255]+"-"+Lr[t&63|128]+Lr[t>>8&255]+"-"+Lr[t>>16&255]+Lr[t>>24&255]+Lr[n&255]+Lr[n>>8&255]+Lr[n>>16&255]+Lr[n>>24&255]).toLowerCase()}function Ct(r,e,t){return Math.max(e,Math.min(t,r))}function WA(r,e){return(r%e+e)%e}function FQ(r,e,t,n,i){return n+(r-e)*(i-n)/(t-e)}function BQ(r,e,t){return r!==e?(t-r)/(e-r):0}function pf(r,e,t){return(1-t)*r+t*e}function UQ(r,e,t,n){return pf(r,e,1-Math.exp(-t*n))}function kQ(r,e=1){return e-Math.abs(WA(r,e*2)-e)}function GQ(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*(3-2*r))}function zQ(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*r*(r*(r*6-15)+10))}function VQ(r,e){return r+Math.floor(Math.random()*(e-r+1))}function HQ(r,e){return r+Math.random()*(e-r)}function WQ(r){return r*(.5-Math.random())}function qQ(r){r!==void 0&&(uO=r);let e=uO+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function $Q(r){return r*df}function XQ(r){return r*Zl}function YQ(r){return(r&r-1)===0&&r!==0}function jQ(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function KQ(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function QQ(r,e,t,n,i){const a=Math.cos,s=Math.sin,o=a(t/2),l=s(t/2),u=a((e+n)/2),c=s((e+n)/2),h=a((e-n)/2),d=s((e-n)/2),f=a((n-e)/2),p=s((n-e)/2);switch(i){case"XYX":r.set(o*c,l*h,l*d,o*u);break;case"YZY":r.set(l*d,o*c,l*h,o*u);break;case"ZXZ":r.set(l*h,l*d,o*c,o*u);break;case"XZX":r.set(o*c,l*p,l*f,o*u);break;case"YXY":r.set(l*f,o*c,l*p,o*u);break;case"ZYZ":r.set(l*p,l*f,o*c,o*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Zr(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function Mt(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const tv={DEG2RAD:df,RAD2DEG:Zl,generateUUID:Gs,clamp:Ct,euclideanModulo:WA,mapLinear:FQ,inverseLerp:BQ,lerp:pf,damp:UQ,pingpong:kQ,smoothstep:GQ,smootherstep:zQ,randInt:VQ,randFloat:HQ,randFloatSpread:WQ,seededRandom:qQ,degToRad:$Q,radToDeg:XQ,isPowerOfTwo:YQ,ceilPowerOfTwo:jQ,floorPowerOfTwo:KQ,setQuaternionFromProperEuler:QQ,normalize:Mt,denormalize:Zr};class He{constructor(e=0,t=0){He.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Ct(this.x,e.x,t.x),this.y=Ct(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Ct(this.x,e,t),this.y=Ct(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Ct(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Ct(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),a=this.x-e.x,s=this.y-e.y;return this.x=a*n-s*i+e.x,this.y=a*i+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Et{constructor(e,t,n,i,a,s,o,l,u){Et.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,i,a,s,o,l,u)}set(e,t,n,i,a,s,o,l,u){const c=this.elements;return c[0]=e,c[1]=i,c[2]=o,c[3]=t,c[4]=a,c[5]=l,c[6]=n,c[7]=s,c[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,a=this.elements,s=n[0],o=n[3],l=n[6],u=n[1],c=n[4],h=n[7],d=n[2],f=n[5],p=n[8],m=i[0],v=i[3],g=i[6],y=i[1],_=i[4],x=i[7],E=i[2],T=i[5],b=i[8];return a[0]=s*m+o*y+l*E,a[3]=s*v+o*_+l*T,a[6]=s*g+o*x+l*b,a[1]=u*m+c*y+h*E,a[4]=u*v+c*_+h*T,a[7]=u*g+c*x+h*b,a[2]=d*m+f*y+p*E,a[5]=d*v+f*_+p*T,a[8]=d*g+f*x+p*b,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],a=e[3],s=e[4],o=e[5],l=e[6],u=e[7],c=e[8];return t*s*c-t*o*u-n*a*c+n*o*l+i*a*u-i*s*l}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],a=e[3],s=e[4],o=e[5],l=e[6],u=e[7],c=e[8],h=c*s-o*u,d=o*l-c*a,f=u*a-s*l,p=t*h+n*d+i*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=h*m,e[1]=(i*u-c*n)*m,e[2]=(o*n-i*s)*m,e[3]=d*m,e[4]=(c*t-i*l)*m,e[5]=(i*a-o*t)*m,e[6]=f*m,e[7]=(n*l-u*t)*m,e[8]=(s*t-n*a)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,a,s,o){const l=Math.cos(a),u=Math.sin(a);return this.set(n*l,n*u,-n*(l*s+u*o)+s+e,-i*u,i*l,-i*(-u*s+l*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(FT.makeScale(e,t)),this}rotate(e){return this.premultiply(FT.makeRotation(-e)),this}translate(e,t){return this.premultiply(FT.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const FT=new Et;function qA(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}function Zf(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function lz(){const r=Zf("canvas");return r.style.display="block",r}const cO={};function Ia(r){r in cO||(cO[r]=!0,console.warn(r))}function ZQ(r,e,t){return new Promise(function(n,i){function a(){switch(r.clientWaitSync(e,r.SYNC_FLUSH_COMMANDS_BIT,0)){case r.WAIT_FAILED:i();break;case r.TIMEOUT_EXPIRED:setTimeout(a,t);break;default:n()}}setTimeout(a,t)})}function JQ(r){const e=r.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function eZ(r){const e=r.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const hO=new Et().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),fO=new Et().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function tZ(){const r={enabled:!0,workingColorSpace:is,spaces:{},convert:function(i,a,s){return this.enabled===!1||a===s||!a||!s||(this.spaces[a].transfer===en&&(i.r=zs(i.r),i.g=zs(i.g),i.b=zs(i.b)),this.spaces[a].primaries!==this.spaces[s].primaries&&(i.applyMatrix3(this.spaces[a].toXYZ),i.applyMatrix3(this.spaces[s].fromXYZ)),this.spaces[s].transfer===en&&(i.r=dc(i.r),i.g=dc(i.g),i.b=dc(i.b))),i},fromWorkingColorSpace:function(i,a){return this.convert(i,this.workingColorSpace,a)},toWorkingColorSpace:function(i,a){return this.convert(i,a,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===Bi?Jg:this.spaces[i].transfer},getLuminanceCoefficients:function(i,a=this.workingColorSpace){return i.fromArray(this.spaces[a].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,a,s){return i.copy(this.spaces[a].toXYZ).multiply(this.spaces[s].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return r.define({[is]:{primaries:e,whitePoint:n,transfer:Jg,toXYZ:hO,fromXYZ:fO,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:ft},outputColorSpaceConfig:{drawingBufferColorSpace:ft}},[ft]:{primaries:e,whitePoint:n,transfer:en,toXYZ:hO,fromXYZ:fO,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:ft}}}),r}const Dt=tZ();function zs(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function dc(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}let Eu;class nZ{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{Eu===void 0&&(Eu=Zf("canvas")),Eu.width=e.width,Eu.height=e.height;const i=Eu.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),n=Eu}return n.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Zf("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),a=i.data;for(let s=0;s<a.length;s++)a[s]=zs(a[s]/255)*255;return n.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(zs(t[n]/255)*255):t[n]=zs(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let rZ=0;class $A{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:rZ++}),this.uuid=Gs(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let a;if(Array.isArray(i)){a=[];for(let s=0,o=i.length;s<o;s++)i[s].isDataTexture?a.push(BT(i[s].image)):a.push(BT(i[s]))}else a=BT(i);n.url=a}return t||(e.images[this.uuid]=n),n}}function BT(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?nZ.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let iZ=0;class ar extends to{constructor(e=ar.DEFAULT_IMAGE,t=ar.DEFAULT_MAPPING,n=ts,i=ts,a=ir,s=fi,o=On,l=In,u=ar.DEFAULT_ANISOTROPY,c=Bi){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:iZ++}),this.uuid=Gs(),this.name="",this.source=new $A(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=a,this.minFilter=s,this.anisotropy=u,this.format=o,this.internalFormat=null,this.type=l,this.offset=new He(0,0),this.repeat=new He(1,1),this.center=new He(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Et,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==DA)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case jl:e.x=e.x-Math.floor(e.x);break;case ts:e.x=e.x<0?0:1;break;case Kl:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case jl:e.y=e.y-Math.floor(e.y);break;case ts:e.y=e.y<0?0:1;break;case Kl:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}ar.DEFAULT_IMAGE=null;ar.DEFAULT_MAPPING=DA;ar.DEFAULT_ANISOTROPY=1;class xt{constructor(e=0,t=0,n=0,i=1){xt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,a=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i+s[12]*a,this.y=s[1]*t+s[5]*n+s[9]*i+s[13]*a,this.z=s[2]*t+s[6]*n+s[10]*i+s[14]*a,this.w=s[3]*t+s[7]*n+s[11]*i+s[15]*a,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,a;const l=e.elements,u=l[0],c=l[4],h=l[8],d=l[1],f=l[5],p=l[9],m=l[2],v=l[6],g=l[10];if(Math.abs(c-d)<.01&&Math.abs(h-m)<.01&&Math.abs(p-v)<.01){if(Math.abs(c+d)<.1&&Math.abs(h+m)<.1&&Math.abs(p+v)<.1&&Math.abs(u+f+g-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const _=(u+1)/2,x=(f+1)/2,E=(g+1)/2,T=(c+d)/4,b=(h+m)/4,w=(p+v)/4;return _>x&&_>E?_<.01?(n=0,i=.707106781,a=.707106781):(n=Math.sqrt(_),i=T/n,a=b/n):x>E?x<.01?(n=.707106781,i=0,a=.707106781):(i=Math.sqrt(x),n=T/i,a=w/i):E<.01?(n=.707106781,i=.707106781,a=0):(a=Math.sqrt(E),n=b/a,i=w/a),this.set(n,i,a,t),this}let y=Math.sqrt((v-p)*(v-p)+(h-m)*(h-m)+(d-c)*(d-c));return Math.abs(y)<.001&&(y=1),this.x=(v-p)/y,this.y=(h-m)/y,this.z=(d-c)/y,this.w=Math.acos((u+f+g-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Ct(this.x,e.x,t.x),this.y=Ct(this.y,e.y,t.y),this.z=Ct(this.z,e.z,t.z),this.w=Ct(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Ct(this.x,e,t),this.y=Ct(this.y,e,t),this.z=Ct(this.z,e,t),this.w=Ct(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Ct(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class ou extends to{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new xt(0,0,e,t),this.scissorTest=!1,this.viewport=new xt(0,0,e,t);const i={width:e,height:t,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ir,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const a=new ar(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);a.flipY=!1,a.generateMipmaps=n.generateMipmaps,a.internalFormat=n.internalFormat,this.textures=[];const s=n.count;for(let o=0;o<s;o++)this.textures[o]=a.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,a=this.textures.length;i<a;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const i=Object.assign({},e.textures[t].image);this.textures[t].source=new $A(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Xo extends ou{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class XA extends ar{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=mn,this.minFilter=mn,this.wrapR=ts,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class aZ extends ar{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=mn,this.minFilter=mn,this.wrapR=ts,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ua{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,a,s,o){let l=n[i+0],u=n[i+1],c=n[i+2],h=n[i+3];const d=a[s+0],f=a[s+1],p=a[s+2],m=a[s+3];if(o===0){e[t+0]=l,e[t+1]=u,e[t+2]=c,e[t+3]=h;return}if(o===1){e[t+0]=d,e[t+1]=f,e[t+2]=p,e[t+3]=m;return}if(h!==m||l!==d||u!==f||c!==p){let v=1-o;const g=l*d+u*f+c*p+h*m,y=g>=0?1:-1,_=1-g*g;if(_>Number.EPSILON){const E=Math.sqrt(_),T=Math.atan2(E,g*y);v=Math.sin(v*T)/E,o=Math.sin(o*T)/E}const x=o*y;if(l=l*v+d*x,u=u*v+f*x,c=c*v+p*x,h=h*v+m*x,v===1-o){const E=1/Math.sqrt(l*l+u*u+c*c+h*h);l*=E,u*=E,c*=E,h*=E}}e[t]=l,e[t+1]=u,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,i,a,s){const o=n[i],l=n[i+1],u=n[i+2],c=n[i+3],h=a[s],d=a[s+1],f=a[s+2],p=a[s+3];return e[t]=o*p+c*h+l*f-u*d,e[t+1]=l*p+c*d+u*h-o*f,e[t+2]=u*p+c*f+o*d-l*h,e[t+3]=c*p-o*h-l*d-u*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,i=e._y,a=e._z,s=e._order,o=Math.cos,l=Math.sin,u=o(n/2),c=o(i/2),h=o(a/2),d=l(n/2),f=l(i/2),p=l(a/2);switch(s){case"XYZ":this._x=d*c*h+u*f*p,this._y=u*f*h-d*c*p,this._z=u*c*p+d*f*h,this._w=u*c*h-d*f*p;break;case"YXZ":this._x=d*c*h+u*f*p,this._y=u*f*h-d*c*p,this._z=u*c*p-d*f*h,this._w=u*c*h+d*f*p;break;case"ZXY":this._x=d*c*h-u*f*p,this._y=u*f*h+d*c*p,this._z=u*c*p+d*f*h,this._w=u*c*h-d*f*p;break;case"ZYX":this._x=d*c*h-u*f*p,this._y=u*f*h+d*c*p,this._z=u*c*p-d*f*h,this._w=u*c*h+d*f*p;break;case"YZX":this._x=d*c*h+u*f*p,this._y=u*f*h+d*c*p,this._z=u*c*p-d*f*h,this._w=u*c*h-d*f*p;break;case"XZY":this._x=d*c*h-u*f*p,this._y=u*f*h-d*c*p,this._z=u*c*p+d*f*h,this._w=u*c*h+d*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],a=t[8],s=t[1],o=t[5],l=t[9],u=t[2],c=t[6],h=t[10],d=n+o+h;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(c-l)*f,this._y=(a-u)*f,this._z=(s-i)*f}else if(n>o&&n>h){const f=2*Math.sqrt(1+n-o-h);this._w=(c-l)/f,this._x=.25*f,this._y=(i+s)/f,this._z=(a+u)/f}else if(o>h){const f=2*Math.sqrt(1+o-n-h);this._w=(a-u)/f,this._x=(i+s)/f,this._y=.25*f,this._z=(l+c)/f}else{const f=2*Math.sqrt(1+h-n-o);this._w=(s-i)/f,this._x=(a+u)/f,this._y=(l+c)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ct(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,a=e._z,s=e._w,o=t._x,l=t._y,u=t._z,c=t._w;return this._x=n*c+s*o+i*u-a*l,this._y=i*c+s*l+a*o-n*u,this._z=a*c+s*u+n*l-i*o,this._w=s*c-n*o-i*l-a*u,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,i=this._y,a=this._z,s=this._w;let o=s*e._w+n*e._x+i*e._y+a*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=s,this._x=n,this._y=i,this._z=a,this;const l=1-o*o;if(l<=Number.EPSILON){const f=1-t;return this._w=f*s+t*this._w,this._x=f*n+t*this._x,this._y=f*i+t*this._y,this._z=f*a+t*this._z,this.normalize(),this}const u=Math.sqrt(l),c=Math.atan2(u,o),h=Math.sin((1-t)*c)/u,d=Math.sin(t*c)/u;return this._w=s*h+this._w*d,this._x=n*h+this._x*d,this._y=i*h+this._y*d,this._z=a*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),a=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),a*Math.sin(t),a*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class re{constructor(e=0,t=0,n=0){re.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(dO.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(dO.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,a=e.elements;return this.x=a[0]*t+a[3]*n+a[6]*i,this.y=a[1]*t+a[4]*n+a[7]*i,this.z=a[2]*t+a[5]*n+a[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,a=e.elements,s=1/(a[3]*t+a[7]*n+a[11]*i+a[15]);return this.x=(a[0]*t+a[4]*n+a[8]*i+a[12])*s,this.y=(a[1]*t+a[5]*n+a[9]*i+a[13])*s,this.z=(a[2]*t+a[6]*n+a[10]*i+a[14])*s,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,a=e.x,s=e.y,o=e.z,l=e.w,u=2*(s*i-o*n),c=2*(o*t-a*i),h=2*(a*n-s*t);return this.x=t+l*u+s*h-o*c,this.y=n+l*c+o*u-a*h,this.z=i+l*h+a*c-s*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i,this.y=a[1]*t+a[5]*n+a[9]*i,this.z=a[2]*t+a[6]*n+a[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Ct(this.x,e.x,t.x),this.y=Ct(this.y,e.y,t.y),this.z=Ct(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Ct(this.x,e,t),this.y=Ct(this.y,e,t),this.z=Ct(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Ct(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,a=e.z,s=t.x,o=t.y,l=t.z;return this.x=i*l-a*o,this.y=a*s-n*l,this.z=n*o-i*s,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return UT.copy(this).projectOnVector(e),this.sub(UT)}reflect(e){return this.sub(UT.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Ct(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const UT=new re,dO=new Ua;class lu{constructor(e=new re(1/0,1/0,1/0),t=new re(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(va.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(va.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=va.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const a=n.getAttribute("position");if(t===!0&&a!==void 0&&e.isInstancedMesh!==!0)for(let s=0,o=a.count;s<o;s++)e.isMesh===!0?e.getVertexPosition(s,va):va.fromBufferAttribute(a,s),va.applyMatrix4(e.matrixWorld),this.expandByPoint(va);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),hp.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),hp.copy(n.boundingBox)),hp.applyMatrix4(e.matrixWorld),this.union(hp)}const i=e.children;for(let a=0,s=i.length;a<s;a++)this.expandByObject(i[a],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,va),va.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Ah),fp.subVectors(this.max,Ah),Tu.subVectors(e.a,Ah),wu.subVectors(e.b,Ah),Su.subVectors(e.c,Ah),co.subVectors(wu,Tu),ho.subVectors(Su,wu),cl.subVectors(Tu,Su);let t=[0,-co.z,co.y,0,-ho.z,ho.y,0,-cl.z,cl.y,co.z,0,-co.x,ho.z,0,-ho.x,cl.z,0,-cl.x,-co.y,co.x,0,-ho.y,ho.x,0,-cl.y,cl.x,0];return!kT(t,Tu,wu,Su,fp)||(t=[1,0,0,0,1,0,0,0,1],!kT(t,Tu,wu,Su,fp))?!1:(dp.crossVectors(co,ho),t=[dp.x,dp.y,dp.z],kT(t,Tu,wu,Su,fp))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,va).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(va).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(ms[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ms[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ms[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ms[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ms[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ms[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ms[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ms[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ms),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const ms=[new re,new re,new re,new re,new re,new re,new re,new re],va=new re,hp=new lu,Tu=new re,wu=new re,Su=new re,co=new re,ho=new re,cl=new re,Ah=new re,fp=new re,dp=new re,hl=new re;function kT(r,e,t,n,i){for(let a=0,s=r.length-3;a<=s;a+=3){hl.fromArray(r,a);const o=i.x*Math.abs(hl.x)+i.y*Math.abs(hl.y)+i.z*Math.abs(hl.z),l=e.dot(hl),u=t.dot(hl),c=n.dot(hl);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>o)return!1}return!0}const sZ=new lu,Mh=new re,GT=new re;class Dd{constructor(e=new re,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):sZ.setFromPoints(e).getCenter(n);let i=0;for(let a=0,s=e.length;a<s;a++)i=Math.max(i,n.distanceToSquared(e[a]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Mh.subVectors(e,this.center);const t=Mh.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.addScaledVector(Mh,i/n),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(GT.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Mh.copy(e.center).add(GT)),this.expandByPoint(Mh.copy(e.center).sub(GT))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const ys=new re,zT=new re,pp=new re,fo=new re,VT=new re,gp=new re,HT=new re;class lm{constructor(e=new re,t=new re(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ys)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ys.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ys.copy(this.origin).addScaledVector(this.direction,t),ys.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){zT.copy(e).add(t).multiplyScalar(.5),pp.copy(t).sub(e).normalize(),fo.copy(this.origin).sub(zT);const a=e.distanceTo(t)*.5,s=-this.direction.dot(pp),o=fo.dot(this.direction),l=-fo.dot(pp),u=fo.lengthSq(),c=Math.abs(1-s*s);let h,d,f,p;if(c>0)if(h=s*l-o,d=s*o-l,p=a*c,h>=0)if(d>=-p)if(d<=p){const m=1/c;h*=m,d*=m,f=h*(h+s*d+2*o)+d*(s*h+d+2*l)+u}else d=a,h=Math.max(0,-(s*d+o)),f=-h*h+d*(d+2*l)+u;else d=-a,h=Math.max(0,-(s*d+o)),f=-h*h+d*(d+2*l)+u;else d<=-p?(h=Math.max(0,-(-s*a+o)),d=h>0?-a:Math.min(Math.max(-a,-l),a),f=-h*h+d*(d+2*l)+u):d<=p?(h=0,d=Math.min(Math.max(-a,-l),a),f=d*(d+2*l)+u):(h=Math.max(0,-(s*a+o)),d=h>0?a:Math.min(Math.max(-a,-l),a),f=-h*h+d*(d+2*l)+u);else d=s>0?-a:a,h=Math.max(0,-(s*d+o)),f=-h*h+d*(d+2*l)+u;return n&&n.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(zT).addScaledVector(pp,d),f}intersectSphere(e,t){ys.subVectors(e.center,this.origin);const n=ys.dot(this.direction),i=ys.dot(ys)-n*n,a=e.radius*e.radius;if(i>a)return null;const s=Math.sqrt(a-i),o=n-s,l=n+s;return l<0?null:o<0?this.at(l,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,a,s,o,l;const u=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,d=this.origin;return u>=0?(n=(e.min.x-d.x)*u,i=(e.max.x-d.x)*u):(n=(e.max.x-d.x)*u,i=(e.min.x-d.x)*u),c>=0?(a=(e.min.y-d.y)*c,s=(e.max.y-d.y)*c):(a=(e.max.y-d.y)*c,s=(e.min.y-d.y)*c),n>s||a>i||((a>n||isNaN(n))&&(n=a),(s<i||isNaN(i))&&(i=s),h>=0?(o=(e.min.z-d.z)*h,l=(e.max.z-d.z)*h):(o=(e.max.z-d.z)*h,l=(e.min.z-d.z)*h),n>l||o>i)||((o>n||n!==n)&&(n=o),(l<i||i!==i)&&(i=l),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,ys)!==null}intersectTriangle(e,t,n,i,a){VT.subVectors(t,e),gp.subVectors(n,e),HT.crossVectors(VT,gp);let s=this.direction.dot(HT),o;if(s>0){if(i)return null;o=1}else if(s<0)o=-1,s=-s;else return null;fo.subVectors(this.origin,e);const l=o*this.direction.dot(gp.crossVectors(fo,gp));if(l<0)return null;const u=o*this.direction.dot(VT.cross(fo));if(u<0||l+u>s)return null;const c=-o*fo.dot(HT);return c<0?null:this.at(c/s,a)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ut{constructor(e,t,n,i,a,s,o,l,u,c,h,d,f,p,m,v){Ut.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,i,a,s,o,l,u,c,h,d,f,p,m,v)}set(e,t,n,i,a,s,o,l,u,c,h,d,f,p,m,v){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=a,g[5]=s,g[9]=o,g[13]=l,g[2]=u,g[6]=c,g[10]=h,g[14]=d,g[3]=f,g[7]=p,g[11]=m,g[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ut().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/Au.setFromMatrixColumn(e,0).length(),a=1/Au.setFromMatrixColumn(e,1).length(),s=1/Au.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,a=e.z,s=Math.cos(n),o=Math.sin(n),l=Math.cos(i),u=Math.sin(i),c=Math.cos(a),h=Math.sin(a);if(e.order==="XYZ"){const d=s*c,f=s*h,p=o*c,m=o*h;t[0]=l*c,t[4]=-l*h,t[8]=u,t[1]=f+p*u,t[5]=d-m*u,t[9]=-o*l,t[2]=m-d*u,t[6]=p+f*u,t[10]=s*l}else if(e.order==="YXZ"){const d=l*c,f=l*h,p=u*c,m=u*h;t[0]=d+m*o,t[4]=p*o-f,t[8]=s*u,t[1]=s*h,t[5]=s*c,t[9]=-o,t[2]=f*o-p,t[6]=m+d*o,t[10]=s*l}else if(e.order==="ZXY"){const d=l*c,f=l*h,p=u*c,m=u*h;t[0]=d-m*o,t[4]=-s*h,t[8]=p+f*o,t[1]=f+p*o,t[5]=s*c,t[9]=m-d*o,t[2]=-s*u,t[6]=o,t[10]=s*l}else if(e.order==="ZYX"){const d=s*c,f=s*h,p=o*c,m=o*h;t[0]=l*c,t[4]=p*u-f,t[8]=d*u+m,t[1]=l*h,t[5]=m*u+d,t[9]=f*u-p,t[2]=-u,t[6]=o*l,t[10]=s*l}else if(e.order==="YZX"){const d=s*l,f=s*u,p=o*l,m=o*u;t[0]=l*c,t[4]=m-d*h,t[8]=p*h+f,t[1]=h,t[5]=s*c,t[9]=-o*c,t[2]=-u*c,t[6]=f*h+p,t[10]=d-m*h}else if(e.order==="XZY"){const d=s*l,f=s*u,p=o*l,m=o*u;t[0]=l*c,t[4]=-h,t[8]=u*c,t[1]=d*h+m,t[5]=s*c,t[9]=f*h-p,t[2]=p*h-f,t[6]=o*c,t[10]=m*h+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(oZ,e,lZ)}lookAt(e,t,n){const i=this.elements;return Ci.subVectors(e,t),Ci.lengthSq()===0&&(Ci.z=1),Ci.normalize(),po.crossVectors(n,Ci),po.lengthSq()===0&&(Math.abs(n.z)===1?Ci.x+=1e-4:Ci.z+=1e-4,Ci.normalize(),po.crossVectors(n,Ci)),po.normalize(),vp.crossVectors(Ci,po),i[0]=po.x,i[4]=vp.x,i[8]=Ci.x,i[1]=po.y,i[5]=vp.y,i[9]=Ci.y,i[2]=po.z,i[6]=vp.z,i[10]=Ci.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,a=this.elements,s=n[0],o=n[4],l=n[8],u=n[12],c=n[1],h=n[5],d=n[9],f=n[13],p=n[2],m=n[6],v=n[10],g=n[14],y=n[3],_=n[7],x=n[11],E=n[15],T=i[0],b=i[4],w=i[8],A=i[12],S=i[1],C=i[5],R=i[9],P=i[13],M=i[2],N=i[6],D=i[10],I=i[14],L=i[3],z=i[7],B=i[11],k=i[15];return a[0]=s*T+o*S+l*M+u*L,a[4]=s*b+o*C+l*N+u*z,a[8]=s*w+o*R+l*D+u*B,a[12]=s*A+o*P+l*I+u*k,a[1]=c*T+h*S+d*M+f*L,a[5]=c*b+h*C+d*N+f*z,a[9]=c*w+h*R+d*D+f*B,a[13]=c*A+h*P+d*I+f*k,a[2]=p*T+m*S+v*M+g*L,a[6]=p*b+m*C+v*N+g*z,a[10]=p*w+m*R+v*D+g*B,a[14]=p*A+m*P+v*I+g*k,a[3]=y*T+_*S+x*M+E*L,a[7]=y*b+_*C+x*N+E*z,a[11]=y*w+_*R+x*D+E*B,a[15]=y*A+_*P+x*I+E*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],a=e[12],s=e[1],o=e[5],l=e[9],u=e[13],c=e[2],h=e[6],d=e[10],f=e[14],p=e[3],m=e[7],v=e[11],g=e[15];return p*(+a*l*h-i*u*h-a*o*d+n*u*d+i*o*f-n*l*f)+m*(+t*l*f-t*u*d+a*s*d-i*s*f+i*u*c-a*l*c)+v*(+t*u*h-t*o*f-a*s*h+n*s*f+a*o*c-n*u*c)+g*(-i*o*c-t*l*h+t*o*d+i*s*h-n*s*d+n*l*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],a=e[3],s=e[4],o=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12],m=e[13],v=e[14],g=e[15],y=h*v*u-m*d*u+m*l*f-o*v*f-h*l*g+o*d*g,_=p*d*u-c*v*u-p*l*f+s*v*f+c*l*g-s*d*g,x=c*m*u-p*h*u+p*o*f-s*m*f-c*o*g+s*h*g,E=p*h*l-c*m*l-p*o*d+s*m*d+c*o*v-s*h*v,T=t*y+n*_+i*x+a*E;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/T;return e[0]=y*b,e[1]=(m*d*a-h*v*a-m*i*f+n*v*f+h*i*g-n*d*g)*b,e[2]=(o*v*a-m*l*a+m*i*u-n*v*u-o*i*g+n*l*g)*b,e[3]=(h*l*a-o*d*a-h*i*u+n*d*u+o*i*f-n*l*f)*b,e[4]=_*b,e[5]=(c*v*a-p*d*a+p*i*f-t*v*f-c*i*g+t*d*g)*b,e[6]=(p*l*a-s*v*a-p*i*u+t*v*u+s*i*g-t*l*g)*b,e[7]=(s*d*a-c*l*a+c*i*u-t*d*u-s*i*f+t*l*f)*b,e[8]=x*b,e[9]=(p*h*a-c*m*a-p*n*f+t*m*f+c*n*g-t*h*g)*b,e[10]=(s*m*a-p*o*a+p*n*u-t*m*u-s*n*g+t*o*g)*b,e[11]=(c*o*a-s*h*a-c*n*u+t*h*u+s*n*f-t*o*f)*b,e[12]=E*b,e[13]=(c*m*i-p*h*i+p*n*d-t*m*d-c*n*v+t*h*v)*b,e[14]=(p*o*i-s*m*i-p*n*l+t*m*l+s*n*v-t*o*v)*b,e[15]=(s*h*i-c*o*i+c*n*l-t*h*l-s*n*d+t*o*d)*b,this}scale(e){const t=this.elements,n=e.x,i=e.y,a=e.z;return t[0]*=n,t[4]*=i,t[8]*=a,t[1]*=n,t[5]*=i,t[9]*=a,t[2]*=n,t[6]*=i,t[10]*=a,t[3]*=n,t[7]*=i,t[11]*=a,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),a=1-n,s=e.x,o=e.y,l=e.z,u=a*s,c=a*o;return this.set(u*s+n,u*o-i*l,u*l+i*o,0,u*o+i*l,c*o+n,c*l-i*s,0,u*l-i*o,c*l+i*s,a*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,a,s){return this.set(1,n,a,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,a=t._x,s=t._y,o=t._z,l=t._w,u=a+a,c=s+s,h=o+o,d=a*u,f=a*c,p=a*h,m=s*c,v=s*h,g=o*h,y=l*u,_=l*c,x=l*h,E=n.x,T=n.y,b=n.z;return i[0]=(1-(m+g))*E,i[1]=(f+x)*E,i[2]=(p-_)*E,i[3]=0,i[4]=(f-x)*T,i[5]=(1-(d+g))*T,i[6]=(v+y)*T,i[7]=0,i[8]=(p+_)*b,i[9]=(v-y)*b,i[10]=(1-(d+m))*b,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let a=Au.set(i[0],i[1],i[2]).length();const s=Au.set(i[4],i[5],i[6]).length(),o=Au.set(i[8],i[9],i[10]).length();this.determinant()<0&&(a=-a),e.x=i[12],e.y=i[13],e.z=i[14],ma.copy(this);const u=1/a,c=1/s,h=1/o;return ma.elements[0]*=u,ma.elements[1]*=u,ma.elements[2]*=u,ma.elements[4]*=c,ma.elements[5]*=c,ma.elements[6]*=c,ma.elements[8]*=h,ma.elements[9]*=h,ma.elements[10]*=h,t.setFromRotationMatrix(ma),n.x=a,n.y=s,n.z=o,this}makePerspective(e,t,n,i,a,s,o=di){const l=this.elements,u=2*a/(t-e),c=2*a/(n-i),h=(t+e)/(t-e),d=(n+i)/(n-i);let f,p;if(o===di)f=-(s+a)/(s-a),p=-2*s*a/(s-a);else if(o===$o)f=-s/(s-a),p=-s*a/(s-a);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return l[0]=u,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=c,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=p,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,i,a,s,o=di){const l=this.elements,u=1/(t-e),c=1/(n-i),h=1/(s-a),d=(t+e)*u,f=(n+i)*c;let p,m;if(o===di)p=(s+a)*h,m=-2*h;else if(o===$o)p=a*h,m=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return l[0]=2*u,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*c,l[9]=0,l[13]=-f,l[2]=0,l[6]=0,l[10]=m,l[14]=-p,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Au=new re,ma=new Ut,oZ=new re(0,0,0),lZ=new re(1,1,1),po=new re,vp=new re,Ci=new re,pO=new Ut,gO=new Ua;class Ei{constructor(e=0,t=0,n=0,i=Ei.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,a=i[0],s=i[4],o=i[8],l=i[1],u=i[5],c=i[9],h=i[2],d=i[6],f=i[10];switch(t){case"XYZ":this._y=Math.asin(Ct(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-s,a)):(this._x=Math.atan2(d,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Ct(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,f),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,a),this._z=0);break;case"ZXY":this._x=Math.asin(Ct(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-s,u)):(this._y=0,this._z=Math.atan2(l,a));break;case"ZYX":this._y=Math.asin(-Ct(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-s,u));break;case"YZX":this._z=Math.asin(Ct(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-h,a)):(this._x=0,this._y=Math.atan2(o,f));break;case"XZY":this._z=Math.asin(-Ct(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,u),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-c,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return pO.makeRotationFromQuaternion(e),this.setFromRotationMatrix(pO,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return gO.setFromEuler(this),this.setFromQuaternion(gO,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ei.DEFAULT_ORDER="XYZ";class YA{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let uZ=0;const vO=new re,Mu=new Ua,_s=new Ut,mp=new re,Ch=new re,cZ=new re,hZ=new Ua,mO=new re(1,0,0),yO=new re(0,1,0),_O=new re(0,0,1),xO={type:"added"},fZ={type:"removed"},Cu={type:"childadded",child:null},WT={type:"childremoved",child:null};class jn extends to{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:uZ++}),this.uuid=Gs(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=jn.DEFAULT_UP.clone();const e=new re,t=new Ei,n=new Ua,i=new re(1,1,1);function a(){n.setFromEuler(t,!1)}function s(){t.setFromQuaternion(n,void 0,!1)}t._onChange(a),n._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Ut},normalMatrix:{value:new Et}}),this.matrix=new Ut,this.matrixWorld=new Ut,this.matrixAutoUpdate=jn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=jn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new YA,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Mu.setFromAxisAngle(e,t),this.quaternion.multiply(Mu),this}rotateOnWorldAxis(e,t){return Mu.setFromAxisAngle(e,t),this.quaternion.premultiply(Mu),this}rotateX(e){return this.rotateOnAxis(mO,e)}rotateY(e){return this.rotateOnAxis(yO,e)}rotateZ(e){return this.rotateOnAxis(_O,e)}translateOnAxis(e,t){return vO.copy(e).applyQuaternion(this.quaternion),this.position.add(vO.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(mO,e)}translateY(e){return this.translateOnAxis(yO,e)}translateZ(e){return this.translateOnAxis(_O,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(_s.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?mp.copy(e):mp.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),Ch.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_s.lookAt(Ch,mp,this.up):_s.lookAt(mp,Ch,this.up),this.quaternion.setFromRotationMatrix(_s),i&&(_s.extractRotation(i.matrixWorld),Mu.setFromRotationMatrix(_s),this.quaternion.premultiply(Mu.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(xO),Cu.child=e,this.dispatchEvent(Cu),Cu.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(fZ),WT.child=e,this.dispatchEvent(WT),WT.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),_s.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),_s.multiply(e.parent.matrixWorld)),e.applyMatrix4(_s),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(xO),Cu.child=e,this.dispatchEvent(Cu),Cu.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const s=this.children[n].getObjectByProperty(e,t);if(s!==void 0)return s}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const i=this.children;for(let a=0,s=i.length;a<s;a++)i[a].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ch,e,cZ),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ch,hZ,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let a=0,s=i.length;a<s;a++)i[a].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function a(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=a(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let u=0,c=l.length;u<c;u++){const h=l[u];a(e.shapes,h)}else a(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(a(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,u=this.material.length;l<u;l++)o.push(a(e.materials,this.material[l]));i.material=o}else i.material=a(e.materials,this.material);if(this.children.length>0){i.children=[];for(let o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];i.animations.push(a(e.animations,l))}}if(t){const o=s(e.geometries),l=s(e.materials),u=s(e.textures),c=s(e.images),h=s(e.shapes),d=s(e.skeletons),f=s(e.animations),p=s(e.nodes);o.length>0&&(n.geometries=o),l.length>0&&(n.materials=l),u.length>0&&(n.textures=u),c.length>0&&(n.images=c),h.length>0&&(n.shapes=h),d.length>0&&(n.skeletons=d),f.length>0&&(n.animations=f),p.length>0&&(n.nodes=p)}return n.object=i,n;function s(o){const l=[];for(const u in o){const c=o[u];delete c.metadata,l.push(c)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const i=e.children[n];this.add(i.clone())}return this}}jn.DEFAULT_UP=new re(0,1,0);jn.DEFAULT_MATRIX_AUTO_UPDATE=!0;jn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ya=new re,xs=new re,qT=new re,bs=new re,Ru=new re,Nu=new re,bO=new re,$T=new re,XT=new re,YT=new re,jT=new xt,KT=new xt,QT=new xt;class Ca{constructor(e=new re,t=new re,n=new re){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),ya.subVectors(e,t),i.cross(ya);const a=i.lengthSq();return a>0?i.multiplyScalar(1/Math.sqrt(a)):i.set(0,0,0)}static getBarycoord(e,t,n,i,a){ya.subVectors(i,t),xs.subVectors(n,t),qT.subVectors(e,t);const s=ya.dot(ya),o=ya.dot(xs),l=ya.dot(qT),u=xs.dot(xs),c=xs.dot(qT),h=s*u-o*o;if(h===0)return a.set(0,0,0),null;const d=1/h,f=(u*l-o*c)*d,p=(s*c-o*l)*d;return a.set(1-f-p,p,f)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,bs)===null?!1:bs.x>=0&&bs.y>=0&&bs.x+bs.y<=1}static getInterpolation(e,t,n,i,a,s,o,l){return this.getBarycoord(e,t,n,i,bs)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(a,bs.x),l.addScaledVector(s,bs.y),l.addScaledVector(o,bs.z),l)}static getInterpolatedAttribute(e,t,n,i,a,s){return jT.setScalar(0),KT.setScalar(0),QT.setScalar(0),jT.fromBufferAttribute(e,t),KT.fromBufferAttribute(e,n),QT.fromBufferAttribute(e,i),s.setScalar(0),s.addScaledVector(jT,a.x),s.addScaledVector(KT,a.y),s.addScaledVector(QT,a.z),s}static isFrontFacing(e,t,n,i){return ya.subVectors(n,t),xs.subVectors(e,t),ya.cross(xs).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ya.subVectors(this.c,this.b),xs.subVectors(this.a,this.b),ya.cross(xs).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ca.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ca.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,a){return Ca.getInterpolation(e,this.a,this.b,this.c,t,n,i,a)}containsPoint(e){return Ca.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ca.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,a=this.c;let s,o;Ru.subVectors(i,n),Nu.subVectors(a,n),$T.subVectors(e,n);const l=Ru.dot($T),u=Nu.dot($T);if(l<=0&&u<=0)return t.copy(n);XT.subVectors(e,i);const c=Ru.dot(XT),h=Nu.dot(XT);if(c>=0&&h<=c)return t.copy(i);const d=l*h-c*u;if(d<=0&&l>=0&&c<=0)return s=l/(l-c),t.copy(n).addScaledVector(Ru,s);YT.subVectors(e,a);const f=Ru.dot(YT),p=Nu.dot(YT);if(p>=0&&f<=p)return t.copy(a);const m=f*u-l*p;if(m<=0&&u>=0&&p<=0)return o=u/(u-p),t.copy(n).addScaledVector(Nu,o);const v=c*p-f*h;if(v<=0&&h-c>=0&&f-p>=0)return bO.subVectors(a,i),o=(h-c)/(h-c+(f-p)),t.copy(i).addScaledVector(bO,o);const g=1/(v+m+d);return s=m*g,o=d*g,t.copy(n).addScaledVector(Ru,s).addScaledVector(Nu,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const uz={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},go={h:0,s:0,l:0},yp={h:0,s:0,l:0};function ZT(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*6*(2/3-t):r}class ct{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=ft){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Dt.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=Dt.workingColorSpace){return this.r=e,this.g=t,this.b=n,Dt.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=Dt.workingColorSpace){if(e=WA(e,1),t=Ct(t,0,1),n=Ct(n,0,1),t===0)this.r=this.g=this.b=n;else{const a=n<=.5?n*(1+t):n+t-n*t,s=2*n-a;this.r=ZT(s,a,e+1/3),this.g=ZT(s,a,e),this.b=ZT(s,a,e-1/3)}return Dt.toWorkingColorSpace(this,i),this}setStyle(e,t=ft){function n(a){a!==void 0&&parseFloat(a)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let a;const s=i[1],o=i[2];switch(s){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(a[4]),this.setRGB(Math.min(255,parseInt(a[1],10))/255,Math.min(255,parseInt(a[2],10))/255,Math.min(255,parseInt(a[3],10))/255,t);if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(a[4]),this.setRGB(Math.min(100,parseInt(a[1],10))/100,Math.min(100,parseInt(a[2],10))/100,Math.min(100,parseInt(a[3],10))/100,t);break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return n(a[4]),this.setHSL(parseFloat(a[1])/360,parseFloat(a[2])/100,parseFloat(a[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const a=i[1],s=a.length;if(s===3)return this.setRGB(parseInt(a.charAt(0),16)/15,parseInt(a.charAt(1),16)/15,parseInt(a.charAt(2),16)/15,t);if(s===6)return this.setHex(parseInt(a,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=ft){const n=uz[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=zs(e.r),this.g=zs(e.g),this.b=zs(e.b),this}copyLinearToSRGB(e){return this.r=dc(e.r),this.g=dc(e.g),this.b=dc(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ft){return Dt.fromWorkingColorSpace(Ir.copy(this),e),Math.round(Ct(Ir.r*255,0,255))*65536+Math.round(Ct(Ir.g*255,0,255))*256+Math.round(Ct(Ir.b*255,0,255))}getHexString(e=ft){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Dt.workingColorSpace){Dt.fromWorkingColorSpace(Ir.copy(this),t);const n=Ir.r,i=Ir.g,a=Ir.b,s=Math.max(n,i,a),o=Math.min(n,i,a);let l,u;const c=(o+s)/2;if(o===s)l=0,u=0;else{const h=s-o;switch(u=c<=.5?h/(s+o):h/(2-s-o),s){case n:l=(i-a)/h+(i<a?6:0);break;case i:l=(a-n)/h+2;break;case a:l=(n-i)/h+4;break}l/=6}return e.h=l,e.s=u,e.l=c,e}getRGB(e,t=Dt.workingColorSpace){return Dt.fromWorkingColorSpace(Ir.copy(this),t),e.r=Ir.r,e.g=Ir.g,e.b=Ir.b,e}getStyle(e=ft){Dt.fromWorkingColorSpace(Ir.copy(this),e);const t=Ir.r,n=Ir.g,i=Ir.b;return e!==ft?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(e,t,n){return this.getHSL(go),this.setHSL(go.h+e,go.s+t,go.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(go),e.getHSL(yp);const n=pf(go.h,yp.h,t),i=pf(go.s,yp.s,t),a=pf(go.l,yp.l,t);return this.setHSL(n,i,a),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,a=e.elements;return this.r=a[0]*t+a[3]*n+a[6]*i,this.g=a[1]*t+a[4]*n+a[7]*i,this.b=a[2]*t+a[5]*n+a[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ir=new ct;ct.NAMES=uz;let dZ=0;class Vr extends to{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:dZ++}),this.uuid=Gs(),this.name="",this.type="Material",this.blending=aa,this.side=yi,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Of,this.blendDst=Ff,this.blendEquation=Br,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ct(0,0,0),this.blendAlpha=0,this.depthFunc=Ho,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Xw,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=El,this.stencilZFail=El,this.stencilZPass=El,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==aa&&(n.blending=this.blending),this.side!==yi&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==Of&&(n.blendSrc=this.blendSrc),this.blendDst!==Ff&&(n.blendDst=this.blendDst),this.blendEquation!==Br&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Ho&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Xw&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==El&&(n.stencilFail=this.stencilFail),this.stencilZFail!==El&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==El&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function i(a){const s=[];for(const o in a){const l=a[o];delete l.metadata,s.push(l)}return s}if(t){const a=i(e.textures),s=i(e.images);a.length>0&&(n.textures=a),s.length>0&&(n.images=s)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const i=t.length;n=new Array(i);for(let a=0;a!==i;++a)n[a]=t[a].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Za extends Vr{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ct(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ei,this.combine=Rd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Ns=pZ();function pZ(){const r=new ArrayBuffer(4),e=new Float32Array(r),t=new Uint32Array(r),n=new Uint32Array(512),i=new Uint32Array(512);for(let l=0;l<256;++l){const u=l-127;u<-27?(n[l]=0,n[l|256]=32768,i[l]=24,i[l|256]=24):u<-14?(n[l]=1024>>-u-14,n[l|256]=1024>>-u-14|32768,i[l]=-u-1,i[l|256]=-u-1):u<=15?(n[l]=u+15<<10,n[l|256]=u+15<<10|32768,i[l]=13,i[l|256]=13):u<128?(n[l]=31744,n[l|256]=64512,i[l]=24,i[l|256]=24):(n[l]=31744,n[l|256]=64512,i[l]=13,i[l|256]=13)}const a=new Uint32Array(2048),s=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let u=l<<13,c=0;for(;(u&8388608)===0;)u<<=1,c-=8388608;u&=-8388609,c+=947912704,a[l]=u|c}for(let l=1024;l<2048;++l)a[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)s[l]=l<<23;s[31]=1199570944,s[32]=2147483648;for(let l=33;l<63;++l)s[l]=2147483648+(l-32<<23);s[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:i,mantissaTable:a,exponentTable:s,offsetTable:o}}function Ri(r){Math.abs(r)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),r=Ct(r,-65504,65504),Ns.floatView[0]=r;const e=Ns.uint32View[0],t=e>>23&511;return Ns.baseTable[t]+((e&8388607)>>Ns.shiftTable[t])}function _p(r){const e=r>>10;return Ns.uint32View[0]=Ns.mantissaTable[Ns.offsetTable[e]+(r&1023)]+Ns.exponentTable[e],Ns.floatView[0]}const Vn=new re,xp=new He;let gZ=0;class Rr{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:gZ++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=ev,this.updateRanges=[],this.gpuType=Un,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,a=this.itemSize;i<a;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)xp.fromBufferAttribute(this,t),xp.applyMatrix3(e),this.setXY(t,xp.x,xp.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Vn.fromBufferAttribute(this,t),Vn.applyMatrix3(e),this.setXYZ(t,Vn.x,Vn.y,Vn.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Vn.fromBufferAttribute(this,t),Vn.applyMatrix4(e),this.setXYZ(t,Vn.x,Vn.y,Vn.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Vn.fromBufferAttribute(this,t),Vn.applyNormalMatrix(e),this.setXYZ(t,Vn.x,Vn.y,Vn.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Vn.fromBufferAttribute(this,t),Vn.transformDirection(e),this.setXYZ(t,Vn.x,Vn.y,Vn.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Zr(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Mt(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Zr(t,this.array)),t}setX(e,t){return this.normalized&&(t=Mt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Zr(t,this.array)),t}setY(e,t){return this.normalized&&(t=Mt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Zr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Mt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Zr(t,this.array)),t}setW(e,t){return this.normalized&&(t=Mt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Mt(t,this.array),n=Mt(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Mt(t,this.array),n=Mt(n,this.array),i=Mt(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,a){return e*=this.itemSize,this.normalized&&(t=Mt(t,this.array),n=Mt(n,this.array),i=Mt(i,this.array),a=Mt(a,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=a,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==ev&&(e.usage=this.usage),e}}class jA extends Rr{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class KA extends Rr{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class cz extends Rr{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=_p(this.array[e*this.itemSize]);return this.normalized&&(t=Zr(t,this.array)),t}setX(e,t){return this.normalized&&(t=Mt(t,this.array)),this.array[e*this.itemSize]=Ri(t),this}getY(e){let t=_p(this.array[e*this.itemSize+1]);return this.normalized&&(t=Zr(t,this.array)),t}setY(e,t){return this.normalized&&(t=Mt(t,this.array)),this.array[e*this.itemSize+1]=Ri(t),this}getZ(e){let t=_p(this.array[e*this.itemSize+2]);return this.normalized&&(t=Zr(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Mt(t,this.array)),this.array[e*this.itemSize+2]=Ri(t),this}getW(e){let t=_p(this.array[e*this.itemSize+3]);return this.normalized&&(t=Zr(t,this.array)),t}setW(e,t){return this.normalized&&(t=Mt(t,this.array)),this.array[e*this.itemSize+3]=Ri(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Mt(t,this.array),n=Mt(n,this.array)),this.array[e+0]=Ri(t),this.array[e+1]=Ri(n),this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Mt(t,this.array),n=Mt(n,this.array),i=Mt(i,this.array)),this.array[e+0]=Ri(t),this.array[e+1]=Ri(n),this.array[e+2]=Ri(i),this}setXYZW(e,t,n,i,a){return e*=this.itemSize,this.normalized&&(t=Mt(t,this.array),n=Mt(n,this.array),i=Mt(i,this.array),a=Mt(a,this.array)),this.array[e+0]=Ri(t),this.array[e+1]=Ri(n),this.array[e+2]=Ri(i),this.array[e+3]=Ri(a),this}}class kn extends Rr{constructor(e,t,n){super(new Float32Array(e),t,n)}}let vZ=0;const Xi=new Ut,JT=new jn,Pu=new re,Ni=new lu,Rh=new lu,dr=new re;class ri extends to{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:vZ++}),this.uuid=Gs(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(qA(e)?KA:jA)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const a=new Et().getNormalMatrix(e);n.applyNormalMatrix(a),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Xi.makeRotationFromQuaternion(e),this.applyMatrix4(Xi),this}rotateX(e){return Xi.makeRotationX(e),this.applyMatrix4(Xi),this}rotateY(e){return Xi.makeRotationY(e),this.applyMatrix4(Xi),this}rotateZ(e){return Xi.makeRotationZ(e),this.applyMatrix4(Xi),this}translate(e,t,n){return Xi.makeTranslation(e,t,n),this.applyMatrix4(Xi),this}scale(e,t,n){return Xi.makeScale(e,t,n),this.applyMatrix4(Xi),this}lookAt(e){return JT.lookAt(e),JT.updateMatrix(),this.applyMatrix4(JT.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Pu).negate(),this.translate(Pu.x,Pu.y,Pu.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let i=0,a=e.length;i<a;i++){const s=e[i];n.push(s.x,s.y,s.z||0)}this.setAttribute("position",new kn(n,3))}else{const n=Math.min(e.length,t.count);for(let i=0;i<n;i++){const a=e[i];t.setXYZ(i,a.x,a.y,a.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new lu);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new re(-1/0,-1/0,-1/0),new re(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const a=t[n];Ni.setFromBufferAttribute(a),this.morphTargetsRelative?(dr.addVectors(this.boundingBox.min,Ni.min),this.boundingBox.expandByPoint(dr),dr.addVectors(this.boundingBox.max,Ni.max),this.boundingBox.expandByPoint(dr)):(this.boundingBox.expandByPoint(Ni.min),this.boundingBox.expandByPoint(Ni.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Dd);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new re,1/0);return}if(e){const n=this.boundingSphere.center;if(Ni.setFromBufferAttribute(e),t)for(let a=0,s=t.length;a<s;a++){const o=t[a];Rh.setFromBufferAttribute(o),this.morphTargetsRelative?(dr.addVectors(Ni.min,Rh.min),Ni.expandByPoint(dr),dr.addVectors(Ni.max,Rh.max),Ni.expandByPoint(dr)):(Ni.expandByPoint(Rh.min),Ni.expandByPoint(Rh.max))}Ni.getCenter(n);let i=0;for(let a=0,s=e.count;a<s;a++)dr.fromBufferAttribute(e,a),i=Math.max(i,n.distanceToSquared(dr));if(t)for(let a=0,s=t.length;a<s;a++){const o=t[a],l=this.morphTargetsRelative;for(let u=0,c=o.count;u<c;u++)dr.fromBufferAttribute(o,u),l&&(Pu.fromBufferAttribute(e,u),dr.add(Pu)),i=Math.max(i,n.distanceToSquared(dr))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,i=t.normal,a=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Rr(new Float32Array(4*n.count),4));const s=this.getAttribute("tangent"),o=[],l=[];for(let w=0;w<n.count;w++)o[w]=new re,l[w]=new re;const u=new re,c=new re,h=new re,d=new He,f=new He,p=new He,m=new re,v=new re;function g(w,A,S){u.fromBufferAttribute(n,w),c.fromBufferAttribute(n,A),h.fromBufferAttribute(n,S),d.fromBufferAttribute(a,w),f.fromBufferAttribute(a,A),p.fromBufferAttribute(a,S),c.sub(u),h.sub(u),f.sub(d),p.sub(d);const C=1/(f.x*p.y-p.x*f.y);!isFinite(C)||(m.copy(c).multiplyScalar(p.y).addScaledVector(h,-f.y).multiplyScalar(C),v.copy(h).multiplyScalar(f.x).addScaledVector(c,-p.x).multiplyScalar(C),o[w].add(m),o[A].add(m),o[S].add(m),l[w].add(v),l[A].add(v),l[S].add(v))}let y=this.groups;y.length===0&&(y=[{start:0,count:e.count}]);for(let w=0,A=y.length;w<A;++w){const S=y[w],C=S.start,R=S.count;for(let P=C,M=C+R;P<M;P+=3)g(e.getX(P+0),e.getX(P+1),e.getX(P+2))}const _=new re,x=new re,E=new re,T=new re;function b(w){E.fromBufferAttribute(i,w),T.copy(E);const A=o[w];_.copy(A),_.sub(E.multiplyScalar(E.dot(A))).normalize(),x.crossVectors(T,A);const C=x.dot(l[w])<0?-1:1;s.setXYZW(w,_.x,_.y,_.z,C)}for(let w=0,A=y.length;w<A;++w){const S=y[w],C=S.start,R=S.count;for(let P=C,M=C+R;P<M;P+=3)b(e.getX(P+0)),b(e.getX(P+1)),b(e.getX(P+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Rr(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let d=0,f=n.count;d<f;d++)n.setXYZ(d,0,0,0);const i=new re,a=new re,s=new re,o=new re,l=new re,u=new re,c=new re,h=new re;if(e)for(let d=0,f=e.count;d<f;d+=3){const p=e.getX(d+0),m=e.getX(d+1),v=e.getX(d+2);i.fromBufferAttribute(t,p),a.fromBufferAttribute(t,m),s.fromBufferAttribute(t,v),c.subVectors(s,a),h.subVectors(i,a),c.cross(h),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,m),u.fromBufferAttribute(n,v),o.add(c),l.add(c),u.add(c),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(m,l.x,l.y,l.z),n.setXYZ(v,u.x,u.y,u.z)}else for(let d=0,f=t.count;d<f;d+=3)i.fromBufferAttribute(t,d+0),a.fromBufferAttribute(t,d+1),s.fromBufferAttribute(t,d+2),c.subVectors(s,a),h.subVectors(i,a),c.cross(h),n.setXYZ(d+0,c.x,c.y,c.z),n.setXYZ(d+1,c.x,c.y,c.z),n.setXYZ(d+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)dr.fromBufferAttribute(e,t),dr.normalize(),e.setXYZ(t,dr.x,dr.y,dr.z)}toNonIndexed(){function e(o,l){const u=o.array,c=o.itemSize,h=o.normalized,d=new u.constructor(l.length*c);let f=0,p=0;for(let m=0,v=l.length;m<v;m++){o.isInterleavedBufferAttribute?f=l[m]*o.data.stride+o.offset:f=l[m]*c;for(let g=0;g<c;g++)d[p++]=u[f++]}return new Rr(d,c,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new ri,n=this.index.array,i=this.attributes;for(const o in i){const l=i[o],u=e(l,n);t.setAttribute(o,u)}const a=this.morphAttributes;for(const o in a){const l=[],u=a[o];for(let c=0,h=u.length;c<h;c++){const d=u[c],f=e(d,n);l.push(f)}t.morphAttributes[o]=l}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let o=0,l=s.length;o<l;o++){const u=s[o];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const u in l)l[u]!==void 0&&(e[u]=l[u]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const u=n[l];e.data.attributes[l]=u.toJSON(e.data)}const i={};let a=!1;for(const l in this.morphAttributes){const u=this.morphAttributes[l],c=[];for(let h=0,d=u.length;h<d;h++){const f=u[h];c.push(f.toJSON(e.data))}c.length>0&&(i[l]=c,a=!0)}a&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const i=e.attributes;for(const u in i){const c=i[u];this.setAttribute(u,c.clone(t))}const a=e.morphAttributes;for(const u in a){const c=[],h=a[u];for(let d=0,f=h.length;d<f;d++)c.push(h[d].clone(t));this.morphAttributes[u]=c}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let u=0,c=s.length;u<c;u++){const h=s[u];this.addGroup(h.start,h.count,h.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const EO=new Ut,fl=new lm,bp=new Dd,TO=new re,Ep=new re,Tp=new re,wp=new re,e1=new re,Sp=new re,wO=new re,Ap=new re;class Yn extends jn{constructor(e=new ri,t=new Za){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,s=i.length;a<s;a++){const o=i[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=a}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,a=n.morphAttributes.position,s=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const o=this.morphTargetInfluences;if(a&&o){Sp.set(0,0,0);for(let l=0,u=a.length;l<u;l++){const c=o[l],h=a[l];c!==0&&(e1.fromBufferAttribute(h,e),s?Sp.addScaledVector(e1,c):Sp.addScaledVector(e1.sub(t),c))}t.add(Sp)}return t}raycast(e,t){const n=this.geometry,i=this.material,a=this.matrixWorld;i!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),bp.copy(n.boundingSphere),bp.applyMatrix4(a),fl.copy(e.ray).recast(e.near),!(bp.containsPoint(fl.origin)===!1&&(fl.intersectSphere(bp,TO)===null||fl.origin.distanceToSquared(TO)>(e.far-e.near)**2))&&(EO.copy(a).invert(),fl.copy(e.ray).applyMatrix4(EO),!(n.boundingBox!==null&&fl.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,fl)))}_computeIntersections(e,t,n){let i;const a=this.geometry,s=this.material,o=a.index,l=a.attributes.position,u=a.attributes.uv,c=a.attributes.uv1,h=a.attributes.normal,d=a.groups,f=a.drawRange;if(o!==null)if(Array.isArray(s))for(let p=0,m=d.length;p<m;p++){const v=d[p],g=s[v.materialIndex],y=Math.max(v.start,f.start),_=Math.min(o.count,Math.min(v.start+v.count,f.start+f.count));for(let x=y,E=_;x<E;x+=3){const T=o.getX(x),b=o.getX(x+1),w=o.getX(x+2);i=Mp(this,g,e,n,u,c,h,T,b,w),i&&(i.faceIndex=Math.floor(x/3),i.face.materialIndex=v.materialIndex,t.push(i))}}else{const p=Math.max(0,f.start),m=Math.min(o.count,f.start+f.count);for(let v=p,g=m;v<g;v+=3){const y=o.getX(v),_=o.getX(v+1),x=o.getX(v+2);i=Mp(this,s,e,n,u,c,h,y,_,x),i&&(i.faceIndex=Math.floor(v/3),t.push(i))}}else if(l!==void 0)if(Array.isArray(s))for(let p=0,m=d.length;p<m;p++){const v=d[p],g=s[v.materialIndex],y=Math.max(v.start,f.start),_=Math.min(l.count,Math.min(v.start+v.count,f.start+f.count));for(let x=y,E=_;x<E;x+=3){const T=x,b=x+1,w=x+2;i=Mp(this,g,e,n,u,c,h,T,b,w),i&&(i.faceIndex=Math.floor(x/3),i.face.materialIndex=v.materialIndex,t.push(i))}}else{const p=Math.max(0,f.start),m=Math.min(l.count,f.start+f.count);for(let v=p,g=m;v<g;v+=3){const y=v,_=v+1,x=v+2;i=Mp(this,s,e,n,u,c,h,y,_,x),i&&(i.faceIndex=Math.floor(v/3),t.push(i))}}}}function mZ(r,e,t,n,i,a,s,o){let l;if(e.side===dn?l=n.intersectTriangle(s,a,i,!0,o):l=n.intersectTriangle(i,a,s,e.side===yi,o),l===null)return null;Ap.copy(o),Ap.applyMatrix4(r.matrixWorld);const u=t.ray.origin.distanceTo(Ap);return u<t.near||u>t.far?null:{distance:u,point:Ap.clone(),object:r}}function Mp(r,e,t,n,i,a,s,o,l,u){r.getVertexPosition(o,Ep),r.getVertexPosition(l,Tp),r.getVertexPosition(u,wp);const c=mZ(r,e,t,n,Ep,Tp,wp,wO);if(c){const h=new re;Ca.getBarycoord(wO,Ep,Tp,wp,h),i&&(c.uv=Ca.getInterpolatedAttribute(i,o,l,u,h,new He)),a&&(c.uv1=Ca.getInterpolatedAttribute(a,o,l,u,h,new He)),s&&(c.normal=Ca.getInterpolatedAttribute(s,o,l,u,h,new re),c.normal.dot(n.direction)>0&&c.normal.multiplyScalar(-1));const d={a:o,b:l,c:u,normal:new re,materialIndex:0};Ca.getNormal(Ep,Tp,wp,d.normal),c.face=d,c.barycoord=h}return c}class uu extends ri{constructor(e=1,t=1,n=1,i=1,a=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:a,depthSegments:s};const o=this;i=Math.floor(i),a=Math.floor(a),s=Math.floor(s);const l=[],u=[],c=[],h=[];let d=0,f=0;p("z","y","x",-1,-1,n,t,e,s,a,0),p("z","y","x",1,-1,n,t,-e,s,a,1),p("x","z","y",1,1,e,n,t,i,s,2),p("x","z","y",1,-1,e,n,-t,i,s,3),p("x","y","z",1,-1,e,t,n,i,a,4),p("x","y","z",-1,-1,e,t,-n,i,a,5),this.setIndex(l),this.setAttribute("position",new kn(u,3)),this.setAttribute("normal",new kn(c,3)),this.setAttribute("uv",new kn(h,2));function p(m,v,g,y,_,x,E,T,b,w,A){const S=x/b,C=E/w,R=x/2,P=E/2,M=T/2,N=b+1,D=w+1;let I=0,L=0;const z=new re;for(let B=0;B<D;B++){const k=B*C-P;for(let U=0;U<N;U++){const G=U*S-R;z[m]=G*y,z[v]=k*_,z[g]=M,u.push(z.x,z.y,z.z),z[m]=0,z[v]=0,z[g]=T>0?1:-1,c.push(z.x,z.y,z.z),h.push(U/b),h.push(1-B/w),I+=1}}for(let B=0;B<w;B++)for(let k=0;k<b;k++){const U=d+k+N*B,G=d+k+N*(B+1),O=d+(k+1)+N*(B+1),F=d+(k+1)+N*B;l.push(U,G,F),l.push(G,O,F),L+=6}o.addGroup(f,L,A),f+=L,d+=I}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new uu(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Hc(r){const e={};for(const t in r){e[t]={};for(const n in r[t]){const i=r[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function Yr(r){const e={};for(let t=0;t<r.length;t++){const n=Hc(r[t]);for(const i in n)e[i]=n[i]}return e}function yZ(r){const e=[];for(let t=0;t<r.length;t++)e.push(r[t].clone());return e}function hz(r){const e=r.getRenderTarget();return e===null?r.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Dt.workingColorSpace}const fz={clone:Hc,merge:Yr};var _Z=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,xZ=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ss extends Vr{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=_Z,this.fragmentShader=xZ,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Hc(e.uniforms),this.uniformsGroups=yZ(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const s=this.uniforms[i].value;s&&s.isTexture?t.uniforms[i]={type:"t",value:s.toJSON(e).uuid}:s&&s.isColor?t.uniforms[i]={type:"c",value:s.getHex()}:s&&s.isVector2?t.uniforms[i]={type:"v2",value:s.toArray()}:s&&s.isVector3?t.uniforms[i]={type:"v3",value:s.toArray()}:s&&s.isVector4?t.uniforms[i]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?t.uniforms[i]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?t.uniforms[i]={type:"m4",value:s.toArray()}:t.uniforms[i]={value:s}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class QA extends jn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ut,this.projectionMatrix=new Ut,this.projectionMatrixInverse=new Ut,this.coordinateSystem=di}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const vo=new re,SO=new He,AO=new He;class yr extends QA{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Zl*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(df*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Zl*2*Math.atan(Math.tan(df*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){vo.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(vo.x,vo.y).multiplyScalar(-e/vo.z),vo.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(vo.x,vo.y).multiplyScalar(-e/vo.z)}getViewSize(e,t){return this.getViewBounds(e,SO,AO),t.subVectors(AO,SO)}setViewOffset(e,t,n,i,a,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=a,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(df*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,a=-.5*i;const s=this.view;if(this.view!==null&&this.view.enabled){const l=s.fullWidth,u=s.fullHeight;a+=s.offsetX*i/l,t-=s.offsetY*n/u,i*=s.width/l,n*=s.height/u}const o=this.filmOffset;o!==0&&(a+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Du=-90,Lu=1;class dz extends jn{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new yr(Du,Lu,e,t);i.layers=this.layers,this.add(i);const a=new yr(Du,Lu,e,t);a.layers=this.layers,this.add(a);const s=new yr(Du,Lu,e,t);s.layers=this.layers,this.add(s);const o=new yr(Du,Lu,e,t);o.layers=this.layers,this.add(o);const l=new yr(Du,Lu,e,t);l.layers=this.layers,this.add(l);const u=new yr(Du,Lu,e,t);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,a,s,o,l]=t;for(const u of t)this.remove(u);if(e===di)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),a.up.set(0,0,-1),a.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===$o)n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),a.up.set(0,0,1),a.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const u of t)this.add(u),u.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[a,s,o,l,u,c]=this.children,h=e.getRenderTarget(),d=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const m=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,a),e.setRenderTarget(n,1,i),e.render(t,s),e.setRenderTarget(n,2,i),e.render(t,o),e.setRenderTarget(n,3,i),e.render(t,l),e.setRenderTarget(n,4,i),e.render(t,u),n.texture.generateMipmaps=m,e.setRenderTarget(n,5,i),e.render(t,c),e.setRenderTarget(h,d,f),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class um extends ar{constructor(e=[],t=la,n,i,a,s,o,l,u,c){super(e,t,n,i,a,s,o,l,u,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class pz extends Xo{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new um(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:ir}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new uu(5,5,5),a=new ss({name:"CubemapFromEquirect",uniforms:Hc(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:dn,blending:_i});a.uniforms.tEquirect.value=t;const s=new Yn(i,a),o=t.minFilter;return t.minFilter===fi&&(t.minFilter=ir),new dz(1,10,this).update(e,s),t.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(e,t=!0,n=!0,i=!0){const a=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,n,i);e.setRenderTarget(a)}}class ec extends jn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const bZ={type:"move"};class Tg{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ec,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ec,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new re,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new re),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ec,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new re,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new re),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,a=null,s=null;const o=this._targetRay,l=this._grip,u=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(u&&e.hand){s=!0;for(const m of e.hand.values()){const v=t.getJointPose(m,n),g=this._getHandJoint(u,m);v!==null&&(g.matrix.fromArray(v.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.matrixWorldNeedsUpdate=!0,g.jointRadius=v.radius),g.visible=v!==null}const c=u.joints["index-finger-tip"],h=u.joints["thumb-tip"],d=c.position.distanceTo(h.position),f=.02,p=.005;u.inputState.pinching&&d>f+p?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&d<=f-p&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(a=t.getPose(e.gripSpace,n),a!==null&&(l.matrix.fromArray(a.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,a.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(a.linearVelocity)):l.hasLinearVelocity=!1,a.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(a.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(i=t.getPose(e.targetRaySpace,n),i===null&&a!==null&&(i=a),i!==null&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(bZ)))}return o!==null&&(o.visible=i!==null),l!==null&&(l.visible=a!==null),u!==null&&(u.visible=s!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new ec;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class cm extends jn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Ei,this.environmentIntensity=1,this.environmentRotation=new Ei,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class gz{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=ev,this.updateRanges=[],this.version=0,this.uuid=Gs()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,a=this.stride;i<a;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Gs()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Gs()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Xr=new re;class ZA{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Xr.fromBufferAttribute(this,t),Xr.applyMatrix4(e),this.setXYZ(t,Xr.x,Xr.y,Xr.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Xr.fromBufferAttribute(this,t),Xr.applyNormalMatrix(e),this.setXYZ(t,Xr.x,Xr.y,Xr.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Xr.fromBufferAttribute(this,t),Xr.transformDirection(e),this.setXYZ(t,Xr.x,Xr.y,Xr.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=Zr(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Mt(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=Mt(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Mt(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Mt(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Mt(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Zr(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Zr(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Zr(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Zr(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Mt(t,this.array),n=Mt(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Mt(t,this.array),n=Mt(n,this.array),i=Mt(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,a){return e=e*this.data.stride+this.offset,this.normalized&&(t=Mt(t,this.array),n=Mt(n,this.array),i=Mt(i,this.array),a=Mt(a,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=a,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)t.push(this.data.array[i+a])}return new Rr(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ZA(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)t.push(this.data.array[i+a])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class EZ extends Vr{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ct(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class TZ extends ar{constructor(e=null,t=1,n=1,i,a,s,o,l,u=mn,c=mn,h,d){super(null,s,o,l,u,c,i,a,h,d),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class wZ extends Rr{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const t1=new re,SZ=new re,AZ=new Et;class Sa{constructor(e=new re(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=t1.subVectors(n,t).cross(SZ.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(t1),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const a=-(e.start.dot(this.normal)+this.constant)/i;return a<0||a>1?null:t.copy(e.start).addScaledVector(n,a)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||AZ.getNormalMatrix(e),i=this.coplanarPoint(t1).applyMatrix4(e),a=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(a),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const dl=new Dd,Cp=new re;class hm{constructor(e=new Sa,t=new Sa,n=new Sa,i=new Sa,a=new Sa,s=new Sa){this.planes=[e,t,n,i,a,s]}set(e,t,n,i,a,s){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(a),o[5].copy(s),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=di){const n=this.planes,i=e.elements,a=i[0],s=i[1],o=i[2],l=i[3],u=i[4],c=i[5],h=i[6],d=i[7],f=i[8],p=i[9],m=i[10],v=i[11],g=i[12],y=i[13],_=i[14],x=i[15];if(n[0].setComponents(l-a,d-u,v-f,x-g).normalize(),n[1].setComponents(l+a,d+u,v+f,x+g).normalize(),n[2].setComponents(l+s,d+c,v+p,x+y).normalize(),n[3].setComponents(l-s,d-c,v-p,x-y).normalize(),n[4].setComponents(l-o,d-h,v-m,x-_).normalize(),t===di)n[5].setComponents(l+o,d+h,v+m,x+_).normalize();else if(t===$o)n[5].setComponents(o,h,m,_).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),dl.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),dl.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(dl)}intersectsSprite(e){return dl.center.set(0,0,0),dl.radius=.7071067811865476,dl.applyMatrix4(e.matrixWorld),this.intersectsSphere(dl)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let a=0;a<6;a++)if(t[a].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(Cp.x=i.normal.x>0?e.max.x:e.min.x,Cp.y=i.normal.y>0?e.max.y:e.min.y,Cp.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Cp)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class fm extends Vr{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ct(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const nv=new re,rv=new re,MO=new Ut,Nh=new lm,Rp=new Dd,n1=new re,CO=new re;class MZ extends jn{constructor(e=new ri,t=new fm){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let i=1,a=t.count;i<a;i++)nv.fromBufferAttribute(t,i-1),rv.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=nv.distanceTo(rv);e.setAttribute("lineDistance",new kn(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,a=e.params.Line.threshold,s=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Rp.copy(n.boundingSphere),Rp.applyMatrix4(i),Rp.radius+=a,e.ray.intersectsSphere(Rp)===!1)return;MO.copy(i).invert(),Nh.copy(e.ray).applyMatrix4(MO);const o=a/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,u=this.isLineSegments?2:1,c=n.index,d=n.attributes.position;if(c!==null){const f=Math.max(0,s.start),p=Math.min(c.count,s.start+s.count);for(let m=f,v=p-1;m<v;m+=u){const g=c.getX(m),y=c.getX(m+1),_=Np(this,e,Nh,l,g,y,m);_&&t.push(_)}if(this.isLineLoop){const m=c.getX(p-1),v=c.getX(f),g=Np(this,e,Nh,l,m,v,p-1);g&&t.push(g)}}else{const f=Math.max(0,s.start),p=Math.min(d.count,s.start+s.count);for(let m=f,v=p-1;m<v;m+=u){const g=Np(this,e,Nh,l,m,m+1,m);g&&t.push(g)}if(this.isLineLoop){const m=Np(this,e,Nh,l,p-1,f,p-1);m&&t.push(m)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let a=0,s=i.length;a<s;a++){const o=i[a].name||String(a);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=a}}}}}function Np(r,e,t,n,i,a,s){const o=r.geometry.attributes.position;if(nv.fromBufferAttribute(o,i),rv.fromBufferAttribute(o,a),t.distanceSqToSegment(nv,rv,n1,CO)>n)return;n1.applyMatrix4(r.matrixWorld);const u=e.ray.origin.distanceTo(n1);if(!(u<e.near||u>e.far))return{distance:u,point:CO.clone().applyMatrix4(r.matrixWorld),index:s,face:null,faceIndex:null,barycoord:null,object:r}}class CZ extends Vr{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ct(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}class RZ extends ar{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=mn,this.minFilter=mn,this.generateMipmaps=!1,this.needsUpdate=!0}}class sa extends ar{constructor(e,t,n=hn,i,a,s,o=mn,l=mn,u,c=zi){if(c!==zi&&c!==Vi)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,i,a,s,o,l,c,n,u),this.isDepthTexture=!0,this.image={width:e,height:t},this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new $A(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class no{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),a=0;t.push(0);for(let s=1;s<=e;s++)n=this.getPoint(s/e),a+=n.distanceTo(i),t.push(a),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const n=this.getLengths();let i=0;const a=n.length;let s;t?s=t:s=e*n[a-1];let o=0,l=a-1,u;for(;o<=l;)if(i=Math.floor(o+(l-o)/2),u=n[i]-s,u<0)o=i+1;else if(u>0)l=i-1;else{l=i;break}if(i=l,n[i]===s)return i/(a-1);const c=n[i],d=n[i+1]-c,f=(s-c)/d;return(i+f)/(a-1)}getTangent(e,t){let i=e-1e-4,a=e+1e-4;i<0&&(i=0),a>1&&(a=1);const s=this.getPoint(i),o=this.getPoint(a),l=t||(s.isVector2?new He:new re);return l.copy(o).sub(s).normalize(),l}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t=!1){const n=new re,i=[],a=[],s=[],o=new re,l=new Ut;for(let f=0;f<=e;f++){const p=f/e;i[f]=this.getTangentAt(p,new re)}a[0]=new re,s[0]=new re;let u=Number.MAX_VALUE;const c=Math.abs(i[0].x),h=Math.abs(i[0].y),d=Math.abs(i[0].z);c<=u&&(u=c,n.set(1,0,0)),h<=u&&(u=h,n.set(0,1,0)),d<=u&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),a[0].crossVectors(i[0],o),s[0].crossVectors(i[0],a[0]);for(let f=1;f<=e;f++){if(a[f]=a[f-1].clone(),s[f]=s[f-1].clone(),o.crossVectors(i[f-1],i[f]),o.length()>Number.EPSILON){o.normalize();const p=Math.acos(Ct(i[f-1].dot(i[f]),-1,1));a[f].applyMatrix4(l.makeRotationAxis(o,p))}s[f].crossVectors(i[f],a[f])}if(t===!0){let f=Math.acos(Ct(a[0].dot(a[e]),-1,1));f/=e,i[0].dot(o.crossVectors(a[0],a[e]))>0&&(f=-f);for(let p=1;p<=e;p++)a[p].applyMatrix4(l.makeRotationAxis(i[p],f*p)),s[p].crossVectors(i[p],a[p])}return{tangents:i,normals:a,binormals:s}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class vz extends no{constructor(e=0,t=0,n=1,i=1,a=0,s=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=a,this.aEndAngle=s,this.aClockwise=o,this.aRotation=l}getPoint(e,t=new He){const n=t,i=Math.PI*2;let a=this.aEndAngle-this.aStartAngle;const s=Math.abs(a)<Number.EPSILON;for(;a<0;)a+=i;for(;a>i;)a-=i;a<Number.EPSILON&&(s?a=0:a=i),this.aClockwise===!0&&!s&&(a===i?a=-i:a=a-i);const o=this.aStartAngle+e*a;let l=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const c=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=l-this.aX,f=u-this.aY;l=d*c-f*h+this.aX,u=d*h+f*c+this.aY}return n.set(l,u)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class NZ extends vz{constructor(e,t,n,i,a,s){super(e,t,n,n,i,a,s),this.isArcCurve=!0,this.type="ArcCurve"}}function JA(){let r=0,e=0,t=0,n=0;function i(a,s,o,l){r=a,e=o,t=-3*a+3*s-2*o-l,n=2*a-2*s+o+l}return{initCatmullRom:function(a,s,o,l,u){i(s,o,u*(o-a),u*(l-s))},initNonuniformCatmullRom:function(a,s,o,l,u,c,h){let d=(s-a)/u-(o-a)/(u+c)+(o-s)/c,f=(o-s)/c-(l-s)/(c+h)+(l-o)/h;d*=c,f*=c,i(s,o,d,f)},calc:function(a){const s=a*a,o=s*a;return r+e*a+t*s+n*o}}}const Pp=new re,r1=new JA,i1=new JA,a1=new JA;class PZ extends no{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new re){const n=t,i=this.points,a=i.length,s=(a-(this.closed?0:1))*e;let o=Math.floor(s),l=s-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/a)+1)*a:l===0&&o===a-1&&(o=a-2,l=1);let u,c;this.closed||o>0?u=i[(o-1)%a]:(Pp.subVectors(i[0],i[1]).add(i[0]),u=Pp);const h=i[o%a],d=i[(o+1)%a];if(this.closed||o+2<a?c=i[(o+2)%a]:(Pp.subVectors(i[a-1],i[a-2]).add(i[a-1]),c=Pp),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let p=Math.pow(u.distanceToSquared(h),f),m=Math.pow(h.distanceToSquared(d),f),v=Math.pow(d.distanceToSquared(c),f);m<1e-4&&(m=1),p<1e-4&&(p=m),v<1e-4&&(v=m),r1.initNonuniformCatmullRom(u.x,h.x,d.x,c.x,p,m,v),i1.initNonuniformCatmullRom(u.y,h.y,d.y,c.y,p,m,v),a1.initNonuniformCatmullRom(u.z,h.z,d.z,c.z,p,m,v)}else this.curveType==="catmullrom"&&(r1.initCatmullRom(u.x,h.x,d.x,c.x,this.tension),i1.initCatmullRom(u.y,h.y,d.y,c.y,this.tension),a1.initCatmullRom(u.z,h.z,d.z,c.z,this.tension));return n.set(r1.calc(l),i1.calc(l),a1.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new re().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function RO(r,e,t,n,i){const a=(n-e)*.5,s=(i-t)*.5,o=r*r,l=r*o;return(2*t-2*n+a+s)*l+(-3*t+3*n-2*a-s)*o+a*r+t}function DZ(r,e){const t=1-r;return t*t*e}function LZ(r,e){return 2*(1-r)*r*e}function IZ(r,e){return r*r*e}function gf(r,e,t,n){return DZ(r,e)+LZ(r,t)+IZ(r,n)}function OZ(r,e){const t=1-r;return t*t*t*e}function FZ(r,e){const t=1-r;return 3*t*t*r*e}function BZ(r,e){return 3*(1-r)*r*r*e}function UZ(r,e){return r*r*r*e}function vf(r,e,t,n,i){return OZ(r,e)+FZ(r,t)+BZ(r,n)+UZ(r,i)}class kZ extends no{constructor(e=new He,t=new He,n=new He,i=new He){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new He){const n=t,i=this.v0,a=this.v1,s=this.v2,o=this.v3;return n.set(vf(e,i.x,a.x,s.x,o.x),vf(e,i.y,a.y,s.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class mz extends no{constructor(e=new re,t=new re,n=new re,i=new re){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new re){const n=t,i=this.v0,a=this.v1,s=this.v2,o=this.v3;return n.set(vf(e,i.x,a.x,s.x,o.x),vf(e,i.y,a.y,s.y,o.y),vf(e,i.z,a.z,s.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class GZ extends no{constructor(e=new He,t=new He){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new He){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new He){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class zZ extends no{constructor(e=new re,t=new re){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new re){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new re){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class VZ extends no{constructor(e=new He,t=new He,n=new He){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new He){const n=t,i=this.v0,a=this.v1,s=this.v2;return n.set(gf(e,i.x,a.x,s.x),gf(e,i.y,a.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class eM extends no{constructor(e=new re,t=new re,n=new re){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new re){const n=t,i=this.v0,a=this.v1,s=this.v2;return n.set(gf(e,i.x,a.x,s.x),gf(e,i.y,a.y,s.y),gf(e,i.z,a.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class HZ extends no{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new He){const n=t,i=this.points,a=(i.length-1)*e,s=Math.floor(a),o=a-s,l=i[s===0?s:s-1],u=i[s],c=i[s>i.length-2?i.length-1:s+1],h=i[s>i.length-3?i.length-1:s+2];return n.set(RO(o,l.x,u.x,c.x,h.x),RO(o,l.y,u.y,c.y,h.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new He().fromArray(i))}return this}}var WZ=Object.freeze({__proto__:null,ArcCurve:NZ,CatmullRomCurve3:PZ,CubicBezierCurve:kZ,CubicBezierCurve3:mz,EllipseCurve:vz,LineCurve:GZ,LineCurve3:zZ,QuadraticBezierCurve:VZ,QuadraticBezierCurve3:eM,SplineCurve:HZ});class Ld extends ri{constructor(e=1,t=1,n=1,i=32,a=1,s=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:a,openEnded:s,thetaStart:o,thetaLength:l};const u=this;i=Math.floor(i),a=Math.floor(a);const c=[],h=[],d=[],f=[];let p=0;const m=[],v=n/2;let g=0;y(),s===!1&&(e>0&&_(!0),t>0&&_(!1)),this.setIndex(c),this.setAttribute("position",new kn(h,3)),this.setAttribute("normal",new kn(d,3)),this.setAttribute("uv",new kn(f,2));function y(){const x=new re,E=new re;let T=0;const b=(t-e)/n;for(let w=0;w<=a;w++){const A=[],S=w/a,C=S*(t-e)+e;for(let R=0;R<=i;R++){const P=R/i,M=P*l+o,N=Math.sin(M),D=Math.cos(M);E.x=C*N,E.y=-S*n+v,E.z=C*D,h.push(E.x,E.y,E.z),x.set(N,b,D).normalize(),d.push(x.x,x.y,x.z),f.push(P,1-S),A.push(p++)}m.push(A)}for(let w=0;w<i;w++)for(let A=0;A<a;A++){const S=m[A][w],C=m[A+1][w],R=m[A+1][w+1],P=m[A][w+1];(e>0||A!==0)&&(c.push(S,C,P),T+=3),(t>0||A!==a-1)&&(c.push(C,R,P),T+=3)}u.addGroup(g,T,0),g+=T}function _(x){const E=p,T=new He,b=new re;let w=0;const A=x===!0?e:t,S=x===!0?1:-1;for(let R=1;R<=i;R++)h.push(0,v*S,0),d.push(0,S,0),f.push(.5,.5),p++;const C=p;for(let R=0;R<=i;R++){const M=R/i*l+o,N=Math.cos(M),D=Math.sin(M);b.x=A*D,b.y=v*S,b.z=A*N,h.push(b.x,b.y,b.z),d.push(0,S,0),T.x=N*.5+.5,T.y=D*.5*S+.5,f.push(T.x,T.y),p++}for(let R=0;R<i;R++){const P=E+R,M=C+R;x===!0?c.push(M,M+1,P):c.push(M+1,M,P),w+=3}u.addGroup(g,w,x===!0?1:2),g+=w}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ld(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class tM extends Ld{constructor(e=1,t=1,n=32,i=1,a=!1,s=0,o=Math.PI*2){super(0,e,t,n,i,a,s,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:a,thetaStart:s,thetaLength:o}}static fromJSON(e){return new tM(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Id extends ri{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const a=e/2,s=t/2,o=Math.floor(n),l=Math.floor(i),u=o+1,c=l+1,h=e/o,d=t/l,f=[],p=[],m=[],v=[];for(let g=0;g<c;g++){const y=g*d-s;for(let _=0;_<u;_++){const x=_*h-a;p.push(x,-y,0),m.push(0,0,1),v.push(_/o),v.push(1-g/l)}}for(let g=0;g<l;g++)for(let y=0;y<o;y++){const _=y+u*g,x=y+u*(g+1),E=y+1+u*(g+1),T=y+1+u*g;f.push(_,x,T),f.push(x,E,T)}this.setIndex(f),this.setAttribute("position",new kn(p,3)),this.setAttribute("normal",new kn(m,3)),this.setAttribute("uv",new kn(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Id(e.width,e.height,e.widthSegments,e.heightSegments)}}class Od extends ri{constructor(e=1,t=32,n=16,i=0,a=Math.PI*2,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:a,thetaStart:s,thetaLength:o},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const l=Math.min(s+o,Math.PI);let u=0;const c=[],h=new re,d=new re,f=[],p=[],m=[],v=[];for(let g=0;g<=n;g++){const y=[],_=g/n;let x=0;g===0&&s===0?x=.5/t:g===n&&l===Math.PI&&(x=-.5/t);for(let E=0;E<=t;E++){const T=E/t;h.x=-e*Math.cos(i+T*a)*Math.sin(s+_*o),h.y=e*Math.cos(s+_*o),h.z=e*Math.sin(i+T*a)*Math.sin(s+_*o),p.push(h.x,h.y,h.z),d.copy(h).normalize(),m.push(d.x,d.y,d.z),v.push(T+x,1-_),y.push(u++)}c.push(y)}for(let g=0;g<n;g++)for(let y=0;y<t;y++){const _=c[g][y+1],x=c[g][y],E=c[g+1][y],T=c[g+1][y+1];(g!==0||s>0)&&f.push(_,x,T),(g!==n-1||l<Math.PI)&&f.push(x,E,T)}this.setIndex(f),this.setAttribute("position",new kn(p,3)),this.setAttribute("normal",new kn(m,3)),this.setAttribute("uv",new kn(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Od(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class nM extends ri{constructor(e=new eM(new re(-1,-1,0),new re(-1,1,0),new re(1,1,0)),t=64,n=1,i=8,a=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:a};const s=e.computeFrenetFrames(t,a);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new re,l=new re,u=new He;let c=new re;const h=[],d=[],f=[],p=[];m(),this.setIndex(p),this.setAttribute("position",new kn(h,3)),this.setAttribute("normal",new kn(d,3)),this.setAttribute("uv",new kn(f,2));function m(){for(let _=0;_<t;_++)v(_);v(a===!1?t:0),y(),g()}function v(_){c=e.getPointAt(_/t,c);const x=s.normals[_],E=s.binormals[_];for(let T=0;T<=i;T++){const b=T/i*Math.PI*2,w=Math.sin(b),A=-Math.cos(b);l.x=A*x.x+w*E.x,l.y=A*x.y+w*E.y,l.z=A*x.z+w*E.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=c.x+n*l.x,o.y=c.y+n*l.y,o.z=c.z+n*l.z,h.push(o.x,o.y,o.z)}}function g(){for(let _=1;_<=t;_++)for(let x=1;x<=i;x++){const E=(i+1)*(_-1)+(x-1),T=(i+1)*_+(x-1),b=(i+1)*_+x,w=(i+1)*(_-1)+x;p.push(E,T,w),p.push(T,b,w)}}function y(){for(let _=0;_<=t;_++)for(let x=0;x<=i;x++)u.x=_/t,u.y=x/i,f.push(u.x,u.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new nM(new WZ[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class qZ extends Vr{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ct(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class yz extends Vr{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new ct(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Xs,this.normalScale=new He(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ei,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class $Z extends yz{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new He(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ct(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ct(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ct(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ct(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class XZ extends Vr{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ct(16777215),this.specular=new ct(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Xs,this.normalScale=new He(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ei,this.combine=Rd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class YZ extends Vr{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ct(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Xs,this.normalScale=new He(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class jZ extends Vr{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Xs,this.normalScale=new He(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class _z extends Vr{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ct(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ct(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Xs,this.normalScale=new He(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ei,this.combine=Rd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class KZ extends Vr{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=xQ,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class QZ extends Vr{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class ZZ extends Vr{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ct(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Xs,this.normalScale=new He(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class JZ extends fm{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}const NO={enabled:!1,files:{},add:function(r,e){this.enabled!==!1&&(this.files[r]=e)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class eJ{constructor(e,t,n){const i=this;let a=!1,s=0,o=0,l;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(c){o++,a===!1&&i.onStart!==void 0&&i.onStart(c,s,o),a=!0},this.itemEnd=function(c){s++,i.onProgress!==void 0&&i.onProgress(c,s,o),s===o&&(a=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(c){i.onError!==void 0&&i.onError(c)},this.resolveURL=function(c){return l?l(c):c},this.setURLModifier=function(c){return l=c,this},this.addHandler=function(c,h){return u.push(c,h),this},this.removeHandler=function(c){const h=u.indexOf(c);return h!==-1&&u.splice(h,2),this},this.getHandler=function(c){for(let h=0,d=u.length;h<d;h+=2){const f=u[h],p=u[h+1];if(f.global&&(f.lastIndex=0),f.test(c))return p}return null}}}const tJ=new eJ;class rM{constructor(e){this.manager=e!==void 0?e:tJ,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(i,a){n.load(e,i,t,a)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}rM.DEFAULT_MATERIAL_NAME="__DEFAULT";class nJ extends rM{constructor(e){super(e)}load(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,s=NO.get(e);if(s!==void 0)return a.manager.itemStart(e),setTimeout(function(){t&&t(s),a.manager.itemEnd(e)},0),s;const o=Zf("img");function l(){c(),NO.add(e,this),t&&t(this),a.manager.itemEnd(e)}function u(h){c(),i&&i(h),a.manager.itemError(e),a.manager.itemEnd(e)}function c(){o.removeEventListener("load",l,!1),o.removeEventListener("error",u,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",u,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),a.manager.itemStart(e),o.src=e,o}}class rJ extends rM{constructor(e){super(e)}load(e,t,n,i){const a=new ar,s=new nJ(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(o){a.image=o,a.needsUpdate=!0,t!==void 0&&t(a)},n,i),a}}class cu extends jn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new ct(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class iJ extends cu{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(jn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ct(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const s1=new Ut,PO=new re,DO=new re;class iM{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new He(512,512),this.map=null,this.mapPass=null,this.matrix=new Ut,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new hm,this._frameExtents=new He(1,1),this._viewportCount=1,this._viewports=[new xt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;PO.setFromMatrixPosition(e.matrixWorld),t.position.copy(PO),DO.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(DO),t.updateMatrixWorld(),s1.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(s1),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(s1)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class aJ extends iM{constructor(){super(new yr(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=Zl*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,a=e.distance||t.far;(n!==t.fov||i!==t.aspect||a!==t.far)&&(t.fov=n,t.aspect=i,t.far=a,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class xz extends cu{constructor(e,t,n=0,i=Math.PI/3,a=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(jn.DEFAULT_UP),this.updateMatrix(),this.target=new jn,this.distance=n,this.angle=i,this.penumbra=a,this.decay=s,this.map=null,this.shadow=new aJ}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const LO=new Ut,Ph=new re,o1=new re;class sJ extends iM{constructor(){super(new yr(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new He(4,2),this._viewportCount=6,this._viewports=[new xt(2,1,1,1),new xt(0,1,1,1),new xt(3,1,1,1),new xt(1,1,1,1),new xt(3,0,1,1),new xt(1,0,1,1)],this._cubeDirections=[new re(1,0,0),new re(-1,0,0),new re(0,0,1),new re(0,0,-1),new re(0,1,0),new re(0,-1,0)],this._cubeUps=[new re(0,1,0),new re(0,1,0),new re(0,1,0),new re(0,1,0),new re(0,0,1),new re(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,a=e.distance||n.far;a!==n.far&&(n.far=a,n.updateProjectionMatrix()),Ph.setFromMatrixPosition(e.matrixWorld),n.position.copy(Ph),o1.copy(n.position),o1.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(o1),n.updateMatrixWorld(),i.makeTranslation(-Ph.x,-Ph.y,-Ph.z),LO.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(LO)}}class oJ extends cu{constructor(e,t,n=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new sJ}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Fd extends QA{constructor(e=-1,t=1,n=1,i=-1,a=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=a,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,a,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=a,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let a=n-e,s=n+e,o=i+t,l=i-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=u*this.view.offsetX,s=a+u*this.view.width,o-=c*this.view.offsetY,l=o-c*this.view.height}this.projectionMatrix.makeOrthographic(a,s,o,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class lJ extends iM{constructor(){super(new Fd(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class bz extends cu{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(jn.DEFAULT_UP),this.updateMatrix(),this.target=new jn,this.shadow=new lJ}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Ez extends cu{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class uJ extends cu{constructor(e,t,n=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class cJ{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new re)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,a=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*i),t.addScaledVector(s[2],.488603*a),t.addScaledVector(s[3],.488603*n),t.addScaledVector(s[4],1.092548*(n*i)),t.addScaledVector(s[5],1.092548*(i*a)),t.addScaledVector(s[6],.315392*(3*a*a-1)),t.addScaledVector(s[7],1.092548*(n*a)),t.addScaledVector(s[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,a=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],2*.511664*i),t.addScaledVector(s[2],2*.511664*a),t.addScaledVector(s[3],2*.511664*n),t.addScaledVector(s[4],2*.429043*n*i),t.addScaledVector(s[5],2*.429043*i*a),t.addScaledVector(s[6],.743125*a*a-.247708),t.addScaledVector(s[7],2*.429043*n*a),t.addScaledVector(s[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){const n=e.x,i=e.y,a=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*a,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*a,t[6]=.315392*(3*a*a-1),t[7]=1.092548*n*a,t[8]=.546274*(n*n-i*i)}}class hJ extends cu{constructor(e=new cJ,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Tz extends yr{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e,this.index=0}}class wz{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=IO(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=IO();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function IO(){return performance.now()}class fJ extends gz{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}const OO=new Ut;class Sz{constructor(e,t,n=0,i=1/0){this.ray=new lm(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new YA,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return OO.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(OO),this}intersectObject(e,t=!0,n=[]){return Yw(e,this,n,t),n.sort(FO),n}intersectObjects(e,t=!0,n=[]){for(let i=0,a=e.length;i<a;i++)Yw(e[i],this,n,t);return n.sort(FO),n}}function FO(r,e){return r.distance-e.distance}function Yw(r,e,t,n){let i=!0;if(r.layers.test(e.layers)&&r.raycast(e,t)===!1&&(i=!1),i===!0&&n===!0){const a=r.children;for(let s=0,o=a.length;s<o;s++)Yw(a[s],e,t,!0)}}class BO{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Ct(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Ct(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class dm{constructor(e,t,n,i){dm.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,n,i)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,i){const a=this.elements;return a[0]=e,a[2]=t,a[1]=n,a[3]=i,this}}class pm extends to{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){console.warn("THREE.Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function UO(r,e,t,n){const i=dJ(n);switch(t){case IA:return r*e;case OA:return r*e;case FA:return r*e*2;case Pd:return r*e/i.components*i.byteLength;case lh:return r*e/i.components*i.byteLength;case Ql:return r*e*2/i.components*i.byteLength;case uh:return r*e*2/i.components*i.byteLength;case Nd:return r*e*3/i.components*i.byteLength;case On:return r*e*4/i.components*i.byteLength;case ch:return r*e*4/i.components*i.byteLength;case Bl:case Po:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case Do:case Lo:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case qf:case Xf:return Math.max(r,16)*Math.max(e,8)/4;case Wf:case $f:return Math.max(r,8)*Math.max(e,8)/2;case Yf:case Mc:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case Cc:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case Rc:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case Nc:return Math.floor((r+4)/5)*Math.floor((e+3)/4)*16;case Pc:return Math.floor((r+4)/5)*Math.floor((e+4)/5)*16;case Dc:return Math.floor((r+5)/6)*Math.floor((e+4)/5)*16;case Lc:return Math.floor((r+5)/6)*Math.floor((e+5)/6)*16;case Ic:return Math.floor((r+7)/8)*Math.floor((e+4)/5)*16;case Oc:return Math.floor((r+7)/8)*Math.floor((e+5)/6)*16;case Fc:return Math.floor((r+7)/8)*Math.floor((e+7)/8)*16;case Bc:return Math.floor((r+9)/10)*Math.floor((e+4)/5)*16;case Uc:return Math.floor((r+9)/10)*Math.floor((e+5)/6)*16;case kc:return Math.floor((r+9)/10)*Math.floor((e+7)/8)*16;case Gc:return Math.floor((r+9)/10)*Math.floor((e+9)/10)*16;case zc:return Math.floor((r+11)/12)*Math.floor((e+9)/10)*16;case Vc:return Math.floor((r+11)/12)*Math.floor((e+11)/12)*16;case Ul:case qw:case $w:return Math.ceil(r/4)*Math.ceil(e/4)*16;case BA:case jf:return Math.ceil(r/4)*Math.ceil(e/4)*8;case Kf:case Qf:return Math.ceil(r/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function dJ(r){switch(r){case In:case Ol:return{byteLength:1,components:1};case Pa:case Fl:case kr:return{byteLength:2,components:1};case rm:case im:return{byteLength:2,components:4};case hn:case mr:case Un:return{byteLength:4,components:1};case am:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${r}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:oh}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=oh);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function Az(){let r=null,e=!1,t=null,n=null;function i(a,s){t(a,s),n=r.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(n=r.requestAnimationFrame(i),e=!0)},stop:function(){r.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(a){t=a},setContext:function(a){r=a}}}function pJ(r){const e=new WeakMap;function t(o,l){const u=o.array,c=o.usage,h=u.byteLength,d=r.createBuffer();r.bindBuffer(l,d),r.bufferData(l,u,c),o.onUploadCallback();let f;if(u instanceof Float32Array)f=r.FLOAT;else if(u instanceof Uint16Array)o.isFloat16BufferAttribute?f=r.HALF_FLOAT:f=r.UNSIGNED_SHORT;else if(u instanceof Int16Array)f=r.SHORT;else if(u instanceof Uint32Array)f=r.UNSIGNED_INT;else if(u instanceof Int32Array)f=r.INT;else if(u instanceof Int8Array)f=r.BYTE;else if(u instanceof Uint8Array)f=r.UNSIGNED_BYTE;else if(u instanceof Uint8ClampedArray)f=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:d,type:f,bytesPerElement:u.BYTES_PER_ELEMENT,version:o.version,size:h}}function n(o,l,u){const c=l.array,h=l.updateRanges;if(r.bindBuffer(u,o),h.length===0)r.bufferSubData(u,0,c);else{h.sort((f,p)=>f.start-p.start);let d=0;for(let f=1;f<h.length;f++){const p=h[d],m=h[f];m.start<=p.start+p.count+1?p.count=Math.max(p.count,m.start+m.count-p.start):(++d,h[d]=m)}h.length=d+1;for(let f=0,p=h.length;f<p;f++){const m=h[f];r.bufferSubData(u,m.start*c.BYTES_PER_ELEMENT,c,m.start,m.count)}l.clearUpdateRanges()}l.onUploadCallback()}function i(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function a(o){o.isInterleavedBufferAttribute&&(o=o.data);const l=e.get(o);l&&(r.deleteBuffer(l.buffer),e.delete(o))}function s(o,l){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const c=e.get(o);(!c||c.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const u=e.get(o);if(u===void 0)e.set(o,t(o,l));else if(u.version<o.version){if(u.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(u.buffer,o,l),u.version=o.version}}return{get:i,remove:a,update:s}}var gJ=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,vJ=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,mJ=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,yJ=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,_J=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,xJ=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,bJ=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,EJ=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,TJ=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,wJ=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,SJ=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,AJ=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,MJ=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,CJ=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,RJ=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,NJ=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,PJ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,DJ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,LJ=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,IJ=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,OJ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,FJ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,BJ=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,UJ=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,kJ=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,GJ=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,zJ=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,VJ=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,HJ=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,WJ=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,qJ="gl_FragColor = linearToOutputTexel( gl_FragColor );",$J=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,XJ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,YJ=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,jJ=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,KJ=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,QJ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,ZJ=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,JJ=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,eee=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,tee=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,nee=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,ree=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,iee=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,aee=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,see=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,oee=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,lee=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,uee=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,cee=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,hee=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,fee=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,dee=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,pee=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,gee=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,vee=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,mee=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,yee=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,_ee=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,xee=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,bee=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Eee=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Tee=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,wee=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,See=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Aee=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Mee=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,Cee=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Ree=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Nee=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,Pee=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Dee=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,Lee=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Iee=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Oee=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Fee=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Bee=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Uee=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,kee=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Gee=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,zee=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Vee=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Hee=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Wee=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,qee=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,$ee=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Xee=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Yee=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,jee=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Kee=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,Qee=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Zee=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Jee=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,ete=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,tte=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,nte=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,rte=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,ite=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,ate=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,ste=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,ote=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,lte=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,ute=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,cte=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,hte=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,fte=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,dte=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const pte=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,gte=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vte=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,mte=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,yte=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,_te=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,xte=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,bte=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,Ete=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Tte=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,wte=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Ste=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Ate=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Mte=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Cte=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Rte=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Nte=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Pte=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Dte=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Lte=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Ite=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Ote=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Fte=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Bte=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Ute=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,kte=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Gte=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,zte=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Vte=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Hte=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Wte=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,qte=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,$te=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Xte=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Pt={alphahash_fragment:gJ,alphahash_pars_fragment:vJ,alphamap_fragment:mJ,alphamap_pars_fragment:yJ,alphatest_fragment:_J,alphatest_pars_fragment:xJ,aomap_fragment:bJ,aomap_pars_fragment:EJ,batching_pars_vertex:TJ,batching_vertex:wJ,begin_vertex:SJ,beginnormal_vertex:AJ,bsdfs:MJ,iridescence_fragment:CJ,bumpmap_pars_fragment:RJ,clipping_planes_fragment:NJ,clipping_planes_pars_fragment:PJ,clipping_planes_pars_vertex:DJ,clipping_planes_vertex:LJ,color_fragment:IJ,color_pars_fragment:OJ,color_pars_vertex:FJ,color_vertex:BJ,common:UJ,cube_uv_reflection_fragment:kJ,defaultnormal_vertex:GJ,displacementmap_pars_vertex:zJ,displacementmap_vertex:VJ,emissivemap_fragment:HJ,emissivemap_pars_fragment:WJ,colorspace_fragment:qJ,colorspace_pars_fragment:$J,envmap_fragment:XJ,envmap_common_pars_fragment:YJ,envmap_pars_fragment:jJ,envmap_pars_vertex:KJ,envmap_physical_pars_fragment:oee,envmap_vertex:QJ,fog_vertex:ZJ,fog_pars_vertex:JJ,fog_fragment:eee,fog_pars_fragment:tee,gradientmap_pars_fragment:nee,lightmap_pars_fragment:ree,lights_lambert_fragment:iee,lights_lambert_pars_fragment:aee,lights_pars_begin:see,lights_toon_fragment:lee,lights_toon_pars_fragment:uee,lights_phong_fragment:cee,lights_phong_pars_fragment:hee,lights_physical_fragment:fee,lights_physical_pars_fragment:dee,lights_fragment_begin:pee,lights_fragment_maps:gee,lights_fragment_end:vee,logdepthbuf_fragment:mee,logdepthbuf_pars_fragment:yee,logdepthbuf_pars_vertex:_ee,logdepthbuf_vertex:xee,map_fragment:bee,map_pars_fragment:Eee,map_particle_fragment:Tee,map_particle_pars_fragment:wee,metalnessmap_fragment:See,metalnessmap_pars_fragment:Aee,morphinstance_vertex:Mee,morphcolor_vertex:Cee,morphnormal_vertex:Ree,morphtarget_pars_vertex:Nee,morphtarget_vertex:Pee,normal_fragment_begin:Dee,normal_fragment_maps:Lee,normal_pars_fragment:Iee,normal_pars_vertex:Oee,normal_vertex:Fee,normalmap_pars_fragment:Bee,clearcoat_normal_fragment_begin:Uee,clearcoat_normal_fragment_maps:kee,clearcoat_pars_fragment:Gee,iridescence_pars_fragment:zee,opaque_fragment:Vee,packing:Hee,premultiplied_alpha_fragment:Wee,project_vertex:qee,dithering_fragment:$ee,dithering_pars_fragment:Xee,roughnessmap_fragment:Yee,roughnessmap_pars_fragment:jee,shadowmap_pars_fragment:Kee,shadowmap_pars_vertex:Qee,shadowmap_vertex:Zee,shadowmask_pars_fragment:Jee,skinbase_vertex:ete,skinning_pars_vertex:tte,skinning_vertex:nte,skinnormal_vertex:rte,specularmap_fragment:ite,specularmap_pars_fragment:ate,tonemapping_fragment:ste,tonemapping_pars_fragment:ote,transmission_fragment:lte,transmission_pars_fragment:ute,uv_pars_fragment:cte,uv_pars_vertex:hte,uv_vertex:fte,worldpos_vertex:dte,background_vert:pte,background_frag:gte,backgroundCube_vert:vte,backgroundCube_frag:mte,cube_vert:yte,cube_frag:_te,depth_vert:xte,depth_frag:bte,distanceRGBA_vert:Ete,distanceRGBA_frag:Tte,equirect_vert:wte,equirect_frag:Ste,linedashed_vert:Ate,linedashed_frag:Mte,meshbasic_vert:Cte,meshbasic_frag:Rte,meshlambert_vert:Nte,meshlambert_frag:Pte,meshmatcap_vert:Dte,meshmatcap_frag:Lte,meshnormal_vert:Ite,meshnormal_frag:Ote,meshphong_vert:Fte,meshphong_frag:Bte,meshphysical_vert:Ute,meshphysical_frag:kte,meshtoon_vert:Gte,meshtoon_frag:zte,points_vert:Vte,points_frag:Hte,shadow_vert:Wte,shadow_frag:qte,sprite_vert:$te,sprite_frag:Xte},it={common:{diffuse:{value:new ct(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Et},alphaMap:{value:null},alphaMapTransform:{value:new Et},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Et}},envmap:{envMap:{value:null},envMapRotation:{value:new Et},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Et}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Et}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Et},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Et},normalScale:{value:new He(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Et},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Et}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Et}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Et}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ct(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ct(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Et},alphaTest:{value:0},uvTransform:{value:new Et}},sprite:{diffuse:{value:new ct(16777215)},opacity:{value:1},center:{value:new He(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Et},alphaMap:{value:null},alphaMapTransform:{value:new Et},alphaTest:{value:0}}},Qa={basic:{uniforms:Yr([it.common,it.specularmap,it.envmap,it.aomap,it.lightmap,it.fog]),vertexShader:Pt.meshbasic_vert,fragmentShader:Pt.meshbasic_frag},lambert:{uniforms:Yr([it.common,it.specularmap,it.envmap,it.aomap,it.lightmap,it.emissivemap,it.bumpmap,it.normalmap,it.displacementmap,it.fog,it.lights,{emissive:{value:new ct(0)}}]),vertexShader:Pt.meshlambert_vert,fragmentShader:Pt.meshlambert_frag},phong:{uniforms:Yr([it.common,it.specularmap,it.envmap,it.aomap,it.lightmap,it.emissivemap,it.bumpmap,it.normalmap,it.displacementmap,it.fog,it.lights,{emissive:{value:new ct(0)},specular:{value:new ct(1118481)},shininess:{value:30}}]),vertexShader:Pt.meshphong_vert,fragmentShader:Pt.meshphong_frag},standard:{uniforms:Yr([it.common,it.envmap,it.aomap,it.lightmap,it.emissivemap,it.bumpmap,it.normalmap,it.displacementmap,it.roughnessmap,it.metalnessmap,it.fog,it.lights,{emissive:{value:new ct(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Pt.meshphysical_vert,fragmentShader:Pt.meshphysical_frag},toon:{uniforms:Yr([it.common,it.aomap,it.lightmap,it.emissivemap,it.bumpmap,it.normalmap,it.displacementmap,it.gradientmap,it.fog,it.lights,{emissive:{value:new ct(0)}}]),vertexShader:Pt.meshtoon_vert,fragmentShader:Pt.meshtoon_frag},matcap:{uniforms:Yr([it.common,it.bumpmap,it.normalmap,it.displacementmap,it.fog,{matcap:{value:null}}]),vertexShader:Pt.meshmatcap_vert,fragmentShader:Pt.meshmatcap_frag},points:{uniforms:Yr([it.points,it.fog]),vertexShader:Pt.points_vert,fragmentShader:Pt.points_frag},dashed:{uniforms:Yr([it.common,it.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Pt.linedashed_vert,fragmentShader:Pt.linedashed_frag},depth:{uniforms:Yr([it.common,it.displacementmap]),vertexShader:Pt.depth_vert,fragmentShader:Pt.depth_frag},normal:{uniforms:Yr([it.common,it.bumpmap,it.normalmap,it.displacementmap,{opacity:{value:1}}]),vertexShader:Pt.meshnormal_vert,fragmentShader:Pt.meshnormal_frag},sprite:{uniforms:Yr([it.sprite,it.fog]),vertexShader:Pt.sprite_vert,fragmentShader:Pt.sprite_frag},background:{uniforms:{uvTransform:{value:new Et},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Pt.background_vert,fragmentShader:Pt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Et}},vertexShader:Pt.backgroundCube_vert,fragmentShader:Pt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Pt.cube_vert,fragmentShader:Pt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Pt.equirect_vert,fragmentShader:Pt.equirect_frag},distanceRGBA:{uniforms:Yr([it.common,it.displacementmap,{referencePosition:{value:new re},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Pt.distanceRGBA_vert,fragmentShader:Pt.distanceRGBA_frag},shadow:{uniforms:Yr([it.lights,it.fog,{color:{value:new ct(0)},opacity:{value:1}}]),vertexShader:Pt.shadow_vert,fragmentShader:Pt.shadow_frag}};Qa.physical={uniforms:Yr([Qa.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Et},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Et},clearcoatNormalScale:{value:new He(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Et},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Et},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Et},sheen:{value:0},sheenColor:{value:new ct(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Et},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Et},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Et},transmissionSamplerSize:{value:new He},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Et},attenuationDistance:{value:0},attenuationColor:{value:new ct(0)},specularColor:{value:new ct(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Et},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Et},anisotropyVector:{value:new He},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Et}}]),vertexShader:Pt.meshphysical_vert,fragmentShader:Pt.meshphysical_frag};const Dp={r:0,b:0,g:0},pl=new Ei,Yte=new Ut;function jte(r,e,t,n,i,a,s){const o=new ct(0);let l=a===!0?0:1,u,c,h=null,d=0,f=null;function p(_){let x=_.isScene===!0?_.background:null;return x&&x.isTexture&&(x=(_.backgroundBlurriness>0?t:e).get(x)),x}function m(_){let x=!1;const E=p(_);E===null?g(o,l):E&&E.isColor&&(g(E,1),x=!0);const T=r.xr.getEnvironmentBlendMode();T==="additive"?n.buffers.color.setClear(0,0,0,1,s):T==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,s),(r.autoClear||x)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil))}function v(_,x){const E=p(x);E&&(E.isCubeTexture||E.mapping===Yl)?(c===void 0&&(c=new Yn(new uu(1,1,1),new ss({name:"BackgroundCubeMaterial",uniforms:Hc(Qa.backgroundCube.uniforms),vertexShader:Qa.backgroundCube.vertexShader,fragmentShader:Qa.backgroundCube.fragmentShader,side:dn,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(T,b,w){this.matrixWorld.copyPosition(w.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),pl.copy(x.backgroundRotation),pl.x*=-1,pl.y*=-1,pl.z*=-1,E.isCubeTexture&&E.isRenderTargetTexture===!1&&(pl.y*=-1,pl.z*=-1),c.material.uniforms.envMap.value=E,c.material.uniforms.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,c.material.uniforms.backgroundBlurriness.value=x.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(Yte.makeRotationFromEuler(pl)),c.material.toneMapped=Dt.getTransfer(E.colorSpace)!==en,(h!==E||d!==E.version||f!==r.toneMapping)&&(c.material.needsUpdate=!0,h=E,d=E.version,f=r.toneMapping),c.layers.enableAll(),_.unshift(c,c.geometry,c.material,0,0,null)):E&&E.isTexture&&(u===void 0&&(u=new Yn(new Id(2,2),new ss({name:"BackgroundMaterial",uniforms:Hc(Qa.background.uniforms),vertexShader:Qa.background.vertexShader,fragmentShader:Qa.background.fragmentShader,side:yi,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(u)),u.material.uniforms.t2D.value=E,u.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,u.material.toneMapped=Dt.getTransfer(E.colorSpace)!==en,E.matrixAutoUpdate===!0&&E.updateMatrix(),u.material.uniforms.uvTransform.value.copy(E.matrix),(h!==E||d!==E.version||f!==r.toneMapping)&&(u.material.needsUpdate=!0,h=E,d=E.version,f=r.toneMapping),u.layers.enableAll(),_.unshift(u,u.geometry,u.material,0,0,null))}function g(_,x){_.getRGB(Dp,hz(r)),n.buffers.color.setClear(Dp.r,Dp.g,Dp.b,x,s)}function y(){c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0),u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0)}return{getClearColor:function(){return o},setClearColor:function(_,x=1){o.set(_),l=x,g(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(_){l=_,g(o,l)},render:m,addToRenderList:v,dispose:y}}function Kte(r,e){const t=r.getParameter(r.MAX_VERTEX_ATTRIBS),n={},i=d(null);let a=i,s=!1;function o(S,C,R,P,M){let N=!1;const D=h(P,R,C);a!==D&&(a=D,u(a.object)),N=f(S,P,R,M),N&&p(S,P,R,M),M!==null&&e.update(M,r.ELEMENT_ARRAY_BUFFER),(N||s)&&(s=!1,x(S,C,R,P),M!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.get(M).buffer))}function l(){return r.createVertexArray()}function u(S){return r.bindVertexArray(S)}function c(S){return r.deleteVertexArray(S)}function h(S,C,R){const P=R.wireframe===!0;let M=n[S.id];M===void 0&&(M={},n[S.id]=M);let N=M[C.id];N===void 0&&(N={},M[C.id]=N);let D=N[P];return D===void 0&&(D=d(l()),N[P]=D),D}function d(S){const C=[],R=[],P=[];for(let M=0;M<t;M++)C[M]=0,R[M]=0,P[M]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:C,enabledAttributes:R,attributeDivisors:P,object:S,attributes:{},index:null}}function f(S,C,R,P){const M=a.attributes,N=C.attributes;let D=0;const I=R.getAttributes();for(const L in I)if(I[L].location>=0){const B=M[L];let k=N[L];if(k===void 0&&(L==="instanceMatrix"&&S.instanceMatrix&&(k=S.instanceMatrix),L==="instanceColor"&&S.instanceColor&&(k=S.instanceColor)),B===void 0||B.attribute!==k||k&&B.data!==k.data)return!0;D++}return a.attributesNum!==D||a.index!==P}function p(S,C,R,P){const M={},N=C.attributes;let D=0;const I=R.getAttributes();for(const L in I)if(I[L].location>=0){let B=N[L];B===void 0&&(L==="instanceMatrix"&&S.instanceMatrix&&(B=S.instanceMatrix),L==="instanceColor"&&S.instanceColor&&(B=S.instanceColor));const k={};k.attribute=B,B&&B.data&&(k.data=B.data),M[L]=k,D++}a.attributes=M,a.attributesNum=D,a.index=P}function m(){const S=a.newAttributes;for(let C=0,R=S.length;C<R;C++)S[C]=0}function v(S){g(S,0)}function g(S,C){const R=a.newAttributes,P=a.enabledAttributes,M=a.attributeDivisors;R[S]=1,P[S]===0&&(r.enableVertexAttribArray(S),P[S]=1),M[S]!==C&&(r.vertexAttribDivisor(S,C),M[S]=C)}function y(){const S=a.newAttributes,C=a.enabledAttributes;for(let R=0,P=C.length;R<P;R++)C[R]!==S[R]&&(r.disableVertexAttribArray(R),C[R]=0)}function _(S,C,R,P,M,N,D){D===!0?r.vertexAttribIPointer(S,C,R,M,N):r.vertexAttribPointer(S,C,R,P,M,N)}function x(S,C,R,P){m();const M=P.attributes,N=R.getAttributes(),D=C.defaultAttributeValues;for(const I in N){const L=N[I];if(L.location>=0){let z=M[I];if(z===void 0&&(I==="instanceMatrix"&&S.instanceMatrix&&(z=S.instanceMatrix),I==="instanceColor"&&S.instanceColor&&(z=S.instanceColor)),z!==void 0){const B=z.normalized,k=z.itemSize,U=e.get(z);if(U===void 0)continue;const G=U.buffer,O=U.type,F=U.bytesPerElement,V=O===r.INT||O===r.UNSIGNED_INT||z.gpuType===mr;if(z.isInterleavedBufferAttribute){const $=z.data,Z=$.stride,Y=z.offset;if($.isInstancedInterleavedBuffer){for(let X=0;X<L.locationSize;X++)g(L.location+X,$.meshPerAttribute);S.isInstancedMesh!==!0&&P._maxInstanceCount===void 0&&(P._maxInstanceCount=$.meshPerAttribute*$.count)}else for(let X=0;X<L.locationSize;X++)v(L.location+X);r.bindBuffer(r.ARRAY_BUFFER,G);for(let X=0;X<L.locationSize;X++)_(L.location+X,k/L.locationSize,O,B,Z*F,(Y+k/L.locationSize*X)*F,V)}else{if(z.isInstancedBufferAttribute){for(let $=0;$<L.locationSize;$++)g(L.location+$,z.meshPerAttribute);S.isInstancedMesh!==!0&&P._maxInstanceCount===void 0&&(P._maxInstanceCount=z.meshPerAttribute*z.count)}else for(let $=0;$<L.locationSize;$++)v(L.location+$);r.bindBuffer(r.ARRAY_BUFFER,G);for(let $=0;$<L.locationSize;$++)_(L.location+$,k/L.locationSize,O,B,k*F,k/L.locationSize*$*F,V)}}else if(D!==void 0){const B=D[I];if(B!==void 0)switch(B.length){case 2:r.vertexAttrib2fv(L.location,B);break;case 3:r.vertexAttrib3fv(L.location,B);break;case 4:r.vertexAttrib4fv(L.location,B);break;default:r.vertexAttrib1fv(L.location,B)}}}}y()}function E(){w();for(const S in n){const C=n[S];for(const R in C){const P=C[R];for(const M in P)c(P[M].object),delete P[M];delete C[R]}delete n[S]}}function T(S){if(n[S.id]===void 0)return;const C=n[S.id];for(const R in C){const P=C[R];for(const M in P)c(P[M].object),delete P[M];delete C[R]}delete n[S.id]}function b(S){for(const C in n){const R=n[C];if(R[S.id]===void 0)continue;const P=R[S.id];for(const M in P)c(P[M].object),delete P[M];delete R[S.id]}}function w(){A(),s=!0,a!==i&&(a=i,u(a.object))}function A(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:o,reset:w,resetDefaultState:A,dispose:E,releaseStatesOfGeometry:T,releaseStatesOfProgram:b,initAttributes:m,enableAttribute:v,disableUnusedAttributes:y}}function Qte(r,e,t){let n;function i(u){n=u}function a(u,c){r.drawArrays(n,u,c),t.update(c,n,1)}function s(u,c,h){h!==0&&(r.drawArraysInstanced(n,u,c,h),t.update(c,n,h))}function o(u,c,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,u,0,c,0,h);let f=0;for(let p=0;p<h;p++)f+=c[p];t.update(f,n,1)}function l(u,c,h,d){if(h===0)return;const f=e.get("WEBGL_multi_draw");if(f===null)for(let p=0;p<u.length;p++)s(u[p],c[p],d[p]);else{f.multiDrawArraysInstancedWEBGL(n,u,0,c,0,d,0,h);let p=0;for(let m=0;m<h;m++)p+=c[m]*d[m];t.update(p,n,1)}}this.setMode=i,this.render=a,this.renderInstances=s,this.renderMultiDraw=o,this.renderMultiDrawInstances=l}function Zte(r,e,t,n){let i;function a(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const b=e.get("EXT_texture_filter_anisotropic");i=r.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function s(b){return!(b!==On&&n.convert(b)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(b){const w=b===kr&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(b!==In&&n.convert(b)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_TYPE)&&b!==Un&&!w)}function l(b){if(b==="highp"){if(r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0)return"highp";b="mediump"}return b==="mediump"&&r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let u=t.precision!==void 0?t.precision:"highp";const c=l(u);c!==u&&(console.warn("THREE.WebGLRenderer:",u,"not supported, using",c,"instead."),u=c);const h=t.logarithmicDepthBuffer===!0,d=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),f=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),p=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS),m=r.getParameter(r.MAX_TEXTURE_SIZE),v=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),g=r.getParameter(r.MAX_VERTEX_ATTRIBS),y=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),_=r.getParameter(r.MAX_VARYING_VECTORS),x=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),E=p>0,T=r.getParameter(r.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:a,getMaxPrecision:l,textureFormatReadable:s,textureTypeReadable:o,precision:u,logarithmicDepthBuffer:h,reverseDepthBuffer:d,maxTextures:f,maxVertexTextures:p,maxTextureSize:m,maxCubemapSize:v,maxAttributes:g,maxVertexUniforms:y,maxVaryings:_,maxFragmentUniforms:x,vertexTextures:E,maxSamples:T}}function Jte(r){const e=this;let t=null,n=0,i=!1,a=!1;const s=new Sa,o=new Et,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const f=h.length!==0||d||n!==0||i;return i=d,n=h.length,f},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(h,d){t=c(h,d,0)},this.setState=function(h,d,f){const p=h.clippingPlanes,m=h.clipIntersection,v=h.clipShadows,g=r.get(h);if(!i||p===null||p.length===0||a&&!v)a?c(null):u();else{const y=a?0:n,_=y*4;let x=g.clippingState||null;l.value=x,x=c(p,d,_,f);for(let E=0;E!==_;++E)x[E]=t[E];g.clippingState=x,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=y}};function u(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function c(h,d,f,p){const m=h!==null?h.length:0;let v=null;if(m!==0){if(v=l.value,p!==!0||v===null){const g=f+m*4,y=d.matrixWorldInverse;o.getNormalMatrix(y),(v===null||v.length<g)&&(v=new Float32Array(g));for(let _=0,x=f;_!==m;++_,x+=4)s.copy(h[_]).applyMatrix4(y,o),s.normal.toArray(v,x),v[x+3]=s.constant}l.value=v,l.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,v}}function ene(r){let e=new WeakMap;function t(s,o){return o===Wo?s.mapping=la:o===qo&&(s.mapping=ua),s}function n(s){if(s&&s.isTexture){const o=s.mapping;if(o===Wo||o===qo)if(e.has(s)){const l=e.get(s).texture;return t(l,s.mapping)}else{const l=s.image;if(l&&l.height>0){const u=new pz(l.height);return u.fromEquirectangularTexture(r,s),e.set(s,u),s.addEventListener("dispose",i),t(u.texture,s.mapping)}else return null}}return s}function i(s){const o=s.target;o.removeEventListener("dispose",i);const l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function a(){e=new WeakMap}return{get:n,dispose:a}}const tc=4,kO=[.125,.215,.35,.446,.526,.582],Cl=20,l1=new Fd,GO=new ct;let u1=null,c1=0,h1=0,f1=!1;const Tl=(1+Math.sqrt(5))/2,Iu=1/Tl,zO=[new re(-Tl,Iu,0),new re(Tl,Iu,0),new re(-Iu,0,Tl),new re(Iu,0,Tl),new re(0,Tl,-Iu),new re(0,Tl,Iu),new re(-1,1,-1),new re(1,1,-1),new re(-1,1,1),new re(1,1,1)],tne=new re;class VO{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100,a={}){const{size:s=256,position:o=tne}=a;u1=this._renderer.getRenderTarget(),c1=this._renderer.getActiveCubeFace(),h1=this._renderer.getActiveMipmapLevel(),f1=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(s);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,n,i,l,o),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=qO(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=WO(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(u1,c1,h1),this._renderer.xr.enabled=f1,e.scissorTest=!1,Lp(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===la||e.mapping===ua?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),u1=this._renderer.getRenderTarget(),c1=this._renderer.getActiveCubeFace(),h1=this._renderer.getActiveMipmapLevel(),f1=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:ir,minFilter:ir,generateMipmaps:!1,type:kr,format:On,colorSpace:is,depthBuffer:!1},i=HO(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=HO(e,t,n);const{_lodMax:a}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=nne(a)),this._blurMaterial=rne(a,e,t)}return i}_compileMaterial(e){const t=new Yn(this._lodPlanes[0],e);this._renderer.compile(t,l1)}_sceneToCubeUV(e,t,n,i,a){const l=new yr(90,1,t,n),u=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],h=this._renderer,d=h.autoClear,f=h.toneMapping;h.getClearColor(GO),h.toneMapping=xi,h.autoClear=!1;const p=new Za({name:"PMREM.Background",side:dn,depthWrite:!1,depthTest:!1}),m=new Yn(new uu,p);let v=!1;const g=e.background;g?g.isColor&&(p.color.copy(g),e.background=null,v=!0):(p.color.copy(GO),v=!0);for(let y=0;y<6;y++){const _=y%3;_===0?(l.up.set(0,u[y],0),l.position.set(a.x,a.y,a.z),l.lookAt(a.x+c[y],a.y,a.z)):_===1?(l.up.set(0,0,u[y]),l.position.set(a.x,a.y,a.z),l.lookAt(a.x,a.y+c[y],a.z)):(l.up.set(0,u[y],0),l.position.set(a.x,a.y,a.z),l.lookAt(a.x,a.y,a.z+c[y]));const x=this._cubeSize;Lp(i,_*x,y>2?x:0,x,x),h.setRenderTarget(i),v&&h.render(m,l),h.render(e,l)}m.geometry.dispose(),m.material.dispose(),h.toneMapping=f,h.autoClear=d,e.background=g}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===la||e.mapping===ua;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=qO()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=WO());const a=i?this._cubemapMaterial:this._equirectMaterial,s=new Yn(this._lodPlanes[0],a),o=a.uniforms;o.envMap.value=e;const l=this._cubeSize;Lp(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(s,l1)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let a=1;a<i;a++){const s=Math.sqrt(this._sigmas[a]*this._sigmas[a]-this._sigmas[a-1]*this._sigmas[a-1]),o=zO[(i-a-1)%zO.length];this._blur(e,a-1,a,s,o)}t.autoClear=n}_blur(e,t,n,i,a){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,i,"latitudinal",a),this._halfBlur(s,e,n,n,i,"longitudinal",a)}_halfBlur(e,t,n,i,a,s,o){const l=this._renderer,u=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const c=3,h=new Yn(this._lodPlanes[i],u),d=u.uniforms,f=this._sizeLods[n]-1,p=isFinite(a)?Math.PI/(2*f):2*Math.PI/(2*Cl-1),m=a/p,v=isFinite(a)?1+Math.floor(c*m):Cl;v>Cl&&console.warn(`sigmaRadians, ${a}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${Cl}`);const g=[];let y=0;for(let b=0;b<Cl;++b){const w=b/m,A=Math.exp(-w*w/2);g.push(A),b===0?y+=A:b<v&&(y+=2*A)}for(let b=0;b<g.length;b++)g[b]=g[b]/y;d.envMap.value=e.texture,d.samples.value=v,d.weights.value=g,d.latitudinal.value=s==="latitudinal",o&&(d.poleAxis.value=o);const{_lodMax:_}=this;d.dTheta.value=p,d.mipInt.value=_-n;const x=this._sizeLods[i],E=3*x*(i>_-tc?i-_+tc:0),T=4*(this._cubeSize-x);Lp(t,E,T,3*x,2*x),l.setRenderTarget(t),l.render(h,l1)}}function nne(r){const e=[],t=[],n=[];let i=r;const a=r-tc+1+kO.length;for(let s=0;s<a;s++){const o=Math.pow(2,i);t.push(o);let l=1/o;s>r-tc?l=kO[s-r+tc-1]:s===0&&(l=0),n.push(l);const u=1/(o-2),c=-u,h=1+u,d=[c,c,h,c,h,h,c,c,h,h,c,h],f=6,p=6,m=3,v=2,g=1,y=new Float32Array(m*p*f),_=new Float32Array(v*p*f),x=new Float32Array(g*p*f);for(let T=0;T<f;T++){const b=T%3*2/3-1,w=T>2?0:-1,A=[b,w,0,b+2/3,w,0,b+2/3,w+1,0,b,w,0,b+2/3,w+1,0,b,w+1,0];y.set(A,m*p*T),_.set(d,v*p*T);const S=[T,T,T,T,T,T];x.set(S,g*p*T)}const E=new ri;E.setAttribute("position",new Rr(y,m)),E.setAttribute("uv",new Rr(_,v)),E.setAttribute("faceIndex",new Rr(x,g)),e.push(E),i>tc&&i--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function HO(r,e,t){const n=new Xo(r,e,t);return n.texture.mapping=Yl,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Lp(r,e,t,n,i){r.viewport.set(e,t,n,i),r.scissor.set(e,t,n,i)}function rne(r,e,t){const n=new Float32Array(Cl),i=new re(0,1,0);return new ss({name:"SphericalGaussianBlur",defines:{n:Cl,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:aM(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:_i,depthTest:!1,depthWrite:!1})}function WO(){return new ss({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:aM(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:_i,depthTest:!1,depthWrite:!1})}function qO(){return new ss({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:aM(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:_i,depthTest:!1,depthWrite:!1})}function aM(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function ine(r){let e=new WeakMap,t=null;function n(o){if(o&&o.isTexture){const l=o.mapping,u=l===Wo||l===qo,c=l===la||l===ua;if(u||c){let h=e.get(o);const d=h!==void 0?h.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==d)return t===null&&(t=new VO(r)),h=u?t.fromEquirectangular(o,h):t.fromCubemap(o,h),h.texture.pmremVersion=o.pmremVersion,e.set(o,h),h.texture;if(h!==void 0)return h.texture;{const f=o.image;return u&&f&&f.height>0||c&&f&&i(f)?(t===null&&(t=new VO(r)),h=u?t.fromEquirectangular(o):t.fromCubemap(o),h.texture.pmremVersion=o.pmremVersion,e.set(o,h),o.addEventListener("dispose",a),h.texture):null}}}return o}function i(o){let l=0;const u=6;for(let c=0;c<u;c++)o[c]!==void 0&&l++;return l===u}function a(o){const l=o.target;l.removeEventListener("dispose",a);const u=e.get(l);u!==void 0&&(e.delete(l),u.dispose())}function s(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:s}}function ane(r){const e={};function t(n){if(e[n]!==void 0)return e[n];let i;switch(n){case"WEBGL_depth_texture":i=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=r.getExtension(n)}return e[n]=i,i}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const i=t(n);return i===null&&Ia("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function sne(r,e,t,n){const i={},a=new WeakMap;function s(h){const d=h.target;d.index!==null&&e.remove(d.index);for(const p in d.attributes)e.remove(d.attributes[p]);d.removeEventListener("dispose",s),delete i[d.id];const f=a.get(d);f&&(e.remove(f),a.delete(d)),n.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function o(h,d){return i[d.id]===!0||(d.addEventListener("dispose",s),i[d.id]=!0,t.memory.geometries++),d}function l(h){const d=h.attributes;for(const f in d)e.update(d[f],r.ARRAY_BUFFER)}function u(h){const d=[],f=h.index,p=h.attributes.position;let m=0;if(f!==null){const y=f.array;m=f.version;for(let _=0,x=y.length;_<x;_+=3){const E=y[_+0],T=y[_+1],b=y[_+2];d.push(E,T,T,b,b,E)}}else if(p!==void 0){const y=p.array;m=p.version;for(let _=0,x=y.length/3-1;_<x;_+=3){const E=_+0,T=_+1,b=_+2;d.push(E,T,T,b,b,E)}}else return;const v=new(qA(d)?KA:jA)(d,1);v.version=m;const g=a.get(h);g&&e.remove(g),a.set(h,v)}function c(h){const d=a.get(h);if(d){const f=h.index;f!==null&&d.version<f.version&&u(h)}else u(h);return a.get(h)}return{get:o,update:l,getWireframeAttribute:c}}function one(r,e,t){let n;function i(d){n=d}let a,s;function o(d){a=d.type,s=d.bytesPerElement}function l(d,f){r.drawElements(n,f,a,d*s),t.update(f,n,1)}function u(d,f,p){p!==0&&(r.drawElementsInstanced(n,f,a,d*s,p),t.update(f,n,p))}function c(d,f,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,f,0,a,d,0,p);let v=0;for(let g=0;g<p;g++)v+=f[g];t.update(v,n,1)}function h(d,f,p,m){if(p===0)return;const v=e.get("WEBGL_multi_draw");if(v===null)for(let g=0;g<d.length;g++)u(d[g]/s,f[g],m[g]);else{v.multiDrawElementsInstancedWEBGL(n,f,0,a,d,0,m,0,p);let g=0;for(let y=0;y<p;y++)g+=f[y]*m[y];t.update(g,n,1)}}this.setMode=i,this.setIndex=o,this.render=l,this.renderInstances=u,this.renderMultiDraw=c,this.renderMultiDrawInstances=h}function lne(r){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(a,s,o){switch(t.calls++,s){case r.TRIANGLES:t.triangles+=o*(a/3);break;case r.LINES:t.lines+=o*(a/2);break;case r.LINE_STRIP:t.lines+=o*(a-1);break;case r.LINE_LOOP:t.lines+=o*a;break;case r.POINTS:t.points+=o*a;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",s);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:n}}function une(r,e,t){const n=new WeakMap,i=new xt;function a(s,o,l){const u=s.morphTargetInfluences,c=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,h=c!==void 0?c.length:0;let d=n.get(o);if(d===void 0||d.count!==h){let A=function(){b.dispose(),n.delete(o),o.removeEventListener("dispose",A)};d!==void 0&&d.texture.dispose();const f=o.morphAttributes.position!==void 0,p=o.morphAttributes.normal!==void 0,m=o.morphAttributes.color!==void 0,v=o.morphAttributes.position||[],g=o.morphAttributes.normal||[],y=o.morphAttributes.color||[];let _=0;f===!0&&(_=1),p===!0&&(_=2),m===!0&&(_=3);let x=o.attributes.position.count*_,E=1;x>e.maxTextureSize&&(E=Math.ceil(x/e.maxTextureSize),x=e.maxTextureSize);const T=new Float32Array(x*E*4*h),b=new XA(T,x,E,h);b.type=Un,b.needsUpdate=!0;const w=_*4;for(let S=0;S<h;S++){const C=v[S],R=g[S],P=y[S],M=x*E*4*S;for(let N=0;N<C.count;N++){const D=N*w;f===!0&&(i.fromBufferAttribute(C,N),T[M+D+0]=i.x,T[M+D+1]=i.y,T[M+D+2]=i.z,T[M+D+3]=0),p===!0&&(i.fromBufferAttribute(R,N),T[M+D+4]=i.x,T[M+D+5]=i.y,T[M+D+6]=i.z,T[M+D+7]=0),m===!0&&(i.fromBufferAttribute(P,N),T[M+D+8]=i.x,T[M+D+9]=i.y,T[M+D+10]=i.z,T[M+D+11]=P.itemSize===4?i.w:1)}}d={count:h,texture:b,size:new He(x,E)},n.set(o,d),o.addEventListener("dispose",A)}if(s.isInstancedMesh===!0&&s.morphTexture!==null)l.getUniforms().setValue(r,"morphTexture",s.morphTexture,t);else{let f=0;for(let m=0;m<u.length;m++)f+=u[m];const p=o.morphTargetsRelative?1:1-f;l.getUniforms().setValue(r,"morphTargetBaseInfluence",p),l.getUniforms().setValue(r,"morphTargetInfluences",u)}l.getUniforms().setValue(r,"morphTargetsTexture",d.texture,t),l.getUniforms().setValue(r,"morphTargetsTextureSize",d.size)}return{update:a}}function cne(r,e,t,n){let i=new WeakMap;function a(l){const u=n.render.frame,c=l.geometry,h=e.get(l,c);if(i.get(h)!==u&&(e.update(h),i.set(h,u)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.get(l)!==u&&(t.update(l.instanceMatrix,r.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,r.ARRAY_BUFFER),i.set(l,u))),l.isSkinnedMesh){const d=l.skeleton;i.get(d)!==u&&(d.update(),i.set(d,u))}return h}function s(){i=new WeakMap}function o(l){const u=l.target;u.removeEventListener("dispose",o),t.remove(u.instanceMatrix),u.instanceColor!==null&&t.remove(u.instanceColor)}return{update:a,dispose:s}}const Mz=new ar,$O=new sa(1,1),Cz=new XA,Rz=new aZ,Nz=new um,XO=[],YO=[],jO=new Float32Array(16),KO=new Float32Array(9),QO=new Float32Array(4);function hh(r,e,t){const n=r[0];if(n<=0||n>0)return r;const i=e*t;let a=XO[i];if(a===void 0&&(a=new Float32Array(i),XO[i]=a),e!==0){n.toArray(a,0);for(let s=1,o=0;s!==e;++s)o+=t,r[s].toArray(a,o)}return a}function or(r,e){if(r.length!==e.length)return!1;for(let t=0,n=r.length;t<n;t++)if(r[t]!==e[t])return!1;return!0}function lr(r,e){for(let t=0,n=e.length;t<n;t++)r[t]=e[t]}function gm(r,e){let t=YO[e];t===void 0&&(t=new Int32Array(e),YO[e]=t);for(let n=0;n!==e;++n)t[n]=r.allocateTextureUnit();return t}function hne(r,e){const t=this.cache;t[0]!==e&&(r.uniform1f(this.addr,e),t[0]=e)}function fne(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(or(t,e))return;r.uniform2fv(this.addr,e),lr(t,e)}}function dne(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(r.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(or(t,e))return;r.uniform3fv(this.addr,e),lr(t,e)}}function pne(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(or(t,e))return;r.uniform4fv(this.addr,e),lr(t,e)}}function gne(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(or(t,e))return;r.uniformMatrix2fv(this.addr,!1,e),lr(t,e)}else{if(or(t,n))return;QO.set(n),r.uniformMatrix2fv(this.addr,!1,QO),lr(t,n)}}function vne(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(or(t,e))return;r.uniformMatrix3fv(this.addr,!1,e),lr(t,e)}else{if(or(t,n))return;KO.set(n),r.uniformMatrix3fv(this.addr,!1,KO),lr(t,n)}}function mne(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(or(t,e))return;r.uniformMatrix4fv(this.addr,!1,e),lr(t,e)}else{if(or(t,n))return;jO.set(n),r.uniformMatrix4fv(this.addr,!1,jO),lr(t,n)}}function yne(r,e){const t=this.cache;t[0]!==e&&(r.uniform1i(this.addr,e),t[0]=e)}function _ne(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(or(t,e))return;r.uniform2iv(this.addr,e),lr(t,e)}}function xne(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(or(t,e))return;r.uniform3iv(this.addr,e),lr(t,e)}}function bne(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(or(t,e))return;r.uniform4iv(this.addr,e),lr(t,e)}}function Ene(r,e){const t=this.cache;t[0]!==e&&(r.uniform1ui(this.addr,e),t[0]=e)}function Tne(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(or(t,e))return;r.uniform2uiv(this.addr,e),lr(t,e)}}function wne(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(or(t,e))return;r.uniform3uiv(this.addr,e),lr(t,e)}}function Sne(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(or(t,e))return;r.uniform4uiv(this.addr,e),lr(t,e)}}function Ane(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i);let a;this.type===r.SAMPLER_2D_SHADOW?($O.compareFunction=om,a=$O):a=Mz,t.setTexture2D(e||a,i)}function Mne(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||Rz,i)}function Cne(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTextureCube(e||Nz,i)}function Rne(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||Cz,i)}function Nne(r){switch(r){case 5126:return hne;case 35664:return fne;case 35665:return dne;case 35666:return pne;case 35674:return gne;case 35675:return vne;case 35676:return mne;case 5124:case 35670:return yne;case 35667:case 35671:return _ne;case 35668:case 35672:return xne;case 35669:case 35673:return bne;case 5125:return Ene;case 36294:return Tne;case 36295:return wne;case 36296:return Sne;case 35678:case 36198:case 36298:case 36306:case 35682:return Ane;case 35679:case 36299:case 36307:return Mne;case 35680:case 36300:case 36308:case 36293:return Cne;case 36289:case 36303:case 36311:case 36292:return Rne}}function Pne(r,e){r.uniform1fv(this.addr,e)}function Dne(r,e){const t=hh(e,this.size,2);r.uniform2fv(this.addr,t)}function Lne(r,e){const t=hh(e,this.size,3);r.uniform3fv(this.addr,t)}function Ine(r,e){const t=hh(e,this.size,4);r.uniform4fv(this.addr,t)}function One(r,e){const t=hh(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,t)}function Fne(r,e){const t=hh(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,t)}function Bne(r,e){const t=hh(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,t)}function Une(r,e){r.uniform1iv(this.addr,e)}function kne(r,e){r.uniform2iv(this.addr,e)}function Gne(r,e){r.uniform3iv(this.addr,e)}function zne(r,e){r.uniform4iv(this.addr,e)}function Vne(r,e){r.uniform1uiv(this.addr,e)}function Hne(r,e){r.uniform2uiv(this.addr,e)}function Wne(r,e){r.uniform3uiv(this.addr,e)}function qne(r,e){r.uniform4uiv(this.addr,e)}function $ne(r,e,t){const n=this.cache,i=e.length,a=gm(t,i);or(n,a)||(r.uniform1iv(this.addr,a),lr(n,a));for(let s=0;s!==i;++s)t.setTexture2D(e[s]||Mz,a[s])}function Xne(r,e,t){const n=this.cache,i=e.length,a=gm(t,i);or(n,a)||(r.uniform1iv(this.addr,a),lr(n,a));for(let s=0;s!==i;++s)t.setTexture3D(e[s]||Rz,a[s])}function Yne(r,e,t){const n=this.cache,i=e.length,a=gm(t,i);or(n,a)||(r.uniform1iv(this.addr,a),lr(n,a));for(let s=0;s!==i;++s)t.setTextureCube(e[s]||Nz,a[s])}function jne(r,e,t){const n=this.cache,i=e.length,a=gm(t,i);or(n,a)||(r.uniform1iv(this.addr,a),lr(n,a));for(let s=0;s!==i;++s)t.setTexture2DArray(e[s]||Cz,a[s])}function Kne(r){switch(r){case 5126:return Pne;case 35664:return Dne;case 35665:return Lne;case 35666:return Ine;case 35674:return One;case 35675:return Fne;case 35676:return Bne;case 5124:case 35670:return Une;case 35667:case 35671:return kne;case 35668:case 35672:return Gne;case 35669:case 35673:return zne;case 5125:return Vne;case 36294:return Hne;case 36295:return Wne;case 36296:return qne;case 35678:case 36198:case 36298:case 36306:case 35682:return $ne;case 35679:case 36299:case 36307:return Xne;case 35680:case 36300:case 36308:case 36293:return Yne;case 36289:case 36303:case 36311:case 36292:return jne}}class Qne{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=Nne(t.type)}}class Zne{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=Kne(t.type)}}class Jne{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let a=0,s=i.length;a!==s;++a){const o=i[a];o.setValue(e,t[o.id],n)}}}const d1=/(\w+)(\])?(\[|\.)?/g;function ZO(r,e){r.seq.push(e),r.map[e.id]=e}function ere(r,e,t){const n=r.name,i=n.length;for(d1.lastIndex=0;;){const a=d1.exec(n),s=d1.lastIndex;let o=a[1];const l=a[2]==="]",u=a[3];if(l&&(o=o|0),u===void 0||u==="["&&s+2===i){ZO(t,u===void 0?new Qne(o,r,e):new Zne(o,r,e));break}else{let h=t.map[o];h===void 0&&(h=new Jne(o),ZO(t,h)),t=h}}}class wg{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const a=e.getActiveUniform(t,i),s=e.getUniformLocation(t,a.name);ere(a,s,this)}}setValue(e,t,n,i){const a=this.map[t];a!==void 0&&a.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];i!==void 0&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let a=0,s=t.length;a!==s;++a){const o=t[a],l=n[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,a=e.length;i!==a;++i){const s=e[i];s.id in t&&n.push(s)}return n}}function JO(r,e,t){const n=r.createShader(e);return r.shaderSource(n,t),r.compileShader(n),n}const tre=37297;let nre=0;function rre(r,e){const t=r.split(`
`),n=[],i=Math.max(e-6,0),a=Math.min(e+6,t.length);for(let s=i;s<a;s++){const o=s+1;n.push(`${o===e?">":" "} ${o}: ${t[s]}`)}return n.join(`
`)}const eF=new Et;function ire(r){Dt._getMatrix(eF,Dt.workingColorSpace,r);const e=`mat3( ${eF.elements.map(t=>t.toFixed(4))} )`;switch(Dt.getTransfer(r)){case Jg:return[e,"LinearTransferOETF"];case en:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",r),[e,"LinearTransferOETF"]}}function tF(r,e,t){const n=r.getShaderParameter(e,r.COMPILE_STATUS),i=r.getShaderInfoLog(e).trim();if(n&&i==="")return"";const a=/ERROR: 0:(\d+)/.exec(i);if(a){const s=parseInt(a[1]);return t.toUpperCase()+`

`+i+`

`+rre(r.getShaderSource(e),s)}else return i}function are(r,e){const t=ire(e);return[`vec4 ${r}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function sre(r,e){let t;switch(e){case tz:t="Linear";break;case nz:t="Reinhard";break;case rz:t="Cineon";break;case iz:t="ACESFilmic";break;case az:t="AgX";break;case sz:t="Neutral";break;case yQ:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+r+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const Ip=new re;function ore(){Dt.getLuminanceCoefficients(Ip);const r=Ip.x.toFixed(4),e=Ip.y.toFixed(4),t=Ip.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${r}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function lre(r){return[r.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",r.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(nf).join(`
`)}function ure(r){const e=[];for(const t in r){const n=r[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function cre(r,e){const t={},n=r.getProgramParameter(e,r.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const a=r.getActiveAttrib(e,i),s=a.name;let o=1;a.type===r.FLOAT_MAT2&&(o=2),a.type===r.FLOAT_MAT3&&(o=3),a.type===r.FLOAT_MAT4&&(o=4),t[s]={type:a.type,location:r.getAttribLocation(e,s),locationSize:o}}return t}function nf(r){return r!==""}function nF(r,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return r.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function rF(r,e){return r.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const hre=/^[ \t]*#include +<([\w\d./]+)>/gm;function jw(r){return r.replace(hre,dre)}const fre=new Map;function dre(r,e){let t=Pt[e];if(t===void 0){const n=fre.get(e);if(n!==void 0)t=Pt[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return jw(t)}const pre=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function iF(r){return r.replace(pre,gre)}function gre(r,e,t,n){let i="";for(let a=parseInt(e);a<parseInt(t);a++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function aF(r){let e=`precision ${r.precision} float;
	precision ${r.precision} int;
	precision ${r.precision} sampler2D;
	precision ${r.precision} samplerCube;
	precision ${r.precision} sampler3D;
	precision ${r.precision} sampler2DArray;
	precision ${r.precision} sampler2DShadow;
	precision ${r.precision} samplerCubeShadow;
	precision ${r.precision} sampler2DArrayShadow;
	precision ${r.precision} isampler2D;
	precision ${r.precision} isampler3D;
	precision ${r.precision} isamplerCube;
	precision ${r.precision} isampler2DArray;
	precision ${r.precision} usampler2D;
	precision ${r.precision} usampler3D;
	precision ${r.precision} usamplerCube;
	precision ${r.precision} usampler2DArray;
	`;return r.precision==="highp"?e+=`
#define HIGH_PRECISION`:r.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function vre(r){let e="SHADOWMAP_TYPE_BASIC";return r.shadowMapType===bA?e="SHADOWMAP_TYPE_PCF":r.shadowMapType===dQ?e="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===Fi&&(e="SHADOWMAP_TYPE_VSM"),e}function mre(r){let e="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case la:case ua:e="ENVMAP_TYPE_CUBE";break;case Yl:e="ENVMAP_TYPE_CUBE_UV";break}return e}function yre(r){let e="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case ua:e="ENVMAP_MODE_REFRACTION";break}return e}function _re(r){let e="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case Rd:e="ENVMAP_BLENDING_MULTIPLY";break;case JG:e="ENVMAP_BLENDING_MIX";break;case ez:e="ENVMAP_BLENDING_ADD";break}return e}function xre(r){const e=r.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function bre(r,e,t,n){const i=r.getContext(),a=t.defines;let s=t.vertexShader,o=t.fragmentShader;const l=vre(t),u=mre(t),c=yre(t),h=_re(t),d=xre(t),f=lre(t),p=ure(a),m=i.createProgram();let v,g,y=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(v=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(nf).join(`
`),v.length>0&&(v+=`
`),g=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(nf).join(`
`),g.length>0&&(g+=`
`)):(v=[aF(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(nf).join(`
`),g=[aF(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==xi?"#define TONE_MAPPING":"",t.toneMapping!==xi?Pt.tonemapping_pars_fragment:"",t.toneMapping!==xi?sre("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Pt.colorspace_pars_fragment,are("linearToOutputTexel",t.outputColorSpace),ore(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(nf).join(`
`)),s=jw(s),s=nF(s,t),s=rF(s,t),o=jw(o),o=nF(o,t),o=rF(o,t),s=iF(s),o=iF(o),t.isRawShaderMaterial!==!0&&(y=`#version 300 es
`,v=[f,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,g=["#define varying in",t.glslVersion===lO?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===lO?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+g);const _=y+v+s,x=y+g+o,E=JO(i,i.VERTEX_SHADER,_),T=JO(i,i.FRAGMENT_SHADER,x);i.attachShader(m,E),i.attachShader(m,T),t.index0AttributeName!==void 0?i.bindAttribLocation(m,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m);function b(C){if(r.debug.checkShaderErrors){const R=i.getProgramInfoLog(m).trim(),P=i.getShaderInfoLog(E).trim(),M=i.getShaderInfoLog(T).trim();let N=!0,D=!0;if(i.getProgramParameter(m,i.LINK_STATUS)===!1)if(N=!1,typeof r.debug.onShaderError=="function")r.debug.onShaderError(i,m,E,T);else{const I=tF(i,E,"vertex"),L=tF(i,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(m,i.VALIDATE_STATUS)+`

Material Name: `+C.name+`
Material Type: `+C.type+`

Program Info Log: `+R+`
`+I+`
`+L)}else R!==""?console.warn("THREE.WebGLProgram: Program Info Log:",R):(P===""||M==="")&&(D=!1);D&&(C.diagnostics={runnable:N,programLog:R,vertexShader:{log:P,prefix:v},fragmentShader:{log:M,prefix:g}})}i.deleteShader(E),i.deleteShader(T),w=new wg(i,m),A=cre(i,m)}let w;this.getUniforms=function(){return w===void 0&&b(this),w};let A;this.getAttributes=function(){return A===void 0&&b(this),A};let S=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return S===!1&&(S=i.getProgramParameter(m,tre)),S},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=nre++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=E,this.fragmentShader=T,this}let Ere=0;class Tre{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),a=this._getShaderStage(n),s=this._getShaderCacheForMaterial(e);return s.has(i)===!1&&(s.add(i),i.usedTimes++),s.has(a)===!1&&(s.add(a),a.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new wre(e),t.set(e,n)),n}}class wre{constructor(e){this.id=Ere++,this.code=e,this.usedTimes=0}}function Sre(r,e,t,n,i,a,s){const o=new YA,l=new Tre,u=new Set,c=[],h=i.logarithmicDepthBuffer,d=i.vertexTextures;let f=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(A){return u.add(A),A===0?"uv":`uv${A}`}function v(A,S,C,R,P){const M=R.fog,N=P.geometry,D=A.isMeshStandardMaterial?R.environment:null,I=(A.isMeshStandardMaterial?t:e).get(A.envMap||D),L=!!I&&I.mapping===Yl?I.image.height:null,z=p[A.type];A.precision!==null&&(f=i.getMaxPrecision(A.precision),f!==A.precision&&console.warn("THREE.WebGLProgram.getParameters:",A.precision,"not supported, using",f,"instead."));const B=N.morphAttributes.position||N.morphAttributes.normal||N.morphAttributes.color,k=B!==void 0?B.length:0;let U=0;N.morphAttributes.position!==void 0&&(U=1),N.morphAttributes.normal!==void 0&&(U=2),N.morphAttributes.color!==void 0&&(U=3);let G,O,F,V;if(z){const Je=Qa[z];G=Je.vertexShader,O=Je.fragmentShader}else G=A.vertexShader,O=A.fragmentShader,l.update(A),F=l.getVertexShaderID(A),V=l.getFragmentShaderID(A);const $=r.getRenderTarget(),Z=r.state.buffers.depth.getReversed(),Y=P.isInstancedMesh===!0,X=P.isBatchedMesh===!0,K=!!A.map,se=!!A.matcap,oe=!!I,W=!!A.aoMap,Ne=!!A.lightMap,Be=!!A.bumpMap,we=!!A.normalMap,pe=!!A.displacementMap,Me=!!A.emissiveMap,Ae=!!A.metalnessMap,j=!!A.roughnessMap,H=A.anisotropy>0,te=A.clearcoat>0,me=A.dispersion>0,Ee=A.iridescence>0,le=A.sheen>0,q=A.transmission>0,ne=H&&!!A.anisotropyMap,fe=te&&!!A.clearcoatMap,ce=te&&!!A.clearcoatNormalMap,ae=te&&!!A.clearcoatRoughnessMap,ie=Ee&&!!A.iridescenceMap,ee=Ee&&!!A.iridescenceThicknessMap,he=le&&!!A.sheenColorMap,ge=le&&!!A.sheenRoughnessMap,Te=!!A.specularMap,Se=!!A.specularColorMap,Oe=!!A.specularIntensityMap,J=q&&!!A.transmissionMap,ve=q&&!!A.thicknessMap,ue=!!A.gradientMap,_e=!!A.alphaMap,ke=A.alphaTest>0,Ie=!!A.alphaHash,je=!!A.extensions;let $e=xi;A.toneMapped&&($===null||$.isXRRenderTarget===!0)&&($e=r.toneMapping);const Xe={shaderID:z,shaderType:A.type,shaderName:A.name,vertexShader:G,fragmentShader:O,defines:A.defines,customVertexShaderID:F,customFragmentShaderID:V,isRawShaderMaterial:A.isRawShaderMaterial===!0,glslVersion:A.glslVersion,precision:f,batching:X,batchingColor:X&&P._colorsTexture!==null,instancing:Y,instancingColor:Y&&P.instanceColor!==null,instancingMorph:Y&&P.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:$===null?r.outputColorSpace:$.isXRRenderTarget===!0?$.texture.colorSpace:is,alphaToCoverage:!!A.alphaToCoverage,map:K,matcap:se,envMap:oe,envMapMode:oe&&I.mapping,envMapCubeUVHeight:L,aoMap:W,lightMap:Ne,bumpMap:Be,normalMap:we,displacementMap:d&&pe,emissiveMap:Me,normalMapObjectSpace:we&&A.normalMapType===oz,normalMapTangentSpace:we&&A.normalMapType===Xs,metalnessMap:Ae,roughnessMap:j,anisotropy:H,anisotropyMap:ne,clearcoat:te,clearcoatMap:fe,clearcoatNormalMap:ce,clearcoatRoughnessMap:ae,dispersion:me,iridescence:Ee,iridescenceMap:ie,iridescenceThicknessMap:ee,sheen:le,sheenColorMap:he,sheenRoughnessMap:ge,specularMap:Te,specularColorMap:Se,specularIntensityMap:Oe,transmission:q,transmissionMap:J,thicknessMap:ve,gradientMap:ue,opaque:A.transparent===!1&&A.blending===aa&&A.alphaToCoverage===!1,alphaMap:_e,alphaTest:ke,alphaHash:Ie,combine:A.combine,mapUv:K&&m(A.map.channel),aoMapUv:W&&m(A.aoMap.channel),lightMapUv:Ne&&m(A.lightMap.channel),bumpMapUv:Be&&m(A.bumpMap.channel),normalMapUv:we&&m(A.normalMap.channel),displacementMapUv:pe&&m(A.displacementMap.channel),emissiveMapUv:Me&&m(A.emissiveMap.channel),metalnessMapUv:Ae&&m(A.metalnessMap.channel),roughnessMapUv:j&&m(A.roughnessMap.channel),anisotropyMapUv:ne&&m(A.anisotropyMap.channel),clearcoatMapUv:fe&&m(A.clearcoatMap.channel),clearcoatNormalMapUv:ce&&m(A.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ae&&m(A.clearcoatRoughnessMap.channel),iridescenceMapUv:ie&&m(A.iridescenceMap.channel),iridescenceThicknessMapUv:ee&&m(A.iridescenceThicknessMap.channel),sheenColorMapUv:he&&m(A.sheenColorMap.channel),sheenRoughnessMapUv:ge&&m(A.sheenRoughnessMap.channel),specularMapUv:Te&&m(A.specularMap.channel),specularColorMapUv:Se&&m(A.specularColorMap.channel),specularIntensityMapUv:Oe&&m(A.specularIntensityMap.channel),transmissionMapUv:J&&m(A.transmissionMap.channel),thicknessMapUv:ve&&m(A.thicknessMap.channel),alphaMapUv:_e&&m(A.alphaMap.channel),vertexTangents:!!N.attributes.tangent&&(we||H),vertexColors:A.vertexColors,vertexAlphas:A.vertexColors===!0&&!!N.attributes.color&&N.attributes.color.itemSize===4,pointsUvs:P.isPoints===!0&&!!N.attributes.uv&&(K||_e),fog:!!M,useFog:A.fog===!0,fogExp2:!!M&&M.isFogExp2,flatShading:A.flatShading===!0,sizeAttenuation:A.sizeAttenuation===!0,logarithmicDepthBuffer:h,reverseDepthBuffer:Z,skinning:P.isSkinnedMesh===!0,morphTargets:N.morphAttributes.position!==void 0,morphNormals:N.morphAttributes.normal!==void 0,morphColors:N.morphAttributes.color!==void 0,morphTargetsCount:k,morphTextureStride:U,numDirLights:S.directional.length,numPointLights:S.point.length,numSpotLights:S.spot.length,numSpotLightMaps:S.spotLightMap.length,numRectAreaLights:S.rectArea.length,numHemiLights:S.hemi.length,numDirLightShadows:S.directionalShadowMap.length,numPointLightShadows:S.pointShadowMap.length,numSpotLightShadows:S.spotShadowMap.length,numSpotLightShadowsWithMaps:S.numSpotLightShadowsWithMaps,numLightProbes:S.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:A.dithering,shadowMapEnabled:r.shadowMap.enabled&&C.length>0,shadowMapType:r.shadowMap.type,toneMapping:$e,decodeVideoTexture:K&&A.map.isVideoTexture===!0&&Dt.getTransfer(A.map.colorSpace)===en,decodeVideoTextureEmissive:Me&&A.emissiveMap.isVideoTexture===!0&&Dt.getTransfer(A.emissiveMap.colorSpace)===en,premultipliedAlpha:A.premultipliedAlpha,doubleSided:A.side===Qr,flipSided:A.side===dn,useDepthPacking:A.depthPacking>=0,depthPacking:A.depthPacking||0,index0AttributeName:A.index0AttributeName,extensionClipCullDistance:je&&A.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(je&&A.extensions.multiDraw===!0||X)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:A.customProgramCacheKey()};return Xe.vertexUv1s=u.has(1),Xe.vertexUv2s=u.has(2),Xe.vertexUv3s=u.has(3),u.clear(),Xe}function g(A){const S=[];if(A.shaderID?S.push(A.shaderID):(S.push(A.customVertexShaderID),S.push(A.customFragmentShaderID)),A.defines!==void 0)for(const C in A.defines)S.push(C),S.push(A.defines[C]);return A.isRawShaderMaterial===!1&&(y(S,A),_(S,A),S.push(r.outputColorSpace)),S.push(A.customProgramCacheKey),S.join()}function y(A,S){A.push(S.precision),A.push(S.outputColorSpace),A.push(S.envMapMode),A.push(S.envMapCubeUVHeight),A.push(S.mapUv),A.push(S.alphaMapUv),A.push(S.lightMapUv),A.push(S.aoMapUv),A.push(S.bumpMapUv),A.push(S.normalMapUv),A.push(S.displacementMapUv),A.push(S.emissiveMapUv),A.push(S.metalnessMapUv),A.push(S.roughnessMapUv),A.push(S.anisotropyMapUv),A.push(S.clearcoatMapUv),A.push(S.clearcoatNormalMapUv),A.push(S.clearcoatRoughnessMapUv),A.push(S.iridescenceMapUv),A.push(S.iridescenceThicknessMapUv),A.push(S.sheenColorMapUv),A.push(S.sheenRoughnessMapUv),A.push(S.specularMapUv),A.push(S.specularColorMapUv),A.push(S.specularIntensityMapUv),A.push(S.transmissionMapUv),A.push(S.thicknessMapUv),A.push(S.combine),A.push(S.fogExp2),A.push(S.sizeAttenuation),A.push(S.morphTargetsCount),A.push(S.morphAttributeCount),A.push(S.numDirLights),A.push(S.numPointLights),A.push(S.numSpotLights),A.push(S.numSpotLightMaps),A.push(S.numHemiLights),A.push(S.numRectAreaLights),A.push(S.numDirLightShadows),A.push(S.numPointLightShadows),A.push(S.numSpotLightShadows),A.push(S.numSpotLightShadowsWithMaps),A.push(S.numLightProbes),A.push(S.shadowMapType),A.push(S.toneMapping),A.push(S.numClippingPlanes),A.push(S.numClipIntersection),A.push(S.depthPacking)}function _(A,S){o.disableAll(),S.supportsVertexTextures&&o.enable(0),S.instancing&&o.enable(1),S.instancingColor&&o.enable(2),S.instancingMorph&&o.enable(3),S.matcap&&o.enable(4),S.envMap&&o.enable(5),S.normalMapObjectSpace&&o.enable(6),S.normalMapTangentSpace&&o.enable(7),S.clearcoat&&o.enable(8),S.iridescence&&o.enable(9),S.alphaTest&&o.enable(10),S.vertexColors&&o.enable(11),S.vertexAlphas&&o.enable(12),S.vertexUv1s&&o.enable(13),S.vertexUv2s&&o.enable(14),S.vertexUv3s&&o.enable(15),S.vertexTangents&&o.enable(16),S.anisotropy&&o.enable(17),S.alphaHash&&o.enable(18),S.batching&&o.enable(19),S.dispersion&&o.enable(20),S.batchingColor&&o.enable(21),A.push(o.mask),o.disableAll(),S.fog&&o.enable(0),S.useFog&&o.enable(1),S.flatShading&&o.enable(2),S.logarithmicDepthBuffer&&o.enable(3),S.reverseDepthBuffer&&o.enable(4),S.skinning&&o.enable(5),S.morphTargets&&o.enable(6),S.morphNormals&&o.enable(7),S.morphColors&&o.enable(8),S.premultipliedAlpha&&o.enable(9),S.shadowMapEnabled&&o.enable(10),S.doubleSided&&o.enable(11),S.flipSided&&o.enable(12),S.useDepthPacking&&o.enable(13),S.dithering&&o.enable(14),S.transmission&&o.enable(15),S.sheen&&o.enable(16),S.opaque&&o.enable(17),S.pointsUvs&&o.enable(18),S.decodeVideoTexture&&o.enable(19),S.decodeVideoTextureEmissive&&o.enable(20),S.alphaToCoverage&&o.enable(21),A.push(o.mask)}function x(A){const S=p[A.type];let C;if(S){const R=Qa[S];C=fz.clone(R.uniforms)}else C=A.uniforms;return C}function E(A,S){let C;for(let R=0,P=c.length;R<P;R++){const M=c[R];if(M.cacheKey===S){C=M,++C.usedTimes;break}}return C===void 0&&(C=new bre(r,S,A,a),c.push(C)),C}function T(A){if(--A.usedTimes===0){const S=c.indexOf(A);c[S]=c[c.length-1],c.pop(),A.destroy()}}function b(A){l.remove(A)}function w(){l.dispose()}return{getParameters:v,getProgramCacheKey:g,getUniforms:x,acquireProgram:E,releaseProgram:T,releaseShaderCache:b,programs:c,dispose:w}}function Are(){let r=new WeakMap;function e(s){return r.has(s)}function t(s){let o=r.get(s);return o===void 0&&(o={},r.set(s,o)),o}function n(s){r.delete(s)}function i(s,o,l){r.get(s)[o]=l}function a(){r=new WeakMap}return{has:e,get:t,remove:n,update:i,dispose:a}}function Mre(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function sF(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function oF(){const r=[];let e=0;const t=[],n=[],i=[];function a(){e=0,t.length=0,n.length=0,i.length=0}function s(h,d,f,p,m,v){let g=r[e];return g===void 0?(g={id:h.id,object:h,geometry:d,material:f,groupOrder:p,renderOrder:h.renderOrder,z:m,group:v},r[e]=g):(g.id=h.id,g.object=h,g.geometry=d,g.material=f,g.groupOrder=p,g.renderOrder=h.renderOrder,g.z=m,g.group=v),e++,g}function o(h,d,f,p,m,v){const g=s(h,d,f,p,m,v);f.transmission>0?n.push(g):f.transparent===!0?i.push(g):t.push(g)}function l(h,d,f,p,m,v){const g=s(h,d,f,p,m,v);f.transmission>0?n.unshift(g):f.transparent===!0?i.unshift(g):t.unshift(g)}function u(h,d){t.length>1&&t.sort(h||Mre),n.length>1&&n.sort(d||sF),i.length>1&&i.sort(d||sF)}function c(){for(let h=e,d=r.length;h<d;h++){const f=r[h];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:t,transmissive:n,transparent:i,init:a,push:o,unshift:l,finish:c,sort:u}}function Cre(){let r=new WeakMap;function e(n,i){const a=r.get(n);let s;return a===void 0?(s=new oF,r.set(n,[s])):i>=a.length?(s=new oF,a.push(s)):s=a[i],s}function t(){r=new WeakMap}return{get:e,dispose:t}}function Rre(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new re,color:new ct};break;case"SpotLight":t={position:new re,direction:new re,color:new ct,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new re,color:new ct,distance:0,decay:0};break;case"HemisphereLight":t={direction:new re,skyColor:new ct,groundColor:new ct};break;case"RectAreaLight":t={color:new ct,position:new re,halfWidth:new re,halfHeight:new re};break}return r[e.id]=t,t}}}function Nre(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new He};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new He};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new He,shadowCameraNear:1,shadowCameraFar:1e3};break}return r[e.id]=t,t}}}let Pre=0;function Dre(r,e){return(e.castShadow?2:0)-(r.castShadow?2:0)+(e.map?1:0)-(r.map?1:0)}function Lre(r){const e=new Rre,t=Nre(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)n.probe.push(new re);const i=new re,a=new Ut,s=new Ut;function o(u){let c=0,h=0,d=0;for(let A=0;A<9;A++)n.probe[A].set(0,0,0);let f=0,p=0,m=0,v=0,g=0,y=0,_=0,x=0,E=0,T=0,b=0;u.sort(Dre);for(let A=0,S=u.length;A<S;A++){const C=u[A],R=C.color,P=C.intensity,M=C.distance,N=C.shadow&&C.shadow.map?C.shadow.map.texture:null;if(C.isAmbientLight)c+=R.r*P,h+=R.g*P,d+=R.b*P;else if(C.isLightProbe){for(let D=0;D<9;D++)n.probe[D].addScaledVector(C.sh.coefficients[D],P);b++}else if(C.isDirectionalLight){const D=e.get(C);if(D.color.copy(C.color).multiplyScalar(C.intensity),C.castShadow){const I=C.shadow,L=t.get(C);L.shadowIntensity=I.intensity,L.shadowBias=I.bias,L.shadowNormalBias=I.normalBias,L.shadowRadius=I.radius,L.shadowMapSize=I.mapSize,n.directionalShadow[f]=L,n.directionalShadowMap[f]=N,n.directionalShadowMatrix[f]=C.shadow.matrix,y++}n.directional[f]=D,f++}else if(C.isSpotLight){const D=e.get(C);D.position.setFromMatrixPosition(C.matrixWorld),D.color.copy(R).multiplyScalar(P),D.distance=M,D.coneCos=Math.cos(C.angle),D.penumbraCos=Math.cos(C.angle*(1-C.penumbra)),D.decay=C.decay,n.spot[m]=D;const I=C.shadow;if(C.map&&(n.spotLightMap[E]=C.map,E++,I.updateMatrices(C),C.castShadow&&T++),n.spotLightMatrix[m]=I.matrix,C.castShadow){const L=t.get(C);L.shadowIntensity=I.intensity,L.shadowBias=I.bias,L.shadowNormalBias=I.normalBias,L.shadowRadius=I.radius,L.shadowMapSize=I.mapSize,n.spotShadow[m]=L,n.spotShadowMap[m]=N,x++}m++}else if(C.isRectAreaLight){const D=e.get(C);D.color.copy(R).multiplyScalar(P),D.halfWidth.set(C.width*.5,0,0),D.halfHeight.set(0,C.height*.5,0),n.rectArea[v]=D,v++}else if(C.isPointLight){const D=e.get(C);if(D.color.copy(C.color).multiplyScalar(C.intensity),D.distance=C.distance,D.decay=C.decay,C.castShadow){const I=C.shadow,L=t.get(C);L.shadowIntensity=I.intensity,L.shadowBias=I.bias,L.shadowNormalBias=I.normalBias,L.shadowRadius=I.radius,L.shadowMapSize=I.mapSize,L.shadowCameraNear=I.camera.near,L.shadowCameraFar=I.camera.far,n.pointShadow[p]=L,n.pointShadowMap[p]=N,n.pointShadowMatrix[p]=C.shadow.matrix,_++}n.point[p]=D,p++}else if(C.isHemisphereLight){const D=e.get(C);D.skyColor.copy(C.color).multiplyScalar(P),D.groundColor.copy(C.groundColor).multiplyScalar(P),n.hemi[g]=D,g++}}v>0&&(r.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=it.LTC_FLOAT_1,n.rectAreaLTC2=it.LTC_FLOAT_2):(n.rectAreaLTC1=it.LTC_HALF_1,n.rectAreaLTC2=it.LTC_HALF_2)),n.ambient[0]=c,n.ambient[1]=h,n.ambient[2]=d;const w=n.hash;(w.directionalLength!==f||w.pointLength!==p||w.spotLength!==m||w.rectAreaLength!==v||w.hemiLength!==g||w.numDirectionalShadows!==y||w.numPointShadows!==_||w.numSpotShadows!==x||w.numSpotMaps!==E||w.numLightProbes!==b)&&(n.directional.length=f,n.spot.length=m,n.rectArea.length=v,n.point.length=p,n.hemi.length=g,n.directionalShadow.length=y,n.directionalShadowMap.length=y,n.pointShadow.length=_,n.pointShadowMap.length=_,n.spotShadow.length=x,n.spotShadowMap.length=x,n.directionalShadowMatrix.length=y,n.pointShadowMatrix.length=_,n.spotLightMatrix.length=x+E-T,n.spotLightMap.length=E,n.numSpotLightShadowsWithMaps=T,n.numLightProbes=b,w.directionalLength=f,w.pointLength=p,w.spotLength=m,w.rectAreaLength=v,w.hemiLength=g,w.numDirectionalShadows=y,w.numPointShadows=_,w.numSpotShadows=x,w.numSpotMaps=E,w.numLightProbes=b,n.version=Pre++)}function l(u,c){let h=0,d=0,f=0,p=0,m=0;const v=c.matrixWorldInverse;for(let g=0,y=u.length;g<y;g++){const _=u[g];if(_.isDirectionalLight){const x=n.directional[h];x.direction.setFromMatrixPosition(_.matrixWorld),i.setFromMatrixPosition(_.target.matrixWorld),x.direction.sub(i),x.direction.transformDirection(v),h++}else if(_.isSpotLight){const x=n.spot[f];x.position.setFromMatrixPosition(_.matrixWorld),x.position.applyMatrix4(v),x.direction.setFromMatrixPosition(_.matrixWorld),i.setFromMatrixPosition(_.target.matrixWorld),x.direction.sub(i),x.direction.transformDirection(v),f++}else if(_.isRectAreaLight){const x=n.rectArea[p];x.position.setFromMatrixPosition(_.matrixWorld),x.position.applyMatrix4(v),s.identity(),a.copy(_.matrixWorld),a.premultiply(v),s.extractRotation(a),x.halfWidth.set(_.width*.5,0,0),x.halfHeight.set(0,_.height*.5,0),x.halfWidth.applyMatrix4(s),x.halfHeight.applyMatrix4(s),p++}else if(_.isPointLight){const x=n.point[d];x.position.setFromMatrixPosition(_.matrixWorld),x.position.applyMatrix4(v),d++}else if(_.isHemisphereLight){const x=n.hemi[m];x.direction.setFromMatrixPosition(_.matrixWorld),x.direction.transformDirection(v),m++}}}return{setup:o,setupView:l,state:n}}function lF(r){const e=new Lre(r),t=[],n=[];function i(c){u.camera=c,t.length=0,n.length=0}function a(c){t.push(c)}function s(c){n.push(c)}function o(){e.setup(t)}function l(c){e.setupView(t,c)}const u={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:u,setupLights:o,setupLightsView:l,pushLight:a,pushShadow:s}}function Ire(r){let e=new WeakMap;function t(i,a=0){const s=e.get(i);let o;return s===void 0?(o=new lF(r),e.set(i,[o])):a>=s.length?(o=new lF(r),s.push(o)):o=s[a],o}function n(){e=new WeakMap}return{get:t,dispose:n}}const Ore=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Fre=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Bre(r,e,t){let n=new hm;const i=new He,a=new He,s=new xt,o=new KZ({depthPacking:bQ}),l=new QZ,u={},c=t.maxTextureSize,h={[yi]:dn,[dn]:yi,[Qr]:Qr},d=new ss({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new He},radius:{value:4}},vertexShader:Ore,fragmentShader:Fre}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const p=new ri;p.setAttribute("position",new Rr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Yn(p,d),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=bA;let g=this.type;this.render=function(T,b,w){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||T.length===0)return;const A=r.getRenderTarget(),S=r.getActiveCubeFace(),C=r.getActiveMipmapLevel(),R=r.state;R.setBlending(_i),R.buffers.color.setClear(1,1,1,1),R.buffers.depth.setTest(!0),R.setScissorTest(!1);const P=g!==Fi&&this.type===Fi,M=g===Fi&&this.type!==Fi;for(let N=0,D=T.length;N<D;N++){const I=T[N],L=I.shadow;if(L===void 0){console.warn("THREE.WebGLShadowMap:",I,"has no shadow.");continue}if(L.autoUpdate===!1&&L.needsUpdate===!1)continue;i.copy(L.mapSize);const z=L.getFrameExtents();if(i.multiply(z),a.copy(L.mapSize),(i.x>c||i.y>c)&&(i.x>c&&(a.x=Math.floor(c/z.x),i.x=a.x*z.x,L.mapSize.x=a.x),i.y>c&&(a.y=Math.floor(c/z.y),i.y=a.y*z.y,L.mapSize.y=a.y)),L.map===null||P===!0||M===!0){const k=this.type!==Fi?{minFilter:mn,magFilter:mn}:{};L.map!==null&&L.map.dispose(),L.map=new Xo(i.x,i.y,k),L.map.texture.name=I.name+".shadowMap",L.camera.updateProjectionMatrix()}r.setRenderTarget(L.map),r.clear();const B=L.getViewportCount();for(let k=0;k<B;k++){const U=L.getViewport(k);s.set(a.x*U.x,a.y*U.y,a.x*U.z,a.y*U.w),R.viewport(s),L.updateMatrices(I,k),n=L.getFrustum(),x(b,w,L.camera,I,this.type)}L.isPointLightShadow!==!0&&this.type===Fi&&y(L,w),L.needsUpdate=!1}g=this.type,v.needsUpdate=!1,r.setRenderTarget(A,S,C)};function y(T,b){const w=e.update(m);d.defines.VSM_SAMPLES!==T.blurSamples&&(d.defines.VSM_SAMPLES=T.blurSamples,f.defines.VSM_SAMPLES=T.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),T.mapPass===null&&(T.mapPass=new Xo(i.x,i.y)),d.uniforms.shadow_pass.value=T.map.texture,d.uniforms.resolution.value=T.mapSize,d.uniforms.radius.value=T.radius,r.setRenderTarget(T.mapPass),r.clear(),r.renderBufferDirect(b,null,w,d,m,null),f.uniforms.shadow_pass.value=T.mapPass.texture,f.uniforms.resolution.value=T.mapSize,f.uniforms.radius.value=T.radius,r.setRenderTarget(T.map),r.clear(),r.renderBufferDirect(b,null,w,f,m,null)}function _(T,b,w,A){let S=null;const C=w.isPointLight===!0?T.customDistanceMaterial:T.customDepthMaterial;if(C!==void 0)S=C;else if(S=w.isPointLight===!0?l:o,r.localClippingEnabled&&b.clipShadows===!0&&Array.isArray(b.clippingPlanes)&&b.clippingPlanes.length!==0||b.displacementMap&&b.displacementScale!==0||b.alphaMap&&b.alphaTest>0||b.map&&b.alphaTest>0){const R=S.uuid,P=b.uuid;let M=u[R];M===void 0&&(M={},u[R]=M);let N=M[P];N===void 0&&(N=S.clone(),M[P]=N,b.addEventListener("dispose",E)),S=N}if(S.visible=b.visible,S.wireframe=b.wireframe,A===Fi?S.side=b.shadowSide!==null?b.shadowSide:b.side:S.side=b.shadowSide!==null?b.shadowSide:h[b.side],S.alphaMap=b.alphaMap,S.alphaTest=b.alphaTest,S.map=b.map,S.clipShadows=b.clipShadows,S.clippingPlanes=b.clippingPlanes,S.clipIntersection=b.clipIntersection,S.displacementMap=b.displacementMap,S.displacementScale=b.displacementScale,S.displacementBias=b.displacementBias,S.wireframeLinewidth=b.wireframeLinewidth,S.linewidth=b.linewidth,w.isPointLight===!0&&S.isMeshDistanceMaterial===!0){const R=r.properties.get(S);R.light=w}return S}function x(T,b,w,A,S){if(T.visible===!1)return;if(T.layers.test(b.layers)&&(T.isMesh||T.isLine||T.isPoints)&&(T.castShadow||T.receiveShadow&&S===Fi)&&(!T.frustumCulled||n.intersectsObject(T))){T.modelViewMatrix.multiplyMatrices(w.matrixWorldInverse,T.matrixWorld);const P=e.update(T),M=T.material;if(Array.isArray(M)){const N=P.groups;for(let D=0,I=N.length;D<I;D++){const L=N[D],z=M[L.materialIndex];if(z&&z.visible){const B=_(T,z,A,S);T.onBeforeShadow(r,T,b,w,P,B,L),r.renderBufferDirect(w,null,P,B,T,L),T.onAfterShadow(r,T,b,w,P,B,L)}}}else if(M.visible){const N=_(T,M,A,S);T.onBeforeShadow(r,T,b,w,P,N,null),r.renderBufferDirect(w,null,P,N,T,null),T.onAfterShadow(r,T,b,w,P,N,null)}}const R=T.children;for(let P=0,M=R.length;P<M;P++)x(R[P],b,w,A,S)}function E(T){T.target.removeEventListener("dispose",E);for(const w in u){const A=u[w],S=T.target.uuid;S in A&&(A[S].dispose(),delete A[S])}}}const Ure={[Bf]:Uf,[kf]:Vf,[Gf]:Hf,[Ho]:zf,[Uf]:Bf,[Vf]:kf,[Hf]:Gf,[zf]:Ho};function kre(r,e){function t(){let J=!1;const ve=new xt;let ue=null;const _e=new xt(0,0,0,0);return{setMask:function(ke){ue!==ke&&!J&&(r.colorMask(ke,ke,ke,ke),ue=ke)},setLocked:function(ke){J=ke},setClear:function(ke,Ie,je,$e,Xe){Xe===!0&&(ke*=$e,Ie*=$e,je*=$e),ve.set(ke,Ie,je,$e),_e.equals(ve)===!1&&(r.clearColor(ke,Ie,je,$e),_e.copy(ve))},reset:function(){J=!1,ue=null,_e.set(-1,0,0,0)}}}function n(){let J=!1,ve=!1,ue=null,_e=null,ke=null;return{setReversed:function(Ie){if(ve!==Ie){const je=e.get("EXT_clip_control");Ie?je.clipControlEXT(je.LOWER_LEFT_EXT,je.ZERO_TO_ONE_EXT):je.clipControlEXT(je.LOWER_LEFT_EXT,je.NEGATIVE_ONE_TO_ONE_EXT),ve=Ie;const $e=ke;ke=null,this.setClear($e)}},getReversed:function(){return ve},setTest:function(Ie){Ie?$(r.DEPTH_TEST):Z(r.DEPTH_TEST)},setMask:function(Ie){ue!==Ie&&!J&&(r.depthMask(Ie),ue=Ie)},setFunc:function(Ie){if(ve&&(Ie=Ure[Ie]),_e!==Ie){switch(Ie){case Bf:r.depthFunc(r.NEVER);break;case Uf:r.depthFunc(r.ALWAYS);break;case kf:r.depthFunc(r.LESS);break;case Ho:r.depthFunc(r.LEQUAL);break;case Gf:r.depthFunc(r.EQUAL);break;case zf:r.depthFunc(r.GEQUAL);break;case Vf:r.depthFunc(r.GREATER);break;case Hf:r.depthFunc(r.NOTEQUAL);break;default:r.depthFunc(r.LEQUAL)}_e=Ie}},setLocked:function(Ie){J=Ie},setClear:function(Ie){ke!==Ie&&(ve&&(Ie=1-Ie),r.clearDepth(Ie),ke=Ie)},reset:function(){J=!1,ue=null,_e=null,ke=null,ve=!1}}}function i(){let J=!1,ve=null,ue=null,_e=null,ke=null,Ie=null,je=null,$e=null,Xe=null;return{setTest:function(Je){J||(Je?$(r.STENCIL_TEST):Z(r.STENCIL_TEST))},setMask:function(Je){ve!==Je&&!J&&(r.stencilMask(Je),ve=Je)},setFunc:function(Je,nt,at){(ue!==Je||_e!==nt||ke!==at)&&(r.stencilFunc(Je,nt,at),ue=Je,_e=nt,ke=at)},setOp:function(Je,nt,at){(Ie!==Je||je!==nt||$e!==at)&&(r.stencilOp(Je,nt,at),Ie=Je,je=nt,$e=at)},setLocked:function(Je){J=Je},setClear:function(Je){Xe!==Je&&(r.clearStencil(Je),Xe=Je)},reset:function(){J=!1,ve=null,ue=null,_e=null,ke=null,Ie=null,je=null,$e=null,Xe=null}}}const a=new t,s=new n,o=new i,l=new WeakMap,u=new WeakMap;let c={},h={},d=new WeakMap,f=[],p=null,m=!1,v=null,g=null,y=null,_=null,x=null,E=null,T=null,b=new ct(0,0,0),w=0,A=!1,S=null,C=null,R=null,P=null,M=null;const N=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let D=!1,I=0;const L=r.getParameter(r.VERSION);L.indexOf("WebGL")!==-1?(I=parseFloat(/^WebGL (\d)/.exec(L)[1]),D=I>=1):L.indexOf("OpenGL ES")!==-1&&(I=parseFloat(/^OpenGL ES (\d)/.exec(L)[1]),D=I>=2);let z=null,B={};const k=r.getParameter(r.SCISSOR_BOX),U=r.getParameter(r.VIEWPORT),G=new xt().fromArray(k),O=new xt().fromArray(U);function F(J,ve,ue,_e){const ke=new Uint8Array(4),Ie=r.createTexture();r.bindTexture(J,Ie),r.texParameteri(J,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(J,r.TEXTURE_MAG_FILTER,r.NEAREST);for(let je=0;je<ue;je++)J===r.TEXTURE_3D||J===r.TEXTURE_2D_ARRAY?r.texImage3D(ve,0,r.RGBA,1,1,_e,0,r.RGBA,r.UNSIGNED_BYTE,ke):r.texImage2D(ve+je,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,ke);return Ie}const V={};V[r.TEXTURE_2D]=F(r.TEXTURE_2D,r.TEXTURE_2D,1),V[r.TEXTURE_CUBE_MAP]=F(r.TEXTURE_CUBE_MAP,r.TEXTURE_CUBE_MAP_POSITIVE_X,6),V[r.TEXTURE_2D_ARRAY]=F(r.TEXTURE_2D_ARRAY,r.TEXTURE_2D_ARRAY,1,1),V[r.TEXTURE_3D]=F(r.TEXTURE_3D,r.TEXTURE_3D,1,1),a.setClear(0,0,0,1),s.setClear(1),o.setClear(0),$(r.DEPTH_TEST),s.setFunc(Ho),Be(!1),we(Ww),$(r.CULL_FACE),W(_i);function $(J){c[J]!==!0&&(r.enable(J),c[J]=!0)}function Z(J){c[J]!==!1&&(r.disable(J),c[J]=!1)}function Y(J,ve){return h[J]!==ve?(r.bindFramebuffer(J,ve),h[J]=ve,J===r.DRAW_FRAMEBUFFER&&(h[r.FRAMEBUFFER]=ve),J===r.FRAMEBUFFER&&(h[r.DRAW_FRAMEBUFFER]=ve),!0):!1}function X(J,ve){let ue=f,_e=!1;if(J){ue=d.get(ve),ue===void 0&&(ue=[],d.set(ve,ue));const ke=J.textures;if(ue.length!==ke.length||ue[0]!==r.COLOR_ATTACHMENT0){for(let Ie=0,je=ke.length;Ie<je;Ie++)ue[Ie]=r.COLOR_ATTACHMENT0+Ie;ue.length=ke.length,_e=!0}}else ue[0]!==r.BACK&&(ue[0]=r.BACK,_e=!0);_e&&r.drawBuffers(ue)}function K(J){return p!==J?(r.useProgram(J),p=J,!0):!1}const se={[Br]:r.FUNC_ADD,[EA]:r.FUNC_SUBTRACT,[TA]:r.FUNC_REVERSE_SUBTRACT};se[QG]=r.MIN,se[ZG]=r.MAX;const oe={[As]:r.ZERO,[wA]:r.ONE,[SA]:r.SRC_COLOR,[Of]:r.SRC_ALPHA,[PA]:r.SRC_ALPHA_SATURATE,[RA]:r.DST_COLOR,[MA]:r.DST_ALPHA,[AA]:r.ONE_MINUS_SRC_COLOR,[Ff]:r.ONE_MINUS_SRC_ALPHA,[NA]:r.ONE_MINUS_DST_COLOR,[CA]:r.ONE_MINUS_DST_ALPHA,[pQ]:r.CONSTANT_COLOR,[gQ]:r.ONE_MINUS_CONSTANT_COLOR,[vQ]:r.CONSTANT_ALPHA,[mQ]:r.ONE_MINUS_CONSTANT_ALPHA};function W(J,ve,ue,_e,ke,Ie,je,$e,Xe,Je){if(J===_i){m===!0&&(Z(r.BLEND),m=!1);return}if(m===!1&&($(r.BLEND),m=!0),J!==hc){if(J!==v||Je!==A){if((g!==Br||x!==Br)&&(r.blendEquation(r.FUNC_ADD),g=Br,x=Br),Je)switch(J){case aa:r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case wc:r.blendFunc(r.ONE,r.ONE);break;case Sc:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case Ac:r.blendFuncSeparate(r.ZERO,r.SRC_COLOR,r.ZERO,r.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",J);break}else switch(J){case aa:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case wc:r.blendFunc(r.SRC_ALPHA,r.ONE);break;case Sc:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case Ac:r.blendFunc(r.ZERO,r.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",J);break}y=null,_=null,E=null,T=null,b.set(0,0,0),w=0,v=J,A=Je}return}ke=ke||ve,Ie=Ie||ue,je=je||_e,(ve!==g||ke!==x)&&(r.blendEquationSeparate(se[ve],se[ke]),g=ve,x=ke),(ue!==y||_e!==_||Ie!==E||je!==T)&&(r.blendFuncSeparate(oe[ue],oe[_e],oe[Ie],oe[je]),y=ue,_=_e,E=Ie,T=je),($e.equals(b)===!1||Xe!==w)&&(r.blendColor($e.r,$e.g,$e.b,Xe),b.copy($e),w=Xe),v=J,A=!1}function Ne(J,ve){J.side===Qr?Z(r.CULL_FACE):$(r.CULL_FACE);let ue=J.side===dn;ve&&(ue=!ue),Be(ue),J.blending===aa&&J.transparent===!1?W(_i):W(J.blending,J.blendEquation,J.blendSrc,J.blendDst,J.blendEquationAlpha,J.blendSrcAlpha,J.blendDstAlpha,J.blendColor,J.blendAlpha,J.premultipliedAlpha),s.setFunc(J.depthFunc),s.setTest(J.depthTest),s.setMask(J.depthWrite),a.setMask(J.colorWrite);const _e=J.stencilWrite;o.setTest(_e),_e&&(o.setMask(J.stencilWriteMask),o.setFunc(J.stencilFunc,J.stencilRef,J.stencilFuncMask),o.setOp(J.stencilFail,J.stencilZFail,J.stencilZPass)),Me(J.polygonOffset,J.polygonOffsetFactor,J.polygonOffsetUnits),J.alphaToCoverage===!0?$(r.SAMPLE_ALPHA_TO_COVERAGE):Z(r.SAMPLE_ALPHA_TO_COVERAGE)}function Be(J){S!==J&&(J?r.frontFace(r.CW):r.frontFace(r.CCW),S=J)}function we(J){J!==jG?($(r.CULL_FACE),J!==C&&(J===Ww?r.cullFace(r.BACK):J===KG?r.cullFace(r.FRONT):r.cullFace(r.FRONT_AND_BACK))):Z(r.CULL_FACE),C=J}function pe(J){J!==R&&(D&&r.lineWidth(J),R=J)}function Me(J,ve,ue){J?($(r.POLYGON_OFFSET_FILL),(P!==ve||M!==ue)&&(r.polygonOffset(ve,ue),P=ve,M=ue)):Z(r.POLYGON_OFFSET_FILL)}function Ae(J){J?$(r.SCISSOR_TEST):Z(r.SCISSOR_TEST)}function j(J){J===void 0&&(J=r.TEXTURE0+N-1),z!==J&&(r.activeTexture(J),z=J)}function H(J,ve,ue){ue===void 0&&(z===null?ue=r.TEXTURE0+N-1:ue=z);let _e=B[ue];_e===void 0&&(_e={type:void 0,texture:void 0},B[ue]=_e),(_e.type!==J||_e.texture!==ve)&&(z!==ue&&(r.activeTexture(ue),z=ue),r.bindTexture(J,ve||V[J]),_e.type=J,_e.texture=ve)}function te(){const J=B[z];J!==void 0&&J.type!==void 0&&(r.bindTexture(J.type,null),J.type=void 0,J.texture=void 0)}function me(){try{r.compressedTexImage2D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function Ee(){try{r.compressedTexImage3D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function le(){try{r.texSubImage2D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function q(){try{r.texSubImage3D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function ne(){try{r.compressedTexSubImage2D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function fe(){try{r.compressedTexSubImage3D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function ce(){try{r.texStorage2D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function ae(){try{r.texStorage3D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function ie(){try{r.texImage2D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function ee(){try{r.texImage3D(...arguments)}catch(J){console.error("THREE.WebGLState:",J)}}function he(J){G.equals(J)===!1&&(r.scissor(J.x,J.y,J.z,J.w),G.copy(J))}function ge(J){O.equals(J)===!1&&(r.viewport(J.x,J.y,J.z,J.w),O.copy(J))}function Te(J,ve){let ue=u.get(ve);ue===void 0&&(ue=new WeakMap,u.set(ve,ue));let _e=ue.get(J);_e===void 0&&(_e=r.getUniformBlockIndex(ve,J.name),ue.set(J,_e))}function Se(J,ve){const _e=u.get(ve).get(J);l.get(ve)!==_e&&(r.uniformBlockBinding(ve,_e,J.__bindingPointIndex),l.set(ve,_e))}function Oe(){r.disable(r.BLEND),r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SCISSOR_TEST),r.disable(r.STENCIL_TEST),r.disable(r.SAMPLE_ALPHA_TO_COVERAGE),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ZERO),r.blendFuncSeparate(r.ONE,r.ZERO,r.ONE,r.ZERO),r.blendColor(0,0,0,0),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(r.LESS),s.setReversed(!1),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(r.ALWAYS,0,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.clearStencil(0),r.cullFace(r.BACK),r.frontFace(r.CCW),r.polygonOffset(0,0),r.activeTexture(r.TEXTURE0),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),c={},z=null,B={},h={},d=new WeakMap,f=[],p=null,m=!1,v=null,g=null,y=null,_=null,x=null,E=null,T=null,b=new ct(0,0,0),w=0,A=!1,S=null,C=null,R=null,P=null,M=null,G.set(0,0,r.canvas.width,r.canvas.height),O.set(0,0,r.canvas.width,r.canvas.height),a.reset(),s.reset(),o.reset()}return{buffers:{color:a,depth:s,stencil:o},enable:$,disable:Z,bindFramebuffer:Y,drawBuffers:X,useProgram:K,setBlending:W,setMaterial:Ne,setFlipSided:Be,setCullFace:we,setLineWidth:pe,setPolygonOffset:Me,setScissorTest:Ae,activeTexture:j,bindTexture:H,unbindTexture:te,compressedTexImage2D:me,compressedTexImage3D:Ee,texImage2D:ie,texImage3D:ee,updateUBOMapping:Te,uniformBlockBinding:Se,texStorage2D:ce,texStorage3D:ae,texSubImage2D:le,texSubImage3D:q,compressedTexSubImage2D:ne,compressedTexSubImage3D:fe,scissor:he,viewport:ge,reset:Oe}}function Gre(r,e,t,n,i,a,s){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new He,c=new WeakMap;let h;const d=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function p(j,H){return f?new OffscreenCanvas(j,H):Zf("canvas")}function m(j,H,te){let me=1;const Ee=Ae(j);if((Ee.width>te||Ee.height>te)&&(me=te/Math.max(Ee.width,Ee.height)),me<1)if(typeof HTMLImageElement<"u"&&j instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&j instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&j instanceof ImageBitmap||typeof VideoFrame<"u"&&j instanceof VideoFrame){const le=Math.floor(me*Ee.width),q=Math.floor(me*Ee.height);h===void 0&&(h=p(le,q));const ne=H?p(le,q):h;return ne.width=le,ne.height=q,ne.getContext("2d").drawImage(j,0,0,le,q),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Ee.width+"x"+Ee.height+") to ("+le+"x"+q+")."),ne}else return"data"in j&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Ee.width+"x"+Ee.height+")."),j;return j}function v(j){return j.generateMipmaps}function g(j){r.generateMipmap(j)}function y(j){return j.isWebGLCubeRenderTarget?r.TEXTURE_CUBE_MAP:j.isWebGL3DRenderTarget?r.TEXTURE_3D:j.isWebGLArrayRenderTarget||j.isCompressedArrayTexture?r.TEXTURE_2D_ARRAY:r.TEXTURE_2D}function _(j,H,te,me,Ee=!1){if(j!==null){if(r[j]!==void 0)return r[j];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+j+"'")}let le=H;if(H===r.RED&&(te===r.FLOAT&&(le=r.R32F),te===r.HALF_FLOAT&&(le=r.R16F),te===r.UNSIGNED_BYTE&&(le=r.R8)),H===r.RED_INTEGER&&(te===r.UNSIGNED_BYTE&&(le=r.R8UI),te===r.UNSIGNED_SHORT&&(le=r.R16UI),te===r.UNSIGNED_INT&&(le=r.R32UI),te===r.BYTE&&(le=r.R8I),te===r.SHORT&&(le=r.R16I),te===r.INT&&(le=r.R32I)),H===r.RG&&(te===r.FLOAT&&(le=r.RG32F),te===r.HALF_FLOAT&&(le=r.RG16F),te===r.UNSIGNED_BYTE&&(le=r.RG8)),H===r.RG_INTEGER&&(te===r.UNSIGNED_BYTE&&(le=r.RG8UI),te===r.UNSIGNED_SHORT&&(le=r.RG16UI),te===r.UNSIGNED_INT&&(le=r.RG32UI),te===r.BYTE&&(le=r.RG8I),te===r.SHORT&&(le=r.RG16I),te===r.INT&&(le=r.RG32I)),H===r.RGB_INTEGER&&(te===r.UNSIGNED_BYTE&&(le=r.RGB8UI),te===r.UNSIGNED_SHORT&&(le=r.RGB16UI),te===r.UNSIGNED_INT&&(le=r.RGB32UI),te===r.BYTE&&(le=r.RGB8I),te===r.SHORT&&(le=r.RGB16I),te===r.INT&&(le=r.RGB32I)),H===r.RGBA_INTEGER&&(te===r.UNSIGNED_BYTE&&(le=r.RGBA8UI),te===r.UNSIGNED_SHORT&&(le=r.RGBA16UI),te===r.UNSIGNED_INT&&(le=r.RGBA32UI),te===r.BYTE&&(le=r.RGBA8I),te===r.SHORT&&(le=r.RGBA16I),te===r.INT&&(le=r.RGBA32I)),H===r.RGB&&te===r.UNSIGNED_INT_5_9_9_9_REV&&(le=r.RGB9_E5),H===r.RGBA){const q=Ee?Jg:Dt.getTransfer(me);te===r.FLOAT&&(le=r.RGBA32F),te===r.HALF_FLOAT&&(le=r.RGBA16F),te===r.UNSIGNED_BYTE&&(le=q===en?r.SRGB8_ALPHA8:r.RGBA8),te===r.UNSIGNED_SHORT_4_4_4_4&&(le=r.RGBA4),te===r.UNSIGNED_SHORT_5_5_5_1&&(le=r.RGB5_A1)}return(le===r.R16F||le===r.R32F||le===r.RG16F||le===r.RG32F||le===r.RGBA16F||le===r.RGBA32F)&&e.get("EXT_color_buffer_float"),le}function x(j,H){let te;return j?H===null||H===hn||H===Gi?te=r.DEPTH24_STENCIL8:H===Un?te=r.DEPTH32F_STENCIL8:H===Pa&&(te=r.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):H===null||H===hn||H===Gi?te=r.DEPTH_COMPONENT24:H===Un?te=r.DEPTH_COMPONENT32F:H===Pa&&(te=r.DEPTH_COMPONENT16),te}function E(j,H){return v(j)===!0||j.isFramebufferTexture&&j.minFilter!==mn&&j.minFilter!==ir?Math.log2(Math.max(H.width,H.height))+1:j.mipmaps!==void 0&&j.mipmaps.length>0?j.mipmaps.length:j.isCompressedTexture&&Array.isArray(j.image)?H.mipmaps.length:1}function T(j){const H=j.target;H.removeEventListener("dispose",T),w(H),H.isVideoTexture&&c.delete(H)}function b(j){const H=j.target;H.removeEventListener("dispose",b),S(H)}function w(j){const H=n.get(j);if(H.__webglInit===void 0)return;const te=j.source,me=d.get(te);if(me){const Ee=me[H.__cacheKey];Ee.usedTimes--,Ee.usedTimes===0&&A(j),Object.keys(me).length===0&&d.delete(te)}n.remove(j)}function A(j){const H=n.get(j);r.deleteTexture(H.__webglTexture);const te=j.source,me=d.get(te);delete me[H.__cacheKey],s.memory.textures--}function S(j){const H=n.get(j);if(j.depthTexture&&(j.depthTexture.dispose(),n.remove(j.depthTexture)),j.isWebGLCubeRenderTarget)for(let me=0;me<6;me++){if(Array.isArray(H.__webglFramebuffer[me]))for(let Ee=0;Ee<H.__webglFramebuffer[me].length;Ee++)r.deleteFramebuffer(H.__webglFramebuffer[me][Ee]);else r.deleteFramebuffer(H.__webglFramebuffer[me]);H.__webglDepthbuffer&&r.deleteRenderbuffer(H.__webglDepthbuffer[me])}else{if(Array.isArray(H.__webglFramebuffer))for(let me=0;me<H.__webglFramebuffer.length;me++)r.deleteFramebuffer(H.__webglFramebuffer[me]);else r.deleteFramebuffer(H.__webglFramebuffer);if(H.__webglDepthbuffer&&r.deleteRenderbuffer(H.__webglDepthbuffer),H.__webglMultisampledFramebuffer&&r.deleteFramebuffer(H.__webglMultisampledFramebuffer),H.__webglColorRenderbuffer)for(let me=0;me<H.__webglColorRenderbuffer.length;me++)H.__webglColorRenderbuffer[me]&&r.deleteRenderbuffer(H.__webglColorRenderbuffer[me]);H.__webglDepthRenderbuffer&&r.deleteRenderbuffer(H.__webglDepthRenderbuffer)}const te=j.textures;for(let me=0,Ee=te.length;me<Ee;me++){const le=n.get(te[me]);le.__webglTexture&&(r.deleteTexture(le.__webglTexture),s.memory.textures--),n.remove(te[me])}n.remove(j)}let C=0;function R(){C=0}function P(){const j=C;return j>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+j+" texture units while this GPU supports only "+i.maxTextures),C+=1,j}function M(j){const H=[];return H.push(j.wrapS),H.push(j.wrapT),H.push(j.wrapR||0),H.push(j.magFilter),H.push(j.minFilter),H.push(j.anisotropy),H.push(j.internalFormat),H.push(j.format),H.push(j.type),H.push(j.generateMipmaps),H.push(j.premultiplyAlpha),H.push(j.flipY),H.push(j.unpackAlignment),H.push(j.colorSpace),H.join()}function N(j,H){const te=n.get(j);if(j.isVideoTexture&&pe(j),j.isRenderTargetTexture===!1&&j.version>0&&te.__version!==j.version){const me=j.image;if(me===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(me.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{O(te,j,H);return}}t.bindTexture(r.TEXTURE_2D,te.__webglTexture,r.TEXTURE0+H)}function D(j,H){const te=n.get(j);if(j.version>0&&te.__version!==j.version){O(te,j,H);return}t.bindTexture(r.TEXTURE_2D_ARRAY,te.__webglTexture,r.TEXTURE0+H)}function I(j,H){const te=n.get(j);if(j.version>0&&te.__version!==j.version){O(te,j,H);return}t.bindTexture(r.TEXTURE_3D,te.__webglTexture,r.TEXTURE0+H)}function L(j,H){const te=n.get(j);if(j.version>0&&te.__version!==j.version){F(te,j,H);return}t.bindTexture(r.TEXTURE_CUBE_MAP,te.__webglTexture,r.TEXTURE0+H)}const z={[jl]:r.REPEAT,[ts]:r.CLAMP_TO_EDGE,[Kl]:r.MIRRORED_REPEAT},B={[mn]:r.NEAREST,[LA]:r.NEAREST_MIPMAP_NEAREST,[Bs]:r.NEAREST_MIPMAP_LINEAR,[ir]:r.LINEAR,[fc]:r.LINEAR_MIPMAP_NEAREST,[fi]:r.LINEAR_MIPMAP_LINEAR},k={[UA]:r.NEVER,[HA]:r.ALWAYS,[sm]:r.LESS,[om]:r.LEQUAL,[kA]:r.EQUAL,[VA]:r.GEQUAL,[GA]:r.GREATER,[zA]:r.NOTEQUAL};function U(j,H){if(H.type===Un&&e.has("OES_texture_float_linear")===!1&&(H.magFilter===ir||H.magFilter===fc||H.magFilter===Bs||H.magFilter===fi||H.minFilter===ir||H.minFilter===fc||H.minFilter===Bs||H.minFilter===fi)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),r.texParameteri(j,r.TEXTURE_WRAP_S,z[H.wrapS]),r.texParameteri(j,r.TEXTURE_WRAP_T,z[H.wrapT]),(j===r.TEXTURE_3D||j===r.TEXTURE_2D_ARRAY)&&r.texParameteri(j,r.TEXTURE_WRAP_R,z[H.wrapR]),r.texParameteri(j,r.TEXTURE_MAG_FILTER,B[H.magFilter]),r.texParameteri(j,r.TEXTURE_MIN_FILTER,B[H.minFilter]),H.compareFunction&&(r.texParameteri(j,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(j,r.TEXTURE_COMPARE_FUNC,k[H.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(H.magFilter===mn||H.minFilter!==Bs&&H.minFilter!==fi||H.type===Un&&e.has("OES_texture_float_linear")===!1)return;if(H.anisotropy>1||n.get(H).__currentAnisotropy){const te=e.get("EXT_texture_filter_anisotropic");r.texParameterf(j,te.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(H.anisotropy,i.getMaxAnisotropy())),n.get(H).__currentAnisotropy=H.anisotropy}}}function G(j,H){let te=!1;j.__webglInit===void 0&&(j.__webglInit=!0,H.addEventListener("dispose",T));const me=H.source;let Ee=d.get(me);Ee===void 0&&(Ee={},d.set(me,Ee));const le=M(H);if(le!==j.__cacheKey){Ee[le]===void 0&&(Ee[le]={texture:r.createTexture(),usedTimes:0},s.memory.textures++,te=!0),Ee[le].usedTimes++;const q=Ee[j.__cacheKey];q!==void 0&&(Ee[j.__cacheKey].usedTimes--,q.usedTimes===0&&A(H)),j.__cacheKey=le,j.__webglTexture=Ee[le].texture}return te}function O(j,H,te){let me=r.TEXTURE_2D;(H.isDataArrayTexture||H.isCompressedArrayTexture)&&(me=r.TEXTURE_2D_ARRAY),H.isData3DTexture&&(me=r.TEXTURE_3D);const Ee=G(j,H),le=H.source;t.bindTexture(me,j.__webglTexture,r.TEXTURE0+te);const q=n.get(le);if(le.version!==q.__version||Ee===!0){t.activeTexture(r.TEXTURE0+te);const ne=Dt.getPrimaries(Dt.workingColorSpace),fe=H.colorSpace===Bi?null:Dt.getPrimaries(H.colorSpace),ce=H.colorSpace===Bi||ne===fe?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,H.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,H.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,H.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,ce);let ae=m(H.image,!1,i.maxTextureSize);ae=Me(H,ae);const ie=a.convert(H.format,H.colorSpace),ee=a.convert(H.type);let he=_(H.internalFormat,ie,ee,H.colorSpace,H.isVideoTexture);U(me,H);let ge;const Te=H.mipmaps,Se=H.isVideoTexture!==!0,Oe=q.__version===void 0||Ee===!0,J=le.dataReady,ve=E(H,ae);if(H.isDepthTexture)he=x(H.format===Vi,H.type),Oe&&(Se?t.texStorage2D(r.TEXTURE_2D,1,he,ae.width,ae.height):t.texImage2D(r.TEXTURE_2D,0,he,ae.width,ae.height,0,ie,ee,null));else if(H.isDataTexture)if(Te.length>0){Se&&Oe&&t.texStorage2D(r.TEXTURE_2D,ve,he,Te[0].width,Te[0].height);for(let ue=0,_e=Te.length;ue<_e;ue++)ge=Te[ue],Se?J&&t.texSubImage2D(r.TEXTURE_2D,ue,0,0,ge.width,ge.height,ie,ee,ge.data):t.texImage2D(r.TEXTURE_2D,ue,he,ge.width,ge.height,0,ie,ee,ge.data);H.generateMipmaps=!1}else Se?(Oe&&t.texStorage2D(r.TEXTURE_2D,ve,he,ae.width,ae.height),J&&t.texSubImage2D(r.TEXTURE_2D,0,0,0,ae.width,ae.height,ie,ee,ae.data)):t.texImage2D(r.TEXTURE_2D,0,he,ae.width,ae.height,0,ie,ee,ae.data);else if(H.isCompressedTexture)if(H.isCompressedArrayTexture){Se&&Oe&&t.texStorage3D(r.TEXTURE_2D_ARRAY,ve,he,Te[0].width,Te[0].height,ae.depth);for(let ue=0,_e=Te.length;ue<_e;ue++)if(ge=Te[ue],H.format!==On)if(ie!==null)if(Se){if(J)if(H.layerUpdates.size>0){const ke=UO(ge.width,ge.height,H.format,H.type);for(const Ie of H.layerUpdates){const je=ge.data.subarray(Ie*ke/ge.data.BYTES_PER_ELEMENT,(Ie+1)*ke/ge.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,ue,0,0,Ie,ge.width,ge.height,1,ie,je)}H.clearLayerUpdates()}else t.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,ue,0,0,0,ge.width,ge.height,ae.depth,ie,ge.data)}else t.compressedTexImage3D(r.TEXTURE_2D_ARRAY,ue,he,ge.width,ge.height,ae.depth,0,ge.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Se?J&&t.texSubImage3D(r.TEXTURE_2D_ARRAY,ue,0,0,0,ge.width,ge.height,ae.depth,ie,ee,ge.data):t.texImage3D(r.TEXTURE_2D_ARRAY,ue,he,ge.width,ge.height,ae.depth,0,ie,ee,ge.data)}else{Se&&Oe&&t.texStorage2D(r.TEXTURE_2D,ve,he,Te[0].width,Te[0].height);for(let ue=0,_e=Te.length;ue<_e;ue++)ge=Te[ue],H.format!==On?ie!==null?Se?J&&t.compressedTexSubImage2D(r.TEXTURE_2D,ue,0,0,ge.width,ge.height,ie,ge.data):t.compressedTexImage2D(r.TEXTURE_2D,ue,he,ge.width,ge.height,0,ge.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Se?J&&t.texSubImage2D(r.TEXTURE_2D,ue,0,0,ge.width,ge.height,ie,ee,ge.data):t.texImage2D(r.TEXTURE_2D,ue,he,ge.width,ge.height,0,ie,ee,ge.data)}else if(H.isDataArrayTexture)if(Se){if(Oe&&t.texStorage3D(r.TEXTURE_2D_ARRAY,ve,he,ae.width,ae.height,ae.depth),J)if(H.layerUpdates.size>0){const ue=UO(ae.width,ae.height,H.format,H.type);for(const _e of H.layerUpdates){const ke=ae.data.subarray(_e*ue/ae.data.BYTES_PER_ELEMENT,(_e+1)*ue/ae.data.BYTES_PER_ELEMENT);t.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,_e,ae.width,ae.height,1,ie,ee,ke)}H.clearLayerUpdates()}else t.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,ae.width,ae.height,ae.depth,ie,ee,ae.data)}else t.texImage3D(r.TEXTURE_2D_ARRAY,0,he,ae.width,ae.height,ae.depth,0,ie,ee,ae.data);else if(H.isData3DTexture)Se?(Oe&&t.texStorage3D(r.TEXTURE_3D,ve,he,ae.width,ae.height,ae.depth),J&&t.texSubImage3D(r.TEXTURE_3D,0,0,0,0,ae.width,ae.height,ae.depth,ie,ee,ae.data)):t.texImage3D(r.TEXTURE_3D,0,he,ae.width,ae.height,ae.depth,0,ie,ee,ae.data);else if(H.isFramebufferTexture){if(Oe)if(Se)t.texStorage2D(r.TEXTURE_2D,ve,he,ae.width,ae.height);else{let ue=ae.width,_e=ae.height;for(let ke=0;ke<ve;ke++)t.texImage2D(r.TEXTURE_2D,ke,he,ue,_e,0,ie,ee,null),ue>>=1,_e>>=1}}else if(Te.length>0){if(Se&&Oe){const ue=Ae(Te[0]);t.texStorage2D(r.TEXTURE_2D,ve,he,ue.width,ue.height)}for(let ue=0,_e=Te.length;ue<_e;ue++)ge=Te[ue],Se?J&&t.texSubImage2D(r.TEXTURE_2D,ue,0,0,ie,ee,ge):t.texImage2D(r.TEXTURE_2D,ue,he,ie,ee,ge);H.generateMipmaps=!1}else if(Se){if(Oe){const ue=Ae(ae);t.texStorage2D(r.TEXTURE_2D,ve,he,ue.width,ue.height)}J&&t.texSubImage2D(r.TEXTURE_2D,0,0,0,ie,ee,ae)}else t.texImage2D(r.TEXTURE_2D,0,he,ie,ee,ae);v(H)&&g(me),q.__version=le.version,H.onUpdate&&H.onUpdate(H)}j.__version=H.version}function F(j,H,te){if(H.image.length!==6)return;const me=G(j,H),Ee=H.source;t.bindTexture(r.TEXTURE_CUBE_MAP,j.__webglTexture,r.TEXTURE0+te);const le=n.get(Ee);if(Ee.version!==le.__version||me===!0){t.activeTexture(r.TEXTURE0+te);const q=Dt.getPrimaries(Dt.workingColorSpace),ne=H.colorSpace===Bi?null:Dt.getPrimaries(H.colorSpace),fe=H.colorSpace===Bi||q===ne?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,H.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,H.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,H.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,fe);const ce=H.isCompressedTexture||H.image[0].isCompressedTexture,ae=H.image[0]&&H.image[0].isDataTexture,ie=[];for(let _e=0;_e<6;_e++)!ce&&!ae?ie[_e]=m(H.image[_e],!0,i.maxCubemapSize):ie[_e]=ae?H.image[_e].image:H.image[_e],ie[_e]=Me(H,ie[_e]);const ee=ie[0],he=a.convert(H.format,H.colorSpace),ge=a.convert(H.type),Te=_(H.internalFormat,he,ge,H.colorSpace),Se=H.isVideoTexture!==!0,Oe=le.__version===void 0||me===!0,J=Ee.dataReady;let ve=E(H,ee);U(r.TEXTURE_CUBE_MAP,H);let ue;if(ce){Se&&Oe&&t.texStorage2D(r.TEXTURE_CUBE_MAP,ve,Te,ee.width,ee.height);for(let _e=0;_e<6;_e++){ue=ie[_e].mipmaps;for(let ke=0;ke<ue.length;ke++){const Ie=ue[ke];H.format!==On?he!==null?Se?J&&t.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+_e,ke,0,0,Ie.width,Ie.height,he,Ie.data):t.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+_e,ke,Te,Ie.width,Ie.height,0,Ie.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Se?J&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+_e,ke,0,0,Ie.width,Ie.height,he,ge,Ie.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+_e,ke,Te,Ie.width,Ie.height,0,he,ge,Ie.data)}}}else{if(ue=H.mipmaps,Se&&Oe){ue.length>0&&ve++;const _e=Ae(ie[0]);t.texStorage2D(r.TEXTURE_CUBE_MAP,ve,Te,_e.width,_e.height)}for(let _e=0;_e<6;_e++)if(ae){Se?J&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,0,0,ie[_e].width,ie[_e].height,he,ge,ie[_e].data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,Te,ie[_e].width,ie[_e].height,0,he,ge,ie[_e].data);for(let ke=0;ke<ue.length;ke++){const je=ue[ke].image[_e].image;Se?J&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+_e,ke+1,0,0,je.width,je.height,he,ge,je.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+_e,ke+1,Te,je.width,je.height,0,he,ge,je.data)}}else{Se?J&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,0,0,he,ge,ie[_e]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,Te,he,ge,ie[_e]);for(let ke=0;ke<ue.length;ke++){const Ie=ue[ke];Se?J&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+_e,ke+1,0,0,he,ge,Ie.image[_e]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+_e,ke+1,Te,he,ge,Ie.image[_e])}}}v(H)&&g(r.TEXTURE_CUBE_MAP),le.__version=Ee.version,H.onUpdate&&H.onUpdate(H)}j.__version=H.version}function V(j,H,te,me,Ee,le){const q=a.convert(te.format,te.colorSpace),ne=a.convert(te.type),fe=_(te.internalFormat,q,ne,te.colorSpace),ce=n.get(H),ae=n.get(te);if(ae.__renderTarget=H,!ce.__hasExternalTextures){const ie=Math.max(1,H.width>>le),ee=Math.max(1,H.height>>le);Ee===r.TEXTURE_3D||Ee===r.TEXTURE_2D_ARRAY?t.texImage3D(Ee,le,fe,ie,ee,H.depth,0,q,ne,null):t.texImage2D(Ee,le,fe,ie,ee,0,q,ne,null)}t.bindFramebuffer(r.FRAMEBUFFER,j),we(H)?o.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,me,Ee,ae.__webglTexture,0,Be(H)):(Ee===r.TEXTURE_2D||Ee>=r.TEXTURE_CUBE_MAP_POSITIVE_X&&Ee<=r.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&r.framebufferTexture2D(r.FRAMEBUFFER,me,Ee,ae.__webglTexture,le),t.bindFramebuffer(r.FRAMEBUFFER,null)}function $(j,H,te){if(r.bindRenderbuffer(r.RENDERBUFFER,j),H.depthBuffer){const me=H.depthTexture,Ee=me&&me.isDepthTexture?me.type:null,le=x(H.stencilBuffer,Ee),q=H.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,ne=Be(H);we(H)?o.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,ne,le,H.width,H.height):te?r.renderbufferStorageMultisample(r.RENDERBUFFER,ne,le,H.width,H.height):r.renderbufferStorage(r.RENDERBUFFER,le,H.width,H.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,q,r.RENDERBUFFER,j)}else{const me=H.textures;for(let Ee=0;Ee<me.length;Ee++){const le=me[Ee],q=a.convert(le.format,le.colorSpace),ne=a.convert(le.type),fe=_(le.internalFormat,q,ne,le.colorSpace),ce=Be(H);te&&we(H)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,ce,fe,H.width,H.height):we(H)?o.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,ce,fe,H.width,H.height):r.renderbufferStorage(r.RENDERBUFFER,fe,H.width,H.height)}}r.bindRenderbuffer(r.RENDERBUFFER,null)}function Z(j,H){if(H&&H.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(r.FRAMEBUFFER,j),!(H.depthTexture&&H.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const me=n.get(H.depthTexture);me.__renderTarget=H,(!me.__webglTexture||H.depthTexture.image.width!==H.width||H.depthTexture.image.height!==H.height)&&(H.depthTexture.image.width=H.width,H.depthTexture.image.height=H.height,H.depthTexture.needsUpdate=!0),N(H.depthTexture,0);const Ee=me.__webglTexture,le=Be(H);if(H.depthTexture.format===zi)we(H)?o.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,Ee,0,le):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,Ee,0);else if(H.depthTexture.format===Vi)we(H)?o.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,Ee,0,le):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,Ee,0);else throw new Error("Unknown depthTexture format")}function Y(j){const H=n.get(j),te=j.isWebGLCubeRenderTarget===!0;if(H.__boundDepthTexture!==j.depthTexture){const me=j.depthTexture;if(H.__depthDisposeCallback&&H.__depthDisposeCallback(),me){const Ee=()=>{delete H.__boundDepthTexture,delete H.__depthDisposeCallback,me.removeEventListener("dispose",Ee)};me.addEventListener("dispose",Ee),H.__depthDisposeCallback=Ee}H.__boundDepthTexture=me}if(j.depthTexture&&!H.__autoAllocateDepthBuffer){if(te)throw new Error("target.depthTexture not supported in Cube render targets");Z(H.__webglFramebuffer,j)}else if(te){H.__webglDepthbuffer=[];for(let me=0;me<6;me++)if(t.bindFramebuffer(r.FRAMEBUFFER,H.__webglFramebuffer[me]),H.__webglDepthbuffer[me]===void 0)H.__webglDepthbuffer[me]=r.createRenderbuffer(),$(H.__webglDepthbuffer[me],j,!1);else{const Ee=j.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,le=H.__webglDepthbuffer[me];r.bindRenderbuffer(r.RENDERBUFFER,le),r.framebufferRenderbuffer(r.FRAMEBUFFER,Ee,r.RENDERBUFFER,le)}}else if(t.bindFramebuffer(r.FRAMEBUFFER,H.__webglFramebuffer),H.__webglDepthbuffer===void 0)H.__webglDepthbuffer=r.createRenderbuffer(),$(H.__webglDepthbuffer,j,!1);else{const me=j.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Ee=H.__webglDepthbuffer;r.bindRenderbuffer(r.RENDERBUFFER,Ee),r.framebufferRenderbuffer(r.FRAMEBUFFER,me,r.RENDERBUFFER,Ee)}t.bindFramebuffer(r.FRAMEBUFFER,null)}function X(j,H,te){const me=n.get(j);H!==void 0&&V(me.__webglFramebuffer,j,j.texture,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,0),te!==void 0&&Y(j)}function K(j){const H=j.texture,te=n.get(j),me=n.get(H);j.addEventListener("dispose",b);const Ee=j.textures,le=j.isWebGLCubeRenderTarget===!0,q=Ee.length>1;if(q||(me.__webglTexture===void 0&&(me.__webglTexture=r.createTexture()),me.__version=H.version,s.memory.textures++),le){te.__webglFramebuffer=[];for(let ne=0;ne<6;ne++)if(H.mipmaps&&H.mipmaps.length>0){te.__webglFramebuffer[ne]=[];for(let fe=0;fe<H.mipmaps.length;fe++)te.__webglFramebuffer[ne][fe]=r.createFramebuffer()}else te.__webglFramebuffer[ne]=r.createFramebuffer()}else{if(H.mipmaps&&H.mipmaps.length>0){te.__webglFramebuffer=[];for(let ne=0;ne<H.mipmaps.length;ne++)te.__webglFramebuffer[ne]=r.createFramebuffer()}else te.__webglFramebuffer=r.createFramebuffer();if(q)for(let ne=0,fe=Ee.length;ne<fe;ne++){const ce=n.get(Ee[ne]);ce.__webglTexture===void 0&&(ce.__webglTexture=r.createTexture(),s.memory.textures++)}if(j.samples>0&&we(j)===!1){te.__webglMultisampledFramebuffer=r.createFramebuffer(),te.__webglColorRenderbuffer=[],t.bindFramebuffer(r.FRAMEBUFFER,te.__webglMultisampledFramebuffer);for(let ne=0;ne<Ee.length;ne++){const fe=Ee[ne];te.__webglColorRenderbuffer[ne]=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,te.__webglColorRenderbuffer[ne]);const ce=a.convert(fe.format,fe.colorSpace),ae=a.convert(fe.type),ie=_(fe.internalFormat,ce,ae,fe.colorSpace,j.isXRRenderTarget===!0),ee=Be(j);r.renderbufferStorageMultisample(r.RENDERBUFFER,ee,ie,j.width,j.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+ne,r.RENDERBUFFER,te.__webglColorRenderbuffer[ne])}r.bindRenderbuffer(r.RENDERBUFFER,null),j.depthBuffer&&(te.__webglDepthRenderbuffer=r.createRenderbuffer(),$(te.__webglDepthRenderbuffer,j,!0)),t.bindFramebuffer(r.FRAMEBUFFER,null)}}if(le){t.bindTexture(r.TEXTURE_CUBE_MAP,me.__webglTexture),U(r.TEXTURE_CUBE_MAP,H);for(let ne=0;ne<6;ne++)if(H.mipmaps&&H.mipmaps.length>0)for(let fe=0;fe<H.mipmaps.length;fe++)V(te.__webglFramebuffer[ne][fe],j,H,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+ne,fe);else V(te.__webglFramebuffer[ne],j,H,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0);v(H)&&g(r.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(q){for(let ne=0,fe=Ee.length;ne<fe;ne++){const ce=Ee[ne],ae=n.get(ce);t.bindTexture(r.TEXTURE_2D,ae.__webglTexture),U(r.TEXTURE_2D,ce),V(te.__webglFramebuffer,j,ce,r.COLOR_ATTACHMENT0+ne,r.TEXTURE_2D,0),v(ce)&&g(r.TEXTURE_2D)}t.unbindTexture()}else{let ne=r.TEXTURE_2D;if((j.isWebGL3DRenderTarget||j.isWebGLArrayRenderTarget)&&(ne=j.isWebGL3DRenderTarget?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY),t.bindTexture(ne,me.__webglTexture),U(ne,H),H.mipmaps&&H.mipmaps.length>0)for(let fe=0;fe<H.mipmaps.length;fe++)V(te.__webglFramebuffer[fe],j,H,r.COLOR_ATTACHMENT0,ne,fe);else V(te.__webglFramebuffer,j,H,r.COLOR_ATTACHMENT0,ne,0);v(H)&&g(ne),t.unbindTexture()}j.depthBuffer&&Y(j)}function se(j){const H=j.textures;for(let te=0,me=H.length;te<me;te++){const Ee=H[te];if(v(Ee)){const le=y(j),q=n.get(Ee).__webglTexture;t.bindTexture(le,q),g(le),t.unbindTexture()}}}const oe=[],W=[];function Ne(j){if(j.samples>0){if(we(j)===!1){const H=j.textures,te=j.width,me=j.height;let Ee=r.COLOR_BUFFER_BIT;const le=j.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,q=n.get(j),ne=H.length>1;if(ne)for(let fe=0;fe<H.length;fe++)t.bindFramebuffer(r.FRAMEBUFFER,q.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+fe,r.RENDERBUFFER,null),t.bindFramebuffer(r.FRAMEBUFFER,q.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+fe,r.TEXTURE_2D,null,0);t.bindFramebuffer(r.READ_FRAMEBUFFER,q.__webglMultisampledFramebuffer),t.bindFramebuffer(r.DRAW_FRAMEBUFFER,q.__webglFramebuffer);for(let fe=0;fe<H.length;fe++){if(j.resolveDepthBuffer&&(j.depthBuffer&&(Ee|=r.DEPTH_BUFFER_BIT),j.stencilBuffer&&j.resolveStencilBuffer&&(Ee|=r.STENCIL_BUFFER_BIT)),ne){r.framebufferRenderbuffer(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,q.__webglColorRenderbuffer[fe]);const ce=n.get(H[fe]).__webglTexture;r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,ce,0)}r.blitFramebuffer(0,0,te,me,0,0,te,me,Ee,r.NEAREST),l===!0&&(oe.length=0,W.length=0,oe.push(r.COLOR_ATTACHMENT0+fe),j.depthBuffer&&j.resolveDepthBuffer===!1&&(oe.push(le),W.push(le),r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,W)),r.invalidateFramebuffer(r.READ_FRAMEBUFFER,oe))}if(t.bindFramebuffer(r.READ_FRAMEBUFFER,null),t.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),ne)for(let fe=0;fe<H.length;fe++){t.bindFramebuffer(r.FRAMEBUFFER,q.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+fe,r.RENDERBUFFER,q.__webglColorRenderbuffer[fe]);const ce=n.get(H[fe]).__webglTexture;t.bindFramebuffer(r.FRAMEBUFFER,q.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+fe,r.TEXTURE_2D,ce,0)}t.bindFramebuffer(r.DRAW_FRAMEBUFFER,q.__webglMultisampledFramebuffer)}else if(j.depthBuffer&&j.resolveDepthBuffer===!1&&l){const H=j.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT;r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,[H])}}}function Be(j){return Math.min(i.maxSamples,j.samples)}function we(j){const H=n.get(j);return j.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&H.__useRenderToTexture!==!1}function pe(j){const H=s.render.frame;c.get(j)!==H&&(c.set(j,H),j.update())}function Me(j,H){const te=j.colorSpace,me=j.format,Ee=j.type;return j.isCompressedTexture===!0||j.isVideoTexture===!0||te!==is&&te!==Bi&&(Dt.getTransfer(te)===en?(me!==On||Ee!==In)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",te)),H}function Ae(j){return typeof HTMLImageElement<"u"&&j instanceof HTMLImageElement?(u.width=j.naturalWidth||j.width,u.height=j.naturalHeight||j.height):typeof VideoFrame<"u"&&j instanceof VideoFrame?(u.width=j.displayWidth,u.height=j.displayHeight):(u.width=j.width,u.height=j.height),u}this.allocateTextureUnit=P,this.resetTextureUnits=R,this.setTexture2D=N,this.setTexture2DArray=D,this.setTexture3D=I,this.setTextureCube=L,this.rebindTextures=X,this.setupRenderTarget=K,this.updateRenderTargetMipmap=se,this.updateMultisampleRenderTarget=Ne,this.setupDepthRenderbuffer=Y,this.setupFrameBufferTexture=V,this.useMultisampledRTT=we}function zre(r,e){function t(n,i=Bi){let a;const s=Dt.getTransfer(i);if(n===In)return r.UNSIGNED_BYTE;if(n===rm)return r.UNSIGNED_SHORT_4_4_4_4;if(n===im)return r.UNSIGNED_SHORT_5_5_5_1;if(n===am)return r.UNSIGNED_INT_5_9_9_9_REV;if(n===Ol)return r.BYTE;if(n===Fl)return r.SHORT;if(n===Pa)return r.UNSIGNED_SHORT;if(n===mr)return r.INT;if(n===hn)return r.UNSIGNED_INT;if(n===Un)return r.FLOAT;if(n===kr)return r.HALF_FLOAT;if(n===IA)return r.ALPHA;if(n===Nd)return r.RGB;if(n===On)return r.RGBA;if(n===OA)return r.LUMINANCE;if(n===FA)return r.LUMINANCE_ALPHA;if(n===zi)return r.DEPTH_COMPONENT;if(n===Vi)return r.DEPTH_STENCIL;if(n===Pd)return r.RED;if(n===lh)return r.RED_INTEGER;if(n===Ql)return r.RG;if(n===uh)return r.RG_INTEGER;if(n===ch)return r.RGBA_INTEGER;if(n===Bl||n===Po||n===Do||n===Lo)if(s===en)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(n===Bl)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Po)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Do)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Lo)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(n===Bl)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Po)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Do)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Lo)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===Wf||n===qf||n===$f||n===Xf)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(n===Wf)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===qf)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===$f)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Xf)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===Yf||n===Mc||n===Cc)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(n===Yf||n===Mc)return s===en?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(n===Cc)return s===en?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===Rc||n===Nc||n===Pc||n===Dc||n===Lc||n===Ic||n===Oc||n===Fc||n===Bc||n===Uc||n===kc||n===Gc||n===zc||n===Vc)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(n===Rc)return s===en?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Nc)return s===en?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Pc)return s===en?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Dc)return s===en?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Lc)return s===en?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Ic)return s===en?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Oc)return s===en?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Fc)return s===en?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Bc)return s===en?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Uc)return s===en?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===kc)return s===en?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Gc)return s===en?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===zc)return s===en?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Vc)return s===en?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===Ul||n===qw||n===$w)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(n===Ul)return s===en?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===qw)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===$w)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===BA||n===jf||n===Kf||n===Qf)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(n===Ul)return a.COMPRESSED_RED_RGTC1_EXT;if(n===jf)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Kf)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Qf)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===Gi?r.UNSIGNED_INT_24_8:r[n]!==void 0?r[n]:null}return{convert:t}}const Vre=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,Hre=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Wre{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(this.texture===null){const i=new ar,a=e.properties.get(i);a.__webglTexture=t.texture,(t.depthNear!==n.depthNear||t.depthFar!==n.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,n=new ss({vertexShader:Vre,fragmentShader:Hre,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Yn(new Id(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class qre extends to{constructor(e,t){super();const n=this;let i=null,a=1,s=null,o="local-floor",l=1,u=null,c=null,h=null,d=null,f=null,p=null;const m=new Wre,v=t.getContextAttributes();let g=null,y=null;const _=[],x=[],E=new He;let T=null;const b=new yr;b.viewport=new xt;const w=new yr;w.viewport=new xt;const A=[b,w],S=new Tz;let C=null,R=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(O){let F=_[O];return F===void 0&&(F=new Tg,_[O]=F),F.getTargetRaySpace()},this.getControllerGrip=function(O){let F=_[O];return F===void 0&&(F=new Tg,_[O]=F),F.getGripSpace()},this.getHand=function(O){let F=_[O];return F===void 0&&(F=new Tg,_[O]=F),F.getHandSpace()};function P(O){const F=x.indexOf(O.inputSource);if(F===-1)return;const V=_[F];V!==void 0&&(V.update(O.inputSource,O.frame,u||s),V.dispatchEvent({type:O.type,data:O.inputSource}))}function M(){i.removeEventListener("select",P),i.removeEventListener("selectstart",P),i.removeEventListener("selectend",P),i.removeEventListener("squeeze",P),i.removeEventListener("squeezestart",P),i.removeEventListener("squeezeend",P),i.removeEventListener("end",M),i.removeEventListener("inputsourceschange",N);for(let O=0;O<_.length;O++){const F=x[O];F!==null&&(x[O]=null,_[O].disconnect(F))}C=null,R=null,m.reset(),e.setRenderTarget(g),f=null,d=null,h=null,i=null,y=null,G.stop(),n.isPresenting=!1,e.setPixelRatio(T),e.setSize(E.width,E.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(O){a=O,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(O){o=O,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||s},this.setReferenceSpace=function(O){u=O},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(O){if(i=O,i!==null){if(g=e.getRenderTarget(),i.addEventListener("select",P),i.addEventListener("selectstart",P),i.addEventListener("selectend",P),i.addEventListener("squeeze",P),i.addEventListener("squeezestart",P),i.addEventListener("squeezeend",P),i.addEventListener("end",M),i.addEventListener("inputsourceschange",N),v.xrCompatible!==!0&&await t.makeXRCompatible(),T=e.getPixelRatio(),e.getSize(E),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let V=null,$=null,Z=null;v.depth&&(Z=v.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,V=v.stencil?Vi:zi,$=v.stencil?Gi:hn);const Y={colorFormat:t.RGBA8,depthFormat:Z,scaleFactor:a};h=new XRWebGLBinding(i,t),d=h.createProjectionLayer(Y),i.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),y=new Xo(d.textureWidth,d.textureHeight,{format:On,type:In,depthTexture:new sa(d.textureWidth,d.textureHeight,$,void 0,void 0,void 0,void 0,void 0,void 0,V),stencilBuffer:v.stencil,colorSpace:e.outputColorSpace,samples:v.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1,resolveStencilBuffer:d.ignoreDepthValues===!1})}else{const V={antialias:v.antialias,alpha:!0,depth:v.depth,stencil:v.stencil,framebufferScaleFactor:a};f=new XRWebGLLayer(i,t,V),i.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),y=new Xo(f.framebufferWidth,f.framebufferHeight,{format:On,type:In,colorSpace:e.outputColorSpace,stencilBuffer:v.stencil,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1})}y.isXRRenderTarget=!0,this.setFoveation(l),u=null,s=await i.requestReferenceSpace(o),G.setContext(i),G.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return m.getDepthTexture()};function N(O){for(let F=0;F<O.removed.length;F++){const V=O.removed[F],$=x.indexOf(V);$>=0&&(x[$]=null,_[$].disconnect(V))}for(let F=0;F<O.added.length;F++){const V=O.added[F];let $=x.indexOf(V);if($===-1){for(let Y=0;Y<_.length;Y++)if(Y>=x.length){x.push(V),$=Y;break}else if(x[Y]===null){x[Y]=V,$=Y;break}if($===-1)break}const Z=_[$];Z&&Z.connect(V)}}const D=new re,I=new re;function L(O,F,V){D.setFromMatrixPosition(F.matrixWorld),I.setFromMatrixPosition(V.matrixWorld);const $=D.distanceTo(I),Z=F.projectionMatrix.elements,Y=V.projectionMatrix.elements,X=Z[14]/(Z[10]-1),K=Z[14]/(Z[10]+1),se=(Z[9]+1)/Z[5],oe=(Z[9]-1)/Z[5],W=(Z[8]-1)/Z[0],Ne=(Y[8]+1)/Y[0],Be=X*W,we=X*Ne,pe=$/(-W+Ne),Me=pe*-W;if(F.matrixWorld.decompose(O.position,O.quaternion,O.scale),O.translateX(Me),O.translateZ(pe),O.matrixWorld.compose(O.position,O.quaternion,O.scale),O.matrixWorldInverse.copy(O.matrixWorld).invert(),Z[10]===-1)O.projectionMatrix.copy(F.projectionMatrix),O.projectionMatrixInverse.copy(F.projectionMatrixInverse);else{const Ae=X+pe,j=K+pe,H=Be-Me,te=we+($-Me),me=se*K/j*Ae,Ee=oe*K/j*Ae;O.projectionMatrix.makePerspective(H,te,me,Ee,Ae,j),O.projectionMatrixInverse.copy(O.projectionMatrix).invert()}}function z(O,F){F===null?O.matrixWorld.copy(O.matrix):O.matrixWorld.multiplyMatrices(F.matrixWorld,O.matrix),O.matrixWorldInverse.copy(O.matrixWorld).invert()}this.updateCamera=function(O){if(i===null)return;let F=O.near,V=O.far;m.texture!==null&&(m.depthNear>0&&(F=m.depthNear),m.depthFar>0&&(V=m.depthFar)),S.near=w.near=b.near=F,S.far=w.far=b.far=V,(C!==S.near||R!==S.far)&&(i.updateRenderState({depthNear:S.near,depthFar:S.far}),C=S.near,R=S.far),b.layers.mask=O.layers.mask|2,w.layers.mask=O.layers.mask|4,S.layers.mask=b.layers.mask|w.layers.mask;const $=O.parent,Z=S.cameras;z(S,$);for(let Y=0;Y<Z.length;Y++)z(Z[Y],$);Z.length===2?L(S,b,w):S.projectionMatrix.copy(b.projectionMatrix),B(O,S,$)};function B(O,F,V){V===null?O.matrix.copy(F.matrixWorld):(O.matrix.copy(V.matrixWorld),O.matrix.invert(),O.matrix.multiply(F.matrixWorld)),O.matrix.decompose(O.position,O.quaternion,O.scale),O.updateMatrixWorld(!0),O.projectionMatrix.copy(F.projectionMatrix),O.projectionMatrixInverse.copy(F.projectionMatrixInverse),O.isPerspectiveCamera&&(O.fov=Zl*2*Math.atan(1/O.projectionMatrix.elements[5]),O.zoom=1)}this.getCamera=function(){return S},this.getFoveation=function(){if(!(d===null&&f===null))return l},this.setFoveation=function(O){l=O,d!==null&&(d.fixedFoveation=O),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=O)},this.hasDepthSensing=function(){return m.texture!==null},this.getDepthSensingMesh=function(){return m.getMesh(S)};let k=null;function U(O,F){if(c=F.getViewerPose(u||s),p=F,c!==null){const V=c.views;f!==null&&(e.setRenderTargetFramebuffer(y,f.framebuffer),e.setRenderTarget(y));let $=!1;V.length!==S.cameras.length&&(S.cameras.length=0,$=!0);for(let X=0;X<V.length;X++){const K=V[X];let se=null;if(f!==null)se=f.getViewport(K);else{const W=h.getViewSubImage(d,K);se=W.viewport,X===0&&(e.setRenderTargetTextures(y,W.colorTexture,W.depthStencilTexture),e.setRenderTarget(y))}let oe=A[X];oe===void 0&&(oe=new yr,oe.layers.enable(X),oe.viewport=new xt,A[X]=oe),oe.matrix.fromArray(K.transform.matrix),oe.matrix.decompose(oe.position,oe.quaternion,oe.scale),oe.projectionMatrix.fromArray(K.projectionMatrix),oe.projectionMatrixInverse.copy(oe.projectionMatrix).invert(),oe.viewport.set(se.x,se.y,se.width,se.height),X===0&&(S.matrix.copy(oe.matrix),S.matrix.decompose(S.position,S.quaternion,S.scale)),$===!0&&S.cameras.push(oe)}const Z=i.enabledFeatures;if(Z&&Z.includes("depth-sensing")&&i.depthUsage=="gpu-optimized"&&h){const X=h.getDepthInformation(V[0]);X&&X.isValid&&X.texture&&m.init(e,X,i.renderState)}}for(let V=0;V<_.length;V++){const $=x[V],Z=_[V];$!==null&&Z!==void 0&&Z.update($,F,u||s)}k&&k(O,F),F.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:F}),p=null}const G=new Az;G.setAnimationLoop(U),this.setAnimationLoop=function(O){k=O},this.dispose=function(){}}}const gl=new Ei,$re=new Ut;function Xre(r,e){function t(v,g){v.matrixAutoUpdate===!0&&v.updateMatrix(),g.value.copy(v.matrix)}function n(v,g){g.color.getRGB(v.fogColor.value,hz(r)),g.isFog?(v.fogNear.value=g.near,v.fogFar.value=g.far):g.isFogExp2&&(v.fogDensity.value=g.density)}function i(v,g,y,_,x){g.isMeshBasicMaterial||g.isMeshLambertMaterial?a(v,g):g.isMeshToonMaterial?(a(v,g),h(v,g)):g.isMeshPhongMaterial?(a(v,g),c(v,g)):g.isMeshStandardMaterial?(a(v,g),d(v,g),g.isMeshPhysicalMaterial&&f(v,g,x)):g.isMeshMatcapMaterial?(a(v,g),p(v,g)):g.isMeshDepthMaterial?a(v,g):g.isMeshDistanceMaterial?(a(v,g),m(v,g)):g.isMeshNormalMaterial?a(v,g):g.isLineBasicMaterial?(s(v,g),g.isLineDashedMaterial&&o(v,g)):g.isPointsMaterial?l(v,g,y,_):g.isSpriteMaterial?u(v,g):g.isShadowMaterial?(v.color.value.copy(g.color),v.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}function a(v,g){v.opacity.value=g.opacity,g.color&&v.diffuse.value.copy(g.color),g.emissive&&v.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(v.map.value=g.map,t(g.map,v.mapTransform)),g.alphaMap&&(v.alphaMap.value=g.alphaMap,t(g.alphaMap,v.alphaMapTransform)),g.bumpMap&&(v.bumpMap.value=g.bumpMap,t(g.bumpMap,v.bumpMapTransform),v.bumpScale.value=g.bumpScale,g.side===dn&&(v.bumpScale.value*=-1)),g.normalMap&&(v.normalMap.value=g.normalMap,t(g.normalMap,v.normalMapTransform),v.normalScale.value.copy(g.normalScale),g.side===dn&&v.normalScale.value.negate()),g.displacementMap&&(v.displacementMap.value=g.displacementMap,t(g.displacementMap,v.displacementMapTransform),v.displacementScale.value=g.displacementScale,v.displacementBias.value=g.displacementBias),g.emissiveMap&&(v.emissiveMap.value=g.emissiveMap,t(g.emissiveMap,v.emissiveMapTransform)),g.specularMap&&(v.specularMap.value=g.specularMap,t(g.specularMap,v.specularMapTransform)),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest);const y=e.get(g),_=y.envMap,x=y.envMapRotation;_&&(v.envMap.value=_,gl.copy(x),gl.x*=-1,gl.y*=-1,gl.z*=-1,_.isCubeTexture&&_.isRenderTargetTexture===!1&&(gl.y*=-1,gl.z*=-1),v.envMapRotation.value.setFromMatrix4($re.makeRotationFromEuler(gl)),v.flipEnvMap.value=_.isCubeTexture&&_.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=g.reflectivity,v.ior.value=g.ior,v.refractionRatio.value=g.refractionRatio),g.lightMap&&(v.lightMap.value=g.lightMap,v.lightMapIntensity.value=g.lightMapIntensity,t(g.lightMap,v.lightMapTransform)),g.aoMap&&(v.aoMap.value=g.aoMap,v.aoMapIntensity.value=g.aoMapIntensity,t(g.aoMap,v.aoMapTransform))}function s(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,g.map&&(v.map.value=g.map,t(g.map,v.mapTransform))}function o(v,g){v.dashSize.value=g.dashSize,v.totalSize.value=g.dashSize+g.gapSize,v.scale.value=g.scale}function l(v,g,y,_){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.size.value=g.size*y,v.scale.value=_*.5,g.map&&(v.map.value=g.map,t(g.map,v.uvTransform)),g.alphaMap&&(v.alphaMap.value=g.alphaMap,t(g.alphaMap,v.alphaMapTransform)),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest)}function u(v,g){v.diffuse.value.copy(g.color),v.opacity.value=g.opacity,v.rotation.value=g.rotation,g.map&&(v.map.value=g.map,t(g.map,v.mapTransform)),g.alphaMap&&(v.alphaMap.value=g.alphaMap,t(g.alphaMap,v.alphaMapTransform)),g.alphaTest>0&&(v.alphaTest.value=g.alphaTest)}function c(v,g){v.specular.value.copy(g.specular),v.shininess.value=Math.max(g.shininess,1e-4)}function h(v,g){g.gradientMap&&(v.gradientMap.value=g.gradientMap)}function d(v,g){v.metalness.value=g.metalness,g.metalnessMap&&(v.metalnessMap.value=g.metalnessMap,t(g.metalnessMap,v.metalnessMapTransform)),v.roughness.value=g.roughness,g.roughnessMap&&(v.roughnessMap.value=g.roughnessMap,t(g.roughnessMap,v.roughnessMapTransform)),g.envMap&&(v.envMapIntensity.value=g.envMapIntensity)}function f(v,g,y){v.ior.value=g.ior,g.sheen>0&&(v.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),v.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(v.sheenColorMap.value=g.sheenColorMap,t(g.sheenColorMap,v.sheenColorMapTransform)),g.sheenRoughnessMap&&(v.sheenRoughnessMap.value=g.sheenRoughnessMap,t(g.sheenRoughnessMap,v.sheenRoughnessMapTransform))),g.clearcoat>0&&(v.clearcoat.value=g.clearcoat,v.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(v.clearcoatMap.value=g.clearcoatMap,t(g.clearcoatMap,v.clearcoatMapTransform)),g.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap,t(g.clearcoatRoughnessMap,v.clearcoatRoughnessMapTransform)),g.clearcoatNormalMap&&(v.clearcoatNormalMap.value=g.clearcoatNormalMap,t(g.clearcoatNormalMap,v.clearcoatNormalMapTransform),v.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),g.side===dn&&v.clearcoatNormalScale.value.negate())),g.dispersion>0&&(v.dispersion.value=g.dispersion),g.iridescence>0&&(v.iridescence.value=g.iridescence,v.iridescenceIOR.value=g.iridescenceIOR,v.iridescenceThicknessMinimum.value=g.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=g.iridescenceThicknessRange[1],g.iridescenceMap&&(v.iridescenceMap.value=g.iridescenceMap,t(g.iridescenceMap,v.iridescenceMapTransform)),g.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=g.iridescenceThicknessMap,t(g.iridescenceThicknessMap,v.iridescenceThicknessMapTransform))),g.transmission>0&&(v.transmission.value=g.transmission,v.transmissionSamplerMap.value=y.texture,v.transmissionSamplerSize.value.set(y.width,y.height),g.transmissionMap&&(v.transmissionMap.value=g.transmissionMap,t(g.transmissionMap,v.transmissionMapTransform)),v.thickness.value=g.thickness,g.thicknessMap&&(v.thicknessMap.value=g.thicknessMap,t(g.thicknessMap,v.thicknessMapTransform)),v.attenuationDistance.value=g.attenuationDistance,v.attenuationColor.value.copy(g.attenuationColor)),g.anisotropy>0&&(v.anisotropyVector.value.set(g.anisotropy*Math.cos(g.anisotropyRotation),g.anisotropy*Math.sin(g.anisotropyRotation)),g.anisotropyMap&&(v.anisotropyMap.value=g.anisotropyMap,t(g.anisotropyMap,v.anisotropyMapTransform))),v.specularIntensity.value=g.specularIntensity,v.specularColor.value.copy(g.specularColor),g.specularColorMap&&(v.specularColorMap.value=g.specularColorMap,t(g.specularColorMap,v.specularColorMapTransform)),g.specularIntensityMap&&(v.specularIntensityMap.value=g.specularIntensityMap,t(g.specularIntensityMap,v.specularIntensityMapTransform))}function p(v,g){g.matcap&&(v.matcap.value=g.matcap)}function m(v,g){const y=e.get(g).light;v.referencePosition.value.setFromMatrixPosition(y.matrixWorld),v.nearDistance.value=y.shadow.camera.near,v.farDistance.value=y.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:i}}function Yre(r,e,t,n){let i={},a={},s=[];const o=r.getParameter(r.MAX_UNIFORM_BUFFER_BINDINGS);function l(y,_){const x=_.program;n.uniformBlockBinding(y,x)}function u(y,_){let x=i[y.id];x===void 0&&(p(y),x=c(y),i[y.id]=x,y.addEventListener("dispose",v));const E=_.program;n.updateUBOMapping(y,E);const T=e.render.frame;a[y.id]!==T&&(d(y),a[y.id]=T)}function c(y){const _=h();y.__bindingPointIndex=_;const x=r.createBuffer(),E=y.__size,T=y.usage;return r.bindBuffer(r.UNIFORM_BUFFER,x),r.bufferData(r.UNIFORM_BUFFER,E,T),r.bindBuffer(r.UNIFORM_BUFFER,null),r.bindBufferBase(r.UNIFORM_BUFFER,_,x),x}function h(){for(let y=0;y<o;y++)if(s.indexOf(y)===-1)return s.push(y),y;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(y){const _=i[y.id],x=y.uniforms,E=y.__cache;r.bindBuffer(r.UNIFORM_BUFFER,_);for(let T=0,b=x.length;T<b;T++){const w=Array.isArray(x[T])?x[T]:[x[T]];for(let A=0,S=w.length;A<S;A++){const C=w[A];if(f(C,T,A,E)===!0){const R=C.__offset,P=Array.isArray(C.value)?C.value:[C.value];let M=0;for(let N=0;N<P.length;N++){const D=P[N],I=m(D);typeof D=="number"||typeof D=="boolean"?(C.__data[0]=D,r.bufferSubData(r.UNIFORM_BUFFER,R+M,C.__data)):D.isMatrix3?(C.__data[0]=D.elements[0],C.__data[1]=D.elements[1],C.__data[2]=D.elements[2],C.__data[3]=0,C.__data[4]=D.elements[3],C.__data[5]=D.elements[4],C.__data[6]=D.elements[5],C.__data[7]=0,C.__data[8]=D.elements[6],C.__data[9]=D.elements[7],C.__data[10]=D.elements[8],C.__data[11]=0):(D.toArray(C.__data,M),M+=I.storage/Float32Array.BYTES_PER_ELEMENT)}r.bufferSubData(r.UNIFORM_BUFFER,R,C.__data)}}}r.bindBuffer(r.UNIFORM_BUFFER,null)}function f(y,_,x,E){const T=y.value,b=_+"_"+x;if(E[b]===void 0)return typeof T=="number"||typeof T=="boolean"?E[b]=T:E[b]=T.clone(),!0;{const w=E[b];if(typeof T=="number"||typeof T=="boolean"){if(w!==T)return E[b]=T,!0}else if(w.equals(T)===!1)return w.copy(T),!0}return!1}function p(y){const _=y.uniforms;let x=0;const E=16;for(let b=0,w=_.length;b<w;b++){const A=Array.isArray(_[b])?_[b]:[_[b]];for(let S=0,C=A.length;S<C;S++){const R=A[S],P=Array.isArray(R.value)?R.value:[R.value];for(let M=0,N=P.length;M<N;M++){const D=P[M],I=m(D),L=x%E,z=L%I.boundary,B=L+z;x+=z,B!==0&&E-B<I.storage&&(x+=E-B),R.__data=new Float32Array(I.storage/Float32Array.BYTES_PER_ELEMENT),R.__offset=x,x+=I.storage}}}const T=x%E;return T>0&&(x+=E-T),y.__size=x,y.__cache={},this}function m(y){const _={boundary:0,storage:0};return typeof y=="number"||typeof y=="boolean"?(_.boundary=4,_.storage=4):y.isVector2?(_.boundary=8,_.storage=8):y.isVector3||y.isColor?(_.boundary=16,_.storage=12):y.isVector4?(_.boundary=16,_.storage=16):y.isMatrix3?(_.boundary=48,_.storage=48):y.isMatrix4?(_.boundary=64,_.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),_}function v(y){const _=y.target;_.removeEventListener("dispose",v);const x=s.indexOf(_.__bindingPointIndex);s.splice(x,1),r.deleteBuffer(i[_.id]),delete i[_.id],delete a[_.id]}function g(){for(const y in i)r.deleteBuffer(i[y]);s=[],i={},a={}}return{bind:l,update:u,dispose:g}}class jre{constructor(e={}){const{canvas:t=lz(),context:n=null,depth:i=!0,stencil:a=!1,alpha:s=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:u=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:h=!1,reverseDepthBuffer:d=!1}=e;this.isWebGLRenderer=!0;let f;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");f=n.getContextAttributes().alpha}else f=s;const p=new Uint32Array(4),m=new Int32Array(4);let v=null,g=null;const y=[],_=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=xi,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const x=this;let E=!1;this._outputColorSpace=ft;let T=0,b=0,w=null,A=-1,S=null;const C=new xt,R=new xt;let P=null;const M=new ct(0);let N=0,D=t.width,I=t.height,L=1,z=null,B=null;const k=new xt(0,0,D,I),U=new xt(0,0,D,I);let G=!1;const O=new hm;let F=!1,V=!1;const $=new Ut,Z=new Ut,Y=new re,X=new xt,K={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let se=!1;function oe(){return w===null?L:1}let W=n;function Ne(Q,ye){return t.getContext(Q,ye)}try{const Q={alpha:!0,depth:i,stencil:a,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:u,powerPreference:c,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${oh}`),t.addEventListener("webglcontextlost",_e,!1),t.addEventListener("webglcontextrestored",ke,!1),t.addEventListener("webglcontextcreationerror",Ie,!1),W===null){const ye="webgl2";if(W=Ne(ye,Q),W===null)throw Ne(ye)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Q){throw console.error("THREE.WebGLRenderer: "+Q.message),Q}let Be,we,pe,Me,Ae,j,H,te,me,Ee,le,q,ne,fe,ce,ae,ie,ee,he,ge,Te,Se,Oe,J;function ve(){Be=new ane(W),Be.init(),Se=new zre(W,Be),we=new Zte(W,Be,e,Se),pe=new kre(W,Be),we.reverseDepthBuffer&&d&&pe.buffers.depth.setReversed(!0),Me=new lne(W),Ae=new Are,j=new Gre(W,Be,pe,Ae,we,Se,Me),H=new ene(x),te=new ine(x),me=new pJ(W),Oe=new Kte(W,me),Ee=new sne(W,me,Me,Oe),le=new cne(W,Ee,me,Me),he=new une(W,we,j),ae=new Jte(Ae),q=new Sre(x,H,te,Be,we,Oe,ae),ne=new Xre(x,Ae),fe=new Cre,ce=new Ire(Be),ee=new jte(x,H,te,pe,le,f,l),ie=new Bre(x,le,we),J=new Yre(W,Me,we,pe),ge=new Qte(W,Be,Me),Te=new one(W,Be,Me),Me.programs=q.programs,x.capabilities=we,x.extensions=Be,x.properties=Ae,x.renderLists=fe,x.shadowMap=ie,x.state=pe,x.info=Me}ve();const ue=new qre(x,W);this.xr=ue,this.getContext=function(){return W},this.getContextAttributes=function(){return W.getContextAttributes()},this.forceContextLoss=function(){const Q=Be.get("WEBGL_lose_context");Q&&Q.loseContext()},this.forceContextRestore=function(){const Q=Be.get("WEBGL_lose_context");Q&&Q.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(Q){Q!==void 0&&(L=Q,this.setSize(D,I,!1))},this.getSize=function(Q){return Q.set(D,I)},this.setSize=function(Q,ye,Ce=!0){if(ue.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}D=Q,I=ye,t.width=Math.floor(Q*L),t.height=Math.floor(ye*L),Ce===!0&&(t.style.width=Q+"px",t.style.height=ye+"px"),this.setViewport(0,0,Q,ye)},this.getDrawingBufferSize=function(Q){return Q.set(D*L,I*L).floor()},this.setDrawingBufferSize=function(Q,ye,Ce){D=Q,I=ye,L=Ce,t.width=Math.floor(Q*Ce),t.height=Math.floor(ye*Ce),this.setViewport(0,0,Q,ye)},this.getCurrentViewport=function(Q){return Q.copy(C)},this.getViewport=function(Q){return Q.copy(k)},this.setViewport=function(Q,ye,Ce,Re){Q.isVector4?k.set(Q.x,Q.y,Q.z,Q.w):k.set(Q,ye,Ce,Re),pe.viewport(C.copy(k).multiplyScalar(L).round())},this.getScissor=function(Q){return Q.copy(U)},this.setScissor=function(Q,ye,Ce,Re){Q.isVector4?U.set(Q.x,Q.y,Q.z,Q.w):U.set(Q,ye,Ce,Re),pe.scissor(R.copy(U).multiplyScalar(L).round())},this.getScissorTest=function(){return G},this.setScissorTest=function(Q){pe.setScissorTest(G=Q)},this.setOpaqueSort=function(Q){z=Q},this.setTransparentSort=function(Q){B=Q},this.getClearColor=function(Q){return Q.copy(ee.getClearColor())},this.setClearColor=function(){ee.setClearColor(...arguments)},this.getClearAlpha=function(){return ee.getClearAlpha()},this.setClearAlpha=function(){ee.setClearAlpha(...arguments)},this.clear=function(Q=!0,ye=!0,Ce=!0){let Re=0;if(Q){let xe=!1;if(w!==null){const ze=w.texture.format;xe=ze===ch||ze===uh||ze===lh}if(xe){const ze=w.texture.type,Ke=ze===In||ze===hn||ze===Pa||ze===Gi||ze===rm||ze===im,st=ee.getClearColor(),ot=ee.getClearAlpha(),pt=st.r,rt=st.g,Ve=st.b;Ke?(p[0]=pt,p[1]=rt,p[2]=Ve,p[3]=ot,W.clearBufferuiv(W.COLOR,0,p)):(m[0]=pt,m[1]=rt,m[2]=Ve,m[3]=ot,W.clearBufferiv(W.COLOR,0,m))}else Re|=W.COLOR_BUFFER_BIT}ye&&(Re|=W.DEPTH_BUFFER_BIT),Ce&&(Re|=W.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),W.clear(Re)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",_e,!1),t.removeEventListener("webglcontextrestored",ke,!1),t.removeEventListener("webglcontextcreationerror",Ie,!1),ee.dispose(),fe.dispose(),ce.dispose(),Ae.dispose(),H.dispose(),te.dispose(),le.dispose(),Oe.dispose(),J.dispose(),q.dispose(),ue.dispose(),ue.removeEventListener("sessionstart",Xt),ue.removeEventListener("sessionend",gt),vt.stop()};function _e(Q){Q.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),E=!0}function ke(){console.log("THREE.WebGLRenderer: Context Restored."),E=!1;const Q=Me.autoReset,ye=ie.enabled,Ce=ie.autoUpdate,Re=ie.needsUpdate,xe=ie.type;ve(),Me.autoReset=Q,ie.enabled=ye,ie.autoUpdate=Ce,ie.needsUpdate=Re,ie.type=xe}function Ie(Q){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Q.statusMessage)}function je(Q){const ye=Q.target;ye.removeEventListener("dispose",je),$e(ye)}function $e(Q){Xe(Q),Ae.remove(Q)}function Xe(Q){const ye=Ae.get(Q).programs;ye!==void 0&&(ye.forEach(function(Ce){q.releaseProgram(Ce)}),Q.isShaderMaterial&&q.releaseShaderCache(Q))}this.renderBufferDirect=function(Q,ye,Ce,Re,xe,ze){ye===null&&(ye=K);const Ke=xe.isMesh&&xe.matrixWorld.determinant()<0,st=Va(Q,ye,Ce,Re,xe);pe.setMaterial(Re,Ke);let ot=Ce.index,pt=1;if(Re.wireframe===!0){if(ot=Ee.getWireframeAttribute(Ce),ot===void 0)return;pt=2}const rt=Ce.drawRange,Ve=Ce.attributes.position;let ut=rt.start*pt,It=(rt.start+rt.count)*pt;ze!==null&&(ut=Math.max(ut,ze.start*pt),It=Math.min(It,(ze.start+ze.count)*pt)),ot!==null?(ut=Math.max(ut,0),It=Math.min(It,ot.count)):Ve!=null&&(ut=Math.max(ut,0),It=Math.min(It,Ve.count));const Vt=It-ut;if(Vt<0||Vt===1/0)return;Oe.setup(xe,Re,st,Ce,ot);let Ln,Yt=ge;if(ot!==null&&(Ln=me.get(ot),Yt=Te,Yt.setIndex(Ln)),xe.isMesh)Re.wireframe===!0?(pe.setLineWidth(Re.wireframeLinewidth*oe()),Yt.setMode(W.LINES)):Yt.setMode(W.TRIANGLES);else if(xe.isLine){let yt=Re.linewidth;yt===void 0&&(yt=1),pe.setLineWidth(yt*oe()),xe.isLineSegments?Yt.setMode(W.LINES):xe.isLineLoop?Yt.setMode(W.LINE_LOOP):Yt.setMode(W.LINE_STRIP)}else xe.isPoints?Yt.setMode(W.POINTS):xe.isSprite&&Yt.setMode(W.TRIANGLES);if(xe.isBatchedMesh)if(xe._multiDrawInstances!==null)Ia("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Yt.renderMultiDrawInstances(xe._multiDrawStarts,xe._multiDrawCounts,xe._multiDrawCount,xe._multiDrawInstances);else if(Be.get("WEBGL_multi_draw"))Yt.renderMultiDraw(xe._multiDrawStarts,xe._multiDrawCounts,xe._multiDrawCount);else{const yt=xe._multiDrawStarts,Tr=xe._multiDrawCounts,Jt=xe._multiDrawCount,ga=ot?me.get(ot).bytesPerElement:1,fu=Ae.get(Re).currentProgram.getUniforms();for(let Ai=0;Ai<Jt;Ai++)fu.setValue(W,"_gl_DrawID",Ai),Yt.render(yt[Ai]/ga,Tr[Ai])}else if(xe.isInstancedMesh)Yt.renderInstances(ut,Vt,xe.count);else if(Ce.isInstancedBufferGeometry){const yt=Ce._maxInstanceCount!==void 0?Ce._maxInstanceCount:1/0,Tr=Math.min(Ce.instanceCount,yt);Yt.renderInstances(ut,Vt,Tr)}else Yt.render(ut,Vt)};function Je(Q,ye,Ce){Q.transparent===!0&&Q.side===Qr&&Q.forceSinglePass===!1?(Q.side=dn,Q.needsUpdate=!0,Dn(Q,ye,Ce),Q.side=yi,Q.needsUpdate=!0,Dn(Q,ye,Ce),Q.side=Qr):Dn(Q,ye,Ce)}this.compile=function(Q,ye,Ce=null){Ce===null&&(Ce=Q),g=ce.get(Ce),g.init(ye),_.push(g),Ce.traverseVisible(function(xe){xe.isLight&&xe.layers.test(ye.layers)&&(g.pushLight(xe),xe.castShadow&&g.pushShadow(xe))}),Q!==Ce&&Q.traverseVisible(function(xe){xe.isLight&&xe.layers.test(ye.layers)&&(g.pushLight(xe),xe.castShadow&&g.pushShadow(xe))}),g.setupLights();const Re=new Set;return Q.traverse(function(xe){if(!(xe.isMesh||xe.isPoints||xe.isLine||xe.isSprite))return;const ze=xe.material;if(ze)if(Array.isArray(ze))for(let Ke=0;Ke<ze.length;Ke++){const st=ze[Ke];Je(st,Ce,xe),Re.add(st)}else Je(ze,Ce,xe),Re.add(ze)}),g=_.pop(),Re},this.compileAsync=function(Q,ye,Ce=null){const Re=this.compile(Q,ye,Ce);return new Promise(xe=>{function ze(){if(Re.forEach(function(Ke){Ae.get(Ke).currentProgram.isReady()&&Re.delete(Ke)}),Re.size===0){xe(Q);return}setTimeout(ze,10)}Be.get("KHR_parallel_shader_compile")!==null?ze():setTimeout(ze,10)})};let nt=null;function at(Q){nt&&nt(Q)}function Xt(){vt.stop()}function gt(){vt.start()}const vt=new Az;vt.setAnimationLoop(at),typeof self<"u"&&vt.setContext(self),this.setAnimationLoop=function(Q){nt=Q,ue.setAnimationLoop(Q),Q===null?vt.stop():vt.start()},ue.addEventListener("sessionstart",Xt),ue.addEventListener("sessionend",gt),this.render=function(Q,ye){if(ye!==void 0&&ye.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(E===!0)return;if(Q.matrixWorldAutoUpdate===!0&&Q.updateMatrixWorld(),ye.parent===null&&ye.matrixWorldAutoUpdate===!0&&ye.updateMatrixWorld(),ue.enabled===!0&&ue.isPresenting===!0&&(ue.cameraAutoUpdate===!0&&ue.updateCamera(ye),ye=ue.getCamera()),Q.isScene===!0&&Q.onBeforeRender(x,Q,ye,w),g=ce.get(Q,_.length),g.init(ye),_.push(g),Z.multiplyMatrices(ye.projectionMatrix,ye.matrixWorldInverse),O.setFromProjectionMatrix(Z),V=this.localClippingEnabled,F=ae.init(this.clippingPlanes,V),v=fe.get(Q,y.length),v.init(),y.push(v),ue.enabled===!0&&ue.isPresenting===!0){const ze=x.xr.getDepthSensingMesh();ze!==null&&pn(ze,ye,-1/0,x.sortObjects)}pn(Q,ye,0,x.sortObjects),v.finish(),x.sortObjects===!0&&v.sort(z,B),se=ue.enabled===!1||ue.isPresenting===!1||ue.hasDepthSensing()===!1,se&&ee.addToRenderList(v,Q),this.info.render.frame++,F===!0&&ae.beginShadows();const Ce=g.state.shadowsArray;ie.render(Ce,Q,ye),F===!0&&ae.endShadows(),this.info.autoReset===!0&&this.info.reset();const Re=v.opaque,xe=v.transmissive;if(g.setupLights(),ye.isArrayCamera){const ze=ye.cameras;if(xe.length>0)for(let Ke=0,st=ze.length;Ke<st;Ke++){const ot=ze[Ke];Gt(Re,xe,Q,ot)}se&&ee.render(Q);for(let Ke=0,st=ze.length;Ke<st;Ke++){const ot=ze[Ke];Ft(v,Q,ot,ot.viewport)}}else xe.length>0&&Gt(Re,xe,Q,ye),se&&ee.render(Q),Ft(v,Q,ye);w!==null&&b===0&&(j.updateMultisampleRenderTarget(w),j.updateRenderTargetMipmap(w)),Q.isScene===!0&&Q.onAfterRender(x,Q,ye),Oe.resetDefaultState(),A=-1,S=null,_.pop(),_.length>0?(g=_[_.length-1],F===!0&&ae.setGlobalState(x.clippingPlanes,g.state.camera)):g=null,y.pop(),y.length>0?v=y[y.length-1]:v=null};function pn(Q,ye,Ce,Re){if(Q.visible===!1)return;if(Q.layers.test(ye.layers)){if(Q.isGroup)Ce=Q.renderOrder;else if(Q.isLOD)Q.autoUpdate===!0&&Q.update(ye);else if(Q.isLight)g.pushLight(Q),Q.castShadow&&g.pushShadow(Q);else if(Q.isSprite){if(!Q.frustumCulled||O.intersectsSprite(Q)){Re&&X.setFromMatrixPosition(Q.matrixWorld).applyMatrix4(Z);const Ke=le.update(Q),st=Q.material;st.visible&&v.push(Q,Ke,st,Ce,X.z,null)}}else if((Q.isMesh||Q.isLine||Q.isPoints)&&(!Q.frustumCulled||O.intersectsObject(Q))){const Ke=le.update(Q),st=Q.material;if(Re&&(Q.boundingSphere!==void 0?(Q.boundingSphere===null&&Q.computeBoundingSphere(),X.copy(Q.boundingSphere.center)):(Ke.boundingSphere===null&&Ke.computeBoundingSphere(),X.copy(Ke.boundingSphere.center)),X.applyMatrix4(Q.matrixWorld).applyMatrix4(Z)),Array.isArray(st)){const ot=Ke.groups;for(let pt=0,rt=ot.length;pt<rt;pt++){const Ve=ot[pt],ut=st[Ve.materialIndex];ut&&ut.visible&&v.push(Q,Ke,ut,Ce,X.z,Ve)}}else st.visible&&v.push(Q,Ke,st,Ce,X.z,null)}}const ze=Q.children;for(let Ke=0,st=ze.length;Ke<st;Ke++)pn(ze[Ke],ye,Ce,Re)}function Ft(Q,ye,Ce,Re){const xe=Q.opaque,ze=Q.transmissive,Ke=Q.transparent;g.setupLightsView(Ce),F===!0&&ae.setGlobalState(x.clippingPlanes,Ce),Re&&pe.viewport(C.copy(Re)),xe.length>0&&Rt(xe,ye,Ce),ze.length>0&&Rt(ze,ye,Ce),Ke.length>0&&Rt(Ke,ye,Ce),pe.buffers.depth.setTest(!0),pe.buffers.depth.setMask(!0),pe.buffers.color.setMask(!0),pe.setPolygonOffset(!1)}function Gt(Q,ye,Ce,Re){if((Ce.isScene===!0?Ce.overrideMaterial:null)!==null)return;g.state.transmissionRenderTarget[Re.id]===void 0&&(g.state.transmissionRenderTarget[Re.id]=new Xo(1,1,{generateMipmaps:!0,type:Be.has("EXT_color_buffer_half_float")||Be.has("EXT_color_buffer_float")?kr:In,minFilter:fi,samples:4,stencilBuffer:a,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Dt.workingColorSpace}));const ze=g.state.transmissionRenderTarget[Re.id],Ke=Re.viewport||C;ze.setSize(Ke.z*x.transmissionResolutionScale,Ke.w*x.transmissionResolutionScale);const st=x.getRenderTarget();x.setRenderTarget(ze),x.getClearColor(M),N=x.getClearAlpha(),N<1&&x.setClearColor(16777215,.5),x.clear(),se&&ee.render(Ce);const ot=x.toneMapping;x.toneMapping=xi;const pt=Re.viewport;if(Re.viewport!==void 0&&(Re.viewport=void 0),g.setupLightsView(Re),F===!0&&ae.setGlobalState(x.clippingPlanes,Re),Rt(Q,Ce,Re),j.updateMultisampleRenderTarget(ze),j.updateRenderTargetMipmap(ze),Be.has("WEBGL_multisampled_render_to_texture")===!1){let rt=!1;for(let Ve=0,ut=ye.length;Ve<ut;Ve++){const It=ye[Ve],Vt=It.object,Ln=It.geometry,Yt=It.material,yt=It.group;if(Yt.side===Qr&&Vt.layers.test(Re.layers)){const Tr=Yt.side;Yt.side=dn,Yt.needsUpdate=!0,fr(Vt,Ce,Re,Ln,Yt,yt),Yt.side=Tr,Yt.needsUpdate=!0,rt=!0}}rt===!0&&(j.updateMultisampleRenderTarget(ze),j.updateRenderTargetMipmap(ze))}x.setRenderTarget(st),x.setClearColor(M,N),pt!==void 0&&(Re.viewport=pt),x.toneMapping=ot}function Rt(Q,ye,Ce){const Re=ye.isScene===!0?ye.overrideMaterial:null;for(let xe=0,ze=Q.length;xe<ze;xe++){const Ke=Q[xe],st=Ke.object,ot=Ke.geometry,pt=Ke.group;let rt=Ke.material;rt.allowOverride===!0&&Re!==null&&(rt=Re),st.layers.test(Ce.layers)&&fr(st,ye,Ce,ot,rt,pt)}}function fr(Q,ye,Ce,Re,xe,ze){Q.onBeforeRender(x,ye,Ce,Re,xe,ze),Q.modelViewMatrix.multiplyMatrices(Ce.matrixWorldInverse,Q.matrixWorld),Q.normalMatrix.getNormalMatrix(Q.modelViewMatrix),xe.onBeforeRender(x,ye,Ce,Re,Q,ze),xe.transparent===!0&&xe.side===Qr&&xe.forceSinglePass===!1?(xe.side=dn,xe.needsUpdate=!0,x.renderBufferDirect(Ce,ye,Re,xe,Q,ze),xe.side=yi,xe.needsUpdate=!0,x.renderBufferDirect(Ce,ye,Re,xe,Q,ze),xe.side=Qr):x.renderBufferDirect(Ce,ye,Re,xe,Q,ze),Q.onAfterRender(x,ye,Ce,Re,xe,ze)}function Dn(Q,ye,Ce){ye.isScene!==!0&&(ye=K);const Re=Ae.get(Q),xe=g.state.lights,ze=g.state.shadowsArray,Ke=xe.state.version,st=q.getParameters(Q,xe.state,ze,ye,Ce),ot=q.getProgramCacheKey(st);let pt=Re.programs;Re.environment=Q.isMeshStandardMaterial?ye.environment:null,Re.fog=ye.fog,Re.envMap=(Q.isMeshStandardMaterial?te:H).get(Q.envMap||Re.environment),Re.envMapRotation=Re.environment!==null&&Q.envMap===null?ye.environmentRotation:Q.envMapRotation,pt===void 0&&(Q.addEventListener("dispose",je),pt=new Map,Re.programs=pt);let rt=pt.get(ot);if(rt!==void 0){if(Re.currentProgram===rt&&Re.lightsStateVersion===Ke)return Wi(Q,st),rt}else st.uniforms=q.getUniforms(Q),Q.onBeforeCompile(st,x),rt=q.acquireProgram(st,ot),pt.set(ot,rt),Re.uniforms=st.uniforms;const Ve=Re.uniforms;return(!Q.isShaderMaterial&&!Q.isRawShaderMaterial||Q.clipping===!0)&&(Ve.clippingPlanes=ae.uniform),Wi(Q,st),Re.needsLights=pa(Q),Re.lightsStateVersion=Ke,Re.needsLights&&(Ve.ambientLightColor.value=xe.state.ambient,Ve.lightProbe.value=xe.state.probe,Ve.directionalLights.value=xe.state.directional,Ve.directionalLightShadows.value=xe.state.directionalShadow,Ve.spotLights.value=xe.state.spot,Ve.spotLightShadows.value=xe.state.spotShadow,Ve.rectAreaLights.value=xe.state.rectArea,Ve.ltc_1.value=xe.state.rectAreaLTC1,Ve.ltc_2.value=xe.state.rectAreaLTC2,Ve.pointLights.value=xe.state.point,Ve.pointLightShadows.value=xe.state.pointShadow,Ve.hemisphereLights.value=xe.state.hemi,Ve.directionalShadowMap.value=xe.state.directionalShadowMap,Ve.directionalShadowMatrix.value=xe.state.directionalShadowMatrix,Ve.spotShadowMap.value=xe.state.spotShadowMap,Ve.spotLightMatrix.value=xe.state.spotLightMatrix,Ve.spotLightMap.value=xe.state.spotLightMap,Ve.pointShadowMap.value=xe.state.pointShadowMap,Ve.pointShadowMatrix.value=xe.state.pointShadowMatrix),Re.currentProgram=rt,Re.uniformsList=null,rt}function ps(Q){if(Q.uniformsList===null){const ye=Q.currentProgram.getUniforms();Q.uniformsList=wg.seqWithValue(ye.seq,Q.uniforms)}return Q.uniformsList}function Wi(Q,ye){const Ce=Ae.get(Q);Ce.outputColorSpace=ye.outputColorSpace,Ce.batching=ye.batching,Ce.batchingColor=ye.batchingColor,Ce.instancing=ye.instancing,Ce.instancingColor=ye.instancingColor,Ce.instancingMorph=ye.instancingMorph,Ce.skinning=ye.skinning,Ce.morphTargets=ye.morphTargets,Ce.morphNormals=ye.morphNormals,Ce.morphColors=ye.morphColors,Ce.morphTargetsCount=ye.morphTargetsCount,Ce.numClippingPlanes=ye.numClippingPlanes,Ce.numIntersection=ye.numClipIntersection,Ce.vertexAlphas=ye.vertexAlphas,Ce.vertexTangents=ye.vertexTangents,Ce.toneMapping=ye.toneMapping}function Va(Q,ye,Ce,Re,xe){ye.isScene!==!0&&(ye=K),j.resetTextureUnits();const ze=ye.fog,Ke=Re.isMeshStandardMaterial?ye.environment:null,st=w===null?x.outputColorSpace:w.isXRRenderTarget===!0?w.texture.colorSpace:is,ot=(Re.isMeshStandardMaterial?te:H).get(Re.envMap||Ke),pt=Re.vertexColors===!0&&!!Ce.attributes.color&&Ce.attributes.color.itemSize===4,rt=!!Ce.attributes.tangent&&(!!Re.normalMap||Re.anisotropy>0),Ve=!!Ce.morphAttributes.position,ut=!!Ce.morphAttributes.normal,It=!!Ce.morphAttributes.color;let Vt=xi;Re.toneMapped&&(w===null||w.isXRRenderTarget===!0)&&(Vt=x.toneMapping);const Ln=Ce.morphAttributes.position||Ce.morphAttributes.normal||Ce.morphAttributes.color,Yt=Ln!==void 0?Ln.length:0,yt=Ae.get(Re),Tr=g.state.lights;if(F===!0&&(V===!0||Q!==S)){const $r=Q===S&&Re.id===A;ae.setState(Re,Q,$r)}let Jt=!1;Re.version===yt.__version?(yt.needsLights&&yt.lightsStateVersion!==Tr.state.version||yt.outputColorSpace!==st||xe.isBatchedMesh&&yt.batching===!1||!xe.isBatchedMesh&&yt.batching===!0||xe.isBatchedMesh&&yt.batchingColor===!0&&xe.colorTexture===null||xe.isBatchedMesh&&yt.batchingColor===!1&&xe.colorTexture!==null||xe.isInstancedMesh&&yt.instancing===!1||!xe.isInstancedMesh&&yt.instancing===!0||xe.isSkinnedMesh&&yt.skinning===!1||!xe.isSkinnedMesh&&yt.skinning===!0||xe.isInstancedMesh&&yt.instancingColor===!0&&xe.instanceColor===null||xe.isInstancedMesh&&yt.instancingColor===!1&&xe.instanceColor!==null||xe.isInstancedMesh&&yt.instancingMorph===!0&&xe.morphTexture===null||xe.isInstancedMesh&&yt.instancingMorph===!1&&xe.morphTexture!==null||yt.envMap!==ot||Re.fog===!0&&yt.fog!==ze||yt.numClippingPlanes!==void 0&&(yt.numClippingPlanes!==ae.numPlanes||yt.numIntersection!==ae.numIntersection)||yt.vertexAlphas!==pt||yt.vertexTangents!==rt||yt.morphTargets!==Ve||yt.morphNormals!==ut||yt.morphColors!==It||yt.toneMapping!==Vt||yt.morphTargetsCount!==Yt)&&(Jt=!0):(Jt=!0,yt.__version=Re.version);let ga=yt.currentProgram;Jt===!0&&(ga=Dn(Re,ye,xe));let fu=!1,Ai=!1,vh=!1;const En=ga.getUniforms(),qi=yt.uniforms;if(pe.useProgram(ga.program)&&(fu=!0,Ai=!0,vh=!0),Re.id!==A&&(A=Re.id,Ai=!0),fu||S!==Q){pe.buffers.depth.getReversed()?($.copy(Q.projectionMatrix),JQ($),eZ($),En.setValue(W,"projectionMatrix",$)):En.setValue(W,"projectionMatrix",Q.projectionMatrix),En.setValue(W,"viewMatrix",Q.matrixWorldInverse);const ii=En.map.cameraPosition;ii!==void 0&&ii.setValue(W,Y.setFromMatrixPosition(Q.matrixWorld)),we.logarithmicDepthBuffer&&En.setValue(W,"logDepthBufFC",2/(Math.log(Q.far+1)/Math.LN2)),(Re.isMeshPhongMaterial||Re.isMeshToonMaterial||Re.isMeshLambertMaterial||Re.isMeshBasicMaterial||Re.isMeshStandardMaterial||Re.isShaderMaterial)&&En.setValue(W,"isOrthographic",Q.isOrthographicCamera===!0),S!==Q&&(S=Q,Ai=!0,vh=!0)}if(xe.isSkinnedMesh){En.setOptional(W,xe,"bindMatrix"),En.setOptional(W,xe,"bindMatrixInverse");const $r=xe.skeleton;$r&&($r.boneTexture===null&&$r.computeBoneTexture(),En.setValue(W,"boneTexture",$r.boneTexture,j))}xe.isBatchedMesh&&(En.setOptional(W,xe,"batchingTexture"),En.setValue(W,"batchingTexture",xe._matricesTexture,j),En.setOptional(W,xe,"batchingIdTexture"),En.setValue(W,"batchingIdTexture",xe._indirectTexture,j),En.setOptional(W,xe,"batchingColorTexture"),xe._colorsTexture!==null&&En.setValue(W,"batchingColorTexture",xe._colorsTexture,j));const $i=Ce.morphAttributes;if(($i.position!==void 0||$i.normal!==void 0||$i.color!==void 0)&&he.update(xe,Ce,ga),(Ai||yt.receiveShadow!==xe.receiveShadow)&&(yt.receiveShadow=xe.receiveShadow,En.setValue(W,"receiveShadow",xe.receiveShadow)),Re.isMeshGouraudMaterial&&Re.envMap!==null&&(qi.envMap.value=ot,qi.flipEnvMap.value=ot.isCubeTexture&&ot.isRenderTargetTexture===!1?-1:1),Re.isMeshStandardMaterial&&Re.envMap===null&&ye.environment!==null&&(qi.envMapIntensity.value=ye.environmentIntensity),Ai&&(En.setValue(W,"toneMappingExposure",x.toneMappingExposure),yt.needsLights&&Ha(qi,vh),ze&&Re.fog===!0&&ne.refreshFogUniforms(qi,ze),ne.refreshMaterialUniforms(qi,Re,L,I,g.state.transmissionRenderTarget[Q.id]),wg.upload(W,ps(yt),qi,j)),Re.isShaderMaterial&&Re.uniformsNeedUpdate===!0&&(wg.upload(W,ps(yt),qi,j),Re.uniformsNeedUpdate=!1),Re.isSpriteMaterial&&En.setValue(W,"center",xe.center),En.setValue(W,"modelViewMatrix",xe.modelViewMatrix),En.setValue(W,"normalMatrix",xe.normalMatrix),En.setValue(W,"modelMatrix",xe.matrixWorld),Re.isShaderMaterial||Re.isRawShaderMaterial){const $r=Re.uniformsGroups;for(let ii=0,Gm=$r.length;ii<Gm;ii++){const sl=$r[ii];J.update(sl,ga),J.bind(sl,ga)}}return ga}function Ha(Q,ye){Q.ambientLightColor.needsUpdate=ye,Q.lightProbe.needsUpdate=ye,Q.directionalLights.needsUpdate=ye,Q.directionalLightShadows.needsUpdate=ye,Q.pointLights.needsUpdate=ye,Q.pointLightShadows.needsUpdate=ye,Q.spotLights.needsUpdate=ye,Q.spotLightShadows.needsUpdate=ye,Q.rectAreaLights.needsUpdate=ye,Q.hemisphereLights.needsUpdate=ye}function pa(Q){return Q.isMeshLambertMaterial||Q.isMeshToonMaterial||Q.isMeshPhongMaterial||Q.isMeshStandardMaterial||Q.isShadowMaterial||Q.isShaderMaterial&&Q.lights===!0}this.getActiveCubeFace=function(){return T},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(Q,ye,Ce){const Re=Ae.get(Q);Re.__autoAllocateDepthBuffer=Q.resolveDepthBuffer===!1,Re.__autoAllocateDepthBuffer===!1&&(Re.__useRenderToTexture=!1),Ae.get(Q.texture).__webglTexture=ye,Ae.get(Q.depthTexture).__webglTexture=Re.__autoAllocateDepthBuffer?void 0:Ce,Re.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(Q,ye){const Ce=Ae.get(Q);Ce.__webglFramebuffer=ye,Ce.__useDefaultFramebuffer=ye===void 0};const ao=W.createFramebuffer();this.setRenderTarget=function(Q,ye=0,Ce=0){w=Q,T=ye,b=Ce;let Re=!0,xe=null,ze=!1,Ke=!1;if(Q){const ot=Ae.get(Q);if(ot.__useDefaultFramebuffer!==void 0)pe.bindFramebuffer(W.FRAMEBUFFER,null),Re=!1;else if(ot.__webglFramebuffer===void 0)j.setupRenderTarget(Q);else if(ot.__hasExternalTextures)j.rebindTextures(Q,Ae.get(Q.texture).__webglTexture,Ae.get(Q.depthTexture).__webglTexture);else if(Q.depthBuffer){const Ve=Q.depthTexture;if(ot.__boundDepthTexture!==Ve){if(Ve!==null&&Ae.has(Ve)&&(Q.width!==Ve.image.width||Q.height!==Ve.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");j.setupDepthRenderbuffer(Q)}}const pt=Q.texture;(pt.isData3DTexture||pt.isDataArrayTexture||pt.isCompressedArrayTexture)&&(Ke=!0);const rt=Ae.get(Q).__webglFramebuffer;Q.isWebGLCubeRenderTarget?(Array.isArray(rt[ye])?xe=rt[ye][Ce]:xe=rt[ye],ze=!0):Q.samples>0&&j.useMultisampledRTT(Q)===!1?xe=Ae.get(Q).__webglMultisampledFramebuffer:Array.isArray(rt)?xe=rt[Ce]:xe=rt,C.copy(Q.viewport),R.copy(Q.scissor),P=Q.scissorTest}else C.copy(k).multiplyScalar(L).floor(),R.copy(U).multiplyScalar(L).floor(),P=G;if(Ce!==0&&(xe=ao),pe.bindFramebuffer(W.FRAMEBUFFER,xe)&&Re&&pe.drawBuffers(Q,xe),pe.viewport(C),pe.scissor(R),pe.setScissorTest(P),ze){const ot=Ae.get(Q.texture);W.framebufferTexture2D(W.FRAMEBUFFER,W.COLOR_ATTACHMENT0,W.TEXTURE_CUBE_MAP_POSITIVE_X+ye,ot.__webglTexture,Ce)}else if(Ke){const ot=Ae.get(Q.texture),pt=ye;W.framebufferTextureLayer(W.FRAMEBUFFER,W.COLOR_ATTACHMENT0,ot.__webglTexture,Ce,pt)}else if(Q!==null&&Ce!==0){const ot=Ae.get(Q.texture);W.framebufferTexture2D(W.FRAMEBUFFER,W.COLOR_ATTACHMENT0,W.TEXTURE_2D,ot.__webglTexture,Ce)}A=-1},this.readRenderTargetPixels=function(Q,ye,Ce,Re,xe,ze,Ke){if(!(Q&&Q.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let st=Ae.get(Q).__webglFramebuffer;if(Q.isWebGLCubeRenderTarget&&Ke!==void 0&&(st=st[Ke]),st){pe.bindFramebuffer(W.FRAMEBUFFER,st);try{const ot=Q.texture,pt=ot.format,rt=ot.type;if(!we.textureFormatReadable(pt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!we.textureTypeReadable(rt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ye>=0&&ye<=Q.width-Re&&Ce>=0&&Ce<=Q.height-xe&&W.readPixels(ye,Ce,Re,xe,Se.convert(pt),Se.convert(rt),ze)}finally{const ot=w!==null?Ae.get(w).__webglFramebuffer:null;pe.bindFramebuffer(W.FRAMEBUFFER,ot)}}},this.readRenderTargetPixelsAsync=async function(Q,ye,Ce,Re,xe,ze,Ke){if(!(Q&&Q.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let st=Ae.get(Q).__webglFramebuffer;if(Q.isWebGLCubeRenderTarget&&Ke!==void 0&&(st=st[Ke]),st)if(ye>=0&&ye<=Q.width-Re&&Ce>=0&&Ce<=Q.height-xe){pe.bindFramebuffer(W.FRAMEBUFFER,st);const ot=Q.texture,pt=ot.format,rt=ot.type;if(!we.textureFormatReadable(pt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!we.textureTypeReadable(rt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Ve=W.createBuffer();W.bindBuffer(W.PIXEL_PACK_BUFFER,Ve),W.bufferData(W.PIXEL_PACK_BUFFER,ze.byteLength,W.STREAM_READ),W.readPixels(ye,Ce,Re,xe,Se.convert(pt),Se.convert(rt),0);const ut=w!==null?Ae.get(w).__webglFramebuffer:null;pe.bindFramebuffer(W.FRAMEBUFFER,ut);const It=W.fenceSync(W.SYNC_GPU_COMMANDS_COMPLETE,0);return W.flush(),await ZQ(W,It,4),W.bindBuffer(W.PIXEL_PACK_BUFFER,Ve),W.getBufferSubData(W.PIXEL_PACK_BUFFER,0,ze),W.deleteBuffer(Ve),W.deleteSync(It),ze}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(Q,ye=null,Ce=0){const Re=Math.pow(2,-Ce),xe=Math.floor(Q.image.width*Re),ze=Math.floor(Q.image.height*Re),Ke=ye!==null?ye.x:0,st=ye!==null?ye.y:0;j.setTexture2D(Q,0),W.copyTexSubImage2D(W.TEXTURE_2D,Ce,0,0,Ke,st,xe,ze),pe.unbindTexture()};const Wa=W.createFramebuffer(),qa=W.createFramebuffer();this.copyTextureToTexture=function(Q,ye,Ce=null,Re=null,xe=0,ze=null){ze===null&&(xe!==0?(Ia("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),ze=xe,xe=0):ze=0);let Ke,st,ot,pt,rt,Ve,ut,It,Vt;const Ln=Q.isCompressedTexture?Q.mipmaps[ze]:Q.image;if(Ce!==null)Ke=Ce.max.x-Ce.min.x,st=Ce.max.y-Ce.min.y,ot=Ce.isBox3?Ce.max.z-Ce.min.z:1,pt=Ce.min.x,rt=Ce.min.y,Ve=Ce.isBox3?Ce.min.z:0;else{const $i=Math.pow(2,-xe);Ke=Math.floor(Ln.width*$i),st=Math.floor(Ln.height*$i),Q.isDataArrayTexture?ot=Ln.depth:Q.isData3DTexture?ot=Math.floor(Ln.depth*$i):ot=1,pt=0,rt=0,Ve=0}Re!==null?(ut=Re.x,It=Re.y,Vt=Re.z):(ut=0,It=0,Vt=0);const Yt=Se.convert(ye.format),yt=Se.convert(ye.type);let Tr;ye.isData3DTexture?(j.setTexture3D(ye,0),Tr=W.TEXTURE_3D):ye.isDataArrayTexture||ye.isCompressedArrayTexture?(j.setTexture2DArray(ye,0),Tr=W.TEXTURE_2D_ARRAY):(j.setTexture2D(ye,0),Tr=W.TEXTURE_2D),W.pixelStorei(W.UNPACK_FLIP_Y_WEBGL,ye.flipY),W.pixelStorei(W.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ye.premultiplyAlpha),W.pixelStorei(W.UNPACK_ALIGNMENT,ye.unpackAlignment);const Jt=W.getParameter(W.UNPACK_ROW_LENGTH),ga=W.getParameter(W.UNPACK_IMAGE_HEIGHT),fu=W.getParameter(W.UNPACK_SKIP_PIXELS),Ai=W.getParameter(W.UNPACK_SKIP_ROWS),vh=W.getParameter(W.UNPACK_SKIP_IMAGES);W.pixelStorei(W.UNPACK_ROW_LENGTH,Ln.width),W.pixelStorei(W.UNPACK_IMAGE_HEIGHT,Ln.height),W.pixelStorei(W.UNPACK_SKIP_PIXELS,pt),W.pixelStorei(W.UNPACK_SKIP_ROWS,rt),W.pixelStorei(W.UNPACK_SKIP_IMAGES,Ve);const En=Q.isDataArrayTexture||Q.isData3DTexture,qi=ye.isDataArrayTexture||ye.isData3DTexture;if(Q.isDepthTexture){const $i=Ae.get(Q),$r=Ae.get(ye),ii=Ae.get($i.__renderTarget),Gm=Ae.get($r.__renderTarget);pe.bindFramebuffer(W.READ_FRAMEBUFFER,ii.__webglFramebuffer),pe.bindFramebuffer(W.DRAW_FRAMEBUFFER,Gm.__webglFramebuffer);for(let sl=0;sl<ot;sl++)En&&(W.framebufferTextureLayer(W.READ_FRAMEBUFFER,W.COLOR_ATTACHMENT0,Ae.get(Q).__webglTexture,xe,Ve+sl),W.framebufferTextureLayer(W.DRAW_FRAMEBUFFER,W.COLOR_ATTACHMENT0,Ae.get(ye).__webglTexture,ze,Vt+sl)),W.blitFramebuffer(pt,rt,Ke,st,ut,It,Ke,st,W.DEPTH_BUFFER_BIT,W.NEAREST);pe.bindFramebuffer(W.READ_FRAMEBUFFER,null),pe.bindFramebuffer(W.DRAW_FRAMEBUFFER,null)}else if(xe!==0||Q.isRenderTargetTexture||Ae.has(Q)){const $i=Ae.get(Q),$r=Ae.get(ye);pe.bindFramebuffer(W.READ_FRAMEBUFFER,Wa),pe.bindFramebuffer(W.DRAW_FRAMEBUFFER,qa);for(let ii=0;ii<ot;ii++)En?W.framebufferTextureLayer(W.READ_FRAMEBUFFER,W.COLOR_ATTACHMENT0,$i.__webglTexture,xe,Ve+ii):W.framebufferTexture2D(W.READ_FRAMEBUFFER,W.COLOR_ATTACHMENT0,W.TEXTURE_2D,$i.__webglTexture,xe),qi?W.framebufferTextureLayer(W.DRAW_FRAMEBUFFER,W.COLOR_ATTACHMENT0,$r.__webglTexture,ze,Vt+ii):W.framebufferTexture2D(W.DRAW_FRAMEBUFFER,W.COLOR_ATTACHMENT0,W.TEXTURE_2D,$r.__webglTexture,ze),xe!==0?W.blitFramebuffer(pt,rt,Ke,st,ut,It,Ke,st,W.COLOR_BUFFER_BIT,W.NEAREST):qi?W.copyTexSubImage3D(Tr,ze,ut,It,Vt+ii,pt,rt,Ke,st):W.copyTexSubImage2D(Tr,ze,ut,It,pt,rt,Ke,st);pe.bindFramebuffer(W.READ_FRAMEBUFFER,null),pe.bindFramebuffer(W.DRAW_FRAMEBUFFER,null)}else qi?Q.isDataTexture||Q.isData3DTexture?W.texSubImage3D(Tr,ze,ut,It,Vt,Ke,st,ot,Yt,yt,Ln.data):ye.isCompressedArrayTexture?W.compressedTexSubImage3D(Tr,ze,ut,It,Vt,Ke,st,ot,Yt,Ln.data):W.texSubImage3D(Tr,ze,ut,It,Vt,Ke,st,ot,Yt,yt,Ln):Q.isDataTexture?W.texSubImage2D(W.TEXTURE_2D,ze,ut,It,Ke,st,Yt,yt,Ln.data):Q.isCompressedTexture?W.compressedTexSubImage2D(W.TEXTURE_2D,ze,ut,It,Ln.width,Ln.height,Yt,Ln.data):W.texSubImage2D(W.TEXTURE_2D,ze,ut,It,Ke,st,Yt,yt,Ln);W.pixelStorei(W.UNPACK_ROW_LENGTH,Jt),W.pixelStorei(W.UNPACK_IMAGE_HEIGHT,ga),W.pixelStorei(W.UNPACK_SKIP_PIXELS,fu),W.pixelStorei(W.UNPACK_SKIP_ROWS,Ai),W.pixelStorei(W.UNPACK_SKIP_IMAGES,vh),ze===0&&ye.generateMipmaps&&W.generateMipmap(Tr),pe.unbindTexture()},this.copyTextureToTexture3D=function(Q,ye,Ce=null,Re=null,xe=0){return Ia('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(Q,ye,Ce,Re,xe)},this.initRenderTarget=function(Q){Ae.get(Q).__webglFramebuffer===void 0&&j.setupRenderTarget(Q)},this.initTexture=function(Q){Q.isCubeTexture?j.setTextureCube(Q,0):Q.isData3DTexture?j.setTexture3D(Q,0):Q.isDataArrayTexture||Q.isCompressedArrayTexture?j.setTexture2DArray(Q,0):j.setTexture2D(Q,0),pe.unbindTexture()},this.resetState=function(){T=0,b=0,w=null,pe.reset(),Oe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return di}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=Dt._getDrawingBufferColorSpace(e),t.unpackColorSpace=Dt._getUnpackColorSpace()}}const pc=new Sa,Ps=new He,Pz=new re,p1=new He,Sg=new He,iv=new re,Kw=new re,Dz=new Ut,Lz=new re,Iz=new re;let ui=null,ja=null;const Ds=[],Io={NONE:-1,PAN:0,ROTATE:1};class Kre extends pm{constructor(e,t,n=null){super(t,n),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new Sz,this.mouseButtons={LEFT:Ar.PAN,MIDDLE:Ar.PAN,RIGHT:Ar.ROTATE},this.touches={ONE:Fs.PAN},this._onPointerMove=Qre.bind(this),this._onPointerDown=Zre.bind(this),this._onPointerCancel=Jre.bind(this),this._onContextMenu=eie.bind(this),n!==null&&this.connect(n)}connect(e){super.connect(e),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){const t=this.domElement.getBoundingClientRect();Ps.x=(e.clientX-t.left)/t.width*2-1,Ps.y=-(e.clientY-t.top)/t.height*2+1}_updateState(e){let t;if(e.pointerType==="touch")t=this.touches.ONE;else switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=null}switch(t){case Ar.PAN:case Fs.PAN:this.state=Io.PAN;break;case Ar.ROTATE:case Fs.ROTATE:this.state=Io.ROTATE;break;default:this.state=Io.NONE}}getRaycaster(){return console.warn("THREE.DragControls: getRaycaster() has been deprecated. Use controls.raycaster instead."),this.raycaster}setObjects(e){console.warn("THREE.DragControls: setObjects() has been deprecated. Use controls.objects instead."),this.objects=e}getObjects(){return console.warn("THREE.DragControls: getObjects() has been deprecated. Use controls.objects instead."),this.objects}activate(){console.warn("THREE.DragControls: activate() has been renamed to connect()."),this.connect()}deactivate(){console.warn("THREE.DragControls: deactivate() has been renamed to disconnect()."),this.disconnect()}set mode(e){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}get mode(){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}}function Qre(r){const e=this.object,t=this.domElement,n=this.raycaster;if(this.enabled!==!1){if(this._updatePointer(r),n.setFromCamera(Ps,e),ui)this.state===Io.PAN?n.ray.intersectPlane(pc,iv)&&ui.position.copy(iv.sub(Pz).applyMatrix4(Dz)):this.state===Io.ROTATE&&(p1.subVectors(Ps,Sg).multiplyScalar(this.rotateSpeed),ui.rotateOnWorldAxis(Lz,p1.x),ui.rotateOnWorldAxis(Iz.normalize(),-p1.y)),this.dispatchEvent({type:"drag",object:ui}),Sg.copy(Ps);else if(r.pointerType==="mouse"||r.pointerType==="pen")if(Ds.length=0,n.setFromCamera(Ps,e),n.intersectObjects(this.objects,this.recursive,Ds),Ds.length>0){const i=Ds[0].object;pc.setFromNormalAndCoplanarPoint(e.getWorldDirection(pc.normal),Kw.setFromMatrixPosition(i.matrixWorld)),ja!==i&&ja!==null&&(this.dispatchEvent({type:"hoveroff",object:ja}),t.style.cursor="auto",ja=null),ja!==i&&(this.dispatchEvent({type:"hoveron",object:i}),t.style.cursor="pointer",ja=i)}else ja!==null&&(this.dispatchEvent({type:"hoveroff",object:ja}),t.style.cursor="auto",ja=null);Sg.copy(Ps)}}function Zre(r){const e=this.object,t=this.domElement,n=this.raycaster;this.enabled!==!1&&(this._updatePointer(r),this._updateState(r),Ds.length=0,n.setFromCamera(Ps,e),n.intersectObjects(this.objects,this.recursive,Ds),Ds.length>0&&(this.transformGroup===!0?ui=Oz(Ds[0].object):ui=Ds[0].object,pc.setFromNormalAndCoplanarPoint(e.getWorldDirection(pc.normal),Kw.setFromMatrixPosition(ui.matrixWorld)),n.ray.intersectPlane(pc,iv)&&(this.state===Io.PAN?(Dz.copy(ui.parent.matrixWorld).invert(),Pz.copy(iv).sub(Kw.setFromMatrixPosition(ui.matrixWorld))):this.state===Io.ROTATE&&(Lz.set(0,1,0).applyQuaternion(e.quaternion).normalize(),Iz.set(1,0,0).applyQuaternion(e.quaternion).normalize())),t.style.cursor="move",this.dispatchEvent({type:"dragstart",object:ui})),Sg.copy(Ps))}function Jre(){this.enabled!==!1&&(ui&&(this.dispatchEvent({type:"dragend",object:ui}),ui=null),this.domElement.style.cursor=ja?"pointer":"auto",this.state=Io.NONE)}function eie(r){this.enabled!==!1&&r.preventDefault()}function Oz(r,e=null){return r.isGroup&&(e=r),r.parent===null?e:Oz(r.parent,e)}function tie(r,e,t){var n,i=1;r==null&&(r=0),e==null&&(e=0),t==null&&(t=0);function a(){var s,o=n.length,l,u=0,c=0,h=0;for(s=0;s<o;++s)l=n[s],u+=l.x||0,c+=l.y||0,h+=l.z||0;for(u=(u/o-r)*i,c=(c/o-e)*i,h=(h/o-t)*i,s=0;s<o;++s)l=n[s],u&&(l.x-=u),c&&(l.y-=c),h&&(l.z-=h)}return a.initialize=function(s){n=s},a.x=function(s){return arguments.length?(r=+s,a):r},a.y=function(s){return arguments.length?(e=+s,a):e},a.z=function(s){return arguments.length?(t=+s,a):t},a.strength=function(s){return arguments.length?(i=+s,a):i},a}function nie(r){const e=+this._x.call(null,r);return Fz(this.cover(e),e,r)}function Fz(r,e,t){if(isNaN(e))return r;var n,i=r._root,a={data:t},s=r._x0,o=r._x1,l,u,c,h,d;if(!i)return r._root=a,r;for(;i.length;)if((c=e>=(l=(s+o)/2))?s=l:o=l,n=i,!(i=i[h=+c]))return n[h]=a,r;if(u=+r._x.call(null,i.data),e===u)return a.next=i,n?n[h]=a:r._root=a,r;do n=n?n[h]=new Array(2):r._root=new Array(2),(c=e>=(l=(s+o)/2))?s=l:o=l;while((h=+c)==(d=+(u>=l)));return n[d]=i,n[h]=a,r}function rie(r){Array.isArray(r)||(r=Array.from(r));const e=r.length,t=new Float64Array(e);let n=1/0,i=-1/0;for(let a=0,s;a<e;++a)isNaN(s=+this._x.call(null,r[a]))||(t[a]=s,s<n&&(n=s),s>i&&(i=s));if(n>i)return this;this.cover(n).cover(i);for(let a=0;a<e;++a)Fz(this,t[a],r[a]);return this}function iie(r){if(isNaN(r=+r))return this;var e=this._x0,t=this._x1;if(isNaN(e))t=(e=Math.floor(r))+1;else{for(var n=t-e||1,i=this._root,a,s;e>r||r>=t;)switch(s=+(r<e),a=new Array(2),a[s]=i,i=a,n*=2,s){case 0:t=e+n;break;case 1:e=t-n;break}this._root&&this._root.length&&(this._root=i)}return this._x0=e,this._x1=t,this}function aie(){var r=[];return this.visit(function(e){if(!e.length)do r.push(e.data);while(e=e.next)}),r}function sie(r){return arguments.length?this.cover(+r[0][0]).cover(+r[1][0]):isNaN(this._x0)?void 0:[[this._x0],[this._x1]]}function Vs(r,e,t){this.node=r,this.x0=e,this.x1=t}function oie(r,e){var t,n=this._x0,i,a,s=this._x1,o=[],l=this._root,u,c;for(l&&o.push(new Vs(l,n,s)),e==null?e=1/0:(n=r-e,s=r+e);u=o.pop();)if(!(!(l=u.node)||(i=u.x0)>s||(a=u.x1)<n))if(l.length){var h=(i+a)/2;o.push(new Vs(l[1],h,a),new Vs(l[0],i,h)),(c=+(r>=h))&&(u=o[o.length-1],o[o.length-1]=o[o.length-1-c],o[o.length-1-c]=u)}else{var d=Math.abs(r-+this._x.call(null,l.data));d<e&&(e=d,n=r-d,s=r+d,t=l.data)}return t}function lie(r){if(isNaN(l=+this._x.call(null,r)))return this;var e,t=this._root,n,i,a,s=this._x0,o=this._x1,l,u,c,h,d;if(!t)return this;if(t.length)for(;;){if((c=l>=(u=(s+o)/2))?s=u:o=u,e=t,!(t=t[h=+c]))return this;if(!t.length)break;e[h+1&1]&&(n=e,d=h)}for(;t.data!==r;)if(i=t,!(t=t.next))return this;return(a=t.next)&&delete t.next,i?(a?i.next=a:delete i.next,this):e?(a?e[h]=a:delete e[h],(t=e[0]||e[1])&&t===(e[1]||e[0])&&!t.length&&(n?n[d]=t:this._root=t),this):(this._root=a,this)}function uie(r){for(var e=0,t=r.length;e<t;++e)this.remove(r[e]);return this}function cie(){return this._root}function hie(){var r=0;return this.visit(function(e){if(!e.length)do++r;while(e=e.next)}),r}function fie(r){var e=[],t,n=this._root,i,a,s;for(n&&e.push(new Vs(n,this._x0,this._x1));t=e.pop();)if(!r(n=t.node,a=t.x0,s=t.x1)&&n.length){var o=(a+s)/2;(i=n[1])&&e.push(new Vs(i,o,s)),(i=n[0])&&e.push(new Vs(i,a,o))}return this}function die(r){var e=[],t=[],n;for(this._root&&e.push(new Vs(this._root,this._x0,this._x1));n=e.pop();){var i=n.node;if(i.length){var a,s=n.x0,o=n.x1,l=(s+o)/2;(a=i[0])&&e.push(new Vs(a,s,l)),(a=i[1])&&e.push(new Vs(a,l,o))}t.push(n)}for(;n=t.pop();)r(n.node,n.x0,n.x1);return this}function pie(r){return r[0]}function gie(r){return arguments.length?(this._x=r,this):this._x}function Bz(r,e){var t=new sM(e==null?pie:e,NaN,NaN);return r==null?t:t.addAll(r)}function sM(r,e,t){this._x=r,this._x0=e,this._x1=t,this._root=void 0}function uF(r){for(var e={data:r.data},t=e;r=r.next;)t=t.next={data:r.data};return e}var Si=Bz.prototype=sM.prototype;Si.copy=function(){var r=new sM(this._x,this._x0,this._x1),e=this._root,t,n;if(!e)return r;if(!e.length)return r._root=uF(e),r;for(t=[{source:e,target:r._root=new Array(2)}];e=t.pop();)for(var i=0;i<2;++i)(n=e.source[i])&&(n.length?t.push({source:n,target:e.target[i]=new Array(2)}):e.target[i]=uF(n));return r};Si.add=nie;Si.addAll=rie;Si.cover=iie;Si.data=aie;Si.extent=sie;Si.find=oie;Si.remove=lie;Si.removeAll=uie;Si.root=cie;Si.size=hie;Si.visit=fie;Si.visitAfter=die;Si.x=gie;function vie(r){const e=+this._x.call(null,r),t=+this._y.call(null,r),n=+this._z.call(null,r);return Uz(this.cover(e,t,n),e,t,n,r)}function Uz(r,e,t,n,i){if(isNaN(e)||isNaN(t)||isNaN(n))return r;var a,s=r._root,o={data:i},l=r._x0,u=r._y0,c=r._z0,h=r._x1,d=r._y1,f=r._z1,p,m,v,g,y,_,x,E,T,b,w;if(!s)return r._root=o,r;for(;s.length;)if((x=e>=(p=(l+h)/2))?l=p:h=p,(E=t>=(m=(u+d)/2))?u=m:d=m,(T=n>=(v=(c+f)/2))?c=v:f=v,a=s,!(s=s[b=T<<2|E<<1|x]))return a[b]=o,r;if(g=+r._x.call(null,s.data),y=+r._y.call(null,s.data),_=+r._z.call(null,s.data),e===g&&t===y&&n===_)return o.next=s,a?a[b]=o:r._root=o,r;do a=a?a[b]=new Array(8):r._root=new Array(8),(x=e>=(p=(l+h)/2))?l=p:h=p,(E=t>=(m=(u+d)/2))?u=m:d=m,(T=n>=(v=(c+f)/2))?c=v:f=v;while((b=T<<2|E<<1|x)===(w=(_>=v)<<2|(y>=m)<<1|g>=p));return a[w]=s,a[b]=o,r}function mie(r){Array.isArray(r)||(r=Array.from(r));const e=r.length,t=new Float64Array(e),n=new Float64Array(e),i=new Float64Array(e);let a=1/0,s=1/0,o=1/0,l=-1/0,u=-1/0,c=-1/0;for(let h=0,d,f,p,m;h<e;++h)isNaN(f=+this._x.call(null,d=r[h]))||isNaN(p=+this._y.call(null,d))||isNaN(m=+this._z.call(null,d))||(t[h]=f,n[h]=p,i[h]=m,f<a&&(a=f),f>l&&(l=f),p<s&&(s=p),p>u&&(u=p),m<o&&(o=m),m>c&&(c=m));if(a>l||s>u||o>c)return this;this.cover(a,s,o).cover(l,u,c);for(let h=0;h<e;++h)Uz(this,t[h],n[h],i[h],r[h]);return this}function yie(r,e,t){if(isNaN(r=+r)||isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,i=this._y0,a=this._z0,s=this._x1,o=this._y1,l=this._z1;if(isNaN(n))s=(n=Math.floor(r))+1,o=(i=Math.floor(e))+1,l=(a=Math.floor(t))+1;else{for(var u=s-n||1,c=this._root,h,d;n>r||r>=s||i>e||e>=o||a>t||t>=l;)switch(d=(t<a)<<2|(e<i)<<1|r<n,h=new Array(8),h[d]=c,c=h,u*=2,d){case 0:s=n+u,o=i+u,l=a+u;break;case 1:n=s-u,o=i+u,l=a+u;break;case 2:s=n+u,i=o-u,l=a+u;break;case 3:n=s-u,i=o-u,l=a+u;break;case 4:s=n+u,o=i+u,a=l-u;break;case 5:n=s-u,o=i+u,a=l-u;break;case 6:s=n+u,i=o-u,a=l-u;break;case 7:n=s-u,i=o-u,a=l-u;break}this._root&&this._root.length&&(this._root=c)}return this._x0=n,this._y0=i,this._z0=a,this._x1=s,this._y1=o,this._z1=l,this}function _ie(){var r=[];return this.visit(function(e){if(!e.length)do r.push(e.data);while(e=e.next)}),r}function xie(r){return arguments.length?this.cover(+r[0][0],+r[0][1],+r[0][2]).cover(+r[1][0],+r[1][1],+r[1][2]):isNaN(this._x0)?void 0:[[this._x0,this._y0,this._z0],[this._x1,this._y1,this._z1]]}function un(r,e,t,n,i,a,s){this.node=r,this.x0=e,this.y0=t,this.z0=n,this.x1=i,this.y1=a,this.z1=s}function bie(r,e,t,n){var i,a=this._x0,s=this._y0,o=this._z0,l,u,c,h,d,f,p=this._x1,m=this._y1,v=this._z1,g=[],y=this._root,_,x;for(y&&g.push(new un(y,a,s,o,p,m,v)),n==null?n=1/0:(a=r-n,s=e-n,o=t-n,p=r+n,m=e+n,v=t+n,n*=n);_=g.pop();)if(!(!(y=_.node)||(l=_.x0)>p||(u=_.y0)>m||(c=_.z0)>v||(h=_.x1)<a||(d=_.y1)<s||(f=_.z1)<o))if(y.length){var E=(l+h)/2,T=(u+d)/2,b=(c+f)/2;g.push(new un(y[7],E,T,b,h,d,f),new un(y[6],l,T,b,E,d,f),new un(y[5],E,u,b,h,T,f),new un(y[4],l,u,b,E,T,f),new un(y[3],E,T,c,h,d,b),new un(y[2],l,T,c,E,d,b),new un(y[1],E,u,c,h,T,b),new un(y[0],l,u,c,E,T,b)),(x=(t>=b)<<2|(e>=T)<<1|r>=E)&&(_=g[g.length-1],g[g.length-1]=g[g.length-1-x],g[g.length-1-x]=_)}else{var w=r-+this._x.call(null,y.data),A=e-+this._y.call(null,y.data),S=t-+this._z.call(null,y.data),C=w*w+A*A+S*S;if(C<n){var R=Math.sqrt(n=C);a=r-R,s=e-R,o=t-R,p=r+R,m=e+R,v=t+R,i=y.data}}return i}const Eie=(r,e,t,n,i,a)=>Math.sqrt((r-n)**2+(e-i)**2+(t-a)**2);function Tie(r,e,t,n){const i=[],a=r-n,s=e-n,o=t-n,l=r+n,u=e+n,c=t+n;return this.visit((h,d,f,p,m,v,g)=>{if(!h.length)do{const y=h.data;Eie(r,e,t,this._x(y),this._y(y),this._z(y))<=n&&i.push(y)}while(h=h.next);return d>l||f>u||p>c||m<a||v<s||g<o}),i}function wie(r){if(isNaN(d=+this._x.call(null,r))||isNaN(f=+this._y.call(null,r))||isNaN(p=+this._z.call(null,r)))return this;var e,t=this._root,n,i,a,s=this._x0,o=this._y0,l=this._z0,u=this._x1,c=this._y1,h=this._z1,d,f,p,m,v,g,y,_,x,E,T;if(!t)return this;if(t.length)for(;;){if((y=d>=(m=(s+u)/2))?s=m:u=m,(_=f>=(v=(o+c)/2))?o=v:c=v,(x=p>=(g=(l+h)/2))?l=g:h=g,e=t,!(t=t[E=x<<2|_<<1|y]))return this;if(!t.length)break;(e[E+1&7]||e[E+2&7]||e[E+3&7]||e[E+4&7]||e[E+5&7]||e[E+6&7]||e[E+7&7])&&(n=e,T=E)}for(;t.data!==r;)if(i=t,!(t=t.next))return this;return(a=t.next)&&delete t.next,i?(a?i.next=a:delete i.next,this):e?(a?e[E]=a:delete e[E],(t=e[0]||e[1]||e[2]||e[3]||e[4]||e[5]||e[6]||e[7])&&t===(e[7]||e[6]||e[5]||e[4]||e[3]||e[2]||e[1]||e[0])&&!t.length&&(n?n[T]=t:this._root=t),this):(this._root=a,this)}function Sie(r){for(var e=0,t=r.length;e<t;++e)this.remove(r[e]);return this}function Aie(){return this._root}function Mie(){var r=0;return this.visit(function(e){if(!e.length)do++r;while(e=e.next)}),r}function Cie(r){var e=[],t,n=this._root,i,a,s,o,l,u,c;for(n&&e.push(new un(n,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));t=e.pop();)if(!r(n=t.node,a=t.x0,s=t.y0,o=t.z0,l=t.x1,u=t.y1,c=t.z1)&&n.length){var h=(a+l)/2,d=(s+u)/2,f=(o+c)/2;(i=n[7])&&e.push(new un(i,h,d,f,l,u,c)),(i=n[6])&&e.push(new un(i,a,d,f,h,u,c)),(i=n[5])&&e.push(new un(i,h,s,f,l,d,c)),(i=n[4])&&e.push(new un(i,a,s,f,h,d,c)),(i=n[3])&&e.push(new un(i,h,d,o,l,u,f)),(i=n[2])&&e.push(new un(i,a,d,o,h,u,f)),(i=n[1])&&e.push(new un(i,h,s,o,l,d,f)),(i=n[0])&&e.push(new un(i,a,s,o,h,d,f))}return this}function Rie(r){var e=[],t=[],n;for(this._root&&e.push(new un(this._root,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1));n=e.pop();){var i=n.node;if(i.length){var a,s=n.x0,o=n.y0,l=n.z0,u=n.x1,c=n.y1,h=n.z1,d=(s+u)/2,f=(o+c)/2,p=(l+h)/2;(a=i[0])&&e.push(new un(a,s,o,l,d,f,p)),(a=i[1])&&e.push(new un(a,d,o,l,u,f,p)),(a=i[2])&&e.push(new un(a,s,f,l,d,c,p)),(a=i[3])&&e.push(new un(a,d,f,l,u,c,p)),(a=i[4])&&e.push(new un(a,s,o,p,d,f,h)),(a=i[5])&&e.push(new un(a,d,o,p,u,f,h)),(a=i[6])&&e.push(new un(a,s,f,p,d,c,h)),(a=i[7])&&e.push(new un(a,d,f,p,u,c,h))}t.push(n)}for(;n=t.pop();)r(n.node,n.x0,n.y0,n.z0,n.x1,n.y1,n.z1);return this}function Nie(r){return r[0]}function Pie(r){return arguments.length?(this._x=r,this):this._x}function Die(r){return r[1]}function Lie(r){return arguments.length?(this._y=r,this):this._y}function Iie(r){return r[2]}function Oie(r){return arguments.length?(this._z=r,this):this._z}function kz(r,e,t,n){var i=new oM(e==null?Nie:e,t==null?Die:t,n==null?Iie:n,NaN,NaN,NaN,NaN,NaN,NaN);return r==null?i:i.addAll(r)}function oM(r,e,t,n,i,a,s,o,l){this._x=r,this._y=e,this._z=t,this._x0=n,this._y0=i,this._z0=a,this._x1=s,this._y1=o,this._z1=l,this._root=void 0}function cF(r){for(var e={data:r.data},t=e;r=r.next;)t=t.next={data:r.data};return e}var Dr=kz.prototype=oM.prototype;Dr.copy=function(){var r=new oM(this._x,this._y,this._z,this._x0,this._y0,this._z0,this._x1,this._y1,this._z1),e=this._root,t,n;if(!e)return r;if(!e.length)return r._root=cF(e),r;for(t=[{source:e,target:r._root=new Array(8)}];e=t.pop();)for(var i=0;i<8;++i)(n=e.source[i])&&(n.length?t.push({source:n,target:e.target[i]=new Array(8)}):e.target[i]=cF(n));return r};Dr.add=vie;Dr.addAll=mie;Dr.cover=yie;Dr.data=_ie;Dr.extent=xie;Dr.find=bie;Dr.findAllWithinRadius=Tie;Dr.remove=wie;Dr.removeAll=Sie;Dr.root=Aie;Dr.size=Mie;Dr.visit=Cie;Dr.visitAfter=Rie;Dr.x=Pie;Dr.y=Lie;Dr.z=Oie;function Us(r){return function(){return r}}function Ms(r){return(r()-.5)*1e-6}function Fie(r){return r.index}function hF(r,e){var t=r.get(e);if(!t)throw new Error("node not found: "+e);return t}function Bie(r){var e=Fie,t=d,n,i=Us(30),a,s,o,l,u,c,h=1;r==null&&(r=[]);function d(g){return 1/Math.min(l[g.source.index],l[g.target.index])}function f(g){for(var y=0,_=r.length;y<h;++y)for(var x=0,E,T,b,w=0,A=0,S=0,C,R;x<_;++x)E=r[x],T=E.source,b=E.target,w=b.x+b.vx-T.x-T.vx||Ms(c),o>1&&(A=b.y+b.vy-T.y-T.vy||Ms(c)),o>2&&(S=b.z+b.vz-T.z-T.vz||Ms(c)),C=Math.sqrt(w*w+A*A+S*S),C=(C-a[x])/C*g*n[x],w*=C,A*=C,S*=C,b.vx-=w*(R=u[x]),o>1&&(b.vy-=A*R),o>2&&(b.vz-=S*R),T.vx+=w*(R=1-R),o>1&&(T.vy+=A*R),o>2&&(T.vz+=S*R)}function p(){if(!!s){var g,y=s.length,_=r.length,x=new Map(s.map((T,b)=>[e(T,b,s),T])),E;for(g=0,l=new Array(y);g<_;++g)E=r[g],E.index=g,typeof E.source!="object"&&(E.source=hF(x,E.source)),typeof E.target!="object"&&(E.target=hF(x,E.target)),l[E.source.index]=(l[E.source.index]||0)+1,l[E.target.index]=(l[E.target.index]||0)+1;for(g=0,u=new Array(_);g<_;++g)E=r[g],u[g]=l[E.source.index]/(l[E.source.index]+l[E.target.index]);n=new Array(_),m(),a=new Array(_),v()}}function m(){if(!!s)for(var g=0,y=r.length;g<y;++g)n[g]=+t(r[g],g,r)}function v(){if(!!s)for(var g=0,y=r.length;g<y;++g)a[g]=+i(r[g],g,r)}return f.initialize=function(g,...y){s=g,c=y.find(_=>typeof _=="function")||Math.random,o=y.find(_=>[1,2,3].includes(_))||2,p()},f.links=function(g){return arguments.length?(r=g,p(),f):r},f.id=function(g){return arguments.length?(e=g,f):e},f.iterations=function(g){return arguments.length?(h=+g,f):h},f.strength=function(g){return arguments.length?(t=typeof g=="function"?g:Us(+g),m(),f):t},f.distance=function(g){return arguments.length?(i=typeof g=="function"?g:Us(+g),v(),f):i},f}const Uie=1664525,kie=1013904223,fF=4294967296;function Gie(){let r=1;return()=>(r=(Uie*r+kie)%fF)/fF}var dF=3;function g1(r){return r.x}function pF(r){return r.y}function zie(r){return r.z}var Vie=10,Hie=Math.PI*(3-Math.sqrt(5)),Wie=Math.PI*20/(9+Math.sqrt(221));function qie(r,e){e=e||2;var t=Math.min(dF,Math.max(1,Math.round(e))),n,i=1,a=.001,s=1-Math.pow(a,1/300),o=0,l=.6,u=new Map,c=rA(f),h=nA("tick","end"),d=Gie();r==null&&(r=[]);function f(){p(),h.call("tick",n),i<a&&(c.stop(),h.call("end",n))}function p(g){var y,_=r.length,x;g===void 0&&(g=1);for(var E=0;E<g;++E)for(i+=(o-i)*s,u.forEach(function(T){T(i)}),y=0;y<_;++y)x=r[y],x.fx==null?x.x+=x.vx*=l:(x.x=x.fx,x.vx=0),t>1&&(x.fy==null?x.y+=x.vy*=l:(x.y=x.fy,x.vy=0)),t>2&&(x.fz==null?x.z+=x.vz*=l:(x.z=x.fz,x.vz=0));return n}function m(){for(var g=0,y=r.length,_;g<y;++g){if(_=r[g],_.index=g,_.fx!=null&&(_.x=_.fx),_.fy!=null&&(_.y=_.fy),_.fz!=null&&(_.z=_.fz),isNaN(_.x)||t>1&&isNaN(_.y)||t>2&&isNaN(_.z)){var x=Vie*(t>2?Math.cbrt(.5+g):t>1?Math.sqrt(.5+g):g),E=g*Hie,T=g*Wie;t===1?_.x=x:t===2?(_.x=x*Math.cos(E),_.y=x*Math.sin(E)):(_.x=x*Math.sin(E)*Math.cos(T),_.y=x*Math.cos(E),_.z=x*Math.sin(E)*Math.sin(T))}(isNaN(_.vx)||t>1&&isNaN(_.vy)||t>2&&isNaN(_.vz))&&(_.vx=0,t>1&&(_.vy=0),t>2&&(_.vz=0))}}function v(g){return g.initialize&&g.initialize(r,d,t),g}return m(),n={tick:p,restart:function(){return c.restart(f),n},stop:function(){return c.stop(),n},numDimensions:function(g){return arguments.length?(t=Math.min(dF,Math.max(1,Math.round(g))),u.forEach(v),n):t},nodes:function(g){return arguments.length?(r=g,m(),u.forEach(v),n):r},alpha:function(g){return arguments.length?(i=+g,n):i},alphaMin:function(g){return arguments.length?(a=+g,n):a},alphaDecay:function(g){return arguments.length?(s=+g,n):+s},alphaTarget:function(g){return arguments.length?(o=+g,n):o},velocityDecay:function(g){return arguments.length?(l=1-g,n):1-l},randomSource:function(g){return arguments.length?(d=g,u.forEach(v),n):d},force:function(g,y){return arguments.length>1?(y==null?u.delete(g):u.set(g,v(y)),n):u.get(g)},find:function(){var g=Array.prototype.slice.call(arguments),y=g.shift()||0,_=(t>1?g.shift():null)||0,x=(t>2?g.shift():null)||0,E=g.shift()||1/0,T=0,b=r.length,w,A,S,C,R,P;for(E*=E,T=0;T<b;++T)R=r[T],w=y-R.x,A=_-(R.y||0),S=x-(R.z||0),C=w*w+A*A+S*S,C<E&&(P=R,E=C);return P},on:function(g,y){return arguments.length>1?(h.on(g,y),n):h.on(g)}}}function $ie(){var r,e,t,n,i,a=Us(-30),s,o=1,l=1/0,u=.81;function c(p){var m,v=r.length,g=(e===1?Bz(r,g1):e===2?Uv(r,g1,pF):e===3?kz(r,g1,pF,zie):null).visitAfter(d);for(i=p,m=0;m<v;++m)t=r[m],g.visit(f)}function h(){if(!!r){var p,m=r.length,v;for(s=new Array(m),p=0;p<m;++p)v=r[p],s[v.index]=+a(v,p,r)}}function d(p){var m=0,v,g,y=0,_,x,E,T,b=p.length;if(b){for(_=x=E=T=0;T<b;++T)(v=p[T])&&(g=Math.abs(v.value))&&(m+=v.value,y+=g,_+=g*(v.x||0),x+=g*(v.y||0),E+=g*(v.z||0));m*=Math.sqrt(4/b),p.x=_/y,e>1&&(p.y=x/y),e>2&&(p.z=E/y)}else{v=p,v.x=v.data.x,e>1&&(v.y=v.data.y),e>2&&(v.z=v.data.z);do m+=s[v.data.index];while(v=v.next)}p.value=m}function f(p,m,v,g,y){if(!p.value)return!0;var _=[v,g,y][e-1],x=p.x-t.x,E=e>1?p.y-t.y:0,T=e>2?p.z-t.z:0,b=_-m,w=x*x+E*E+T*T;if(b*b/u<w)return w<l&&(x===0&&(x=Ms(n),w+=x*x),e>1&&E===0&&(E=Ms(n),w+=E*E),e>2&&T===0&&(T=Ms(n),w+=T*T),w<o&&(w=Math.sqrt(o*w)),t.vx+=x*p.value*i/w,e>1&&(t.vy+=E*p.value*i/w),e>2&&(t.vz+=T*p.value*i/w)),!0;if(p.length||w>=l)return;(p.data!==t||p.next)&&(x===0&&(x=Ms(n),w+=x*x),e>1&&E===0&&(E=Ms(n),w+=E*E),e>2&&T===0&&(T=Ms(n),w+=T*T),w<o&&(w=Math.sqrt(o*w)));do p.data!==t&&(b=s[p.data.index]*i/w,t.vx+=x*b,e>1&&(t.vy+=E*b),e>2&&(t.vz+=T*b));while(p=p.next)}return c.initialize=function(p,...m){r=p,n=m.find(v=>typeof v=="function")||Math.random,e=m.find(v=>[1,2,3].includes(v))||2,h()},c.strength=function(p){return arguments.length?(a=typeof p=="function"?p:Us(+p),h(),c):a},c.distanceMin=function(p){return arguments.length?(o=p*p,c):Math.sqrt(o)},c.distanceMax=function(p){return arguments.length?(l=p*p,c):Math.sqrt(l)},c.theta=function(p){return arguments.length?(u=p*p,c):Math.sqrt(u)},c}function Xie(r,e,t,n){var i,a,s=Us(.1),o,l;typeof r!="function"&&(r=Us(+r)),e==null&&(e=0),t==null&&(t=0),n==null&&(n=0);function u(h){for(var d=0,f=i.length;d<f;++d){var p=i[d],m=p.x-e||1e-6,v=(p.y||0)-t||1e-6,g=(p.z||0)-n||1e-6,y=Math.sqrt(m*m+v*v+g*g),_=(l[d]-y)*o[d]*h/y;p.vx+=m*_,a>1&&(p.vy+=v*_),a>2&&(p.vz+=g*_)}}function c(){if(!!i){var h,d=i.length;for(o=new Array(d),l=new Array(d),h=0;h<d;++h)l[h]=+r(i[h],h,i),o[h]=isNaN(l[h])?0:+s(i[h],h,i)}}return u.initialize=function(h,...d){i=h,a=d.find(f=>[1,2,3].includes(f))||2,c()},u.strength=function(h){return arguments.length?(s=typeof h=="function"?h:Us(+h),c(),u):s},u.radius=function(h){return arguments.length?(r=typeof h=="function"?h:Us(+h),c(),u):r},u.x=function(h){return arguments.length?(e=+h,u):e},u.y=function(h){return arguments.length?(t=+h,u):t},u.z=function(h){return arguments.length?(n=+h,u):n},u}var lM=function(e){jie(e);var t=Yie(e);return e.on=t.on,e.off=t.off,e.fire=t.fire,e};function Yie(r){var e=Object.create(null);return{on:function(t,n,i){if(typeof n!="function")throw new Error("callback is expected to be a function");var a=e[t];return a||(a=e[t]=[]),a.push({callback:n,ctx:i}),r},off:function(t,n){var i=typeof t>"u";if(i)return e=Object.create(null),r;if(e[t]){var a=typeof n!="function";if(a)delete e[t];else for(var s=e[t],o=0;o<s.length;++o)s[o].callback===n&&s.splice(o,1)}return r},fire:function(t){var n=e[t];if(!n)return r;var i;arguments.length>1&&(i=Array.prototype.splice.call(arguments,1));for(var a=0;a<n.length;++a){var s=n[a];s.callback.apply(s.ctx,i)}return r}}}function jie(r){if(!r)throw new Error("Eventify cannot use falsy object as events subject");for(var e=["on","fire","off"],t=0;t<e.length;++t)if(r.hasOwnProperty(e[t]))throw new Error("Subject cannot be eventified, since it already has property '"+e[t]+"'")}var Kie=Zie,Qie=lM;function Zie(r){if(r=r||{},"uniqueLinkId"in r&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n",`
`,`Note: there is also change in default behavior: From now on each graph
is considered to be not a multigraph by default (each edge is unique).`),r.multigraph=r.uniqueLinkId),r.multigraph===void 0&&(r.multigraph=!1),typeof Map!="function")throw new Error("ngraph.graph requires `Map` to be defined. Please polyfill it before using ngraph");var e=new Map,t=new Map,n={},i=0,a=r.multigraph?x:_,s=[],o=D,l=D,u=D,c=D,h={version:20,addNode:m,addLink:y,removeLink:w,removeNode:g,getNode:v,getNodeCount:E,getLinkCount:T,getEdgeCount:T,getLinksCount:T,getNodesCount:E,getLinks:b,forEachNode:z,forEachLinkedNode:P,forEachLink:R,beginUpdate:u,endUpdate:c,clear:C,hasLink:S,hasNode:v,getLink:S};return Qie(h),d(),h;function d(){var B=h.on;h.on=k;function k(){return h.beginUpdate=u=I,h.endUpdate=c=L,o=f,l=p,h.on=B,B.apply(h,arguments)}}function f(B,k){s.push({link:B,changeType:k})}function p(B,k){s.push({node:B,changeType:k})}function m(B,k){if(B===void 0)throw new Error("Invalid node identifier");u();var U=v(B);return U?(U.data=k,l(U,"update")):(U=new Jie(B,k),l(U,"add")),e.set(B,U),c(),U}function v(B){return e.get(B)}function g(B){var k=v(B);if(!k)return!1;u();var U=k.links;return U&&(U.forEach(A),k.links=null),e.delete(B),l(k,"remove"),c(),!0}function y(B,k,U){u();var G=v(B)||m(B),O=v(k)||m(k),F=a(B,k,U),V=t.has(F.id);return t.set(F.id,F),gF(G,F),B!==k&&gF(O,F),o(F,V?"update":"add"),c(),F}function _(B,k,U){var G=Op(B,k),O=t.get(G);return O?(O.data=U,O):new vF(B,k,U,G)}function x(B,k,U){var G=Op(B,k),O=n.hasOwnProperty(G);if(O||S(B,k)){O||(n[G]=0);var F="@"+ ++n[G];G=Op(B+F,k+F)}return new vF(B,k,U,G)}function E(){return e.size}function T(){return t.size}function b(B){var k=v(B);return k?k.links:null}function w(B,k){return k!==void 0&&(B=S(B,k)),A(B)}function A(B){if(!B||!t.get(B.id))return!1;u(),t.delete(B.id);var k=v(B.fromId),U=v(B.toId);return k&&k.links.delete(B),U&&U.links.delete(B),o(B,"remove"),c(),!0}function S(B,k){if(!(B===void 0||k===void 0))return t.get(Op(B,k))}function C(){u(),z(function(B){g(B.id)}),c()}function R(B){if(typeof B=="function")for(var k=t.values(),U=k.next();!U.done;){if(B(U.value))return!0;U=k.next()}}function P(B,k,U){var G=v(B);if(G&&G.links&&typeof k=="function")return U?N(G.links,B,k):M(G.links,B,k)}function M(B,k,U){for(var G,O=B.values(),F=O.next();!F.done;){var V=F.value,$=V.fromId===k?V.toId:V.fromId;if(G=U(e.get($),V),G)return!0;F=O.next()}}function N(B,k,U){for(var G,O=B.values(),F=O.next();!F.done;){var V=F.value;if(V.fromId===k&&(G=U(e.get(V.toId),V),G))return!0;F=O.next()}}function D(){}function I(){i+=1}function L(){i-=1,i===0&&s.length>0&&(h.fire("changed",s),s.length=0)}function z(B){if(typeof B!="function")throw new Error("Function is expected to iterate over graph nodes. You passed "+B);for(var k=e.values(),U=k.next();!U.done;){if(B(U.value))return!0;U=k.next()}}}function Jie(r,e){this.id=r,this.links=null,this.data=e}function gF(r,e){r.links?r.links.add(e):r.links=new Set([e])}function vF(r,e,t,n){this.fromId=r,this.toId=e,this.data=t,this.id=n}function Op(r,e){return r.toString()+"\u{1F449} "+e.toString()}var uM={exports:{}},Bd={exports:{}},Gz=function(e){return e===0?"x":e===1?"y":e===2?"z":"c"+(e+1)};const eae=Gz;var fh=function(e){return t;function t(n,i){let a=i&&i.indent||0,s=i&&i.join!==void 0?i.join:`
`,o=Array(a+1).join(" "),l=[];for(let u=0;u<e;++u){let c=eae(u),h=u===0?"":o;l.push(h+n.replace(/{var}/g,c))}return l.join(s)}};const zz=fh;Bd.exports=tae;Bd.exports.generateCreateBodyFunctionBody=Vz;Bd.exports.getVectorCode=Wz;Bd.exports.getBodyCode=Hz;function tae(r,e){let t=Vz(r,e),{Body:n}=new Function(t)();return n}function Vz(r,e){return`
${Wz(r,e)}
${Hz(r)}
return {Body: Body, Vector: Vector};
`}function Hz(r){let e=zz(r),t=e("{var}",{join:", "});return`
function Body(${t}) {
  this.isPinned = false;
  this.pos = new Vector(${t});
  this.force = new Vector();
  this.velocity = new Vector();
  this.mass = 1;

  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.reset = function() {
  this.force.reset();
  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.setPosition = function (${t}) {
  ${e("this.pos.{var} = {var} || 0;",{indent:2})}
};`}function Wz(r,e){let t=zz(r),n="";return e&&(n=`${t(`
   var v{var};
Object.defineProperty(this, '{var}', {
  set: function(v) { 
    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');
    v{var} = v; 
  },
  get: function() { return v{var}; }
});`)}`),`function Vector(${t("{var}",{join:", "})}) {
  ${n}
    if (typeof arguments[0] === 'object') {
      // could be another vector
      let v = arguments[0];
      ${t('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}
      ${t("this.{var} = v.{var};",{indent:4})}
    } else {
      ${t('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}
    }
  }
  
  Vector.prototype.reset = function () {
    ${t("this.{var} = ",{join:""})}0;
  };`}var el={exports:{}};const cM=fh,mo=Gz;el.exports=nae;el.exports.generateQuadTreeFunctionBody=qz;el.exports.getInsertStackCode=Kz;el.exports.getQuadNodeCode=jz;el.exports.isSamePosition=$z;el.exports.getChildBodyCode=Yz;el.exports.setChildBodyCode=Xz;function nae(r){let e=qz(r);return new Function(e)()}function qz(r){let e=cM(r),t=Math.pow(2,r);return`
${Kz()}
${jz(r)}
${$z(r)}
${Yz(r)}
${Xz(r)}

function createQuadTree(options, random) {
  options = options || {};
  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;
  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;

  var gravity = options.gravity;
  var updateQueue = [];
  var insertStack = new InsertStack();
  var theta = options.theta;

  var nodesCache = [];
  var currentInCache = 0;
  var root = newNode();

  return {
    insertBodies: insertBodies,

    /**
     * Gets root node if it is present
     */
    getRoot: function() {
      return root;
    },

    updateBodyForce: update,

    options: function(newOptions) {
      if (newOptions) {
        if (typeof newOptions.gravity === 'number') {
          gravity = newOptions.gravity;
        }
        if (typeof newOptions.theta === 'number') {
          theta = newOptions.theta;
        }

        return this;
      }

      return {
        gravity: gravity,
        theta: theta
      };
    }
  };

  function newNode() {
    // To avoid pressure on GC we reuse nodes.
    var node = nodesCache[currentInCache];
    if (node) {
${s("      node.")}
      node.body = null;
      node.mass = ${e("node.mass_{var} = ",{join:""})}0;
      ${e("node.min_{var} = node.max_{var} = ",{join:""})}0;
    } else {
      node = new QuadNode();
      nodesCache[currentInCache] = node;
    }

    ++currentInCache;
    return node;
  }

  function update(sourceBody) {
    var queue = updateQueue;
    var v;
    ${e("var d{var};",{indent:4})}
    var r; 
    ${e("var f{var} = 0;",{indent:4})}
    var queueLength = 1;
    var shiftIdx = 0;
    var pushIdx = 1;

    queue[0] = root;

    while (queueLength) {
      var node = queue[shiftIdx];
      var body = node.body;

      queueLength -= 1;
      shiftIdx += 1;
      var differentBody = (body !== sourceBody);
      if (body && differentBody) {
        // If the current node is a leaf node (and it is not source body),
        // calculate the force exerted by the current node on body, and add this
        // amount to body's net force.
        ${e("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Poor man's protection against zero distance.
          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
        }

        // This is standard gravitation force calculation but we divide
        // by r^3 to save two operations when normalizing force vector.
        v = gravity * body.mass * sourceBody.mass / (r * r * r);
        ${e("f{var} += v * d{var};",{indent:8})}
      } else if (differentBody) {
        // Otherwise, calculate the ratio s / r,  where s is the width of the region
        // represented by the internal node, and r is the distance between the body
        // and the node's center-of-mass
        ${e("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Sorry about code duplication. I don't want to create many functions
          // right away. Just want to see performance first.
          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
        }
        // If s / r < \u03B8, treat this internal node as a single body, and calculate the
        // force it exerts on sourceBody, and add this amount to sourceBody's net force.
        if ((node.max_${mo(0)} - node.min_${mo(0)}) / r < theta) {
          // in the if statement above we consider node's width only
          // because the region was made into square during tree creation.
          // Thus there is no difference between using width or height.
          v = gravity * node.mass * sourceBody.mass / (r * r * r);
          ${e("f{var} += v * d{var};",{indent:10})}
        } else {
          // Otherwise, run the procedure recursively on each of the current node's children.

          // I intentionally unfolded this loop, to save several CPU cycles.
${a()}
        }
      }
    }

    ${e("sourceBody.force.{var} += f{var};",{indent:4})}
  }

  function insertBodies(bodies) {
    ${e("var {var}min = Number.MAX_VALUE;",{indent:4})}
    ${e("var {var}max = Number.MIN_VALUE;",{indent:4})}
    var i = bodies.length;

    // To reduce quad tree depth we are looking for exact bounding box of all particles.
    while (i--) {
      var pos = bodies[i].pos;
      ${e("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}
      ${e("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}
    }

    // Makes the bounds square.
    var maxSideLength = -Infinity;
    ${e("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}

    currentInCache = 0;
    root = newNode();
    ${e("root.min_{var} = {var}min;",{indent:4})}
    ${e("root.max_{var} = {var}min + maxSideLength;",{indent:4})}

    i = bodies.length - 1;
    if (i >= 0) {
      root.body = bodies[i];
    }
    while (i--) {
      insert(bodies[i], root);
    }
  }

  function insert(newBody) {
    insertStack.reset();
    insertStack.push(root, newBody);

    while (!insertStack.isEmpty()) {
      var stackItem = insertStack.pop();
      var node = stackItem.node;
      var body = stackItem.body;

      if (!node.body) {
        // This is internal node. Update the total mass of the node and center-of-mass.
        ${e("var {var} = body.pos.{var};",{indent:8})}
        node.mass += body.mass;
        ${e("node.mass_{var} += body.mass * {var};",{indent:8})}

        // Recursively insert the body in the appropriate quadrant.
        // But first find the appropriate quadrant.
        var quadIdx = 0; // Assume we are in the 0's quad.
        ${e("var min_{var} = node.min_{var};",{indent:8})}
        ${e("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}

${i(8)}

        var child = getChild(node, quadIdx);

        if (!child) {
          // The node is internal but this quadrant is not taken. Add
          // subnode to it.
          child = newNode();
          ${e("child.min_{var} = min_{var};",{indent:10})}
          ${e("child.max_{var} = max_{var};",{indent:10})}
          child.body = body;

          setChild(node, quadIdx, child);
        } else {
          // continue searching in this quadrant.
          insertStack.push(child, body);
        }
      } else {
        // We are trying to add to the leaf node.
        // We have to convert current leaf into internal node
        // and continue adding two nodes.
        var oldBody = node.body;
        node.body = null; // internal nodes do not cary bodies

        if (isSamePosition(oldBody.pos, body.pos)) {
          // Prevent infinite subdivision by bumping one node
          // anywhere in this quadrant
          var retriesCount = 3;
          do {
            var offset = random.nextDouble();
            ${e("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}

            ${e("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}
            retriesCount -= 1;
            // Make sure we don't bump it out of the box. If we do, next iteration should fix it
          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));

          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {
            // This is very bad, we ran out of precision.
            // if we do not return from the method we'll get into
            // infinite loop here. So we sacrifice correctness of layout, and keep the app running
            // Next layout iteration should get larger bounding box in the first step and fix this
            return;
          }
        }
        // Next iteration should subdivide node further.
        insertStack.push(node, oldBody);
        insertStack.push(node, body);
      }
    }
  }
}
return createQuadTree;

`;function i(o){let l=[],u=Array(o+1).join(" ");for(let c=0;c<r;++c)l.push(u+`if (${mo(c)} > max_${mo(c)}) {`),l.push(u+`  quadIdx = quadIdx + ${Math.pow(2,c)};`),l.push(u+`  min_${mo(c)} = max_${mo(c)};`),l.push(u+`  max_${mo(c)} = node.max_${mo(c)};`),l.push(u+"}");return l.join(`
`)}function a(){let o=Array(11).join(" "),l=[];for(let u=0;u<t;++u)l.push(o+`if (node.quad${u}) {`),l.push(o+`  queue[pushIdx] = node.quad${u};`),l.push(o+"  queueLength += 1;"),l.push(o+"  pushIdx += 1;"),l.push(o+"}");return l.join(`
`)}function s(o){let l=[];for(let u=0;u<t;++u)l.push(`${o}quad${u} = null;`);return l.join(`
`)}}function $z(r){let e=cM(r);return`
  function isSamePosition(point1, point2) {
    ${e("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}
  
    return ${e("d{var} < 1e-8",{join:" && "})};
  }  
`}function Xz(r){var e=Math.pow(2,r);return`
function setChild(node, idx, child) {
  ${t()}
}`;function t(){let n=[];for(let i=0;i<e;++i){let a=i===0?"  ":"  else ";n.push(`${a}if (idx === ${i}) node.quad${i} = child;`)}return n.join(`
`)}}function Yz(r){return`function getChild(node, idx) {
${e()}
  return null;
}`;function e(){let t=[],n=Math.pow(2,r);for(let i=0;i<n;++i)t.push(`  if (idx === ${i}) return node.quad${i};`);return t.join(`
`)}}function jz(r){let e=cM(r),t=Math.pow(2,r);var n=`
function QuadNode() {
  // body stored inside this node. In quad tree only leaf nodes (by construction)
  // contain bodies:
  this.body = null;

  // Child nodes are stored in quads. Each quad is presented by number:
  // 0 | 1
  // -----
  // 2 | 3
${i("  this.")}

  // Total mass of current node
  this.mass = 0;

  // Center of mass coordinates
  ${e("this.mass_{var} = 0;",{indent:2})}

  // bounding box coordinates
  ${e("this.min_{var} = 0;",{indent:2})}
  ${e("this.max_{var} = 0;",{indent:2})}
}
`;return n;function i(a){let s=[];for(let o=0;o<t;++o)s.push(`${a}quad${o} = null;`);return s.join(`
`)}}function Kz(){return`
/**
 * Our implementation of QuadTree is non-recursive to avoid GC hit
 * This data structure represent stack of elements
 * which we are trying to insert into quad tree.
 */
function InsertStack () {
    this.stack = [];
    this.popIdx = 0;
}

InsertStack.prototype = {
    isEmpty: function() {
        return this.popIdx === 0;
    },
    push: function (node, body) {
        var item = this.stack[this.popIdx];
        if (!item) {
            // we are trying to avoid memory pressure: create new element
            // only when absolutely necessary
            this.stack[this.popIdx] = new InsertStackElement(node, body);
        } else {
            item.node = node;
            item.body = body;
        }
        ++this.popIdx;
    },
    pop: function () {
        if (this.popIdx > 0) {
            return this.stack[--this.popIdx];
        }
    },
    reset: function () {
        this.popIdx = 0;
    }
};

function InsertStackElement(node, body) {
    this.node = node; // QuadTree node
    this.body = body; // physical body which needs to be inserted to node
}
`}var hM={exports:{}};hM.exports=iae;hM.exports.generateFunctionBody=Qz;const rae=fh;function iae(r){let e=Qz(r);return new Function("bodies","settings","random",e)}function Qz(r){let e=rae(r);return`
  var boundingBox = {
    ${e("min_{var}: 0, max_{var}: 0,",{indent:4})}
  };

  return {
    box: boundingBox,

    update: updateBoundingBox,

    reset: resetBoundingBox,

    getBestNewPosition: function (neighbors) {
      var ${e("base_{var} = 0",{join:", "})};

      if (neighbors.length) {
        for (var i = 0; i < neighbors.length; ++i) {
          let neighborPos = neighbors[i].pos;
          ${e("base_{var} += neighborPos.{var};",{indent:10})}
        }

        ${e("base_{var} /= neighbors.length;",{indent:8})}
      } else {
        ${e("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}
      }

      var springLength = settings.springLength;
      return {
        ${e("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}
      };
    }
  };

  function updateBoundingBox() {
    var i = bodies.length;
    if (i === 0) return; // No bodies - no borders.

    ${e("var max_{var} = -Infinity;",{indent:4})}
    ${e("var min_{var} = Infinity;",{indent:4})}

    while(i--) {
      // this is O(n), it could be done faster with quadtree, if we check the root node bounds
      var bodyPos = bodies[i].pos;
      ${e("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}
      ${e("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}
    }

    ${e("boundingBox.min_{var} = min_{var};",{indent:4})}
    ${e("boundingBox.max_{var} = max_{var};",{indent:4})}
  }

  function resetBoundingBox() {
    ${e("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}
  }
`}var fM={exports:{}};const aae=fh;fM.exports=sae;fM.exports.generateCreateDragForceFunctionBody=Zz;function sae(r){let e=Zz(r);return new Function("options",e)}function Zz(r){return`
  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');

  return {
    update: function(body) {
      ${aae(r)("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}
    }
  };
`}var dM={exports:{}};const oae=fh;dM.exports=lae;dM.exports.generateCreateSpringForceFunctionBody=Jz;function lae(r){let e=Jz(r);return new Function("options","random",e)}function Jz(r){let e=oae(r);return`
  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');
  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');

  return {
    /**
     * Updates forces acting on a spring
     */
    update: function (spring) {
      var body1 = spring.from;
      var body2 = spring.to;
      var length = spring.length < 0 ? options.springLength : spring.length;
      ${e("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}
      var r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

      if (r === 0) {
        ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
      }

      var d = r - length;
      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;

      ${e("body1.force.{var} += coefficient * d{var}",{indent:6})};
      body1.springCount += 1;
      body1.springLength += r;

      ${e("body2.force.{var} -= coefficient * d{var}",{indent:6})};
      body2.springCount += 1;
      body2.springLength += r;
    }
  };
`}var pM={exports:{}};const uae=fh;pM.exports=cae;pM.exports.generateIntegratorFunctionBody=eV;function cae(r){let e=eV(r);return new Function("bodies","timeStep","adaptiveTimeStepWeight",e)}function eV(r){let e=uae(r);return`
  var length = bodies.length;
  if (length === 0) return 0;

  ${e("var d{var} = 0, t{var} = 0;",{indent:2})}

  for (var i = 0; i < length; ++i) {
    var body = bodies[i];
    if (body.isPinned) continue;

    if (adaptiveTimeStepWeight && body.springCount) {
      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);
    }

    var coeff = timeStep / body.mass;

    ${e("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}
    ${e("var v{var} = body.velocity.{var};",{indent:4})}
    var v = Math.sqrt(${e("v{var} * v{var}",{join:" + "})});

    if (v > 1) {
      // We normalize it so that we move within timeStep range. 
      // for the case when v <= 1 - we let velocity to fade out.
      ${e("body.velocity.{var} = v{var} / v;",{indent:6})}
    }

    ${e("d{var} = timeStep * body.velocity.{var};",{indent:4})}

    ${e("body.pos.{var} += d{var};",{indent:4})}

    ${e("t{var} += Math.abs(d{var});",{indent:4})}
  }

  return (${e("t{var} * t{var}",{join:" + "})})/length;
`}var v1,mF;function hae(){if(mF)return v1;mF=1,v1=r;function r(e,t,n,i){this.from=e,this.to=t,this.length=n,this.coefficient=i}return v1}var m1,yF;function fae(){if(yF)return m1;yF=1,m1=r;function r(e,t){var n;if(e||(e={}),t){for(n in t)if(t.hasOwnProperty(n)){var i=e.hasOwnProperty(n),a=typeof t[n],s=!i||typeof e[n]!==a;s?e[n]=t[n]:a==="object"&&(e[n]=r(e[n],t[n]))}}return e}return m1}var Dh={exports:{}},_F;function dae(){if(_F)return Dh.exports;_F=1,Dh.exports=r,Dh.exports.random=r,Dh.exports.randomIterator=o;function r(l){var u=typeof l=="number"?l:+new Date;return new e(u)}function e(l){this.seed=l}e.prototype.next=s,e.prototype.nextDouble=a,e.prototype.uniform=a,e.prototype.gaussian=t,e.prototype.random=a;function t(){var l,u,c;do u=this.nextDouble()*2-1,c=this.nextDouble()*2-1,l=u*u+c*c;while(l>=1||l===0);return u*Math.sqrt(-2*Math.log(l)/l)}e.prototype.levy=n;function n(){var l=1.5,u=Math.pow(i(1+l)*Math.sin(Math.PI*l/2)/(i((1+l)/2)*l*Math.pow(2,(l-1)/2)),1/l);return this.gaussian()*u/Math.pow(Math.abs(this.gaussian()),1/l)}function i(l){return Math.sqrt(2*Math.PI/l)*Math.pow(1/Math.E*(l+1/(12*l-1/(10*l))),l)}function a(){var l=this.seed;return l=l+2127912214+(l<<12)&4294967295,l=(l^3345072700^l>>>19)&4294967295,l=l+374761393+(l<<5)&4294967295,l=(l+3550635116^l<<9)&4294967295,l=l+4251993797+(l<<3)&4294967295,l=(l^3042594569^l>>>16)&4294967295,this.seed=l,(l&268435455)/268435456}function s(l){return Math.floor(this.nextDouble()*l)}function o(l,u){var c=u||r();if(typeof c.next!="function")throw new Error("customRandom does not match expected API: next() function is missing");return{forEach:d,shuffle:h};function h(){var f,p,m;for(f=l.length-1;f>0;--f)p=c.next(f+1),m=l[p],l[p]=l[f],l[f]=m;return l}function d(f){var p,m,v;for(p=l.length-1;p>0;--p)m=c.next(p+1),v=l[m],l[m]=l[p],l[p]=v,f(v);l.length&&f(l[0])}}return Dh.exports}var tV=xae,pae=Bd.exports,gae=el.exports,vae=hM.exports,mae=fM.exports,yae=dM.exports,_ae=pM.exports,xF={};function xae(r){var e=hae(),t=fae(),n=lM;if(r){if(r.springCoeff!==void 0)throw new Error("springCoeff was renamed to springCoefficient");if(r.dragCoeff!==void 0)throw new Error("dragCoeff was renamed to dragCoefficient")}r=t(r,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var i=xF[r.dimensions];if(!i){var a=r.dimensions;i={Body:pae(a,r.debug),createQuadTree:gae(a),createBounds:vae(a),createDragForce:mae(a),createSpringForce:yae(a),integrate:_ae(a)},xF[a]=i}var s=i.Body,o=i.createQuadTree,l=i.createBounds,u=i.createDragForce,c=i.createSpringForce,h=i.integrate,d=N=>new s(N),f=dae().random(42),p=[],m=[],v=o(r,f),g=l(p,r,f),y=c(r,f),_=u(r),x=0,E=[],T=new Map,b=0;S("nbody",P),S("spring",M);var w={bodies:p,quadTree:v,springs:m,settings:r,addForce:S,removeForce:C,getForces:R,step:function(){for(var N=0;N<E.length;++N)E[N](b);var D=h(p,r.timeStep,r.adaptiveTimeStepWeight);return b+=1,D},addBody:function(N){if(!N)throw new Error("Body is required");return p.push(N),N},addBodyAt:function(N){if(!N)throw new Error("Body position is required");var D=d(N);return p.push(D),D},removeBody:function(N){if(!!N){var D=p.indexOf(N);if(!(D<0))return p.splice(D,1),p.length===0&&g.reset(),!0}},addSpring:function(N,D,I,L){if(!N||!D)throw new Error("Cannot add null spring to force simulator");typeof I!="number"&&(I=-1);var z=new e(N,D,I,L>=0?L:-1);return m.push(z),z},getTotalMovement:function(){return x},removeSpring:function(N){if(!!N){var D=m.indexOf(N);if(D>-1)return m.splice(D,1),!0}},getBestNewBodyPosition:function(N){return g.getBestNewPosition(N)},getBBox:A,getBoundingBox:A,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(N){return N!==void 0?(r.gravity=N,v.options({gravity:N}),this):r.gravity},theta:function(N){return N!==void 0?(r.theta=N,v.options({theta:N}),this):r.theta},random:f};return bae(r,w),n(w),w;function A(){return g.update(),g.box}function S(N,D){if(T.has(N))throw new Error("Force "+N+" is already added");T.set(N,D),E.push(D)}function C(N){var D=E.indexOf(T.get(N));D<0||(E.splice(D,1),T.delete(N))}function R(){return T}function P(){if(p.length!==0){v.insertBodies(p);for(var N=p.length;N--;){var D=p[N];D.isPinned||(D.reset(),v.updateBodyForce(D),_.update(D))}}}function M(){for(var N=m.length;N--;)y.update(m[N])}}function bae(r,e){for(var t in r)Eae(r,e,t)}function Eae(r,e,t){if(!!r.hasOwnProperty(t)&&typeof e[t]!="function"){var n=Number.isFinite(r[t]);n?e[t]=function(i){if(i!==void 0){if(!Number.isFinite(i))throw new Error("Value of "+t+" should be a valid number.");return r[t]=i,e}return r[t]}:e[t]=function(i){return i!==void 0?(r[t]=i,e):r[t]}}}uM.exports=wae;uM.exports.simulator=tV;var Tae=lM;function wae(r,e){if(!r)throw new Error("Graph structure cannot be undefined");var t=e&&e.createSimulator||tV,n=t(e);if(Array.isArray(e))throw new Error("Physics settings is expected to be an object");var i=r.version>19?P:R;e&&typeof e.nodeMass=="function"&&(i=e.nodeMass);var a=new Map,s={},o=0,l=n.settings.springTransform||Sae;_(),v();var u=!1,c={step:function(){if(o===0)return h(!0),!0;var M=n.step();c.lastMove=M,c.fire("step");var N=M/o,D=N<=.01;return h(D),D},getNodePosition:function(M){return C(M).pos},setNodePosition:function(M){var N=C(M);N.setPosition.apply(N,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(M){var N=s[M];if(N)return{from:N.from.pos,to:N.to.pos}},getGraphRect:function(){return n.getBBox()},forEachBody:d,pinNode:function(M,N){var D=C(M.id);D.isPinned=!!N},isNodePinned:function(M){return C(M.id).isPinned},dispose:function(){r.off("changed",y),c.fire("disposed")},getBody:m,getSpring:p,getForceVectorLength:f,simulator:n,graph:r,lastMove:0};return Tae(c),c;function h(M){u!==M&&(u=M,g(M))}function d(M){a.forEach(M)}function f(){var M=0,N=0;return d(function(D){M+=Math.abs(D.force.x),N+=Math.abs(D.force.y)}),Math.sqrt(M*M+N*N)}function p(M,N){var D;if(N===void 0)typeof M!="object"?D=M:D=M.id;else{var I=r.hasLink(M,N);if(!I)return;D=I.id}return s[D]}function m(M){return a.get(M)}function v(){r.on("changed",y)}function g(M){c.fire("stable",M)}function y(M){for(var N=0;N<M.length;++N){var D=M[N];D.changeType==="add"?(D.node&&x(D.node.id),D.link&&T(D.link)):D.changeType==="remove"&&(D.node&&E(D.node),D.link&&b(D.link))}o=r.getNodesCount()}function _(){o=0,r.forEachNode(function(M){x(M.id),o+=1}),r.forEachLink(T)}function x(M){var N=a.get(M);if(!N){var D=r.getNode(M);if(!D)throw new Error("initBody() was called with unknown node id");var I=D.position;if(!I){var L=w(D);I=n.getBestNewBodyPosition(L)}N=n.addBodyAt(I),N.id=M,a.set(M,N),A(M),S(D)&&(N.isPinned=!0)}}function E(M){var N=M.id,D=a.get(N);D&&(a.delete(N),n.removeBody(D))}function T(M){A(M.fromId),A(M.toId);var N=a.get(M.fromId),D=a.get(M.toId),I=n.addSpring(N,D,M.length);l(M,I),s[M.id]=I}function b(M){var N=s[M.id];if(N){var D=r.getNode(M.fromId),I=r.getNode(M.toId);D&&A(D.id),I&&A(I.id),delete s[M.id],n.removeSpring(N)}}function w(M){var N=[];if(!M.links)return N;for(var D=Math.min(M.links.length,2),I=0;I<D;++I){var L=M.links[I],z=L.fromId!==M.id?a.get(L.fromId):a.get(L.toId);z&&z.pos&&N.push(z)}return N}function A(M){var N=a.get(M);if(N.mass=i(M),Number.isNaN(N.mass))throw new Error("Node mass should be a number")}function S(M){return M&&(M.isPinned||M.data&&M.data.isPinned)}function C(M){var N=a.get(M);return N||(x(M),N=a.get(M)),N}function R(M){var N=r.getLinks(M);return N?1+N.length/3:1}function P(M){var N=r.getLinks(M);return N?1+N.size/3:1}}function Sae(){}function bF(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=Array(e);t<e;t++)n[t]=r[t];return n}function Aae(r){if(Array.isArray(r))return r}function Mae(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Cae(r,e,t){return Object.defineProperty(r,"prototype",{writable:!1}),r}function Rae(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var n,i,a,s,o=[],l=!0,u=!1;try{if(a=(t=t.call(r)).next,e!==0)for(;!(l=(n=a.call(t)).done)&&(o.push(n.value),o.length!==e);l=!0);}catch(c){u=!0,i=c}finally{try{if(!l&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(u)throw i}}return o}}function Nae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pae(r,e){return Aae(r)||Rae(r,e)||Dae(r,e)||Nae()}function Dae(r,e){if(r){if(typeof r=="string")return bF(r,e);var t={}.toString.call(r).slice(8,-1);return t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set"?Array.from(r):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?bF(r,e):void 0}}var Lae=Cae(function r(e,t){var n=t.default,i=n===void 0?null:n,a=t.triggerUpdate,s=a===void 0?!0:a,o=t.onChange,l=o===void 0?function(u,c){}:o;Mae(this,r),this.name=e,this.defaultVal=i,this.triggerUpdate=s,this.onChange=l});function vm(r){var e=r.stateInit,t=e===void 0?function(){return{}}:e,n=r.props,i=n===void 0?{}:n,a=r.methods,s=a===void 0?{}:a,o=r.aliases,l=o===void 0?{}:o,u=r.init,c=u===void 0?function(){}:u,h=r.update,d=h===void 0?function(){}:h,f=Object.keys(i).map(function(p){return new Lae(p,i[p])});return function p(){for(var m=arguments.length,v=new Array(m),g=0;g<m;g++)v[g]=arguments[g];var y=!!(this instanceof p&&this.constructor),_=y?v.shift():void 0,x=v[0],E=x===void 0?{}:x,T=Object.assign({},t instanceof Function?t(E):t,{initialised:!1}),b={};function w(C){return A(C,E),S(),w}var A=function(R,P){c.call(w,R,T,P),T.initialised=!0},S=YH(function(){!T.initialised||(d.call(w,T,b),b={})},1);return f.forEach(function(C){w[C.name]=R(C);function R(P){var M=P.name,N=P.triggerUpdate,D=N===void 0?!1:N,I=P.onChange,L=I===void 0?function(k,U){}:I,z=P.defaultVal,B=z===void 0?null:z;return function(k){var U=T[M];if(!arguments.length)return U;var G=k===void 0?B:k;return T[M]=G,L.call(w,G,T,U),!b.hasOwnProperty(M)&&(b[M]=U),D&&S(),w}}}),Object.keys(s).forEach(function(C){w[C]=function(){for(var R,P=arguments.length,M=new Array(P),N=0;N<P;N++)M[N]=arguments[N];return(R=s[C]).call.apply(R,[w,T].concat(M))}}),Object.entries(l).forEach(function(C){var R=Pae(C,2),P=R[0],M=R[1];return w[P]=w[M]}),w.resetProps=function(){return f.forEach(function(C){w[C.name](C.defaultVal)}),w},w.resetProps(),T._rerender=S,y&&_&&w(_),w}}var Ht=function(r){return typeof r=="function"?r:typeof r=="string"?function(e){return e[r]}:function(e){return r}};function nV(r,e){return r<e?-1:r>e?1:r>=e?0:NaN}function Iae(r){return r.length===1&&(r=Oae(r)),{left:function(e,t,n,i){for(n==null&&(n=0),i==null&&(i=e.length);n<i;){var a=n+i>>>1;r(e[a],t)<0?n=a+1:i=a}return n},right:function(e,t,n,i){for(n==null&&(n=0),i==null&&(i=e.length);n<i;){var a=n+i>>>1;r(e[a],t)>0?i=a:n=a+1}return n}}}function Oae(r){return function(e,t){return nV(r(e),t)}}Iae(nV);function Fae(r,e){var t=r.length,n=-1,i,a;if(e==null){for(;++n<t;)if((i=r[n])!=null&&i>=i)for(a=i;++n<t;)(i=r[n])!=null&&i>a&&(a=i)}else for(;++n<t;)if((i=e(r[n],n,r))!=null&&i>=i)for(a=i;++n<t;)(i=e(r[n],n,r))!=null&&i>a&&(a=i);return a}function Bae(r,e){var t=r.length,n=-1,i,a;if(e==null){for(;++n<t;)if((i=r[n])!=null&&i>=i)for(a=i;++n<t;)(i=r[n])!=null&&a>i&&(a=i)}else for(;++n<t;)if((i=e(r[n],n,r))!=null&&i>=i)for(a=i;++n<t;)(i=e(r[n],n,r))!=null&&a>i&&(a=i);return a}function Qw(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=Array(e);t<e;t++)n[t]=r[t];return n}function Uae(r){if(Array.isArray(r))return r}function kae(r){if(Array.isArray(r))return Qw(r)}function rV(r,e,t){if(typeof r=="function"?r===e:r.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function Gae(r,e){if(e.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object")}function zae(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function Or(r,e){return r.get(rV(r,e))}function Ou(r,e,t){Gae(r,e),e.set(r,t)}function Fp(r,e,t){return r.set(rV(r,e),t),t}function Vae(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,Qae(n.key),n)}}function Hae(r,e,t){return e&&Vae(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function Wae(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function qae(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var n,i,a,s,o=[],l=!0,u=!1;try{if(a=(t=t.call(r)).next,e!==0)for(;!(l=(n=a.call(t)).done)&&(o.push(n.value),o.length!==e);l=!0);}catch(c){u=!0,i=c}finally{try{if(!l&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(u)throw i}}return o}}function $ae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Xae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Yae(r,e){return Uae(r)||qae(r,e)||iV(r,e)||$ae()}function jae(r){return kae(r)||Wae(r)||iV(r)||Xae()}function Kae(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function Qae(r){var e=Kae(r,"string");return typeof e=="symbol"?e:e+""}function iV(r,e){if(r){if(typeof r=="string")return Qw(r,e);var t={}.toString.call(r).slice(8,-1);return t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set"?Array.from(r):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Qw(r,e):void 0}}var Fu=new WeakMap,Lh=new WeakMap,Bu=new WeakMap,y1=new WeakMap,_1=new WeakMap,x1=new WeakMap,Zae=function(){function r(){zae(this,r),Ou(this,Fu,new Map),Ou(this,Lh,new Map),Ou(this,Bu,function(e){return e}),Ou(this,y1,function(){return{}}),Ou(this,_1,function(){}),Ou(this,x1,function(){})}return Hae(r,[{key:"getObj",value:function(t){return Or(Fu,this).get(Or(Bu,this).call(this,t))}},{key:"getData",value:function(t){return Or(Lh,this).get(t)}},{key:"entries",value:function(){return jae(Or(Lh,this).entries()).map(function(t){var n=Yae(t,2),i=n[0],a=n[1];return[a,i]})}},{key:"id",value:function(t){return Fp(Bu,this,Ht(t)),this}},{key:"onCreateObj",value:function(t){return Fp(y1,this,t),this}},{key:"onUpdateObj",value:function(t){return Fp(_1,this,t),this}},{key:"onRemoveObj",value:function(t){return Fp(x1,this,t),this}},{key:"digest",value:function(t){var n=this;t.filter(function(a){return!Or(Fu,n).has(Or(Bu,n).call(n,a))}).forEach(function(a){var s=Or(y1,n).call(n,a);Or(Fu,n).set(Or(Bu,n).call(n,a),s),Or(Lh,n).set(s,a)});var i=new Map(t.map(function(a){return[Or(Bu,n).call(n,a),a]}));return Or(Fu,this).forEach(function(a,s){i.has(s)?Or(_1,n).call(n,a,i.get(s)):(Or(x1,n).call(n,a,s),Or(Fu,n).delete(s),Or(Lh,n).delete(a))}),this}},{key:"clear",value:function(){return this.digest([]),this}}])}();class EF extends Map{constructor(e,t=tse){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),e!=null)for(const[n,i]of e)this.set(n,i)}get(e){return super.get(TF(this,e))}has(e){return super.has(TF(this,e))}set(e,t){return super.set(Jae(this,e),t)}delete(e){return super.delete(ese(this,e))}}function TF({_intern:r,_key:e},t){const n=e(t);return r.has(n)?r.get(n):t}function Jae({_intern:r,_key:e},t){const n=e(t);return r.has(n)?r.get(n):(r.set(n,t),t)}function ese({_intern:r,_key:e},t){const n=e(t);return r.has(n)&&(t=r.get(n),r.delete(n)),t}function tse(r){return r!==null&&typeof r=="object"?r.valueOf():r}function nse(r,e){switch(arguments.length){case 0:break;case 1:this.range(r);break;default:this.range(e).domain(r);break}return this}const wF=Symbol("implicit");function aV(){var r=new EF,e=[],t=[],n=wF;function i(a){let s=r.get(a);if(s===void 0){if(n!==wF)return n;r.set(a,s=e.push(a)-1)}return t[s%t.length]}return i.domain=function(a){if(!arguments.length)return e.slice();e=[],r=new EF;for(const s of a)r.has(s)||r.set(s,e.push(s)-1);return i},i.range=function(a){return arguments.length?(t=Array.from(a),i):t.slice()},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return aV(e,t).unknown(n)},nse.apply(i,arguments),i}function rse(r){for(var e=r.length/6|0,t=new Array(e),n=0;n<e;)t[n]="#"+r.slice(n*6,++n*6);return t}const ise=rse("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928");function av(r){return av=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},av(r)}var ase=/^\s+/,sse=/\s+$/;function ht(r,e){if(r=r||"",e=e||{},r instanceof ht)return r;if(!(this instanceof ht))return new ht(r,e);var t=ose(r);this._originalInput=r,this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||t.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=t.ok}ht.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),t,n,i,a,s,o;return t=e.r/255,n=e.g/255,i=e.b/255,t<=.03928?a=t/12.92:a=Math.pow((t+.055)/1.055,2.4),n<=.03928?s=n/12.92:s=Math.pow((n+.055)/1.055,2.4),i<=.03928?o=i/12.92:o=Math.pow((i+.055)/1.055,2.4),.2126*a+.7152*s+.0722*o},setAlpha:function(e){return this._a=sV(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=AF(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=AF(this._r,this._g,this._b),t=Math.round(e.h*360),n=Math.round(e.s*100),i=Math.round(e.v*100);return this._a==1?"hsv("+t+", "+n+"%, "+i+"%)":"hsva("+t+", "+n+"%, "+i+"%, "+this._roundA+")"},toHsl:function(){var e=SF(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=SF(this._r,this._g,this._b),t=Math.round(e.h*360),n=Math.round(e.s*100),i=Math.round(e.l*100);return this._a==1?"hsl("+t+", "+n+"%, "+i+"%)":"hsla("+t+", "+n+"%, "+i+"%, "+this._roundA+")"},toHex:function(e){return MF(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return hse(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(wn(this._r,255)*100)+"%",g:Math.round(wn(this._g,255)*100)+"%",b:Math.round(wn(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(wn(this._r,255)*100)+"%, "+Math.round(wn(this._g,255)*100)+"%, "+Math.round(wn(this._b,255)*100)+"%)":"rgba("+Math.round(wn(this._r,255)*100)+"%, "+Math.round(wn(this._g,255)*100)+"%, "+Math.round(wn(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:Tse[MF(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var t="#"+CF(this._r,this._g,this._b,this._a),n=t,i=this._gradientType?"GradientType = 1, ":"";if(e){var a=ht(e);n="#"+CF(a._r,a._g,a._b,a._a)}return"progid:DXImageTransform.Microsoft.gradient("+i+"startColorstr="+t+",endColorstr="+n+")"},toString:function(e){var t=!!e;e=e||this._format;var n=!1,i=this._a<1&&this._a>=0,a=!t&&i&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return a?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(n=this.toRgbString()),e==="prgb"&&(n=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(n=this.toHexString()),e==="hex3"&&(n=this.toHexString(!0)),e==="hex4"&&(n=this.toHex8String(!0)),e==="hex8"&&(n=this.toHex8String()),e==="name"&&(n=this.toName()),e==="hsl"&&(n=this.toHslString()),e==="hsv"&&(n=this.toHsvString()),n||this.toHexString())},clone:function(){return ht(this.toString())},_applyModification:function(e,t){var n=e.apply(null,[this].concat([].slice.call(t)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(gse,arguments)},brighten:function(){return this._applyModification(vse,arguments)},darken:function(){return this._applyModification(mse,arguments)},desaturate:function(){return this._applyModification(fse,arguments)},saturate:function(){return this._applyModification(dse,arguments)},greyscale:function(){return this._applyModification(pse,arguments)},spin:function(){return this._applyModification(yse,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(bse,arguments)},complement:function(){return this._applyCombination(_se,arguments)},monochromatic:function(){return this._applyCombination(Ese,arguments)},splitcomplement:function(){return this._applyCombination(xse,arguments)},triad:function(){return this._applyCombination(RF,[3])},tetrad:function(){return this._applyCombination(RF,[4])}};ht.fromRatio=function(r,e){if(av(r)=="object"){var t={};for(var n in r)r.hasOwnProperty(n)&&(n==="a"?t[n]=r[n]:t[n]=rf(r[n]));r=t}return ht(r,e)};function ose(r){var e={r:0,g:0,b:0},t=1,n=null,i=null,a=null,s=!1,o=!1;return typeof r=="string"&&(r=Mse(r)),av(r)=="object"&&(Es(r.r)&&Es(r.g)&&Es(r.b)?(e=lse(r.r,r.g,r.b),s=!0,o=String(r.r).substr(-1)==="%"?"prgb":"rgb"):Es(r.h)&&Es(r.s)&&Es(r.v)?(n=rf(r.s),i=rf(r.v),e=cse(r.h,n,i),s=!0,o="hsv"):Es(r.h)&&Es(r.s)&&Es(r.l)&&(n=rf(r.s),a=rf(r.l),e=use(r.h,n,a),s=!0,o="hsl"),r.hasOwnProperty("a")&&(t=r.a)),t=sV(t),{ok:s,format:r.format||o,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:t}}function lse(r,e,t){return{r:wn(r,255)*255,g:wn(e,255)*255,b:wn(t,255)*255}}function SF(r,e,t){r=wn(r,255),e=wn(e,255),t=wn(t,255);var n=Math.max(r,e,t),i=Math.min(r,e,t),a,s,o=(n+i)/2;if(n==i)a=s=0;else{var l=n-i;switch(s=o>.5?l/(2-n-i):l/(n+i),n){case r:a=(e-t)/l+(e<t?6:0);break;case e:a=(t-r)/l+2;break;case t:a=(r-e)/l+4;break}a/=6}return{h:a,s,l:o}}function use(r,e,t){var n,i,a;r=wn(r,360),e=wn(e,100),t=wn(t,100);function s(u,c,h){return h<0&&(h+=1),h>1&&(h-=1),h<1/6?u+(c-u)*6*h:h<1/2?c:h<2/3?u+(c-u)*(2/3-h)*6:u}if(e===0)n=i=a=t;else{var o=t<.5?t*(1+e):t+e-t*e,l=2*t-o;n=s(l,o,r+1/3),i=s(l,o,r),a=s(l,o,r-1/3)}return{r:n*255,g:i*255,b:a*255}}function AF(r,e,t){r=wn(r,255),e=wn(e,255),t=wn(t,255);var n=Math.max(r,e,t),i=Math.min(r,e,t),a,s,o=n,l=n-i;if(s=n===0?0:l/n,n==i)a=0;else{switch(n){case r:a=(e-t)/l+(e<t?6:0);break;case e:a=(t-r)/l+2;break;case t:a=(r-e)/l+4;break}a/=6}return{h:a,s,v:o}}function cse(r,e,t){r=wn(r,360)*6,e=wn(e,100),t=wn(t,100);var n=Math.floor(r),i=r-n,a=t*(1-e),s=t*(1-i*e),o=t*(1-(1-i)*e),l=n%6,u=[t,s,a,a,o,t][l],c=[o,t,t,s,a,a][l],h=[a,a,o,t,t,s][l];return{r:u*255,g:c*255,b:h*255}}function MF(r,e,t,n){var i=[Da(Math.round(r).toString(16)),Da(Math.round(e).toString(16)),Da(Math.round(t).toString(16))];return n&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function hse(r,e,t,n,i){var a=[Da(Math.round(r).toString(16)),Da(Math.round(e).toString(16)),Da(Math.round(t).toString(16)),Da(oV(n))];return i&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)&&a[3].charAt(0)==a[3].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0):a.join("")}function CF(r,e,t,n){var i=[Da(oV(n)),Da(Math.round(r).toString(16)),Da(Math.round(e).toString(16)),Da(Math.round(t).toString(16))];return i.join("")}ht.equals=function(r,e){return!r||!e?!1:ht(r).toRgbString()==ht(e).toRgbString()};ht.random=function(){return ht.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function fse(r,e){e=e===0?0:e||10;var t=ht(r).toHsl();return t.s-=e/100,t.s=mm(t.s),ht(t)}function dse(r,e){e=e===0?0:e||10;var t=ht(r).toHsl();return t.s+=e/100,t.s=mm(t.s),ht(t)}function pse(r){return ht(r).desaturate(100)}function gse(r,e){e=e===0?0:e||10;var t=ht(r).toHsl();return t.l+=e/100,t.l=mm(t.l),ht(t)}function vse(r,e){e=e===0?0:e||10;var t=ht(r).toRgb();return t.r=Math.max(0,Math.min(255,t.r-Math.round(255*-(e/100)))),t.g=Math.max(0,Math.min(255,t.g-Math.round(255*-(e/100)))),t.b=Math.max(0,Math.min(255,t.b-Math.round(255*-(e/100)))),ht(t)}function mse(r,e){e=e===0?0:e||10;var t=ht(r).toHsl();return t.l-=e/100,t.l=mm(t.l),ht(t)}function yse(r,e){var t=ht(r).toHsl(),n=(t.h+e)%360;return t.h=n<0?360+n:n,ht(t)}function _se(r){var e=ht(r).toHsl();return e.h=(e.h+180)%360,ht(e)}function RF(r,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var t=ht(r).toHsl(),n=[ht(r)],i=360/e,a=1;a<e;a++)n.push(ht({h:(t.h+a*i)%360,s:t.s,l:t.l}));return n}function xse(r){var e=ht(r).toHsl(),t=e.h;return[ht(r),ht({h:(t+72)%360,s:e.s,l:e.l}),ht({h:(t+216)%360,s:e.s,l:e.l})]}function bse(r,e,t){e=e||6,t=t||30;var n=ht(r).toHsl(),i=360/t,a=[ht(r)];for(n.h=(n.h-(i*e>>1)+720)%360;--e;)n.h=(n.h+i)%360,a.push(ht(n));return a}function Ese(r,e){e=e||6;for(var t=ht(r).toHsv(),n=t.h,i=t.s,a=t.v,s=[],o=1/e;e--;)s.push(ht({h:n,s:i,v:a})),a=(a+o)%1;return s}ht.mix=function(r,e,t){t=t===0?0:t||50;var n=ht(r).toRgb(),i=ht(e).toRgb(),a=t/100,s={r:(i.r-n.r)*a+n.r,g:(i.g-n.g)*a+n.g,b:(i.b-n.b)*a+n.b,a:(i.a-n.a)*a+n.a};return ht(s)};ht.readability=function(r,e){var t=ht(r),n=ht(e);return(Math.max(t.getLuminance(),n.getLuminance())+.05)/(Math.min(t.getLuminance(),n.getLuminance())+.05)};ht.isReadable=function(r,e,t){var n=ht.readability(r,e),i,a;switch(a=!1,i=Cse(t),i.level+i.size){case"AAsmall":case"AAAlarge":a=n>=4.5;break;case"AAlarge":a=n>=3;break;case"AAAsmall":a=n>=7;break}return a};ht.mostReadable=function(r,e,t){var n=null,i=0,a,s,o,l;t=t||{},s=t.includeFallbackColors,o=t.level,l=t.size;for(var u=0;u<e.length;u++)a=ht.readability(r,e[u]),a>i&&(i=a,n=ht(e[u]));return ht.isReadable(r,n,{level:o,size:l})||!s?n:(t.includeFallbackColors=!1,ht.mostReadable(r,["#fff","#000"],t))};var Zw=ht.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},Tse=ht.hexNames=wse(Zw);function wse(r){var e={};for(var t in r)r.hasOwnProperty(t)&&(e[r[t]]=t);return e}function sV(r){return r=parseFloat(r),(isNaN(r)||r<0||r>1)&&(r=1),r}function wn(r,e){Sse(r)&&(r="100%");var t=Ase(r);return r=Math.min(e,Math.max(0,parseFloat(r))),t&&(r=parseInt(r*e,10)/100),Math.abs(r-e)<1e-6?1:r%e/parseFloat(e)}function mm(r){return Math.min(1,Math.max(0,r))}function Li(r){return parseInt(r,16)}function Sse(r){return typeof r=="string"&&r.indexOf(".")!=-1&&parseFloat(r)===1}function Ase(r){return typeof r=="string"&&r.indexOf("%")!=-1}function Da(r){return r.length==1?"0"+r:""+r}function rf(r){return r<=1&&(r=r*100+"%"),r}function oV(r){return Math.round(parseFloat(r)*255).toString(16)}function NF(r){return Li(r)/255}var ba=function(){var r="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",t="(?:"+e+")|(?:"+r+")",n="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?",i="[\\s|\\(]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")[,|\\s]+("+t+")\\s*\\)?";return{CSS_UNIT:new RegExp(t),rgb:new RegExp("rgb"+n),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+n),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+n),hsva:new RegExp("hsva"+i),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function Es(r){return!!ba.CSS_UNIT.exec(r)}function Mse(r){r=r.replace(ase,"").replace(sse,"").toLowerCase();var e=!1;if(Zw[r])r=Zw[r],e=!0;else if(r=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var t;return(t=ba.rgb.exec(r))?{r:t[1],g:t[2],b:t[3]}:(t=ba.rgba.exec(r))?{r:t[1],g:t[2],b:t[3],a:t[4]}:(t=ba.hsl.exec(r))?{h:t[1],s:t[2],l:t[3]}:(t=ba.hsla.exec(r))?{h:t[1],s:t[2],l:t[3],a:t[4]}:(t=ba.hsv.exec(r))?{h:t[1],s:t[2],v:t[3]}:(t=ba.hsva.exec(r))?{h:t[1],s:t[2],v:t[3],a:t[4]}:(t=ba.hex8.exec(r))?{r:Li(t[1]),g:Li(t[2]),b:Li(t[3]),a:NF(t[4]),format:e?"name":"hex8"}:(t=ba.hex6.exec(r))?{r:Li(t[1]),g:Li(t[2]),b:Li(t[3]),format:e?"name":"hex"}:(t=ba.hex4.exec(r))?{r:Li(t[1]+""+t[1]),g:Li(t[2]+""+t[2]),b:Li(t[3]+""+t[3]),a:NF(t[4]+""+t[4]),format:e?"name":"hex8"}:(t=ba.hex3.exec(r))?{r:Li(t[1]+""+t[1]),g:Li(t[2]+""+t[2]),b:Li(t[3]+""+t[3]),format:e?"name":"hex"}:!1}function Cse(r){var e,t;return r=r||{level:"AA",size:"small"},e=(r.level||"AA").toUpperCase(),t=(r.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),t!=="small"&&t!=="large"&&(t="small"),{level:e,size:t}}function Jw(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=Array(e);t<e;t++)n[t]=r[t];return n}function Rse(r){if(Array.isArray(r))return r}function Nse(r){if(Array.isArray(r))return Jw(r)}function lV(r,e,t){if(typeof r=="function"?r===e:r.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}function Pse(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function uV(r,e,t){return e=Wc(e),kse(r,gM()?Reflect.construct(e,t||[],Wc(r).constructor):e.apply(r,t))}function Dse(r,e){if(e.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object")}function cV(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function b1(r,e){return r.get(lV(r,e))}function PF(r,e,t){Dse(r,e),e.set(r,t)}function DF(r,e,t){return r.set(lV(r,e),t),t}function hV(r,e,t){if(gM())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var i=new(r.bind.apply(r,n));return i}function Lse(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,pV(n.key),n)}}function fV(r,e,t){return e&&Lse(r.prototype,e),Object.defineProperty(r,"prototype",{writable:!1}),r}function ym(r,e,t){return(e=pV(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function eS(){return eS=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(r,e,t){var n=Gse(r,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?r:t):i.value}},eS.apply(null,arguments)}function Wc(r){return Wc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Wc(r)}function dV(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),e&&tS(r,e)}function gM(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(gM=function(){return!!r})()}function Ise(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Ose(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var n,i,a,s,o=[],l=!0,u=!1;try{if(a=(t=t.call(r)).next,e!==0)for(;!(l=(n=a.call(t)).done)&&(o.push(n.value),o.length!==e);l=!0);}catch(c){u=!0,i=c}finally{try{if(!l&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(u)throw i}}return o}}function Fse(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Bse(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function LF(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Use(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?LF(Object(t),!0).forEach(function(n){ym(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):LF(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function kse(r,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Pse(r)}function tS(r,e){return tS=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},tS(r,e)}function mf(r,e){return Rse(r)||Ose(r,e)||gV(r,e)||Fse()}function Gse(r,e){for(;!{}.hasOwnProperty.call(r,e)&&(r=Wc(r))!==null;);return r}function E1(r,e,t,n){var i=eS(Wc(r.prototype),e,t);return typeof i=="function"?function(a){return i.apply(t,a)}:i}function wa(r){return Nse(r)||Ise(r)||gV(r)||Bse()}function zse(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function pV(r){var e=zse(r,"string");return typeof e=="symbol"?e:e+""}function nS(r){return nS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nS(r)}function gV(r,e){if(r){if(typeof r=="string")return Jw(r,e);var t={}.toString.call(r).slice(8,-1);return t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set"?Array.from(r):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?Jw(r,e):void 0}}var vV=function(e){e instanceof Array?e.forEach(vV):(e.map&&e.map.dispose(),e.dispose())},mV=function(e){e.geometry&&e.geometry.dispose(),e.material&&vV(e.material),e.texture&&e.texture.dispose(),e.children&&e.children.forEach(mV)},rS=function(e){for(;e.children.length;){var t=e.children[0];e.remove(t),mV(t)}},T1=new WeakMap,Bp=new WeakMap,Ih=function(r){function e(t){var n,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=i.dataBindAttr,s=a===void 0?"__data":a,o=i.objBindAttr,l=o===void 0?"__threeObj":o;return cV(this,e),n=uV(this,e),ym(n,"scene",void 0),PF(n,T1,void 0),PF(n,Bp,void 0),n.scene=t,DF(T1,n,s),DF(Bp,n,l),n.onRemoveObj(function(){}),n}return dV(e,r),fV(e,[{key:"onCreateObj",value:function(n){var i=this;return E1(e,"onCreateObj",this)([function(a){var s=n(a);return a[b1(Bp,i)]=s,s[b1(T1,i)]=a,i.scene.add(s),s}]),this}},{key:"onRemoveObj",value:function(n){var i=this;return E1(e,"onRemoveObj",this)([function(a,s){var o=E1(e,"getData",i)([a]);n(a,s),i.scene.remove(a),rS(a),delete o[b1(Bp,i)]}]),this}}])}(Zae),Oh=function(e){return isNaN(e)?parseInt(ht(e).toHex(),16):e},w1=function(e){return isNaN(e)?ht(e).getAlpha():1},Vse=aV(ise);function IF(r,e,t){!e||typeof t!="string"||r.filter(function(n){return!n[t]}).forEach(function(n){n[t]=Vse(e(n))})}function Hse(r,e){var t=r.nodes,n=r.links,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=i.nodeFilter,s=a===void 0?function(){return!0}:a,o=i.onLoopError,l=o===void 0?function(f){throw"Invalid DAG structure! Found cycle in node path: ".concat(f.join(" -> "),".")}:o,u={};t.forEach(function(f){return u[e(f)]={data:f,out:[],depth:-1,skip:!s(f)}}),n.forEach(function(f){var p=f.source,m=f.target,v=x(p),g=x(m);if(!u.hasOwnProperty(v))throw"Missing source node with id: ".concat(v);if(!u.hasOwnProperty(g))throw"Missing target node with id: ".concat(g);var y=u[v],_=u[g];y.out.push(_);function x(E){return nS(E)==="object"?e(E):E}});var c=[];d(Object.values(u));var h=Object.assign.apply(Object,[{}].concat(wa(Object.entries(u).filter(function(f){var p=mf(f,2),m=p[1];return!m.skip}).map(function(f){var p=mf(f,2),m=p[0],v=p[1];return ym({},m,v.depth)}))));return h;function d(f){for(var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,v=function(){var x=f[g];if(p.indexOf(x)!==-1){var E=[].concat(wa(p.slice(p.indexOf(x))),[x]).map(function(T){return e(T.data)});return c.some(function(T){return T.length===E.length&&T.every(function(b,w){return b===E[w]})})||(c.push(E),l(E)),1}m>x.depth&&(x.depth=m,d(x.out,[].concat(wa(p),[x]),m+(x.skip?0:1)))},g=0,y=f.length;g<y;g++)v()}}var _t=window.THREE?window.THREE:{Group:ec,Mesh:Yn,MeshLambertMaterial:_z,Color:ct,BufferGeometry:ri,BufferAttribute:Rr,Matrix4:Ut,Vector3:re,SphereGeometry:Od,CylinderGeometry:Ld,TubeGeometry:nM,ConeGeometry:tM,Line:MZ,LineBasicMaterial:fm,QuadraticBezierCurve3:eM,CubicBezierCurve3:mz,Box3:lu},OF={graph:Kie,forcelayout:uM.exports},Wse=2,S1=new _t.BufferGeometry().setAttribute?"setAttribute":"addAttribute",Up=new _t.BufferGeometry().applyMatrix4?"applyMatrix4":"applyMatrix",qse=vm({props:{jsonUrl:{onChange:function(e,t){var n=this;e&&!t.fetchingJson&&(t.fetchingJson=!0,t.onLoading(),fetch(e).then(function(i){return i.json()}).then(function(i){t.fetchingJson=!1,t.onFinishLoading(i),n.graphData(i)}))},triggerUpdate:!1},graphData:{default:{nodes:[],links:[]},onChange:function(e,t){t.engineRunning=!1}},numDimensions:{default:3,onChange:function(e,t){var n=t.d3ForceLayout.force("charge");n&&n.strength(e>2?-60:-30),e<3&&i(t.graphData.nodes,"z"),e<2&&i(t.graphData.nodes,"y");function i(a,s){a.forEach(function(o){delete o[s],delete o["v".concat(s)]})}}},dagMode:{onChange:function(e,t){!e&&t.forceEngine==="d3"&&(t.graphData.nodes||[]).forEach(function(n){return n.fx=n.fy=n.fz=void 0})}},dagLevelDistance:{},dagNodeFilter:{default:function(e){return!0}},onDagError:{triggerUpdate:!1},nodeRelSize:{default:4},nodeId:{default:"id"},nodeVal:{default:"val"},nodeResolution:{default:8},nodeColor:{default:"color"},nodeAutoColorBy:{},nodeOpacity:{default:.75},nodeVisibility:{default:!0},nodeThreeObject:{},nodeThreeObjectExtend:{default:!1},nodePositionUpdate:{triggerUpdate:!1},linkSource:{default:"source"},linkTarget:{default:"target"},linkVisibility:{default:!0},linkColor:{default:"color"},linkAutoColorBy:{},linkOpacity:{default:.2},linkWidth:{},linkResolution:{default:6},linkCurvature:{default:0,triggerUpdate:!1},linkCurveRotation:{default:0,triggerUpdate:!1},linkMaterial:{},linkThreeObject:{},linkThreeObjectExtend:{default:!1},linkPositionUpdate:{triggerUpdate:!1},linkDirectionalArrowLength:{default:0},linkDirectionalArrowColor:{},linkDirectionalArrowRelPos:{default:.5,triggerUpdate:!1},linkDirectionalArrowResolution:{default:8},linkDirectionalParticles:{default:0},linkDirectionalParticleSpeed:{default:.01,triggerUpdate:!1},linkDirectionalParticleWidth:{default:.5},linkDirectionalParticleColor:{},linkDirectionalParticleResolution:{default:4},forceEngine:{default:"d3"},d3AlphaMin:{default:0},d3AlphaDecay:{default:.0228,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaDecay(e)}},d3AlphaTarget:{default:0,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.alphaTarget(e)}},d3VelocityDecay:{default:.4,triggerUpdate:!1,onChange:function(e,t){t.d3ForceLayout.velocityDecay(e)}},ngraphPhysics:{default:{timeStep:20,gravity:-1.2,theta:.8,springLength:30,springCoefficient:8e-4,dragCoefficient:.02}},warmupTicks:{default:0,triggerUpdate:!1},cooldownTicks:{default:1/0,triggerUpdate:!1},cooldownTime:{default:15e3,triggerUpdate:!1},onLoading:{default:function(){},triggerUpdate:!1},onFinishLoading:{default:function(){},triggerUpdate:!1},onUpdate:{default:function(){},triggerUpdate:!1},onFinishUpdate:{default:function(){},triggerUpdate:!1},onEngineTick:{default:function(){},triggerUpdate:!1},onEngineStop:{default:function(){},triggerUpdate:!1}},methods:{refresh:function(e){return e._flushObjects=!0,e._rerender(),this},d3Force:function(e,t,n){return n===void 0?e.d3ForceLayout.force(t):(e.d3ForceLayout.force(t,n),this)},d3ReheatSimulation:function(e){return e.d3ForceLayout.alpha(1),this.resetCountdown(),this},resetCountdown:function(e){return e.cntTicks=0,e.startTickTime=new Date,e.engineRunning=!0,this},tickFrame:function(e){var t=e.forceEngine!=="ngraph";return e.engineRunning&&n(),i(),a(),this;function n(){++e.cntTicks>e.cooldownTicks||new Date-e.startTickTime>e.cooldownTime||t&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin?(e.engineRunning=!1,e.onEngineStop()):(e.layout[t?"tick":"step"](),e.onEngineTick());var s=Ht(e.nodeThreeObjectExtend);e.nodeDataMapper.entries().forEach(function(d){var f=mf(d,2),p=f[0],m=f[1];if(!!m){var v=t?p:e.layout.getNodePosition(p[e.nodeId]),g=s(p);(!e.nodePositionUpdate||!e.nodePositionUpdate(g?m.children[0]:m,{x:v.x,y:v.y,z:v.z},p)||g)&&(m.position.x=v.x,m.position.y=v.y||0,m.position.z=v.z||0)}});var o=Ht(e.linkWidth),l=Ht(e.linkCurvature),u=Ht(e.linkCurveRotation),c=Ht(e.linkThreeObjectExtend);e.linkDataMapper.entries().forEach(function(d){var f=mf(d,2),p=f[0],m=f[1];if(!!m){var v=t?p:e.layout.getLinkPosition(e.layout.graph.getLink(p.source,p.target).id),g=v[t?"source":"from"],y=v[t?"target":"to"];if(!(!g||!y||!g.hasOwnProperty("x")||!y.hasOwnProperty("x"))){h(p);var _=c(p);if(!(e.linkPositionUpdate&&e.linkPositionUpdate(_?m.children[1]:m,{start:{x:g.x,y:g.y,z:g.z},end:{x:y.x,y:y.y,z:y.z}},p)&&!_)){var x=30,E=p.__curve,T=m.children.length?m.children[0]:m;if(T.type==="Line"){if(E){var w=E.getPoints(x);T.geometry.getAttribute("position").array.length!==w.length*3&&T.geometry[S1]("position",new _t.BufferAttribute(new Float32Array(w.length*3),3)),T.geometry.setFromPoints(w)}else{var b=T.geometry.getAttribute("position");(!b||!b.array||b.array.length!==6)&&T.geometry[S1]("position",b=new _t.BufferAttribute(new Float32Array(2*3),3)),b.array[0]=g.x,b.array[1]=g.y||0,b.array[2]=g.z||0,b.array[3]=y.x,b.array[4]=y.y||0,b.array[5]=y.z||0,b.needsUpdate=!0}T.geometry.computeBoundingSphere()}else if(T.type==="Mesh")if(E){T.geometry.type.match(/^Tube(Buffer)?Geometry$/)||(T.position.set(0,0,0),T.rotation.set(0,0,0),T.scale.set(1,1,1));var N=Math.ceil(o(p)*10)/10,D=N/2,I=new _t.TubeGeometry(E,x,D,e.linkResolution,!1);T.geometry.dispose(),T.geometry=I}else{if(!T.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)){var A=Math.ceil(o(p)*10)/10,S=A/2,C=new _t.CylinderGeometry(S,S,1,e.linkResolution,1,!1);C[Up](new _t.Matrix4().makeTranslation(0,1/2,0)),C[Up](new _t.Matrix4().makeRotationX(Math.PI/2)),T.geometry.dispose(),T.geometry=C}var R=new _t.Vector3(g.x,g.y||0,g.z||0),P=new _t.Vector3(y.x,y.y||0,y.z||0),M=R.distanceTo(P);T.position.x=R.x,T.position.y=R.y,T.position.z=R.z,T.scale.z=M,T.parent.localToWorld(P),T.lookAt(P)}}}}});function h(d){var f=t?d:e.layout.getLinkPosition(e.layout.graph.getLink(d.source,d.target).id),p=f[t?"source":"from"],m=f[t?"target":"to"];if(!(!p||!m||!p.hasOwnProperty("x")||!m.hasOwnProperty("x"))){var v=l(d);if(!v)d.__curve=null;else{var g=new _t.Vector3(p.x,p.y||0,p.z||0),y=new _t.Vector3(m.x,m.y||0,m.z||0),_=g.distanceTo(y),x,E=u(d);if(_>0){var T=m.x-p.x,b=m.y-p.y||0,w=new _t.Vector3().subVectors(y,g),A=w.clone().multiplyScalar(v).cross(T!==0||b!==0?new _t.Vector3(0,0,1):new _t.Vector3(0,1,0)).applyAxisAngle(w.normalize(),E).add(new _t.Vector3().addVectors(g,y).divideScalar(2));x=new _t.QuadraticBezierCurve3(g,A,y)}else{var S=v*70,C=-E,R=C+Math.PI/2;x=new _t.CubicBezierCurve3(g,new _t.Vector3(S*Math.cos(R),S*Math.sin(R),0).add(g),new _t.Vector3(S*Math.cos(C),S*Math.sin(C),0).add(g),y)}d.__curve=x}}}}function i(){var s=Ht(e.linkDirectionalArrowRelPos),o=Ht(e.linkDirectionalArrowLength),l=Ht(e.nodeVal);e.arrowDataMapper.entries().forEach(function(u){var c=mf(u,2),h=c[0],d=c[1];if(!!d){var f=t?h:e.layout.getLinkPosition(e.layout.graph.getLink(h.source,h.target).id),p=f[t?"source":"from"],m=f[t?"target":"to"];if(!(!p||!m||!p.hasOwnProperty("x")||!m.hasOwnProperty("x"))){var v=Math.cbrt(Math.max(0,l(p)||1))*e.nodeRelSize,g=Math.cbrt(Math.max(0,l(m)||1))*e.nodeRelSize,y=o(h),_=s(h),x=h.__curve?function(S){return h.__curve.getPoint(S)}:function(S){var C=function(P,M,N,D){return M[P]+(N[P]-M[P])*D||0};return{x:C("x",p,m,S),y:C("y",p,m,S),z:C("z",p,m,S)}},E=h.__curve?h.__curve.getLength():Math.sqrt(["x","y","z"].map(function(S){return Math.pow((m[S]||0)-(p[S]||0),2)}).reduce(function(S,C){return S+C},0)),T=v+y+(E-v-g-y)*_,b=x(T/E),w=x((T-y)/E);["x","y","z"].forEach(function(S){return d.position[S]=w[S]});var A=hV(_t.Vector3,wa(["x","y","z"].map(function(S){return b[S]})));d.parent.localToWorld(A),d.lookAt(A)}}})}function a(){var s=Ht(e.linkDirectionalParticleSpeed);e.graphData.links.forEach(function(o){var l=e.particlesDataMapper.getObj(o),u=l&&l.children,c=o.__singleHopPhotonsObj&&o.__singleHopPhotonsObj.children;if(!((!c||!c.length)&&(!u||!u.length))){var h=t?o:e.layout.getLinkPosition(e.layout.graph.getLink(o.source,o.target).id),d=h[t?"source":"from"],f=h[t?"target":"to"];if(!(!d||!f||!d.hasOwnProperty("x")||!f.hasOwnProperty("x"))){var p=s(o),m=o.__curve?function(g){return o.__curve.getPoint(g)}:function(g){var y=function(x,E,T,b){return E[x]+(T[x]-E[x])*b||0};return{x:y("x",d,f,g),y:y("y",d,f,g),z:y("z",d,f,g)}},v=[].concat(wa(u||[]),wa(c||[]));v.forEach(function(g,y){var _=g.parent.__linkThreeObjType==="singleHopPhotons";if(g.hasOwnProperty("__progressRatio")||(g.__progressRatio=_?0:y/u.length),g.__progressRatio+=p,g.__progressRatio>=1)if(!_)g.__progressRatio=g.__progressRatio%1;else{g.parent.remove(g),rS(g);return}var x=g.__progressRatio,E=m(x);["x","y","z"].forEach(function(T){return g.position[T]=E[T]})})}}})}},emitParticle:function(e,t){if(t&&e.graphData.links.includes(t)){if(!t.__singleHopPhotonsObj){var n=new _t.Group;n.__linkThreeObjType="singleHopPhotons",t.__singleHopPhotonsObj=n,e.graphScene.add(n)}var i=Ht(e.linkDirectionalParticleWidth),a=Math.ceil(i(t)*10)/10/2,s=e.linkDirectionalParticleResolution,o=new _t.SphereGeometry(a,s,s),l=Ht(e.linkColor),u=Ht(e.linkDirectionalParticleColor),c=u(t)||l(t)||"#f0f0f0",h=new _t.Color(Oh(c)),d=e.linkOpacity*3,f=new _t.MeshLambertMaterial({color:h,transparent:!0,opacity:d});t.__singleHopPhotonsObj.add(new _t.Mesh(o,f))}return this},getGraphBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0};if(!e.initialised)return null;var n=function i(a){var s=[];if(a.geometry){a.geometry.computeBoundingBox();var o=new _t.Box3;o.copy(a.geometry.boundingBox).applyMatrix4(a.matrixWorld),s.push(o)}return s.concat.apply(s,wa((a.children||[]).filter(function(l){return!l.hasOwnProperty("__graphObjType")||l.__graphObjType==="node"&&t(l.__data)}).map(i)))}(e.graphScene);return n.length?Object.assign.apply(Object,wa(["x","y","z"].map(function(i){return ym({},i,[Bae(n,function(a){return a.min[i]}),Fae(n,function(a){return a.max[i]})])}))):null}},stateInit:function(){return{d3ForceLayout:qie().force("link",Bie()).force("charge",$ie()).force("center",tie()).force("dagRadial",null).stop(),engineRunning:!1}},init:function(e,t){t.graphScene=e,t.nodeDataMapper=new Ih(e,{objBindAttr:"__threeObj"}),t.linkDataMapper=new Ih(e,{objBindAttr:"__lineObj"}),t.arrowDataMapper=new Ih(e,{objBindAttr:"__arrowObj"}),t.particlesDataMapper=new Ih(e,{objBindAttr:"__photonsObj"})},update:function(e,t){var n=function(F){return F.some(function(V){return t.hasOwnProperty(V)})};if(e.engineRunning=!1,typeof e.onUpdate=="function"&&e.onUpdate(),e.nodeAutoColorBy!==null&&n(["nodeAutoColorBy","graphData","nodeColor"])&&IF(e.graphData.nodes,Ht(e.nodeAutoColorBy),e.nodeColor),e.linkAutoColorBy!==null&&n(["linkAutoColorBy","graphData","linkColor"])&&IF(e.graphData.links,Ht(e.linkAutoColorBy),e.linkColor),e._flushObjects||n(["graphData","nodeThreeObject","nodeThreeObjectExtend","nodeVal","nodeColor","nodeVisibility","nodeRelSize","nodeResolution","nodeOpacity"])){var i=Ht(e.nodeThreeObject),a=Ht(e.nodeThreeObjectExtend),s=Ht(e.nodeVal),o=Ht(e.nodeColor),l=Ht(e.nodeVisibility),u={},c={};(e._flushObjects||n(["nodeThreeObject","nodeThreeObjectExtend"]))&&e.nodeDataMapper.clear(),e.nodeDataMapper.onCreateObj(function(O){var F=i(O),V=a(O);F&&e.nodeThreeObject===F&&(F=F.clone());var $;return F&&!V?$=F:($=new _t.Mesh,$.__graphDefaultObj=!0,F&&V&&$.add(F)),$.__graphObjType="node",$}).onUpdateObj(function(O,F){if(O.__graphDefaultObj){var V=s(F)||1,$=Math.cbrt(V)*e.nodeRelSize,Z=e.nodeResolution;(!O.geometry.type.match(/^Sphere(Buffer)?Geometry$/)||O.geometry.parameters.radius!==$||O.geometry.parameters.widthSegments!==Z)&&(u.hasOwnProperty(V)||(u[V]=new _t.SphereGeometry($,Z,Z)),O.geometry.dispose(),O.geometry=u[V]);var Y=o(F),X=new _t.Color(Oh(Y||"#ffffaa")),K=e.nodeOpacity*w1(Y);(O.material.type!=="MeshLambertMaterial"||!O.material.color.equals(X)||O.material.opacity!==K)&&(c.hasOwnProperty(Y)||(c[Y]=new _t.MeshLambertMaterial({color:X,transparent:!0,opacity:K})),O.material.dispose(),O.material=c[Y])}}).digest(e.graphData.nodes.filter(l))}if(e._flushObjects||n(["graphData","linkThreeObject","linkThreeObjectExtend","linkMaterial","linkColor","linkWidth","linkVisibility","linkResolution","linkOpacity","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution"])){var h=Ht(e.linkThreeObject),d=Ht(e.linkThreeObjectExtend),f=Ht(e.linkMaterial),p=Ht(e.linkVisibility),m=Ht(e.linkColor),v=Ht(e.linkWidth),g={},y={},_={},x=e.graphData.links.filter(p);if((e._flushObjects||n(["linkThreeObject","linkThreeObjectExtend","linkWidth"]))&&e.linkDataMapper.clear(),e.linkDataMapper.onRemoveObj(function(O){var F=O.__data&&O.__data.__singleHopPhotonsObj;F&&(F.parent.remove(F),rS(F),delete O.__data.__singleHopPhotonsObj)}).onCreateObj(function(O){var F=h(O),V=d(O);F&&e.linkThreeObject===F&&(F=F.clone());var $;if(!F||V){var Z=!!v(O);if(Z)$=new _t.Mesh;else{var Y=new _t.BufferGeometry;Y[S1]("position",new _t.BufferAttribute(new Float32Array(2*3),3)),$=new _t.Line(Y)}}var X;return F?V?(X=new _t.Group,X.__graphDefaultObj=!0,X.add($),X.add(F)):X=F:(X=$,X.__graphDefaultObj=!0),X.renderOrder=10,X.__graphObjType="link",X}).onUpdateObj(function(O,F){if(O.__graphDefaultObj){var V=O.children.length?O.children[0]:O,$=Math.ceil(v(F)*10)/10,Z=!!$;if(Z){var Y=$/2,X=e.linkResolution;if(!V.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)||V.geometry.parameters.radiusTop!==Y||V.geometry.parameters.radialSegments!==X){if(!g.hasOwnProperty($)){var K=new _t.CylinderGeometry(Y,Y,1,X,1,!1);K[Up](new _t.Matrix4().makeTranslation(0,1/2,0)),K[Up](new _t.Matrix4().makeRotationX(Math.PI/2)),g[$]=K}V.geometry.dispose(),V.geometry=g[$]}}var se=f(F);if(se)V.material=se;else{var oe=m(F),W=new _t.Color(Oh(oe||"#f0f0f0")),Ne=e.linkOpacity*w1(oe),Be=Z?"MeshLambertMaterial":"LineBasicMaterial";if(V.material.type!==Be||!V.material.color.equals(W)||V.material.opacity!==Ne){var we=Z?y:_;we.hasOwnProperty(oe)||(we[oe]=new _t[Be]({color:W,transparent:Ne<1,opacity:Ne,depthWrite:Ne>=1})),V.material.dispose(),V.material=we[oe]}}}}).digest(x),e.linkDirectionalArrowLength||t.hasOwnProperty("linkDirectionalArrowLength")){var E=Ht(e.linkDirectionalArrowLength),T=Ht(e.linkDirectionalArrowColor);e.arrowDataMapper.onCreateObj(function(){var O=new _t.Mesh(void 0,new _t.MeshLambertMaterial({transparent:!0}));return O.__linkThreeObjType="arrow",O}).onUpdateObj(function(O,F){var V=E(F),$=e.linkDirectionalArrowResolution;if(!O.geometry.type.match(/^Cone(Buffer)?Geometry$/)||O.geometry.parameters.height!==V||O.geometry.parameters.radialSegments!==$){var Z=new _t.ConeGeometry(V*.25,V,$);Z.translate(0,V/2,0),Z.rotateX(Math.PI/2),O.geometry.dispose(),O.geometry=Z}var Y=T(F)||m(F)||"#f0f0f0";O.material.color=new _t.Color(Oh(Y)),O.material.opacity=e.linkOpacity*3*w1(Y)}).digest(x.filter(E))}if(e.linkDirectionalParticles||t.hasOwnProperty("linkDirectionalParticles")){var b=Ht(e.linkDirectionalParticles),w=Ht(e.linkDirectionalParticleWidth),A=Ht(e.linkDirectionalParticleColor),S={},C={};e.particlesDataMapper.onCreateObj(function(){var O=new _t.Group;return O.__linkThreeObjType="photons",O.__photonDataMapper=new Ih(O),O}).onUpdateObj(function(O,F){var V=Math.round(Math.abs(b(F))),$=!!O.children.length&&O.children[0],Z=Math.ceil(w(F)*10)/10/2,Y=e.linkDirectionalParticleResolution,X;$&&$.geometry.parameters.radius===Z&&$.geometry.parameters.widthSegments===Y?X=$.geometry:(C.hasOwnProperty(Z)||(C[Z]=new _t.SphereGeometry(Z,Y,Y)),X=C[Z],$&&$.geometry.dispose());var K=A(F)||m(F)||"#f0f0f0",se=new _t.Color(Oh(K)),oe=e.linkOpacity*3,W;$&&$.material.color.equals(se)&&$.material.opacity===oe?W=$.material:(S.hasOwnProperty(K)||(S[K]=new _t.MeshLambertMaterial({color:se,transparent:!0,opacity:oe})),W=S[K],$&&$.material.dispose()),O.__photonDataMapper.id(function(Ne){return Ne.idx}).onCreateObj(function(){return new _t.Mesh(X,W)}).onUpdateObj(function(Ne){Ne.geometry=X,Ne.material=W}).digest(wa(new Array(V)).map(function(Ne,Be){return{idx:Be}}))}).digest(x.filter(b))}}if(e._flushObjects=!1,n(["graphData","nodeId","linkSource","linkTarget","numDimensions","forceEngine","dagMode","dagNodeFilter","dagLevelDistance"])){e.engineRunning=!1,e.graphData.links.forEach(function(O){O.source=O[e.linkSource],O.target=O[e.linkTarget]});var R=e.forceEngine!=="ngraph",P;if(R){(P=e.d3ForceLayout).stop().alpha(1).numDimensions(e.numDimensions).nodes(e.graphData.nodes);var M=e.d3ForceLayout.force("link");M&&M.id(function(O){return O[e.nodeId]}).links(e.graphData.links);var N=e.dagMode&&Hse(e.graphData,function(O){return O[e.nodeId]},{nodeFilter:e.dagNodeFilter,onLoopError:e.onDagError||void 0}),D=Math.max.apply(Math,wa(Object.values(N||[]))),I=e.dagLevelDistance||e.graphData.nodes.length/(D||1)*Wse*(["radialin","radialout"].indexOf(e.dagMode)!==-1?.7:1);if(["lr","rl","td","bu","zin","zout"].includes(t.dagMode)){var L=["lr","rl"].includes(t.dagMode)?"fx":["td","bu"].includes(t.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(O){return delete O[L]})}if(["lr","rl","td","bu","zin","zout"].includes(e.dagMode)){var z=["rl","td","zout"].includes(e.dagMode),B=function(F){return(N[F[e.nodeId]]-D/2)*I*(z?-1:1)},k=["lr","rl"].includes(e.dagMode)?"fx":["td","bu"].includes(e.dagMode)?"fy":"fz";e.graphData.nodes.filter(e.dagNodeFilter).forEach(function(O){return O[k]=B(O)})}e.d3ForceLayout.force("dagRadial",["radialin","radialout"].indexOf(e.dagMode)!==-1?Xie(function(O){var F=N[O[e.nodeId]]||-1;return(e.dagMode==="radialin"?D-F:F)*I}).strength(function(O){return e.dagNodeFilter(O)?1:0}):null)}else{var U=OF.graph();e.graphData.nodes.forEach(function(O){U.addNode(O[e.nodeId])}),e.graphData.links.forEach(function(O){U.addLink(O.source,O.target)}),P=OF.forcelayout(U,Use({dimensions:e.numDimensions},e.ngraphPhysics)),P.graph=U}for(var G=0;G<e.warmupTicks&&!(R&&e.d3AlphaMin>0&&e.d3ForceLayout.alpha()<e.d3AlphaMin);G++)P[R?"tick":"step"]();e.layout=P,this.resetCountdown()}e.engineRunning=!0,e.onFinishUpdate()}});function $se(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Object,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=function(i){function a(){var s;cV(this,a);for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];return s=uV(this,a,[].concat(l)),s.__kapsuleInstance=hV(r,[].concat(wa(t?[s]:[]),l)),s}return dV(a,i),fV(a)}(e);return Object.keys(r()).forEach(function(i){return n.prototype[i]=function(){var a,s=(a=this.__kapsuleInstance)[i].apply(a,arguments);return s===this.__kapsuleInstance?this:s}}),n}var Xse=window.THREE?window.THREE:{Group:ec},yV=$se(qse,Xse.Group,!0);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Yse=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveMap","envMap","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class jse{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=Yse,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:n,material:i,object:a}=e;if(t={material:this.getMaterialData(i),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:a.matrixWorld.clone()},a.center&&(t.center=a.center.clone()),a.morphTargetInfluences&&(t.morphTargetInfluences=a.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:s,height:o}=e.context;t.bufferWidth=s,t.bufferHeight=o}this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const n in e){const i=e[n];t[n]={version:i.version}}return t}containsNode(e){const t=e.material;for(const n in t)if(t[n]&&t[n].isNode)return!0;return e.renderer.nodes.modelViewMatrix!==null||e.renderer.nodes.modelNormalViewMatrix!==null}getMaterialData(e){const t={};for(const n of this.refreshUniforms){const i=e[n];i!=null&&(typeof i=="object"&&i.clone!==void 0?i.isTexture===!0?t[n]={id:i.id,version:i.version}:t[n]=i.clone():t[n]=i)}return t}equals(e){const{object:t,material:n,geometry:i}=e,a=this.getRenderObjectData(e);if(a.worldMatrix.equals(t.matrixWorld)!==!0)return a.worldMatrix.copy(t.matrixWorld),!1;const s=a.material;for(const m in s){const v=s[m],g=n[m];if(v.equals!==void 0){if(v.equals(g)===!1)return v.copy(g),!1}else if(g.isTexture===!0){if(v.id!==g.id||v.version!==g.version)return v.id=g.id,v.version=g.version,!1}else if(v!==g)return s[m]=g,!1}if(s.transmission>0){const{width:m,height:v}=e.context;if(a.bufferWidth!==m||a.bufferHeight!==v)return a.bufferWidth=m,a.bufferHeight=v,!1}const o=a.geometry,l=i.attributes,u=o.attributes,c=Object.keys(u),h=Object.keys(l);if(o.id!==i.id)return o.id=i.id,!1;if(c.length!==h.length)return a.geometry.attributes=this.getAttributesData(l),!1;for(const m of c){const v=u[m],g=l[m];if(g===void 0)return delete u[m],!1;if(v.version!==g.version)return v.version=g.version,!1}const d=i.index,f=o.indexVersion,p=d?d.version:null;if(f!==p)return o.indexVersion=p,!1;if(o.drawRange.start!==i.drawRange.start||o.drawRange.count!==i.drawRange.count)return o.drawRange.start=i.drawRange.start,o.drawRange.count=i.drawRange.count,!1;if(a.morphTargetInfluences){let m=!1;for(let v=0;v<a.morphTargetInfluences.length;v++)a.morphTargetInfluences[v]!==t.morphTargetInfluences[v]&&(m=!0);if(m)return!0}return a.center&&a.center.equals(t.center)===!1?(a.center.copy(t.center),!0):(e.bundle!==null&&(a.version=e.bundle.version),!0)}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e))return!0;const{renderId:n}=t;if(this.renderId!==n)return this.renderId=n,!0;const i=e.object.static===!0,a=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;return i||a?!1:this.equals(e)!==!0}}function Jf(r,e=0){let t=3735928559^e,n=1103547991^e;if(r instanceof Array)for(let i=0,a;i<r.length;i++)a=r[i],t=Math.imul(t^a,2654435761),n=Math.imul(n^a,1597334677);else for(let i=0,a;i<r.length;i++)a=r.charCodeAt(i),t=Math.imul(t^a,2654435761),n=Math.imul(n^a,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&n)+(t>>>0)}const Kse=r=>Jf(r),vM=r=>Jf(r),ed=(...r)=>Jf(r);function _V(r,e=!1){const t=[];r.isNode===!0&&(t.push(r.id),r=r.getSelf());for(const{property:n,childNode:i}of sv(r))t.push(Jf(n.slice(0,-4)),i.getCacheKey(e));return Jf(t)}function*sv(r,e=!1){for(const t in r){if(t.startsWith("_")===!0)continue;const n=r[t];if(Array.isArray(n)===!0)for(let i=0;i<n.length;i++){const a=n[i];a&&(a.isNode===!0||e&&typeof a.toJSON=="function")&&(yield{property:t,index:i,childNode:a})}else if(n&&n.isNode===!0)yield{property:t,childNode:n};else if(typeof n=="object")for(const i in n){const a=n[i];a&&(a.isNode===!0||e&&typeof a.toJSON=="function")&&(yield{property:t,index:i,childNode:a})}}}const Qse=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),FF=new WeakMap;function Zse(r){return Qse.get(r)}function ov(r){if(r==null)return null;const e=typeof r;return r.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":r.isVector2===!0?"vec2":r.isVector3===!0?"vec3":r.isVector4===!0?"vec4":r.isMatrix2===!0?"mat2":r.isMatrix3===!0?"mat3":r.isMatrix4===!0?"mat4":r.isColor===!0?"color":r instanceof ArrayBuffer?"ArrayBuffer":null}function xV(r,...e){const t=r?r.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),r==="color"?new ct(...e):t==="vec2"?new He(...e):t==="vec3"?new re(...e):t==="vec4"?new xt(...e):t==="mat2"?new dm(...e):t==="mat3"?new Et(...e):t==="mat4"?new Ut(...e):r==="bool"?e[0]||!1:r==="float"||r==="int"||r==="uint"?e[0]||0:r==="string"?e[0]||"":r==="ArrayBuffer"?eoe(e[0]):null}function bV(r){let e=FF.get(r);return e===void 0&&(e={},FF.set(r,e)),e}function Jse(r){let e="";const t=new Uint8Array(r);for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function eoe(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0)).buffer}const BF={VERTEX:"vertex",FRAGMENT:"fragment"},Lt={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},ks={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},toe=["fragment","vertex"],UF=["setup","analyze","generate"],kF=[...toe,"compute"],dh=["x","y","z","w"];let noe=0;class At extends to{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=Lt.NONE,this.updateBeforeType=Lt.NONE,this.updateAfterType=Lt.NONE,this.uuid=tv.generateUUID(),this.version=0,this.global=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:noe++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,Lt.FRAME)}onRenderUpdate(e){return this.onUpdate(e,Lt.RENDER)}onObjectUpdate(e){return this.onUpdate(e,Lt.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of sv(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(e=!1){return e=e||this.version!==this._cacheKeyVersion,(e===!0||this._cacheKey===null)&&(this._cacheKey=ed(_V(this,e),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);let n=0;for(const i of this.getChildren())t["node"+n++]=i;return t.outputNode||null}analyze(e){if(e.increaseUsage(this)===1){const n=e.getNodeProperties(this);for(const i of Object.values(n))i&&i.isNode===!0&&i.build(e)}}generate(e,t){const{outputNode:n}=e.getNodeProperties(this);if(n&&n.isNode===!0)return n.build(e,t)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const n=this.getShared(e);if(this!==n)return n.build(e,t);e.addNode(this),e.addChain(this);let i=null;const a=e.getBuildStage();if(a==="setup"){this.updateReference(e);const s=e.getNodeProperties(this);if(s.initialized!==!0){s.initialized=!0;const o=this.setup(e),l=o&&o.isNode===!0;for(const u of Object.values(s))u&&u.isNode===!0&&u.build(e);l&&o.build(e),s.outputNode=o}}else if(a==="analyze")this.analyze(e);else if(a==="generate")if(this.generate.length===1){const o=this.getNodeType(e),l=e.getDataFromNode(this);i=l.snippet,i===void 0?l.generated===void 0?(l.generated=!0,i=this.generate(e)||"",l.snippet=i):(console.warn("THREE.Node: Recursion detected.",this),i=""):l.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),i=e.format(i,o,t)}else i=this.generate(e,t)||"";return e.removeChain(this),e.addSequentialNode(this),i}getSerializeChildren(){return sv(this)}serialize(e){const t=this.getSerializeChildren(),n={};for(const{property:i,index:a,childNode:s}of t)a!==void 0?(n[i]===void 0&&(n[i]=Number.isInteger(a)?[]:{}),n[i][a]=s.toJSON(e.meta).uuid):n[i]=s.toJSON(e.meta).uuid;Object.keys(n).length>0&&(e.inputNodes=n)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const n in e.inputNodes)if(Array.isArray(e.inputNodes[n])){const i=[];for(const a of e.inputNodes[n])i.push(t[a]);this[n]=i}else if(typeof e.inputNodes[n]=="object"){const i={};for(const a in e.inputNodes[n]){const s=e.inputNodes[n][a];i[a]=t[s]}this[n]=i}else{const i=e.inputNodes[n];this[n]=t[i]}}}toJSON(e){const{uuid:t,type:n}=this,i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{},nodes:{}});let a=e.nodes[t];a===void 0&&(a={uuid:t,type:n,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},i!==!0&&(e.nodes[a.uuid]=a),this.serialize(a),delete a.meta);function s(o){const l=[];for(const u in o){const c=o[u];delete c.metadata,l.push(c)}return l}if(i){const o=s(e.textures),l=s(e.images),u=s(e.nodes);o.length>0&&(a.textures=o),l.length>0&&(a.images=l),u.length>0&&(a.nodes=u)}return a}}class Ud extends At{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.indexNode.getNodeType(e),n=this.node.build(e),i=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${n}[ ${i} ]`}}class EV extends At{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let n=null;for(const i of this.convertTo.split("|"))(n===null||e.getTypeLength(t)===e.getTypeLength(i))&&(n=i);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const n=this.node,i=this.getNodeType(e),a=n.build(e,i);return e.format(a,i,t)}}class zn extends At{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const i=e.getVectorType(this.getNodeType(e,t)),a=e.getDataFromNode(this);if(a.propertyName!==void 0)return e.format(a.propertyName,i,t);if(i!=="void"&&t!=="void"&&this.hasDependencies(e)){const s=super.build(e,i),o=e.getVarFromNode(this,null,i),l=e.getPropertyName(o);return e.addLineFlowCode(`${l} = ${s}`,this),a.snippet=s,a.propertyName=l,e.format(a.propertyName,i,t)}}return super.build(e,t)}}class roe extends zn{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,n)=>t+e.getTypeLength(n.getNodeType(e)),0))}generate(e,t){const n=this.getNodeType(e),i=e.getTypeLength(n),a=this.nodes,s=e.getComponentType(n),o=[];let l=0;for(const c of a){if(l>=i){console.error(`THREE.TSL: Length of parameters exceeds maximum length of function '${n}()' type.`);break}let h=c.getNodeType(e),d=e.getTypeLength(h),f;l+d>i&&(console.error(`THREE.TSL: Length of '${n}()' data exceeds maximum length of output type.`),d=i-l,h=e.getTypeFromLength(d)),l+=d,f=c.build(e,h);const p=e.getComponentType(h);p!==s&&(f=e.format(f,p,s)),o.push(f)}const u=`${e.getType(n)}( ${o.join(", ")} )`;return e.format(u,n,t)}}const ioe=dh.join("");class GF extends At{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(dh.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){const n=this.node,i=e.getTypeLength(n.getNodeType(e));let a=null;if(i>1){let s=null;this.getVectorLength()>=i&&(s=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const l=n.build(e,s);this.components.length===i&&this.components===ioe.slice(0,this.components.length)?a=e.format(l,s,t):a=e.format(`${l}.${this.components}`,this.getNodeType(e),t)}else a=n.build(e,t);return a}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class aoe extends zn{static get type(){return"SetNode"}constructor(e,t,n){super(),this.sourceNode=e,this.components=t,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:n,targetNode:i}=this,a=this.getNodeType(e),s=e.getComponentType(i.getNodeType(e)),o=e.getTypeFromLength(n.length,s),l=i.build(e,o),u=t.build(e,a),c=e.getTypeLength(a),h=[];for(let d=0;d<c;d++){const f=dh[d];f===n[0]?(h.push(l),d+=n.length-1):h.push(u+"."+f)}return`${e.getType(a)}( ${h.join(", ")} )`}}class soe extends zn{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:n}=this,i=this.getNodeType(e),a=n.build(e),s=e.getVarFromNode(this),o=e.getPropertyName(s);e.addLineFlowCode(o+" = "+a,this);const l=e.getTypeLength(i),u=[];let c=0;for(let h=0;h<l;h++){const d=dh[h];d===t[c]?(u.push("1.0 - "+(o+"."+d)),c++):u.push(o+"."+d)}return`${e.getType(i)}( ${u.join(", ")} )`}}class mM extends At{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?ov(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=ov(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=Jse(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?xV(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}const zF=/float|u?int/;class ro extends mM{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const n=this.getNodeType(e);return zF.test(n)&&zF.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),n,t)}}class ooe extends At{static get type(){return"MemberNode"}constructor(e,t){super(),this.node=e,this.property=t,this.isMemberNode=!0}getNodeType(e){return this.node.getMemberType(e,this.property)}generate(e){return this.node.build(e)+"."+this.property}}let qc=null;const nc=new Map;function De(r,e){if(nc.has(r)){console.warn(`THREE.TSL: Redefinition of method chaining '${r}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${r} is not a function`);nc.set(r,e)}const TV=r=>r.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),VF=r=>TV(r).split("").sort().join(""),wV={setup(r,e){const t=e.shift();return r(bm(t),...e)},get(r,e,t){if(typeof e=="string"&&r[e]===void 0){if(r.isStackNode!==!0&&e==="assign")return(...n)=>(qc.assign(t,...n),t);if(nc.has(e)){const n=nc.get(e);return r.isStackNode?(...i)=>t.add(n(...i)):(...i)=>n(t,...i)}else{if(e==="self")return r;if(e.endsWith("Assign")&&nc.has(e.slice(0,e.length-6))){const n=nc.get(e.slice(0,e.length-6));return r.isStackNode?(...i)=>t.assign(i[0],n(...i)):(...i)=>t.assign(n(t,...i))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=TV(e),We(new GF(t,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=VF(e.slice(3).toLowerCase()),n=>We(new aoe(r,e,n));if(/^flip[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=VF(e.slice(4).toLowerCase()),()=>We(new soe(We(r),e));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),We(new GF(r,e));if(/^\d+$/.test(e)===!0)return We(new Ud(t,new ro(Number(e),"uint")));if(/^get$/.test(e)===!0)return n=>We(new ooe(t,n))}}}return Reflect.get(r,e,t)},set(r,e,t,n){return typeof e=="string"&&r[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(n[e].assign(t),!0):Reflect.set(r,e,t,n)}},A1=new WeakMap,HF=new WeakMap,loe=function(r,e=null){const t=ov(r);if(t==="node"){let n=A1.get(r);return n===void 0&&(n=new Proxy(r,wV),A1.set(r,n),A1.set(n,n)),n}else{if(e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string")return We(iS(r,e));if(t==="shader")return qe(r)}return r},uoe=function(r,e=null){for(const t in r)r[t]=We(r[t],e);return r},coe=function(r,e=null){const t=r.length;for(let n=0;n<t;n++)r[n]=We(r[n],e);return r},hoe=function(r,e=null,t=null,n=null){const i=c=>We(n!==null?Object.assign(c,n):c);let a,s=e,o,l;function u(c){let h;return s?h=/[a-z]/i.test(s)?s+"()":s:h=r.type,o!==void 0&&c.length<o?(console.error(`THREE.TSL: "${h}" parameter length is less than minimum required.`),c.concat(new Array(o-c.length).fill(0))):l!==void 0&&c.length>l?(console.error(`THREE.TSL: "${h}" parameter length exceeds limit.`),c.slice(0,l)):c}return e===null?a=(...c)=>i(new r(...gc(u(c)))):t!==null?(t=We(t),a=(...c)=>i(new r(e,...gc(u(c)),t))):a=(...c)=>i(new r(e,...gc(u(c)))),a.setParameterLength=(...c)=>(c.length===1?o=l=c[0]:c.length===2&&([o,l]=c),a),a.setName=c=>(s=c,a),a},foe=function(r,...e){return We(new r(...gc(e)))};class doe extends At{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,inputNodes:n}=this,i=e.getNodeProperties(t);if(i.onceOutput)return i.onceOutput;let a=null;if(t.layout){let s=HF.get(e.constructor);s===void 0&&(s=new WeakMap,HF.set(e.constructor,s));let o=s.get(t);o===void 0&&(o=We(e.buildFunctionNode(t)),s.set(t,o)),e.addInclude(o),a=We(o.call(n))}else{const s=t.jsFunc,o=n!==null||s.length>1?s(n||[],e):s(e);a=We(o)}return t.once&&(i.onceOutput=a),a}getOutputNode(e){const t=e.getNodeProperties(this);return t.outputNode===null&&(t.outputNode=this.setupOutput(e)),t.outputNode}setup(e){return this.getOutputNode(e)}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,t){return this.getOutputNode(e).build(e,t)}}class poe extends At{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}call(e=null){return bm(e),We(new doe(this,e))}setup(){return this.call()}}const goe=[!1,!0],voe=[0,1,2,3],moe=[-1,-2],SV=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],yM=new Map;for(const r of goe)yM.set(r,new ro(r));const _M=new Map;for(const r of voe)_M.set(r,new ro(r,"uint"));const xM=new Map([..._M].map(r=>new ro(r.value,"int")));for(const r of moe)xM.set(r,new ro(r,"int"));const _m=new Map([...xM].map(r=>new ro(r.value)));for(const r of SV)_m.set(r,new ro(r));for(const r of SV)_m.set(-r,new ro(-r));const xm={bool:yM,uint:_M,ints:xM,float:_m},WF=new Map([...yM,..._m]),iS=(r,e)=>WF.has(r)?WF.get(r):r.isNode===!0?r:new ro(r,e),yoe=r=>{try{return r.getNodeType()}catch{return}},Qn=function(r,e=null){return(...t)=>{if((t.length===0||!["bool","float","int","uint"].includes(r)&&t.every(i=>typeof i!="object"))&&(t=[xV(r,...t)]),t.length===1&&e!==null&&e.has(t[0]))return We(e.get(t[0]));if(t.length===1){const i=iS(t[0],r);return yoe(i)===r?We(i):We(new EV(i,r))}const n=t.map(i=>iS(i));return We(new roe(n,r))}},qF=r=>typeof r=="object"&&r!==null?r.value:r,_oe=r=>r!=null?r.nodeType||r.convertTo||(typeof r=="string"?r:null):null;function Ag(r,e){return new Proxy(new poe(r,e),wV)}const We=(r,e=null)=>loe(r,e),bm=(r,e=null)=>new uoe(r,e),gc=(r,e=null)=>new coe(r,e),Ge=(...r)=>new hoe(...r),Qe=(...r)=>new foe(...r);let xoe=0;const qe=(r,e=null)=>{let t=null;e!==null&&(typeof e=="object"?t=e.return:(typeof e=="string"?t=e:console.error("THREE.TSL: Invalid layout type."),e=null));const n=new Ag(r,t),i=(...a)=>{let s;return bm(a),a[0]&&a[0].isNode?s=[...a]:s=a[0],n.call(s)};if(i.shaderNode=n,i.setLayout=a=>(n.setLayout(a),i),i.once=()=>(n.once=!0,i),e!==null){if(typeof e.inputs!="object"){const a={name:"fn"+xoe++,type:t,inputs:[]};for(const s in e)s!=="return"&&a.inputs.push({name:s,type:e[s]});e=a}i.setLayout(e)}return i};De("toGlobal",r=>(r.global=!0,r));const lv=r=>{qc=r},AV=()=>qc,Gn=(...r)=>qc.If(...r);function boe(r){return qc&&qc.add(r),r}De("append",boe);const Eoe=new Qn("color"),Le=new Qn("float",xm.float),Rn=new Qn("int",xm.ints),Toe=new Qn("uint",xm.uint),MV=new Qn("bool",xm.bool),Ze=new Qn("vec2"),Cs=new Qn("ivec2"),woe=new Qn("uvec2"),Soe=new Qn("bvec2"),Fe=new Qn("vec3"),Aoe=new Qn("ivec3"),Moe=new Qn("uvec3"),Coe=new Qn("bvec3"),wt=new Qn("vec4"),Roe=new Qn("ivec4"),Noe=new Qn("uvec4"),Poe=new Qn("bvec4"),bM=new Qn("mat2"),Jr=new Qn("mat3"),vc=new Qn("mat4");De("toColor",Eoe);De("toFloat",Le);De("toInt",Rn);De("toUint",Toe);De("toBool",MV);De("toVec2",Ze);De("toIVec2",Cs);De("toUVec2",woe);De("toBVec2",Soe);De("toVec3",Fe);De("toIVec3",Aoe);De("toUVec3",Moe);De("toBVec3",Coe);De("toVec4",wt);De("toIVec4",Roe);De("toUVec4",Noe);De("toBVec4",Poe);De("toMat2",bM);De("toMat3",Jr);De("toMat4",vc);const Doe=Ge(Ud).setParameterLength(2),Loe=(r,e)=>We(new EV(We(r),e));De("element",Doe);De("convert",Loe);class $F extends zn{static get type(){return"ArrayNode"}constructor(e,t,n=null){super(e),this.count=t,this.values=n,this.isArrayNode=!0}getNodeType(e){return this.nodeType===null&&(this.nodeType=this.values[0].getNodeType(e)),this.nodeType}getElementType(e){return this.getNodeType(e)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const Ioe=(...r)=>{let e;if(r.length===1){const t=r[0];e=new $F(null,t.length,t)}else{const t=r[0],n=r[1];e=new $F(t,n)}return We(e)};De("toArray",(r,e)=>Ioe(Array(e).fill(r)));class CV extends At{static get type(){return"UniformGroupNode"}constructor(e,t=!1,n=1){super("string"),this.name=e,this.shared=t,this.order=n,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const Ooe=r=>new CV(r),EM=(r,e=0)=>new CV(r,!0,e),Foe=EM("frame"),bt=EM("render"),RV=Ooe("object");class kd extends mM{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=RV}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){const n=this.getSelf();return e=e.bind(n),super.onUpdate(i=>{const a=e(i,n);a!==void 0&&(this.value=a)},t)}generate(e,t){const n=this.getNodeType(e),i=this.getUniformHash(e);let a=e.getNodeFromHash(i);a===void 0&&(e.setHashNode(this,i),a=this);const s=a.getInputType(e),o=e.getUniformFromNode(a,s,e.shaderStage,this.name||e.context.label),l=e.getPropertyName(o);return e.context.label!==void 0&&delete e.context.label,e.format(l,n,t)}}const St=(r,e)=>{const t=_oe(e||r),n=r&&r.isNode===!0?r.node&&r.node.value||r.value:r;return We(new kd(n,t))};class rn extends At{static get type(){return"PropertyNode"}constructor(e,t=null,n=!1){super(e),this.name=t,this.varying=n,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const Gd=(r,e)=>We(new rn(r,e)),uv=(r,e)=>We(new rn(r,e,!0)),Qt=Qe(rn,"vec4","DiffuseColor"),XF=Qe(rn,"vec3","EmissiveColor"),Ls=Qe(rn,"float","Roughness"),cv=Qe(rn,"float","Metalness"),aS=Qe(rn,"float","Clearcoat"),hv=Qe(rn,"float","ClearcoatRoughness"),rc=Qe(rn,"vec3","Sheen"),TM=Qe(rn,"float","SheenRoughness"),wM=Qe(rn,"float","Iridescence"),NV=Qe(rn,"float","IridescenceIOR"),PV=Qe(rn,"float","IridescenceThickness"),sS=Qe(rn,"float","AlphaT"),wl=Qe(rn,"float","Anisotropy"),Mg=Qe(rn,"vec3","AnisotropyT"),mc=Qe(rn,"vec3","AnisotropyB"),Oi=Qe(rn,"color","SpecularColor"),fv=Qe(rn,"float","SpecularF90"),oS=Qe(rn,"float","Shininess"),yf=Qe(rn,"vec4","Output"),M1=Qe(rn,"float","dashSize"),YF=Qe(rn,"float","gapSize"),Cg=Qe(rn,"float","IOR"),lS=Qe(rn,"float","Transmission"),DV=Qe(rn,"float","Thickness"),LV=Qe(rn,"float","AttenuationDistance"),IV=Qe(rn,"color","AttenuationColor"),OV=Qe(rn,"float","Dispersion");class Boe extends zn{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const n=e.getTypeLength(t.node.getNodeType(e));return dh.join("").slice(0,n)!==t.components}return!1}generate(e,t){const{targetNode:n,sourceNode:i}=this,a=this.needsSplitAssign(e),s=n.getNodeType(e),o=n.context({assign:!0}).build(e),l=i.build(e,s),u=i.getNodeType(e),c=e.getDataFromNode(this);let h;if(c.initialized===!0)t!=="void"&&(h=o);else if(a){const d=e.getVarFromNode(this,null,s),f=e.getPropertyName(d);e.addLineFlowCode(`${f} = ${l}`,this);const p=n.node.context({assign:!0}).build(e);for(let m=0;m<n.components.length;m++){const v=n.components[m];e.addLineFlowCode(`${p}.${v} = ${f}[ ${m} ]`,this)}t!=="void"&&(h=o)}else h=`${o} = ${l}`,(t==="void"||u==="void")&&(e.addLineFlowCode(h,this),t!=="void"&&(h=o));return c.initialized=!0,e.format(h,s,t)}}const Uoe=Ge(Boe).setParameterLength(2);De("assign",Uoe);class koe extends zn{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],n=this.functionNode,i=n.getInputs(e),a=this.parameters,s=(l,u)=>{const c=u.type,h=c==="pointer";let d;return h?d="&"+l.build(e):d=l.build(e,c),d};if(Array.isArray(a)){if(a.length>i.length)console.error("THREE.TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),a.length=i.length;else if(a.length<i.length)for(console.error("THREE.TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");a.length<i.length;)a.push(Le(0));for(let l=0;l<a.length;l++)t.push(s(a[l],i[l]))}else for(const l of i){const u=a[l.name];u!==void 0?t.push(s(u,l)):(console.error(`THREE.TSL: Input '${l.name}' not found in 'Fn()'.`),t.push(s(Le(0),l)))}return`${n.build(e,"property")}( ${t.join(", ")} )`}}const Goe=(r,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?gc(e):bm(e[0]),We(new koe(We(r),e)));De("call",Goe);class An extends zn{static get type(){return"OperatorNode"}constructor(e,t,n,...i){if(super(),i.length>0){let a=new An(e,t,n);for(let s=0;s<i.length-1;s++)a=new An(e,a,i[s]);t=a,n=i[i.length-1]}this.op=e,this.aNode=t,this.bNode=n,this.isOperatorNode=!0}getNodeType(e,t){const n=this.op,i=this.aNode,a=this.bNode,s=i.getNodeType(e),o=typeof a<"u"?a.getNodeType(e):null;if(s==="void"||o==="void")return"void";if(n==="%")return s;if(n==="~"||n==="&"||n==="|"||n==="^"||n===">>"||n==="<<")return e.getIntegerType(s);if(n==="!"||n==="=="||n==="!="||n==="&&"||n==="||"||n==="^^")return"bool";if(n==="<"||n===">"||n==="<="||n===">="){const l=t?e.getTypeLength(t):Math.max(e.getTypeLength(s),e.getTypeLength(o));return l>1?`bvec${l}`:"bool"}else{if(e.isMatrix(s)){if(o==="float")return s;if(e.isVector(o))return e.getVectorFromMatrix(s);if(e.isMatrix(o))return s}else if(e.isMatrix(o)){if(s==="float")return o;if(e.isVector(s))return e.getVectorFromMatrix(o)}return e.getTypeLength(o)>e.getTypeLength(s)?o:s}}generate(e,t){const n=this.op,i=this.aNode,a=this.bNode,s=this.getNodeType(e,t);let o=null,l=null;s!=="void"?(o=i.getNodeType(e),l=typeof a<"u"?a.getNodeType(e):null,n==="<"||n===">"||n==="<="||n===">="||n==="=="||n==="!="?e.isVector(o)?l=o:o!==l&&(o=l="float"):n===">>"||n==="<<"?(o=s,l=e.changeComponentType(l,"uint")):n==="%"?(o=s,l=e.isInteger(o)&&e.isInteger(l)?l:o):e.isMatrix(o)?l==="float"?l="float":e.isVector(l)?l=e.getVectorFromMatrix(o):e.isMatrix(l)||(o=l=s):e.isMatrix(l)?o==="float"?o="float":e.isVector(o)?o=e.getVectorFromMatrix(l):o=l=s:o=l=s):o=l=s;const u=i.build(e,o),c=typeof a<"u"?a.build(e,l):null,h=e.getTypeLength(t),d=e.getFunctionOperator(n);if(t!=="void"){const f=e.renderer.coordinateSystem===di;if(n==="==")return f?h>1?e.format(`${e.getMethod("equal",t)}( ${u}, ${c} )`,s,t):e.format(`( ${u} ${n} ${c} )`,s,t):h>1||!e.isVector(o)?e.format(`( ${u} == ${c} )`,s,t):e.format(`all( ${u} == ${c} )`,s,t);if(n==="<"&&h>1)return f?e.format(`${e.getMethod("lessThan",t)}( ${u}, ${c} )`,s,t):e.format(`( ${u} < ${c} )`,s,t);if(n==="<="&&h>1)return f?e.format(`${e.getMethod("lessThanEqual",t)}( ${u}, ${c} )`,s,t):e.format(`( ${u} <= ${c} )`,s,t);if(n===">"&&h>1)return f?e.format(`${e.getMethod("greaterThan",t)}( ${u}, ${c} )`,s,t):e.format(`( ${u} > ${c} )`,s,t);if(n===">="&&h>1)return f?e.format(`${e.getMethod("greaterThanEqual",t)}( ${u}, ${c} )`,s,t):e.format(`( ${u} >= ${c} )`,s,t);if(n==="%")return e.isInteger(l)?e.format(`( ${u} % ${c} )`,s,t):e.format(`${e.getMethod("mod",s)}( ${u}, ${c} )`,s,t);if(n==="!"||n==="~")return e.format(`(${n}${u})`,o,t);if(d)return e.format(`${d}( ${u}, ${c} )`,s,t);if(e.isMatrix(o)&&l==="float")return e.format(`( ${c} ${n} ${u} )`,s,t);if(o==="float"&&e.isMatrix(l))return e.format(`${u} ${n} ${c}`,s,t);{let p=`( ${u} ${n} ${c} )`;return!f&&s==="bool"&&e.isVector(o)&&e.isVector(l)&&(p=`all${p}`),e.format(p,s,t)}}else if(o!=="void")return d?e.format(`${d}( ${u}, ${c} )`,s,t):e.isMatrix(o)&&l==="float"?e.format(`${c} ${n} ${u}`,s,t):e.format(`${u} ${n} ${c}`,s,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const ei=Ge(An,"+").setParameterLength(2,1/0).setName("add"),ci=Ge(An,"-").setParameterLength(2,1/0).setName("sub"),Bt=Ge(An,"*").setParameterLength(2,1/0).setName("mul"),Ys=Ge(An,"/").setParameterLength(2,1/0).setName("div"),Em=Ge(An,"%").setParameterLength(2).setName("mod"),FV=Ge(An,"==").setParameterLength(2).setName("equal"),zoe=Ge(An,"!=").setParameterLength(2).setName("notEqual"),Voe=Ge(An,"<").setParameterLength(2).setName("lessThan"),Hoe=Ge(An,">").setParameterLength(2).setName("greaterThan"),Woe=Ge(An,"<=").setParameterLength(2).setName("lessThanEqual"),qoe=Ge(An,">=").setParameterLength(2).setName("greaterThanEqual"),$oe=Ge(An,"&&").setParameterLength(2,1/0).setName("and"),Xoe=Ge(An,"||").setParameterLength(2,1/0).setName("or"),Yoe=Ge(An,"!").setParameterLength(1).setName("not"),joe=Ge(An,"^^").setParameterLength(2).setName("xor"),Koe=Ge(An,"&").setParameterLength(2).setName("bitAnd"),Qoe=Ge(An,"~").setParameterLength(2).setName("bitNot"),Zoe=Ge(An,"|").setParameterLength(2).setName("bitOr"),Joe=Ge(An,"^").setParameterLength(2).setName("bitXor"),ele=Ge(An,"<<").setParameterLength(2).setName("shiftLeft"),tle=Ge(An,">>").setParameterLength(2).setName("shiftRight");De("add",ei);De("sub",ci);De("mul",Bt);De("div",Ys);De("mod",Em);De("equal",FV);De("notEqual",zoe);De("lessThan",Voe);De("greaterThan",Hoe);De("lessThanEqual",Woe);De("greaterThanEqual",qoe);De("and",$oe);De("or",Xoe);De("not",Yoe);De("xor",joe);De("bitAnd",Koe);De("bitNot",Qoe);De("bitOr",Zoe);De("bitXor",Joe);De("shiftLeft",ele);De("shiftRight",tle);const nle=(r,e)=>(console.warn('THREE.TSL: "remainder()" is deprecated. Use "mod( int( ... ) )" instead.'),Em(r,e)),rle=(r,e)=>(console.warn('THREE.TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),Em(Rn(r),Rn(e)));De("remainder",nle);De("modInt",rle);class be extends zn{static get type(){return"MathNode"}constructor(e,t,n=null,i=null){if(super(),(e===be.MAX||e===be.MIN)&&arguments.length>3){let a=new be(e,t,n);for(let s=2;s<arguments.length-1;s++)a=new be(e,a,arguments[s]);t=a,n=arguments[arguments.length-1],i=null}this.method=e,this.aNode=t,this.bNode=n,this.cNode=i,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,i=this.cNode?this.cNode.getNodeType(e):null,a=e.isMatrix(t)?0:e.getTypeLength(t),s=e.isMatrix(n)?0:e.getTypeLength(n),o=e.isMatrix(i)?0:e.getTypeLength(i);return a>s&&a>o?t:s>o?n:o>a?i:t}getNodeType(e){const t=this.method;return t===be.LENGTH||t===be.DISTANCE||t===be.DOT?"float":t===be.CROSS?"vec3":t===be.ALL||t===be.ANY?"bool":t===be.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}generate(e,t){let n=this.method;const i=this.getNodeType(e),a=this.getInputType(e),s=this.aNode,o=this.bNode,l=this.cNode,u=e.renderer.coordinateSystem;if(n===be.TRANSFORM_DIRECTION){let c=s,h=o;e.isMatrix(c.getNodeType(e))?h=wt(Fe(h),0):c=wt(Fe(c),0);const d=Bt(c,h).xyz;return nd(d).build(e,t)}else{if(n===be.NEGATE)return e.format("( - "+s.build(e,a)+" )",i,t);if(n===be.ONE_MINUS)return ci(1,s).build(e,t);if(n===be.RECIPROCAL)return Ys(1,s).build(e,t);if(n===be.DIFFERENCE)return Ji(ci(s,o)).build(e,t);{const c=[];return n===be.CROSS?c.push(s.build(e,i),o.build(e,i)):u===di&&n===be.STEP?c.push(s.build(e,e.getTypeLength(s.getNodeType(e))===1?"float":a),o.build(e,a)):u===di&&(n===be.MIN||n===be.MAX)?c.push(s.build(e,a),o.build(e,e.getTypeLength(o.getNodeType(e))===1?"float":a)):n===be.REFRACT?c.push(s.build(e,a),o.build(e,a),l.build(e,"float")):n===be.MIX?c.push(s.build(e,a),o.build(e,a),l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":a)):(u===$o&&n===be.ATAN&&o!==null&&(n="atan2"),c.push(s.build(e,a)),o!==null&&c.push(o.build(e,a)),l!==null&&c.push(l.build(e,a))),e.format(`${e.getMethod(n,i)}( ${c.join(", ")} )`,i,t)}}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}be.ALL="all";be.ANY="any";be.RADIANS="radians";be.DEGREES="degrees";be.EXP="exp";be.EXP2="exp2";be.LOG="log";be.LOG2="log2";be.SQRT="sqrt";be.INVERSE_SQRT="inversesqrt";be.FLOOR="floor";be.CEIL="ceil";be.NORMALIZE="normalize";be.FRACT="fract";be.SIN="sin";be.COS="cos";be.TAN="tan";be.ASIN="asin";be.ACOS="acos";be.ATAN="atan";be.ABS="abs";be.SIGN="sign";be.LENGTH="length";be.NEGATE="negate";be.ONE_MINUS="oneMinus";be.DFDX="dFdx";be.DFDY="dFdy";be.ROUND="round";be.RECIPROCAL="reciprocal";be.TRUNC="trunc";be.FWIDTH="fwidth";be.TRANSPOSE="transpose";be.BITCAST="bitcast";be.EQUALS="equals";be.MIN="min";be.MAX="max";be.STEP="step";be.REFLECT="reflect";be.DISTANCE="distance";be.DIFFERENCE="difference";be.DOT="dot";be.CROSS="cross";be.POW="pow";be.TRANSFORM_DIRECTION="transformDirection";be.MIX="mix";be.CLAMP="clamp";be.REFRACT="refract";be.SMOOTHSTEP="smoothstep";be.FACEFORWARD="faceforward";const ile=Le(1e-6),ale=Le(Math.PI),sle=Ge(be,be.ALL).setParameterLength(1),ole=Ge(be,be.ANY).setParameterLength(1),lle=Ge(be,be.RADIANS).setParameterLength(1),ule=Ge(be,be.DEGREES).setParameterLength(1),BV=Ge(be,be.EXP).setParameterLength(1),td=Ge(be,be.EXP2).setParameterLength(1),UV=Ge(be,be.LOG).setParameterLength(1),Hs=Ge(be,be.LOG2).setParameterLength(1),SM=Ge(be,be.SQRT).setParameterLength(1),cle=Ge(be,be.INVERSE_SQRT).setParameterLength(1),kl=Ge(be,be.FLOOR).setParameterLength(1),AM=Ge(be,be.CEIL).setParameterLength(1),nd=Ge(be,be.NORMALIZE).setParameterLength(1),tl=Ge(be,be.FRACT).setParameterLength(1),Aa=Ge(be,be.SIN).setParameterLength(1),Eo=Ge(be,be.COS).setParameterLength(1),hle=Ge(be,be.TAN).setParameterLength(1),fle=Ge(be,be.ASIN).setParameterLength(1),dle=Ge(be,be.ACOS).setParameterLength(1),kV=Ge(be,be.ATAN).setParameterLength(1,2),Ji=Ge(be,be.ABS).setParameterLength(1),dv=Ge(be,be.SIGN).setParameterLength(1),Oo=Ge(be,be.LENGTH).setParameterLength(1),ple=Ge(be,be.NEGATE).setParameterLength(1),gle=Ge(be,be.ONE_MINUS).setParameterLength(1),GV=Ge(be,be.DFDX).setParameterLength(1),zV=Ge(be,be.DFDY).setParameterLength(1),vle=Ge(be,be.ROUND).setParameterLength(1),mle=Ge(be,be.RECIPROCAL).setParameterLength(1),yle=Ge(be,be.TRUNC).setParameterLength(1),_le=Ge(be,be.FWIDTH).setParameterLength(1),xle=Ge(be,be.TRANSPOSE).setParameterLength(1),ble=(r,e)=>(console.warn('THREE.TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),FV(r,e)),rd=Ge(be,be.MIN).setParameterLength(2,1/0),Ti=Ge(be,be.MAX).setParameterLength(2,1/0),VV=Ge(be,be.STEP).setParameterLength(2),Ele=Ge(be,be.REFLECT).setParameterLength(2),Tle=Ge(be,be.DISTANCE).setParameterLength(2),wle=Ge(be,be.DIFFERENCE).setParameterLength(2),MM=Ge(be,be.DOT).setParameterLength(2),HV=Ge(be,be.CROSS).setParameterLength(2),Tm=Ge(be,be.POW).setParameterLength(2),WV=Ge(be,be.POW,2).setParameterLength(1),Sle=Ge(be,be.POW,3).setParameterLength(1),Ale=Ge(be,be.POW,4).setParameterLength(1),Mle=Ge(be,be.TRANSFORM_DIRECTION).setParameterLength(2),Cle=r=>Bt(dv(r),Tm(Ji(r),1/3)),qV=r=>MM(r,r),_n=Ge(be,be.MIX).setParameterLength(3),js=(r,e=0,t=1)=>We(new be(be.CLAMP,We(r),We(e),We(t))),Rle=r=>js(r),$V=Ge(be,be.REFRACT).setParameterLength(3),Yo=Ge(be,be.SMOOTHSTEP).setParameterLength(3),Nle=Ge(be,be.FACEFORWARD).setParameterLength(3),Ple=qe(([r])=>{const n=43758.5453,i=MM(r.xy,Ze(12.9898,78.233)),a=Em(i,ale);return tl(Aa(a).mul(n))}),Dle=(r,e,t)=>_n(e,t,r),Lle=(r,e,t)=>Yo(e,t,r),Ile=(r,e)=>(console.warn('THREE.TSL: "atan2" is overloaded. Use "atan" instead.'),kV(r,e));De("all",sle);De("any",ole);De("equals",ble);De("radians",lle);De("degrees",ule);De("exp",BV);De("exp2",td);De("log",UV);De("log2",Hs);De("sqrt",SM);De("inverseSqrt",cle);De("floor",kl);De("ceil",AM);De("normalize",nd);De("fract",tl);De("sin",Aa);De("cos",Eo);De("tan",hle);De("asin",fle);De("acos",dle);De("atan",kV);De("abs",Ji);De("sign",dv);De("length",Oo);De("lengthSq",qV);De("negate",ple);De("oneMinus",gle);De("dFdx",GV);De("dFdy",zV);De("round",vle);De("reciprocal",mle);De("trunc",yle);De("fwidth",_le);De("atan2",Ile);De("min",rd);De("max",Ti);De("step",VV);De("reflect",Ele);De("distance",Tle);De("dot",MM);De("cross",HV);De("pow",Tm);De("pow2",WV);De("pow3",Sle);De("pow4",Ale);De("transformDirection",Mle);De("mix",Dle);De("clamp",js);De("refract",$V);De("smoothstep",Lle);De("faceForward",Nle);De("difference",wle);De("saturate",Rle);De("cbrt",Cle);De("transpose",xle);De("rand",Ple);class Ole extends At{static get type(){return"ConditionalNode"}constructor(e,t,n=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=n}getNodeType(e){const{ifNode:t,elseNode:n}=e.getNodeProperties(this);if(t===void 0)return this.setup(e),this.getNodeType(e);const i=t.getNodeType(e);if(n!==null){const a=n.getNodeType(e);if(e.getTypeLength(a)>e.getTypeLength(i))return a}return i}setup(e){const t=this.condNode.cache(),n=this.ifNode.cache(),i=this.elseNode?this.elseNode.cache():null,a=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=a,i!==null&&(e.getDataFromNode(i).parentNodeBlock=a);const s=e.getNodeProperties(this);s.condNode=t,s.ifNode=n.context({nodeBlock:n}),s.elseNode=i?i.context({nodeBlock:i}):null}generate(e,t){const n=this.getNodeType(e),i=e.getDataFromNode(this);if(i.nodeProperty!==void 0)return i.nodeProperty;const{condNode:a,ifNode:s,elseNode:o}=e.getNodeProperties(this),l=e.currentFunctionNode,u=t!=="void",c=u?Gd(n).build(e):"";i.nodeProperty=c;const h=a.build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${h} ) {

`).addFlowTab();let d=s.build(e,n);if(d&&(u?d=c+" = "+d+";":(d="return "+d+";",l===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),d="// "+d))),e.removeFlowTab().addFlowCode(e.tab+"	"+d+`

`+e.tab+"}"),o!==null){e.addFlowCode(` else {

`).addFlowTab();let f=o.build(e,n);f&&(u?f=c+" = "+f+";":(f="return "+f+";",l===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),f="// "+f))),e.removeFlowTab().addFlowCode(e.tab+"	"+f+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(c,n,t)}}const pi=Ge(Ole).setParameterLength(2,3);De("select",pi);const Fle=(...r)=>(console.warn("THREE.TSL: cond() has been renamed to select()."),pi(...r));De("cond",Fle);class XV extends At{static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){this.node.build(e)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.value});const n=this.node.build(e);return e.setContext(t),n}generate(e,t){const n=e.getContext();e.setContext({...e.context,...this.value});const i=this.node.build(e,t);return e.setContext(n),i}}const CM=Ge(XV).setParameterLength(1,2),Ble=(r,e)=>CM(r,{label:e});De("context",CM);De("label",Ble);class Rg extends At{static get type(){return"VarNode"}constructor(e,t=null,n=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=n}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:n,readOnly:i}=this,{renderer:a}=e,s=a.backend.isWebGPUBackend===!0;let o=!1,l=!1;i&&(o=e.isDeterministic(t),l=s?i:o);const u=e.getVectorType(this.getNodeType(e)),c=t.build(e,u),h=e.getVarFromNode(this,n,u,void 0,l),d=e.getPropertyName(h);let f=d;if(l)if(s)f=o?`const ${d}`:`let ${d}`;else{const p=e.getArrayCount(t);f=`const ${e.getVar(h.type,d,p)}`}return e.addLineFlowCode(`${f} = ${c}`,this),d}}const RM=Ge(Rg),Ule=(r,e=null)=>RM(r,e).append(),kle=(r,e=null)=>RM(r,e,!0).append();De("toVar",Ule);De("toConst",kle);const Gle=r=>(console.warn('TSL: "temp( node )" is deprecated. Use "Var( node )" or "node.toVar()" instead.'),RM(r));De("temp",Gle);class zle extends At{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let n=t.varying;if(n===void 0){const i=this.name,a=this.getNodeType(e);t.varying=n=e.getVaryingFromNode(this,i,a),t.node=this.node}return n.needsInterpolation||(n.needsInterpolation=e.shaderStage==="fragment"),n}setup(e){this.setupVarying(e)}analyze(e){return this.setupVarying(e),this.node.analyze(e)}generate(e){const t=e.getNodeProperties(this),n=this.setupVarying(e),i=e.shaderStage==="fragment"&&t.reassignPosition===!0&&e.context.needsPositionReassign;if(t.propertyName===void 0||i){const a=this.getNodeType(e),s=e.getPropertyName(n,BF.VERTEX);e.flowNodeFromShaderStage(BF.VERTEX,this.node,a,s),t.propertyName=s,i?t.reassignPosition=!1:t.reassignPosition===void 0&&e.context.isPositionNodeInput&&(t.reassignPosition=!0)}return e.getPropertyName(n)}}const za=Ge(zle).setParameterLength(1,2),Vle=r=>za(r);De("toVarying",za);De("toVertexStage",Vle);De("varying",(...r)=>(console.warn("THREE.TSL: .varying() has been renamed to .toVarying()."),za(...r)));De("vertexStage",(...r)=>(console.warn("THREE.TSL: .vertexStage() has been renamed to .toVertexStage()."),za(...r)));const Hle=qe(([r])=>{const e=r.mul(.9478672986).add(.0521327014).pow(2.4),t=r.mul(.0773993808),n=r.lessThanEqual(.04045);return _n(e,t,n)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),Wle=qe(([r])=>{const e=r.pow(.41666).mul(1.055).sub(.055),t=r.mul(12.92),n=r.lessThanEqual(.0031308);return _n(e,t,n)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),zd="WorkingColorSpace",NM="OutputColorSpace";class wm extends zn{static get type(){return"ColorSpaceNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.source=t,this.target=n}resolveColorSpace(e,t){return t===zd?Dt.workingColorSpace:t===NM?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,n=this.resolveColorSpace(e,this.source),i=this.resolveColorSpace(e,this.target);let a=t;return Dt.enabled===!1||n===i||!n||!i||(Dt.getTransfer(n)===en&&(a=wt(Hle(a.rgb),a.a)),Dt.getPrimaries(n)!==Dt.getPrimaries(i)&&(a=wt(Jr(Dt._getMatrix(new Et,n,i)).mul(a.rgb),a.a)),Dt.getTransfer(i)===en&&(a=wt(Wle(a.rgb),a.a))),a}}const qle=r=>We(new wm(We(r),zd,NM)),$le=r=>We(new wm(We(r),NM,zd)),Xle=(r,e)=>We(new wm(We(r),zd,e)),PM=(r,e)=>We(new wm(We(r),e,zd));De("toOutputColorSpace",qle);De("toWorkingColorSpace",$le);De("workingToColorSpace",Xle);De("colorSpaceToWorking",PM);let Yle=class extends Ud{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,n,i)}};class YV extends At{static get type(){return"ReferenceBaseNode"}constructor(e,t,n=null,i=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=i,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=Lt.OBJECT}setGroup(e){return this.group=e,this}element(e){return We(new Yle(this,We(e)))}setNodeType(e){const t=St(null,e).getSelf();this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let i=1;i<t.length;i++)n=n[t[i]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const jle=(r,e,t)=>We(new YV(r,e,t));class Kle extends YV{static get type(){return"RendererReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.renderer=n,this.setGroup(bt)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const Qle=(r,e,t=null)=>We(new Kle(r,e,t));class Zle extends zn{static get type(){return"ToneMappingNode"}constructor(e,t=eue,n=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=n}customCacheKey(){return ed(this.toneMapping)}setup(e){const t=this.colorNode||e.context.color,n=this.toneMapping;if(n===xi)return t;let i=null;const a=e.renderer.library.getToneMappingFunction(n);return a!==null?i=wt(a(t.rgb,this.exposureNode),t.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",n),i=t),i}}const Jle=(r,e,t)=>We(new Zle(r,We(e),We(t))),eue=Qle("toneMappingExposure","float");De("toneMapping",(r,e,t)=>Jle(e,t,r));class tue extends mM{static get type(){return"BufferAttributeNode"}constructor(e,t=null,n=0,i=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=n,this.bufferOffset=i,this.usage=ev,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),n=this.value,i=e.getTypeLength(t),a=this.bufferStride||i,s=this.bufferOffset,o=n.isInterleavedBuffer===!0?n:new gz(n,a),l=new ZA(o,i,s);o.setUsage(this.usage),this.attribute=l,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,t),i=e.getPropertyName(n);let a=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=i,a=i):a=za(this).build(e,t),a}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const DM=(r,e=null,t=0,n=0)=>We(new tue(r,e,t,n)),nue=(r,e=null,t=0,n=0)=>DM(r,e,t,n).setUsage(Ju),jF=(r,e=null,t=0,n=0)=>DM(r,e,t,n).setInstanced(!0),KF=(r,e=null,t=0,n=0)=>nue(r,e,t,n).setInstanced(!0);De("toAttribute",r=>DM(r.value));class rue extends At{static get type(){return"ComputeNode"}constructor(e,t,n=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=n,this.dispatchCount=0,this.version=1,this.name="",this.updateBeforeType=Lt.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}label(e){return this.name=e,this}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let n=t[0];for(let i=1;i<t.length;i++)n*=t[i];this.dispatchCount=Math.ceil(e/n)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.setup(e);if(t){const n=e.getNodeProperties(this);n.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:n}=e;if(n==="compute"){const i=this.computeNode.build(e,"void");i!==""&&e.addLineFlowCode(i,this)}else{const a=e.getNodeProperties(this).outputComputeNode;if(a)return a.build(e,t)}}}const iue=(r,e,t)=>We(new rue(We(r),e,t));De("compute",iue);class aue extends At{static get type(){return"CacheNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isCacheNode=!0}getNodeType(e){const t=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);const i=this.node.getNodeType(e);return e.setCache(t),i}build(e,...t){const n=e.getCache(),i=e.getCacheFromNode(this,this.parent);e.setCache(i);const a=this.node.build(e,...t);return e.setCache(n),a}}const Ng=(r,e)=>We(new aue(We(r),e));De("cache",Ng);class sue extends At{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const oue=Ge(sue).setParameterLength(2);De("bypass",oue);class jV extends At{static get type(){return"RemapNode"}constructor(e,t,n,i=Le(0),a=Le(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=n,this.outLowNode=i,this.outHighNode=a,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:n,outLowNode:i,outHighNode:a,doClamp:s}=this;let o=e.sub(t).div(n.sub(t));return s===!0&&(o=o.clamp()),o.mul(a.sub(i)).add(i)}}const lue=Ge(jV,null,null,{doClamp:!1}).setParameterLength(3,5),uue=Ge(jV).setParameterLength(3,5);De("remap",lue);De("remapClamp",uue);class Pg extends At{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const n=this.getNodeType(e),i=this.snippet;if(n==="void")e.addLineFlowCode(i,this);else return e.format(i,n,t)}}const id=Ge(Pg).setParameterLength(1,2),cue=r=>(r?pi(r,id("discard")):id("discard")).append();De("discard",cue);class hue extends zn{static get type(){return"RenderOutputNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.toneMapping=t,this.outputColorSpace=n,this.isRenderOutputNode=!0}setup({context:e}){let t=this.colorNode||e.color;const n=(this.toneMapping!==null?this.toneMapping:e.toneMapping)||xi,i=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||Bi;return n!==xi&&(t=t.toneMapping(n)),i!==Bi&&i!==Dt.workingColorSpace&&(t=t.workingToColorSpace(i)),t}}const fue=(r,e=null,t=null)=>We(new hue(We(r),e,t));De("renderOutput",fue);class due extends zn{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,n=this.node.build(e);let i="";return i+=`// #--- TSL Debug ---#
`,i+=e.flow.code.replace(/^\t/mg,"")+`
`,i+="/* ... */ "+n+` /* ... */
`,i+=`// #-----------------#
`,t!==null?t(i):console.log(i),n}}const pue=(r,e=null)=>We(new due(We(r),e));De("debug",pue);class gue extends At{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){const i=e.geometry.getAttribute(n);t=e.getTypeFromAttribute(i)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),n=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const a=e.geometry.getAttribute(t),s=e.getTypeFromAttribute(a),o=e.getAttribute(t,s);return e.shaderStage==="vertex"?e.format(o.name,s,n):za(this).build(e,n)}else return console.warn(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const Ks=(r,e)=>We(new gue(r,e)),Vd=(r=0)=>Ks("uv"+(r>0?r:""),"vec2");class vue extends At{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const n=this.textureNode.build(e,"property"),i=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${n}, ${i} )`,this.getNodeType(e),t)}}const _f=Ge(vue).setParameterLength(1,2);class mue extends kd{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=Lt.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,n=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(n&&n.width!==void 0){const{width:i,height:a}=n;this.value=Math.log2(Math.max(i,a))}}}const yue=Ge(mue).setParameterLength(1);class Hd extends kd{static get type(){return"TextureNode"}constructor(e,t=null,n=null,i=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=n,this.biasNode=i,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Lt.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===hn?"uvec4":this.value.type===mr?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return Vd(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=St(this.value.matrix)),this._matrixUniform.mul(Fe(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?Lt.RENDER:Lt.NONE,this}setupUV(e,t){const n=this.value;return e.isFlipY()&&(n.image instanceof ImageBitmap&&n.flipY===!0||n.isRenderTargetTexture===!0||n.isFramebufferTexture===!0||n.isDepthTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(Rn(_f(this,this.levelNode).y).sub(t.y).sub(1))),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const n=this.value;if(!n||n.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let i=this.uvNode;(i===null||e.context.forceUVContext===!0)&&e.context.getUV&&(i=e.context.getUV(this)),i||(i=this.getDefaultUV()),this.updateMatrix===!0&&(i=this.getTransformedUV(i)),i=this.setupUV(e,i);let a=this.levelNode;a===null&&e.context.getTextureLevel&&(a=e.context.getTextureLevel(this)),t.uvNode=i,t.levelNode=a,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,t,n,i,a,s,o,l){const u=this.value;let c;return i?c=e.generateTextureLevel(u,t,n,i,s):a?c=e.generateTextureBias(u,t,n,a,s):l?c=e.generateTextureGrad(u,t,n,l,s):o?c=e.generateTextureCompare(u,t,n,o,s):this.sampler===!1?c=e.generateTextureLoad(u,t,n,s):c=e.generateTexture(u,t,n,s),c}generate(e,t){const n=this.value,i=e.getNodeProperties(this),a=super.generate(e,"property");if(/^sampler/.test(t))return a+"_sampler";if(e.isReference(t))return a;{const s=e.getDataFromNode(this);let o=s.propertyName;if(o===void 0){const{uvNode:c,levelNode:h,biasNode:d,compareNode:f,depthNode:p,gradNode:m}=i,v=this.generateUV(e,c),g=h?h.build(e,"float"):null,y=d?d.build(e,"float"):null,_=p?p.build(e,"int"):null,x=f?f.build(e,"float"):null,E=m?[m[0].build(e,"vec2"),m[1].build(e,"vec2")]:null,T=e.getVarFromNode(this);o=e.getPropertyName(T);const b=this.generateSnippet(e,a,v,g,y,_,x,E);e.addLineFlowCode(`${o} = ${b}`,this),s.snippet=b,s.propertyName=o}let l=o;const u=this.getNodeType(e);return e.needsToWorkingColorSpace(n)&&(l=PM(id(l,u),n.colorSpace).setup(e).build(e,u)),e.format(l,u,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return console.warn("THREE.TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=We(e),t.referenceNode=this.getSelf(),We(t)}blur(e){const t=this.clone();t.biasNode=We(e).mul(yue(t)),t.referenceNode=this.getSelf();const n=t.value;return(n&&n.generateMipmaps===!1||n.minFilter===mn||n.magFilter===mn)&&(console.warn("THREE.TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),We(t)}level(e){const t=this.clone();return t.levelNode=We(e),t.referenceNode=this.getSelf(),We(t)}size(e){return _f(this,e)}bias(e){const t=this.clone();return t.biasNode=We(e),t.referenceNode=this.getSelf(),We(t)}compare(e){const t=this.clone();return t.compareNode=We(e),t.referenceNode=this.getSelf(),We(t)}grad(e,t){const n=this.clone();return n.gradNode=[We(e),We(t)],n.referenceNode=this.getSelf(),We(n)}depth(e){const t=this.clone();return t.depthNode=We(e),t.referenceNode=this.getSelf(),We(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e}}const qt=Ge(Hd).setParameterLength(1,4),Ea=(...r)=>qt(...r).setSampler(!1);class KV extends kd{static get type(){return"BufferNode"}constructor(e,t,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=n}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const QV=(r,e,t)=>We(new KV(r,e,t));class _ue extends Ud{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),n=this.getNodeType(),i=this.node.getPaddedType();return e.format(t,i,n)}}class xue extends KV{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?ov(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=Lt.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,n=this.elementType;if(n==="float"||n==="int"||n==="uint")for(let i=0;i<e.length;i++){const a=i*4;t[a]=e[i]}else if(n==="color")for(let i=0;i<e.length;i++){const a=i*4,s=e[i];t[a]=s.r,t[a+1]=s.g,t[a+2]=s.b||0}else if(n==="mat2")for(let i=0;i<e.length;i++){const a=i*4,s=e[i];t[a]=s.elements[0],t[a+1]=s.elements[1],t[a+2]=s.elements[2],t[a+3]=s.elements[3]}else if(n==="mat3")for(let i=0;i<e.length;i++){const a=i*16,s=e[i];t[a]=s.elements[0],t[a+1]=s.elements[1],t[a+2]=s.elements[2],t[a+4]=s.elements[3],t[a+5]=s.elements[4],t[a+6]=s.elements[5],t[a+8]=s.elements[6],t[a+9]=s.elements[7],t[a+10]=s.elements[8],t[a+15]=1}else if(n==="mat4")for(let i=0;i<e.length;i++){const a=i*16,s=e[i];for(let o=0;o<s.elements.length;o++)t[a+o]=s.elements[o]}else for(let i=0;i<e.length;i++){const a=i*4,s=e[i];t[a]=s.x,t[a+1]=s.y,t[a+2]=s.z||0,t[a+3]=s.w||0}}setup(e){const t=this.array.length,n=this.elementType;let i=Float32Array;const a=this.paddedType,s=e.getTypeLength(a);return n.charAt(0)==="i"&&(i=Int32Array),n.charAt(0)==="u"&&(i=Uint32Array),this.value=new i(t*s),this.bufferCount=t,this.bufferType=a,super.setup(e)}element(e){return We(new _ue(this,We(e)))}}const Ja=(r,e)=>We(new xue(r,e)),ZV=St(0,"uint").setGroup(EM("cameraIndex")).toVarying("v_cameraIndex"),Rl=St("float").label("cameraNear").setGroup(bt).onRenderUpdate(({camera:r})=>r.near),Nl=St("float").label("cameraFar").setGroup(bt).onRenderUpdate(({camera:r})=>r.far),LM=qe(({camera:r})=>{let e;if(r.isArrayCamera&&r.cameras.length>0){const t=[];for(const i of r.cameras)t.push(i.projectionMatrix);e=Ja(t).setGroup(bt).label("cameraProjectionMatrices").element(ZV).toVar("cameraProjectionMatrix")}else e=St("mat4").label("cameraProjectionMatrix").setGroup(bt).onRenderUpdate(({camera:t})=>t.projectionMatrix);return e}).once()(),io=qe(({camera:r})=>{let e;if(r.isArrayCamera&&r.cameras.length>0){const t=[];for(const i of r.cameras)t.push(i.matrixWorldInverse);e=Ja(t).setGroup(bt).label("cameraViewMatrices").element(ZV).toVar("cameraViewMatrix")}else e=St("mat4").label("cameraViewMatrix").setGroup(bt).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()(),bue=St(new re).label("cameraPosition").setGroup(bt).onRenderUpdate(({camera:r},e)=>e.value.setFromMatrixPosition(r.matrixWorld)),QF=new Dd;class sn extends At{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=Lt.OBJECT,this._uniformNode=new kd(null)}getNodeType(){const e=this.scope;if(e===sn.WORLD_MATRIX)return"mat4";if(e===sn.POSITION||e===sn.VIEW_POSITION||e===sn.DIRECTION||e===sn.SCALE)return"vec3";if(e===sn.RADIUS)return"float"}update(e){const t=this.object3d,n=this._uniformNode,i=this.scope;if(i===sn.WORLD_MATRIX)n.value=t.matrixWorld;else if(i===sn.POSITION)n.value=n.value||new re,n.value.setFromMatrixPosition(t.matrixWorld);else if(i===sn.SCALE)n.value=n.value||new re,n.value.setFromMatrixScale(t.matrixWorld);else if(i===sn.DIRECTION)n.value=n.value||new re,t.getWorldDirection(n.value);else if(i===sn.VIEW_POSITION){const a=e.camera;n.value=n.value||new re,n.value.setFromMatrixPosition(t.matrixWorld),n.value.applyMatrix4(a.matrixWorldInverse)}else if(i===sn.RADIUS){const a=e.object.geometry;a.boundingSphere===null&&a.computeBoundingSphere(),QF.copy(a.boundingSphere).applyMatrix4(t.matrixWorld),n.value=QF.radius}}generate(e){const t=this.scope;return t===sn.WORLD_MATRIX?this._uniformNode.nodeType="mat4":t===sn.POSITION||t===sn.VIEW_POSITION||t===sn.DIRECTION||t===sn.SCALE?this._uniformNode.nodeType="vec3":t===sn.RADIUS&&(this._uniformNode.nodeType="float"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}sn.WORLD_MATRIX="worldMatrix";sn.POSITION="position";sn.SCALE="scale";sn.VIEW_POSITION="viewPosition";sn.DIRECTION="direction";sn.RADIUS="radius";const Eue=Ge(sn,sn.POSITION).setParameterLength(1);class ca extends sn{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}ca.DIRECTION;const Jl=Qe(ca,ca.WORLD_MATRIX);ca.POSITION;ca.SCALE;ca.VIEW_POSITION;ca.RADIUS;const Tue=St(new Et).onObjectUpdate(({object:r},e)=>e.value.getNormalMatrix(r.matrixWorld)),Sm=qe(r=>r.renderer.nodes.modelViewMatrix||wue).once()().toVar("modelViewMatrix"),wue=io.mul(Jl),Am=Ks("position","vec3"),Ur=Am.toVarying("positionLocal"),ZF=Am.toVarying("positionPrevious"),ad=Jl.mul(Ur).xyz.toVarying("v_positionWorld").context({needsPositionReassign:!0}),JV=Ur.transformDirection(Jl).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection").context({needsPositionReassign:!0}),Xn=qe(r=>r.context.setupPositionView(),"vec3").once()().toVarying("v_positionView").context({needsPositionReassign:!0}),Cn=Xn.negate().toVarying("v_positionViewDirection").normalize().toVar("positionViewDirection");class Sue extends At{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:t,material:n}=e;return t.coordinateSystem===di&&n.side===dn?"false":e.getFrontFacing()}}const Aue=Qe(Sue),Mm=Le(Aue).mul(2).sub(1),e4=Ks("normal","vec3"),os=qe(r=>r.geometry.hasAttribute("normal")===!1?(console.warn('THREE.TSL: Vertex attribute "normal" not found on geometry.'),Fe(0,1,0)):e4,"vec3").once()().toVar("normalLocal"),Mue=Xn.dFdx().cross(Xn.dFdy()).normalize().toVar("normalFlat"),ka=qe(r=>{let e;return r.material.flatShading===!0?e=Mue:e=za(n4(os),"v_normalView").normalize(),e},"vec3").once()().toVar("normalView"),t4=za(ka.transformDirection(io),"v_normalWorld").normalize().toVar("normalWorld"),qn=qe(r=>r.context.setupNormal().context({getUV:null}),"vec3").once()().mul(Mm).toVar("transformedNormalView"),IM=qn.transformDirection(io).toVar("transformedNormalWorld"),af=qe(r=>r.context.setupClearcoatNormal().context({getUV:null}),"vec3").once()().mul(Mm).toVar("transformedClearcoatNormalView"),Cue=qe(([r,e=Jl])=>{const t=Jr(e),n=r.div(Fe(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(n).xyz}),n4=qe(([r],e)=>{const t=e.renderer.nodes.modelNormalViewMatrix;if(t!==null)return t.transformDirection(r);const n=Tue.mul(r);return io.transformDirection(n)}),JF=new Ei,C1=new Ut,Rue=St(0).onReference(({material:r})=>r).onObjectUpdate(({material:r})=>r.refractionRatio),R1=St(1).onReference(({material:r})=>r).onObjectUpdate(function({material:r,scene:e}){return r.envMap?r.envMapIntensity:e.environmentIntensity}),r4=St(new Ut).onReference(function(r){return r.material}).onObjectUpdate(function({material:r,scene:e}){const t=e.environment!==null&&r.envMap===null?e.environmentRotation:r.envMapRotation;return t?(JF.copy(t),C1.makeRotationFromEuler(JF)):C1.identity(),C1}),Nue=Cn.negate().reflect(qn),Pue=Cn.negate().refract(qn,Rue),Due=Nue.transformDirection(io).toVar("reflectVector"),Lue=Pue.transformDirection(io).toVar("reflectVector");class Iue extends Hd{static get type(){return"CubeTextureNode"}constructor(e,t=null,n=null,i=null){super(e,t,n,i),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===la?Due:e.mapping===ua?Lue:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),Fe(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return(e.renderer.coordinateSystem===$o||!n.isRenderTargetTexture)&&(t=Fe(t.x.negate(),t.yz)),r4.mul(t)}generateUV(e,t){return t.build(e,"vec3")}}const sd=Ge(Iue).setParameterLength(1,4).setName("cubeTexture");class Oue extends Ud{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,n,i)}}class OM extends At{static get type(){return"ReferenceNode"}constructor(e,t,n=null,i=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=i,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=Lt.OBJECT}element(e){return We(new Oue(this,We(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let t=null;this.count!==null?t=QV(null,e,this.count):Array.isArray(this.getValueFromReference())?t=Ja(null,e):e==="texture"?t=qt(null):e==="cubeTexture"?t=sd(null):t=St(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.label(this.name),this.node=t.getSelf()}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let i=1;i<t.length;i++)n=n[t[i]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const cn=(r,e,t)=>We(new OM(r,e,t)),eB=(r,e,t,n)=>We(new OM(r,e,n,t));class Fue extends OM{static get type(){return"MaterialReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const To=(r,e,t=null)=>We(new Fue(r,e,t)),i4=qe(r=>(r.geometry.hasAttribute("tangent")===!1&&r.geometry.computeTangents(),Ks("tangent","vec4")))(),FM=i4.xyz.toVar("tangentLocal"),a4=Sm.mul(wt(FM,0)).xyz.toVarying("v_tangentView").normalize().toVar("tangentView"),Bue=r=>r.mul(i4.w).xyz,Uue=za(Bue(ka.cross(a4)),"v_bitangentView").normalize().toVar("bitangentView"),sf=Jr(a4,Uue,ka),kue=(()=>{let r=mc.cross(Cn);return r=r.cross(mc).normalize(),r=_n(r,qn,wl.mul(Ls.oneMinus()).oneMinus().pow2().pow2()).normalize(),r})(),Gue=qe(r=>{const{eye_pos:e,surf_norm:t,mapN:n,uv:i}=r,a=e.dFdx(),s=e.dFdy(),o=i.dFdx(),l=i.dFdy(),u=t,c=s.cross(u),h=u.cross(a),d=c.mul(o.x).add(h.mul(l.x)),f=c.mul(o.y).add(h.mul(l.y)),p=d.dot(d).max(f.dot(f)),m=Mm.mul(p.inverseSqrt());return ei(d.mul(n.x,m),f.mul(n.y,m),u.mul(n.z)).normalize()});class zue extends zn{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=Xs}setup(e){const{normalMapType:t,scaleNode:n}=this;let i=this.node.mul(2).sub(1);n!==null&&(i=Fe(i.xy.mul(n),i.z));let a=null;return t===oz?a=n4(i):t===Xs&&(e.hasGeometryAttribute("tangent")===!0?a=sf.mul(i).normalize():a=Gue({eye_pos:Xn,surf_norm:ka,mapN:i,uv:Vd()})),a}}const tB=Ge(zue).setParameterLength(1,2),Vue=qe(({textureNode:r,bumpScale:e})=>{const t=i=>r.cache().context({getUV:a=>i(a.uvNode||Vd()),forceUVContext:!0}),n=Le(t(i=>i));return Ze(Le(t(i=>i.add(i.dFdx()))).sub(n),Le(t(i=>i.add(i.dFdy()))).sub(n)).mul(e)}),Hue=qe(r=>{const{surf_pos:e,surf_norm:t,dHdxy:n}=r,i=e.dFdx().normalize(),a=e.dFdy().normalize(),s=t,o=a.cross(s),l=s.cross(i),u=i.dot(o).mul(Mm),c=u.sign().mul(n.x.mul(o).add(n.y.mul(l)));return u.abs().mul(t).sub(c).normalize()});class Wue extends zn{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=Vue({textureNode:this.textureNode,bumpScale:e});return Hue({surf_pos:Xn,surf_norm:ka,dHdxy:t})}}const que=Ge(Wue).setParameterLength(1,2),nB=new Map;class Pe extends At{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let n=nB.get(e);return n===void 0&&(n=To(e,t),nB.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,n=this.scope;let i=null;if(n===Pe.COLOR){const a=t.color!==void 0?this.getColor(n):Fe();t.map&&t.map.isTexture===!0?i=a.mul(this.getTexture("map")):i=a}else if(n===Pe.OPACITY){const a=this.getFloat(n);t.alphaMap&&t.alphaMap.isTexture===!0?i=a.mul(this.getTexture("alpha")):i=a}else if(n===Pe.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?i=this.getTexture("specular").r:i=Le(1);else if(n===Pe.SPECULAR_INTENSITY){const a=this.getFloat(n);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?i=a.mul(this.getTexture(n).a):i=a}else if(n===Pe.SPECULAR_COLOR){const a=this.getColor(n);t.specularColorMap&&t.specularColorMap.isTexture===!0?i=a.mul(this.getTexture(n).rgb):i=a}else if(n===Pe.ROUGHNESS){const a=this.getFloat(n);t.roughnessMap&&t.roughnessMap.isTexture===!0?i=a.mul(this.getTexture(n).g):i=a}else if(n===Pe.METALNESS){const a=this.getFloat(n);t.metalnessMap&&t.metalnessMap.isTexture===!0?i=a.mul(this.getTexture(n).b):i=a}else if(n===Pe.EMISSIVE){const a=this.getFloat("emissiveIntensity"),s=this.getColor(n).mul(a);t.emissiveMap&&t.emissiveMap.isTexture===!0?i=s.mul(this.getTexture(n)):i=s}else if(n===Pe.NORMAL)t.normalMap?(i=tB(this.getTexture("normal"),this.getCache("normalScale","vec2")),i.normalMapType=t.normalMapType):t.bumpMap?i=que(this.getTexture("bump").r,this.getFloat("bumpScale")):i=ka;else if(n===Pe.CLEARCOAT){const a=this.getFloat(n);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?i=a.mul(this.getTexture(n).r):i=a}else if(n===Pe.CLEARCOAT_ROUGHNESS){const a=this.getFloat(n);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?i=a.mul(this.getTexture(n).r):i=a}else if(n===Pe.CLEARCOAT_NORMAL)t.clearcoatNormalMap?i=tB(this.getTexture(n),this.getCache(n+"Scale","vec2")):i=ka;else if(n===Pe.SHEEN){const a=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?i=a.mul(this.getTexture("sheenColor").rgb):i=a}else if(n===Pe.SHEEN_ROUGHNESS){const a=this.getFloat(n);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?i=a.mul(this.getTexture(n).a):i=a,i=i.clamp(.07,1)}else if(n===Pe.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const a=this.getTexture(n);i=bM(Fh.x,Fh.y,Fh.y.negate(),Fh.x).mul(a.rg.mul(2).sub(Ze(1)).normalize().mul(a.b))}else i=Fh;else if(n===Pe.IRIDESCENCE_THICKNESS){const a=cn("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const s=cn("0","float",t.iridescenceThicknessRange);i=a.sub(s).mul(this.getTexture(n).g).add(s)}else i=a}else if(n===Pe.TRANSMISSION){const a=this.getFloat(n);t.transmissionMap?i=a.mul(this.getTexture(n).r):i=a}else if(n===Pe.THICKNESS){const a=this.getFloat(n);t.thicknessMap?i=a.mul(this.getTexture(n).g):i=a}else if(n===Pe.IOR)i=this.getFloat(n);else if(n===Pe.LIGHT_MAP)i=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===Pe.AO)i=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else{const a=this.getNodeType(e);i=this.getCache(n,a)}return i}}Pe.ALPHA_TEST="alphaTest";Pe.COLOR="color";Pe.OPACITY="opacity";Pe.SHININESS="shininess";Pe.SPECULAR="specular";Pe.SPECULAR_STRENGTH="specularStrength";Pe.SPECULAR_INTENSITY="specularIntensity";Pe.SPECULAR_COLOR="specularColor";Pe.REFLECTIVITY="reflectivity";Pe.ROUGHNESS="roughness";Pe.METALNESS="metalness";Pe.NORMAL="normal";Pe.CLEARCOAT="clearcoat";Pe.CLEARCOAT_ROUGHNESS="clearcoatRoughness";Pe.CLEARCOAT_NORMAL="clearcoatNormal";Pe.EMISSIVE="emissive";Pe.ROTATION="rotation";Pe.SHEEN="sheen";Pe.SHEEN_ROUGHNESS="sheenRoughness";Pe.ANISOTROPY="anisotropy";Pe.IRIDESCENCE="iridescence";Pe.IRIDESCENCE_IOR="iridescenceIOR";Pe.IRIDESCENCE_THICKNESS="iridescenceThickness";Pe.IOR="ior";Pe.TRANSMISSION="transmission";Pe.THICKNESS="thickness";Pe.ATTENUATION_DISTANCE="attenuationDistance";Pe.ATTENUATION_COLOR="attenuationColor";Pe.LINE_SCALE="scale";Pe.LINE_DASH_SIZE="dashSize";Pe.LINE_GAP_SIZE="gapSize";Pe.LINE_WIDTH="linewidth";Pe.LINE_DASH_OFFSET="dashOffset";Pe.POINT_SIZE="size";Pe.DISPERSION="dispersion";Pe.LIGHT_MAP="light";Pe.AO="ao";const $ue=Qe(Pe,Pe.ALPHA_TEST),Xue=Qe(Pe,Pe.COLOR),Yue=Qe(Pe,Pe.SHININESS),jue=Qe(Pe,Pe.EMISSIVE),s4=Qe(Pe,Pe.OPACITY),Kue=Qe(Pe,Pe.SPECULAR),rB=Qe(Pe,Pe.SPECULAR_INTENSITY),Que=Qe(Pe,Pe.SPECULAR_COLOR),Dg=Qe(Pe,Pe.SPECULAR_STRENGTH),N1=Qe(Pe,Pe.REFLECTIVITY),Zue=Qe(Pe,Pe.ROUGHNESS),Jue=Qe(Pe,Pe.METALNESS),ece=Qe(Pe,Pe.NORMAL),tce=Qe(Pe,Pe.CLEARCOAT),nce=Qe(Pe,Pe.CLEARCOAT_ROUGHNESS),rce=Qe(Pe,Pe.CLEARCOAT_NORMAL),ice=Qe(Pe,Pe.ROTATION),ace=Qe(Pe,Pe.SHEEN),sce=Qe(Pe,Pe.SHEEN_ROUGHNESS),oce=Qe(Pe,Pe.ANISOTROPY),lce=Qe(Pe,Pe.IRIDESCENCE),uce=Qe(Pe,Pe.IRIDESCENCE_IOR),cce=Qe(Pe,Pe.IRIDESCENCE_THICKNESS),hce=Qe(Pe,Pe.TRANSMISSION),fce=Qe(Pe,Pe.THICKNESS),dce=Qe(Pe,Pe.IOR),pce=Qe(Pe,Pe.ATTENUATION_DISTANCE),gce=Qe(Pe,Pe.ATTENUATION_COLOR),vce=Qe(Pe,Pe.LINE_SCALE),mce=Qe(Pe,Pe.LINE_DASH_SIZE),yce=Qe(Pe,Pe.LINE_GAP_SIZE);Pe.LINE_WIDTH;const _ce=Qe(Pe,Pe.LINE_DASH_OFFSET),xce=Qe(Pe,Pe.POINT_SIZE),bce=Qe(Pe,Pe.DISPERSION),o4=Qe(Pe,Pe.LIGHT_MAP),Ece=Qe(Pe,Pe.AO),Fh=St(new He).onReference(function(r){return r.material}).onRenderUpdate(function({material:r}){this.value.set(r.anisotropy*Math.cos(r.anisotropyRotation),r.anisotropy*Math.sin(r.anisotropyRotation))}),l4=qe(r=>r.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class xn extends At{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),n=this.scope;let i;if(n===xn.VERTEX)i=e.getVertexIndex();else if(n===xn.INSTANCE)i=e.getInstanceIndex();else if(n===xn.DRAW)i=e.getDrawIndex();else if(n===xn.INVOCATION_LOCAL)i=e.getInvocationLocalIndex();else if(n===xn.INVOCATION_SUBGROUP)i=e.getInvocationSubgroupIndex();else if(n===xn.SUBGROUP)i=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+n);let a;return e.shaderStage==="vertex"||e.shaderStage==="compute"?a=i:a=za(this).build(e,t),a}}xn.VERTEX="vertex";xn.INSTANCE="instance";xn.SUBGROUP="subgroup";xn.INVOCATION_LOCAL="invocationLocal";xn.INVOCATION_SUBGROUP="invocationSubgroup";xn.DRAW="draw";const Tce=Qe(xn,xn.VERTEX),BM=Qe(xn,xn.INSTANCE);xn.SUBGROUP;xn.INVOCATION_SUBGROUP;xn.INVOCATION_LOCAL;const wce=Qe(xn,xn.DRAW);class Sce extends At{static get type(){return"InstanceNode"}constructor(e,t,n){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=Lt.FRAME,this.buffer=null,this.bufferColor=null}setup(e){const{count:t,instanceMatrix:n,instanceColor:i}=this;let{instanceMatrixNode:a,instanceColorNode:s}=this;if(a===null){if(t<=1e3)a=QV(n.array,"mat4",Math.max(t,1)).element(BM);else{const l=new fJ(n.array,16,1);this.buffer=l;const u=n.usage===Ju?KF:jF,c=[u(l,"vec4",16,0),u(l,"vec4",16,4),u(l,"vec4",16,8),u(l,"vec4",16,12)];a=vc(...c)}this.instanceMatrixNode=a}if(i&&s===null){const l=new wZ(i.array,3),u=i.usage===Ju?KF:jF;this.bufferColor=l,s=Fe(u(l,"vec3",3,0)),this.instanceColorNode=s}const o=a.mul(Ur).xyz;if(Ur.assign(o),e.hasGeometryAttribute("normal")){const l=Cue(os,a);os.assign(l)}this.instanceColorNode!==null&&uv("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMatrix.usage!==Ju&&this.buffer!==null&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version),this.instanceColor&&this.instanceColor.usage!==Ju&&this.bufferColor!==null&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)}}class Ace extends Sce{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:n,instanceColor:i}=e;super(t,n,i),this.instancedMesh=e}}const Mce=Ge(Ace).setParameterLength(1);class Cce extends At{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=BM:this.batchingIdNode=wce);const n=qe(([p])=>{const m=Rn(_f(Ea(this.batchMesh._indirectTexture),0).x),v=Rn(p).mod(m),g=Rn(p).div(m);return Ea(this.batchMesh._indirectTexture,Cs(v,g)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(Rn(this.batchingIdNode)),i=this.batchMesh._matricesTexture,a=Rn(_f(Ea(i),0).x),s=Le(n).mul(4).toInt().toVar(),o=s.mod(a),l=s.div(a),u=vc(Ea(i,Cs(o,l)),Ea(i,Cs(o.add(1),l)),Ea(i,Cs(o.add(2),l)),Ea(i,Cs(o.add(3),l))),c=this.batchMesh._colorsTexture;if(c!==null){const m=qe(([v])=>{const g=Rn(_f(Ea(c),0).x),y=v,_=y.mod(g),x=y.div(g);return Ea(c,Cs(_,x)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(n);uv("vec3","vBatchColor").assign(m)}const h=Jr(u);Ur.assign(u.mul(Ur));const d=os.div(Fe(h[0].dot(h[0]),h[1].dot(h[1]),h[2].dot(h[2]))),f=h.mul(d).xyz;os.assign(f),e.hasGeometryAttribute("tangent")&&FM.mulAssign(h)}}const Rce=Ge(Cce).setParameterLength(1),iB=new WeakMap;class Nce extends At{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=Lt.OBJECT,this.skinIndexNode=Ks("skinIndex","uvec4"),this.skinWeightNode=Ks("skinWeight","vec4"),this.bindMatrixNode=cn("bindMatrix","mat4"),this.bindMatrixInverseNode=cn("bindMatrixInverse","mat4"),this.boneMatricesNode=eB("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=Ur,this.toPositionNode=Ur,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:n,skinWeightNode:i,bindMatrixNode:a,bindMatrixInverseNode:s}=this,o=e.element(n.x),l=e.element(n.y),u=e.element(n.z),c=e.element(n.w),h=a.mul(t),d=ei(o.mul(i.x).mul(h),l.mul(i.y).mul(h),u.mul(i.z).mul(h),c.mul(i.w).mul(h));return s.mul(d).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=os){const{skinIndexNode:n,skinWeightNode:i,bindMatrixNode:a,bindMatrixInverseNode:s}=this,o=e.element(n.x),l=e.element(n.y),u=e.element(n.z),c=e.element(n.w);let h=ei(i.x.mul(o),i.y.mul(l),i.z.mul(u),i.w.mul(c));return h=s.mul(h).mul(a),h.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=eB("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,ZF)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||bV(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&ZF.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const n=this.getSkinnedNormal();os.assign(n),e.hasGeometryAttribute("tangent")&&FM.assign(n)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;iB.get(t)!==e.frameId&&(iB.set(t,e.frameId),this.previousBoneMatricesNode!==null&&t.previousBoneMatrices.set(t.boneMatrices),t.update())}}const Pce=r=>We(new Nce(r));class Dce extends At{static get type(){return"LoopNode"}constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode("i".charCodeAt(0)+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const n={};for(let a=0,s=this.params.length-1;a<s;a++){const o=this.params[a],l=o.isNode!==!0&&o.name||this.getVarName(a),u=o.isNode!==!0&&o.type||"int";n[l]=id(l,u)}const i=e.addStack();return t.returnsNode=this.params[this.params.length-1](n,i,e),t.stackNode=i,e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),n=this.params,i=t.stackNode;for(let o=0,l=n.length-1;o<l;o++){const u=n[o];let c=!1,h=null,d=null,f=null,p=null,m=null,v=null;u.isNode?u.getNodeType(e)==="bool"?(c=!0,p="bool",d=u.build(e,p)):(p="int",f=this.getVarName(o),h="0",d=u.build(e,p),m="<"):(p=u.type||"int",f=u.name||this.getVarName(o),h=u.start,d=u.end,m=u.condition,v=u.update,typeof h=="number"?h=e.generateConst(p,h):h&&h.isNode&&(h=h.build(e,p)),typeof d=="number"?d=e.generateConst(p,d):d&&d.isNode&&(d=d.build(e,p)),h!==void 0&&d===void 0?(h=h+" - 1",d="0",m=">="):d!==void 0&&h===void 0&&(h="0",m="<"),m===void 0&&(Number(h)>Number(d)?m=">=":m="<"));let g;if(c)g=`while ( ${d} )`;else{const y={start:h,end:d},_=y.start,x=y.end;let E="",T="",b="";v||(p==="int"||p==="uint"?m.includes("<")?v="++":v="--":m.includes("<")?v="+= 1.":v="-= 1."),E+=e.getVar(p,f)+" = "+_,T+=f+" "+m+" "+x,b+=f+" "+v,g=`for ( ${E}; ${T}; ${b} )`}e.addFlowCode((o===0?`
`:"")+e.tab+g+` {

`).addFlowTab()}const a=i.build(e,"void"),s=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+a);for(let o=0,l=this.params.length-1;o<l;o++)e.addFlowCode((o===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),s}}const Ra=(...r)=>We(new Dce(gc(r,"int"))).append(),Lce=()=>id("break").append(),P1=new WeakMap,Pi=new xt,aB=qe(({bufferMap:r,influence:e,stride:t,width:n,depth:i,offset:a})=>{const s=Rn(Tce).mul(t).add(a),o=s.div(n),l=s.sub(o.mul(n));return Ea(r,Cs(l,o)).depth(i).xyz.mul(e)});function Ice(r){const e=r.morphAttributes.position!==void 0,t=r.morphAttributes.normal!==void 0,n=r.morphAttributes.color!==void 0,i=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,a=i!==void 0?i.length:0;let s=P1.get(r);if(s===void 0||s.count!==a){let g=function(){m.dispose(),P1.delete(r),r.removeEventListener("dispose",g)};s!==void 0&&s.texture.dispose();const o=r.morphAttributes.position||[],l=r.morphAttributes.normal||[],u=r.morphAttributes.color||[];let c=0;e===!0&&(c=1),t===!0&&(c=2),n===!0&&(c=3);let h=r.attributes.position.count*c,d=1;const f=4096;h>f&&(d=Math.ceil(h/f),h=f);const p=new Float32Array(h*d*4*a),m=new XA(p,h,d,a);m.type=Un,m.needsUpdate=!0;const v=c*4;for(let y=0;y<a;y++){const _=o[y],x=l[y],E=u[y],T=h*d*4*y;for(let b=0;b<_.count;b++){const w=b*v;e===!0&&(Pi.fromBufferAttribute(_,b),p[T+w+0]=Pi.x,p[T+w+1]=Pi.y,p[T+w+2]=Pi.z,p[T+w+3]=0),t===!0&&(Pi.fromBufferAttribute(x,b),p[T+w+4]=Pi.x,p[T+w+5]=Pi.y,p[T+w+6]=Pi.z,p[T+w+7]=0),n===!0&&(Pi.fromBufferAttribute(E,b),p[T+w+8]=Pi.x,p[T+w+9]=Pi.y,p[T+w+10]=Pi.z,p[T+w+11]=E.itemSize===4?Pi.w:1)}}s={count:a,texture:m,stride:c,size:new He(h,d)},P1.set(r,s),r.addEventListener("dispose",g)}return s}class Oce extends At{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=St(1),this.updateType=Lt.OBJECT}setup(e){const{geometry:t}=e,n=t.morphAttributes.position!==void 0,i=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,a=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,s=a!==void 0?a.length:0,{texture:o,stride:l,size:u}=Ice(t);n===!0&&Ur.mulAssign(this.morphBaseInfluence),i===!0&&os.mulAssign(this.morphBaseInfluence);const c=Rn(u.width);Ra(s,({i:h})=>{const d=Le(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?d.assign(Ea(this.mesh.morphTexture,Cs(Rn(h).add(1),Rn(BM))).r):d.assign(cn("morphTargetInfluences","float").element(h).toVar()),Gn(d.notEqual(0),()=>{n===!0&&Ur.addAssign(aB({bufferMap:o,influence:d,stride:l,width:c,depth:h,offset:Rn(0)})),i===!0&&os.addAssign(aB({bufferMap:o,influence:d,stride:l,width:c,depth:h,offset:Rn(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,n)=>t+n,0)}}const Fce=Ge(Oce).setParameterLength(1);class ph extends At{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class Bce extends ph{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class Uce extends XV{static get type(){return"LightingContextNode"}constructor(e,t=null,n=null,i=null){super(e),this.lightingModel=t,this.backdropNode=n,this.backdropAlphaNode=i,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,n=Fe().toVar("directDiffuse"),i=Fe().toVar("directSpecular"),a=Fe().toVar("indirectDiffuse"),s=Fe().toVar("indirectSpecular"),o={directDiffuse:n,directSpecular:i,indirectDiffuse:a,indirectSpecular:s};return{radiance:Fe().toVar("radiance"),irradiance:Fe().toVar("irradiance"),iblIrradiance:Fe().toVar("iblIrradiance"),ambientOcclusion:Le(1).toVar("ambientOcclusion"),reflectedLight:o,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const kce=Ge(Uce);class Gce extends ph{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}let Bh,Uh;class Wn extends At{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===Wn.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=Lt.NONE;return(this.scope===Wn.SIZE||this.scope===Wn.VIEWPORT)&&(e=Lt.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===Wn.VIEWPORT?t!==null?Uh.copy(t.viewport):(e.getViewport(Uh),Uh.multiplyScalar(e.getPixelRatio())):t!==null?(Bh.width=t.width,Bh.height=t.height):e.getDrawingBufferSize(Bh)}setup(){const e=this.scope;let t=null;return e===Wn.SIZE?t=St(Bh||(Bh=new He)):e===Wn.VIEWPORT?t=St(Uh||(Uh=new xt)):t=Ze(Cm.div(uS)),t}generate(e){if(this.scope===Wn.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const n=e.getNodeProperties(uS).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${n}.y - ${t}.y )`}return t}return super.generate(e)}}Wn.COORDINATE="coordinate";Wn.VIEWPORT="viewport";Wn.SIZE="size";Wn.UV="uv";const od=Qe(Wn,Wn.UV),uS=Qe(Wn,Wn.SIZE),Cm=Qe(Wn,Wn.COORDINATE),xf=Qe(Wn,Wn.VIEWPORT);xf.zw;xf.xy;const kh=new He;class u4 extends Hd{static get type(){return"ViewportTextureNode"}constructor(e=od,t=null,n=null){n===null&&(n=new RZ,n.minFilter=fi),super(n,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=Lt.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(kh);const n=this.value;(n.image.width!==kh.width||n.image.height!==kh.height)&&(n.image.width=kh.width,n.image.height=kh.height,n.needsUpdate=!0);const i=n.generateMipmaps;n.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(n),n.generateMipmaps=i}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const c4=Ge(u4,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let D1=null;class zce extends u4{static get type(){return"ViewportDepthTextureNode"}constructor(e=od,t=null){D1===null&&(D1=new sa),super(e,t,D1)}}const Vce=Ge(zce).setParameterLength(0,2);class gi extends At{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===gi.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,n=this.valueNode;let i=null;if(t===gi.DEPTH_BASE)n!==null&&(i=d4().assign(n));else if(t===gi.DEPTH)e.isPerspectiveCamera?i=Hce(Xn.z,Rl,Nl):i=bf(Xn.z,Rl,Nl);else if(t===gi.LINEAR_DEPTH)if(n!==null)if(e.isPerspectiveCamera){const a=h4(n,Rl,Nl);i=bf(a,Rl,Nl)}else i=n;else i=bf(Xn.z,Rl,Nl);return i}}gi.DEPTH_BASE="depthBase";gi.DEPTH="depth";gi.LINEAR_DEPTH="linearDepth";const bf=(r,e,t)=>r.add(e).div(e.sub(t)),Hce=(r,e,t)=>e.add(r).mul(t).div(t.sub(e).mul(r)),h4=(r,e,t)=>e.mul(t).div(t.sub(e).mul(r).sub(t)),f4=(r,e,t)=>{e=e.max(1e-6).toVar();const n=Hs(r.negate().div(e)),i=Hs(t.div(e));return n.div(i)},d4=Ge(gi,gi.DEPTH_BASE),p4=Qe(gi,gi.DEPTH),Wce=Ge(gi,gi.LINEAR_DEPTH).setParameterLength(0,1);Vce();p4.assign=r=>d4(r);class qce extends At{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const $ce=Ge(qce).setParameterLength(1);class oa extends At{static get type(){return"ClippingNode"}constructor(e=oa.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:n,unionPlanes:i}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===oa.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,i):this.scope===oa.HARDWARE?this.setupHardwareClipping(i,e):this.setupDefault(n,i)}setupAlphaToCoverage(e,t){return qe(()=>{const n=Le().toVar("distanceToPlane"),i=Le().toVar("distanceToGradient"),a=Le(1).toVar("clipOpacity"),s=t.length;if(this.hardwareClipping===!1&&s>0){const l=Ja(t);Ra(s,({i:u})=>{const c=l.element(u);n.assign(Xn.dot(c.xyz).negate().add(c.w)),i.assign(n.fwidth().div(2)),a.mulAssign(Yo(i.negate(),i,n))})}const o=e.length;if(o>0){const l=Ja(e),u=Le(1).toVar("intersectionClipOpacity");Ra(o,({i:c})=>{const h=l.element(c);n.assign(Xn.dot(h.xyz).negate().add(h.w)),i.assign(n.fwidth().div(2)),u.mulAssign(Yo(i.negate(),i,n).oneMinus())}),a.mulAssign(u.oneMinus())}Qt.a.mulAssign(a),Qt.a.equal(0).discard()})()}setupDefault(e,t){return qe(()=>{const n=t.length;if(this.hardwareClipping===!1&&n>0){const a=Ja(t);Ra(n,({i:s})=>{const o=a.element(s);Xn.dot(o.xyz).greaterThan(o.w).discard()})}const i=e.length;if(i>0){const a=Ja(e),s=MV(!0).toVar("clipped");Ra(i,({i:o})=>{const l=a.element(o);s.assign(Xn.dot(l.xyz).greaterThan(l.w).and(s))}),s.discard()}})()}setupHardwareClipping(e,t){const n=e.length;return t.enableHardwareClipping(n),qe(()=>{const i=Ja(e),a=$ce(t.getClipDistance());Ra(n,({i:s})=>{const o=i.element(s),l=Xn.dot(o.xyz).sub(o.w).negate();a.element(s).assign(l)})})()}}oa.ALPHA_TO_COVERAGE="alphaToCoverage";oa.DEFAULT="default";oa.HARDWARE="hardware";const Xce=()=>We(new oa),Yce=()=>We(new oa(oa.ALPHA_TO_COVERAGE)),jce=()=>We(new oa(oa.HARDWARE)),Kce=.05,sB=qe(([r])=>tl(Bt(1e4,Aa(Bt(17,r.x).add(Bt(.1,r.y)))).mul(ei(.1,Ji(Aa(Bt(13,r.y).add(r.x))))))),oB=qe(([r])=>sB(Ze(sB(r.xy),r.z))),Qce=qe(([r])=>{const e=Ti(Oo(GV(r.xyz)),Oo(zV(r.xyz))),t=Le(1).div(Le(Kce).mul(e)).toVar("pixScale"),n=Ze(td(kl(Hs(t))),td(AM(Hs(t)))),i=Ze(oB(kl(n.x.mul(r.xyz))),oB(kl(n.y.mul(r.xyz)))),a=tl(Hs(t)),s=ei(Bt(a.oneMinus(),i.x),Bt(a,i.y)),o=rd(a,a.oneMinus()),l=Fe(s.mul(s).div(Bt(2,o).mul(ci(1,o))),s.sub(Bt(.5,o)).div(ci(1,o)),ci(1,ci(1,s).mul(ci(1,s)).div(Bt(2,o).mul(ci(1,o))))),u=s.lessThan(o.oneMinus()).select(s.lessThan(o).select(l.x,l.y),l.z);return js(u,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class ur extends Vr{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.shadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+_V(this)}build(e){this.setup(e)}setupObserver(e){return new jse(e)}setup(e){e.context.setupNormal=()=>this.setupNormal(e),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,n=t.getRenderTarget();e.addStack();const i=this.vertexNode||this.setupVertex(e);e.stack.outputNode=i,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let a;const s=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(n!==null?n.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const o=this.setupLighting(e);s!==null&&e.stack.add(s);const l=wt(o,Qt.a).max(0);a=this.setupOutput(e,l),yf.assign(a);const u=this.outputNode!==null;if(u&&(a=this.outputNode),n!==null){const c=t.getMRT(),h=this.mrtNode;c!==null?(u&&yf.assign(a),a=c,h!==null&&(a=c.merge(h))):h!==null&&(a=h)}}else{let o=this.fragmentNode;o.isOutputStructNode!==!0&&(o=wt(o)),a=this.setupOutput(e,o)}e.stack.outputNode=a,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:n}=e.clippingContext;let i=null;if(t.length>0||n.length>0){const a=e.renderer.samples;this.alphaToCoverage&&a>1?i=Yce():e.stack.add(Xce())}return i}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.add(jce()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:n}=e;let i=this.depthNode;if(i===null){const a=t.getMRT();a&&a.has("depth")?i=a.get("depth"):t.logarithmicDepthBuffer===!0&&(n.isPerspectiveCamera?i=f4(Xn.z,Rl,Nl):i=bf(Xn.z,Rl,Nl))}i!==null&&p4.assign(i).append()}setupPositionView(){return Sm.mul(Ur).xyz}setupModelViewProjection(){return LM.mul(Xn)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),l4}setupPosition(e){const{object:t,geometry:n}=e;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&Fce(t).append(),t.isSkinnedMesh===!0&&Pce(t).append(),this.displacementMap){const i=To("displacementMap","texture"),a=To("displacementScale","float"),s=To("displacementBias","float");Ur.addAssign(os.normalize().mul(i.x.mul(a).add(s)))}return t.isBatchedMesh&&Rce(t).append(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&Mce(t).append(),this.positionNode!==null&&Ur.assign(this.positionNode.context({isPositionNodeInput:!0})),Ur}setupDiffuseColor({object:e,geometry:t}){let n=this.colorNode?wt(this.colorNode):Xue;this.vertexColors===!0&&t.hasAttribute("color")&&(n=wt(n.xyz.mul(Ks("color","vec3")),n.a)),e.instanceColor&&(n=uv("vec3","vInstanceColor").mul(n)),e.isBatchedMesh&&e._colorsTexture&&(n=uv("vec3","vBatchColor").mul(n)),Qt.assign(n);const i=this.opacityNode?Le(this.opacityNode):s4;if(Qt.a.assign(Qt.a.mul(i)),this.alphaTestNode!==null||this.alphaTest>0){const a=this.alphaTestNode!==null?Le(this.alphaTestNode):$ue;Qt.a.lessThanEqual(a).discard()}this.alphaHash===!0&&Qt.a.lessThan(Qce(Ur)).discard(),this.transparent===!1&&this.blending===aa&&this.alphaToCoverage===!1&&Qt.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?Fe(0):Qt.rgb}setupNormal(){return this.normalNode?Fe(this.normalNode):ece}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?To("envMap","cubeTexture"):To("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new Gce(o4)),t}setupLights(e){const t=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&t.push(n);const i=this.setupLightMap(e);if(i&&i.isLightingNode&&t.push(i),this.aoNode!==null||e.material.aoMap){const s=this.aoNode!==null?this.aoNode:Ece;t.push(new Bce(s))}let a=this.lightsNode||e.lightsNode;return t.length>0&&(a=e.renderer.lighting.createNode([...a.getLights(),...t])),a}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:n,backdropAlphaNode:i,emissiveNode:a}=this,o=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let l=this.setupOutgoingLight(e);if(o&&o.getScope().hasLights){const u=this.setupLightingModel(e)||null;l=kce(o,u,n,i)}else n!==null&&(l=Fe(i!==null?_n(l,n,i):n));return(a&&a.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(XF.assign(Fe(a||jue)),l=l.add(XF)),l}setupFog(e,t){const n=e.fogNode;return n&&(yf.assign(t),t=wt(n)),t}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),t}setDefaultValues(e){for(const n in e){const i=e[n];this[n]===void 0&&(this[n]=i,i&&i.clone&&(this[n]=i.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const n in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,n)===void 0&&t[n].get!==void 0&&Object.defineProperty(this.constructor.prototype,n,t[n])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const n=Vr.prototype.toJSON.call(this,e),i=sv(this);n.inputNodes={};for(const{property:s,childNode:o}of i)n.inputNodes[s]=o.toJSON(e).uuid;function a(s){const o=[];for(const l in s){const u=s[l];delete u.metadata,o.push(u)}return o}if(t){const s=a(e.textures),o=a(e.images),l=a(e.nodes);s.length>0&&(n.textures=s),o.length>0&&(n.images=o),l.length>0&&(n.nodes=l)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.shadowPositionNode=e.shadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const Zce=new fm;class Jce extends ur{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(Zce),this.setValues(e)}}const ehe=new JZ;class the extends ur{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(ehe),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?Le(this.offsetNode):_ce,t=this.dashScaleNode?Le(this.dashScaleNode):vce,n=this.dashSizeNode?Le(this.dashSizeNode):mce,i=this.gapSizeNode?Le(this.gapSizeNode):yce;M1.assign(n),YF.assign(i);const a=za(Ks("lineDistance").mul(t));(e?a.add(e):a).mod(M1.add(YF)).greaterThan(M1).discard()}}const nhe=r=>We(r).mul(.5).add(.5),rhe=new jZ;class ihe extends ur{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(rhe),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?Le(this.opacityNode):s4;Qt.assign(PM(wt(nhe(qn),e),ft))}}class ahe extends zn{static get type(){return"EquirectUVNode"}constructor(e=JV){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,t=e.z.atan(e.x).mul(1/(Math.PI*2)).add(.5),n=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return Ze(t,n)}}const g4=Ge(ahe).setParameterLength(0,1);class v4 extends pz{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const n=t.minFilter,i=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const a=new uu(5,5,5),s=g4(JV),o=new ur;o.colorNode=qt(t,s,0),o.side=dn,o.blending=_i;const l=new Yn(a,o),u=new cm;u.add(l),t.minFilter===fi&&(t.minFilter=ir);const c=new dz(1,10,this),h=e.getMRT();return e.setMRT(null),c.update(e,u),e.setMRT(h),t.minFilter=n,t.currentGenerateMipmaps=i,l.geometry.dispose(),l.material.dispose(),this}}const Ef=new WeakMap;class she extends zn{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=sd(null);const t=new um;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=Lt.RENDER}updateBefore(e){const{renderer:t,material:n}=e,i=this.envNode;if(i.isTextureNode||i.isMaterialReferenceNode){const a=i.isTextureNode?i.value:n[i.property];if(a&&a.isTexture){const s=a.mapping;if(s===Wo||s===qo){if(Ef.has(a)){const o=Ef.get(a);lB(o,a.mapping),this._cubeTexture=o}else{const o=a.image;if(ohe(o)){const l=new v4(o.height);l.fromEquirectangularTexture(t,a),lB(l.texture,a.mapping),this._cubeTexture=l.texture,Ef.set(a,l.texture),a.addEventListener("dispose",m4)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function ohe(r){return r==null?!1:r.height>0}function m4(r){const e=r.target;e.removeEventListener("dispose",m4);const t=Ef.get(e);t!==void 0&&(Ef.delete(e),t.dispose())}function lB(r,e){e===Wo?r.mapping=la:e===qo&&(r.mapping=ua)}const y4=Ge(she).setParameterLength(1);class UM extends ph{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=y4(this.envNode)}}class lhe extends ph{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=Le(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class Rm{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class _4 extends Rm{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,n=e.reflectedLight,i=e.irradianceLightMap;n.indirectDiffuse.assign(wt(0)),i?n.indirectDiffuse.addAssign(i):n.indirectDiffuse.addAssign(wt(1,1,1,0)),n.indirectDiffuse.mulAssign(t),n.indirectDiffuse.mulAssign(Qt.rgb)}finish(e){const{material:t,context:n}=e,i=n.outgoingLight,a=e.context.environment;if(a)switch(t.combine){case Rd:i.rgb.assign(_n(i.rgb,i.rgb.mul(a.rgb),Dg.mul(N1)));break;case JG:i.rgb.assign(_n(i.rgb,a.rgb,Dg.mul(N1)));break;case ez:i.rgb.addAssign(a.rgb.mul(Dg.mul(N1)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const uhe=new Za;class che extends ur{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(uhe),this.setValues(e)}setupNormal(){return ka}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new UM(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new lhe(o4)),t}setupOutgoingLight(){return Qt.rgb}setupLightingModel(){return new _4}}const ld=qe(({f0:r,f90:e,dotVH:t})=>{const n=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return r.mul(n.oneMinus()).add(e.mul(n))}),$c=qe(r=>r.diffuseColor.mul(1/Math.PI)),hhe=()=>Le(.25),fhe=qe(({dotNH:r})=>oS.mul(Le(.5)).add(1).mul(Le(1/Math.PI)).mul(r.pow(oS))),dhe=qe(({lightDirection:r})=>{const e=r.add(Cn).normalize(),t=qn.dot(e).clamp(),n=Cn.dot(e).clamp(),i=ld({f0:Oi,f90:1,dotVH:n}),a=hhe(),s=fhe({dotNH:t});return i.mul(a).mul(s)});class x4 extends _4{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const a=qn.dot(e).clamp().mul(t);n.directDiffuse.addAssign(a.mul($c({diffuseColor:Qt.rgb}))),this.specular===!0&&n.directSpecular.addAssign(a.mul(dhe({lightDirection:e})).mul(Dg))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:i}=e.context;i.indirectDiffuse.addAssign(n.mul($c({diffuseColor:Qt}))),i.indirectDiffuse.mulAssign(t)}}const phe=new _z;class ghe extends ur{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(phe),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new UM(t):null}setupLightingModel(){return new x4(!1)}}const vhe=new XZ;class mhe extends ur{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(vhe),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new UM(t):null}setupLightingModel(){return new x4}setupVariants(){const e=(this.shininessNode?Le(this.shininessNode):Yue).max(1e-4);oS.assign(e);const t=this.specularNode||Kue;Oi.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const yhe=qe(r=>{if(r.geometry.hasAttribute("normal")===!1)return Le(0);const e=ka.dFdx().abs().max(ka.dFdy().abs());return e.x.max(e.y).max(e.z)}),b4=qe(r=>{const{roughness:e}=r,t=yhe();let n=e.max(.0525);return n=n.add(t),n=n.min(1),n}),_he=qe(({alpha:r,dotNL:e,dotNV:t})=>{const n=r.pow2(),i=e.mul(n.add(n.oneMinus().mul(t.pow2())).sqrt()),a=t.mul(n.add(n.oneMinus().mul(e.pow2())).sqrt());return Ys(.5,i.add(a).max(ile))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),xhe=qe(({alphaT:r,alphaB:e,dotTV:t,dotBV:n,dotTL:i,dotBL:a,dotNV:s,dotNL:o})=>{const l=o.mul(Fe(r.mul(t),e.mul(n),s).length()),u=s.mul(Fe(r.mul(i),e.mul(a),o).length());return Ys(.5,l.add(u)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),bhe=qe(({alpha:r,dotNH:e})=>{const t=r.pow2(),n=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(n.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),Ehe=Le(1/Math.PI),The=qe(({alphaT:r,alphaB:e,dotNH:t,dotTH:n,dotBH:i})=>{const a=r.mul(e),s=Fe(e.mul(n),r.mul(i),a.mul(t)),o=s.dot(s),l=a.div(o);return Ehe.mul(a.mul(l.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),uB=qe(r=>{const{lightDirection:e,f0:t,f90:n,roughness:i,f:a,USE_IRIDESCENCE:s,USE_ANISOTROPY:o}=r,l=r.normalView||qn,u=i.pow2(),c=e.add(Cn).normalize(),h=l.dot(e).clamp(),d=l.dot(Cn).clamp(),f=l.dot(c).clamp(),p=Cn.dot(c).clamp();let m=ld({f0:t,f90:n,dotVH:p}),v,g;if(qF(s)&&(m=wM.mix(m,a)),qF(o)){const y=Mg.dot(e),_=Mg.dot(Cn),x=Mg.dot(c),E=mc.dot(e),T=mc.dot(Cn),b=mc.dot(c);v=xhe({alphaT:sS,alphaB:u,dotTV:_,dotBV:T,dotTL:y,dotBL:E,dotNV:d,dotNL:h}),g=The({alphaT:sS,alphaB:u,dotNH:f,dotTH:x,dotBH:b})}else v=_he({alpha:u,dotNL:h,dotNV:d}),g=bhe({alpha:u,dotNH:f});return m.mul(v).mul(g)}),E4=qe(({roughness:r,dotNV:e})=>{const t=wt(-1,-.0275,-.572,.022),n=wt(1,.0425,1.04,-.04),i=r.mul(t).add(n),a=i.x.mul(i.x).min(e.mul(-9.28).exp2()).mul(i.x).add(i.y);return Ze(-1.04,1.04).mul(a).add(i.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),T4=qe(r=>{const{dotNV:e,specularColor:t,specularF90:n,roughness:i}=r,a=E4({dotNV:e,roughness:i});return t.mul(a.x).add(n.mul(a.y))}),whe=qe(({f:r,f90:e,dotVH:t})=>{const n=t.oneMinus().saturate(),i=n.mul(n),a=n.mul(i,i).clamp(0,.9999);return r.sub(Fe(e).mul(a)).div(a.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),She=qe(({roughness:r,dotNH:e})=>{const t=r.pow2(),n=Le(1).div(t),a=e.pow2().oneMinus().max(.0078125);return Le(2).add(n).mul(a.pow(n.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),Ahe=qe(({dotNV:r,dotNL:e})=>Le(1).div(Le(4).mul(e.add(r).sub(e.mul(r))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),Mhe=qe(({lightDirection:r})=>{const e=r.add(Cn).normalize(),t=qn.dot(r).clamp(),n=qn.dot(Cn).clamp(),i=qn.dot(e).clamp(),a=She({roughness:TM,dotNH:i}),s=Ahe({dotNV:n,dotNL:t});return rc.mul(a).mul(s)}),Che=qe(({N:r,V:e,roughness:t})=>{const a=.0078125,s=r.dot(e).saturate(),o=Ze(t,s.oneMinus().sqrt());return o.assign(o.mul(.984375).add(a)),o}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),Rhe=qe(({f:r})=>{const e=r.length();return Ti(e.mul(e).add(r.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),kp=qe(({v1:r,v2:e})=>{const t=r.dot(e),n=t.abs().toVar(),i=n.mul(.0145206).add(.4965155).mul(n).add(.8543985).toVar(),a=n.add(4.1616724).mul(n).add(3.417594).toVar(),s=i.div(a),o=t.greaterThan(0).select(s,Ti(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(s));return r.cross(e).mul(o)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),cB=qe(({N:r,V:e,P:t,mInv:n,p0:i,p1:a,p2:s,p3:o})=>{const l=a.sub(i).toVar(),u=o.sub(i).toVar(),c=l.cross(u),h=Fe().toVar();return Gn(c.dot(t.sub(i)).greaterThanEqual(0),()=>{const d=e.sub(r.mul(e.dot(r))).normalize(),f=r.cross(d).negate(),p=n.mul(Jr(d,f,r).transpose()).toVar(),m=p.mul(i.sub(t)).normalize().toVar(),v=p.mul(a.sub(t)).normalize().toVar(),g=p.mul(s.sub(t)).normalize().toVar(),y=p.mul(o.sub(t)).normalize().toVar(),_=Fe(0).toVar();_.addAssign(kp({v1:m,v2:v})),_.addAssign(kp({v1:v,v2:g})),_.addAssign(kp({v1:g,v2:y})),_.addAssign(kp({v1:y,v2:m})),h.assign(Fe(Rhe({f:_})))}),h}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),Nm=1/6,w4=r=>Bt(Nm,Bt(r,Bt(r,r.negate().add(3)).sub(3)).add(1)),cS=r=>Bt(Nm,Bt(r,Bt(r,Bt(3,r).sub(6))).add(4)),S4=r=>Bt(Nm,Bt(r,Bt(r,Bt(-3,r).add(3)).add(3)).add(1)),hS=r=>Bt(Nm,Tm(r,3)),hB=r=>w4(r).add(cS(r)),fB=r=>S4(r).add(hS(r)),dB=r=>ei(-1,cS(r).div(w4(r).add(cS(r)))),pB=r=>ei(1,hS(r).div(S4(r).add(hS(r)))),gB=(r,e,t)=>{const n=r.uvNode,i=Bt(n,e.zw).add(.5),a=kl(i),s=tl(i),o=hB(s.x),l=fB(s.x),u=dB(s.x),c=pB(s.x),h=dB(s.y),d=pB(s.y),f=Ze(a.x.add(u),a.y.add(h)).sub(.5).mul(e.xy),p=Ze(a.x.add(c),a.y.add(h)).sub(.5).mul(e.xy),m=Ze(a.x.add(u),a.y.add(d)).sub(.5).mul(e.xy),v=Ze(a.x.add(c),a.y.add(d)).sub(.5).mul(e.xy),g=hB(s.y).mul(ei(o.mul(r.sample(f).level(t)),l.mul(r.sample(p).level(t)))),y=fB(s.y).mul(ei(o.mul(r.sample(m).level(t)),l.mul(r.sample(v).level(t))));return g.add(y)},Nhe=qe(([r,e=Le(3)])=>{const t=Ze(r.size(Rn(e))),n=Ze(r.size(Rn(e.add(1)))),i=Ys(1,t),a=Ys(1,n),s=gB(r,wt(i,t),kl(e)),o=gB(r,wt(a,n),AM(e));return tl(e).mix(s,o)}),vB=qe(([r,e,t,n,i])=>{const a=Fe($V(e.negate(),nd(r),Ys(1,n))),s=Fe(Oo(i[0].xyz),Oo(i[1].xyz),Oo(i[2].xyz));return nd(a).mul(t.mul(s))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),Phe=qe(([r,e])=>r.mul(js(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),Dhe=c4(),Lhe=c4(),mB=qe(([r,e,t],{material:n})=>{const a=(n.side===dn?Dhe:Lhe).sample(r),s=Hs(uS.x).mul(Phe(e,t));return Nhe(a,s)}),yB=qe(([r,e,t])=>(Gn(t.notEqual(0),()=>{const n=UV(e).negate().div(t);return BV(n.negate().mul(r))}),Fe(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),Ihe=qe(([r,e,t,n,i,a,s,o,l,u,c,h,d,f,p])=>{let m,v;if(p){m=wt().toVar(),v=Fe().toVar();const E=c.sub(1).mul(p.mul(.025)),T=Fe(c.sub(E),c,c.add(E));Ra({start:0,end:3},({i:b})=>{const w=T.element(b),A=vB(r,e,h,w,o),S=s.add(A),C=u.mul(l.mul(wt(S,1))),R=Ze(C.xy.div(C.w)).toVar();R.addAssign(1),R.divAssign(2),R.assign(Ze(R.x,R.y.oneMinus()));const P=mB(R,t,w);m.element(b).assign(P.element(b)),m.a.addAssign(P.a),v.element(b).assign(n.element(b).mul(yB(Oo(A),d,f).element(b)))}),m.a.divAssign(3)}else{const E=vB(r,e,h,c,o),T=s.add(E),b=u.mul(l.mul(wt(T,1))),w=Ze(b.xy.div(b.w)).toVar();w.addAssign(1),w.divAssign(2),w.assign(Ze(w.x,w.y.oneMinus())),m=mB(w,t,c),v=n.mul(yB(Oo(E),d,f))}const g=v.rgb.mul(m.rgb),y=r.dot(e).clamp(),_=Fe(T4({dotNV:y,specularColor:i,specularF90:a,roughness:t})),x=v.r.add(v.g,v.b).div(3);return wt(_.oneMinus().mul(g),m.a.oneMinus().mul(x).oneMinus())}),Ohe=Jr(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),Fhe=r=>{const e=r.sqrt();return Fe(1).add(e).div(Fe(1).sub(e))},_B=(r,e)=>r.sub(e).div(r.add(e)).pow2(),Bhe=(r,e)=>{const t=r.mul(2*Math.PI*1e-9),n=Fe(54856e-17,44201e-17,52481e-17),i=Fe(1681e3,1795300,2208400),a=Fe(43278e5,93046e5,66121e5),s=Le(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let o=n.mul(a.mul(2*Math.PI).sqrt()).mul(i.mul(t).add(e).cos()).mul(t.pow2().negate().mul(a).exp());return o=Fe(o.x.add(s),o.y,o.z).div(10685e-11),Ohe.mul(o)},Uhe=qe(({outsideIOR:r,eta2:e,cosTheta1:t,thinFilmThickness:n,baseF0:i})=>{const a=_n(r,e,Yo(0,.03,n)),o=r.div(a).pow2().mul(t.pow2().oneMinus()).oneMinus();Gn(o.lessThan(0),()=>Fe(1));const l=o.sqrt(),u=_B(a,r),c=ld({f0:u,f90:1,dotVH:t}),h=c.oneMinus(),d=a.lessThan(r).select(Math.PI,0),f=Le(Math.PI).sub(d),p=Fhe(i.clamp(0,.9999)),m=_B(p,a.toVec3()),v=ld({f0:m,f90:1,dotVH:l}),g=Fe(p.x.lessThan(a).select(Math.PI,0),p.y.lessThan(a).select(Math.PI,0),p.z.lessThan(a).select(Math.PI,0)),y=a.mul(n,l,2),_=Fe(f).add(g),x=c.mul(v).clamp(1e-5,.9999),E=x.sqrt(),T=h.pow2().mul(v).div(Fe(1).sub(x)),w=c.add(T).toVar(),A=T.sub(h).toVar();return Ra({start:1,end:2,condition:"<=",name:"m"},({m:S})=>{A.mulAssign(E);const C=Bhe(Le(S).mul(y),Le(S).mul(_)).mul(2);w.addAssign(A.mul(C))}),w.max(Fe(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),khe=qe(({normal:r,viewDir:e,roughness:t})=>{const n=r.dot(e).saturate(),i=t.pow2(),a=pi(t.lessThan(.25),Le(-339.2).mul(i).add(Le(161.4).mul(t)).sub(25.9),Le(-8.48).mul(i).add(Le(14.3).mul(t)).sub(9.95)),s=pi(t.lessThan(.25),Le(44).mul(i).sub(Le(23.7).mul(t)).add(3.26),Le(1.97).mul(i).sub(Le(3.27).mul(t)).add(.72));return pi(t.lessThan(.25),0,Le(.1).mul(t).sub(.025)).add(a.mul(n).add(s).exp()).mul(1/Math.PI).saturate()}),L1=Fe(.04),I1=Le(1);class A4 extends Rm{constructor(e=!1,t=!1,n=!1,i=!1,a=!1,s=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=n,this.anisotropy=i,this.transmission=a,this.dispersion=s,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=Fe().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=Fe().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=Fe().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=Fe().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=Fe().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=qn.dot(Cn).clamp();this.iridescenceFresnel=Uhe({outsideIOR:Le(1),eta2:NV,cosTheta1:t,thinFilmThickness:PV,baseF0:Oi}),this.iridescenceF0=whe({f:this.iridescenceFresnel,f90:1,dotVH:t})}if(this.transmission===!0){const t=ad,n=bue.sub(ad).normalize(),i=IM,a=e.context;a.backdrop=Ihe(i,n,Ls,Qt,Oi,fv,t,Jl,io,LM,Cg,DV,IV,LV,this.dispersion?OV:null),a.backdropAlpha=lS,Qt.a.mulAssign(_n(1,a.backdrop.a,lS))}super.start(e)}computeMultiscattering(e,t,n){const i=qn.dot(Cn).clamp(),a=E4({roughness:Ls,dotNV:i}),o=(this.iridescenceF0?wM.mix(Oi,this.iridescenceF0):Oi).mul(a.x).add(n.mul(a.y)),u=a.x.add(a.y).oneMinus(),c=Oi.add(Oi.oneMinus().mul(.047619)),h=o.mul(c).div(u.mul(c).oneMinus());e.addAssign(o),t.addAssign(h.mul(u))}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const a=qn.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(a.mul(Mhe({lightDirection:e}))),this.clearcoat===!0){const o=af.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(o.mul(uB({lightDirection:e,f0:L1,f90:I1,roughness:hv,normalView:af})))}n.directDiffuse.addAssign(a.mul($c({diffuseColor:Qt.rgb}))),n.directSpecular.addAssign(a.mul(uB({lightDirection:e,f0:Oi,f90:1,roughness:Ls,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:n,halfHeight:i,reflectedLight:a,ltc_1:s,ltc_2:o}){const l=t.add(n).sub(i),u=t.sub(n).sub(i),c=t.sub(n).add(i),h=t.add(n).add(i),d=qn,f=Cn,p=Xn.toVar(),m=Che({N:d,V:f,roughness:Ls}),v=s.sample(m).toVar(),g=o.sample(m).toVar(),y=Jr(Fe(v.x,0,v.y),Fe(0,1,0),Fe(v.z,0,v.w)).toVar(),_=Oi.mul(g.x).add(Oi.oneMinus().mul(g.y)).toVar();a.directSpecular.addAssign(e.mul(_).mul(cB({N:d,V:f,P:p,mInv:y,p0:l,p1:u,p2:c,p3:h}))),a.directDiffuse.addAssign(e.mul(Qt).mul(cB({N:d,V:f,P:p,mInv:Jr(1,0,0,0,1,0,0,0,1),p0:l,p1:u,p2:c,p3:h})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:n}=e.context;n.indirectDiffuse.addAssign(t.mul($c({diffuseColor:Qt})))}indirectSpecular(e){const{radiance:t,iblIrradiance:n,reflectedLight:i}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(n.mul(rc,khe({normal:qn,viewDir:Cn,roughness:TM}))),this.clearcoat===!0){const c=af.dot(Cn).clamp(),h=T4({dotNV:c,specularColor:L1,specularF90:I1,roughness:hv});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(h))}const a=Fe().toVar("singleScattering"),s=Fe().toVar("multiScattering"),o=n.mul(1/Math.PI);this.computeMultiscattering(a,s,fv);const l=a.add(s),u=Qt.mul(l.r.max(l.g).max(l.b).oneMinus());i.indirectSpecular.addAssign(t.mul(a)),i.indirectSpecular.addAssign(s.mul(o)),i.indirectDiffuse.addAssign(u.mul(o))}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:n}=e.context,a=qn.dot(Cn).clamp().add(t),s=Ls.mul(-16).oneMinus().negate().exp2(),o=t.sub(a.pow(s).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),n.indirectDiffuse.mulAssign(t),n.indirectSpecular.mulAssign(o)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const n=af.dot(Cn).clamp(),i=ld({dotVH:n,f0:L1,f90:I1}),a=t.mul(aS.mul(i).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(aS));t.assign(a)}if(this.sheen===!0){const n=rc.r.max(rc.g).max(rc.b).mul(.157).oneMinus(),i=t.mul(n).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(i)}}}const xB=Le(1),fS=Le(-2),Gp=Le(.8),O1=Le(-1),zp=Le(.4),F1=Le(2),Vp=Le(.305),B1=Le(3),bB=Le(.21),Ghe=Le(4),EB=Le(4),zhe=Le(16),Vhe=qe(([r])=>{const e=Fe(Ji(r)).toVar(),t=Le(-1).toVar();return Gn(e.x.greaterThan(e.z),()=>{Gn(e.x.greaterThan(e.y),()=>{t.assign(pi(r.x.greaterThan(0),0,3))}).Else(()=>{t.assign(pi(r.y.greaterThan(0),1,4))})}).Else(()=>{Gn(e.z.greaterThan(e.y),()=>{t.assign(pi(r.z.greaterThan(0),2,5))}).Else(()=>{t.assign(pi(r.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),Hhe=qe(([r,e])=>{const t=Ze().toVar();return Gn(e.equal(0),()=>{t.assign(Ze(r.z,r.y).div(Ji(r.x)))}).ElseIf(e.equal(1),()=>{t.assign(Ze(r.x.negate(),r.z.negate()).div(Ji(r.y)))}).ElseIf(e.equal(2),()=>{t.assign(Ze(r.x.negate(),r.y).div(Ji(r.z)))}).ElseIf(e.equal(3),()=>{t.assign(Ze(r.z.negate(),r.y).div(Ji(r.x)))}).ElseIf(e.equal(4),()=>{t.assign(Ze(r.x.negate(),r.z).div(Ji(r.y)))}).Else(()=>{t.assign(Ze(r.x,r.y).div(Ji(r.z)))}),Bt(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),Whe=qe(([r])=>{const e=Le(0).toVar();return Gn(r.greaterThanEqual(Gp),()=>{e.assign(xB.sub(r).mul(O1.sub(fS)).div(xB.sub(Gp)).add(fS))}).ElseIf(r.greaterThanEqual(zp),()=>{e.assign(Gp.sub(r).mul(F1.sub(O1)).div(Gp.sub(zp)).add(O1))}).ElseIf(r.greaterThanEqual(Vp),()=>{e.assign(zp.sub(r).mul(B1.sub(F1)).div(zp.sub(Vp)).add(F1))}).ElseIf(r.greaterThanEqual(bB),()=>{e.assign(Vp.sub(r).mul(Ghe.sub(B1)).div(Vp.sub(bB)).add(B1))}).Else(()=>{e.assign(Le(-2).mul(Hs(Bt(1.16,r))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),qhe=qe(([r,e])=>{const t=r.toVar();t.assign(Bt(2,t).sub(1));const n=Fe(t,1).toVar();return Gn(e.equal(0),()=>{n.assign(n.zyx)}).ElseIf(e.equal(1),()=>{n.assign(n.xzy),n.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{n.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{n.assign(n.zyx),n.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{n.assign(n.xzy),n.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{n.z.mulAssign(-1)}),n}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),$he=qe(([r,e,t,n,i,a])=>{const s=Le(t),o=Fe(e),l=js(Whe(s),fS,a),u=tl(l),c=kl(l),h=Fe(dS(r,o,c,n,i,a)).toVar();return Gn(u.notEqual(0),()=>{const d=Fe(dS(r,o,c.add(1),n,i,a)).toVar();h.assign(_n(h,d,u))}),h}),dS=qe(([r,e,t,n,i,a])=>{const s=Le(t).toVar(),o=Fe(e),l=Le(Vhe(o)).toVar(),u=Le(Ti(EB.sub(s),0)).toVar();s.assign(Ti(s,EB));const c=Le(td(s)).toVar(),h=Ze(Hhe(o,l).mul(c.sub(2)).add(1)).toVar();return Gn(l.greaterThan(2),()=>{h.y.addAssign(c),l.subAssign(3)}),h.x.addAssign(l.mul(c)),h.x.addAssign(u.mul(Bt(3,zhe))),h.y.addAssign(Bt(4,td(a).sub(c))),h.x.mulAssign(n),h.y.mulAssign(i),r.sample(h).grad(Ze(),Ze())}),U1=qe(({envMap:r,mipInt:e,outputDirection:t,theta:n,axis:i,CUBEUV_TEXEL_WIDTH:a,CUBEUV_TEXEL_HEIGHT:s,CUBEUV_MAX_MIP:o})=>{const l=Eo(n),u=t.mul(l).add(i.cross(t).mul(Aa(n))).add(i.mul(i.dot(t).mul(l.oneMinus())));return dS(r,u,e,a,s,o)}),Xhe=qe(({n:r,latitudinal:e,poleAxis:t,outputDirection:n,weights:i,samples:a,dTheta:s,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h})=>{const d=Fe(pi(e,t,HV(t,n))).toVar();Gn(d.equal(Fe(0)),()=>{d.assign(Fe(n.z,0,n.x.negate()))}),d.assign(nd(d));const f=Fe().toVar();return f.addAssign(i.element(0).mul(U1({theta:0,axis:d,outputDirection:n,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h}))),Ra({start:Rn(1),end:r},({i:p})=>{Gn(p.greaterThanEqual(a),()=>{Lce()});const m=Le(s.mul(Le(p))).toVar();f.addAssign(i.element(p).mul(U1({theta:m.mul(-1),axis:d,outputDirection:n,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h}))),f.addAssign(i.element(p).mul(U1({theta:m,axis:d,outputDirection:n,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:h})))}),wt(f,1)}),ic=4,TB=[.125,.215,.35,.446,.526,.582],Pl=20,k1=new Fd(-1,1,1,-1,0,1),Yhe=new yr(90,1),wB=new ct;let G1=null,z1=0,V1=0;const Sl=(1+Math.sqrt(5))/2,Uu=1/Sl,SB=[new re(-Sl,Uu,0),new re(Sl,Uu,0),new re(-Uu,0,Sl),new re(Uu,0,Sl),new re(0,Sl,-Uu),new re(0,Sl,Uu),new re(-1,1,-1),new re(1,1,-1),new re(-1,1,1),new re(1,1,1)],jhe=new re,M4=new WeakMap,Khe=[3,1,5,0,4,2],H1=qhe(Vd(),Ks("faceIndex")).normalize(),kM=Fe(H1.x,H1.y,H1.z);class Qhe{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,n=.1,i=100,a={}){const{size:s=256,position:o=jhe,renderTarget:l=null}=a;if(this._setSize(s),this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromScene() called before the backend is initialized. Try using .fromSceneAsync() instead.");const c=l||this._allocateTargets();return a.renderTarget=c,this.fromSceneAsync(e,t,n,i,a),c}G1=this._renderer.getRenderTarget(),z1=this._renderer.getActiveCubeFace(),V1=this._renderer.getActiveMipmapLevel();const u=l||this._allocateTargets();return u.depthBuffer=!0,this._sceneToCubeUV(e,n,i,u,o),t>0&&this._blur(u,0,0,t),this._applyPMREM(u),this._cleanup(u),u}async fromSceneAsync(e,t=0,n=.1,i=100,a={}){return this._hasInitialized===!1&&await this._renderer.init(),this.fromScene(e,t,n,i,a)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using .fromEquirectangularAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTargets();return this.fromEquirectangularAsync(e,n),n}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTargets();return this.fromCubemapAsync(e,t),n}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=MB(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=CB(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===la||e.mapping===ua?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(G1,z1,V1),e.scissorTest=!1,Hp(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),G1=this._renderer.getRenderTarget(),z1=this._renderer.getActiveCubeFace(),V1=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:ir,minFilter:ir,generateMipmaps:!1,type:kr,format:On,colorSpace:is},i=AB(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=AB(e,t,n);const{_lodMax:a}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=Zhe(a)),this._blurMaterial=Jhe(a,e,t)}return i}async _compileMaterial(e){const t=new Yn(this._lodPlanes[0],e);await this._renderer.compile(t,k1)}_sceneToCubeUV(e,t,n,i,a){const s=Yhe;s.near=t,s.far=n;const o=[1,1,1,1,-1,1],l=[1,-1,1,-1,1,-1],u=this._renderer,c=u.autoClear;u.getClearColor(wB),u.autoClear=!1;let h=this._backgroundBox;if(h===null){const p=new Za({name:"PMREM.Background",side:dn,depthWrite:!1,depthTest:!1});h=new Yn(new uu,p)}let d=!1;const f=e.background;f?f.isColor&&(h.material.color.copy(f),e.background=null,d=!0):(h.material.color.copy(wB),d=!0),u.setRenderTarget(i),u.clear(),d&&u.render(h,s);for(let p=0;p<6;p++){const m=p%3;m===0?(s.up.set(0,o[p],0),s.position.set(a.x,a.y,a.z),s.lookAt(a.x+l[p],a.y,a.z)):m===1?(s.up.set(0,0,o[p]),s.position.set(a.x,a.y,a.z),s.lookAt(a.x,a.y+l[p],a.z)):(s.up.set(0,o[p],0),s.position.set(a.x,a.y,a.z),s.lookAt(a.x,a.y,a.z+l[p]));const v=this._cubeSize;Hp(i,m*v,p>2?v:0,v,v),u.render(e,s)}u.autoClear=c,e.background=f}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===la||e.mapping===ua;i?this._cubemapMaterial===null&&(this._cubemapMaterial=MB(e)):this._equirectMaterial===null&&(this._equirectMaterial=CB(e));const a=i?this._cubemapMaterial:this._equirectMaterial;a.fragmentNode.value=e;const s=this._lodMeshes[0];s.material=a;const o=this._cubeSize;Hp(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(s,k1)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let a=1;a<i;a++){const s=Math.sqrt(this._sigmas[a]*this._sigmas[a]-this._sigmas[a-1]*this._sigmas[a-1]),o=SB[(i-a-1)%SB.length];this._blur(e,a-1,a,s,o)}t.autoClear=n}_blur(e,t,n,i,a){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,i,"latitudinal",a),this._halfBlur(s,e,n,n,i,"longitudinal",a)}_halfBlur(e,t,n,i,a,s,o){const l=this._renderer,u=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const c=3,h=this._lodMeshes[i];h.material=u;const d=M4.get(u),f=this._sizeLods[n]-1,p=isFinite(a)?Math.PI/(2*f):2*Math.PI/(2*Pl-1),m=a/p,v=isFinite(a)?1+Math.floor(c*m):Pl;v>Pl&&console.warn(`sigmaRadians, ${a}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${Pl}`);const g=[];let y=0;for(let b=0;b<Pl;++b){const w=b/m,A=Math.exp(-w*w/2);g.push(A),b===0?y+=A:b<v&&(y+=2*A)}for(let b=0;b<g.length;b++)g[b]=g[b]/y;e.texture.frame=(e.texture.frame||0)+1,d.envMap.value=e.texture,d.samples.value=v,d.weights.array=g,d.latitudinal.value=s==="latitudinal"?1:0,o&&(d.poleAxis.value=o);const{_lodMax:_}=this;d.dTheta.value=p,d.mipInt.value=_-n;const x=this._sizeLods[i],E=3*x*(i>_-ic?i-_+ic:0),T=4*(this._cubeSize-x);Hp(t,E,T,3*x,2*x),l.setRenderTarget(t),l.render(h,k1)}}function Zhe(r){const e=[],t=[],n=[],i=[];let a=r;const s=r-ic+1+TB.length;for(let o=0;o<s;o++){const l=Math.pow(2,a);t.push(l);let u=1/l;o>r-ic?u=TB[o-r+ic-1]:o===0&&(u=0),n.push(u);const c=1/(l-2),h=-c,d=1+c,f=[h,h,d,h,d,d,h,h,d,d,h,d],p=6,m=6,v=3,g=2,y=1,_=new Float32Array(v*m*p),x=new Float32Array(g*m*p),E=new Float32Array(y*m*p);for(let b=0;b<p;b++){const w=b%3*2/3-1,A=b>2?0:-1,S=[w,A,0,w+2/3,A,0,w+2/3,A+1,0,w,A,0,w+2/3,A+1,0,w,A+1,0],C=Khe[b];_.set(S,v*m*C),x.set(f,g*m*C);const R=[C,C,C,C,C,C];E.set(R,y*m*C)}const T=new ri;T.setAttribute("position",new Rr(_,v)),T.setAttribute("uv",new Rr(x,g)),T.setAttribute("faceIndex",new Rr(E,y)),e.push(T),i.push(new Yn(T,null)),a>ic&&a--}return{lodPlanes:e,sizeLods:t,sigmas:n,lodMeshes:i}}function AB(r,e,t){const n=new ou(r,e,t);return n.texture.mapping=Yl,n.texture.name="PMREM.cubeUv",n.texture.isPMREMTexture=!0,n.scissorTest=!0,n}function Hp(r,e,t,n,i){r.viewport.set(e,t,n,i),r.scissor.set(e,t,n,i)}function GM(r){const e=new ur;return e.depthTest=!1,e.depthWrite=!1,e.blending=_i,e.name=`PMREM_${r}`,e}function Jhe(r,e,t){const n=Ja(new Array(Pl).fill(0)),i=St(new re(0,1,0)),a=St(0),s=Le(Pl),o=St(0),l=St(1),u=qt(null),c=St(0),h=Le(1/e),d=Le(1/t),f=Le(r),p={n:s,latitudinal:o,weights:n,poleAxis:i,outputDirection:kM,dTheta:a,samples:l,envMap:u,mipInt:c,CUBEUV_TEXEL_WIDTH:h,CUBEUV_TEXEL_HEIGHT:d,CUBEUV_MAX_MIP:f},m=GM("blur");return m.fragmentNode=Xhe({...p,latitudinal:o.equal(1)}),M4.set(m,p),m}function MB(r){const e=GM("cubemap");return e.fragmentNode=sd(r,kM),e}function CB(r){const e=GM("equirect");return e.fragmentNode=qt(r,g4(kM),0),e}const RB=new WeakMap;function efe(r){const e=Math.log2(r)-2,t=1/r;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:t,maxMip:e}}function tfe(r,e,t){const n=nfe(e);let i=n.get(r);if((i!==void 0?i.pmremVersion:-1)!==r.pmremVersion){const s=r.image;if(r.isCubeTexture)if(ife(s))i=t.fromCubemap(r,i);else return null;else if(afe(s))i=t.fromEquirectangular(r,i);else return null;i.pmremVersion=r.pmremVersion,n.set(r,i)}return i.texture}function nfe(r){let e=RB.get(r);return e===void 0&&(e=new WeakMap,RB.set(r,e)),e}class rfe extends zn{static get type(){return"PMREMNode"}constructor(e,t=null,n=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=n,this._generator=null;const i=new ar;i.isRenderTargetTexture=!0,this._texture=qt(i),this._width=St(0),this._height=St(0),this._maxMip=St(0),this.updateBeforeType=Lt.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=efe(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const n=t?t.pmremVersion:-1,i=this._value;n!==i.pmremVersion&&(i.isPMREMTexture===!0?t=i:t=tfe(i,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new Qhe(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this)),t=r4.mul(Fe(t.x,t.y.negate(),t.z));let n=this.levelNode;return n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),$he(this._texture,t,n,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function ife(r){if(r==null)return!1;let e=0;const t=6;for(let n=0;n<t;n++)r[n]!==void 0&&e++;return e===t}function afe(r){return r==null?!1:r.height>0}const C4=Ge(rfe).setParameterLength(1,3),NB=new WeakMap;class sfe extends ph{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const h=n.isTextureNode?n.value:t[n.property];let d=NB.get(h);d===void 0&&(d=C4(h),NB.set(h,d)),n=d}const a=t.useAnisotropy===!0||t.anisotropy>0?kue:qn,s=n.context(PB(Ls,a)).mul(R1),o=n.context(ofe(IM)).mul(Math.PI).mul(R1),l=Ng(s),u=Ng(o);e.context.radiance.addAssign(l),e.context.iblIrradiance.addAssign(u);const c=e.context.lightingModel.clearcoatRadiance;if(c){const h=n.context(PB(hv,af)).mul(R1),d=Ng(h);c.addAssign(d)}}}const PB=(r,e)=>{let t=null;return{getUV:()=>(t===null&&(t=Cn.negate().reflect(e),t=r.mul(r).mix(t,e).normalize(),t=t.transformDirection(io)),t),getTextureLevel:()=>r}},ofe=r=>({getUV:()=>r,getTextureLevel:()=>Le(1)}),lfe=new yz;class R4 extends ur{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(lfe),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new sfe(t):null}setupLightingModel(){return new A4}setupSpecular(){const e=_n(Fe(.04),Qt.rgb,cv);Oi.assign(e),fv.assign(1)}setupVariants(){const e=this.metalnessNode?Le(this.metalnessNode):Jue;cv.assign(e);let t=this.roughnessNode?Le(this.roughnessNode):Zue;t=b4({roughness:t}),Ls.assign(t),this.setupSpecular(),Qt.assign(wt(Qt.rgb.mul(e.oneMinus()),Qt.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const ufe=new $Z;class cfe extends R4{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(ufe),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?Le(this.iorNode):dce;Cg.assign(e),Oi.assign(_n(rd(WV(Cg.sub(1).div(Cg.add(1))).mul(Que),Fe(1)).mul(rB),Qt.rgb,cv)),fv.assign(_n(rB,1,cv))}setupLightingModel(){return new A4(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?Le(this.clearcoatNode):tce,n=this.clearcoatRoughnessNode?Le(this.clearcoatRoughnessNode):nce;aS.assign(t),hv.assign(b4({roughness:n}))}if(this.useSheen){const t=this.sheenNode?Fe(this.sheenNode):ace,n=this.sheenRoughnessNode?Le(this.sheenRoughnessNode):sce;rc.assign(t),TM.assign(n)}if(this.useIridescence){const t=this.iridescenceNode?Le(this.iridescenceNode):lce,n=this.iridescenceIORNode?Le(this.iridescenceIORNode):uce,i=this.iridescenceThicknessNode?Le(this.iridescenceThicknessNode):cce;wM.assign(t),NV.assign(n),PV.assign(i)}if(this.useAnisotropy){const t=(this.anisotropyNode?Ze(this.anisotropyNode):oce).toVar();wl.assign(t.length()),Gn(wl.equal(0),()=>{t.assign(Ze(1,0))}).Else(()=>{t.divAssign(Ze(wl)),wl.assign(wl.saturate())}),sS.assign(wl.pow2().mix(Ls.pow2(),1)),Mg.assign(sf[0].mul(t.x).add(sf[1].mul(t.y))),mc.assign(sf[1].mul(t.x).sub(sf[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?Le(this.transmissionNode):hce,n=this.thicknessNode?Le(this.thicknessNode):fce,i=this.attenuationDistanceNode?Le(this.attenuationDistanceNode):pce,a=this.attenuationColorNode?Fe(this.attenuationColorNode):gce;if(lS.assign(t),DV.assign(n),LV.assign(i),IV.assign(a),this.useDispersion){const s=this.dispersionNode?Le(this.dispersionNode):bce;OV.assign(s)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?Fe(this.clearcoatNormalNode):rce}setup(e){e.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(e),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const hfe=qe(({normal:r,lightDirection:e,builder:t})=>{const n=r.dot(e),i=Ze(n.mul(.5).add(.5),0);if(t.material.gradientMap){const a=To("gradientMap","texture").context({getUV:()=>i});return Fe(a.r)}else{const a=i.fwidth().mul(.5);return _n(Fe(.7),Fe(1),Yo(Le(.7).sub(a.x),Le(.7).add(a.x),i.x))}});class ffe extends Rm{direct({lightDirection:e,lightColor:t,reflectedLight:n},i){const a=hfe({normal:e4,lightDirection:e,builder:i}).mul(t);n.directDiffuse.addAssign(a.mul($c({diffuseColor:Qt.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:i}=e.context;i.indirectDiffuse.addAssign(n.mul($c({diffuseColor:Qt}))),i.indirectDiffuse.mulAssign(t)}}const dfe=new YZ;class pfe extends ur{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(dfe),this.setValues(e)}setupLightingModel(){return new ffe}}class gfe extends zn{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const e=Fe(Cn.z,0,Cn.x.negate()).normalize(),t=Cn.cross(e);return Ze(e.dot(qn),t.dot(qn)).mul(.495).add(.5)}}const vfe=Qe(gfe),mfe=new ZZ;class yfe extends ur{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(mfe),this.setValues(e)}setupVariants(e){const t=vfe;let n;e.material.matcap?n=To("matcap","texture").context({getUV:()=>t}):n=Fe(_n(.2,.8,t.y)),Qt.rgb.mulAssign(n.rgb)}}class _fe extends zn{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:n}=this;if(this.getNodeType(e)==="vec2"){const a=t.cos(),s=t.sin();return bM(a,s,s.negate(),a).mul(n)}else{const a=t,s=vc(wt(1,0,0,0),wt(0,Eo(a.x),Aa(a.x).negate(),0),wt(0,Aa(a.x),Eo(a.x),0),wt(0,0,0,1)),o=vc(wt(Eo(a.y),0,Aa(a.y),0),wt(0,1,0,0),wt(Aa(a.y).negate(),0,Eo(a.y),0),wt(0,0,0,1)),l=vc(wt(Eo(a.z),Aa(a.z).negate(),0,0),wt(Aa(a.z),Eo(a.z),0,0),wt(0,0,1,0),wt(0,0,0,1));return s.mul(o).mul(l).mul(wt(n,1)).xyz}}}const N4=Ge(_fe).setParameterLength(2),xfe=new EZ;class P4 extends ur{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(xfe),this.setValues(e)}setupPositionView(e){const{object:t,camera:n}=e,i=this.sizeAttenuation,{positionNode:a,rotationNode:s,scaleNode:o}=this,l=Sm.mul(Fe(a||0));let u=Ze(Jl[0].xyz.length(),Jl[1].xyz.length());if(o!==null&&(u=u.mul(Ze(o))),i===!1)if(n.isPerspectiveCamera)u=u.mul(l.z.negate());else{const f=Le(2).div(LM.element(1).element(1));u=u.mul(f.mul(2))}let c=Am.xy;if(t.center&&t.center.isVector2===!0){const f=jle("center","vec2",t);c=c.sub(f.sub(.5))}c=c.mul(u);const h=Le(s||ice),d=N4(c,h);return wt(l.xy.add(d),l.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const bfe=new CZ;class Efe extends P4{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(bfe),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return Sm.mul(Fe(e||Ur)).xyz}setupVertex(e){const t=super.setupVertex(e);if(e.material.isNodeMaterial!==!0)return t;const{rotationNode:n,scaleNode:i,sizeNode:a}=this,s=Am.xy.toVar(),o=xf.z.div(xf.w);if(n&&n.isNode){const u=Le(n);s.assign(N4(s,u))}let l=a!==null?Ze(a):xce;return this.sizeAttenuation===!0&&(l=l.mul(l.div(Xn.z.negate()))),i&&i.isNode&&(l=l.mul(Ze(i))),s.mulAssign(l.mul(2)),s.assign(s.div(xf.z)),s.y.assign(s.y.mul(o)),s.assign(s.mul(t.w)),t.addAssign(wt(s,0,0)),t}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}class Tfe extends Rm{constructor(){super(),this.shadowNode=Le(1).toVar("shadowMask")}direct({lightNode:e}){this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){Qt.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(Qt.rgb)}}const wfe=new qZ;class Sfe extends ur{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(wfe),this.setValues(e)}setupLightingModel(){return new Tfe}}Gd("vec3");Gd("vec3");Gd("vec3");class Afe{constructor(e,t){this.nodes=e,this.info=t,this._context=self,this._animationLoop=null,this._requestId=null}start(){const e=(t,n)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this._animationLoop!==null&&this._animationLoop(t,n)};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class ls{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let n=this.weakMap;for(let i=0;i<e.length-1;i++){const a=e[i];n.has(a)===!1&&n.set(a,new WeakMap),n=n.get(a)}return n.set(e[e.length-1],t),this}delete(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return!1;return t.delete(e[e.length-1])}}let Mfe=0;function Cfe(r){const e=Object.keys(r);let t=Object.getPrototypeOf(r);for(;t;){const n=Object.getOwnPropertyDescriptors(t);for(const i in n)if(n[i]!==void 0){const a=n[i];a&&typeof a.get=="function"&&e.push(i)}t=Object.getPrototypeOf(t)}return e}class Rfe{constructor(e,t,n,i,a,s,o,l,u,c){this.id=Mfe++,this._nodes=e,this._geometries=t,this.renderer=n,this.object=i,this.material=a,this.scene=s,this.camera=o,this.lightsNode=l,this.context=u,this.geometry=i.geometry,this.version=a.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=c,this.clippingContextCacheKey=c!==null?c.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,n=[],i=new Set;for(const a of e){const s=a.node&&a.node.attribute?a.node.attribute:t.getAttribute(a.name);if(s===void 0)continue;n.push(s);const o=s.isInterleavedBufferAttribute?s.data:s;i.add(o)}return this.attributes=n,this.vertexBuffers=Array.from(i.values()),n}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:n,group:i,drawRange:a}=this,s=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),o=this.getIndex(),l=o!==null,u=n.isInstancedBufferGeometry?n.instanceCount:e.count>1?e.count:1;if(u===0)return null;if(s.instanceCount=u,e.isBatchedMesh===!0)return s;let c=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(c=2);let h=a.start*c,d=(a.start+a.count)*c;i!==null&&(h=Math.max(h,i.start*c),d=Math.min(d,(i.start+i.count)*c));const f=n.attributes.position;let p=1/0;l?p=o.count:f!=null&&(p=f.count),h=Math.max(h,0),d=Math.min(d,p);const m=d-h;return m<0||m===1/0?null:(s.vertexCount=m,s.firstVertex=h,s)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const n of Object.keys(e.attributes).sort()){const i=e.attributes[n];t+=n+",",i.data&&(t+=i.data.stride+","),i.offset&&(t+=i.offset+","),i.itemSize&&(t+=i.itemSize+","),i.normalized&&(t+="n,")}for(const n of Object.keys(e.morphAttributes).sort()){const i=e.morphAttributes[n];t+="morph-"+n+",";for(let a=0,s=i.length;a<s;a++){const o=i[a];t+=o.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t}=this;let n=t.customProgramCacheKey();for(const i of Cfe(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(i))continue;const a=t[i];let s;if(a!==null){const o=typeof a;o==="number"?s=a!==0?"1":"0":o==="object"?(s="{",a.isTexture&&(s+=a.mapping),s+="}"):s=String(a)}else s=String(a);n+=s+","}return n+=this.clippingContextCacheKey+",",e.geometry&&(n+=this.getGeometryCacheKey()),e.skeleton&&(n+=e.skeleton.bones.length+","),e.isBatchedMesh&&(n+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(n+=e._colorsTexture.uuid+",")),e.count>1&&(n+=e.uuid+","),n+=e.receiveShadow+",",Kse(n)}get needsGeometryUpdate(){return this.geometry.id!==this.object.geometry.id}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=ed(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=ed(e,1)),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}const vl=[];class Nfe{constructor(e,t,n,i,a,s){this.renderer=e,this.nodes=t,this.geometries=n,this.pipelines=i,this.bindings=a,this.info=s,this.chainMaps={}}get(e,t,n,i,a,s,o,l){const u=this.getChainMap(l);vl[0]=e,vl[1]=t,vl[2]=s,vl[3]=a;let c=u.get(vl);return c===void 0?(c=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,n,i,a,s,o,l),u.set(vl,c)):(c.updateClipping(o),c.needsGeometryUpdate&&c.setGeometry(e.geometry),(c.version!==t.version||c.needsUpdate)&&(c.initialCacheKey!==c.getCacheKey()?(c.dispose(),c=this.get(e,t,n,i,a,s,o,l)):c.version=t.version)),vl.length=0,c}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new ls)}dispose(){this.chainMaps={}}createRenderObject(e,t,n,i,a,s,o,l,u,c,h){const d=this.getChainMap(h),f=new Rfe(e,t,n,i,a,s,o,l,u,c);return f.onDispose=()=>{this.pipelines.delete(f),this.bindings.delete(f),this.nodes.delete(f),d.delete(f.getChainArray())},f}}class nl{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const ra={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},wo=16,Pfe=211,Dfe=212;class Lfe extends nl{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const n=this.get(e);if(n.version===void 0)t===ra.VERTEX?this.backend.createAttribute(e):t===ra.INDEX?this.backend.createIndexAttribute(e):t===ra.STORAGE?this.backend.createStorageAttribute(e):t===ra.INDIRECT&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{const i=this._getBufferAttribute(e);(n.version<i.version||i.usage===Ju)&&(this.backend.updateAttribute(e),n.version=i.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function D4(r){return r.index!==null?r.index.version:r.attributes.position.version}function DB(r){const e=[],t=r.index,n=r.attributes.position;if(t!==null){const a=t.array;for(let s=0,o=a.length;s<o;s+=3){const l=a[s+0],u=a[s+1],c=a[s+2];e.push(l,u,u,c,c,l)}}else{const a=n.array;for(let s=0,o=a.length/3-1;s<o;s+=3){const l=s+0,u=s+1,c=s+2;e.push(l,u,u,c,c,l)}}const i=new(qA(e)?KA:jA)(e,1);return i.version=D4(r),i}class Ife extends nl{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,n=this.get(t);n.initialized=!0,this.info.memory.geometries++;const i=()=>{this.info.memory.geometries--;const a=t.index,s=e.getAttributes();a!==null&&this.attributes.delete(a);for(const l of s)this.attributes.delete(l);const o=this.wireframes.get(t);o!==void 0&&this.attributes.delete(o),t.removeEventListener("dispose",i)};t.addEventListener("dispose",i)}updateAttributes(e){const t=e.getAttributes();for(const a of t)a.isStorageBufferAttribute||a.isStorageInstancedBufferAttribute?this.updateAttribute(a,ra.STORAGE):this.updateAttribute(a,ra.VERTEX);const n=this.getIndex(e);n!==null&&this.updateAttribute(n,ra.INDEX);const i=e.geometry.indirect;i!==null&&this.updateAttribute(i,ra.INDIRECT)}updateAttribute(e,t){const n=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:t,material:n}=e;let i=t.index;if(n.wireframe===!0){const a=this.wireframes;let s=a.get(t);s===void 0?(s=DB(t),a.set(t,s)):s.version!==D4(t)&&(this.attributes.delete(s),s=DB(t),a.set(t,s)),i=s}return i}}class Ofe{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=n*(t/3):e.isPoints?this.render.points+=n*t:e.isLineSegments?this.render.lines+=n*(t/2):e.isLine?this.render.lines+=n*(t-1):console.error("THREE.WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class L4{constructor(e){this.cacheKey=e,this.usedTimes=0}}class Ffe extends L4{constructor(e,t,n){super(e),this.vertexProgram=t,this.fragmentProgram=n}}class Bfe extends L4{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let Ufe=0;class W1{constructor(e,t,n,i=null,a=null){this.id=Ufe++,this.code=e,this.stage=t,this.name=n,this.transforms=i,this.attributes=a,this.usedTimes=0}}class kfe extends nl{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:n}=this,i=this.get(e);if(this._needsComputeUpdate(e)){const a=i.pipeline;a&&(a.usedTimes--,a.computeProgram.usedTimes--);const s=this.nodes.getForCompute(e);let o=this.programs.compute.get(s.computeShader);o===void 0&&(a&&a.computeProgram.usedTimes===0&&this._releaseProgram(a.computeProgram),o=new W1(s.computeShader,"compute",e.name,s.transforms,s.nodeAttributes),this.programs.compute.set(s.computeShader,o),n.createProgram(o));const l=this._getComputeCacheKey(e,o);let u=this.caches.get(l);u===void 0&&(a&&a.usedTimes===0&&this._releasePipeline(a),u=this._getComputePipeline(e,o,l,t)),u.usedTimes++,o.usedTimes++,i.version=e.version,i.pipeline=u}return i.pipeline}getForRender(e,t=null){const{backend:n}=this,i=this.get(e);if(this._needsRenderUpdate(e)){const a=i.pipeline;a&&(a.usedTimes--,a.vertexProgram.usedTimes--,a.fragmentProgram.usedTimes--);const s=e.getNodeBuilderState(),o=e.material?e.material.name:"";let l=this.programs.vertex.get(s.vertexShader);l===void 0&&(a&&a.vertexProgram.usedTimes===0&&this._releaseProgram(a.vertexProgram),l=new W1(s.vertexShader,"vertex",o),this.programs.vertex.set(s.vertexShader,l),n.createProgram(l));let u=this.programs.fragment.get(s.fragmentShader);u===void 0&&(a&&a.fragmentProgram.usedTimes===0&&this._releaseProgram(a.fragmentProgram),u=new W1(s.fragmentShader,"fragment",o),this.programs.fragment.set(s.fragmentShader,u),n.createProgram(u));const c=this._getRenderCacheKey(e,l,u);let h=this.caches.get(c);h===void 0?(a&&a.usedTimes===0&&this._releasePipeline(a),h=this._getRenderPipeline(e,l,u,c,t)):e.pipeline=h,h.usedTimes++,l.usedTimes++,u.usedTimes++,i.pipeline=h}return i.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,n,i){n=n||this._getComputeCacheKey(e,t);let a=this.caches.get(n);return a===void 0&&(a=new Bfe(n,t),this.caches.set(n,a),this.backend.createComputePipeline(a,i)),a}_getRenderPipeline(e,t,n,i,a){i=i||this._getRenderCacheKey(e,t,n);let s=this.caches.get(i);return s===void 0&&(s=new Ffe(i,t,n),this.caches.set(i,s),e.pipeline=s,this.backend.createRenderPipeline(e,a)),s}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,n){return t.id+","+n.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,n=e.stage;this.programs[n].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class Gfe extends nl{constructor(e,t,n,i,a,s){super(),this.backend=e,this.textures=n,this.pipelines=a,this.attributes=i,this.nodes=t,this.info=s,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const n of t){const i=this.get(n);i.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),i.bindGroup=n)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t){const i=this.get(n);i.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),i.bindGroup=n)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isStorageBuffer){const n=t.attribute,i=n.isIndirectStorageBufferAttribute?ra.INDIRECT:ra.STORAGE;this.attributes.update(n,i)}}_update(e,t){const{backend:n}=this;let i=!1,a=!0,s=0,o=0;for(const l of e.bindings)if(!(l.isNodeUniformsGroup&&this.nodes.updateGroup(l)===!1)){if(l.isStorageBuffer){const u=l.attribute,c=u.isIndirectStorageBufferAttribute?ra.INDIRECT:ra.STORAGE;this.attributes.update(u,c)}if(l.isUniformBuffer)l.update()&&n.updateBinding(l);else if(l.isSampler)l.update();else if(l.isSampledTexture){const u=this.textures.get(l.texture);l.needsBindingsUpdate(u.generation)&&(i=!0);const c=l.update(),h=l.texture;c&&this.textures.updateTexture(h);const d=n.get(h);if(d.externalTexture!==void 0||u.isDefaultTexture?a=!1:(s=s*10+h.id,o+=h.version),n.isWebGPUBackend===!0&&d.texture===void 0&&d.externalTexture===void 0&&(console.error("Bindings._update: binding should be available:",l,c,h,l.textureNode.value,i),this.textures.updateTexture(h),i=!0),h.isStorageTexture===!0){const f=this.get(h);l.store===!0?f.needsMipmap=!0:this.textures.needsMipmaps(h)&&f.needsMipmap===!0&&(this.backend.generateMipmaps(h),f.needsMipmap=!1)}}}i===!0&&this.backend.updateBindings(e,t,a?s:0,o)}}function zfe(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function LB(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function IB(r){return(r.transmission>0||r.transmissionNode)&&r.side===Qr&&r.forceSinglePass===!1}class Vfe{constructor(e,t,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,n),this.lightsArray=[],this.scene=t,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,n,i,a,s,o){let l=this.renderItems[this.renderItemsIndex];return l===void 0?(l={id:e.id,object:e,geometry:t,material:n,groupOrder:i,renderOrder:e.renderOrder,z:a,group:s,clippingContext:o},this.renderItems[this.renderItemsIndex]=l):(l.id=e.id,l.object=e,l.geometry=t,l.material=n,l.groupOrder=i,l.renderOrder=e.renderOrder,l.z=a,l.group=s,l.clippingContext=o),this.renderItemsIndex++,l}push(e,t,n,i,a,s,o){const l=this.getNextRenderItem(e,t,n,i,a,s,o);e.occlusionTest===!0&&this.occlusionQueryCount++,n.transparent===!0||n.transmission>0?(IB(n)&&this.transparentDoublePass.push(l),this.transparent.push(l)):this.opaque.push(l)}unshift(e,t,n,i,a,s,o){const l=this.getNextRenderItem(e,t,n,i,a,s,o);n.transparent===!0||n.transmission>0?(IB(n)&&this.transparentDoublePass.unshift(l),this.transparent.unshift(l)):this.opaque.unshift(l)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||zfe),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||LB),this.transparent.length>1&&this.transparent.sort(t||LB)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const n=this.renderItems[e];if(n.id===null)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.groupOrder=null,n.renderOrder=null,n.z=null,n.group=null,n.clippingContext=null}}}const Gh=[];class Hfe{constructor(e){this.lighting=e,this.lists=new ls}get(e,t){const n=this.lists;Gh[0]=e,Gh[1]=t;let i=n.get(Gh);return i===void 0&&(i=new Vfe(this.lighting,e,t),n.set(Gh,i)),Gh.length=0,i}dispose(){this.lists=new ls}}let Wfe=0;class qfe{constructor(){this.id=Wfe++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new xt,this.scissor=!1,this.scissorValue=new xt,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return I4(this)}}function I4(r){const{textures:e,activeCubeFace:t}=r,n=[t];for(const i of e)n.push(i.id);return vM(n)}const zh=[],$fe=new cm,Xfe=new QA;class Yfe{constructor(){this.chainMaps={}}get(e,t,n=null){zh[0]=e,zh[1]=t;let i;if(n===null)i="default";else{const o=n.texture.format;i=`${n.textures.length}:${o}:${n.samples}:${n.depthBuffer}:${n.stencilBuffer}`}const a=this._getChainMap(i);let s=a.get(zh);return s===void 0&&(s=new qfe,a.set(zh,s)),zh.length=0,n!==null&&(s.sampleCount=n.samples===0?1:n.samples),s}getForClear(e=null){return this.get($fe,Xfe,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new ls)}dispose(){this.chainMaps={}}}const jfe=new re;class Kfe extends nl{constructor(e,t,n){super(),this.renderer=e,this.backend=t,this.info=n}updateRenderTarget(e,t=0){const n=this.get(e),i=e.samples===0?1:e.samples,a=n.depthTextureMips||(n.depthTextureMips={}),s=e.textures,o=this.getSize(s[0]),l=o.width>>t,u=o.height>>t;let c=e.depthTexture||a[t];const h=e.depthBuffer===!0||e.stencilBuffer===!0;let d=!1;c===void 0&&h&&(c=new sa,c.format=e.stencilBuffer?Vi:zi,c.type=e.stencilBuffer?Gi:hn,c.image.width=l,c.image.height=u,a[t]=c),(n.width!==o.width||o.height!==n.height)&&(d=!0,c&&(c.needsUpdate=!0,c.image.width=l,c.image.height=u)),n.width=o.width,n.height=o.height,n.textures=s,n.depthTexture=c||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==i&&(d=!0,c&&(c.needsUpdate=!0),n.sampleCount=i);const f={sampleCount:i};if(e.isXRRenderTarget!==!0){for(let p=0;p<s.length;p++){const m=s[p];d&&(m.needsUpdate=!0),this.updateTexture(m,f)}c&&this.updateTexture(c,f)}if(n.initialized!==!0){n.initialized=!0;const p=()=>{e.removeEventListener("dispose",p);for(let m=0;m<s.length;m++)this._destroyTexture(s[m]);c&&this._destroyTexture(c),this.delete(e)};e.addEventListener("dispose",p)}}updateTexture(e,t={}){const n=this.get(e);if(n.initialized===!0&&n.version===e.version)return;const i=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,a=this.backend;if(i&&n.initialized===!0&&(a.destroySampler(e),a.destroyTexture(e)),e.isFramebufferTexture){const u=this.renderer.getRenderTarget();u?e.type=u.texture.type:e.type=In}const{width:s,height:o,depth:l}=this.getSize(e);if(t.width=s,t.height=o,t.depth=l,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,s,o):1,i||e.isStorageTexture===!0)a.createSampler(e),a.createTexture(e,t),n.generation=e.version;else if(n.initialized!==!0&&a.createSampler(e),e.version>0){const c=e.image;if(c===void 0)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(c.complete===!1)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const h=[];for(const d of e.images)h.push(d);t.images=h}else t.image=c;(n.isDefaultTexture===void 0||n.isDefaultTexture===!0)&&(a.createTexture(e,t),n.isDefaultTexture=!1,n.generation=e.version),e.source.dataReady===!0&&a.updateTexture(e,t),t.needsMipmaps&&e.mipmaps.length===0&&a.generateMipmaps(e)}}else a.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version;if(n.initialized!==!0){n.initialized=!0,n.generation=e.version,this.info.memory.textures++;const u=()=>{e.removeEventListener("dispose",u),this._destroyTexture(e),this.info.memory.textures--};e.addEventListener("dispose",u)}n.version=e.version}getSize(e,t=jfe){let n=e.images?e.images[0]:e.image;return n?(n.image!==void 0&&(n=n.image),t.width=n.width||1,t.height=n.height||1,t.depth=e.isCubeTexture?6:n.depth||1):t.width=t.height=t.depth=1,t}getMipLevels(e,t,n){let i;return e.isCompressedTexture?e.mipmaps?i=e.mipmaps.length:i=1:i=Math.floor(Math.log2(Math.max(t,n)))+1,i}needsMipmaps(e){return this.isEnvironmentTexture(e)||e.isCompressedTexture===!0||e.generateMipmaps}isEnvironmentTexture(e){const t=e.mapping;return t===Wo||t===qo||t===la||t===ua}_destroyTexture(e){this.backend.destroySampler(e),this.backend.destroyTexture(e),this.delete(e)}}class zM extends ct{constructor(e,t,n,i=1){super(e,t,n),this.a=i}set(e,t,n,i=1){return this.a=i,super.set(e,t,n)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class Qfe extends rn{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}class Zfe extends At{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.outputNode?this.outputNode.getMemberType(e,t):"void"}add(e){return this.nodes.push(e),this}If(e,t){const n=new Ag(t);return this._currentCond=pi(e,n),this.add(this._currentCond)}ElseIf(e,t){const n=new Ag(t),i=pi(e,n);return this._currentCond.elseNode=i,this._currentCond=i,this}Else(e){return this._currentCond.elseNode=new Ag(e),this}build(e,...t){const n=AV();lv(this);for(const i of this.nodes)i.build(e,"void");return lv(n),this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}else(...e){return console.warn("THREE.TSL: .else() has been renamed to .Else()."),this.Else(...e)}elseif(...e){return console.warn("THREE.TSL: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...e)}}const q1=Ge(Zfe).setParameterLength(0,1);new Sa;new re;new re;new re;new Ut;new re(0,0,-1);new xt;new re;new re;new xt;new He;const Jfe=new ou;od.flipX();Jfe.depthTexture=new sa(1,1);const $1=new Fd(-1,1,1,-1,0,1);class ede extends ri{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new kn([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new kn(t,2))}}const tde=new ede;class O4 extends Yn{constructor(e=null){super(tde,e),this.camera=$1,this.isQuadMesh=!0}async renderAsync(e){return e.renderAsync(this,$1)}render(e){e.render(this,$1)}}const Vh=new Ei,X1=new Ut;class vi extends At{static get type(){return"SceneNode"}constructor(e=vi.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,n=this.scene!==null?this.scene:e.scene;let i;return t===vi.BACKGROUND_BLURRINESS?i=cn("backgroundBlurriness","float",n):t===vi.BACKGROUND_INTENSITY?i=cn("backgroundIntensity","float",n):t===vi.BACKGROUND_ROTATION?i=St("mat4").label("backgroundRotation").setGroup(bt).onRenderUpdate(()=>{const a=n.background;return a!==null&&a.isTexture&&a.mapping!==DA?(Vh.copy(n.backgroundRotation),Vh.x*=-1,Vh.y*=-1,Vh.z*=-1,X1.makeRotationFromEuler(Vh)):X1.identity(),X1}):console.error("THREE.SceneNode: Unknown scope:",t),i}}vi.BACKGROUND_BLURRINESS="backgroundBlurriness";vi.BACKGROUND_INTENSITY="backgroundIntensity";vi.BACKGROUND_ROTATION="backgroundRotation";const nde=Qe(vi,vi.BACKGROUND_BLURRINESS),OB=Qe(vi,vi.BACKGROUND_INTENSITY),rde=Qe(vi,vi.BACKGROUND_ROTATION);qe(({texture:r,uv:e})=>{const n=Fe().toVar();return Gn(e.x.lessThan(1e-4),()=>{n.assign(Fe(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{n.assign(Fe(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{n.assign(Fe(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{n.assign(Fe(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{n.assign(Fe(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{n.assign(Fe(0,0,-1))}).Else(()=>{const a=r.sample(e.add(Fe(-.01,0,0))).r.sub(r.sample(e.add(Fe(.01,0,0))).r),s=r.sample(e.add(Fe(0,-.01,0))).r.sub(r.sample(e.add(Fe(0,.01,0))).r),o=r.sample(e.add(Fe(0,0,-.01))).r.sub(r.sample(e.add(Fe(0,0,.01))).r);n.assign(Fe(a,s,o))}),n.normalize()});const Wp=new He;class ide extends Hd{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class FB extends ide{static get type(){return"PassMultipleTextureNode"}constructor(e,t,n=!1){super(e,null),this.textureName=t,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class Pm extends zn{static get type(){return"PassNode"}constructor(e,t,n,i={}){super("vec4"),this.scope=e,this.scene=t,this.camera=n,this.options=i,this._pixelRatio=1,this._width=1,this._height=1;const a=new sa;a.isRenderTargetTexture=!0,a.name="depth";const s=new ou(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:kr,...i});s.texture.name="output",s.depthTexture=a,this.renderTarget=s,this._textures={output:s.texture,depth:a},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=St(0),this._cameraFar=St(0),this._mrt=null,this._layers=null,this._resolution=1,this.isPassNode=!0,this.updateBeforeType=Lt.FRAME}setResolution(e){return this._resolution=e,this}getResolution(){return this._resolution}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}isGlobal(){return!0}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const n=this._textures[e],i=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[i]=t,this._textures[e]=t,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=We(new FB(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=We(new FB(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const n=this._cameraNear,i=this._cameraFar;this._viewZNodes[e]=t=h4(this.getTextureNode(e),n,i)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const n=this._cameraNear,i=this._cameraFar,a=this.getViewZNode(e);this._linearDepthNodes[e]=t=bf(a,n,i)}return t}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,e.backend.isWebGLBackend===!0&&(this.renderTarget.samples=0),this.renderTarget.texture.type=e.getColorBufferType(),this.scope===Pm.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:n}=this;let i,a;const s=t.getOutputRenderTarget();s&&s.isXRRenderTarget===!0?(a=1,i=t.xr.getCamera(),t.xr.updateCamera(i),Wp.set(s.width,s.height)):(i=this.camera,a=t.getPixelRatio(),t.getSize(Wp)),this._pixelRatio=a,this.setSize(Wp.width,Wp.height);const o=t.getRenderTarget(),l=t.getMRT(),u=i.layers.mask;this._cameraNear.value=i.near,this._cameraFar.value=i.far,this._layers!==null&&(i.layers.mask=this._layers.mask);for(const c in this._previousTextures)this.toggleTexture(c);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.render(n,i),t.setRenderTarget(o),t.setMRT(l),i.layers.mask=u}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio*this._resolution,i=this._height*this._pixelRatio*this._resolution;this.renderTarget.setSize(n,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Pm.COLOR="color";Pm.DEPTH="depth";const ade=qe(([r,e])=>r.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),sde=qe(([r,e])=>(r=r.mul(e),r.div(r.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),ode=qe(([r,e])=>{r=r.mul(e),r=r.sub(.004).max(0);const t=r.mul(r.mul(6.2).add(.5)),n=r.mul(r.mul(6.2).add(1.7)).add(.06);return t.div(n).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),lde=qe(([r])=>{const e=r.mul(r.add(.0245786)).sub(90537e-9),t=r.mul(r.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),ude=qe(([r,e])=>{const t=Jr(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),n=Jr(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return r=r.mul(e).div(.6),r=t.mul(r),r=lde(r),r=n.mul(r),r.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),cde=Jr(Fe(1.6605,-.1246,-.0182),Fe(-.5876,1.1329,-.1006),Fe(-.0728,-.0083,1.1187)),hde=Jr(Fe(.6274,.0691,.0164),Fe(.3293,.9195,.088),Fe(.0433,.0113,.8956)),fde=qe(([r])=>{const e=Fe(r).toVar(),t=Fe(e.mul(e)).toVar(),n=Fe(t.mul(t)).toVar();return Le(15.5).mul(n.mul(t)).sub(Bt(40.14,n.mul(e))).add(Bt(31.96,n).sub(Bt(6.868,t.mul(e))).add(Bt(.4298,t).add(Bt(.1191,e).sub(.00232))))}),dde=qe(([r,e])=>{const t=Fe(r).toVar(),n=Jr(Fe(.856627153315983,.137318972929847,.11189821299995),Fe(.0951212405381588,.761241990602591,.0767994186031903),Fe(.0482516061458583,.101439036467562,.811302368396859)),i=Jr(Fe(1.1271005818144368,-.1413297634984383,-.14132976349843826),Fe(-.11060664309660323,1.157823702216272,-.11060664309660294),Fe(-.016493938717834573,-.016493938717834257,1.2519364065950405)),a=Le(-12.47393),s=Le(4.026069);return t.mulAssign(e),t.assign(hde.mul(t)),t.assign(n.mul(t)),t.assign(Ti(t,1e-10)),t.assign(Hs(t)),t.assign(t.sub(a).div(s.sub(a))),t.assign(js(t,0,1)),t.assign(fde(t)),t.assign(i.mul(t)),t.assign(Tm(Ti(Fe(0),t),Fe(2.2))),t.assign(cde.mul(t)),t.assign(js(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),pde=qe(([r,e])=>{const t=Le(.76),n=Le(.15);r=r.mul(e);const i=rd(r.r,rd(r.g,r.b)),a=pi(i.lessThan(.08),i.sub(Bt(6.25,i.mul(i))),.04);r.subAssign(a);const s=Ti(r.r,Ti(r.g,r.b));Gn(s.lessThan(t),()=>r);const o=ci(1,t),l=ci(1,o.mul(o).div(s.add(o.sub(t))));r.mulAssign(l.div(s));const u=ci(1,Ys(1,n.mul(s.sub(l)).add(1)));return _n(r,Fe(l),u)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class Jn extends At{static get type(){return"CodeNode"}constructor(e="",t=[],n=""){super("code"),this.isCodeNode=!0,this.code=e,this.includes=t,this.language=n}isGlobal(){return!0}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const i of t)i.build(e);const n=e.getCodeFromNode(this,this.getNodeType(e));return n.code=this.code,n.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}class gde extends Jn{static get type(){return"FunctionNode"}constructor(e="",t=[],n=""){super(e,t,n)}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let n=t.nodeFunction;return n===void 0&&(n=e.parser.parseFunction(this.code),t.nodeFunction=n),n}generate(e,t){super.generate(e);const n=this.getNodeFunction(e),i=n.name,a=n.type,s=e.getCodeFromNode(this,a);i!==""&&(s.name=i);const o=e.getPropertyName(s),l=this.getNodeFunction(e).getCode(o);return s.code=l+`
`,t==="property"?o:e.format(`${o}()`,a,t)}}function F4(r){let e;const t=r.context.getViewZ;return t!==void 0&&(e=t(this)),(e||Xn.z).negate()}const vde=qe(([r,e],t)=>{const n=F4(t);return Yo(r,e,n)}),mde=qe(([r],e)=>{const t=F4(e);return r.mul(r,t,t).negate().exp().oneMinus()}),BB=qe(([r,e])=>wt(e.toFloat().mix(yf.rgb,r.toVec3()),yf.a));class yde extends At{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:n}=e;n.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}Ge(yde);class ds extends zn{static get type(){return"AtomicFunctionNode"}constructor(e,t,n){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=n}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=this.method,n=this.getNodeType(e),i=this.getInputType(e),a=this.pointerNode,s=this.valueNode,o=[];o.push(`&${a.build(e,i)}`),s!==null&&o.push(s.build(e,i));const l=`${e.getMethod(t,n)}( ${o.join(", ")} )`;return s!==null&&e.addLineFlowCode(l,this),l}}ds.ATOMIC_LOAD="atomicLoad";ds.ATOMIC_STORE="atomicStore";ds.ATOMIC_ADD="atomicAdd";ds.ATOMIC_SUB="atomicSub";ds.ATOMIC_MAX="atomicMax";ds.ATOMIC_MIN="atomicMin";ds.ATOMIC_AND="atomicAnd";ds.ATOMIC_OR="atomicOr";ds.ATOMIC_XOR="atomicXor";Ge(ds);let qp;function Dm(r){qp=qp||new WeakMap;let e=qp.get(r);return e===void 0&&qp.set(r,e={}),e}function B4(r){const e=Dm(r);return e.shadowMatrix||(e.shadowMatrix=St("mat4").setGroup(bt).onRenderUpdate(()=>(r.castShadow!==!0&&r.shadow.updateMatrices(r),r.shadow.matrix)))}function _de(r,e=ad){const t=B4(r).mul(e);return t.xyz.div(t.w)}function U4(r){const e=Dm(r);return e.position||(e.position=St(new re).setGroup(bt).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(r.matrixWorld)))}function xde(r){const e=Dm(r);return e.targetPosition||(e.targetPosition=St(new re).setGroup(bt).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(r.target.matrixWorld)))}function k4(r){const e=Dm(r);return e.viewPosition||(e.viewPosition=St(new re).setGroup(bt).onRenderUpdate(({camera:t},n)=>{n.value=n.value||new re,n.value.setFromMatrixPosition(r.matrixWorld),n.value.applyMatrix4(t.matrixWorldInverse)}))}const G4=r=>io.transformDirection(U4(r).sub(xde(r))),bde=r=>r.sort((e,t)=>e.id-t.id),Ede=(r,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===r)return t;return null},Y1=new WeakMap;class z4 extends At{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=Fe().toVar(),this.totalSpecularNode=Fe().toVar(),this.outgoingLightNode=Fe().toVar(),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=[],t=this._lights;for(let n=0;n<t.length;n++)e.push(t[n].id);return vM(e)}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const n of this._lightNodes)t.push(n.getSelf().getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getDataFromNode(this);for(const n of t.nodes)n.build(e)}setupLightsNode(e){const t=[],n=this._lightNodes,i=bde(this._lights),a=e.renderer.library;for(const s of i)if(s.isNode)t.push(We(s));else{let o=null;if(n!==null&&(o=Ede(s.id,n)),o===null){const l=a.getLightNodeClass(s.constructor);if(l===null){console.warn(`LightsNode.setupNodeLights: Light node not found for ${s.constructor.name}`);continue}let u=null;Y1.has(s)?u=Y1.get(s):(u=We(new l(s)),Y1.set(s,u)),t.push(u)}}this._lightNodes=t}setupDirectLight(e,t,n){const{lightingModel:i,reflectedLight:a}=e.context;i.direct({...n,lightNode:t,reflectedLight:a},e)}setupDirectRectAreaLight(e,t,n){const{lightingModel:i,reflectedLight:a}=e.context;i.directRectArea({...n,lightNode:t,reflectedLight:a},e)}setupLights(e,t){for(const n of t)n.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let n=this.outgoingLightNode;const i=e.context,a=i.lightingModel,s=e.getDataFromNode(this);if(a){const{totalDiffuseNode:o,totalSpecularNode:l}=this;i.outgoingLight=n;const u=e.addStack();s.nodes=u.nodes,a.start(e);const{backdrop:c,backdropAlpha:h}=i,{directDiffuse:d,directSpecular:f,indirectDiffuse:p,indirectSpecular:m}=i.reflectedLight;let v=d.add(p);c!==null&&(h!==null?v=Fe(h.mix(v,c)):v=Fe(c),i.material.transparent=!0),o.assign(v),l.assign(f.add(m)),n.assign(o.add(l)),a.finish(e),n=n.bypass(e.removeStack())}else s.nodes=[];return e.lightsNode=t,n}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class Tde extends At{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=Lt.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){V4.assign(t.shadowPositionNode||e.shadowPositionWorld||ad)}dispose(){this.updateBeforeType=Lt.NONE}}const V4=Gd("vec3","shadowPositionWorld");function wde(r,e={}){return e.toneMapping=r.toneMapping,e.toneMappingExposure=r.toneMappingExposure,e.outputColorSpace=r.outputColorSpace,e.renderTarget=r.getRenderTarget(),e.activeCubeFace=r.getActiveCubeFace(),e.activeMipmapLevel=r.getActiveMipmapLevel(),e.renderObjectFunction=r.getRenderObjectFunction(),e.pixelRatio=r.getPixelRatio(),e.mrt=r.getMRT(),e.clearColor=r.getClearColor(e.clearColor||new ct),e.clearAlpha=r.getClearAlpha(),e.autoClear=r.autoClear,e.scissorTest=r.getScissorTest(),e}function Sde(r,e){return e=wde(r,e),r.setMRT(null),r.setRenderObjectFunction(null),r.setClearColor(0,1),r.autoClear=!0,e}function Ade(r,e){r.toneMapping=e.toneMapping,r.toneMappingExposure=e.toneMappingExposure,r.outputColorSpace=e.outputColorSpace,r.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),r.setRenderObjectFunction(e.renderObjectFunction),r.setPixelRatio(e.pixelRatio),r.setMRT(e.mrt),r.setClearColor(e.clearColor,e.clearAlpha),r.autoClear=e.autoClear,r.setScissorTest(e.scissorTest)}function Mde(r,e={}){return e.background=r.background,e.backgroundNode=r.backgroundNode,e.overrideMaterial=r.overrideMaterial,e}function Cde(r,e){return e=Mde(r,e),r.background=null,r.backgroundNode=null,r.overrideMaterial=null,e}function Rde(r,e){r.background=e.background,r.backgroundNode=e.backgroundNode,r.overrideMaterial=e.overrideMaterial}function Nde(r,e,t){return t=Sde(r,t),t=Cde(e,t),t}function Pde(r,e,t){Ade(r,t),Rde(e,t)}const UB=new WeakMap,Dde=qe(([r,e,t])=>{let n=ad.sub(r).length();return n=n.sub(e).div(t.sub(e)),n=n.saturate(),n}),Lde=r=>{const e=r.shadow.camera,t=cn("near","float",e).setGroup(bt),n=cn("far","float",e).setGroup(bt),i=Eue(r);return Dde(i,t,n)},Ide=r=>{let e=UB.get(r);if(e===void 0){const t=r.isPointLight?Lde(r):null;e=new ur,e.colorNode=wt(0,0,0,1),e.depthNode=t,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,UB.set(r,e)}return e},Ode=qe(({depthTexture:r,shadowCoord:e})=>qt(r,e.xy).compare(e.z)),Fde=qe(({depthTexture:r,shadowCoord:e,shadow:t})=>{const n=(m,v)=>qt(r,m).compare(v),i=cn("mapSize","vec2",t).setGroup(bt),a=cn("radius","float",t).setGroup(bt),s=Ze(1).div(i),o=s.x.negate().mul(a),l=s.y.negate().mul(a),u=s.x.mul(a),c=s.y.mul(a),h=o.div(2),d=l.div(2),f=u.div(2),p=c.div(2);return ei(n(e.xy.add(Ze(o,l)),e.z),n(e.xy.add(Ze(0,l)),e.z),n(e.xy.add(Ze(u,l)),e.z),n(e.xy.add(Ze(h,d)),e.z),n(e.xy.add(Ze(0,d)),e.z),n(e.xy.add(Ze(f,d)),e.z),n(e.xy.add(Ze(o,0)),e.z),n(e.xy.add(Ze(h,0)),e.z),n(e.xy,e.z),n(e.xy.add(Ze(f,0)),e.z),n(e.xy.add(Ze(u,0)),e.z),n(e.xy.add(Ze(h,p)),e.z),n(e.xy.add(Ze(0,p)),e.z),n(e.xy.add(Ze(f,p)),e.z),n(e.xy.add(Ze(o,c)),e.z),n(e.xy.add(Ze(0,c)),e.z),n(e.xy.add(Ze(u,c)),e.z)).mul(1/17)}),Bde=qe(({depthTexture:r,shadowCoord:e,shadow:t})=>{const n=(c,h)=>qt(r,c).compare(h),i=cn("mapSize","vec2",t).setGroup(bt),a=Ze(1).div(i),s=a.x,o=a.y,l=e.xy,u=tl(l.mul(i).add(.5));return l.subAssign(u.mul(a)),ei(n(l,e.z),n(l.add(Ze(s,0)),e.z),n(l.add(Ze(0,o)),e.z),n(l.add(a),e.z),_n(n(l.add(Ze(s.negate(),0)),e.z),n(l.add(Ze(s.mul(2),0)),e.z),u.x),_n(n(l.add(Ze(s.negate(),o)),e.z),n(l.add(Ze(s.mul(2),o)),e.z),u.x),_n(n(l.add(Ze(0,o.negate())),e.z),n(l.add(Ze(0,o.mul(2))),e.z),u.y),_n(n(l.add(Ze(s,o.negate())),e.z),n(l.add(Ze(s,o.mul(2))),e.z),u.y),_n(_n(n(l.add(Ze(s.negate(),o.negate())),e.z),n(l.add(Ze(s.mul(2),o.negate())),e.z),u.x),_n(n(l.add(Ze(s.negate(),o.mul(2))),e.z),n(l.add(Ze(s.mul(2),o.mul(2))),e.z),u.x),u.y)).mul(1/9)}),Ude=qe(({depthTexture:r,shadowCoord:e})=>{const t=Le(1).toVar(),n=qt(r).sample(e.xy).rg,i=VV(e.z,n.x);return Gn(i.notEqual(Le(1)),()=>{const a=e.z.sub(n.x),s=Ti(0,n.y.mul(n.y));let o=s.div(s.add(a.mul(a)));o=js(ci(o,.3).div(.95-.3)),t.assign(js(Ti(i,o)))}),t}),kde=qe(({samples:r,radius:e,size:t,shadowPass:n})=>{const i=Le(0).toVar(),a=Le(0).toVar(),s=r.lessThanEqual(Le(1)).select(Le(0),Le(2).div(r.sub(1))),o=r.lessThanEqual(Le(1)).select(Le(0),Le(-1));Ra({start:Rn(0),end:Rn(r),type:"int",condition:"<"},({i:u})=>{const c=o.add(Le(u).mul(s)),h=n.sample(ei(Cm.xy,Ze(0,c).mul(e)).div(t)).x;i.addAssign(h),a.addAssign(h.mul(h))}),i.divAssign(r),a.divAssign(r);const l=SM(a.sub(i.mul(i)));return Ze(i,l)}),Gde=qe(({samples:r,radius:e,size:t,shadowPass:n})=>{const i=Le(0).toVar(),a=Le(0).toVar(),s=r.lessThanEqual(Le(1)).select(Le(0),Le(2).div(r.sub(1))),o=r.lessThanEqual(Le(1)).select(Le(0),Le(-1));Ra({start:Rn(0),end:Rn(r),type:"int",condition:"<"},({i:u})=>{const c=o.add(Le(u).mul(s)),h=n.sample(ei(Cm.xy,Ze(c,0).mul(e)).div(t));i.addAssign(h.x),a.addAssign(ei(h.y.mul(h.y),h.x.mul(h.x)))}),i.divAssign(r),a.divAssign(r);const l=SM(a.sub(i.mul(i)));return Ze(i,l)}),zde=[Ode,Fde,Bde,Ude];let j1;const $p=new O4;class H4 extends Tde{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0}setupShadowFilter(e,{filterFn:t,depthTexture:n,shadowCoord:i,shadow:a}){const s=i.x.greaterThanEqual(0).and(i.x.lessThanEqual(1)).and(i.y.greaterThanEqual(0)).and(i.y.lessThanEqual(1)).and(i.z.lessThanEqual(1)),o=t({depthTexture:n,shadowCoord:i,shadow:a});return s.select(o,Le(1))}setupShadowCoord(e,t){const{shadow:n}=this,{renderer:i}=e,a=cn("bias","float",n).setGroup(bt);let s=t,o;if(n.camera.isOrthographicCamera||i.logarithmicDepthBuffer!==!0)s=s.xyz.div(s.w),o=s.z,i.coordinateSystem===$o&&(o=o.mul(2).sub(1));else{const l=s.w;s=s.xy.div(l);const u=cn("near","float",n.camera).setGroup(bt),c=cn("far","float",n.camera).setGroup(bt);o=f4(l.negate(),u,c)}return s=Fe(s.x,s.y.oneMinus(),o.add(a)),s}getShadowFilterFn(e){return zde[e]}setupShadow(e){const{renderer:t}=e,{light:n,shadow:i}=this,a=t.shadowMap.type,s=new sa(i.mapSize.width,i.mapSize.height);s.compareFunction=sm;const o=e.createRenderTarget(i.mapSize.width,i.mapSize.height);if(o.depthTexture=s,i.camera.updateProjectionMatrix(),a===Fi){s.compareFunction=null,this.vsmShadowMapVertical=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Ql,type:kr}),this.vsmShadowMapHorizontal=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Ql,type:kr});const g=qt(s),y=qt(this.vsmShadowMapVertical.texture),_=cn("blurSamples","float",i).setGroup(bt),x=cn("radius","float",i).setGroup(bt),E=cn("mapSize","vec2",i).setGroup(bt);let T=this.vsmMaterialVertical||(this.vsmMaterialVertical=new ur);T.fragmentNode=kde({samples:_,radius:x,size:E,shadowPass:g}).context(e.getSharedContext()),T.name="VSMVertical",T=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new ur),T.fragmentNode=Gde({samples:_,radius:x,size:E,shadowPass:y}).context(e.getSharedContext()),T.name="VSMHorizontal"}const l=cn("intensity","float",i).setGroup(bt),u=cn("normalBias","float",i).setGroup(bt),c=B4(n).mul(V4.add(IM.mul(u))),h=this.setupShadowCoord(e,c),d=i.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(d===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const f=a===Fi?this.vsmShadowMapHorizontal.texture:s,p=this.setupShadowFilter(e,{filterFn:d,shadowTexture:o.texture,depthTexture:f,shadowCoord:h,shadow:i}),m=qt(o.texture,h),v=_n(1,p.rgb.mix(m,1),l.mul(m.a)).toVar();return this.shadowMap=o,this.shadow.map=o,v}setup(e){if(e.renderer.shadowMap.enabled!==!1)return qe(()=>{let t=this._node;return this.setupShadowPosition(e),t===null&&(this._node=t=this.setupShadow(e)),e.material.shadowNode&&console.warn('THREE.NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(t=e.material.receivedShadowNode(t)),t})()}renderShadow(e){const{shadow:t,shadowMap:n,light:i}=this,{renderer:a,scene:s}=e;t.updateMatrices(i),n.setSize(t.mapSize.width,t.mapSize.height),a.render(s,t.camera)}updateShadow(e){const{shadowMap:t,light:n,shadow:i}=this,{renderer:a,scene:s,camera:o}=e,l=a.shadowMap.type,u=t.depthTexture.version;this._depthVersionCached=u,i.camera.layers.mask=o.layers.mask;const c=a.getRenderObjectFunction(),h=a.getMRT(),d=h?h.has("velocity"):!1;j1=Nde(a,s,j1),s.overrideMaterial=Ide(n),a.setRenderObjectFunction((f,p,m,v,g,y,..._)=>{(f.castShadow===!0||f.receiveShadow&&l===Fi)&&(d&&(bV(f).useVelocity=!0),f.onBeforeShadow(a,f,o,i.camera,v,p.overrideMaterial,y),a.renderObject(f,p,m,v,g,y,..._),f.onAfterShadow(a,f,o,i.camera,v,p.overrideMaterial,y))}),a.setRenderTarget(t),this.renderShadow(e),a.setRenderObjectFunction(c),n.isPointLight!==!0&&l===Fi&&this.vsmPass(a),Pde(a,s,j1)}vsmPass(e){const{shadow:t}=this;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height),e.setRenderTarget(this.vsmShadowMapVertical),$p.material=this.vsmMaterialVertical,$p.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),$p.material=this.vsmMaterialHorizontal,$p.render(e)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),super.dispose()}updateBefore(e){const{shadow:t}=this;let n=t.needsUpdate||t.autoUpdate;n&&(this._cameraFrameId[e.camera]===e.frameId&&(n=!1),this._cameraFrameId[e.camera]=e.frameId),n&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const Vde=(r,e)=>We(new H4(r,e)),Hde=new ct,Ka=qe(([r,e])=>{const t=r.toVar(),n=Ji(t),i=Ys(1,Ti(n.x,Ti(n.y,n.z)));n.mulAssign(i),t.mulAssign(i.mul(e.mul(2).oneMinus()));const a=Ze(t.xy).toVar(),o=e.mul(1.5).oneMinus();return Gn(n.z.greaterThanEqual(o),()=>{Gn(t.z.greaterThan(0),()=>{a.x.assign(ci(4,t.x))})}).ElseIf(n.x.greaterThanEqual(o),()=>{const l=dv(t.x);a.x.assign(t.z.mul(l).add(l.mul(2)))}).ElseIf(n.y.greaterThanEqual(o),()=>{const l=dv(t.y);a.x.assign(t.x.add(l.mul(2)).add(2)),a.y.assign(t.z.mul(l).sub(2))}),Ze(.125,.25).mul(a).add(Ze(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),Wde=qe(({depthTexture:r,bd3D:e,dp:t,texelSize:n})=>qt(r,Ka(e,n.y)).compare(t)),qde=qe(({depthTexture:r,bd3D:e,dp:t,texelSize:n,shadow:i})=>{const a=cn("radius","float",i).setGroup(bt),s=Ze(-1,1).mul(a).mul(n.y);return qt(r,Ka(e.add(s.xyy),n.y)).compare(t).add(qt(r,Ka(e.add(s.yyy),n.y)).compare(t)).add(qt(r,Ka(e.add(s.xyx),n.y)).compare(t)).add(qt(r,Ka(e.add(s.yyx),n.y)).compare(t)).add(qt(r,Ka(e,n.y)).compare(t)).add(qt(r,Ka(e.add(s.xxy),n.y)).compare(t)).add(qt(r,Ka(e.add(s.yxy),n.y)).compare(t)).add(qt(r,Ka(e.add(s.xxx),n.y)).compare(t)).add(qt(r,Ka(e.add(s.yxx),n.y)).compare(t)).mul(1/9)}),$de=qe(({filterFn:r,depthTexture:e,shadowCoord:t,shadow:n})=>{const i=t.xyz.toVar(),a=i.length(),s=St("float").setGroup(bt).onRenderUpdate(()=>n.camera.near),o=St("float").setGroup(bt).onRenderUpdate(()=>n.camera.far),l=cn("bias","float",n).setGroup(bt),u=St(n.mapSize).setGroup(bt),c=Le(1).toVar();return Gn(a.sub(o).lessThanEqual(0).and(a.sub(s).greaterThanEqual(0)),()=>{const h=a.sub(s).div(o.sub(s)).toVar();h.addAssign(l);const d=i.normalize(),f=Ze(1).div(u.mul(Ze(4,2)));c.assign(r({depthTexture:e,bd3D:d,dp:h,texelSize:f,shadow:n}))}),c}),kB=new xt,ku=new He,Hh=new He;class Xde extends H4{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===fQ?Wde:qde}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,shadowTexture:n,depthTexture:i,shadowCoord:a,shadow:s}){return $de({filterFn:t,shadowTexture:n,depthTexture:i,shadowCoord:a,shadow:s})}renderShadow(e){const{shadow:t,shadowMap:n,light:i}=this,{renderer:a,scene:s}=e,o=t.getFrameExtents();Hh.copy(t.mapSize),Hh.multiply(o),n.setSize(Hh.width,Hh.height),ku.copy(t.mapSize);const l=a.autoClear,u=a.getClearColor(Hde),c=a.getClearAlpha();a.autoClear=!1,a.setClearColor(t.clearColor,t.clearAlpha),a.clear();const h=t.getViewportCount();for(let d=0;d<h;d++){const f=t.getViewport(d),p=ku.x*f.x,m=Hh.y-ku.y-ku.y*f.y;kB.set(p,m,ku.x*f.z,ku.y*f.w),n.viewport.copy(kB),t.updateMatrices(i,d),a.render(s,t.camera)}a.autoClear=l,a.setClearColor(u,c)}}const Yde=(r,e)=>We(new Xde(r,e));class hu extends ph{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new ct,this.colorNode=e&&e.colorNode||St(this.color).setGroup(bt),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=Lt.FRAME}customCacheKey(){return ed(this.light.id,this.light.castShadow?1:0)}getHash(){return this.light.uuid}getLightVector(e){return k4(this.light).sub(e.context.positionView||Xn)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return Vde(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let n=this.shadowColorNode;if(n===null){const i=this.light.shadow.shadowNode;let a;i!==void 0?a=We(i):a=this.setupShadowNode(),this.shadowNode=a,this.shadowColorNode=n=this.colorNode.mul(a),this.baseColorNode=this.colorNode}this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),n=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),n&&e.lightsNode.setupDirectRectAreaLight(e,this,n)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const W4=qe(({lightDistance:r,cutoffDistance:e,decayExponent:t})=>{const n=r.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(n.mul(r.div(e).pow4().oneMinus().clamp().pow2()),n)}),jde=({color:r,lightVector:e,cutoffDistance:t,decayExponent:n})=>{const i=e.normalize(),a=e.length(),s=W4({lightDistance:a,cutoffDistance:t,decayExponent:n}),o=r.mul(s);return{lightDirection:i,lightColor:o}};class Kde extends hu{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=St(0).setGroup(bt),this.decayExponentNode=St(2).setGroup(bt)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return Yde(this.light)}setupDirect(e){return jde({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}qe(([r=Vd()],{renderer:e,material:t})=>{const n=Le(1).toVar(),i=qV(r.mul(2).sub(1));if(t.alphaToCoverage&&e.samples>1){const a=Le(i.fwidth()).toVar();n.assign(Yo(a.oneMinus(),a.add(1),i).oneMinus())}else i.greaterThan(1).discard();return n});const Qde=qe(([r,e])=>{const t=r.x,n=r.y,i=r.z;let a=e.element(0).mul(.886227);return a=a.add(e.element(1).mul(2*.511664).mul(n)),a=a.add(e.element(2).mul(2*.511664).mul(i)),a=a.add(e.element(3).mul(2*.511664).mul(t)),a=a.add(e.element(4).mul(2*.429043).mul(t).mul(n)),a=a.add(e.element(5).mul(2*.429043).mul(n).mul(i)),a=a.add(e.element(6).mul(i.mul(i).mul(.743125).sub(.247708))),a=a.add(e.element(7).mul(2*.429043).mul(t).mul(i)),a=a.add(e.element(8).mul(.429043).mul(Bt(t,t).sub(Bt(n,n)))),a}),_a=new zM;class Zde extends nl{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,n){const i=this.renderer,a=this.nodes.getBackgroundNode(e)||e.background;let s=!1;if(a===null)i._clearColor.getRGB(_a),_a.a=i._clearColor.a;else if(a.isColor===!0)a.getRGB(_a),_a.a=1,s=!0;else if(a.isNode===!0){const l=this.get(e),u=a;_a.copy(i._clearColor);let c=l.backgroundMesh;if(c===void 0){const d=CM(wt(u).mul(OB),{getUV:()=>rde.mul(t4),getTextureLevel:()=>nde});let f=l4;f=f.setZ(f.w);const p=new ur;p.name="Background.material",p.side=dn,p.depthTest=!1,p.depthWrite=!1,p.allowOverride=!1,p.fog=!1,p.lights=!1,p.vertexNode=f,p.colorNode=d,l.backgroundMeshNode=d,l.backgroundMesh=c=new Yn(new Od(1,32,32),p),c.frustumCulled=!1,c.name="Background.mesh",c.onBeforeRender=function(m,v,g){this.matrixWorld.copyPosition(g.matrixWorld)}}const h=u.getCacheKey();l.backgroundCacheKey!==h&&(l.backgroundMeshNode.node=wt(u).mul(OB),l.backgroundMeshNode.needsUpdate=!0,c.material.needsUpdate=!0,l.backgroundCacheKey=h),t.unshift(c,c.geometry,c.material,0,0,null,null)}else console.error("THREE.Renderer: Unsupported background configuration.",a);const o=i.xr.getEnvironmentBlendMode();if(o==="additive"?_a.set(0,0,0,1):o==="alpha-blend"&&_a.set(0,0,0,0),i.autoClear===!0||s===!0){const l=n.clearColorValue;l.r=_a.r,l.g=_a.g,l.b=_a.b,l.a=_a.a,(i.backend.isWebGLBackend===!0||i.alpha===!0)&&(l.r*=l.a,l.g*=l.a,l.b*=l.a),n.depthClearValue=i._clearDepth,n.stencilClearValue=i._clearStencil,n.clearColor=i.autoClearColor===!0,n.clearDepth=i.autoClearDepth===!0,n.clearStencil=i.autoClearStencil===!0}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let Jde=0;class pS{constructor(e="",t=[],n=0,i=[]){this.name=e,this.bindings=t,this.index=n,this.bindingsReference=i,this.id=Jde++}}class epe{constructor(e,t,n,i,a,s,o,l,u,c=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=n,this.transforms=c,this.nodeAttributes=i,this.bindings=a,this.updateNodes=s,this.updateBeforeNodes=o,this.updateAfterNodes=l,this.observer=u,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const i=new pS(t.name,[],t.index,t);e.push(i);for(const a of t.bindings)i.bindings.push(a.clone())}else e.push(t);return e}}class GB{constructor(e,t,n=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=n}}class tpe{constructor(e,t,n){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=n.getSelf()}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class q4{constructor(e,t,n=!1,i=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=n,this.count=i}}class npe extends q4{constructor(e,t){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0}}class rpe{constructor(e,t,n=""){this.name=e,this.type=t,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let ipe=0;class K1{constructor(e=null){this.id=ipe++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class ape{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class rl{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class spe extends rl{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class ope extends rl{constructor(e,t=new He){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class lpe extends rl{constructor(e,t=new re){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class upe extends rl{constructor(e,t=new xt){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class cpe extends rl{constructor(e,t=new ct){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class hpe extends rl{constructor(e,t=new dm){super(e,t),this.isMatrix2Uniform=!0,this.boundary=16,this.itemSize=4}}class fpe extends rl{constructor(e,t=new Et){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class dpe extends rl{constructor(e,t=new Ut){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class ppe extends spe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class gpe extends ope{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class vpe extends lpe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class mpe extends upe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class ype extends cpe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class _pe extends hpe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class xpe extends fpe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class bpe extends dpe{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}const zB=new WeakMap,Epe=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),Xp=r=>/e/g.test(r)?String(r).replace(/\+/g,""):(r=Number(r),r+(r%1?"":".0"));class $4{constructor(e,t,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=q1(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new K1,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null}getBindGroupsCache(){let e=zB.get(this.renderer);return e===void 0&&(e=new ls,zB.set(this.renderer,e)),e}createRenderTarget(e,t,n){return new ou(e,t,n)}createCubeRenderTarget(e,t){return new v4(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const n=this.getBindGroupsCache(),i=[];let a=!0;for(const o of t)i.push(o),a=a&&o.groupNode.shared!==!0;let s;return a?(s=n.get(i),s===void 0&&(s=new pS(e,i,this.bindingsIndexes[e].group,i),n.set(i,s))):s=new pS(e,i,this.bindingsIndexes[e].group,i),s}getBindGroupArray(e,t){const n=this.bindings[t];let i=n[e];return i===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=i=[]),i}getBindings(){let e=this.bindGroups;if(e===null){const t={},n=this.bindings;for(const i of kF)for(const a in n[i]){const s=n[i][a];(t[a]||(t[a]=[])).push(...s)}e=[];for(const i in t){const a=t[i],s=this._getBindGroup(i,a);e.push(s)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,n)=>t.bindings[0].groupNode.order-n.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const n=e[t];this.bindingsIndexes[n.name].group=t,n.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==Lt.NONE&&this.updateNodes.push(e.getSelf());for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),n=e.getUpdateAfterType();t!==Lt.NONE&&this.updateBeforeNodes.push(e.getSelf()),n!==Lt.NONE&&this.updateAfterNodes.push(e.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===ir||e.magFilter===fc||e.magFilter===Bs||e.magFilter===fi||e.minFilter===ir||e.minFilter===fc||e.minFilter===Bs||e.minFilter===fi}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const n=this.getDataFromNode(e);return n.cache===void 0&&(n.cache=new K1(t?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,n=null){let i=this.generateArrayDeclaration(e,t)+"( ";for(let a=0;a<t;a++){const s=n?n[a]:null;s!==null?i+=s.build(this,e):i+=this.generateConst(e),a<t-1&&(i+=", ")}return i+=" )",i}generateStruct(e,t,n=null){const i=[];for(const a of t){const{name:s,type:o}=a;n&&n[s]&&n[s].isNode?i.push(n[s].build(this,o)):i.push(this.generateConst(o))}return e+"( "+i.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new ct:e==="vec2"?t=new He:e==="vec3"?t=new re:e==="vec4"&&(t=new xt)),e==="float")return Xp(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${Xp(t.r)}, ${Xp(t.g)}, ${Xp(t.b)} )`;const n=this.getTypeLength(e),i=this.getComponentType(e),a=s=>this.generateConst(i,s);if(n===2)return`${this.getType(e)}( ${a(t.x)}, ${a(t.y)} )`;if(n===3)return`${this.getType(e)}( ${a(t.x)}, ${a(t.y)}, ${a(t.z)} )`;if(n===4&&e!=="mat2")return`${this.getType(e)}( ${a(t.x)}, ${a(t.y)}, ${a(t.z)}, ${a(t.w)} )`;if(n>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(a).join(", ")} )`;if(n>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const n=this.attributes;for(const a of n)if(a.name===e)return a;const i=new GB(e,t);return this.registerDeclaration(i),n.push(i),i}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===mr)return"int";if(t===hn)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let n=Zse(e);const i=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(n=n.replace("vec","mat")),i+n}getTypeFromArray(e){return Epe.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const n=t.array,i=e.itemSize,a=e.normalized;let s;return!(e instanceof cz)&&a!==!0&&(s=this.getTypeFromArray(n)),this.getTypeFromLength(i,s)}getTypeLength(e){const t=this.getVectorType(e),n=/vec([2-4])/.exec(t);return n!==null?Number(n[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}addStack(){return this.stack=q1(this.stack),this.stacks.push(AV()||this.stack),lv(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,lv(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,n=null){n=n===null?e.isGlobal(this)?this.globalCache:this.cache:n;let i=n.getData(e);return i===void 0&&(i={},n.setData(e,i)),i[t]===void 0&&(i[t]={}),i[t]}getNodeProperties(e,t="any"){const n=this.getDataFromNode(e,t);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const n=this.getDataFromNode(e);let i=n.bufferAttribute;if(i===void 0){const a=this.uniforms.index++;i=new GB("nodeAttribute"+a,t,e),this.bufferAttributes.push(i),n.bufferAttribute=i}return i}getStructTypeFromNode(e,t,n=null,i=this.shaderStage){const a=this.getDataFromNode(e,i,this.globalCache);let s=a.structType;if(s===void 0){const o=this.structs.index++;n===null&&(n="StructType"+o),s=new ape(n,t),this.structs[i].push(s),a.structType=s}return s}getOutputStructTypeFromNode(e,t){const n=this.getStructTypeFromNode(e,t,"OutputType","fragment");return n.output=!0,n}getUniformFromNode(e,t,n=this.shaderStage,i=null){const a=this.getDataFromNode(e,n,this.globalCache);let s=a.uniform;if(s===void 0){const o=this.uniforms.index++;s=new tpe(i||"nodeUniform"+o,t,e),this.uniforms[n].push(s),this.registerDeclaration(s),a.uniform=s}return s}getArrayCount(e){let t=null;return e.isArrayNode?t=e.count:e.isVarNode&&e.node.isArrayNode&&(t=e.node.count),t}getVarFromNode(e,t=null,n=e.getNodeType(this),i=this.shaderStage,a=!1){const s=this.getDataFromNode(e,i);let o=s.variable;if(o===void 0){const l=a?"_const":"_var",u=this.vars[i]||(this.vars[i]=[]),c=this.vars[l]||(this.vars[l]=0);t===null&&(t=(a?"nodeConst":"nodeVar")+c,this.vars[l]++);const h=this.getArrayCount(e);o=new q4(t,n,a,h),a||u.push(o),this.registerDeclaration(o),s.variable=o}return o}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,n=e.getNodeType(this)){const i=this.getDataFromNode(e,"any");let a=i.varying;if(a===void 0){const s=this.varyings,o=s.length;t===null&&(t="nodeVarying"+o),a=new npe(t,n),s.push(a),this.registerDeclaration(a),i.varying=a}return a}registerDeclaration(e){const t=this.shaderStage,n=this.declarations[t]||(this.declarations[t]={}),i=this.getPropertyName(e);let a=1,s=i;for(;n[s]!==void 0;)s=i+"_"+a++;n[s]=e,a>1&&(e.name=s,console.warn(`THREE.TSL: Declaration name '${i}' of '${e.type}' already in use. Renamed to '${s}'.`))}getCodeFromNode(e,t,n=this.shaderStage){const i=this.getDataFromNode(e);let a=i.code;if(a===void 0){const s=this.codes[n]||(this.codes[n]=[]),o=s.length;a=new rpe("nodeCode"+o,t),s.push(a),i.code=a}return a}addFlowCodeHierarchy(e,t){const{flowCodes:n,flowCodeBlock:i}=this.getDataFromNode(e);let a=!0,s=t;for(;s;){if(i.get(s)===!0){a=!1;break}s=this.getDataFromNode(s).parentNodeBlock}if(a)for(const o of n)this.addLineFlowCode(o)}addLineFlowCodeBlock(e,t,n){const i=this.getDataFromNode(e),a=i.flowCodes||(i.flowCodes=[]),s=i.flowCodeBlock||(i.flowCodeBlock=new WeakMap);a.push(t),s.set(n,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),n=this.flowChildNode(e,t);return this.flowsData.set(e,n),n}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new gde,n=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=n,t}flowShaderNode(e){const t=e.layout,n={[Symbol.iterator](){let s=0;const o=Object.values(this);return{next:()=>({value:o[s],done:s++>=o.length})}}};for(const s of t.inputs)n[s.name]=new Qfe(s.type,s.name);e.layout=null;const i=e.call(n),a=this.flowStagesNode(i,t.type);return e.layout=t,a}flowStagesNode(e,t=null){const n=this.flow,i=this.vars,a=this.declarations,s=this.cache,o=this.buildStage,l=this.stack,u={code:""};this.flow=u,this.vars={},this.declarations={},this.cache=new K1,this.stack=q1();for(const c of UF)this.setBuildStage(c),u.result=e.build(this,t);return u.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=i,this.declarations=a,this.cache=s,this.stack=l,this.setBuildStage(o),u}getFunctionOperator(){return null}buildFunctionCode(){console.warn("Abstract function.")}flowChildNode(e,t=null){const n=this.flow,i={code:""};return this.flow=i,i.result=e.build(this,t),this.flow=n,i}flowNodeFromShaderStage(e,t,n=null,i=null){const a=this.shaderStage;this.setShaderStage(e);const s=this.flowChildNode(t,n);return i!==null&&(s.code+=`${this.tab+i} = ${s.result};
`),this.flowCode[e]=this.flowCode[e]+s.code,this.setShaderStage(a),s}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,t,n=null){return`${n!==null?this.generateArrayDeclaration(e,n):this.getType(e)} ${t}`}getVars(e){let t="";const n=this.vars[e];if(n!==void 0)for(const i of n)t+=`${this.getVar(i.type,i.name)}; `;return t}getUniforms(){console.warn("Abstract function.")}getCodes(e){const t=this.codes[e];let n="";if(t!==void 0)for(const i of t)n+=i.code+`
`;return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:e,material:t,renderer:n}=this;if(t!==null){let i=n.library.fromMaterial(t);i===null&&(console.error(`NodeMaterial: Material "${t.type}" is not compatible.`),i=new ur),i.build(this)}else this.addFlow("compute",e);for(const i of UF){this.setBuildStage(i),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const a of kF){this.setShaderStage(a);const s=this.flowNodes[a];for(const o of s)i==="generate"?this.flowNode(o):o.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if(t==="float"||t==="int"||t==="uint")return new ppe(e);if(t==="vec2"||t==="ivec2"||t==="uvec2")return new gpe(e);if(t==="vec3"||t==="ivec3"||t==="uvec3")return new vpe(e);if(t==="vec4"||t==="ivec4"||t==="uvec4")return new mpe(e);if(t==="color")return new ype(e);if(t==="mat2")return new _pe(e);if(t==="mat3")return new xpe(e);if(t==="mat4")return new bpe(e);throw new Error(`Uniform "${t}" not declared.`)}format(e,t,n){if(t=this.getVectorType(t),n=this.getVectorType(n),t===n||n===null||this.isReference(n))return e;const i=this.getTypeLength(t),a=this.getTypeLength(n);return i===16&&a===9?`${this.getType(n)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:i===9&&a===4?`${this.getType(n)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:i>4||a>4||a===0?e:i===a?`${this.getType(n)}( ${e} )`:i>a?this.format(`${e}.${"xyz".slice(0,a)}`,this.getTypeFromLength(a,this.getComponentType(t)),n):a===4&&i>1?`${this.getType(n)}( ${this.format(e,t,"vec3")}, 1.0 )`:i===2?`${this.getType(n)}( ${this.format(e,t,"vec2")}, 0.0 )`:(i===1&&a>1&&t!==this.getComponentType(n)&&(e=`${this.getType(this.getComponentType(n))}( ${e} )`),`${this.getType(n)}( ${e} )`)}getSignature(){return`// Three.js r${oh} - Node System
`}createNodeMaterial(e="NodeMaterial"){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${e}() instead.`)}}class VB{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let n=e.get(t);return n===void 0&&(n={renderMap:new WeakMap,frameMap:new WeakMap},e.set(t,n)),n}updateBeforeNode(e){const t=e.getUpdateBeforeType(),n=e.updateReference(this);if(t===Lt.FRAME){const{frameMap:i}=this._getMaps(this.updateBeforeMap,n);i.get(n)!==this.frameId&&e.updateBefore(this)!==!1&&i.set(n,this.frameId)}else if(t===Lt.RENDER){const{renderMap:i}=this._getMaps(this.updateBeforeMap,n);i.get(n)!==this.renderId&&e.updateBefore(this)!==!1&&i.set(n,this.renderId)}else t===Lt.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),n=e.updateReference(this);if(t===Lt.FRAME){const{frameMap:i}=this._getMaps(this.updateAfterMap,n);i.get(n)!==this.frameId&&e.updateAfter(this)!==!1&&i.set(n,this.frameId)}else if(t===Lt.RENDER){const{renderMap:i}=this._getMaps(this.updateAfterMap,n);i.get(n)!==this.renderId&&e.updateAfter(this)!==!1&&i.set(n,this.renderId)}else t===Lt.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),n=e.updateReference(this);if(t===Lt.FRAME){const{frameMap:i}=this._getMaps(this.updateMap,n);i.get(n)!==this.frameId&&e.update(this)!==!1&&i.set(n,this.frameId)}else if(t===Lt.RENDER){const{renderMap:i}=this._getMaps(this.updateMap,n);i.get(n)!==this.renderId&&e.update(this)!==!1&&i.set(n,this.renderId)}else t===Lt.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class VM{constructor(e,t,n=null,i="",a=!1){this.type=e,this.name=t,this.count=n,this.qualifier=i,this.isConst=a}}VM.isNodeFunctionInput=!0;class Tpe extends hu{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:G4(this.light),lightColor:e}}}const Q1=new Ut,Yp=new Ut;let Wh=null;class wpe extends hu{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=St(new re).setGroup(bt),this.halfWidth=St(new re).setGroup(bt),this.updateType=Lt.RENDER}update(e){super.update(e);const{light:t}=this,n=e.camera.matrixWorldInverse;Yp.identity(),Q1.copy(t.matrixWorld),Q1.premultiply(n),Yp.extractRotation(Q1),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(Yp),this.halfHeight.value.applyMatrix4(Yp)}setupDirectRectArea(e){let t,n;e.isAvailable("float32Filterable")?(t=qt(Wh.LTC_FLOAT_1),n=qt(Wh.LTC_FLOAT_2)):(t=qt(Wh.LTC_HALF_1),n=qt(Wh.LTC_HALF_2));const{colorNode:i,light:a}=this,s=k4(a);return{lightColor:i,lightPosition:s,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:n}}static setLTC(e){Wh=e}}class X4 extends hu{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=St(0).setGroup(bt),this.penumbraCosNode=St(0).setGroup(bt),this.cutoffDistanceNode=St(0).setGroup(bt),this.decayExponentNode=St(0).setGroup(bt)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e){const{coneCosNode:t,penumbraCosNode:n}=this;return Yo(t,n,e)}setupDirect(e){const{colorNode:t,cutoffDistanceNode:n,decayExponentNode:i,light:a}=this,s=this.getLightVector(e),o=s.normalize(),l=o.dot(G4(a)),u=this.getSpotAttenuation(l),c=s.length(),h=W4({lightDistance:c,cutoffDistance:n,decayExponent:i});let d=t.mul(u).mul(h);if(a.map){const f=_de(a,e.context.positionWorld),p=qt(a.map,f.xy).onRenderUpdate(()=>a.map);d=f.mul(2).sub(1).abs().lessThan(1).all().select(d.mul(p),d)}return{lightColor:d,lightDirection:o}}}class Spe extends X4{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e){const t=this.light.iesMap;let n=null;if(t&&t.isTexture===!0){const i=e.acos().mul(1/Math.PI);n=qt(t,Ze(i,0),0).r}else n=super.getSpotAttenuation(e);return n}}class Ape extends hu{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class Mpe extends hu{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=U4(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=St(new ct).setGroup(bt)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:n,lightDirectionNode:i}=this,s=ka.dot(i).mul(.5).add(.5),o=_n(n,t,s);e.context.irradiance.addAssign(o)}}class Cpe extends hu{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let n=0;n<9;n++)t.push(new re);this.lightProbe=Ja(t)}update(e){const{light:t}=this;super.update(e);for(let n=0;n<9;n++)this.lightProbe.array[n].copy(t.sh.coefficients[n]).multiplyScalar(t.intensity)}setup(e){const t=Qde(t4,this.lightProbe);e.context.irradiance.addAssign(t)}}class Y4{parseFunction(){console.warn("Abstract function.")}}class HM{constructor(e,t,n="",i=""){this.type=e,this.inputs=t,this.name=n,this.precision=i}getCode(){console.warn("Abstract function.")}}HM.isNodeFunction=!0;const Rpe=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,Npe=/[a-z_0-9]+/ig,HB="#pragma main",Ppe=r=>{r=r.trim();const e=r.indexOf(HB),t=e!==-1?r.slice(e+HB.length):r,n=t.match(Rpe);if(n!==null&&n.length===5){const i=n[4],a=[];let s=null;for(;(s=Npe.exec(i))!==null;)a.push(s);const o=[];let l=0;for(;l<a.length;){const p=a[l][0]==="const";p===!0&&l++;let m=a[l][0];m==="in"||m==="out"||m==="inout"?l++:m="";const v=a[l++][0];let g=Number.parseInt(a[l][0]);Number.isNaN(g)===!1?l++:g=null;const y=a[l++][0];o.push(new VM(v,y,g,m,p))}const u=t.substring(n[0].length),c=n[3]!==void 0?n[3]:"",h=n[2],d=n[1]!==void 0?n[1]:"",f=e!==-1?r.slice(0,e):"";return{type:h,inputs:o,name:c,precision:d,inputsCode:i,blockCode:u,headerCode:f}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class Dpe extends HM{constructor(e){const{type:t,inputs:n,name:i,precision:a,inputsCode:s,blockCode:o,headerCode:l}=Ppe(e);super(t,n,i,a),this.inputsCode=s,this.blockCode=o,this.headerCode=l}getCode(e=this.name){let t;const n=this.blockCode;if(n!==""){const{type:i,inputsCode:a,headerCode:s,precision:o}=this;let l=`${i} ${e} ( ${a.trim()} )`;o!==""&&(l=`${o} ${l}`),t=s+l+n}else t="";return t}}class Lpe extends Y4{parseFunction(e){return new Dpe(e)}}const WB=new WeakMap,Xa=[],Gu=[];class Ipe extends nl{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new VB,this.nodeBuilderCache=new Map,this.callHashCache=new ls,this.groupsData=new ls,this.cacheLib={}}updateGroup(e){const t=e.groupNode,n=t.name;if(n===RV.name)return!0;if(n===bt.name){const a=this.get(e),s=this.nodeFrame.renderId;return a.renderId!==s?(a.renderId=s,!0):!1}if(n===Foe.name){const a=this.get(e),s=this.nodeFrame.frameId;return a.frameId!==s?(a.frameId=s,!0):!1}Xa[0]=t,Xa[1]=e;let i=this.groupsData.get(Xa);return i===void 0&&this.groupsData.set(Xa,i={}),Xa.length=0,i.version!==t.version?(i.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const{nodeBuilderCache:i}=this,a=this.getForRenderCacheKey(e);if(n=i.get(a),n===void 0){const s=this.backend.createNodeBuilder(e.object,this.renderer);s.scene=e.scene,s.material=e.material,s.camera=e.camera,s.context.material=e.material,s.lightsNode=e.lightsNode,s.environmentNode=this.getEnvironmentNode(e.scene),s.fogNode=this.getFogNode(e.scene),s.clippingContext=e.clippingContext,s.build(),n=this._createNodeBuilderState(s),i.set(a,n)}n.usedTimes++,t.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const i=this.backend.createNodeBuilder(e,this.renderer);i.build(),n=this._createNodeBuilderState(i),t.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new epe(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const n=this.get(e);n.environmentNode&&(t=n.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const n=this.get(e);n.backgroundNode&&(t=n.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){Xa[0]=e,Xa[1]=t;const n=this.renderer.info.calls,i=this.callHashCache.get(Xa)||{};if(i.callId!==n){const a=this.getEnvironmentNode(e),s=this.getFogNode(e);t&&Gu.push(t.getCacheKey(!0)),a&&Gu.push(a.getCacheKey()),s&&Gu.push(s.getCacheKey()),Gu.push(this.renderer.shadowMap.enabled?1:0),i.callId=n,i.cacheKey=vM(Gu),this.callHashCache.set(Xa,i),Gu.length=0}return Xa.length=0,i.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),n=e.background;if(n){const i=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==n||i){const a=this.getCacheNode("background",n,()=>{if(n.isCubeTexture===!0||n.mapping===Wo||n.mapping===qo||n.mapping===Yl){if(e.backgroundBlurriness>0||n.mapping===Yl)return C4(n);{let s;return n.isCubeTexture===!0?s=sd(n):s=qt(n),y4(s)}}else{if(n.isTexture===!0)return qt(n,od.flipY()).setUpdateMatrix(!0);n.isColor!==!0&&console.error("WebGPUNodes: Unsupported background configuration.",n)}},i);t.backgroundNode=a,t.background=n,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,n,i=!1){const a=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let s=a.get(t);return(s===void 0||i)&&(s=n(),a.set(t,s)),s}updateFog(e){const t=this.get(e),n=e.fog;if(n){if(t.fog!==n){const i=this.getCacheNode("fog",n,()=>{if(n.isFogExp2){const a=cn("color","color",n).setGroup(bt),s=cn("density","float",n).setGroup(bt);return BB(a,mde(s))}else if(n.isFog){const a=cn("color","color",n).setGroup(bt),s=cn("near","float",n).setGroup(bt),o=cn("far","float",n).setGroup(bt);return BB(a,vde(s,o))}else console.error("THREE.Renderer: Unsupported fog configuration.",n)});t.fogNode=i,t.fog=n}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),n=e.environment;if(n){if(t.environment!==n){const i=this.getCacheNode("environment",n,()=>{if(n.isCubeTexture===!0)return sd(n);if(n.isTexture===!0)return qt(n);console.error("Nodes: Unsupported environment configuration.",n)});t.environmentNode=i,t.environment=n}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,n=null,i=null,a=null){const s=this.nodeFrame;return s.renderer=e,s.scene=t,s.object=n,s.camera=i,s.material=a,s}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace}hasOutputChange(e){return WB.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,n=this.getOutputCacheKey(),i=qt(e,od).renderOutput(t.toneMapping,t.currentColorSpace);return WB.set(e,n),i}updateBefore(e){const t=e.getNodeBuilderState();for(const n of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(n)}updateAfter(e){const t=e.getNodeBuilderState();for(const n of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(n)}updateForCompute(e){const t=this.getNodeFrame(),n=this.getForCompute(e);for(const i of n.updateNodes)t.updateNode(i)}updateForRender(e){const t=this.getNodeFrameForRender(e),n=e.getNodeBuilderState();for(const i of n.updateNodes)t.updateNode(i)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new VB,this.nodeBuilderCache=new Map,this.cacheLib={}}}const Z1=new Sa;class pv{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new Et,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,n){const i=e.length;for(let a=0;a<i;a++){Z1.copy(e[a]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const s=t[n+a],o=Z1.normal;s.x=-o.x,s.y=-o.y,s.z=-o.z,s.w=Z1.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let n=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const i=t.clippingPlanes,a=i.length;let s,o;if(this.clipIntersection?(s=this.intersectionPlanes,o=e.intersectionPlanes.length):(s=this.unionPlanes,o=e.unionPlanes.length),s.length!==o+a){s.length=o+a;for(let l=0;l<a;l++)s[o+l]=new xt;n=!0}this.projectPlanes(i,s,o),n&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new pv(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class Ope{constructor(e,t){this.bundleGroup=e,this.camera=t}}const qh=[];class Fpe{constructor(){this.bundles=new ls}get(e,t){const n=this.bundles;qh[0]=e,qh[1]=t;let i=n.get(qh);return i===void 0&&(i=new Ope(e,t),n.set(qh,i)),qh.length=0,i}dispose(){this.bundles=new ls}}class j4{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const n=this.getMaterialNodeClass(e.type);if(n!==null){t=new n;for(const i in e)t[i]=e[i]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,n){if(n.has(t)){console.warn(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);n.set(t,e)}addClass(e,t,n){if(n.has(t)){console.warn(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);n.set(t,e)}}const Bpe=new z4,$h=[];class Upe extends ls{constructor(){super()}createNode(e=[]){return new z4().setLights(e)}getNode(e,t){if(e.isQuadMesh)return Bpe;$h[0]=e,$h[1]=t;let n=this.get($h);return n===void 0&&(n=this.createNode(),this.set($h,n)),$h.length=0,n}}class of extends ou{constructor(e=1,t=1,n={}){super(e,t,n),this.isXRRenderTarget=!0,this.hasExternalTextures=!1,this.autoAllocateDepthBuffer=!0}copy(e){return super.copy(e),this.hasExternalTextures=e.hasExternalTextures,this.autoAllocateDepthBuffer=e.autoAllocateDepthBuffer,this}}const qB=new re,$B=new re;class kpe extends to{constructor(e){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new yr,this._cameraL.viewport=new xt,this._cameraR=new yr,this._cameraR.viewport=new xt,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new Tz,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._supportsLayers=!1,this._createXRLayer=qpe.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new He,this._onSessionEvent=Vpe.bind(this),this._onSessionEnd=Hpe.bind(this),this._onInputSourcesChange=Wpe.bind(this),this._onAnimationFrame=$pe.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._useLayers=typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&console.warn("THREE.XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&console.warn("THREE.XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getFrame(){return this._xrFrame}createQuadLayer(e,t,n,i,a,s,o,l=[]){const u=new Id(e,t),c=new of(a,s,{format:On,type:In,depthTexture:new sa(a,s,l.stencil?Gi:hn,void 0,void 0,void 0,void 0,void 0,void 0,l.stencil?Vi:zi),stencilBuffer:l.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),h=new Za({color:16777215,side:yi});h.map=c.texture,h.map.offset.y=1,h.map.repeat.y=-1;const d=new Yn(u,h);d.position.copy(n),d.quaternion.copy(i);const f={type:"quad",width:e,height:t,translation:n,quaternion:i,pixelwidth:a,pixelheight:s,plane:d,material:h,rendercall:o,renderTarget:c};if(this._layers.push(f),this._session!==null){f.plane.material=new Za({color:16777215,side:yi}),f.plane.material.blending=hc,f.plane.material.blendEquation=Br,f.plane.material.blendSrc=As,f.plane.material.blendDst=As,f.xrlayer=this._createXRLayer(f);const p=this._session.renderState.layers;p.unshift(f.xrlayer),this._session.updateRenderState({layers:p})}else c.isXRRenderTarget=!1;return d}createCylinderLayer(e,t,n,i,a,s,o,l,u=[]){const c=new Ld(e,e,e*t/n,64,64,!0,Math.PI-t/2,t),h=new of(s,o,{format:On,type:In,depthTexture:new sa(s,o,u.stencil?Gi:hn,void 0,void 0,void 0,void 0,void 0,void 0,u.stencil?Vi:zi),stencilBuffer:u.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),d=new Za({color:16777215,side:dn});d.map=h.texture,d.map.offset.y=1,d.map.repeat.y=-1;const f=new Yn(c,d);f.position.copy(i),f.quaternion.copy(a);const p={type:"cylinder",radius:e,centralAngle:t,aspectratio:n,translation:i,quaternion:a,pixelwidth:s,pixelheight:o,plane:f,material:d,rendercall:l,renderTarget:h};if(this._layers.push(p),this._session!==null){p.plane.material=new Za({color:16777215,side:dn}),p.plane.material.blending=hc,p.plane.material.blendEquation=Br,p.plane.material.blendSrc=As,p.plane.material.blendDst=As,p.xrlayer=this._createXRLayer(p);const m=this._session.renderState.layers;m.unshift(p.xrlayer),this._session.updateRenderState({layers:m})}else h.isXRRenderTarget=!1;return f}renderLayers(){const e=new re,t=new Ua,n=this.isPresenting;this.isPresenting=!1;for(const i of this._layers){if(i.renderTarget.isXRRenderTarget=this._session!==null,i.renderTarget.hasExternalTextures=i.renderTarget.isXRRenderTarget,i.renderTarget.autoAllocateDepthBuffer=!i.renderTarget.isXRRenderTarget,i.renderTarget.isXRRenderTarget&&this._supportsLayers){i.xrlayer.transform=new XRRigidTransform(i.plane.getWorldPosition(e),i.plane.getWorldQuaternion(t));const a=this._glBinding.getSubImage(i.xrlayer,this._xrFrame);this._renderer.backend.setXRRenderTargetTextures(i.renderTarget,a.colorTexture,a.depthStencilTexture)}this._renderer.setRenderTarget(i.renderTarget),i.rendercall()}this.isPresenting=n,this._renderer.setRenderTarget(null)}getSession(){return this._session}async setSession(e){const t=this._renderer,n=t.backend;this._gl=t.getContext();const i=this._gl,a=i.getContextAttributes();if(this._session=e,e!==null){if(n.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await n.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._useLayers===!0){let s=null,o=null,l=null;t.depth&&(l=t.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,s=t.stencil?Vi:zi,o=t.stencil?Gi:hn);const u={colorFormat:i.RGBA8,depthFormat:l,scaleFactor:this._framebufferScaleFactor},c=new XRWebGLBinding(e,i),h=c.createProjectionLayer(u),d=[h];if(this._glBinding=c,this._glProjLayer=h,t.setPixelRatio(1),t.setSize(h.textureWidth,h.textureHeight,!1),this._xrRenderTarget=new of(h.textureWidth,h.textureHeight,{format:On,type:In,colorSpace:t.outputColorSpace,depthTexture:new sa(h.textureWidth,h.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,s),stencilBuffer:t.stencil,samples:a.antialias?4:0,resolveDepthBuffer:h.ignoreDepthValues===!1,resolveStencilBuffer:h.ignoreDepthValues===!1}),this._xrRenderTarget.hasExternalTextures=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._supportsLayers=e.enabledFeatures.includes("layers"),this._supportsLayers)for(const f of this._layers)f.plane.material=new Za({color:16777215,side:f.type==="cylinder"?dn:yi}),f.plane.material.blending=hc,f.plane.material.blendEquation=Br,f.plane.material.blendSrc=As,f.plane.material.blendDst=As,f.xrlayer=this._createXRLayer(f),d.unshift(f.xrlayer);e.updateRenderState({layers:d})}else{const s={antialias:t.samples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},o=new XRWebGLLayer(e,i,s);this._glBaseLayer=o,e.updateRenderState({baseLayer:o}),t.setPixelRatio(1),t.setSize(o.framebufferWidth,o.framebufferHeight,!1),this._xrRenderTarget=new of(o.framebufferWidth,o.framebufferHeight,{format:On,type:In,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:o.ignoreDepthValues===!1,resolveStencilBuffer:o.ignoreDepthValues===!1})}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const n=e.near,i=e.far,a=this._cameraXR,s=this._cameraL,o=this._cameraR;a.near=o.near=s.near=n,a.far=o.far=s.far=i,(this._currentDepthNear!==a.near||this._currentDepthFar!==a.far)&&(t.updateRenderState({depthNear:a.near,depthFar:a.far}),this._currentDepthNear=a.near,this._currentDepthFar=a.far),s.layers.mask=e.layers.mask|2,o.layers.mask=e.layers.mask|4,a.layers.mask=s.layers.mask|o.layers.mask;const l=e.parent,u=a.cameras;XB(a,l);for(let c=0;c<u.length;c++)XB(u[c],l);u.length===2?Gpe(a,s,o):a.projectionMatrix.copy(s.projectionMatrix),zpe(e,a,l)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new Tg,this._controllers[e]=t),t}}function Gpe(r,e,t){qB.setFromMatrixPosition(e.matrixWorld),$B.setFromMatrixPosition(t.matrixWorld);const n=qB.distanceTo($B),i=e.projectionMatrix.elements,a=t.projectionMatrix.elements,s=i[14]/(i[10]-1),o=i[14]/(i[10]+1),l=(i[9]+1)/i[5],u=(i[9]-1)/i[5],c=(i[8]-1)/i[0],h=(a[8]+1)/a[0],d=s*c,f=s*h,p=n/(-c+h),m=p*-c;if(e.matrixWorld.decompose(r.position,r.quaternion,r.scale),r.translateX(m),r.translateZ(p),r.matrixWorld.compose(r.position,r.quaternion,r.scale),r.matrixWorldInverse.copy(r.matrixWorld).invert(),i[10]===-1)r.projectionMatrix.copy(e.projectionMatrix),r.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const v=s+p,g=o+p,y=d-m,_=f+(n-m),x=l*o/g*v,E=u*o/g*v;r.projectionMatrix.makePerspective(y,_,x,E,v,g),r.projectionMatrixInverse.copy(r.projectionMatrix).invert()}}function XB(r,e){e===null?r.matrixWorld.copy(r.matrix):r.matrixWorld.multiplyMatrices(e.matrixWorld,r.matrix),r.matrixWorldInverse.copy(r.matrixWorld).invert()}function zpe(r,e,t){t===null?r.matrix.copy(e.matrixWorld):(r.matrix.copy(t.matrixWorld),r.matrix.invert(),r.matrix.multiply(e.matrixWorld)),r.matrix.decompose(r.position,r.quaternion,r.scale),r.updateMatrixWorld(!0),r.projectionMatrix.copy(e.projectionMatrix),r.projectionMatrixInverse.copy(e.projectionMatrixInverse),r.isPerspectiveCamera&&(r.fov=Zl*2*Math.atan(1/r.projectionMatrix.elements[5]),r.zoom=1)}function Vpe(r){const e=this._controllerInputSources.indexOf(r.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const n=this.getReferenceSpace();t.update(r.inputSource,r.frame,n),t.dispatchEvent({type:r.type,data:r.inputSource})}}function Hpe(){const r=this._session,e=this._renderer;r.removeEventListener("select",this._onSessionEvent),r.removeEventListener("selectstart",this._onSessionEvent),r.removeEventListener("selectend",this._onSessionEvent),r.removeEventListener("squeeze",this._onSessionEvent),r.removeEventListener("squeezestart",this._onSessionEvent),r.removeEventListener("squeezeend",this._onSessionEvent),r.removeEventListener("end",this._onSessionEnd),r.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const n=this._controllerInputSources[t];n!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(n))}if(this._currentDepthNear=null,this._currentDepthFar=null,e.backend.setXRTarget(null),e.setOutputRenderTarget(null),e.setRenderTarget(null),this._session=null,this._xrRenderTarget=null,this._supportsLayers===!0)for(const t of this._layers)t.renderTarget=new of(t.pixelwidth,t.pixelheight,{format:On,type:In,depthTexture:new sa(t.pixelwidth,t.pixelheight,t.stencilBuffer?Gi:hn,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?Vi:zi),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,delete t.xrlayer;this.isPresenting=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function Wpe(r){const e=this._controllers,t=this._controllerInputSources;for(let n=0;n<r.removed.length;n++){const i=r.removed[n],a=t.indexOf(i);a>=0&&(t[a]=null,e[a].disconnect(i))}for(let n=0;n<r.added.length;n++){const i=r.added[n];let a=t.indexOf(i);if(a===-1){for(let o=0;o<e.length;o++)if(o>=t.length){t.push(i),a=o;break}else if(t[o]===null){t[o]=i,a=o;break}if(a===-1)break}const s=e[a];s&&s.connect(i)}}function qpe(r){return r.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(r.translation,r.quaternion),depthFormat:this._gl.DEPTH_COMPONENT,width:r.width/2,height:r.height/2,space:this._referenceSpace,viewPixelWidth:r.pixelwidth,viewPixelHeight:r.pixelheight}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(r.translation,r.quaternion),depthFormat:this._gl.DEPTH_COMPONENT,radius:r.radius,centralAngle:r.centralAngle,aspectRatio:r.aspectRatio,space:this._referenceSpace,viewPixelWidth:r.pixelwidth,viewPixelHeight:r.pixelheight})}function $pe(r,e){if(e===void 0)return;const t=this._cameraXR,n=this._renderer,i=n.backend,a=this._glBaseLayer,s=this.getReferenceSpace(),o=e.getViewerPose(s);if(this._xrFrame=e,o!==null){const l=o.views;this._glBaseLayer!==null&&i.setXRTarget(a.framebuffer);let u=!1;l.length!==t.cameras.length&&(t.cameras.length=0,u=!0);for(let c=0;c<l.length;c++){const h=l[c];let d;if(this._useLayers===!0){const p=this._glBinding.getViewSubImage(this._glProjLayer,h);d=p.viewport,c===0&&i.setXRRenderTargetTextures(this._xrRenderTarget,p.colorTexture,this._glProjLayer.ignoreDepthValues?void 0:p.depthStencilTexture)}else d=a.getViewport(h);let f=this._cameras[c];f===void 0&&(f=new yr,f.layers.enable(c),f.viewport=new xt,this._cameras[c]=f),f.matrix.fromArray(h.transform.matrix),f.matrix.decompose(f.position,f.quaternion,f.scale),f.projectionMatrix.fromArray(h.projectionMatrix),f.projectionMatrixInverse.copy(f.projectionMatrix).invert(),f.viewport.set(d.x,d.y,d.width,d.height),c===0&&(t.matrix.copy(f.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),u===!0&&t.cameras.push(f)}n.setOutputRenderTarget(this._xrRenderTarget)}for(let l=0;l<this._controllers.length;l++){const u=this._controllerInputSources[l],c=this._controllers[l];u!==null&&c!==void 0&&c.update(u,e,s)}this._currentAnimationLoop&&this._currentAnimationLoop(r,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}const YB=new cm,jp=new He,J1=new xt,ew=new hm,Kp=new Ut,yo=new xt;class Xpe{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,alpha:i=!0,depth:a=!0,stencil:s=!1,antialias:o=!1,samples:l=0,getFallback:u=null,colorBufferType:c=kr}=t;this.domElement=e.getDomElement(),this.backend=e,this.samples=l||o===!0?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=i,this.logarithmicDepthBuffer=n,this.outputColorSpace=ft,this.toneMapping=xi,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=a,this.stencil=s,this.info=new Ofe,this.nodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new j4,this.lighting=new Upe,this._getFallback=u,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new xt(0,0,this._width,this._height),this._scissor=new xt(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new O4(new ur),this._quad.material.name="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const h=this.alpha===!0?0:1;this._clearColor=new zM(0,0,0,h),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._colorBufferType=c,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:bA},this.xr=new kpe(this),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(d,f,p)=>{await this.compileAsync(d,f);const m=this._renderLists.get(d,f),v=this._renderContexts.get(d,f,this._renderTarget),g=d.overrideMaterial||p.material,y=this._objects.get(p,g,d,f,m.lightsNode,v,v.clippingContext),{fragmentShader:_,vertexShader:x}=y.getNodeBuilderState();return{fragmentShader:_,vertexShader:x}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let n=this.backend;try{await n.init(this)}catch(i){if(this._getFallback!==null)try{this.backend=n=this._getFallback(i),await n.init(this)}catch(a){t(a);return}else{t(i);return}}this._nodes=new Ipe(this,n),this._animation=new Afe(this._nodes,this.info),this._attributes=new Lfe(n),this._background=new Zde(this,this._nodes),this._geometries=new Ife(this._attributes,this.info),this._textures=new Kfe(this,n,this.info),this._pipelines=new kfe(n,this._nodes),this._bindings=new Gfe(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new Nfe(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new Hfe(this.lighting),this._bundles=new Fpe,this._renderContexts=new Yfe,this._animation.start(),this._initialized=!0,e(this)}),this._initPromise)}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,n=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const i=this._nodes.nodeFrame,a=i.renderId,s=this._currentRenderContext,o=this._currentRenderObjectFunction,l=this._compilationPromises,u=e.isScene===!0?e:YB;n===null&&(n=e);const c=this._renderTarget,h=this._renderContexts.get(n,t,c),d=this._activeMipmapLevel,f=[];this._currentRenderContext=h,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=f,i.renderId++,i.update(),h.depth=this.depth,h.stencil=this.stencil,h.clippingContext||(h.clippingContext=new pv),h.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,c);const p=this._renderLists.get(e,t);if(p.begin(),this._projectObject(e,t,0,p,h.clippingContext),n!==e&&n.traverseVisible(function(_){_.isLight&&_.layers.test(t.layers)&&p.pushLight(_)}),p.finish(),c!==null){this._textures.updateRenderTarget(c,d);const _=this._textures.get(c);h.textures=_.textures,h.depthTexture=_.depthTexture}else h.textures=null,h.depthTexture=null;this._background.update(u,p,h);const m=p.opaque,v=p.transparent,g=p.transparentDoublePass,y=p.lightsNode;this.opaque===!0&&m.length>0&&this._renderObjects(m,t,u,y),this.transparent===!0&&v.length>0&&this._renderTransparents(v,g,t,u,y),i.renderId=a,this._currentRenderContext=s,this._currentRenderObjectFunction=o,this._compilationPromises=l,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(f)}async renderAsync(e,t){this._initialized===!1&&await this.init(),this._renderScene(e,t)}async waitForGPU(){await this.backend.waitForGPU()}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getColorBufferType(){return this._colorBufferType}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),console.error(t),this._isDeviceLost=!0}_renderBundle(e,t,n){const{bundleGroup:i,camera:a,renderList:s}=e,o=this._currentRenderContext,l=this._bundles.get(i,a),u=this.backend.get(l);u.renderContexts===void 0&&(u.renderContexts=new Set);const c=i.version!==u.version,h=u.renderContexts.has(o)===!1||c;if(u.renderContexts.add(o),h){this.backend.beginBundle(o),(u.renderObjects===void 0||c)&&(u.renderObjects=[]),this._currentRenderBundle=l;const{transparentDoublePass:d,transparent:f,opaque:p}=s;this.opaque===!0&&p.length>0&&this._renderObjects(p,a,t,n),this.transparent===!0&&f.length>0&&this._renderTransparents(f,d,a,t,n),this._currentRenderBundle=null,this.backend.finishBundle(o,l),u.version=i.version}else{const{renderObjects:d}=u;for(let f=0,p=d.length;f<p;f++){const m=d[f];this._nodes.needsRefresh(m)&&(this._nodes.updateBefore(m),this._nodes.updateForRender(m),this._bindings.updateForRender(m),this._nodes.updateAfter(m))}}this.backend.addBundle(o,l)}render(e,t){if(this._initialized===!1)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(e,t);this._renderScene(e,t)}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this;if(e!==xi===!1&&t!==is===!1)return null;const{width:a,height:s}=this.getDrawingBufferSize(jp),{depth:o,stencil:l}=this;let u=this._frameBufferTarget;return u===null&&(u=new ou(a,s,{depthBuffer:o,stencilBuffer:l,type:this._colorBufferType,format:On,colorSpace:is,generateMipmaps:!1,minFilter:ir,magFilter:ir,samples:this.samples}),u.isPostProcessingRenderTarget=!0,this._frameBufferTarget=u),u.depthBuffer=o,u.stencilBuffer=l,u.setSize(a,s),u.viewport.copy(this._viewport),u.scissor.copy(this._scissor),u.viewport.multiplyScalar(this._pixelRatio),u.scissor.multiplyScalar(this._pixelRatio),u.scissorTest=this._scissorTest,u}_renderScene(e,t,n=!0){if(this._isDeviceLost===!0)return;const i=n?this._getFrameBufferTarget():null,a=this._nodes.nodeFrame,s=a.renderId,o=this._currentRenderContext,l=this._currentRenderObjectFunction,u=e.isScene===!0?e:YB,c=this._renderTarget||this._outputRenderTarget,h=this._activeCubeFace,d=this._activeMipmapLevel;let f;i!==null?(f=i,this.setRenderTarget(f)):f=c;const p=this._renderContexts.get(e,t,f);this._currentRenderContext=p,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,a.renderId=this.info.calls;const m=this.coordinateSystem,v=this.xr;if(t.coordinateSystem!==m&&v.isPresenting===!1&&(t.coordinateSystem=m,t.updateProjectionMatrix(),t.isArrayCamera))for(const R of t.cameras)R.coordinateSystem=m,R.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),v.enabled===!0&&v.isPresenting===!0&&(v.cameraAutoUpdate===!0&&v.updateCamera(t),t=v.getCamera());let g=this._viewport,y=this._scissor,_=this._pixelRatio;f!==null&&(g=f.viewport,y=f.scissor,_=1),this.getDrawingBufferSize(jp),J1.set(0,0,jp.width,jp.height);const x=g.minDepth===void 0?0:g.minDepth,E=g.maxDepth===void 0?1:g.maxDepth;p.viewportValue.copy(g).multiplyScalar(_).floor(),p.viewportValue.width>>=d,p.viewportValue.height>>=d,p.viewportValue.minDepth=x,p.viewportValue.maxDepth=E,p.viewport=p.viewportValue.equals(J1)===!1,p.scissorValue.copy(y).multiplyScalar(_).floor(),p.scissor=this._scissorTest&&p.scissorValue.equals(J1)===!1,p.scissorValue.width>>=d,p.scissorValue.height>>=d,p.clippingContext||(p.clippingContext=new pv),p.clippingContext.updateGlobal(u,t),u.onBeforeRender(this,e,t,f),Kp.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ew.setFromProjectionMatrix(Kp,m);const T=this._renderLists.get(e,t);if(T.begin(),this._projectObject(e,t,0,T,p.clippingContext),T.finish(),this.sortObjects===!0&&T.sort(this._opaqueSort,this._transparentSort),f!==null){this._textures.updateRenderTarget(f,d);const R=this._textures.get(f);p.textures=R.textures,p.depthTexture=R.depthTexture,p.width=R.width,p.height=R.height,p.renderTarget=f,p.depth=f.depthBuffer,p.stencil=f.stencilBuffer}else p.textures=null,p.depthTexture=null,p.width=this.domElement.width,p.height=this.domElement.height,p.depth=this.depth,p.stencil=this.stencil;p.width>>=d,p.height>>=d,p.activeCubeFace=h,p.activeMipmapLevel=d,p.occlusionQueryCount=T.occlusionQueryCount,this._background.update(u,T,p),this.backend.beginRender(p);const{bundles:b,lightsNode:w,transparentDoublePass:A,transparent:S,opaque:C}=T;return b.length>0&&this._renderBundles(b,u,w),this.opaque===!0&&C.length>0&&this._renderObjects(C,t,u,w),this.transparent===!0&&S.length>0&&this._renderTransparents(S,A,t,u,w),this.backend.finishRender(p),a.renderId=s,this._currentRenderContext=o,this._currentRenderObjectFunction=l,i!==null&&(this.setRenderTarget(c,h,d),this._renderOutput(f)),u.onAfterRender(this,e,t,f),p}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const n=this.autoClear,i=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=n,this.xr.enabled=i}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(t*n),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),n===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,n,i){const a=this._scissor;e.isVector4?a.copy(e):a.set(e,t,n,i)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e,this.backend.setScissorTest(e)}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,n,i,a=0,s=1){const o=this._viewport;e.isVector4?o.copy(e):o.set(e,t,n,i),o.minDepth=a,o.maxDepth=s}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,n=!0){if(this._initialized===!1)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(e,t,n);const i=this._renderTarget||this._getFrameBufferTarget();let a=null;if(i!==null){this._textures.updateRenderTarget(i);const s=this._textures.get(i);a=this._renderContexts.getForClear(i),a.textures=s.textures,a.depthTexture=s.depthTexture,a.width=s.width,a.height=s.height,a.renderTarget=i,a.depth=i.depthBuffer,a.stencil=i.stencilBuffer,a.clearColorValue=this.backend.getClearColor(),a.activeCubeFace=this.getActiveCubeFace(),a.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,n,a),i!==null&&this._renderTarget===null&&this._renderOutput(i)}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,n=!0){this._initialized===!1&&await this.init(),this.clear(e,t,n)}async clearColorAsync(){this.clearAsync(!0,!1,!1)}async clearDepthAsync(){this.clearAsync(!1,!0,!1)}async clearStencilAsync(){this.clearAsync(!1,!1,!0)}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:xi}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:is}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()}),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,n=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e);const t=this._nodes.nodeFrame,n=t.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,t.renderId=this.info.calls;const i=this.backend,a=this._pipelines,s=this._bindings,o=this._nodes,l=Array.isArray(e)?e:[e];if(l[0]===void 0||l[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");i.beginCompute(e);for(const u of l){if(a.has(u)===!1){const d=()=>{u.removeEventListener("dispose",d),a.delete(u),s.delete(u),o.delete(u)};u.addEventListener("dispose",d);const f=u.onInitFunction;f!==null&&f.call(u,{renderer:this})}o.updateForCompute(u),s.updateForCompute(u);const c=s.getForCompute(u),h=a.getForCompute(u,c);i.compute(e,u,c,h)}i.finishCompute(e),t.renderId=n}async computeAsync(e){this._initialized===!1&&await this.init(),this.compute(e)}async hasFeatureAsync(e){return this._initialized===!1&&await this.init(),this.backend.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){return this._initialized===!1?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){this._initialized===!1&&await this.init(),this._textures.updateTexture(e)}initTexture(e){this._initialized===!1&&console.warn("THREE.Renderer: .initTexture() called before the backend is initialized. Try using .initTextureAsync() instead."),this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=yo.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=yo.copy(t).floor();else{console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=yo.set(0,0,e.image.width,e.image.height);let n=this._currentRenderContext,i;n!==null?i=n.renderTarget:(i=this._renderTarget||this._getFrameBufferTarget(),i!==null&&(this._textures.updateRenderTarget(i),n=this._textures.get(i))),this._textures.updateTexture(e,{renderTarget:i}),this.backend.copyFramebufferToTexture(e,n,t)}copyTextureToTexture(e,t,n=null,i=null,a=0,s=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,n,i,a,s)}async readRenderTargetPixelsAsync(e,t,n,i,a,s=0,o=0){return this.backend.copyTextureToBuffer(e.textures[s],t,n,i,a,o)}_projectObject(e,t,n,i,a){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)n=e.renderOrder,e.isClippingGroup&&e.enabled&&(a=a.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)i.pushLight(e);else if(e.isSprite){if(!e.frustumCulled||ew.intersectsSprite(e)){this.sortObjects===!0&&yo.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Kp);const{geometry:l,material:u}=e;u.visible&&i.push(e,l,u,n,yo.z,null,a)}}else if(e.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||ew.intersectsObject(e))){const{geometry:l,material:u}=e;if(this.sortObjects===!0&&(l.boundingSphere===null&&l.computeBoundingSphere(),yo.copy(l.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(Kp)),Array.isArray(u)){const c=l.groups;for(let h=0,d=c.length;h<d;h++){const f=c[h],p=u[f.materialIndex];p&&p.visible&&i.push(e,l,p,n,yo.z,f,a)}}else u.visible&&i.push(e,l,u,n,yo.z,null,a)}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const l=i;i=this._renderLists.get(e,t),i.begin(),l.pushBundle({bundleGroup:e,camera:t,renderList:i}),i.finish()}const o=e.children;for(let l=0,u=o.length;l<u;l++)this._projectObject(o[l],t,n,i,a)}_renderBundles(e,t,n){for(const i of e)this._renderBundle(i,t,n)}_renderTransparents(e,t,n,i,a){if(t.length>0){for(const{material:s}of t)s.side=dn;this._renderObjects(t,n,i,a,"backSide");for(const{material:s}of t)s.side=yi;this._renderObjects(e,n,i,a);for(const{material:s}of t)s.side=Qr}else this._renderObjects(e,n,i,a)}_renderObjects(e,t,n,i,a=null){for(let s=0,o=e.length;s<o;s++){const{object:l,geometry:u,material:c,group:h,clippingContext:d}=e[s];this._currentRenderObjectFunction(l,n,t,u,c,h,i,d,a)}}renderObject(e,t,n,i,a,s,o,l=null,u=null){let c,h,d;if(e.onBeforeRender(this,t,n,i,a,s),a.allowOverride===!0&&t.overrideMaterial!==null){const f=t.overrideMaterial;a.positionNode&&a.positionNode.isNode&&(c=f.positionNode,f.positionNode=a.positionNode),f.alphaTest=a.alphaTest,f.alphaMap=a.alphaMap,f.transparent=a.transparent||a.transmission>0,f.isShadowPassMaterial&&(f.side=a.shadowSide===null?a.side:a.shadowSide,a.depthNode&&a.depthNode.isNode&&(d=f.depthNode,f.depthNode=a.depthNode),a.castShadowNode&&a.castShadowNode.isNode&&(h=f.colorNode,f.colorNode=a.castShadowNode)),a=f}a.transparent===!0&&a.side===Qr&&a.forceSinglePass===!1?(a.side=dn,this._handleObjectFunction(e,a,t,n,o,s,l,"backSide"),a.side=yi,this._handleObjectFunction(e,a,t,n,o,s,l,u),a.side=Qr):this._handleObjectFunction(e,a,t,n,o,s,l,u),c!==void 0&&(t.overrideMaterial.positionNode=c),d!==void 0&&(t.overrideMaterial.depthNode=d),h!==void 0&&(t.overrideMaterial.colorNode=h),e.onAfterRender(this,t,n,i,a,s)}_renderObjectDirect(e,t,n,i,a,s,o,l){const u=this._objects.get(e,t,n,i,a,this._currentRenderContext,o,l);u.drawRange=e.geometry.drawRange,u.group=s;const c=this._nodes.needsRefresh(u);c&&(this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u)),this._pipelines.updateForRender(u),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(u),u.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(u,this.info),c&&this._nodes.updateAfter(u)}_createObjectPipeline(e,t,n,i,a,s,o,l){const u=this._objects.get(e,t,n,i,a,this._currentRenderContext,o,l);u.drawRange=e.geometry.drawRange,u.group=s,this._nodes.updateBefore(u),this._geometries.updateForRender(u),this._nodes.updateForRender(u),this._bindings.updateForRender(u),this._pipelines.getForRender(u,this._compilationPromises),this._nodes.updateAfter(u)}get compile(){return this.compileAsync}}class WM{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}function Ype(r){return r+(wo-r%wo)%wo}class K4 extends WM{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t}get byteLength(){return Ype(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class Q4 extends K4{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let jpe=0;class Z4 extends Q4{constructor(e,t){super("UniformBuffer_"+jpe++,e?e.value:null),this.nodeUniform=e,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class Kpe extends Q4{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){let e=0;for(let t=0,n=this.uniforms.length;t<n;t++){const i=this.uniforms[t],{boundary:a,itemSize:s}=i,o=e%wo,l=wo-o;o!==0&&l-a<0?e+=wo-o:o%a!==0&&(e+=o%a),i.offset=e/this.bytesPerElement,e+=s*this.bytesPerElement}return Math.ceil(e/wo)*wo}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const n=this.values,i=e.getValue(),a=e.offset,s=e.getType();if(n[a]!==i){const o=this._getBufferForType(s);o[a]=n[a]=i,t=!0}return t}updateVector2(e){let t=!1;const n=this.values,i=e.getValue(),a=e.offset,s=e.getType();if(n[a+0]!==i.x||n[a+1]!==i.y){const o=this._getBufferForType(s);o[a+0]=n[a+0]=i.x,o[a+1]=n[a+1]=i.y,t=!0}return t}updateVector3(e){let t=!1;const n=this.values,i=e.getValue(),a=e.offset,s=e.getType();if(n[a+0]!==i.x||n[a+1]!==i.y||n[a+2]!==i.z){const o=this._getBufferForType(s);o[a+0]=n[a+0]=i.x,o[a+1]=n[a+1]=i.y,o[a+2]=n[a+2]=i.z,t=!0}return t}updateVector4(e){let t=!1;const n=this.values,i=e.getValue(),a=e.offset,s=e.getType();if(n[a+0]!==i.x||n[a+1]!==i.y||n[a+2]!==i.z||n[a+4]!==i.w){const o=this._getBufferForType(s);o[a+0]=n[a+0]=i.x,o[a+1]=n[a+1]=i.y,o[a+2]=n[a+2]=i.z,o[a+3]=n[a+3]=i.w,t=!0}return t}updateColor(e){let t=!1;const n=this.values,i=e.getValue(),a=e.offset;if(n[a+0]!==i.r||n[a+1]!==i.g||n[a+2]!==i.b){const s=this.buffer;s[a+0]=n[a+0]=i.r,s[a+1]=n[a+1]=i.g,s[a+2]=n[a+2]=i.b,t=!0}return t}updateMatrix3(e){let t=!1;const n=this.values,i=e.getValue().elements,a=e.offset;if(n[a+0]!==i[0]||n[a+1]!==i[1]||n[a+2]!==i[2]||n[a+4]!==i[3]||n[a+5]!==i[4]||n[a+6]!==i[5]||n[a+8]!==i[6]||n[a+9]!==i[7]||n[a+10]!==i[8]){const s=this.buffer;s[a+0]=n[a+0]=i[0],s[a+1]=n[a+1]=i[1],s[a+2]=n[a+2]=i[2],s[a+4]=n[a+4]=i[3],s[a+5]=n[a+5]=i[4],s[a+6]=n[a+6]=i[5],s[a+8]=n[a+8]=i[6],s[a+9]=n[a+9]=i[7],s[a+10]=n[a+10]=i[8],t=!0}return t}updateMatrix4(e){let t=!1;const n=this.values,i=e.getValue().elements,a=e.offset;return Zpe(n,i,a)===!1&&(this.buffer.set(i,a),Qpe(n,i,a),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function Qpe(r,e,t){for(let n=0,i=e.length;n<i;n++)r[t+n]=e[n]}function Zpe(r,e,t){for(let n=0,i=e.length;n<i;n++)if(r[t+n]!==e[n])return!1;return!0}let Jpe=0;class J4 extends Kpe{constructor(e,t){super(e),this.id=Jpe++,this.groupNode=t,this.isNodeUniformsGroup=!0}}let ege=0;class tge extends WM{constructor(e,t){super(e),this.id=ege++,this.texture=t,this.version=t?t.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(e){const{texture:t}=this;return e!==this.generation?(this.generation=e,!0):t.isVideoTexture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}}class Lm extends tge{constructor(e,t,n,i=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n,this.access=i}needsBindingsUpdate(e){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(e)}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class e5 extends Lm{constructor(e,t,n,i=null){super(e,t,n,i),this.isSampledCubeTexture=!0}}class t5 extends Lm{constructor(e,t,n,i=null){super(e,t,n,i),this.isSampledTexture3D=!0}}const nge={textureDimensions:"textureSize",equals:"equal"},rge={low:"lowp",medium:"mediump",high:"highp"},jB={swizzleAssign:!0,storageBuffer:!1},KB=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
`;class ige extends $4{constructor(e,t){super(e,t,new Lpe),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Bi}getMethod(e){return nge[e]||e}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),i=[];for(const s of t.inputs)i.push(this.getType(s.type)+" "+s.name);return`${this.getType(t.type)} ${t.name}( ${i.join(", ")} ) {

	${n.vars}

${n.code}
	return ${n.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const n=t.array,i=t.count*t.itemSize,{itemSize:a}=t,s=t.array.constructor.name.toLowerCase().includes("int");let o=s?lh:Pd;a===2?o=s?uh:Ql:a===3?o=s?_Q:Nd:a===4&&(o=s?ch:On);const l={Float32Array:Un,Uint8Array:In,Uint16Array:Pa,Uint32Array:hn,Int8Array:Ol,Int16Array:Fl,Int32Array:mr,Uint8ClampedArray:In},u=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(i/a))));let c=Math.ceil(i/a/u);u*c*a<i&&c++;const h=u*c*a,d=new n.constructor(h);d.set(n,0),t.array=d;const f=new TZ(t.array,u,c,o,l[t.array.constructor.name]||Un);f.needsUpdate=!0,f.isPBOTexture=!0;const p=new Hd(f,null,null);p.setPrecision("high"),t.pboNode=p,t.pbo=p.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:n}=e,i=t.value;if(this.renderer.backend.has(i)){const c=this.renderer.backend.get(i);c.pbo=i.pbo}const a=this.getUniformFromNode(i.pboNode,"texture",this.shaderStage,this.context.label),s=this.getPropertyName(a);this.increaseUsage(n);const o=n.build(this,"uint"),l=this.getDataFromNode(e);let u=l.propertyName;if(u===void 0){const c=this.getVarFromNode(e);u=this.getPropertyName(c);const h=this.getDataFromNode(t);let d=h.propertySizeName;d===void 0&&(d=u+"Size",this.getVarFromNode(t,d,"uint"),this.addLineFlowCode(`${d} = uint( textureSize( ${s}, 0 ).x )`,e),h.propertySizeName=d);const{itemSize:f}=i,p="."+dh.join("").slice(0,f),m=`ivec2(${o} % ${d}, ${o} / ${d})`,v=this.generateTextureLoad(null,s,m,null,"0");let g="vec4";i.pbo.type===hn?g="uvec4":i.pbo.type===mr&&(g="ivec4"),this.addLineFlowCode(`${u} = ${g}(${v})${p}`,e),l.propertyName=u}return u}generateTextureLoad(e,t,n,i,a="0"){return i?`texelFetch( ${t}, ivec3( ${n}, ${i} ), ${a} )`:`texelFetch( ${t}, ${n}, ${a} )`}generateTexture(e,t,n,i){return e.isDepthTexture?`texture( ${t}, ${n} ).x`:(i&&(n=`vec3( ${n}, ${i} )`),`texture( ${t}, ${n} )`)}generateTextureLevel(e,t,n,i){return`textureLod( ${t}, ${n}, ${i} )`}generateTextureBias(e,t,n,i){return`texture( ${t}, ${n}, ${i} )`}generateTextureGrad(e,t,n,i){return`textureGrad( ${t}, ${n}, ${i[0]}, ${i[1]} )`}generateTextureCompare(e,t,n,i,a,s=this.shaderStage){if(s==="fragment")return`texture( ${t}, vec3( ${n}, ${i} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${s} shader.`)}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const i of n)t.push(`${this.getVar(i.type,i.name,i.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],n=[],i={};for(const s of t){let o=null,l=!1;if(s.type==="texture"||s.type==="texture3D"){const c=s.node.value;let h="";(c.isDataTexture===!0||c.isData3DTexture===!0)&&(c.type===hn?h="u":c.type===mr&&(h="i")),s.type==="texture3D"?o=`${h}sampler3D ${s.name};`:c.compareFunction?o=`sampler2DShadow ${s.name};`:c.isDataArrayTexture===!0||c.isCompressedArrayTexture===!0?o=`${h}sampler2DArray ${s.name};`:o=`${h}sampler2D ${s.name};`}else if(s.type==="cubeTexture")o=`samplerCube ${s.name};`;else if(s.type==="buffer"){const c=s.node,h=this.getType(c.bufferType),d=c.bufferCount,f=d>0?d:"";o=`${c.name} {
	${h} ${s.name}[${f}];
};
`}else o=`${this.getVectorType(s.type)} ${this.getPropertyName(s,e)};`,l=!0;const u=s.node.precision;if(u!==null&&(o=rge[u]+" "+o),l){o="	"+o;const c=s.groupNode.name;(i[c]||(i[c]=[])).push(o)}else o="uniform "+o,n.push(o)}let a="";for(const s in i){const o=i[s];a+=this._getGLSLUniformStruct(e+"_"+s,o.join(`
`))+`
`}return a+=n.join(`
`),a}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==mr){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);const i=n.array;i instanceof Uint32Array||i instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const n=this.getAttributesArray();let i=0;for(const a of n)t+=`layout( location = ${i++} ) in ${a.type} ${a.name};
`}return t}getStructMembers(e){const t=[];for(const n of e.members)t.push(`	${n.type} ${n.name};`);return t.join(`
`)}getStructs(e){const t=[],n=this.structs[e],i=[];for(const a of n)if(a.output)for(const s of a.members)i.push(`layout( location = ${s.index} ) out ${s.type} ${s.name};`);else{let s="struct "+a.name+` {
`;s+=this.getStructMembers(a),s+=`
};
`,t.push(s)}return i.length===0&&i.push("layout( location = 0 ) out vec4 fragColor;"),`
`+i.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const n=this.varyings;if(e==="vertex"||e==="compute")for(const i of n){e==="compute"&&(i.needsInterpolation=!0);const a=this.getType(i.type);if(i.needsInterpolation){const s=a.includes("int")||a.includes("uv")||a.includes("iv")?"flat ":"";t+=`${s}out ${a} ${i.name};
`}else t+=`${a} ${i.name};
`}else if(e==="fragment"){for(const i of n)if(i.needsInterpolation){const a=this.getType(i.type),s=a.includes("int")||a.includes("uv")||a.includes("iv")?"flat ":"";t+=`${s}in ${a} ${i.name};
`}}for(const i of this.builtins[e])t+=`${i};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((n,i)=>n*i,1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,n=this.shaderStage){const i=this.extensions[n]||(this.extensions[n]=new Map);i.has(e)===!1&&i.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const i=this.renderer.backend.extensions;this.object.isBatchedMesh&&i.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const n=this.extensions[e];if(n!==void 0)for(const{name:i,behavior:a}of n.values())t.push(`#extension ${i} : ${a}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=jB[e];if(t===void 0){let n;switch(t=!1,e){case"float32Filterable":n="OES_texture_float_linear";break;case"clipDistance":n="WEBGL_clip_cull_distance";break}if(n!==void 0){const i=this.renderer.backend.extensions;i.has(n)&&(i.get(n),t=!0)}jB[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let n=0;n<e.length;n++){const i=e[n],a=this.getPropertyName(i.attributeNode);a&&(t+=`${i.varyingName} = ${a};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${KB}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// precision
${KB}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

// structs
${e.structs}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let n=`// code

`;n+=this.flowCode[t];const i=this.flowNodes[t],a=i[i.length-1];for(const o of i){const l=this.getFlowData(o),u=o.name;u&&(n.length>0&&(n+=`
`),n+=`	// flow -> ${u}
	`),n+=`${l.code}
	`,o===a&&t!=="compute"&&(n+=`// result
	`,t==="vertex"?(n+="gl_Position = ",n+=`${l.result};`):t==="fragment"&&(o.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${l.result};`)))}const s=e[t];s.extensions=this.getExtensions(t),s.uniforms=this.getUniforms(t),s.attributes=this.getAttributes(t),s.varyings=this.getVaryings(t),s.vars=this.getVars(t),s.structs=this.getStructs(t),s.codes=this.getCodes(t),s.transforms=this.getTransforms(t),s.flow=n}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,n,i=null){const a=super.getUniformFromNode(e,t,n,i),s=this.getDataFromNode(e,n,this.globalCache);let o=s.uniformGPU;if(o===void 0){const l=e.groupNode,u=l.name,c=this.getBindGroupArray(u,n);if(t==="texture")o=new Lm(a.name,a.node,l),c.push(o);else if(t==="cubeTexture")o=new e5(a.name,a.node,l),c.push(o);else if(t==="texture3D")o=new t5(a.name,a.node,l),c.push(o);else if(t==="buffer"){e.name=`NodeBuffer_${e.id}`,a.name=`buffer${e.id}`;const h=new Z4(e,l);h.name=e.name,c.push(h),o=h}else{const h=this.uniformGroups[n]||(this.uniformGroups[n]={});let d=h[u];d===void 0&&(d=new J4(n+"_"+u,l),h[u]=d,c.push(d)),o=this.getNodeUniform(a,t),d.addUniform(o)}s.uniformGPU=o}return a}}let tw=null,zu=null;class n5{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={render:null,compute:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}destroySampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){Ia("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t){Ia(`WebGPURenderer: No timestamp query pool for type '${e}' found.`);return}const n=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=n,n}async waitForGPU(){}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return tw=tw||new He,this.renderer.getDrawingBufferSize(tw)}setScissorTest(){}getClearColor(){const e=this.renderer;return zu=zu||new zM,e.getClearColor(zu),zu.getRGB(zu),zu}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:lz(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${oh} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let age=0;class sge{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class oge{constructor(e){this.backend=e}createAttribute(e,t){const n=this.backend,{gl:i}=n,a=e.array,s=e.usage||i.STATIC_DRAW,o=e.isInterleavedBufferAttribute?e.data:e,l=n.get(o);let u=l.bufferGPU;u===void 0&&(u=this._createBuffer(i,t,a,s),l.bufferGPU=u,l.bufferType=t,l.version=o.version);let c;if(a instanceof Float32Array)c=i.FLOAT;else if(a instanceof Uint16Array)e.isFloat16BufferAttribute?c=i.HALF_FLOAT:c=i.UNSIGNED_SHORT;else if(a instanceof Int16Array)c=i.SHORT;else if(a instanceof Uint32Array)c=i.UNSIGNED_INT;else if(a instanceof Int32Array)c=i.INT;else if(a instanceof Int8Array)c=i.BYTE;else if(a instanceof Uint8Array)c=i.UNSIGNED_BYTE;else if(a instanceof Uint8ClampedArray)c=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+a);let h={bufferGPU:u,bufferType:t,type:c,byteLength:a.byteLength,bytesPerElement:a.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:c===i.INT||c===i.UNSIGNED_INT||e.gpuType===mr,id:age++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const d=this._createBuffer(i,t,a,s);h=new sge(h,d)}n.set(e,h)}updateAttribute(e){const t=this.backend,{gl:n}=t,i=e.array,a=e.isInterleavedBufferAttribute?e.data:e,s=t.get(a),o=s.bufferType,l=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(o,s.bufferGPU),l.length===0)n.bufferSubData(o,0,i);else{for(let u=0,c=l.length;u<c;u++){const h=l[u];n.bufferSubData(o,h.start*i.BYTES_PER_ELEMENT,i,h.start,h.count)}a.clearUpdateRanges()}n.bindBuffer(o,null),s.version=a.version}destroyAttribute(e){const t=this.backend,{gl:n}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const i=t.get(e);n.deleteBuffer(i.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:n}=t,i=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:a}=t.get(i),s=e.array,o=s.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,a);const l=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,l),n.bufferData(n.COPY_WRITE_BUFFER,o,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,o),await t.utils._clientWaitAsync();const u=new e.array.constructor(s.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,l),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,u),n.deleteBuffer(l),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),u.buffer}_createBuffer(e,t,n,i){const a=e.createBuffer();return e.bindBuffer(t,a),e.bufferData(t,n,i),e.bindBuffer(t,null),a}}let nw,Xh;class lge{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;nw={[Br]:e.FUNC_ADD,[EA]:e.FUNC_SUBTRACT,[TA]:e.FUNC_REVERSE_SUBTRACT},Xh={[As]:e.ZERO,[wA]:e.ONE,[SA]:e.SRC_COLOR,[Of]:e.SRC_ALPHA,[PA]:e.SRC_ALPHA_SATURATE,[RA]:e.DST_COLOR,[MA]:e.DST_ALPHA,[AA]:e.ONE_MINUS_SRC_COLOR,[Ff]:e.ONE_MINUS_SRC_ALPHA,[NA]:e.ONE_MINUS_DST_COLOR,[CA]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),n=e.getParameter(e.VIEWPORT);this.currentScissor=new xt().fromArray(t),this.currentViewport=new xt().fromArray(n),this._tempVec4=new xt}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==jG?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===Ww?t.cullFace(t.BACK):e===KG?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:n}=this;e!==t&&(n.lineWidth(e),this.currentLineWidth=e)}setBlending(e,t,n,i,a,s,o,l){const{gl:u}=this;if(e===_i){this.currentBlendingEnabled===!0&&(this.disable(u.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(u.BLEND),this.currentBlendingEnabled=!0),e!==hc){if(e!==this.currentBlending||l!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==Br||this.currentBlendEquationAlpha!==Br)&&(u.blendEquation(u.FUNC_ADD),this.currentBlendEquation=Br,this.currentBlendEquationAlpha=Br),l)switch(e){case aa:u.blendFuncSeparate(u.ONE,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case wc:u.blendFunc(u.ONE,u.ONE);break;case Sc:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case Ac:u.blendFuncSeparate(u.ZERO,u.SRC_COLOR,u.ZERO,u.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}else switch(e){case aa:u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA);break;case wc:u.blendFunc(u.SRC_ALPHA,u.ONE);break;case Sc:u.blendFuncSeparate(u.ZERO,u.ONE_MINUS_SRC_COLOR,u.ZERO,u.ONE);break;case Ac:u.blendFunc(u.ZERO,u.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=l}return}a=a||t,s=s||n,o=o||i,(t!==this.currentBlendEquation||a!==this.currentBlendEquationAlpha)&&(u.blendEquationSeparate(nw[t],nw[a]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=a),(n!==this.currentBlendSrc||i!==this.currentBlendDst||s!==this.currentBlendSrcAlpha||o!==this.currentBlendDstAlpha)&&(u.blendFuncSeparate(Xh[n],Xh[i],Xh[s],Xh[o]),this.currentBlendSrc=n,this.currentBlendDst=i,this.currentBlendSrcAlpha=s,this.currentBlendDstAlpha=o),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case Bf:t.depthFunc(t.NEVER);break;case Uf:t.depthFunc(t.ALWAYS);break;case kf:t.depthFunc(t.LESS);break;case Ho:t.depthFunc(t.LEQUAL);break;case Gf:t.depthFunc(t.EQUAL);break;case zf:t.depthFunc(t.GEQUAL);break;case Vf:t.depthFunc(t.GREATER);break;case Hf:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,n,i){const a=this._tempVec4.set(e,t,n,i);if(this.currentScissor.equals(a)===!1){const{gl:s}=this;s.scissor(a.x,a.y,a.z,a.w),this.currentScissor.copy(a)}}viewport(e,t,n,i){const a=this._tempVec4.set(e,t,n,i);if(this.currentViewport.equals(a)===!1){const{gl:s}=this;s.viewport(a.x,a.y,a.z,a.w),this.currentViewport.copy(a)}}setScissorTest(e){const t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,n){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==n)&&(this.gl.stencilFunc(e,t,n),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=n)}setStencilOp(e,t,n){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==n)&&(this.gl.stencilOp(e,t,n),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=n)}setMaterial(e,t,n){const{gl:i}=this;e.side===Qr?this.disable(i.CULL_FACE):this.enable(i.CULL_FACE);let a=e.side===dn;t&&(a=!a),this.setFlipSided(a),e.blending===aa&&e.transparent===!1?this.setBlending(_i):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const s=e.stencilWrite;if(this.setStencilTest(s),s&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.samples>1?this.enable(i.SAMPLE_ALPHA_TO_COVERAGE):this.disable(i.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n)for(let l=0;l<8;l++)l<n?this.enable(12288+l):this.disable(12288+l)}setPolygonOffset(e,t,n){const{gl:i}=this;e?(this.enable(i.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==n)&&(i.polygonOffset(t,n),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=n)):this.disable(i.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const n=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(n.bindVertexArray(e),t!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:n,currentBoundFramebuffers:i}=this;return i[e]!==t?(n.bindFramebuffer(e,t),i[e]=t,e===n.DRAW_FRAMEBUFFER&&(i[n.FRAMEBUFFER]=t),e===n.FRAMEBUFFER&&(i[n.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:n}=this;let i=[],a=!1;if(e.textures!==null){i=this.currentDrawbuffers.get(t),i===void 0&&(i=[],this.currentDrawbuffers.set(t,i));const s=e.textures;if(i.length!==s.length||i[0]!==n.COLOR_ATTACHMENT0){for(let o=0,l=s.length;o<l;o++)i[o]=n.COLOR_ATTACHMENT0+o;i.length=s.length,a=!0}}else i[0]!==n.BACK&&(i[0]=n.BACK,a=!0);a&&n.drawBuffers(i)}activeTexture(e){const{gl:t,currentTextureSlot:n,maxTextures:i}=this;e===void 0&&(e=t.TEXTURE0+i-1),n!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,n){const{gl:i,currentTextureSlot:a,currentBoundTextures:s,maxTextures:o}=this;n===void 0&&(a===null?n=i.TEXTURE0+o-1:n=a);let l=s[n];l===void 0&&(l={type:void 0,texture:void 0},s[n]=l),(l.type!==e||l.texture!==t)&&(a!==n&&(i.activeTexture(n),this.currentTextureSlot=n),i.bindTexture(e,t),l.type=e,l.texture=t)}bindBufferBase(e,t,n){const{gl:i}=this,a=`${e}-${t}`;return this.currentBoundBufferBases[a]!==n?(i.bindBufferBase(e,t,n),this.currentBoundBufferBases[a]=n,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:n}=this,i=n[t];i!==void 0&&i.type!==void 0&&(e.bindTexture(i.type,null),i.type=void 0,i.texture=void 0)}}class uge{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=Bi){const{gl:n,extensions:i}=this;let a;if(e===In)return n.UNSIGNED_BYTE;if(e===rm)return n.UNSIGNED_SHORT_4_4_4_4;if(e===im)return n.UNSIGNED_SHORT_5_5_5_1;if(e===am)return n.UNSIGNED_INT_5_9_9_9_REV;if(e===Ol)return n.BYTE;if(e===Fl)return n.SHORT;if(e===Pa)return n.UNSIGNED_SHORT;if(e===mr)return n.INT;if(e===hn)return n.UNSIGNED_INT;if(e===Un)return n.FLOAT;if(e===kr)return n.HALF_FLOAT;if(e===IA)return n.ALPHA;if(e===Nd)return n.RGB;if(e===On)return n.RGBA;if(e===OA)return n.LUMINANCE;if(e===FA)return n.LUMINANCE_ALPHA;if(e===zi)return n.DEPTH_COMPONENT;if(e===Vi)return n.DEPTH_STENCIL;if(e===Pd)return n.RED;if(e===lh)return n.RED_INTEGER;if(e===Ql)return n.RG;if(e===uh)return n.RG_INTEGER;if(e===ch)return n.RGBA_INTEGER;if(e===Bl||e===Po||e===Do||e===Lo)if(t===ft)if(a=i.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(e===Bl)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===Po)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===Do)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===Lo)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=i.get("WEBGL_compressed_texture_s3tc"),a!==null){if(e===Bl)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Po)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Do)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Lo)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===Wf||e===qf||e===$f||e===Xf)if(a=i.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(e===Wf)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===qf)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===$f)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Xf)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===Yf||e===Mc||e===Cc)if(a=i.get("WEBGL_compressed_texture_etc"),a!==null){if(e===Yf||e===Mc)return t===ft?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(e===Cc)return t===ft?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(e===Rc||e===Nc||e===Pc||e===Dc||e===Lc||e===Ic||e===Oc||e===Fc||e===Bc||e===Uc||e===kc||e===Gc||e===zc||e===Vc)if(a=i.get("WEBGL_compressed_texture_astc"),a!==null){if(e===Rc)return t===ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===Nc)return t===ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===Pc)return t===ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===Dc)return t===ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===Lc)return t===ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===Ic)return t===ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===Oc)return t===ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===Fc)return t===ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===Bc)return t===ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===Uc)return t===ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===kc)return t===ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===Gc)return t===ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===zc)return t===ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===Vc)return t===ft?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===Ul)if(a=i.get("EXT_texture_compression_bptc"),a!==null){if(e===Ul)return t===ft?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===BA||e===jf||e===Kf||e===Qf)if(a=i.get("EXT_texture_compression_rgtc"),a!==null){if(e===Ul)return a.COMPRESSED_RED_RGTC1_EXT;if(e===jf)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===Kf)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===Qf)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===Gi?n.UNSIGNED_INT_24_8:n[e]!==void 0?n[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((n,i)=>{function a(){const s=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(s===e.WAIT_FAILED){e.deleteSync(t),i();return}if(s===e.TIMEOUT_EXPIRED){requestAnimationFrame(a);return}e.deleteSync(t),n()}a()})}}let QB=!1,Qp,rw,ZB;class cge{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},QB===!1&&(this._init(),QB=!0)}_init(){const e=this.gl;Qp={[jl]:e.REPEAT,[ts]:e.CLAMP_TO_EDGE,[Kl]:e.MIRRORED_REPEAT},rw={[mn]:e.NEAREST,[LA]:e.NEAREST_MIPMAP_NEAREST,[Bs]:e.NEAREST_MIPMAP_LINEAR,[ir]:e.LINEAR,[fc]:e.LINEAR_MIPMAP_NEAREST,[fi]:e.LINEAR_MIPMAP_LINEAR},ZB={[UA]:e.NEVER,[HA]:e.ALWAYS,[sm]:e.LESS,[om]:e.LEQUAL,[kA]:e.EQUAL,[VA]:e.GEQUAL,[GA]:e.GREATER,[zA]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let n;return e.isCubeTexture===!0?n=t.TEXTURE_CUBE_MAP:e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?n=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?n=t.TEXTURE_3D:n=t.TEXTURE_2D,n}getInternalFormat(e,t,n,i,a=!1){const{gl:s,extensions:o}=this;if(e!==null){if(s[e]!==void 0)return s[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let l=t;return t===s.RED&&(n===s.FLOAT&&(l=s.R32F),n===s.HALF_FLOAT&&(l=s.R16F),n===s.UNSIGNED_BYTE&&(l=s.R8),n===s.UNSIGNED_SHORT&&(l=s.R16),n===s.UNSIGNED_INT&&(l=s.R32UI),n===s.BYTE&&(l=s.R8I),n===s.SHORT&&(l=s.R16I),n===s.INT&&(l=s.R32I)),t===s.RED_INTEGER&&(n===s.UNSIGNED_BYTE&&(l=s.R8UI),n===s.UNSIGNED_SHORT&&(l=s.R16UI),n===s.UNSIGNED_INT&&(l=s.R32UI),n===s.BYTE&&(l=s.R8I),n===s.SHORT&&(l=s.R16I),n===s.INT&&(l=s.R32I)),t===s.RG&&(n===s.FLOAT&&(l=s.RG32F),n===s.HALF_FLOAT&&(l=s.RG16F),n===s.UNSIGNED_BYTE&&(l=s.RG8),n===s.UNSIGNED_SHORT&&(l=s.RG16),n===s.UNSIGNED_INT&&(l=s.RG32UI),n===s.BYTE&&(l=s.RG8I),n===s.SHORT&&(l=s.RG16I),n===s.INT&&(l=s.RG32I)),t===s.RG_INTEGER&&(n===s.UNSIGNED_BYTE&&(l=s.RG8UI),n===s.UNSIGNED_SHORT&&(l=s.RG16UI),n===s.UNSIGNED_INT&&(l=s.RG32UI),n===s.BYTE&&(l=s.RG8I),n===s.SHORT&&(l=s.RG16I),n===s.INT&&(l=s.RG32I)),t===s.RGB&&(n===s.FLOAT&&(l=s.RGB32F),n===s.HALF_FLOAT&&(l=s.RGB16F),n===s.UNSIGNED_BYTE&&(l=s.RGB8),n===s.UNSIGNED_SHORT&&(l=s.RGB16),n===s.UNSIGNED_INT&&(l=s.RGB32UI),n===s.BYTE&&(l=s.RGB8I),n===s.SHORT&&(l=s.RGB16I),n===s.INT&&(l=s.RGB32I),n===s.UNSIGNED_BYTE&&(l=i===ft&&a===!1?s.SRGB8:s.RGB8),n===s.UNSIGNED_SHORT_5_6_5&&(l=s.RGB565),n===s.UNSIGNED_SHORT_5_5_5_1&&(l=s.RGB5_A1),n===s.UNSIGNED_SHORT_4_4_4_4&&(l=s.RGB4),n===s.UNSIGNED_INT_5_9_9_9_REV&&(l=s.RGB9_E5)),t===s.RGB_INTEGER&&(n===s.UNSIGNED_BYTE&&(l=s.RGB8UI),n===s.UNSIGNED_SHORT&&(l=s.RGB16UI),n===s.UNSIGNED_INT&&(l=s.RGB32UI),n===s.BYTE&&(l=s.RGB8I),n===s.SHORT&&(l=s.RGB16I),n===s.INT&&(l=s.RGB32I)),t===s.RGBA&&(n===s.FLOAT&&(l=s.RGBA32F),n===s.HALF_FLOAT&&(l=s.RGBA16F),n===s.UNSIGNED_BYTE&&(l=s.RGBA8),n===s.UNSIGNED_SHORT&&(l=s.RGBA16),n===s.UNSIGNED_INT&&(l=s.RGBA32UI),n===s.BYTE&&(l=s.RGBA8I),n===s.SHORT&&(l=s.RGBA16I),n===s.INT&&(l=s.RGBA32I),n===s.UNSIGNED_BYTE&&(l=i===ft&&a===!1?s.SRGB8_ALPHA8:s.RGBA8),n===s.UNSIGNED_SHORT_4_4_4_4&&(l=s.RGBA4),n===s.UNSIGNED_SHORT_5_5_5_1&&(l=s.RGB5_A1)),t===s.RGBA_INTEGER&&(n===s.UNSIGNED_BYTE&&(l=s.RGBA8UI),n===s.UNSIGNED_SHORT&&(l=s.RGBA16UI),n===s.UNSIGNED_INT&&(l=s.RGBA32UI),n===s.BYTE&&(l=s.RGBA8I),n===s.SHORT&&(l=s.RGBA16I),n===s.INT&&(l=s.RGBA32I)),t===s.DEPTH_COMPONENT&&(n===s.UNSIGNED_SHORT&&(l=s.DEPTH_COMPONENT16),n===s.UNSIGNED_INT&&(l=s.DEPTH_COMPONENT24),n===s.FLOAT&&(l=s.DEPTH_COMPONENT32F)),t===s.DEPTH_STENCIL&&n===s.UNSIGNED_INT_24_8&&(l=s.DEPTH24_STENCIL8),(l===s.R16F||l===s.R32F||l===s.RG16F||l===s.RG32F||l===s.RGBA16F||l===s.RGBA32F)&&o.get("EXT_color_buffer_float"),l}setTextureParameters(e,t){const{gl:n,extensions:i,backend:a}=this;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,t.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE),n.texParameteri(e,n.TEXTURE_WRAP_S,Qp[t.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,Qp[t.wrapT]),(e===n.TEXTURE_3D||e===n.TEXTURE_2D_ARRAY)&&n.texParameteri(e,n.TEXTURE_WRAP_R,Qp[t.wrapR]),n.texParameteri(e,n.TEXTURE_MAG_FILTER,rw[t.magFilter]);const s=t.mipmaps!==void 0&&t.mipmaps.length>0,o=t.minFilter===ir&&s?fi:t.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,rw[o]),t.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,ZB[t.compareFunction])),i.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===mn||t.minFilter!==Bs&&t.minFilter!==fi||t.type===Un&&i.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const l=i.get("EXT_texture_filter_anisotropic");n.texParameterf(e,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,a.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:n,defaultTextures:i}=this,a=this.getGLTextureType(e);let s=i[a];s===void 0&&(s=t.createTexture(),n.state.bindTexture(a,s),t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST),i[a]=s),n.set(e,{textureGPU:s,glTextureType:a,isDefault:!0})}createTexture(e,t){const{gl:n,backend:i}=this,{levels:a,width:s,height:o,depth:l}=t,u=i.utils.convert(e.format,e.colorSpace),c=i.utils.convert(e.type),h=this.getInternalFormat(e.internalFormat,u,c,e.colorSpace,e.isVideoTexture),d=n.createTexture(),f=this.getGLTextureType(e);i.state.bindTexture(f,d),this.setTextureParameters(f,e),e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,a,h,s,o,l):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,a,h,s,o,l):e.isVideoTexture||n.texStorage2D(f,a,h,s,o),i.set(e,{textureGPU:d,glTextureType:f,glFormat:u,glType:c,glInternalFormat:h})}copyBufferToTexture(e,t){const{gl:n,backend:i}=this,{textureGPU:a,glTextureType:s,glFormat:o,glType:l}=i.get(t),{width:u,height:c}=t.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),i.state.bindTexture(s,a),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(s,0,0,0,u,c,o,l,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),i.state.unbindTexture()}updateTexture(e,t){const{gl:n}=this,{width:i,height:a}=t,{textureGPU:s,glTextureType:o,glFormat:l,glType:u,glInternalFormat:c}=this.backend.get(e);if(e.isRenderTargetTexture||s===void 0)return;const h=d=>d.isDataTexture?d.image.data:typeof HTMLImageElement<"u"&&d instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&d instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&d instanceof ImageBitmap||d instanceof OffscreenCanvas?d:d.data;if(this.backend.state.bindTexture(o,s),this.setTextureParameters(o,e),e.isCompressedTexture){const d=e.mipmaps,f=t.image;for(let p=0;p<d.length;p++){const m=d[p];e.isCompressedArrayTexture?e.format!==n.RGBA?l!==null?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,p,0,0,0,m.width,m.height,f.depth,l,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,p,0,0,0,m.width,m.height,f.depth,l,u,m.data):l!==null?n.compressedTexSubImage2D(n.TEXTURE_2D,p,0,0,m.width,m.height,l,m.data):console.warn("Unsupported compressed texture format")}}else if(e.isCubeTexture){const d=t.images;for(let f=0;f<6;f++){const p=h(d[f]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,0,0,i,a,l,u,p)}}else if(e.isDataArrayTexture){const d=t.image;n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,d.width,d.height,d.depth,l,u,d.data)}else if(e.isData3DTexture){const d=t.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,d.width,d.height,d.depth,l,u,d.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(o,0,c,l,u,t.image);else{const d=h(t.image);n.texSubImage2D(o,0,0,0,i,a,l,u,d)}}generateMipmaps(e){const{gl:t,backend:n}=this,{textureGPU:i,glTextureType:a}=n.get(e);n.state.bindTexture(a,i),t.generateMipmap(a)}deallocateRenderBuffers(e){const{gl:t,backend:n}=this;if(e){const i=n.get(e);if(i.renderBufferStorageSetup=void 0,i.framebuffers){for(const a in i.framebuffers)t.deleteFramebuffer(i.framebuffers[a]);delete i.framebuffers}if(i.depthRenderbuffer&&(t.deleteRenderbuffer(i.depthRenderbuffer),delete i.depthRenderbuffer),i.stencilRenderbuffer&&(t.deleteRenderbuffer(i.stencilRenderbuffer),delete i.stencilRenderbuffer),i.msaaFrameBuffer&&(t.deleteFramebuffer(i.msaaFrameBuffer),delete i.msaaFrameBuffer),i.msaaRenderbuffers){for(let a=0;a<i.msaaRenderbuffers.length;a++)t.deleteRenderbuffer(i.msaaRenderbuffers[a]);delete i.msaaRenderbuffers}}}destroyTexture(e){const{gl:t,backend:n}=this,{textureGPU:i,renderTarget:a}=n.get(e);this.deallocateRenderBuffers(a),t.deleteTexture(i),n.delete(e)}copyTextureToTexture(e,t,n=null,i=null,a=0,s=0){const{gl:o,backend:l}=this,{state:u}=this.backend,{textureGPU:c,glTextureType:h,glType:d,glFormat:f}=l.get(t);u.bindTexture(h,c);let p,m,v,g,y,_,x,E,T;const b=e.isCompressedTexture?e.mipmaps[s]:e.image;if(n!==null)p=n.max.x-n.min.x,m=n.max.y-n.min.y,v=n.isBox3?n.max.z-n.min.z:1,g=n.min.x,y=n.min.y,_=n.isBox3?n.min.z:0;else{const M=Math.pow(2,-a);p=Math.floor(b.width*M),m=Math.floor(b.height*M),e.isDataArrayTexture?v=b.depth:e.isData3DTexture?v=Math.floor(b.depth*M):v=1,g=0,y=0,_=0}i!==null?(x=i.x,E=i.y,T=i.z):(x=0,E=0,T=0),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,t.unpackAlignment);const w=o.getParameter(o.UNPACK_ROW_LENGTH),A=o.getParameter(o.UNPACK_IMAGE_HEIGHT),S=o.getParameter(o.UNPACK_SKIP_PIXELS),C=o.getParameter(o.UNPACK_SKIP_ROWS),R=o.getParameter(o.UNPACK_SKIP_IMAGES);o.pixelStorei(o.UNPACK_ROW_LENGTH,b.width),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,b.height),o.pixelStorei(o.UNPACK_SKIP_PIXELS,g),o.pixelStorei(o.UNPACK_SKIP_ROWS,y),o.pixelStorei(o.UNPACK_SKIP_IMAGES,_);const P=t.isDataArrayTexture||t.isData3DTexture;if(e.isRenderTargetTexture||e.isDepthTexture){const M=l.get(e),N=l.get(t),D=l.get(M.renderTarget),I=l.get(N.renderTarget),L=D.framebuffers[M.cacheKey],z=I.framebuffers[N.cacheKey];u.bindFramebuffer(o.READ_FRAMEBUFFER,L),u.bindFramebuffer(o.DRAW_FRAMEBUFFER,z);let B=o.COLOR_BUFFER_BIT;e.isDepthTexture&&(B=o.DEPTH_BUFFER_BIT),o.blitFramebuffer(g,y,p,m,x,E,p,m,B,o.NEAREST),u.bindFramebuffer(o.READ_FRAMEBUFFER,null),u.bindFramebuffer(o.DRAW_FRAMEBUFFER,null)}else P?e.isDataTexture||e.isData3DTexture?o.texSubImage3D(h,s,x,E,T,p,m,v,f,d,b.data):t.isCompressedArrayTexture?o.compressedTexSubImage3D(h,s,x,E,T,p,m,v,f,b.data):o.texSubImage3D(h,s,x,E,T,p,m,v,f,d,b):e.isDataTexture?o.texSubImage2D(h,s,x,E,p,m,f,d,b.data):e.isCompressedTexture?o.compressedTexSubImage2D(h,s,x,E,b.width,b.height,f,b.data):o.texSubImage2D(h,s,x,E,p,m,f,d,b);o.pixelStorei(o.UNPACK_ROW_LENGTH,w),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,A),o.pixelStorei(o.UNPACK_SKIP_PIXELS,S),o.pixelStorei(o.UNPACK_SKIP_ROWS,C),o.pixelStorei(o.UNPACK_SKIP_IMAGES,R),s===0&&t.generateMipmaps&&o.generateMipmap(h),u.unbindTexture()}copyFramebufferToTexture(e,t,n){const{gl:i}=this,{state:a}=this.backend,{textureGPU:s}=this.backend.get(e),{x:o,y:l,z:u,w:c}=n,h=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,d=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(h){const f=o!==0||l!==0;let p,m;if(e.isDepthTexture===!0?(p=i.DEPTH_BUFFER_BIT,m=i.DEPTH_ATTACHMENT,t.stencil&&(p|=i.STENCIL_BUFFER_BIT)):(p=i.COLOR_BUFFER_BIT,m=i.COLOR_ATTACHMENT0),f){const v=this.backend.get(t.renderTarget),g=v.framebuffers[t.getCacheKey()],y=v.msaaFrameBuffer;a.bindFramebuffer(i.DRAW_FRAMEBUFFER,g),a.bindFramebuffer(i.READ_FRAMEBUFFER,y);const _=d-l-c;i.blitFramebuffer(o,_,o+u,_+c,o,_,o+u,_+c,p,i.NEAREST),a.bindFramebuffer(i.READ_FRAMEBUFFER,g),a.bindTexture(i.TEXTURE_2D,s),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,o,_,u,c),a.unbindTexture()}else{const v=i.createFramebuffer();a.bindFramebuffer(i.DRAW_FRAMEBUFFER,v),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,m,i.TEXTURE_2D,s,0),i.blitFramebuffer(0,0,u,c,0,0,u,c,p,i.NEAREST),i.deleteFramebuffer(v)}}else a.bindTexture(i.TEXTURE_2D,s),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,o,d-c-l,u,c),a.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,n,i=!1){const{gl:a}=this,s=t.renderTarget,{depthTexture:o,depthBuffer:l,stencilBuffer:u,width:c,height:h}=s;if(a.bindRenderbuffer(a.RENDERBUFFER,e),l&&!u){let d=a.DEPTH_COMPONENT24;i===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(a.RENDERBUFFER,s.samples,d,c,h):n>0?(o&&o.isDepthTexture&&o.type===a.FLOAT&&(d=a.DEPTH_COMPONENT32F),a.renderbufferStorageMultisample(a.RENDERBUFFER,n,d,c,h)):a.renderbufferStorage(a.RENDERBUFFER,d,c,h),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,e)}else l&&u&&(n>0?a.renderbufferStorageMultisample(a.RENDERBUFFER,n,a.DEPTH24_STENCIL8,c,h):a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,c,h),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,e))}async copyTextureToBuffer(e,t,n,i,a,s){const{backend:o,gl:l}=this,{textureGPU:u,glFormat:c,glType:h}=this.backend.get(e),d=l.createFramebuffer();l.bindFramebuffer(l.READ_FRAMEBUFFER,d);const f=e.isCubeTexture?l.TEXTURE_CUBE_MAP_POSITIVE_X+s:l.TEXTURE_2D;l.framebufferTexture2D(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,f,u,0);const p=this._getTypedArrayType(h),m=this._getBytesPerTexel(h,c),g=i*a*m,y=l.createBuffer();l.bindBuffer(l.PIXEL_PACK_BUFFER,y),l.bufferData(l.PIXEL_PACK_BUFFER,g,l.STREAM_READ),l.readPixels(t,n,i,a,c,h,0),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),await o.utils._clientWaitAsync();const _=new p(g/p.BYTES_PER_ELEMENT);return l.bindBuffer(l.PIXEL_PACK_BUFFER,y),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,_),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),l.deleteFramebuffer(d),_}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:n}=this;let i=0;if(e===n.UNSIGNED_BYTE&&(i=1),(e===n.UNSIGNED_SHORT_4_4_4_4||e===n.UNSIGNED_SHORT_5_5_5_1||e===n.UNSIGNED_SHORT_5_6_5||e===n.UNSIGNED_SHORT||e===n.HALF_FLOAT)&&(i=2),(e===n.UNSIGNED_INT||e===n.FLOAT)&&(i=4),t===n.RGBA)return i*4;if(t===n.RGB)return i*3;if(t===n.ALPHA)return i}}class hge{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class fge{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const n=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const JB={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query"};class dge{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:n,mode:i,object:a,type:s,info:o,index:l}=this;l!==0?n.drawElements(i,t,s,e):n.drawArrays(i,e,t),o.update(a,t,1)}renderInstances(e,t,n){const{gl:i,mode:a,type:s,index:o,object:l,info:u}=this;n!==0&&(o!==0?i.drawElementsInstanced(a,t,s,e,n):i.drawArraysInstanced(a,e,t,n),u.update(l,t,n))}renderMultiDraw(e,t,n){const{extensions:i,mode:a,object:s,info:o}=this;if(n===0)return;const l=i.get("WEBGL_multi_draw");if(l===null)for(let u=0;u<n;u++)this.render(e[u],t[u]);else{this.index!==0?l.multiDrawElementsWEBGL(a,t,0,this.type,e,0,n):l.multiDrawArraysWEBGL(a,e,0,t,0,n);let u=0;for(let c=0;c<n;c++)u+=t[c];o.update(s,u,1)}}renderMultiDrawInstances(e,t,n,i){const{extensions:a,mode:s,object:o,info:l}=this;if(n===0)return;const u=a.get("WEBGL_multi_draw");if(u===null)for(let c=0;c<n;c++)this.renderInstances(e[c],t[c],i[c]);else{this.index!==0?u.multiDrawElementsInstancedWEBGL(s,t,0,this.type,e,0,i,0,n):u.multiDrawArraysInstancedWEBGL(s,e,0,t,0,i,0,n);let c=0;for(let h=0;h<n;h++)c+=t[h]*i[h];l.update(o,c,1)}}}class r5{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.pendingResolve=!1}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class pge extends r5{constructor(e,t,n=2048){if(super(n),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){console.warn("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let i=0;i<this.maxQueries;i++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return Ia(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e.id,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(t==null||this.activeQuery!==null)return;const n=this.queries[t];if(!!n)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,n),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(i){console.error("Error in beginQuery:",i),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(n){console.error("Error in endQuery:",n),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=[];for(const[i,a]of this.queryStates)if(a==="ended"){const s=this.queries[i];e.push(this.resolveQuery(s))}if(e.length===0)return this.lastValue;const n=(await Promise.all(e)).reduce((i,a)=>i+a,0);return this.lastValue=n,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,n}catch(e){return console.error("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let n,i=!1;const a=()=>{n&&(clearTimeout(n),n=null)},s=l=>{i||(i=!0,a(),t(l))},o=()=>{if(this.isDisposed){s(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){s(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){n=setTimeout(o,1);return}const c=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(c)/1e6)}catch(l){console.error("Error checking query:",l),t(this.lastValue)}};o()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class eU extends n5{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,n={antialias:e.samples>0,alpha:!0,depth:e.depth,stencil:e.stencil},i=t.context!==void 0?t.context:e.domElement.getContext("webgl2",n);function a(s){s.preventDefault();const o={api:"WebGL",message:s.statusMessage||"Unknown reason",reason:null,originalEvent:s};e.onDeviceLost(o)}this._onContextLost=a,e.domElement.addEventListener("webglcontextlost",a,!1),this.gl=i,this.extensions=new hge(this),this.capabilities=new fge(this),this.attributeUtils=new oge(this),this.textureUtils=new cge(this),this.bufferRenderer=new dge(this),this.state=new lge(this),this.utils=new uge(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return di}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async waitForGPU(){await this.utils._clientWaitAsync()}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,n=null){const i=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:i.RGBA8}),n!==null){const a=e.stencilBuffer?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:n,glInternalFormat:a}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e.autoAllocateDepthBuffer&&console.warn("THREE.WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e.autoAllocateDepthBuffer=!1}}initTimestampQuery(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t]||(this.timestampQueryPool[t]=new pge(this.gl,t,2048));const n=this.timestampQueryPool[t];n.allocateQueriesForContext(e)!==null&&n.beginQuery(e)}prepareTimestampBuffer(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t].endQuery(e)}getContext(){return this.gl}beginRender(e){const{state:t,gl:n}=this,i=this.get(e);if(e.viewport?this.updateViewport(e):t.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),e.scissor){const{x:s,y:o,width:l,height:u}=e.scissorValue;t.scissor(s,e.height-u-o,l,u)}this.initTimestampQuery(e),i.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const a=e.occlusionQueryCount;a>0&&(i.currentOcclusionQueries=i.occlusionQueries,i.currentOcclusionQueryObjects=i.occlusionQueryObjects,i.lastOcclusionObject=null,i.occlusionQueries=new Array(a),i.occlusionQueryObjects=new Array(a),i.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:n}=this,i=this.get(e),a=i.previousContext;n.resetVertexState();const s=e.occlusionQueryCount;s>0&&(s>i.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const o=e.textures;if(o!==null)for(let l=0;l<o.length;l++){const u=o[l];u.generateMipmaps&&this.generateMipmaps(u)}if(this._currentContext=a,e.textures!==null&&e.renderTarget){const l=this.get(e.renderTarget),{samples:u}=e.renderTarget;if(u>0&&this._useMultisampledRTT(e.renderTarget)===!1){const c=l.framebuffers[e.getCacheKey()],h=t.COLOR_BUFFER_BIT,d=l.msaaFrameBuffer,f=e.textures;n.bindFramebuffer(t.READ_FRAMEBUFFER,d),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,c);for(let p=0;p<f.length;p++)if(e.scissor){const{x:m,y:v,width:g,height:y}=e.scissorValue,_=e.height-y-v;t.blitFramebuffer(m,_,m+g,_+y,m,_,m+g,_+y,h,t.NEAREST),this._supportsInvalidateFramebuffer===!0&&t.invalidateSubFramebuffer(t.READ_FRAMEBUFFER,l.invalidationArray,m,_,g,y)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,h,t.NEAREST),this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,l.invalidationArray)}}a!==null&&(this._setFramebuffer(a),a.viewport?this.updateViewport(a):n.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight)),this.prepareTimestampBuffer(e)}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:i}=t;if(n&&i){const a=new WeakSet,{gl:s}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const o=()=>{let l=0;for(let u=0;u<n.length;u++){const c=n[u];c!==null&&s.getQueryParameter(c,s.QUERY_RESULT_AVAILABLE)&&(s.getQueryParameter(c,s.QUERY_RESULT)===0&&a.add(i[u]),n[u]=null,s.deleteQuery(c),l++)}l<n.length?requestAnimationFrame(o):t.occluded=a};o()}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:n,y:i,width:a,height:s}=e.viewportValue;t.viewport(n,e.height-s-i,a,s)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,n,i=null,a=!0){const{gl:s,renderer:o}=this;i===null&&(i={textures:null,clearColorValue:this.getClearColor()});let l=0;if(e&&(l|=s.COLOR_BUFFER_BIT),t&&(l|=s.DEPTH_BUFFER_BIT),n&&(l|=s.STENCIL_BUFFER_BIT),l!==0){let u;i.clearColorValue?u=i.clearColorValue:u=this.getClearColor();const c=o.getClearDepth(),h=o.getClearStencil();if(t&&this.state.setDepthMask(!0),i.textures===null)s.clearColor(u.r,u.g,u.b,u.a),s.clear(l);else{if(a&&this._setFramebuffer(i),e)for(let d=0;d<i.textures.length;d++)d===0?s.clearBufferfv(s.COLOR,d,[u.r,u.g,u.b,u.a]):s.clearBufferfv(s.COLOR,d,[0,0,0,1]);t&&n?s.clearBufferfi(s.DEPTH_STENCIL,0,c,h):t?s.clearBufferfv(s.DEPTH,0,[c]):n&&s.clearBufferiv(s.STENCIL,0,[h])}}}beginCompute(e){const{state:t,gl:n}=this;t.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(e)}compute(e,t,n,i){const{state:a,gl:s}=this;this.discard===!1&&(s.enable(s.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:o,transformBuffers:l,attributes:u}=this.get(i),c=this._getVaoKey(u),h=this.vaoCache[c];h===void 0?this._createVao(u):a.setVertexState(h),a.useProgram(o),this._bindUniforms(n);const d=this._getTransformFeedback(l);s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,d),s.beginTransformFeedback(s.POINTS),u[0].isStorageInstancedBufferAttribute?s.drawArraysInstanced(s.POINTS,0,1,t.count):s.drawArrays(s.POINTS,0,t.count),s.endTransformFeedback(),s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,null);for(let f=0;f<l.length;f++){const p=l[f];p.pbo&&this.textureUtils.copyBufferToTexture(p.transformBuffer,p.pbo),p.switchBuffers()}}finishCompute(e){const t=this.gl;this.discard=!1,t.disable(t.RASTERIZER_DISCARD),this.prepareTimestampBuffer(e),this._currentContext&&this._setFramebuffer(this._currentContext)}draw(e){const{object:t,pipeline:n,material:i,context:a,hardwareClippingPlanes:s}=e,{programGPU:o}=this.get(n),{gl:l,state:u}=this,c=this.get(a),h=e.getDrawParameters();if(h===null)return;this._bindUniforms(e.getBindings());const d=t.isMesh&&t.matrixWorld.determinant()<0;u.setMaterial(i,d,s),u.useProgram(o);const f=this.get(e);let p=f.staticVao;if(p===void 0||f.geometryId!==e.geometry.id){const b=this._getVaoKey(e.getAttributes());if(p=this.vaoCache[b],p===void 0){let w;({vaoGPU:p,staticVao:w}=this._createVao(e.getAttributes())),w&&(f.staticVao=p,f.geometryId=e.geometry.id)}}const m=e.getIndex(),v=m!==null?this.get(m).bufferGPU:null;u.setVertexState(p,v);const g=c.lastOcclusionObject;if(g!==t&&g!==void 0){if(g!==null&&g.occlusionTest===!0&&(l.endQuery(l.ANY_SAMPLES_PASSED),c.occlusionQueryIndex++),t.occlusionTest===!0){const b=l.createQuery();l.beginQuery(l.ANY_SAMPLES_PASSED,b),c.occlusionQueries[c.occlusionQueryIndex]=b,c.occlusionQueryObjects[c.occlusionQueryIndex]=t}c.lastOcclusionObject=t}const y=this.bufferRenderer;t.isPoints?y.mode=l.POINTS:t.isLineSegments?y.mode=l.LINES:t.isLine?y.mode=l.LINE_STRIP:t.isLineLoop?y.mode=l.LINE_LOOP:i.wireframe===!0?(u.setLineWidth(i.wireframeLinewidth*this.renderer.getPixelRatio()),y.mode=l.LINES):y.mode=l.TRIANGLES;const{vertexCount:_,instanceCount:x}=h;let{firstVertex:E}=h;if(y.object=t,m!==null){E*=m.array.BYTES_PER_ELEMENT;const b=this.get(m);y.index=m.count,y.type=b.type}else y.index=0;const T=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(Ia("THREE.WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),y.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?y.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):Ia("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):x>1?y.renderInstances(E,_,x):y.render(E,_)};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const b=this.get(e.camera),w=e.camera.cameras,A=e.getBindingGroup("cameraIndex").bindings[0];if(b.indexesGPU===void 0||b.indexesGPU.length!==w.length){const R=new Uint32Array([0,0,0,0]),P=[];for(let M=0,N=w.length;M<N;M++){const D=l.createBuffer();R[0]=M,l.bindBuffer(l.UNIFORM_BUFFER,D),l.bufferData(l.UNIFORM_BUFFER,R,l.STATIC_DRAW),P.push(D)}b.indexesGPU=P}const S=this.get(A),C=this.renderer.getPixelRatio();for(let R=0,P=w.length;R<P;R++){const M=w[R];if(t.layers.test(M.layers)){const N=M.viewport,D=N.x*C,I=N.y*C,L=N.width*C,z=N.height*C;u.viewport(Math.floor(D),Math.floor(e.context.height-z-I),Math.floor(L),Math.floor(z)),u.bindBufferBase(l.UNIFORM_BUFFER,S.index,b.indexesGPU[R]),T()}}}else T()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,n,i,a,s){return this.textureUtils.copyTextureToBuffer(e,t,n,i,a,s)}createSampler(){}destroySampler(){}createNodeBuilder(e,t){return new ige(e,t)}createProgram(e){const t=this.gl,{stage:n,code:i}=e,a=n==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(a,i),t.compileShader(a),this.set(e,{shaderGPU:a})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const n=this.gl,i=e.pipeline,{fragmentProgram:a,vertexProgram:s}=i,o=n.createProgram(),l=this.get(a).shaderGPU,u=this.get(s).shaderGPU;if(n.attachShader(o,l),n.attachShader(o,u),n.linkProgram(o),this.set(i,{programGPU:o,fragmentShader:l,vertexShader:u}),t!==null&&this.parallel){const c=new Promise(h=>{const d=this.parallel,f=()=>{n.getProgramParameter(o,d.COMPLETION_STATUS_KHR)?(this._completeCompile(e,i),h()):requestAnimationFrame(f)};f()});t.push(c);return}this._completeCompile(e,i)}_handleSource(e,t){const n=e.split(`
`),i=[],a=Math.max(t-6,0),s=Math.min(t+6,n.length);for(let o=a;o<s;o++){const l=o+1;i.push(`${l===t?">":" "} ${l}: ${n[o]}`)}return i.join(`
`)}_getShaderErrors(e,t,n){const i=e.getShaderParameter(t,e.COMPILE_STATUS),a=e.getShaderInfoLog(t).trim();if(i&&a==="")return"";const s=/ERROR: 0:(\d+)/.exec(a);if(s){const o=parseInt(s[1]);return n.toUpperCase()+`

`+a+`

`+this._handleSource(e.getShaderSource(t),o)}else return a}_logProgramError(e,t,n){if(this.renderer.debug.checkShaderErrors){const i=this.gl,a=i.getProgramInfoLog(e).trim();if(i.getProgramParameter(e,i.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(i,e,n,t);else{const s=this._getShaderErrors(i,n,"vertex"),o=this._getShaderErrors(i,t,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(e,i.VALIDATE_STATUS)+`

Program Info Log: `+a+`
`+s+`
`+o)}else a!==""&&console.warn("THREE.WebGLProgram: Program Info Log:",a)}}_completeCompile(e,t){const{state:n,gl:i}=this,a=this.get(t),{programGPU:s,fragmentShader:o,vertexShader:l}=a;i.getProgramParameter(s,i.LINK_STATUS)===!1&&this._logProgramError(s,o,l),n.useProgram(s);const u=e.getBindings();this._setupBindings(u,s),this.set(t,{programGPU:s})}createComputePipeline(e,t){const{state:n,gl:i}=this,a={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(a);const{computeProgram:s}=e,o=i.createProgram(),l=this.get(a).shaderGPU,u=this.get(s).shaderGPU,c=s.transforms,h=[],d=[];for(let v=0;v<c.length;v++){const g=c[v];h.push(g.varyingName),d.push(g.attributeNode)}i.attachShader(o,l),i.attachShader(o,u),i.transformFeedbackVaryings(o,h,i.SEPARATE_ATTRIBS),i.linkProgram(o),i.getProgramParameter(o,i.LINK_STATUS)===!1&&this._logProgramError(o,l,u),n.useProgram(o),this._setupBindings(t,o);const f=s.attributes,p=[],m=[];for(let v=0;v<f.length;v++){const g=f[v].node.attribute;p.push(g),this.has(g)||this.attributeUtils.createAttribute(g,i.ARRAY_BUFFER)}for(let v=0;v<d.length;v++){const g=d[v].attribute;this.has(g)||this.attributeUtils.createAttribute(g,i.ARRAY_BUFFER);const y=this.get(g);m.push(y)}this.set(e,{programGPU:o,transformBuffers:m,attributes:p})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let n=0,i=0;for(const a of t){this.set(a,{textures:i,uniformBuffers:n});for(const s of a.bindings)s.isUniformBuffer&&n++,s.isSampledTexture&&i++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,n=this.get(e);let i=n.uniformBuffers,a=n.textures;for(const s of e.bindings)if(s.isUniformsGroup||s.isUniformBuffer){const o=s.buffer,l=t.createBuffer();t.bindBuffer(t.UNIFORM_BUFFER,l),t.bufferData(t.UNIFORM_BUFFER,o,t.DYNAMIC_DRAW),this.set(s,{index:i++,bufferGPU:l})}else if(s.isSampledTexture){const{textureGPU:o,glTextureType:l}=this.get(s.texture);this.set(s,{index:a++,textureGPU:o,glTextureType:l})}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const i=this.get(e).bufferGPU,a=e.buffer;t.bindBuffer(t.UNIFORM_BUFFER,i),t.bufferData(t.UNIFORM_BUFFER,a,t.DYNAMIC_DRAW)}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(JB).filter(i=>JB[i]===e),n=this.extensions;for(let i=0;i<t.length;i++)if(n.has(t[i]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,n=null,i=null,a=0,s=0){this.textureUtils.copyTextureToTexture(e,t,n,i,a,s)}copyFramebufferToTexture(e,t,n){this.textureUtils.copyFramebufferToTexture(e,t,n)}_setFramebuffer(e){const{gl:t,state:n}=this;let i=null;if(e.textures!==null){const a=e.renderTarget,s=this.get(a),{samples:o,depthBuffer:l,stencilBuffer:u}=a,c=a.isWebGLCubeRenderTarget===!0,h=a.isRenderTarget3D===!0,d=a.isRenderTargetArray===!0,f=a.isXRRenderTarget===!0,p=f===!0&&a.hasExternalTextures===!0;let m=s.msaaFrameBuffer,v=s.depthRenderbuffer;const g=this.extensions.get("WEBGL_multisampled_render_to_texture"),y=this._useMultisampledRTT(a),_=I4(e);let x;if(c?(s.cubeFramebuffers||(s.cubeFramebuffers={}),x=s.cubeFramebuffers[_]):f&&p===!1?x=this._xrFramebuffer:(s.framebuffers||(s.framebuffers={}),x=s.framebuffers[_]),x===void 0){x=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,x);const E=e.textures;if(c){s.cubeFramebuffers[_]=x;const{textureGPU:T}=this.get(E[0]),b=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+b,T,0)}else{s.framebuffers[_]=x;for(let T=0;T<E.length;T++){const b=E[T],w=this.get(b);w.renderTarget=e.renderTarget,w.cacheKey=_;const A=t.COLOR_ATTACHMENT0+T;if(h||d){const S=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,A,w.textureGPU,0,S)}else p&&y?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,A,t.TEXTURE_2D,w.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,A,t.TEXTURE_2D,w.textureGPU,0)}n.drawBuffers(e,x)}if(a.isXRRenderTarget&&a.autoAllocateDepthBuffer===!0){const T=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(T,e,0,y),s.xrDepthRenderbuffer=T}else if(e.depthTexture!==null){const T=this.get(e.depthTexture),b=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;T.renderTarget=e.renderTarget,T.cacheKey=_,p&&y?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,b,t.TEXTURE_2D,T.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,b,t.TEXTURE_2D,T.textureGPU,0)}}else if(f&&p){n.bindFramebuffer(t.FRAMEBUFFER,x);const E=this.get(e.textures[0]);y?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,E.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,E.textureGPU,0);const T=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(a.autoAllocateDepthBuffer===!0){const b=s.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,b),t.framebufferRenderbuffer(t.FRAMEBUFFER,T,t.RENDERBUFFER,b)}else{const b=this.get(e.depthTexture);y?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,T,t.TEXTURE_2D,b.textureGPU,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,T,t.TEXTURE_2D,b.textureGPU,0)}}if(o>0&&y===!1){if(m===void 0){const E=[];m=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,m);const T=[],b=e.textures;for(let w=0;w<b.length;w++){if(T[w]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,T[w]),E.push(t.COLOR_ATTACHMENT0+w),l){const C=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;E.push(C)}const A=e.textures[w],S=this.get(A);t.renderbufferStorageMultisample(t.RENDERBUFFER,o,S.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+w,t.RENDERBUFFER,T[w])}if(s.msaaFrameBuffer=m,s.msaaRenderbuffers=T,v===void 0){v=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(v,e,o),s.depthRenderbuffer=v;const w=u?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;E.push(w)}s.invalidationArray=E}i=s.msaaFrameBuffer}else i=x}n.bindFramebuffer(t.FRAMEBUFFER,i)}_getVaoKey(e){let t="";for(let n=0;n<e.length;n++){const i=this.get(e[n]);t+=":"+i.id}return t}_createVao(e){const{gl:t}=this,n=t.createVertexArray();let i="",a=!0;t.bindVertexArray(n);for(let s=0;s<e.length;s++){const o=e[s],l=this.get(o);i+=":"+l.id,t.bindBuffer(t.ARRAY_BUFFER,l.bufferGPU),t.enableVertexAttribArray(s),(o.isStorageBufferAttribute||o.isStorageInstancedBufferAttribute)&&(a=!1);let u,c;o.isInterleavedBufferAttribute===!0?(u=o.data.stride*l.bytesPerElement,c=o.offset*l.bytesPerElement):(u=0,c=0),l.isInteger?t.vertexAttribIPointer(s,o.itemSize,l.type,u,c):t.vertexAttribPointer(s,o.itemSize,l.type,o.normalized,u,c),o.isInstancedBufferAttribute&&!o.isInterleavedBufferAttribute?t.vertexAttribDivisor(s,o.meshPerAttribute):o.isInterleavedBufferAttribute&&o.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(s,o.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),this.vaoCache[i]=n,{vaoGPU:n,staticVao:a}}_getTransformFeedback(e){let t="";for(let a=0;a<e.length;a++)t+=":"+e[a].id;let n=this.transformFeedbackCache[t];if(n!==void 0)return n;const{gl:i}=this;n=i.createTransformFeedback(),i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,n);for(let a=0;a<e.length;a++){const s=e[a];i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,a,s.transformBuffer)}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=n,n}_setupBindings(e,t){const n=this.gl;for(const i of e)for(const a of i.bindings){const o=this.get(a).index;if(a.isUniformsGroup||a.isUniformBuffer){const l=n.getUniformBlockIndex(t,a.name);n.uniformBlockBinding(t,l,o)}else if(a.isSampledTexture){const l=n.getUniformLocation(t,a.name);n.uniform1i(l,o)}}}_bindUniforms(e){const{gl:t,state:n}=this;for(const i of e)for(const a of i.bindings){const s=this.get(a),o=s.index;a.isUniformsGroup||a.isUniformBuffer?n.bindBufferBase(t.UNIFORM_BUFFER,o,s.bufferGPU):a.isSampledTexture&&n.bindTexture(s.glTextureType,s.textureGPU,t.TEXTURE0+o)}}_useMultisampledRTT(e){return e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e.autoAllocateDepthBuffer!==!1}dispose(){const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const ac={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},wr={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},pr={Store:"store"},vn={Load:"load",Clear:"clear"},iw={CCW:"ccw"},aw={None:"none",Front:"front",Back:"back"},Xc={Uint16:"uint16",Uint32:"uint32"},de={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},sw={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},Dl={Linear:"linear",Nearest:"nearest"},Tt={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDstColor:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},ml={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},tU={None:0,All:15},_o={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},ow={Storage:"storage",ReadOnlyStorage:"read-only-storage"},lw={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},Vu={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},nU={TwoD:"2d",ThreeD:"3d"},oi={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},gge={All:"all"},Zp={Vertex:"vertex",Instance:"instance"},gS={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"};class vge extends WM{constructor(e,t){super(e),this.texture=t,this.version=t?t.version:0,this.isSampler=!0}}class mge extends vge{constructor(e,t,n){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n}update(){this.texture=this.textureNode.value}}class yge extends K4{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let _ge=0;class xge extends yge{constructor(e,t){super("StorageBuffer_"+_ge++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:ks.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class bge extends nl{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,n=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,i=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:Dl.Linear}),this.flipYSampler=e.createSampler({minFilter:Dl.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:n}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:i})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:ac.TriangleStrip,stripIndexFormat:Xc.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:ac.TriangleStrip,stripIndexFormat:Xc.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,n=0){const i=t.format,{width:a,height:s}=t.size,o=this.getTransferPipeline(i),l=this.getFlipYPipeline(i),u=this.device.createTexture({size:{width:a,height:s,depthOrArrayLayers:1},format:i,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),c=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:oi.TwoD,baseArrayLayer:n}),h=u.createView({baseMipLevel:0,mipLevelCount:1,dimension:oi.TwoD,baseArrayLayer:0}),d=this.device.createCommandEncoder({}),f=(p,m,v)=>{const g=p.getBindGroupLayout(0),y=this.device.createBindGroup({layout:g,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:m}]}),_=d.beginRenderPass({colorAttachments:[{view:v,loadOp:vn.Clear,storeOp:pr.Store,clearValue:[0,0,0,0]}]});_.setPipeline(p),_.setBindGroup(0,y),_.draw(4,1,0,0),_.end()};f(o,c,h),f(l,h,c),this.device.queue.submit([d.finish()]),u.destroy()}generateMipmaps(e,t,n=0){const i=this.get(e);i.useCount===void 0&&(i.useCount=0,i.layers=[]);const a=i.layers[n]||this._mipmapCreateBundles(e,t,n),s=this.device.createCommandEncoder({});this._mipmapRunBundles(s,a),this.device.queue.submit([s.finish()]),i.useCount!==0&&(i.layers[n]=a),i.useCount++}_mipmapCreateBundles(e,t,n){const i=this.getTransferPipeline(t.format),a=i.getBindGroupLayout(0);let s=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:oi.TwoD,baseArrayLayer:n});const o=[];for(let l=1;l<t.mipLevelCount;l++){const u=this.device.createBindGroup({layout:a,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:s}]}),c=e.createView({baseMipLevel:l,mipLevelCount:1,dimension:oi.TwoD,baseArrayLayer:n}),h={colorAttachments:[{view:c,loadOp:vn.Clear,storeOp:pr.Store,clearValue:[0,0,0,0]}]},d=this.device.createRenderBundleEncoder({colorFormats:[t.format]});d.setPipeline(i),d.setBindGroup(0,u),d.draw(4,1,0,0),o.push({renderBundles:[d.finish()],passDescriptor:h}),s=c}return o}_mipmapRunBundles(e,t){const n=t.length;for(let i=0;i<n;i++){const a=t[i],s=e.beginRenderPass(a.passDescriptor);s.executeBundles(a.renderBundles),s.end()}}}const Ege={[UA]:"never",[sm]:"less",[kA]:"equal",[om]:"less-equal",[GA]:"greater",[VA]:"greater-equal",[HA]:"always",[zA]:"not-equal"},Tge=[0,1,3,2,4,5];class wge{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new sa,this.depthTexture.name="depthBuffer"}createSampler(e){const t=this.backend,n=t.device,i=t.get(e),a={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};a.magFilter===Dl.Linear&&a.minFilter===Dl.Linear&&a.mipmapFilter===Dl.Linear&&(a.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(a.compare=Ege[e.compareFunction]),i.sampler=n.createSampler(a)}createDefaultTexture(e){let t;const n=vS(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(n):e.isVideoTexture?this.backend.get(e).externalTexture=this._getDefaultVideoFrame():t=this._getDefaultTextureGPU(n),this.backend.get(e).texture=t}createTexture(e,t={}){const n=this.backend,i=n.get(e);if(i.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:a,height:s,depth:o,levels:l}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const u=this._getDimension(e),c=e.internalFormat||t.format||vS(e,n.device);i.format=c;const{samples:h,primarySamples:d,isMSAA:f}=n.utils.getTextureSampleData(e);let p=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(p|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&(p|=GPUTextureUsage.RENDER_ATTACHMENT);const m={label:e.name,size:{width:a,height:s,depthOrArrayLayers:o},mipLevelCount:l,sampleCount:d,dimension:u,format:c,usage:p};if(e.isVideoTexture){const v=e.source.data,g=new VideoFrame(v);m.size.width=g.displayWidth,m.size.height=g.displayHeight,g.close(),i.externalTexture=v}else{if(c===void 0){console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}i.texture=n.device.createTexture(m)}if(f){const v=Object.assign({},m);v.label=v.label+"-msaa",v.sampleCount=h,i.msaaTexture=n.device.createTexture(v)}i.initialized=!0,i.textureDescriptorGPU=m}destroyTexture(e){const t=this.backend,n=t.get(e);n.texture!==void 0&&n.texture.destroy(),n.msaaTexture!==void 0&&n.msaaTexture.destroy(),t.delete(e)}destroySampler(e){const n=this.backend.get(e);delete n.sampler}generateMipmaps(e){const t=this.backend.get(e);if(e.isCubeTexture)for(let n=0;n<6;n++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,n);else{const n=e.image.depth||1;for(let i=0;i<n;i++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,i)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const e=this.backend,{width:t,height:n}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:t,height:n,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.samples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(e=!0,t=!1){const n=this.backend,{width:i,height:a}=n.getDrawingBufferSize(),s=this.depthTexture,o=n.get(s).texture;let l,u;if(t?(l=Vi,u=Gi):e&&(l=zi,u=hn),o!==void 0){if(s.image.width===i&&s.image.height===a&&s.format===l&&s.type===u)return o;this.destroyTexture(s)}return s.name="depthBuffer",s.format=l,s.type=u,s.image.width=i,s.image.height=a,this.createTexture(s,{width:i,height:a}),n.get(s).texture}updateTexture(e,t){const n=this.backend.get(e),{textureDescriptorGPU:i}=n;if(!(e.isRenderTargetTexture||i===void 0)){if(e.isDataTexture)this._copyBufferToTexture(t.image,n.texture,i,0,e.flipY);else if(e.isDataArrayTexture||e.isData3DTexture)for(let a=0;a<t.image.depth;a++)this._copyBufferToTexture(t.image,n.texture,i,a,e.flipY,a);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,i);else if(e.isCubeTexture)this._copyCubeMapToTexture(t.images,n.texture,i,e.flipY);else if(e.isVideoTexture){const a=e.source.data;n.externalTexture=a}else this._copyImageToTexture(t.image,n.texture,i,0,e.flipY);n.version=e.version,e.onUpdate&&e.onUpdate(e)}}async copyTextureToBuffer(e,t,n,i,a,s){const o=this.backend.device,l=this.backend.get(e),u=l.texture,c=l.textureDescriptorGPU.format,h=this._getBytesPerTexel(c);let d=i*h;d=Math.ceil(d/256)*256;const f=o.createBuffer({size:i*a*h,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),p=o.createCommandEncoder();p.copyTextureToBuffer({texture:u,origin:{x:t,y:n,z:s}},{buffer:f,bytesPerRow:d},{width:i,height:a});const m=this._getTypedArrayType(c);o.queue.submit([p.finish()]),await f.mapAsync(GPUMapMode.READ);const v=f.getMappedRange();return new m(v)}_isEnvironmentTexture(e){const t=e.mapping;return t===Wo||t===qo||t===la||t===ua}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const n=new ar;n.minFilter=mn,n.magFilter=mn,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const n=new um;n.minFilter=mn,n.magFilter=mn,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultVideoFrame(){let e=this.defaultVideoFrame;if(e===null){const t={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=e=new VideoFrame(new Uint8Array([0,0,0,255]),t)}return e}_copyCubeMapToTexture(e,t,n,i){for(let a=0;a<6;a++){const s=e[a],o=i===!0?Tge[a]:a;s.isDataTexture?this._copyBufferToTexture(s.image,t,n,o,i):this._copyImageToTexture(s,t,n,o,i)}}_copyImageToTexture(e,t,n,i,a){this.backend.device.queue.copyExternalImageToTexture({source:e,flipY:a},{texture:t,mipLevel:0,origin:{x:0,y:0,z:i}},{width:e.width,height:e.height,depthOrArrayLayers:1})}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new bge(this.backend.device)),e}_generateMipmaps(e,t,n=0){this._getPassUtils().generateMipmaps(e,t,n)}_flipY(e,t,n=0){this._getPassUtils().flipY(e,t,n)}_copyBufferToTexture(e,t,n,i,a,s=0){const o=this.backend.device,l=e.data,u=this._getBytesPerTexel(n.format),c=e.width*u;o.queue.writeTexture({texture:t,mipLevel:0,origin:{x:0,y:0,z:i}},l,{offset:e.width*e.height*u*s,bytesPerRow:c},{width:e.width,height:e.height,depthOrArrayLayers:1}),a===!0&&this._flipY(t,n,i)}_copyCompressedBufferToTexture(e,t,n){const i=this.backend.device,a=this._getBlockData(n.format),s=n.size.depthOrArrayLayers>1;for(let o=0;o<e.length;o++){const l=e[o],u=l.width,c=l.height,h=s?n.size.depthOrArrayLayers:1,d=Math.ceil(u/a.width)*a.byteLength,f=d*Math.ceil(c/a.height);for(let p=0;p<h;p++)i.queue.writeTexture({texture:t,mipLevel:o,origin:{x:0,y:0,z:p}},l.data,{offset:p*f,bytesPerRow:d,rowsPerImage:Math.ceil(c/a.height)},{width:Math.ceil(u/a.width)*a.width,height:Math.ceil(c/a.height)*a.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===de.BC1RGBAUnorm||e===de.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===de.BC2RGBAUnorm||e===de.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===de.BC3RGBAUnorm||e===de.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===de.BC4RUnorm||e===de.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===de.BC5RGUnorm||e===de.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===de.BC6HRGBUFloat||e===de.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===de.BC7RGBAUnorm||e===de.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===de.ETC2RGB8Unorm||e===de.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===de.ETC2RGB8A1Unorm||e===de.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===de.ETC2RGBA8Unorm||e===de.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===de.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===de.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===de.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===de.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===de.ASTC4x4Unorm||e===de.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===de.ASTC5x4Unorm||e===de.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===de.ASTC5x5Unorm||e===de.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===de.ASTC6x5Unorm||e===de.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===de.ASTC6x6Unorm||e===de.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===de.ASTC8x5Unorm||e===de.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===de.ASTC8x6Unorm||e===de.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===de.ASTC8x8Unorm||e===de.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===de.ASTC10x5Unorm||e===de.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===de.ASTC10x6Unorm||e===de.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===de.ASTC10x8Unorm||e===de.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===de.ASTC10x10Unorm||e===de.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===de.ASTC12x10Unorm||e===de.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===de.ASTC12x12Unorm||e===de.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=sw.ClampToEdge;return e===jl?t=sw.Repeat:e===Kl&&(t=sw.MirrorRepeat),t}_convertFilterMode(e){let t=Dl.Linear;return(e===mn||e===LA||e===Bs)&&(t=Dl.Nearest),t}_getBytesPerTexel(e){if(e===de.R8Unorm||e===de.R8Snorm||e===de.R8Uint||e===de.R8Sint)return 1;if(e===de.R16Uint||e===de.R16Sint||e===de.R16Float||e===de.RG8Unorm||e===de.RG8Snorm||e===de.RG8Uint||e===de.RG8Sint)return 2;if(e===de.R32Uint||e===de.R32Sint||e===de.R32Float||e===de.RG16Uint||e===de.RG16Sint||e===de.RG16Float||e===de.RGBA8Unorm||e===de.RGBA8UnormSRGB||e===de.RGBA8Snorm||e===de.RGBA8Uint||e===de.RGBA8Sint||e===de.BGRA8Unorm||e===de.BGRA8UnormSRGB||e===de.RGB9E5UFloat||e===de.RGB10A2Unorm||e===de.RG11B10UFloat||e===de.Depth32Float||e===de.Depth24Plus||e===de.Depth24PlusStencil8||e===de.Depth32FloatStencil8)return 4;if(e===de.RG32Uint||e===de.RG32Sint||e===de.RG32Float||e===de.RGBA16Uint||e===de.RGBA16Sint||e===de.RGBA16Float)return 8;if(e===de.RGBA32Uint||e===de.RGBA32Sint||e===de.RGBA32Float)return 16}_getTypedArrayType(e){if(e===de.R8Uint)return Uint8Array;if(e===de.R8Sint)return Int8Array;if(e===de.R8Unorm)return Uint8Array;if(e===de.R8Snorm)return Int8Array;if(e===de.RG8Uint)return Uint8Array;if(e===de.RG8Sint)return Int8Array;if(e===de.RG8Unorm)return Uint8Array;if(e===de.RG8Snorm)return Int8Array;if(e===de.RGBA8Uint)return Uint8Array;if(e===de.RGBA8Sint)return Int8Array;if(e===de.RGBA8Unorm)return Uint8Array;if(e===de.RGBA8Snorm)return Int8Array;if(e===de.R16Uint)return Uint16Array;if(e===de.R16Sint)return Int16Array;if(e===de.RG16Uint)return Uint16Array;if(e===de.RG16Sint)return Int16Array;if(e===de.RGBA16Uint)return Uint16Array;if(e===de.RGBA16Sint)return Int16Array;if(e===de.R16Float||e===de.RG16Float||e===de.RGBA16Float)return Uint16Array;if(e===de.R32Uint)return Uint32Array;if(e===de.R32Sint)return Int32Array;if(e===de.R32Float)return Float32Array;if(e===de.RG32Uint)return Uint32Array;if(e===de.RG32Sint)return Int32Array;if(e===de.RG32Float)return Float32Array;if(e===de.RGBA32Uint)return Uint32Array;if(e===de.RGBA32Sint)return Int32Array;if(e===de.RGBA32Float)return Float32Array;if(e===de.BGRA8Unorm||e===de.BGRA8UnormSRGB)return Uint8Array;if(e===de.RGB10A2Unorm||e===de.RGB9E5UFloat||e===de.RG11B10UFloat)return Uint32Array;if(e===de.Depth32Float)return Float32Array;if(e===de.Depth24Plus||e===de.Depth24PlusStencil8)return Uint32Array;if(e===de.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.isData3DTexture?t=nU.ThreeD:t=nU.TwoD,t}}function vS(r,e=null){const t=r.format,n=r.type,i=r.colorSpace;let a;if(r.isCompressedTexture===!0||r.isCompressedArrayTexture===!0)switch(t){case Po:a=i===ft?de.BC1RGBAUnormSRGB:de.BC1RGBAUnorm;break;case Do:a=i===ft?de.BC2RGBAUnormSRGB:de.BC2RGBAUnorm;break;case Lo:a=i===ft?de.BC3RGBAUnormSRGB:de.BC3RGBAUnorm;break;case Mc:a=i===ft?de.ETC2RGB8UnormSRGB:de.ETC2RGB8Unorm;break;case Cc:a=i===ft?de.ETC2RGBA8UnormSRGB:de.ETC2RGBA8Unorm;break;case Rc:a=i===ft?de.ASTC4x4UnormSRGB:de.ASTC4x4Unorm;break;case Nc:a=i===ft?de.ASTC5x4UnormSRGB:de.ASTC5x4Unorm;break;case Pc:a=i===ft?de.ASTC5x5UnormSRGB:de.ASTC5x5Unorm;break;case Dc:a=i===ft?de.ASTC6x5UnormSRGB:de.ASTC6x5Unorm;break;case Lc:a=i===ft?de.ASTC6x6UnormSRGB:de.ASTC6x6Unorm;break;case Ic:a=i===ft?de.ASTC8x5UnormSRGB:de.ASTC8x5Unorm;break;case Oc:a=i===ft?de.ASTC8x6UnormSRGB:de.ASTC8x6Unorm;break;case Fc:a=i===ft?de.ASTC8x8UnormSRGB:de.ASTC8x8Unorm;break;case Bc:a=i===ft?de.ASTC10x5UnormSRGB:de.ASTC10x5Unorm;break;case Uc:a=i===ft?de.ASTC10x6UnormSRGB:de.ASTC10x6Unorm;break;case kc:a=i===ft?de.ASTC10x8UnormSRGB:de.ASTC10x8Unorm;break;case Gc:a=i===ft?de.ASTC10x10UnormSRGB:de.ASTC10x10Unorm;break;case zc:a=i===ft?de.ASTC12x10UnormSRGB:de.ASTC12x10Unorm;break;case Vc:a=i===ft?de.ASTC12x12UnormSRGB:de.ASTC12x12Unorm;break;case On:a=i===ft?de.RGBA8UnormSRGB:de.RGBA8Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case On:switch(n){case Ol:a=de.RGBA8Snorm;break;case Fl:a=de.RGBA16Sint;break;case Pa:a=de.RGBA16Uint;break;case hn:a=de.RGBA32Uint;break;case mr:a=de.RGBA32Sint;break;case In:a=i===ft?de.RGBA8UnormSRGB:de.RGBA8Unorm;break;case kr:a=de.RGBA16Float;break;case Un:a=de.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",n)}break;case Nd:switch(n){case am:a=de.RGB9E5UFloat;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",n)}break;case Pd:switch(n){case Ol:a=de.R8Snorm;break;case Fl:a=de.R16Sint;break;case Pa:a=de.R16Uint;break;case hn:a=de.R32Uint;break;case mr:a=de.R32Sint;break;case In:a=de.R8Unorm;break;case kr:a=de.R16Float;break;case Un:a=de.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",n)}break;case Ql:switch(n){case Ol:a=de.RG8Snorm;break;case Fl:a=de.RG16Sint;break;case Pa:a=de.RG16Uint;break;case hn:a=de.RG32Uint;break;case mr:a=de.RG32Sint;break;case In:a=de.RG8Unorm;break;case kr:a=de.RG16Float;break;case Un:a=de.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",n)}break;case zi:switch(n){case Pa:a=de.Depth16Unorm;break;case hn:a=de.Depth24Plus;break;case Un:a=de.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",n)}break;case Vi:switch(n){case Gi:a=de.Depth24PlusStencil8;break;case Un:e&&e.features.has(gS.Depth32FloatStencil8)===!1&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),a=de.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",n)}break;case lh:switch(n){case mr:a=de.R32Sint;break;case hn:a=de.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",n)}break;case uh:switch(n){case mr:a=de.RG32Sint;break;case hn:a=de.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",n)}break;case ch:switch(n){case mr:a=de.RGBA32Sint;break;case hn:a=de.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",n)}break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}return a}const Sge=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,Age=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,rU={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},Mge=r=>{r=r.trim();const e=r.match(Sge);if(e!==null&&e.length===4){const t=e[2],n=[];let i=null;for(;(i=Age.exec(t))!==null;)n.push({name:i[1],type:i[2]});const a=[];for(let c=0;c<n.length;c++){const{name:h,type:d}=n[c];let f=d;f.startsWith("ptr")?f="pointer":(f.startsWith("texture")&&(f=d.split("<")[0]),f=rU[f]),a.push(new VM(f,h))}const s=r.substring(e[0].length),o=e[3]||"void",l=e[1]!==void 0?e[1]:"";return{type:rU[o]||o,inputs:a,name:l,inputsCode:t,blockCode:s,outputType:o}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class Cge extends HM{constructor(e){const{type:t,inputs:n,name:i,inputsCode:a,blockCode:s,outputType:o}=Mge(e);super(t,n,i),this.inputsCode=a,this.blockCode=s,this.outputType=o}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class Rge extends Y4{parseFunction(e){return new Cge(e)}}const Hu=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},Nge={[ks.READ_ONLY]:"read",[ks.WRITE_ONLY]:"write",[ks.READ_WRITE]:"read_write"},iU={[jl]:"repeat",[ts]:"clamp",[Kl]:"mirror"},Jp={vertex:Hu?Hu.VERTEX:1,fragment:Hu?Hu.FRAGMENT:2,compute:Hu?Hu.COMPUTE:4},aU={instance:!0,swizzleAssign:!1,storageBuffer:!0},Pge={"^^":"tsl_xor"},Dge={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},sU={},Ki={tsl_xor:new Jn("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new Jn("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new Jn("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new Jn("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new Jn("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new Jn("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new Jn("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new Jn("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new Jn("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new Jn("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new Jn("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new Jn("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new Jn(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},lf={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};typeof navigator<"u"&&/Windows/g.test(navigator.userAgent)&&(Ki.pow_float=new Jn("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),Ki.pow_vec2=new Jn("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[Ki.pow_float]),Ki.pow_vec3=new Jn("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[Ki.pow_float]),Ki.pow_vec4=new Jn("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[Ki.pow_float]),lf.pow_float="tsl_pow_float",lf.pow_vec2="tsl_pow_vec2",lf.pow_vec3="tsl_pow_vec3",lf.pow_vec4="tsl_pow_vec4");let i5="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(i5+=`diagnostic( off, derivative_uniformity );
`);class Lge extends $4{constructor(e,t){super(e,t,new Rge),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Bi}_generateTextureSample(e,t,n,i,a=this.shaderStage){return a==="fragment"?i?`textureSample( ${t}, ${t}_sampler, ${n}, ${i} )`:`textureSample( ${t}, ${t}_sampler, ${n} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n):this.generateTextureLod(e,t,n,i,"0")}_generateVideoSample(e,t,n=this.shaderStage){if(n==="fragment")return`textureSampleBaseClampToEdge( ${e}, ${e}_sampler, vec2<f32>( ${t}.x, 1.0 - ${t}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${n} shader.`)}_generateTextureSampleLevel(e,t,n,i,a,s=this.shaderStage){return(s==="fragment"||s==="compute")&&this.isUnfilterable(e)===!1?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${i} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,i):this.generateTextureLod(e,t,n,a,i)}generateWrapFunction(e){const t=`tsl_coord_${iU[e.wrapS]}S_${iU[e.wrapT]}_${e.isData3DTexture?"3d":"2d"}T`;let n=sU[t];if(n===void 0){const i=[],a=e.isData3DTexture?"vec3f":"vec2f";let s=`fn ${t}( coord : ${a} ) -> ${a} {

	return ${a}(
`;const o=(l,u)=>{l===jl?(i.push(Ki.repeatWrapping_float),s+=`		tsl_repeatWrapping_float( coord.${u} )`):l===ts?(i.push(Ki.clampWrapping_float),s+=`		tsl_clampWrapping_float( coord.${u} )`):l===Kl?(i.push(Ki.mirrorWrapping_float),s+=`		tsl_mirrorWrapping_float( coord.${u} )`):(s+=`		coord.${u}`,console.warn(`WebGPURenderer: Unsupported texture wrap type "${l}" for vertex shader.`))};o(e.wrapS,"x"),s+=`,
`,o(e.wrapT,"y"),e.isData3DTexture&&(s+=`,
`,o(e.wrapR,"z")),s+=`
	);

}
`,sU[t]=n=new Jn(s,i)}return n.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,n){const i=this.getDataFromNode(e,this.shaderStage,this.globalCache);i.dimensionsSnippet===void 0&&(i.dimensionsSnippet={});let a=i.dimensionsSnippet[n];if(i.dimensionsSnippet[n]===void 0){let s,o;const{primarySamples:l}=this.renderer.backend.utils.getTextureSampleData(e),u=l>1;e.isData3DTexture?o="vec3<u32>":o="vec2<u32>",u||e.isVideoTexture||e.isStorageTexture?s=t:s=`${t}${n?`, u32( ${n} )`:""}`,a=new Rg(new Pg(`textureDimensions( ${s} )`,o)),i.dimensionsSnippet[n]=a,(e.isDataArrayTexture||e.isData3DTexture)&&(i.arrayLayerCount=new Rg(new Pg(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(i.cubeFaceCount=new Rg(new Pg("6u","u32")))}return a.build(this)}generateFilteredTexture(e,t,n,i="0u"){this._include("biquadraticTexture");const a=this.generateWrapFunction(e),s=this.generateTextureDimension(e,t,i);return`tsl_biquadraticTexture( ${t}, ${a}( ${n} ), ${s}, u32( ${i} ) )`}generateTextureLod(e,t,n,i,a="0u"){const s=this.generateWrapFunction(e),o=this.generateTextureDimension(e,t,a),l=e.isData3DTexture?"vec3":"vec2",u=`${l}<u32>(${s}(${n}) * ${l}<f32>(${o}))`;return this.generateTextureLoad(e,t,u,i,a)}generateTextureLoad(e,t,n,i,a="0u"){return e.isVideoTexture===!0||e.isStorageTexture===!0?`textureLoad( ${t}, ${n} )`:i?`textureLoad( ${t}, ${n}, ${i}, u32( ${a} ) )`:`textureLoad( ${t}, ${n}, u32( ${a} ) )`}generateTextureStore(e,t,n,i){return`textureStore( ${t}, ${n}, ${i} )`}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===Un||this.isSampleCompare(e)===!1&&e.minFilter===mn&&e.magFilter===mn||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,n,i,a=this.shaderStage){let s=null;return e.isVideoTexture===!0?s=this._generateVideoSample(t,n,a):this.isUnfilterable(e)?s=this.generateTextureLod(e,t,n,i,"0",a):s=this._generateTextureSample(e,t,n,i,a),s}generateTextureGrad(e,t,n,i,a,s=this.shaderStage){if(s==="fragment")return`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${i[0]}, ${i[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${s} shader.`)}generateTextureCompare(e,t,n,i,a,s=this.shaderStage){if(s==="fragment")return`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${i} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${s} shader.`)}generateTextureLevel(e,t,n,i,a,s=this.shaderStage){let o=null;return e.isVideoTexture===!0?o=this._generateVideoSample(t,n,s):o=this._generateTextureSampleLevel(e,t,n,i,a,s),o}generateTextureBias(e,t,n,i,a,s=this.shaderStage){if(s==="fragment")return`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${i} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${s} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const n=e.name,i=e.type;return i==="texture"||i==="cubeTexture"||i==="storageTexture"||i==="texture3D"?n:i==="buffer"||i==="storageBuffer"||i==="indirectStorageBuffer"?this.isCustomStruct(e)?n:n+".value":e.groupNode.name+"."+n}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=Pge[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?ks.READ_ONLY:e.access}getStorageAccess(e,t){return Nge[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,n,i=null){const a=super.getUniformFromNode(e,t,n,i),s=this.getDataFromNode(e,n,this.globalCache);if(s.uniformGPU===void 0){let o;const l=e.groupNode,u=l.name,c=this.getBindGroupArray(u,n);if(t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="texture3D"){let h=null;const d=this.getNodeAccess(e,n);if(t==="texture"||t==="storageTexture"?h=new Lm(a.name,a.node,l,d):t==="cubeTexture"?h=new e5(a.name,a.node,l,d):t==="texture3D"&&(h=new t5(a.name,a.node,l,d)),h.store=e.isStorageTextureNode===!0,h.setVisibility(Jp[n]),(n==="fragment"||n==="compute")&&this.isUnfilterable(e.value)===!1&&h.store===!1){const f=new mge(`${a.name}_sampler`,a.node,l);f.setVisibility(Jp[n]),c.push(f,h),o=[f,h]}else c.push(h),o=[h]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const h=t==="buffer"?Z4:xge,d=new h(e,l);d.setVisibility(Jp[n]),c.push(d),o=d,a.name=i||"NodeBuffer_"+a.id}else{const h=this.uniformGroups[n]||(this.uniformGroups[n]={});let d=h[u];d===void 0&&(d=new J4(u,l),d.setVisibility(Jp[n]),h[u]=d,c.push(d)),o=this.getNodeUniform(a,t),d.addUniform(o)}s.uniformGPU=o}return a}getBuiltin(e,t,n,i=this.shaderStage){const a=this.builtins[i]||(this.builtins[i]=new Map);return a.has(e)===!1&&a.set(e,{name:e,property:t,type:n}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),i=[];for(const s of t.inputs)i.push(s.name+" : "+this.getType(s.type));let a=`fn ${t.name}( ${i.join(", ")} ) -> ${this.getType(t.type)} {
${n.vars}
${n.code}
`;return n.result&&(a+=`	return ${n.result};
`),a+=`
}
`,a}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],n=this.directives[e];if(n!==void 0)for(const i of n)t.push(`enable ${i};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],n=this.builtins[e];if(n!==void 0)for(const{name:i,property:a,type:s}of n.values())t.push(`@builtin( ${i} ) ${a} : ${s}`);return t.join(`,
	`)}getScopedArray(e,t,n,i){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:n,bufferCount:i}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:n,scope:i,bufferType:a,bufferCount:s}of this.scopedArrays.values()){const o=this.getType(a);t.push(`var<${i}> ${n}: array< ${o}, ${s} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const n=this.getBuiltins("attribute");n&&t.push(n);const i=this.getAttributesArray();for(let a=0,s=i.length;a<s;a++){const o=i[a],l=o.name,u=this.getType(o.type);t.push(`@location( ${a} ) ${l} : ${u}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const n of e.members){const i=e.output?"@location( "+n.index+" ) ":"";let a=this.getType(n.type);n.atomic&&(a="atomic< "+a+" >"),t.push(`	${i+n.name} : ${a}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const n=this.structs[e];if(n.length>0){const i=[];for(const a of n){let s=`struct ${a.name} {
`;s+=this.getStructMembers(a),s+=`
};`,i.push(s)}t=`
`+i.join(`

`)+`
`}return t}getVar(e,t,n=null){let i=`var ${t} : `;return n!==null?i+=this.generateArrayDeclaration(e,n):i+=this.getType(e),i}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const i of n)t.push(`	${this.getVar(i.type,i.name,i.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const a=this.varyings,s=this.vars[e];for(let o=0;o<a.length;o++){const l=a[o];if(l.needsInterpolation){let u=`@location( ${o} )`;/^(int|uint|ivec|uvec)/.test(l.type)&&(u+=" @interpolate( flat )"),t.push(`${u} ${l.name} : ${this.getType(l.type)}`)}else e==="vertex"&&s.includes(l)===!1&&s.push(l)}}const n=this.getBuiltins(e);n&&t.push(n);const i=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+i):i}isCustomStruct(e){return e.value.isStorageBufferAttribute&&e.node.structTypeNode!==null}getUniforms(e){const t=this.uniforms[e],n=[],i=[],a=[],s={};for(const l of t){const u=l.groupNode.name,c=this.bindingsIndexes[u];if(l.type==="texture"||l.type==="cubeTexture"||l.type==="storageTexture"||l.type==="texture3D"){const h=l.node.value;(e==="fragment"||e==="compute")&&this.isUnfilterable(h)===!1&&l.node.isStorageTextureNode!==!0&&(this.isSampleCompare(h)?n.push(`@binding( ${c.binding++} ) @group( ${c.group} ) var ${l.name}_sampler : sampler_comparison;`):n.push(`@binding( ${c.binding++} ) @group( ${c.group} ) var ${l.name}_sampler : sampler;`));let d,f="";const{primarySamples:p}=this.renderer.backend.utils.getTextureSampleData(h);if(p>1&&(f="_multisampled"),h.isCubeTexture===!0)d="texture_cube<f32>";else if(h.isDataArrayTexture===!0||h.isCompressedArrayTexture===!0)d="texture_2d_array<f32>";else if(h.isDepthTexture===!0)d=`texture_depth${f}_2d`;else if(h.isVideoTexture===!0)d="texture_external";else if(h.isData3DTexture===!0)d="texture_3d<f32>";else if(l.node.isStorageTextureNode===!0){const m=vS(h),v=this.getStorageAccess(l.node,e);d=`texture_storage_2d<${m}, ${v}>`}else{const m=this.getComponentTypeFromTexture(h).charAt(0);d=`texture${f}_2d<${m}32>`}n.push(`@binding( ${c.binding++} ) @group( ${c.group} ) var ${l.name} : ${d};`)}else if(l.type==="buffer"||l.type==="storageBuffer"||l.type==="indirectStorageBuffer"){const h=l.node,d=this.getType(h.getNodeType(this)),f=h.bufferCount,p=f>0&&l.type==="buffer"?", "+f:"",m=h.isStorageBufferNode?`storage, ${this.getStorageAccess(h,e)}`:"uniform";if(this.isCustomStruct(l))i.push(`@binding( ${c.binding++} ) @group( ${c.group} ) var<${m}> ${l.name} : ${d};`);else{const g=`	value : array< ${h.isAtomic?`atomic<${d}>`:`${d}`}${p} >`;i.push(this._getWGSLStructBinding(l.name,g,m,c.binding++,c.group))}}else{const h=this.getType(this.getVectorType(l.type)),d=l.groupNode.name;(s[d]||(s[d]={index:c.binding++,id:c.group,snippets:[]})).snippets.push(`	${l.name} : ${h}`)}}for(const l in s){const u=s[l];a.push(this._getWGSLStructBinding(l,u.snippets.join(`,
`),"uniform",u.index,u.id))}let o=n.join(`
`);return o+=i.join(`
`),o+=a.join(`
`),o}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const n=e[t];n.uniforms=this.getUniforms(t),n.attributes=this.getAttributes(t),n.varyings=this.getVaryings(t),n.structs=this.getStructs(t),n.vars=this.getVars(t),n.codes=this.getCodes(t),n.directives=this.getDirectives(t),n.scopedArrays=this.getScopedArrays(t);let i=`// code

`;i+=this.flowCode[t];const a=this.flowNodes[t],s=a[a.length-1],o=s.outputNode,l=o!==void 0&&o.isOutputStructNode===!0;for(const u of a){const c=this.getFlowData(u),h=u.name;if(h&&(i.length>0&&(i+=`
`),i+=`	// flow -> ${h}
`),i+=`${c.code}
	`,u===s&&t!=="compute"){if(i+=`// result

	`,t==="vertex")i+=`varyings.Vertex = ${c.result};`;else if(t==="fragment")if(l)n.returnType=o.getNodeType(this),n.structs+="var<private> output : "+n.returnType+";",i+=`return ${c.result};`;else{let d="	@location(0) color: vec4<f32>";const f=this.getBuiltins("output");f&&(d+=`,
	`+f),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",d),n.structs+=`
var<private> output : OutputStruct;`,i+=`output.color = ${c.result};

	return output;`}}}n.flow=i}this.shaderStage=null,this.material!==null?(this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment)):this.computeShader=this._getWGSLComputeCode(e.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(e,t=null){let n;return t!==null&&(n=this._getWGSLMethod(e+"_"+t)),n===void 0&&(n=this._getWGSLMethod(e)),n||e}getType(e){return Dge[e]||e}isAvailable(e){let t=aU[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),aU[e]=t),t}_getWGSLMethod(e){return Ki[e]!==void 0&&this._include(e),lf[e]}_include(e){const t=Ki[e];return t.build(this),this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${i5}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${t} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x + globalId.y * numWorkgroups.x * u32(${t}) + globalId.z * numWorkgroups.x * numWorkgroups.y * u32(${t});

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,n,i=0,a=0){const s=e+"Struct";return`${this._getWGSLStruct(s,t)}
@binding( ${i} ) @group( ${a} )
var<${n}> ${e} : ${s};`}}class Ige{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=de.Depth24PlusStencil8:e.depth&&(t=de.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const a=this.backend.renderer,s=a.getRenderTarget();t=s?s.samples:a.samples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const n=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:n?1:t,isMSAA:n}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return ac.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return ac.LineList;if(e.isLine)return ac.LineStrip;if(e.isMesh)return ac.TriangleList}getSampleCount(e){let t=1;return e>1&&(t=Math.pow(2,Math.floor(Math.log2(e))),t===2&&(t=4)),t}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){const e=this.backend.parameters.outputType;if(e===void 0)return navigator.gpu.getPreferredCanvasFormat();if(e===In)return de.BGRA8Unorm;if(e===kr)return de.RGBA16Float;throw new Error("Unsupported outputType")}}const Oge=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),Fge=new Map([[cz,["float16"]]]),Bge=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class Uge{constructor(e){this.backend=e}createAttribute(e,t){const n=this._getBufferAttribute(e),i=this.backend,a=i.get(n);let s=a.buffer;if(s===void 0){const o=i.device;let l=n.array;if(e.normalized===!1){if(l.constructor===Int16Array||l.constructor===Int8Array)l=new Int32Array(l);else if((l.constructor===Uint16Array||l.constructor===Uint8Array)&&(l=new Uint32Array(l),t&GPUBufferUsage.INDEX))for(let c=0;c<l.length;c++)l[c]===65535&&(l[c]=4294967295)}if(n.array=l,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&n.itemSize===3){l=new l.constructor(n.count*4);for(let c=0;c<n.count;c++)l.set(n.array.subarray(c*3,c*3+3),c*4);n.itemSize=4,n.array=l,a._force3to4BytesAlignment=!0}const u=l.byteLength+(4-l.byteLength%4)%4;s=o.createBuffer({label:n.name,size:u,usage:t,mappedAtCreation:!0}),new l.constructor(s.getMappedRange()).set(l),s.unmap(),a.buffer=s}}updateAttribute(e){const t=this._getBufferAttribute(e),n=this.backend,i=n.device,a=n.get(t),s=n.get(t).buffer;let o=t.array;if(a._force3to4BytesAlignment===!0){o=new o.constructor(t.count*4);for(let c=0;c<t.count;c++)o.set(t.array.subarray(c*3,c*3+3),c*4);t.array=o}const l=this._isTypedArray(o),u=t.updateRanges;if(u.length===0)i.queue.writeBuffer(s,0,o,0);else{const c=l?1:o.BYTES_PER_ELEMENT;for(let h=0,d=u.length;h<d;h++){const f=u[h];let p,m;if(a._force3to4BytesAlignment===!0){const g=Math.floor(f.start/3),y=Math.ceil(f.count/3);p=g*4*c,m=y*4*c}else p=f.start*c,m=f.count*c;const v=p*(l?o.BYTES_PER_ELEMENT:1);i.queue.writeBuffer(s,v,o,p,m)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),n=new Map;for(let i=0;i<t.length;i++){const a=t[i],s=a.array.BYTES_PER_ELEMENT,o=this._getBufferAttribute(a);let l=n.get(o);if(l===void 0){let h,d;a.isInterleavedBufferAttribute===!0?(h=a.data.stride*s,d=a.data.isInstancedInterleavedBuffer?Zp.Instance:Zp.Vertex):(h=a.itemSize*s,d=a.isInstancedBufferAttribute?Zp.Instance:Zp.Vertex),a.normalized===!1&&(a.array.constructor===Int16Array||a.array.constructor===Uint16Array)&&(h=4),l={arrayStride:h,attributes:[],stepMode:d},n.set(o,l)}const u=this._getVertexFormat(a),c=a.isInterleavedBufferAttribute===!0?a.offset*s:0;l.attributes.push({shaderLocation:i,offset:c,format:u})}return Array.from(n.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,n=t.device,a=t.get(this._getBufferAttribute(e)).buffer,s=a.size,o=n.createBuffer({label:`${e.name}_readback`,size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),l=n.createCommandEncoder({label:`readback_encoder_${e.name}`});l.copyBufferToBuffer(a,0,o,0,s);const u=l.finish();n.queue.submit([u]),await o.mapAsync(GPUMapMode.READ);const c=o.getMappedRange(),h=new e.array.constructor(c.slice(0));return o.unmap(),h.buffer}_getVertexFormat(e){const{itemSize:t,normalized:n}=e,i=e.array.constructor,a=e.constructor;let s;if(t===1)s=Bge.get(i);else{const l=(Fge.get(a)||Oge.get(i))[n?1:0];if(l){const u=i.BYTES_PER_ELEMENT*t,h=Math.floor((u+3)/4)*4/i.BYTES_PER_ELEMENT;if(h%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");s=`${l}x${h}`}}return s||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),s}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class kge{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const t=this.backend,n=t.device,i=[];let a=0;for(const s of e.bindings){const o={binding:a++,visibility:s.visibility};if(s.isUniformBuffer||s.isStorageBuffer){const l={};s.isStorageBuffer&&(s.visibility&4&&(s.access===ks.READ_WRITE||s.access===ks.WRITE_ONLY)?l.type=ow.Storage:l.type=ow.ReadOnlyStorage),o.buffer=l}else if(s.isSampler){const l={};s.texture.isDepthTexture&&s.texture.compareFunction!==null&&(l.type="comparison"),o.sampler=l}else if(s.isSampledTexture&&s.texture.isVideoTexture)o.externalTexture={};else if(s.isSampledTexture&&s.store){const l={};l.format=this.backend.get(s.texture).texture.format;const u=s.access;u===ks.READ_WRITE?l.access=lw.ReadWrite:u===ks.WRITE_ONLY?l.access=lw.WriteOnly:l.access=lw.ReadOnly,o.storageTexture=l}else if(s.isSampledTexture){const l={},{primarySamples:u}=t.utils.getTextureSampleData(s.texture);if(u>1&&(l.multisampled=!0,s.texture.isDepthTexture||(l.sampleType=Vu.UnfilterableFloat)),s.texture.isDepthTexture)l.sampleType=Vu.Depth;else if(s.texture.isDataTexture||s.texture.isDataArrayTexture||s.texture.isData3DTexture){const c=s.texture.type;c===mr?l.sampleType=Vu.SInt:c===hn?l.sampleType=Vu.UInt:c===Un&&(this.backend.hasFeature("float32-filterable")?l.sampleType=Vu.Float:l.sampleType=Vu.UnfilterableFloat)}s.isSampledCubeTexture?l.viewDimension=oi.Cube:s.texture.isDataArrayTexture||s.texture.isCompressedArrayTexture?l.viewDimension=oi.TwoDArray:s.isSampledTexture3D&&(l.viewDimension=oi.ThreeD),o.texture=l}else console.error(`WebGPUBindingUtils: Unsupported binding "${s}".`);i.push(o)}return n.createBindGroupLayout({entries:i})}createBindings(e,t,n,i=0){const{backend:a,bindGroupLayoutCache:s}=this,o=a.get(e);let l=s.get(e.bindingsReference);l===void 0&&(l=this.createBindingsLayout(e),s.set(e.bindingsReference,l));let u;n>0&&(o.groups===void 0&&(o.groups=[],o.versions=[]),o.versions[n]===i&&(u=o.groups[n])),u===void 0&&(u=this.createBindGroup(e,l),n>0&&(o.groups[n]=u,o.versions[n]=i)),o.group=u,o.layout=l}updateBinding(e){const t=this.backend,n=t.device,i=e.buffer,a=t.get(e).buffer;n.queue.writeBuffer(a,0,i,0)}createBindGroupIndex(e,t){const i=this.backend.device,a=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,s=e[0],o=i.createBuffer({label:"bindingCameraIndex_"+s,size:16,usage:a});i.queue.writeBuffer(o,0,e,0);const l=[{binding:0,resource:{buffer:o}}];return i.createBindGroup({label:"bindGroupCameraIndex_"+s,layout:t,entries:l})}createBindGroup(e,t){const n=this.backend,i=n.device;let a=0;const s=[];for(const o of e.bindings){if(o.isUniformBuffer){const l=n.get(o);if(l.buffer===void 0){const u=o.byteLength,c=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,h=i.createBuffer({label:"bindingBuffer_"+o.name,size:u,usage:c});l.buffer=h}s.push({binding:a,resource:{buffer:l.buffer}})}else if(o.isStorageBuffer){const l=n.get(o);if(l.buffer===void 0){const u=o.attribute;l.buffer=n.get(u).buffer}s.push({binding:a,resource:{buffer:l.buffer}})}else if(o.isSampler){const l=n.get(o.texture);s.push({binding:a,resource:l.sampler})}else if(o.isSampledTexture){const l=n.get(o.texture);let u;if(l.externalTexture!==void 0)u=i.importExternalTexture({source:l.externalTexture});else{const c=o.store?1:l.texture.mipLevelCount,h=`view-${l.texture.width}-${l.texture.height}-${c}`;if(u=l[h],u===void 0){const d=gge.All;let f;o.isSampledCubeTexture?f=oi.Cube:o.isSampledTexture3D?f=oi.ThreeD:o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?f=oi.TwoDArray:f=oi.TwoD,u=l[h]=l.texture.createView({aspect:d,dimension:f,mipLevelCount:c})}}s.push({binding:a,resource:u})}a++}return i.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:s})}}class Gge{constructor(e){this.backend=e}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:n,material:i,geometry:a,pipeline:s}=e,{vertexProgram:o,fragmentProgram:l}=s,u=this.backend,c=u.device,h=u.utils,d=u.get(s),f=[];for(const P of e.getBindings()){const M=u.get(P);f.push(M.layout)}const p=u.attributeUtils.createShaderVertexBuffers(e);let m;i.transparent===!0&&i.blending!==_i&&(m=this._getBlending(i));let v={};i.stencilWrite===!0&&(v={compare:this._getStencilCompare(i),failOp:this._getStencilOperation(i.stencilFail),depthFailOp:this._getStencilOperation(i.stencilZFail),passOp:this._getStencilOperation(i.stencilZPass)});const g=this._getColorWriteMask(i),y=[];if(e.context.textures!==null){const P=e.context.textures;for(let M=0;M<P.length;M++){const N=h.getTextureFormatGPU(P[M]);y.push({format:N,blend:m,writeMask:g})}}else{const P=h.getCurrentColorFormat(e.context);y.push({format:P,blend:m,writeMask:g})}const _=u.get(o).module,x=u.get(l).module,E=this._getPrimitiveState(n,a,i),T=this._getDepthCompare(i),b=h.getCurrentDepthStencilFormat(e.context),w=this._getSampleCount(e.context),A={label:`renderPipeline_${i.name||i.type}_${i.id}`,vertex:Object.assign({},_,{buffers:p}),fragment:Object.assign({},x,{targets:y}),primitive:E,multisample:{count:w,alphaToCoverageEnabled:i.alphaToCoverage&&w>1},layout:c.createPipelineLayout({bindGroupLayouts:f})},S={},C=e.context.depth,R=e.context.stencil;if((C===!0||R===!0)&&(C===!0&&(S.format=b,S.depthWriteEnabled=i.depthWrite,S.depthCompare=T),R===!0&&(S.stencilFront=v,S.stencilBack={},S.stencilReadMask=i.stencilFuncMask,S.stencilWriteMask=i.stencilWriteMask),i.polygonOffset===!0&&(S.depthBias=i.polygonOffsetUnits,S.depthBiasSlopeScale=i.polygonOffsetFactor,S.depthBiasClamp=0),A.depthStencil=S),t===null)d.pipeline=c.createRenderPipeline(A);else{const P=new Promise(M=>{c.createRenderPipelineAsync(A).then(N=>{d.pipeline=N,M()})});t.push(P)}}createBundleEncoder(e){const t=this.backend,{utils:n,device:i}=t,a=n.getCurrentDepthStencilFormat(e),s=n.getCurrentColorFormat(e),o=this._getSampleCount(e),l={label:"renderBundleEncoder",colorFormats:[s],depthStencilFormat:a,sampleCount:o};return i.createRenderBundleEncoder(l)}createComputePipeline(e,t){const n=this.backend,i=n.device,a=n.get(e.computeProgram).module,s=n.get(e),o=[];for(const l of t){const u=n.get(l);o.push(u.layout)}s.pipeline=i.createComputePipeline({compute:a,layout:i.createPipelineLayout({bindGroupLayouts:o})})}_getBlending(e){let t,n;const i=e.blending,a=e.blendSrc,s=e.blendDst,o=e.blendEquation;if(i===hc){const l=e.blendSrcAlpha!==null?e.blendSrcAlpha:a,u=e.blendDstAlpha!==null?e.blendDstAlpha:s,c=e.blendEquationAlpha!==null?e.blendEquationAlpha:o;t={srcFactor:this._getBlendFactor(a),dstFactor:this._getBlendFactor(s),operation:this._getBlendOperation(o)},n={srcFactor:this._getBlendFactor(l),dstFactor:this._getBlendFactor(u),operation:this._getBlendOperation(c)}}else{const l=e.premultipliedAlpha,u=(c,h,d,f)=>{t={srcFactor:c,dstFactor:h,operation:ml.Add},n={srcFactor:d,dstFactor:f,operation:ml.Add}};if(l)switch(i){case aa:u(Tt.One,Tt.OneMinusSrcAlpha,Tt.One,Tt.OneMinusSrcAlpha);break;case wc:u(Tt.One,Tt.One,Tt.One,Tt.One);break;case Sc:u(Tt.Zero,Tt.OneMinusSrc,Tt.Zero,Tt.One);break;case Ac:u(Tt.Zero,Tt.Src,Tt.Zero,Tt.SrcAlpha);break}else switch(i){case aa:u(Tt.SrcAlpha,Tt.OneMinusSrcAlpha,Tt.One,Tt.OneMinusSrcAlpha);break;case wc:u(Tt.SrcAlpha,Tt.One,Tt.SrcAlpha,Tt.One);break;case Sc:u(Tt.Zero,Tt.OneMinusSrc,Tt.Zero,Tt.One);break;case Ac:u(Tt.Zero,Tt.Src,Tt.Zero,Tt.Src);break}}if(t!==void 0&&n!==void 0)return{color:t,alpha:n};console.error("THREE.WebGPURenderer: Invalid blending: ",i)}_getBlendFactor(e){let t;switch(e){case As:t=Tt.Zero;break;case wA:t=Tt.One;break;case SA:t=Tt.Src;break;case AA:t=Tt.OneMinusSrc;break;case Of:t=Tt.SrcAlpha;break;case Ff:t=Tt.OneMinusSrcAlpha;break;case RA:t=Tt.Dst;break;case NA:t=Tt.OneMinusDstColor;break;case MA:t=Tt.DstAlpha;break;case CA:t=Tt.OneMinusDstAlpha;break;case PA:t=Tt.SrcAlphaSaturated;break;case Pfe:t=Tt.Constant;break;case Dfe:t=Tt.OneMinusConstant;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const n=e.stencilFunc;switch(n){case RQ:t=wr.Never;break;case Xw:t=wr.Always;break;case NQ:t=wr.Less;break;case DQ:t=wr.LessEqual;break;case PQ:t=wr.Equal;break;case OQ:t=wr.GreaterEqual;break;case LQ:t=wr.Greater;break;case IQ:t=wr.NotEqual;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",n)}return t}_getStencilOperation(e){let t;switch(e){case El:t=_o.Keep;break;case EQ:t=_o.Zero;break;case TQ:t=_o.Replace;break;case CQ:t=_o.Invert;break;case wQ:t=_o.IncrementClamp;break;case SQ:t=_o.DecrementClamp;break;case AQ:t=_o.IncrementWrap;break;case MQ:t=_o.DecrementWrap;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case Br:t=ml.Add;break;case EA:t=ml.Subtract;break;case TA:t=ml.ReverseSubtract;break;case QG:t=ml.Min;break;case ZG:t=ml.Max;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,n){const i={},a=this.backend.utils;switch(i.topology=a.getPrimitiveTopology(e,n),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(i.stripIndexFormat=t.index.array instanceof Uint16Array?Xc.Uint16:Xc.Uint32),n.side){case yi:i.frontFace=iw.CCW,i.cullMode=aw.Back;break;case dn:i.frontFace=iw.CCW,i.cullMode=aw.Front;break;case Qr:i.frontFace=iw.CCW,i.cullMode=aw.None;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",n.side);break}return i}_getColorWriteMask(e){return e.colorWrite===!0?tU.All:tU.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=wr.Always;else{const n=e.depthFunc;switch(n){case Bf:t=wr.Never;break;case Uf:t=wr.Always;break;case kf:t=wr.Less;break;case Ho:t=wr.LessEqual;break;case Gf:t=wr.Equal;break;case zf:t=wr.GreaterEqual;break;case Vf:t=wr.Greater;break;case Hf:t=wr.NotEqual;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",n)}}return t}}class zge extends r5{constructor(e,t,n=2048){super(n),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const i=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return Ia(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e.id,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,n=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const i=this.device.createCommandEncoder();i.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),i.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,n);const a=i.finish();if(this.device.queue.submit([a]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,n),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const s=new BigUint64Array(this.resultBuffer.getMappedRange(0,n));let o=0;for(const[,l]of e){const u=s[l],c=s[l+1],h=Number(c-u)/1e6;o+=h}return this.resultBuffer.unmap(),this.lastValue=o,o}catch(e){return console.error("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){console.error("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){console.error("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class Vge extends n5{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new Ige(this),this.attributeUtils=new Uge(this),this.bindingUtils=new kge(this),this.pipelineUtils=new Gge(this),this.textureUtils=new wge(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let n;if(t.device===void 0){const s={powerPreference:t.powerPreference},o=typeof navigator<"u"?await navigator.gpu.requestAdapter(s):null;if(o===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const l=Object.values(gS),u=[];for(const h of l)o.features.has(h)&&u.push(h);const c={requiredFeatures:u,requiredLimits:t.requiredLimits};n=await o.requestDevice(c)}else n=t.device;n.lost.then(s=>{const o={api:"WebGPU",message:s.message||"Unknown reason",reason:s.reason||null,originalEvent:s};e.onDeviceLost(o)});const i=t.context!==void 0?t.context:e.domElement.getContext("webgpu");this.device=n,this.context=i;const a=t.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(gS.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:a}),this.updateSize()}get coordinateSystem(){return $o}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.defaultRenderPassdescriptor;if(e===null){const n=this.renderer;e={colorAttachments:[{view:null}]},(this.renderer.depth===!0||this.renderer.stencil===!0)&&(e.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(n.depth,n.stencil).createView()});const i=e.colorAttachments[0];this.renderer.samples>0?i.view=this.colorBuffer.createView():i.resolveTarget=void 0,this.defaultRenderPassdescriptor=e}const t=e.colorAttachments[0];return this.renderer.samples>0?t.resolveTarget=this.context.getCurrentTexture().createView():t.view=this.context.getCurrentTexture().createView(),e}_getRenderPassDescriptor(e,t={}){const n=e.renderTarget,i=this.get(n);let a=i.descriptors;if(a===void 0||i.width!==n.width||i.height!==n.height||i.dimensions!==n.dimensions||i.activeMipmapLevel!==e.activeMipmapLevel||i.activeCubeFace!==e.activeCubeFace||i.samples!==n.samples){a={},i.descriptors=a;const u=()=>{n.removeEventListener("dispose",u),this.delete(n)};n.hasEventListener("dispose",u)===!1&&n.addEventListener("dispose",u)}const s=e.getCacheKey();let o=a[s];if(o===void 0){const u=e.textures,c=[];let h;for(let d=0;d<u.length;d++){const f=this.get(u[d]),p={label:`colorAttachment_${d}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:oi.TwoD};n.isRenderTarget3D?(h=e.activeCubeFace,p.baseArrayLayer=0,p.dimension=oi.ThreeD,p.depthOrArrayLayers=u[d].image.depth):n.isRenderTargetArray&&(p.dimension=oi.TwoDArray,p.depthOrArrayLayers=u[d].image.depth);const m=f.texture.createView(p);let v,g;f.msaaTexture!==void 0?(v=f.msaaTexture.createView(),g=m):(v=m,g=void 0),c.push({view:v,resolveTarget:g,depthSlice:h})}if(o={textureViews:c},e.depth){const d=this.get(e.depthTexture);o.depthStencilView=d.texture.createView()}a[s]=o,i.width=n.width,i.height=n.height,i.samples=n.samples,i.activeMipmapLevel=e.activeMipmapLevel,i.activeCubeFace=e.activeCubeFace,i.dimensions=n.dimensions}const l={colorAttachments:[]};for(let u=0;u<o.textureViews.length;u++){const c=o.textureViews[u];let h={r:0,g:0,b:0,a:1};u===0&&t.clearValue&&(h=t.clearValue),l.colorAttachments.push({view:c.view,depthSlice:c.depthSlice,resolveTarget:c.resolveTarget,loadOp:t.loadOp||vn.Load,storeOp:t.storeOp||pr.Store,clearValue:h})}return o.depthStencilView&&(l.depthStencilAttachment={view:o.depthStencilView}),l}beginRender(e){const t=this.get(e),n=this.device,i=e.occlusionQueryCount;let a;i>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,a=n.createQuerySet({type:"occlusion",count:i,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=a,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(i),t.lastOcclusionObject=null);let s;e.textures===null?s=this._getDefaultRenderPassDescriptor():s=this._getRenderPassDescriptor(e,{loadOp:vn.Load}),this.initTimestampQuery(e,s),s.occlusionQuerySet=a;const o=s.depthStencilAttachment;if(e.textures!==null){const c=s.colorAttachments;for(let h=0;h<c.length;h++){const d=c[h];e.clearColor?(d.clearValue=h===0?e.clearColorValue:{r:0,g:0,b:0,a:1},d.loadOp=vn.Clear,d.storeOp=pr.Store):(d.loadOp=vn.Load,d.storeOp=pr.Store)}}else{const c=s.colorAttachments[0];e.clearColor?(c.clearValue=e.clearColorValue,c.loadOp=vn.Clear,c.storeOp=pr.Store):(c.loadOp=vn.Load,c.storeOp=pr.Store)}e.depth&&(e.clearDepth?(o.depthClearValue=e.clearDepthValue,o.depthLoadOp=vn.Clear,o.depthStoreOp=pr.Store):(o.depthLoadOp=vn.Load,o.depthStoreOp=pr.Store)),e.stencil&&(e.clearStencil?(o.stencilClearValue=e.clearStencilValue,o.stencilLoadOp=vn.Clear,o.stencilStoreOp=pr.Store):(o.stencilLoadOp=vn.Load,o.stencilStoreOp=pr.Store));const l=n.createCommandEncoder({label:"renderContext_"+e.id}),u=l.beginRenderPass(s);if(t.descriptor=s,t.encoder=l,t.currentPass=u,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[],e.viewport&&this.updateViewport(e),e.scissor){const{x:c,y:h,width:d,height:f}=e.scissorValue;u.setScissorRect(c,h,d,f)}}finishRender(e){const t=this.get(e),n=e.occlusionQueryCount;if(t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),n>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery(),t.currentPass.end(),n>0){const i=n*8;let a=this.occludedResolveCache.get(i);a===void 0&&(a=this.device.createBuffer({size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(i,a));const s=this.device.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,n,a,0),t.encoder.copyBufferToBuffer(a,0,s,0,i),t.occlusionQueryBuffer=s,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const i=e.textures;for(let a=0;a<i.length;a++){const s=i[a];s.generateMipmaps===!0&&this.textureUtils.generateMipmaps(s)}}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:i}=t;if(n&&i){const a=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const s=n.getMappedRange(),o=new BigUint64Array(s);for(let l=0;l<i.length;l++)o[l]===BigInt(0)&&a.add(i[l]);n.destroy(),t.occluded=a}}updateViewport(e){const{currentPass:t}=this.get(e),{x:n,y:i,width:a,height:s,minDepth:o,maxDepth:l}=e.viewportValue;t.setViewport(n,i,a,s,o,l)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,n,i=null){const a=this.device,s=this.renderer;let o=[],l,u,c,h;if(e){const p=this.getClearColor();u={r:p.r,g:p.g,b:p.b,a:p.a}}if(i===null){c=s.depth,h=s.stencil;const p=this._getDefaultRenderPassDescriptor();if(e){o=p.colorAttachments;const m=o[0];m.clearValue=u,m.loadOp=vn.Clear,m.storeOp=pr.Store}(c||h)&&(l=p.depthStencilAttachment)}else{c=i.depth,h=i.stencil;const p={loadOp:e?vn.Clear:vn.Load,clearValue:e?u:void 0};c&&(p.depthLoadOp=t?vn.Clear:vn.Load,p.depthClearValue=t?s.getClearDepth():void 0,p.depthStoreOp=pr.Store),h&&(p.stencilLoadOp=n?vn.Clear:vn.Load,p.stencilClearValue=n?s.getClearStencil():void 0,p.stencilStoreOp=pr.Store);const m=this._getRenderPassDescriptor(i,p);o=m.colorAttachments,l=m.depthStencilAttachment}c&&l&&l.depthLoadOp===void 0&&(t?(l.depthLoadOp=vn.Clear,l.depthClearValue=s.getClearDepth(),l.depthStoreOp=pr.Store):(l.depthLoadOp=vn.Load,l.depthStoreOp=pr.Store)),h&&l&&l.stencilLoadOp===void 0&&(n?(l.stencilLoadOp=vn.Clear,l.stencilClearValue=s.getClearStencil(),l.stencilStoreOp=pr.Store):(l.stencilLoadOp=vn.Load,l.stencilStoreOp=pr.Store));const d=a.createCommandEncoder({label:"clear"});d.beginRenderPass({colorAttachments:o,depthStencilAttachment:l}).end(),a.queue.submit([d.finish()])}beginCompute(e){const t=this.get(e),n={label:"computeGroup_"+e.id};this.initTimestampQuery(e,n),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(n)}compute(e,t,n,i){const{passEncoderGPU:a}=this.get(e),s=this.get(i).pipeline;a.setPipeline(s);for(let c=0,h=n.length;c<h;c++){const d=n[c],f=this.get(d);a.setBindGroup(c,f.group)}const o=this.device.limits.maxComputeWorkgroupsPerDimension,l=this.get(t);l.dispatchSize===void 0&&(l.dispatchSize={x:0,y:1,z:1});const{dispatchSize:u}=l;t.dispatchCount>o?(u.x=Math.min(t.dispatchCount,o),u.y=Math.ceil(t.dispatchCount/o)):u.x=t.dispatchCount,a.dispatchWorkgroups(u.x,u.y,u.z)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(e,t){const{object:n,material:i,context:a,pipeline:s}=e,o=e.getBindings(),l=this.get(a),u=this.get(s).pipeline,c=l.currentSets,h=l.currentPass,d=e.getDrawParameters();if(d===null)return;c.pipeline!==u&&(h.setPipeline(u),c.pipeline=u);const f=c.bindingGroups;for(let y=0,_=o.length;y<_;y++){const x=o[y],E=this.get(x);f[x.index]!==x.id&&(h.setBindGroup(x.index,E.group),f[x.index]=x.id)}const p=e.getIndex(),m=p!==null;if(m===!0&&c.index!==p){const y=this.get(p).buffer,_=p.array instanceof Uint16Array?Xc.Uint16:Xc.Uint32;h.setIndexBuffer(y,_),c.index=p}const v=e.getVertexBuffers();for(let y=0,_=v.length;y<_;y++){const x=v[y];if(c.attributes[y]!==x){const E=this.get(x).buffer;h.setVertexBuffer(y,E),c.attributes[y]=x}}if(l.occlusionQuerySet!==void 0){const y=l.lastOcclusionObject;y!==n&&(y!==null&&y.occlusionTest===!0&&(h.endOcclusionQuery(),l.occlusionQueryIndex++),n.occlusionTest===!0&&(h.beginOcclusionQuery(l.occlusionQueryIndex),l.occlusionQueryObjects[l.occlusionQueryIndex]=n),l.lastOcclusionObject=n)}a.stencil===!0&&i.stencilWrite===!0&&l.currentStencilRef!==i.stencilRef&&(h.setStencilReference(i.stencilRef),l.currentStencilRef=i.stencilRef);const g=()=>{if(n.isBatchedMesh===!0){const y=n._multiDrawStarts,_=n._multiDrawCounts,x=n._multiDrawCount,E=n._multiDrawInstances;E!==null&&Ia("THREE.WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let T=0;T<x;T++){const b=E?E[T]:1,w=b>1?0:T;m===!0?h.drawIndexed(_[T],b,y[T]/p.array.BYTES_PER_ELEMENT,0,w):h.draw(_[T],b,y[T],w),t.update(n,_[T],b)}}else if(m===!0){const{vertexCount:y,instanceCount:_,firstVertex:x}=d,E=e.getIndirect();if(E!==null){const T=this.get(E).buffer;h.drawIndexedIndirect(T,0)}else h.drawIndexed(y,_,x,0,0);t.update(n,y,_)}else{const{vertexCount:y,instanceCount:_,firstVertex:x}=d,E=e.getIndirect();if(E!==null){const T=this.get(E).buffer;h.drawIndirect(T,0)}else h.draw(y,_,x,0);t.update(n,y,_)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const y=this.get(e.camera),_=e.camera.cameras,x=e.getBindingGroup("cameraIndex");if(y.indexesGPU===void 0||y.indexesGPU.length!==_.length){const T=this.get(x),b=[],w=new Uint32Array([0,0,0,0]);for(let A=0,S=_.length;A<S;A++){w[0]=A;const C=this.bindingUtils.createBindGroupIndex(w,T.layout);b.push(C)}y.indexesGPU=b}const E=this.renderer.getPixelRatio();for(let T=0,b=_.length;T<b;T++){const w=_[T];if(n.layers.test(w.layers)){const A=w.viewport;h.setViewport(Math.floor(A.x*E),Math.floor(A.y*E),Math.floor(A.width*E),Math.floor(A.height*E),a.viewportValue.minDepth,a.viewportValue.maxDepth),h.setBindGroup(x.index,y.indexesGPU[T]),g()}}}else g()}needsRenderUpdate(e){const t=this.get(e),{object:n,material:i}=e,a=this.utils,s=a.getSampleCountRenderContext(e.context),o=a.getCurrentColorSpace(e.context),l=a.getCurrentColorFormat(e.context),u=a.getCurrentDepthStencilFormat(e.context),c=a.getPrimitiveTopology(n,i);let h=!1;return(t.material!==i||t.materialVersion!==i.version||t.transparent!==i.transparent||t.blending!==i.blending||t.premultipliedAlpha!==i.premultipliedAlpha||t.blendSrc!==i.blendSrc||t.blendDst!==i.blendDst||t.blendEquation!==i.blendEquation||t.blendSrcAlpha!==i.blendSrcAlpha||t.blendDstAlpha!==i.blendDstAlpha||t.blendEquationAlpha!==i.blendEquationAlpha||t.colorWrite!==i.colorWrite||t.depthWrite!==i.depthWrite||t.depthTest!==i.depthTest||t.depthFunc!==i.depthFunc||t.stencilWrite!==i.stencilWrite||t.stencilFunc!==i.stencilFunc||t.stencilFail!==i.stencilFail||t.stencilZFail!==i.stencilZFail||t.stencilZPass!==i.stencilZPass||t.stencilFuncMask!==i.stencilFuncMask||t.stencilWriteMask!==i.stencilWriteMask||t.side!==i.side||t.alphaToCoverage!==i.alphaToCoverage||t.sampleCount!==s||t.colorSpace!==o||t.colorFormat!==l||t.depthStencilFormat!==u||t.primitiveTopology!==c||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=i,t.materialVersion=i.version,t.transparent=i.transparent,t.blending=i.blending,t.premultipliedAlpha=i.premultipliedAlpha,t.blendSrc=i.blendSrc,t.blendDst=i.blendDst,t.blendEquation=i.blendEquation,t.blendSrcAlpha=i.blendSrcAlpha,t.blendDstAlpha=i.blendDstAlpha,t.blendEquationAlpha=i.blendEquationAlpha,t.colorWrite=i.colorWrite,t.depthWrite=i.depthWrite,t.depthTest=i.depthTest,t.depthFunc=i.depthFunc,t.stencilWrite=i.stencilWrite,t.stencilFunc=i.stencilFunc,t.stencilFail=i.stencilFail,t.stencilZFail=i.stencilZFail,t.stencilZPass=i.stencilZPass,t.stencilFuncMask=i.stencilFuncMask,t.stencilWriteMask=i.stencilWriteMask,t.side=i.side,t.alphaToCoverage=i.alphaToCoverage,t.sampleCount=s,t.colorSpace=o,t.colorFormat=l,t.depthStencilFormat=u,t.primitiveTopology=c,t.clippingContextCacheKey=e.clippingContextCacheKey,h=!0),h}getRenderCacheKey(e){const{object:t,material:n}=e,i=this.utils,a=e.context;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,i.getSampleCountRenderContext(a),i.getCurrentColorSpace(a),i.getCurrentColorFormat(a),i.getCurrentDepthStencilFormat(a),i.getPrimitiveTopology(t,n),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}createSampler(e){this.textureUtils.createSampler(e)}destroySampler(e){this.textureUtils.destroySampler(e)}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,n,i,a,s){return this.textureUtils.copyTextureToBuffer(e,t,n,i,a,s)}initTimestampQuery(e,t){if(!this.trackTimestamp)return;const n=e.isComputeNode?"compute":"render";this.timestampQueryPool[n]||(this.timestampQueryPool[n]=new zge(this.device,n,2048));const i=this.timestampQueryPool[n],a=i.allocateQueriesForContext(e);t.timestampWrites={querySet:i.querySet,beginningOfPassWriteIndex:a,endOfPassWriteIndex:a+1}}createNodeBuilder(e,t){return new Lge(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const n=this.get(e),a=n.currentPass.finish();this.get(t).bundleGPU=a,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,n,i){this.bindingUtils.createBindings(e,t,n,i)}updateBindings(e,t,n,i){this.bindingUtils.createBindings(e,t,n,i)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(e){return this.device.features.has(e)}copyTextureToTexture(e,t,n=null,i=null,a=0,s=0){let o=0,l=0,u=0,c=0,h=0,d=0,f=e.image.width,p=e.image.height,m=1;n!==null&&(n.isBox3===!0?(c=n.min.x,h=n.min.y,d=n.min.z,f=n.max.x-n.min.x,p=n.max.y-n.min.y,m=n.max.z-n.min.z):(c=n.min.x,h=n.min.y,f=n.max.x-n.min.x,p=n.max.y-n.min.y,m=1)),i!==null&&(o=i.x,l=i.y,u=i.z||0);const v=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),g=this.get(e).texture,y=this.get(t).texture;v.copyTextureToTexture({texture:g,mipLevel:a,origin:{x:c,y:h,z:d}},{texture:y,mipLevel:s,origin:{x:o,y:l,z:u}},[f,p,m]),this.device.queue.submit([v.finish()]),s===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,n){const i=this.get(t);let a=null;t.renderTarget?e.isDepthTexture?a=this.get(t.depthTexture).texture:a=this.get(t.textures[0]).texture:e.isDepthTexture?a=this.textureUtils.getDepthBuffer(t.depth,t.stencil):a=this.context.getCurrentTexture();const s=this.get(e).texture;if(a.format!==s.format){console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",a.format,s.format);return}let o;if(i.currentPass?(i.currentPass.end(),o=i.encoder):o=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),o.copyTextureToTexture({texture:a,origin:[n.x,n.y,0]},{texture:s},[n.z,n.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e),i.currentPass){const{descriptor:l}=i;for(let u=0;u<l.colorAttachments.length;u++)l.colorAttachments[u].loadOp=vn.Load;if(t.depth&&(l.depthStencilAttachment.depthLoadOp=vn.Load),t.stencil&&(l.depthStencilAttachment.stencilLoadOp=vn.Load),i.currentPass=o.beginRenderPass(l),i.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor){const{x:u,y:c,width:h,height:d}=t.scissorValue;i.currentPass.setScissorRect(u,c,h,d)}}else this.device.queue.submit([o.finish()])}}class Hge extends xz{constructor(e,t,n,i,a,s){super(e,t,n,i,a,s),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class Wge extends j4{constructor(){super(),this.addMaterial(mhe,"MeshPhongMaterial"),this.addMaterial(R4,"MeshStandardMaterial"),this.addMaterial(cfe,"MeshPhysicalMaterial"),this.addMaterial(pfe,"MeshToonMaterial"),this.addMaterial(che,"MeshBasicMaterial"),this.addMaterial(ghe,"MeshLambertMaterial"),this.addMaterial(ihe,"MeshNormalMaterial"),this.addMaterial(yfe,"MeshMatcapMaterial"),this.addMaterial(Jce,"LineBasicMaterial"),this.addMaterial(the,"LineDashedMaterial"),this.addMaterial(Efe,"PointsMaterial"),this.addMaterial(P4,"SpriteMaterial"),this.addMaterial(Sfe,"ShadowMaterial"),this.addLight(Kde,oJ),this.addLight(Tpe,bz),this.addLight(wpe,uJ),this.addLight(X4,xz),this.addLight(Ape,Ez),this.addLight(Mpe,iJ),this.addLight(Cpe,hJ),this.addLight(Spe,Hge),this.addToneMapping(ade,tz),this.addToneMapping(sde,nz),this.addToneMapping(ode,rz),this.addToneMapping(ude,iz),this.addToneMapping(dde,az),this.addToneMapping(pde,sz)}}class qge extends Xpe{constructor(e={}){let t;e.forceWebGL?t=eU:(t=Vge,e.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new eU(e)));const n=new t(e);super(n,e),this.library=new Wge,this.isWebGPURenderer=!0}}const uw={type:"change"},qM={type:"start"},$M={type:"end"},oU=1e-6,Zt={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},eg=new He,xo=new He,$ge=new re,tg=new re,cw=new re,Wu=new Ua,lU=new re,ng=new re,hw=new re,rg=new re;class Xge extends pm{constructor(e,t=null){super(e,t),this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:Ar.ROTATE,MIDDLE:Ar.DOLLY,RIGHT:Ar.PAN},this.target=new re,this.state=Zt.NONE,this.keyState=Zt.NONE,this._lastPosition=new re,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new re,this._movePrev=new He,this._moveCurr=new He,this._lastAxis=new re,this._zoomStart=new He,this._zoomEnd=new He,this._panStart=new He,this._panEnd=new He,this._pointers=[],this._pointerPositions={},this._onPointerMove=jge.bind(this),this._onPointerDown=Yge.bind(this),this._onPointerUp=Kge.bind(this),this._onPointerCancel=Qge.bind(this),this._onContextMenu=ive.bind(this),this._onMouseWheel=rve.bind(this),this._onKeyDown=Jge.bind(this),this._onKeyUp=Zge.bind(this),this._onTouchStart=ave.bind(this),this._onTouchMove=sve.bind(this),this._onTouchEnd=ove.bind(this),this._onMouseDown=eve.bind(this),this._onMouseMove=tve.bind(this),this._onMouseUp=nve.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,t!==null&&(this.connect(t),this.handleResize()),this.update()}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>oU&&(this.dispatchEvent(uw),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>oU||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(uw),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=Zt.NONE,this.keyState=Zt.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(uw),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(xo.copy(this._panEnd).sub(this._panStart),xo.lengthSq()){if(this.object.isOrthographicCamera){const e=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,t=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;xo.x*=e,xo.y*=t}xo.multiplyScalar(this._eye.length()*this.panSpeed),tg.copy(this._eye).cross(this.object.up).setLength(xo.x),tg.add($ge.copy(this.object.up).setLength(xo.y)),this.object.position.add(tg),this.target.add(tg),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(xo.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){rg.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let e=rg.length();e?(this._eye.copy(this.object.position).sub(this.target),lU.copy(this._eye).normalize(),ng.copy(this.object.up).normalize(),hw.crossVectors(ng,lU).normalize(),ng.setLength(this._moveCurr.y-this._movePrev.y),hw.setLength(this._moveCurr.x-this._movePrev.x),rg.copy(ng.add(hw)),cw.crossVectors(rg,this._eye).normalize(),e*=this.rotateSpeed,Wu.setFromAxisAngle(cw,e),this._eye.applyQuaternion(Wu),this.object.up.applyQuaternion(Wu),this._lastAxis.copy(cw),this._lastAngle=e):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),Wu.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(Wu),this.object.up.applyQuaternion(Wu)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let e;this.state===Zt.TOUCH_ZOOM_PAN?(e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=tv.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,e!==1&&e>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom=tv.clamp(this.object.zoom/e,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(e,t){return eg.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),eg}_getMouseOnCircle(e,t){return eg.set((e-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-t))/this.screen.width),eg}_addPointer(e){this._pointers.push(e)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId==e.pointerId){this._pointers.splice(t,1);return}}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new He,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[t.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function Yge(r){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(r.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(r),r.pointerType==="touch"?this._onTouchStart(r):this._onMouseDown(r))}function jge(r){this.enabled!==!1&&(r.pointerType==="touch"?this._onTouchMove(r):this._onMouseMove(r))}function Kge(r){this.enabled!==!1&&(r.pointerType==="touch"?this._onTouchEnd(r):this._onMouseUp(),this._removePointer(r),this._pointers.length===0&&(this.domElement.releasePointerCapture(r.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function Qge(r){this._removePointer(r)}function Zge(){this.enabled!==!1&&(this.keyState=Zt.NONE,window.addEventListener("keydown",this._onKeyDown))}function Jge(r){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===Zt.NONE&&(r.code===this.keys[Zt.ROTATE]&&!this.noRotate?this.keyState=Zt.ROTATE:r.code===this.keys[Zt.ZOOM]&&!this.noZoom?this.keyState=Zt.ZOOM:r.code===this.keys[Zt.PAN]&&!this.noPan&&(this.keyState=Zt.PAN)))}function eve(r){let e;switch(r.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Ar.DOLLY:this.state=Zt.ZOOM;break;case Ar.ROTATE:this.state=Zt.ROTATE;break;case Ar.PAN:this.state=Zt.PAN;break;default:this.state=Zt.NONE}const t=this.keyState!==Zt.NONE?this.keyState:this.state;t===Zt.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(r.pageX,r.pageY)),this._movePrev.copy(this._moveCurr)):t===Zt.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(r.pageX,r.pageY)),this._zoomEnd.copy(this._zoomStart)):t===Zt.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(r.pageX,r.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(qM)}function tve(r){const e=this.keyState!==Zt.NONE?this.keyState:this.state;e===Zt.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(r.pageX,r.pageY))):e===Zt.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(r.pageX,r.pageY)):e===Zt.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(r.pageX,r.pageY))}function nve(){this.state=Zt.NONE,this.dispatchEvent($M)}function rve(r){if(this.enabled!==!1&&this.noZoom!==!0){switch(r.preventDefault(),r.deltaMode){case 2:this._zoomStart.y-=r.deltaY*.025;break;case 1:this._zoomStart.y-=r.deltaY*.01;break;default:this._zoomStart.y-=r.deltaY*25e-5;break}this.dispatchEvent(qM),this.dispatchEvent($M)}}function ive(r){this.enabled!==!1&&r.preventDefault()}function ave(r){switch(this._trackPointer(r),this._pointers.length){case 1:this.state=Zt.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=Zt.TOUCH_ZOOM_PAN;const e=this._pointers[0].pageX-this._pointers[1].pageX,t=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+t*t);const n=(this._pointers[0].pageX+this._pointers[1].pageX)/2,i=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(n,i)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(qM)}function sve(r){switch(this._trackPointer(r),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(r.pageX,r.pageY));break;default:const e=this._getSecondPointerPosition(r),t=r.pageX-e.x,n=r.pageY-e.y;this._touchZoomDistanceEnd=Math.sqrt(t*t+n*n);const i=(r.pageX+e.x)/2,a=(r.pageY+e.y)/2;this._panEnd.copy(this._getMouseOnScreen(i,a));break}}function ove(r){switch(this._pointers.length){case 0:this.state=Zt.NONE;break;case 1:this.state=Zt.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(r.pageX,r.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=Zt.TOUCH_ZOOM_PAN;for(let e=0;e<this._pointers.length;e++)if(this._pointers[e].pointerId!==r.pointerId){const t=this._pointerPositions[this._pointers[e].pointerId];this._moveCurr.copy(this._getMouseOnCircle(t.x,t.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent($M)}const uU={type:"change"},XM={type:"start"},a5={type:"end"},ig=new lm,cU=new Sa,lve=Math.cos(70*tv.DEG2RAD),Zn=new re,ai=2*Math.PI,ln={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},fw=1e-6;class uve extends pm{constructor(e,t=null){super(e,t),this.state=ln.NONE,this.target=new re,this.cursor=new re,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Ar.ROTATE,MIDDLE:Ar.DOLLY,RIGHT:Ar.PAN},this.touches={ONE:Fs.ROTATE,TWO:Fs.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new re,this._lastQuaternion=new Ua,this._lastTargetPosition=new re,this._quat=new Ua().setFromUnitVectors(e.up,new re(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new BO,this._sphericalDelta=new BO,this._scale=1,this._panOffset=new re,this._rotateStart=new He,this._rotateEnd=new He,this._rotateDelta=new He,this._panStart=new He,this._panEnd=new He,this._panDelta=new He,this._dollyStart=new He,this._dollyEnd=new He,this._dollyDelta=new He,this._dollyDirection=new re,this._mouse=new He,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=hve.bind(this),this._onPointerDown=cve.bind(this),this._onPointerUp=fve.bind(this),this._onContextMenu=_ve.bind(this),this._onMouseWheel=gve.bind(this),this._onKeyDown=vve.bind(this),this._onTouchStart=mve.bind(this),this._onTouchMove=yve.bind(this),this._onMouseDown=dve.bind(this),this._onMouseMove=pve.bind(this),this._interceptControlDown=xve.bind(this),this._interceptControlUp=bve.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(uU),this.update(),this.state=ln.NONE}update(e=null){const t=this.object.position;Zn.copy(t).sub(this.target),Zn.applyQuaternion(this._quat),this._spherical.setFromVector3(Zn),this.autoRotate&&this.state===ln.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,i=this.maxAzimuthAngle;isFinite(n)&&isFinite(i)&&(n<-Math.PI?n+=ai:n>Math.PI&&(n-=ai),i<-Math.PI?i+=ai:i>Math.PI&&(i-=ai),n<=i?this._spherical.theta=Math.max(n,Math.min(i,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+i)/2?Math.max(n,this._spherical.theta):Math.min(i,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let a=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const s=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),a=s!=this._spherical.radius}if(Zn.setFromSpherical(this._spherical),Zn.applyQuaternion(this._quatInverse),t.copy(this.target).add(Zn),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let s=null;if(this.object.isPerspectiveCamera){const o=Zn.length();s=this._clampDistance(o*this._scale);const l=o-s;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),a=!!l}else if(this.object.isOrthographicCamera){const o=new re(this._mouse.x,this._mouse.y,0);o.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),a=l!==this.object.zoom;const u=new re(this._mouse.x,this._mouse.y,0);u.unproject(this.object),this.object.position.sub(u).add(o),this.object.updateMatrixWorld(),s=Zn.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;s!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(s).add(this.object.position):(ig.origin.copy(this.object.position),ig.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(ig.direction))<lve?this.object.lookAt(this.target):(cU.setFromNormalAndCoplanarPoint(this.object.up,this.target),ig.intersectPlane(cU,this.target))))}else if(this.object.isOrthographicCamera){const s=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),s!==this.object.zoom&&(this.object.updateProjectionMatrix(),a=!0)}return this._scale=1,this._performCursorZoom=!1,a||this._lastPosition.distanceToSquared(this.object.position)>fw||8*(1-this._lastQuaternion.dot(this.object.quaternion))>fw||this._lastTargetPosition.distanceToSquared(this.target)>fw?(this.dispatchEvent(uU),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?ai/60*this.autoRotateSpeed*e:ai/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){Zn.setFromMatrixColumn(t,0),Zn.multiplyScalar(-e),this._panOffset.add(Zn)}_panUp(e,t){this.screenSpacePanning===!0?Zn.setFromMatrixColumn(t,1):(Zn.setFromMatrixColumn(t,0),Zn.crossVectors(this.object.up,Zn)),Zn.multiplyScalar(e),this._panOffset.add(Zn)}_pan(e,t){const n=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;Zn.copy(i).sub(this.target);let a=Zn.length();a*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*a/n.clientHeight,this.object.matrix),this._panUp(2*t*a/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),i=e-n.left,a=t-n.top,s=n.width,o=n.height;this._mouse.x=i/s*2-1,this._mouse.y=-(a/o)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(ai*this._rotateDelta.x/t.clientHeight),this._rotateUp(ai*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(ai*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-ai*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(ai*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-ai*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._rotateStart.set(n,i)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panStart.set(n,i)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,i=e.pageY-t.y,a=Math.sqrt(n*n+i*i);this._dollyStart.set(0,a)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const n=this._getSecondPointerPosition(e),i=.5*(e.pageX+n.x),a=.5*(e.pageY+n.y);this._rotateEnd.set(i,a)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(ai*this._rotateDelta.x/t.clientHeight),this._rotateUp(ai*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panEnd.set(n,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),n=e.pageX-t.x,i=e.pageY-t.y,a=Math.sqrt(n*n+i*i);this._dollyEnd.set(0,a),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const s=(e.pageX+t.x)*.5,o=(e.pageY+t.y)*.5;this._updateZoomParameters(s,o)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new He,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,n={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function cve(r){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(r.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(r)&&(this._addPointer(r),r.pointerType==="touch"?this._onTouchStart(r):this._onMouseDown(r)))}function hve(r){this.enabled!==!1&&(r.pointerType==="touch"?this._onTouchMove(r):this._onMouseMove(r))}function fve(r){switch(this._removePointer(r),this._pointers.length){case 0:this.domElement.releasePointerCapture(r.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(a5),this.state=ln.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function dve(r){let e;switch(r.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case Ar.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(r),this.state=ln.DOLLY;break;case Ar.ROTATE:if(r.ctrlKey||r.metaKey||r.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(r),this.state=ln.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(r),this.state=ln.ROTATE}break;case Ar.PAN:if(r.ctrlKey||r.metaKey||r.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(r),this.state=ln.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(r),this.state=ln.PAN}break;default:this.state=ln.NONE}this.state!==ln.NONE&&this.dispatchEvent(XM)}function pve(r){switch(this.state){case ln.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(r);break;case ln.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(r);break;case ln.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(r);break}}function gve(r){this.enabled===!1||this.enableZoom===!1||this.state!==ln.NONE||(r.preventDefault(),this.dispatchEvent(XM),this._handleMouseWheel(this._customWheelEvent(r)),this.dispatchEvent(a5))}function vve(r){this.enabled!==!1&&this._handleKeyDown(r)}function mve(r){switch(this._trackPointer(r),this._pointers.length){case 1:switch(this.touches.ONE){case Fs.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(r),this.state=ln.TOUCH_ROTATE;break;case Fs.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(r),this.state=ln.TOUCH_PAN;break;default:this.state=ln.NONE}break;case 2:switch(this.touches.TWO){case Fs.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(r),this.state=ln.TOUCH_DOLLY_PAN;break;case Fs.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(r),this.state=ln.TOUCH_DOLLY_ROTATE;break;default:this.state=ln.NONE}break;default:this.state=ln.NONE}this.state!==ln.NONE&&this.dispatchEvent(XM)}function yve(r){switch(this._trackPointer(r),this.state){case ln.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(r),this.update();break;case ln.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(r),this.update();break;case ln.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(r),this.update();break;case ln.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(r),this.update();break;default:this.state=ln.NONE}}function _ve(r){this.enabled!==!1&&r.preventDefault()}function xve(r){r.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function bve(r){r.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const Eve={type:"change"},hU=1e-6,fU=new Ua;class Tve extends pm{constructor(e,t=null){super(e,t),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new re(0,0,0),this._rotationVector=new re(0,0,0),this._lastQuaternion=new Ua,this._lastPosition=new re,this._status=0,this._onKeyDown=wve.bind(this),this._onKeyUp=Sve.bind(this),this._onPointerMove=Mve.bind(this),this._onPointerDown=Ave.bind(this),this._onPointerUp=Cve.bind(this),this._onPointerCancel=Rve.bind(this),this._onContextMenu=Nve.bind(this),t!==null&&this.connect(t)}connect(e){super.connect(e),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(e){if(this.enabled===!1)return;const t=this.object,n=e*this.movementSpeed,i=e*this.rollSpeed;t.translateX(this._moveVector.x*n),t.translateY(this._moveVector.y*n),t.translateZ(this._moveVector.z*n),fU.set(this._rotationVector.x*i,this._rotationVector.y*i,this._rotationVector.z*i,1).normalize(),t.quaternion.multiply(fU),(this._lastPosition.distanceToSquared(t.position)>hU||8*(1-this._lastQuaternion.dot(t.quaternion))>hU)&&(this.dispatchEvent(Eve),this._lastQuaternion.copy(t.quaternion),this._lastPosition.copy(t.position))}_updateMovementVector(){const e=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-e+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function wve(r){if(!(r.altKey||this.enabled===!1)){switch(r.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function Sve(r){if(this.enabled!==!1){switch(r.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function Ave(r){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(r.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function Mve(r){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const e=this._getContainerDimensions(),t=e.size[0]/2,n=e.size[1]/2;this._moveState.yawLeft=-(r.pageX-e.offset[0]-t)/t,this._moveState.pitchDown=(r.pageY-e.offset[1]-n)/n,this._updateRotationVector()}}function Cve(r){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(r.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function Rve(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function Nve(r){this.enabled!==!1&&r.preventDefault()}const Pve={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class Im{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const Dve=new Fd(-1,1,1,-1,0,1);class Lve extends ri{constructor(){super(),this.setAttribute("position",new kn([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new kn([0,2,0,0,2,0],2))}}const Ive=new Lve;class Ove{constructor(e){this._mesh=new Yn(Ive,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Dve)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Fve extends Im{constructor(e,t="tDiffuse"){super(),this.textureID=t,this.uniforms=null,this.material=null,e instanceof ss?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=fz.clone(e.uniforms),this.material=new ss({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this._fsQuad=new Ove(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this._fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this._fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this._fsQuad.render(e))}dispose(){this.material.dispose(),this._fsQuad.dispose()}}class dU extends Im{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const i=e.getContext(),a=e.state;a.buffers.color.setMask(!1),a.buffers.depth.setMask(!1),a.buffers.color.setLocked(!0),a.buffers.depth.setLocked(!0);let s,o;this.inverse?(s=0,o=1):(s=1,o=0),a.buffers.stencil.setTest(!0),a.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),a.buffers.stencil.setFunc(i.ALWAYS,s,4294967295),a.buffers.stencil.setClear(o),a.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),a.buffers.color.setLocked(!1),a.buffers.depth.setLocked(!1),a.buffers.color.setMask(!0),a.buffers.depth.setMask(!0),a.buffers.stencil.setLocked(!1),a.buffers.stencil.setFunc(i.EQUAL,1,4294967295),a.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),a.buffers.stencil.setLocked(!0)}}class Bve extends Im{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class Uve{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const n=e.getSize(new He);this._width=n.width,this._height=n.height,t=new Xo(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:kr}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Fve(Pve),this.copyPass.material.blending=_i,this.clock=new wz}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let i=0,a=this.passes.length;i<a;i++){const s=this.passes[i];if(s.enabled!==!1){if(s.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),s.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),s.needsSwap){if(n){const o=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}dU!==void 0&&(s instanceof dU?n=!0:s instanceof Bve&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new He);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let a=0;a<this.passes.length;a++)this.passes[a].setSize(n,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class kve extends Im{constructor(e,t,n=null,i=null,a=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=i,this.clearAlpha=a,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new ct}render(e,t,n){const i=e.autoClear;e.autoClear=!1;let a,s;this.overrideMaterial!==null&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor,e.getClearAlpha())),this.clearAlpha!==null&&(a=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(a),this.overrideMaterial!==null&&(this.scene.overrideMaterial=s),e.autoClear=i}}function wi(){return wi=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},wi.apply(null,arguments)}function Gve(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function ud(r,e){return ud=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},ud(r,e)}function zve(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,ud(r,e)}function mS(r){return mS=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},mS(r)}function Vve(r){try{return Function.toString.call(r).indexOf("[native code]")!==-1}catch{return typeof r=="function"}}function s5(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(s5=function(){return!!r})()}function Hve(r,e,t){if(s5())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var i=new(r.bind.apply(r,n));return t&&ud(i,t.prototype),i}function yS(r){var e=typeof Map=="function"?new Map:void 0;return yS=function(n){if(n===null||!Vve(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(n))return e.get(n);e.set(n,i)}function i(){return Hve(n,arguments,mS(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),ud(i,n)},yS(r)}var ns=function(r){zve(e,r);function e(t){var n;return n=r.call(this,"An error occurred. See https://github.com/styled-components/polished/blob/main/src/internalHelpers/errors.md#"+t+" for more information.")||this,Gve(n)}return e}(yS(Error));function dw(r){return Math.round(r*255)}function Wve(r,e,t){return dw(r)+","+dw(e)+","+dw(t)}function cd(r,e,t,n){if(n===void 0&&(n=Wve),e===0)return n(t,t,t);var i=(r%360+360)%360/60,a=(1-Math.abs(2*t-1))*e,s=a*(1-Math.abs(i%2-1)),o=0,l=0,u=0;i>=0&&i<1?(o=a,l=s):i>=1&&i<2?(o=s,l=a):i>=2&&i<3?(l=a,u=s):i>=3&&i<4?(l=s,u=a):i>=4&&i<5?(o=s,u=a):i>=5&&i<6&&(o=a,u=s);var c=t-a/2,h=o+c,d=l+c,f=u+c;return n(h,d,f)}var pU={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"639",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};function qve(r){if(typeof r!="string")return r;var e=r.toLowerCase();return pU[e]?"#"+pU[e]:r}var $ve=/^#[a-fA-F0-9]{6}$/,Xve=/^#[a-fA-F0-9]{8}$/,Yve=/^#[a-fA-F0-9]{3}$/,jve=/^#[a-fA-F0-9]{4}$/,pw=/^rgb\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*\)$/i,Kve=/^rgb(?:a)?\(\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,)?\s*(\d{1,3})\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i,Qve=/^hsl\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*\)$/i,Zve=/^hsl(?:a)?\(\s*(\d{0,3}[.]?[0-9]+(?:deg)?)\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,)?\s*(\d{1,3}[.]?[0-9]?)%\s*(?:,|\/)\s*([-+]?\d*[.]?\d+[%]?)\s*\)$/i;function eu(r){if(typeof r!="string")throw new ns(3);var e=qve(r);if(e.match($ve))return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16)};if(e.match(Xve)){var t=parseFloat((parseInt(""+e[7]+e[8],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[2],16),green:parseInt(""+e[3]+e[4],16),blue:parseInt(""+e[5]+e[6],16),alpha:t}}if(e.match(Yve))return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16)};if(e.match(jve)){var n=parseFloat((parseInt(""+e[4]+e[4],16)/255).toFixed(2));return{red:parseInt(""+e[1]+e[1],16),green:parseInt(""+e[2]+e[2],16),blue:parseInt(""+e[3]+e[3],16),alpha:n}}var i=pw.exec(e);if(i)return{red:parseInt(""+i[1],10),green:parseInt(""+i[2],10),blue:parseInt(""+i[3],10)};var a=Kve.exec(e.substring(0,50));if(a)return{red:parseInt(""+a[1],10),green:parseInt(""+a[2],10),blue:parseInt(""+a[3],10),alpha:parseFloat(""+a[4])>1?parseFloat(""+a[4])/100:parseFloat(""+a[4])};var s=Qve.exec(e);if(s){var o=parseInt(""+s[1],10),l=parseInt(""+s[2],10)/100,u=parseInt(""+s[3],10)/100,c="rgb("+cd(o,l,u)+")",h=pw.exec(c);if(!h)throw new ns(4,e,c);return{red:parseInt(""+h[1],10),green:parseInt(""+h[2],10),blue:parseInt(""+h[3],10)}}var d=Zve.exec(e.substring(0,50));if(d){var f=parseInt(""+d[1],10),p=parseInt(""+d[2],10)/100,m=parseInt(""+d[3],10)/100,v="rgb("+cd(f,p,m)+")",g=pw.exec(v);if(!g)throw new ns(4,e,v);return{red:parseInt(""+g[1],10),green:parseInt(""+g[2],10),blue:parseInt(""+g[3],10),alpha:parseFloat(""+d[4])>1?parseFloat(""+d[4])/100:parseFloat(""+d[4])}}throw new ns(5)}function Jve(r){var e=r.red/255,t=r.green/255,n=r.blue/255,i=Math.max(e,t,n),a=Math.min(e,t,n),s=(i+a)/2;if(i===a)return r.alpha!==void 0?{hue:0,saturation:0,lightness:s,alpha:r.alpha}:{hue:0,saturation:0,lightness:s};var o,l=i-a,u=s>.5?l/(2-i-a):l/(i+a);switch(i){case e:o=(t-n)/l+(t<n?6:0);break;case t:o=(n-e)/l+2;break;default:o=(e-t)/l+4;break}return o*=60,r.alpha!==void 0?{hue:o,saturation:u,lightness:s,alpha:r.alpha}:{hue:o,saturation:u,lightness:s}}function il(r){return Jve(eu(r))}var eme=function(e){return e.length===7&&e[1]===e[2]&&e[3]===e[4]&&e[5]===e[6]?"#"+e[1]+e[3]+e[5]:e},_S=eme;function Al(r){var e=r.toString(16);return e.length===1?"0"+e:e}function gw(r){return Al(Math.round(r*255))}function tme(r,e,t){return _S("#"+gw(r)+gw(e)+gw(t))}function gv(r,e,t){return cd(r,e,t,tme)}function nme(r,e,t){if(typeof r=="number"&&typeof e=="number"&&typeof t=="number")return gv(r,e,t);if(typeof r=="object"&&e===void 0&&t===void 0)return gv(r.hue,r.saturation,r.lightness);throw new ns(1)}function rme(r,e,t,n){if(typeof r=="number"&&typeof e=="number"&&typeof t=="number"&&typeof n=="number")return n>=1?gv(r,e,t):"rgba("+cd(r,e,t)+","+n+")";if(typeof r=="object"&&e===void 0&&t===void 0&&n===void 0)return r.alpha>=1?gv(r.hue,r.saturation,r.lightness):"rgba("+cd(r.hue,r.saturation,r.lightness)+","+r.alpha+")";throw new ns(2)}function xS(r,e,t){if(typeof r=="number"&&typeof e=="number"&&typeof t=="number")return _S("#"+Al(r)+Al(e)+Al(t));if(typeof r=="object"&&e===void 0&&t===void 0)return _S("#"+Al(r.red)+Al(r.green)+Al(r.blue));throw new ns(6)}function Om(r,e,t,n){if(typeof r=="string"&&typeof e=="number"){var i=eu(r);return"rgba("+i.red+","+i.green+","+i.blue+","+e+")"}else{if(typeof r=="number"&&typeof e=="number"&&typeof t=="number"&&typeof n=="number")return n>=1?xS(r,e,t):"rgba("+r+","+e+","+t+","+n+")";if(typeof r=="object"&&e===void 0&&t===void 0&&n===void 0)return r.alpha>=1?xS(r.red,r.green,r.blue):"rgba("+r.red+","+r.green+","+r.blue+","+r.alpha+")"}throw new ns(7)}var ime=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},ame=function(e){return typeof e.red=="number"&&typeof e.green=="number"&&typeof e.blue=="number"&&typeof e.alpha=="number"},sme=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&(typeof e.alpha!="number"||typeof e.alpha>"u")},ome=function(e){return typeof e.hue=="number"&&typeof e.saturation=="number"&&typeof e.lightness=="number"&&typeof e.alpha=="number"};function al(r){if(typeof r!="object")throw new ns(8);if(ame(r))return Om(r);if(ime(r))return xS(r);if(ome(r))return rme(r);if(sme(r))return nme(r);throw new ns(8)}function o5(r,e,t){return function(){var i=t.concat(Array.prototype.slice.call(arguments));return i.length>=e?r.apply(this,i):o5(r,e,i)}}function Hi(r){return o5(r,r.length,[])}function lme(r,e){if(e==="transparent")return e;var t=il(e);return al(wi({},t,{hue:t.hue+parseFloat(r)}))}Hi(lme);function gh(r,e,t){return Math.max(r,Math.min(e,t))}function ume(r,e){if(e==="transparent")return e;var t=il(e);return al(wi({},t,{lightness:gh(0,1,t.lightness-parseFloat(r))}))}Hi(ume);function cme(r,e){if(e==="transparent")return e;var t=il(e);return al(wi({},t,{saturation:gh(0,1,t.saturation-parseFloat(r))}))}Hi(cme);function hme(r,e){if(e==="transparent")return e;var t=il(e);return al(wi({},t,{lightness:gh(0,1,t.lightness+parseFloat(r))}))}Hi(hme);function fme(r,e,t){if(e==="transparent")return t;if(t==="transparent")return e;if(r===0)return t;var n=eu(e),i=wi({},n,{alpha:typeof n.alpha=="number"?n.alpha:1}),a=eu(t),s=wi({},a,{alpha:typeof a.alpha=="number"?a.alpha:1}),o=i.alpha-s.alpha,l=parseFloat(r)*2-1,u=l*o===-1?l:l+o,c=1+l*o,h=(u/c+1)/2,d=1-h,f={red:Math.floor(i.red*h+s.red*d),green:Math.floor(i.green*h+s.green*d),blue:Math.floor(i.blue*h+s.blue*d),alpha:i.alpha*parseFloat(r)+s.alpha*(1-parseFloat(r))};return Om(f)}var dme=Hi(fme),l5=dme;function pme(r,e){if(e==="transparent")return e;var t=eu(e),n=typeof t.alpha=="number"?t.alpha:1,i=wi({},t,{alpha:gh(0,1,(n*100+parseFloat(r)*100)/100)});return Om(i)}var gme=Hi(pme),vme=gme;function mme(r,e){if(e==="transparent")return e;var t=il(e);return al(wi({},t,{saturation:gh(0,1,t.saturation+parseFloat(r))}))}Hi(mme);function yme(r,e){return e==="transparent"?e:al(wi({},il(e),{hue:parseFloat(r)}))}Hi(yme);function _me(r,e){return e==="transparent"?e:al(wi({},il(e),{lightness:parseFloat(r)}))}Hi(_me);function xme(r,e){return e==="transparent"?e:al(wi({},il(e),{saturation:parseFloat(r)}))}Hi(xme);function bme(r,e){return e==="transparent"?e:l5(parseFloat(r),"rgb(0, 0, 0)",e)}Hi(bme);function Eme(r,e){return e==="transparent"?e:l5(parseFloat(r),"rgb(255, 255, 255)",e)}Hi(Eme);function Tme(r,e){if(e==="transparent")return e;var t=eu(e),n=typeof t.alpha=="number"?t.alpha:1,i=wi({},t,{alpha:gh(0,1,+(n*100-parseFloat(r)*100).toFixed(2)/100)});return Om(i)}Hi(Tme);var Gl=Object.freeze({Linear:Object.freeze({None:function(r){return r},In:function(r){return r},Out:function(r){return r},InOut:function(r){return r}}),Quadratic:Object.freeze({In:function(r){return r*r},Out:function(r){return r*(2-r)},InOut:function(r){return(r*=2)<1?.5*r*r:-.5*(--r*(r-2)-1)}}),Cubic:Object.freeze({In:function(r){return r*r*r},Out:function(r){return--r*r*r+1},InOut:function(r){return(r*=2)<1?.5*r*r*r:.5*((r-=2)*r*r+2)}}),Quartic:Object.freeze({In:function(r){return r*r*r*r},Out:function(r){return 1- --r*r*r*r},InOut:function(r){return(r*=2)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2)}}),Quintic:Object.freeze({In:function(r){return r*r*r*r*r},Out:function(r){return--r*r*r*r*r+1},InOut:function(r){return(r*=2)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2)}}),Sinusoidal:Object.freeze({In:function(r){return 1-Math.sin((1-r)*Math.PI/2)},Out:function(r){return Math.sin(r*Math.PI/2)},InOut:function(r){return .5*(1-Math.sin(Math.PI*(.5-r)))}}),Exponential:Object.freeze({In:function(r){return r===0?0:Math.pow(1024,r-1)},Out:function(r){return r===1?1:1-Math.pow(2,-10*r)},InOut:function(r){return r===0?0:r===1?1:(r*=2)<1?.5*Math.pow(1024,r-1):.5*(-Math.pow(2,-10*(r-1))+2)}}),Circular:Object.freeze({In:function(r){return 1-Math.sqrt(1-r*r)},Out:function(r){return Math.sqrt(1- --r*r)},InOut:function(r){return(r*=2)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1)}}),Elastic:Object.freeze({In:function(r){return r===0?0:r===1?1:-Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI)},Out:function(r){return r===0?0:r===1?1:Math.pow(2,-10*r)*Math.sin((r-.1)*5*Math.PI)+1},InOut:function(r){return r===0?0:r===1?1:(r*=2,r<1?-.5*Math.pow(2,10*(r-1))*Math.sin((r-1.1)*5*Math.PI):.5*Math.pow(2,-10*(r-1))*Math.sin((r-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(r){var e=1.70158;return r===1?1:r*r*((e+1)*r-e)},Out:function(r){var e=1.70158;return r===0?0:--r*r*((e+1)*r+e)+1},InOut:function(r){var e=2.5949095;return(r*=2)<1?.5*(r*r*((e+1)*r-e)):.5*((r-=2)*r*((e+1)*r+e)+2)}}),Bounce:Object.freeze({In:function(r){return 1-Gl.Bounce.Out(1-r)},Out:function(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},InOut:function(r){return r<.5?Gl.Bounce.In(r*2)*.5:Gl.Bounce.Out(r*2-1)*.5+.5}}),generatePow:function(r){return r===void 0&&(r=4),r=r<Number.EPSILON?Number.EPSILON:r,r=r>1e4?1e4:r,{In:function(e){return Math.pow(e,r)},Out:function(e){return 1-Math.pow(1-e,r)},InOut:function(e){return e<.5?Math.pow(e*2,r)/2:(1-Math.pow(2-e*2,r))/2+.5}}}}),uf=function(){return performance.now()},u5=function(){function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return r.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},r.prototype.removeAll=function(){this._tweens={}},r.prototype.add=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var i=0,a=t;i<a.length;i++){var s=a[i];(e=s._group)===null||e===void 0||e.remove(s),s._group=this,this._tweens[s.getId()]=s,this._tweensAddedDuringUpdate[s.getId()]=s}},r.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,i=e;n<i.length;n++){var a=i[n];a._group=void 0,delete this._tweens[a.getId()],delete this._tweensAddedDuringUpdate[a.getId()]}},r.prototype.allStopped=function(){return this.getAll().every(function(e){return!e.isPlaying()})},r.prototype.update=function(e,t){e===void 0&&(e=uf()),t===void 0&&(t=!0);var n=Object.keys(this._tweens);if(n.length!==0)for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<n.length;i++){var a=this._tweens[n[i]],s=!t;a&&a.update(e,s)===!1&&!t&&this.remove(a)}n=Object.keys(this._tweensAddedDuringUpdate)}},r}(),sc={Linear:function(r,e){var t=r.length-1,n=t*e,i=Math.floor(n),a=sc.Utils.Linear;return e<0?a(r[0],r[1],n):e>1?a(r[t],r[t-1],t-n):a(r[i],r[i+1>t?t:i+1],n-i)},Bezier:function(r,e){for(var t=0,n=r.length-1,i=Math.pow,a=sc.Utils.Bernstein,s=0;s<=n;s++)t+=i(1-e,n-s)*i(e,s)*r[s]*a(n,s);return t},CatmullRom:function(r,e){var t=r.length-1,n=t*e,i=Math.floor(n),a=sc.Utils.CatmullRom;return r[0]===r[t]?(e<0&&(i=Math.floor(n=t*(1+e))),a(r[(i-1+t)%t],r[i],r[(i+1)%t],r[(i+2)%t],n-i)):e<0?r[0]-(a(r[0],r[0],r[1],r[1],-n)-r[0]):e>1?r[t]-(a(r[t],r[t],r[t-1],r[t-1],n-t)-r[t]):a(r[i?i-1:0],r[i],r[t<i+1?t:i+1],r[t<i+2?t:i+2],n-i)},Utils:{Linear:function(r,e,t){return(e-r)*t+r},Bernstein:function(r,e){var t=sc.Utils.Factorial;return t(r)/t(e)/t(r-e)},Factorial:function(){var r=[1];return function(e){var t=1;if(r[e])return r[e];for(var n=e;n>1;n--)t*=n;return r[e]=t,t}}(),CatmullRom:function(r,e,t,n,i){var a=(t-r)*.5,s=(n-e)*.5,o=i*i,l=i*o;return(2*e-2*t+a+s)*l+(-3*e+3*t-2*a-s)*o+a*i+e}}},c5=function(){function r(){}return r.nextId=function(){return r._nextId++},r._nextId=0,r}(),bS=new u5,gU=function(){function r(e,t){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Gl.Linear.None,this._interpolationFunction=sc.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=c5.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,typeof t=="object"?(this._group=t,t.add(this)):t===!0&&(this._group=bS,bS.add(this))}return r.prototype.getId=function(){return this._id},r.prototype.isPlaying=function(){return this._isPlaying},r.prototype.isPaused=function(){return this._isPaused},r.prototype.getDuration=function(){return this._duration},r.prototype.to=function(e,t){if(t===void 0&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},r.prototype.duration=function(e){return e===void 0&&(e=1e3),this._duration=e<0?0:e,this},r.prototype.dynamic=function(e){return e===void 0&&(e=!1),this._isDynamic=e,this},r.prototype.start=function(e,t){if(e===void 0&&(e=uf()),t===void 0&&(t=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var n in this._valuesStartRepeat)this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var i={};for(var a in this._valuesEnd)i[a]=this._valuesEnd[a];this._valuesEnd=i}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},r.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},r.prototype._setupProperties=function(e,t,n,i,a){for(var s in n){var o=e[s],l=Array.isArray(o),u=l?"array":typeof o,c=!l&&Array.isArray(n[s]);if(!(u==="undefined"||u==="function")){if(c){var h=n[s];if(h.length===0)continue;for(var d=[o],f=0,p=h.length;f<p;f+=1){var m=this._handleRelativeValue(o,h[f]);if(isNaN(m)){c=!1,console.warn("Found invalid interpolation list. Skipping.");break}d.push(m)}c&&(n[s]=d)}if((u==="object"||l)&&o&&!c){t[s]=l?[]:{};var v=o;for(var g in v)t[s][g]=v[g];i[s]=l?[]:{};var h=n[s];if(!this._isDynamic){var y={};for(var g in h)y[g]=h[g];n[s]=h=y}this._setupProperties(v,t[s],h,i[s],a)}else(typeof t[s]>"u"||a)&&(t[s]=o),l||(t[s]*=1),c?i[s]=n[s].slice().reverse():i[s]=t[s]||0}}},r.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},r.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},r.prototype.pause=function(e){return e===void 0&&(e=uf()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=e,this)},r.prototype.resume=function(e){return e===void 0&&(e=uf()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this)},r.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},r.prototype.group=function(e){return e?(e.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},r.prototype.remove=function(){var e;return(e=this._group)===null||e===void 0||e.remove(this),this},r.prototype.delay=function(e){return e===void 0&&(e=0),this._delayTime=e,this},r.prototype.repeat=function(e){return e===void 0&&(e=0),this._initialRepeat=e,this._repeat=e,this},r.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},r.prototype.yoyo=function(e){return e===void 0&&(e=!1),this._yoyo=e,this},r.prototype.easing=function(e){return e===void 0&&(e=Gl.Linear.None),this._easingFunction=e,this},r.prototype.interpolation=function(e){return e===void 0&&(e=sc.Linear),this._interpolationFunction=e,this},r.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},r.prototype.onStart=function(e){return this._onStartCallback=e,this},r.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},r.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},r.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},r.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},r.prototype.onStop=function(e){return this._onStopCallback=e,this},r.prototype.update=function(e,t){var n=this,i;if(e===void 0&&(e=uf()),t===void 0&&(t=r.autoStartOnUpdate),this._isPaused)return!0;var a;if(!this._goToEnd&&!this._isPlaying)if(t)this.start(e,!0);else return!1;if(this._goToEnd=!1,e<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var s=e-this._startTime,o=this._duration+((i=this._repeatDelayTime)!==null&&i!==void 0?i:this._delayTime),l=this._duration+this._repeat*o,u=function(){if(n._duration===0||s>l)return 1;var m=Math.trunc(s/o),v=s-m*o,g=Math.min(v/n._duration,1);return g===0&&s===n._duration?1:g},c=u(),h=this._easingFunction(c);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,h),this._onUpdateCallback&&this._onUpdateCallback(this._object,c),this._duration===0||s>=this._duration)if(this._repeat>0){var d=Math.min(Math.trunc((s-this._duration)/o)+1,this._repeat);isFinite(this._repeat)&&(this._repeat-=d);for(a in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[a]=="string"&&(this._valuesStartRepeat[a]=this._valuesStartRepeat[a]+parseFloat(this._valuesEnd[a])),this._yoyo&&this._swapEndStartRepeatValues(a),this._valuesStart[a]=this._valuesStartRepeat[a];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=o*d,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var f=0,p=this._chainedTweens.length;f<p;f++)this._chainedTweens[f].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},r.prototype._updateProperties=function(e,t,n,i){for(var a in n)if(t[a]!==void 0){var s=t[a]||0,o=n[a],l=Array.isArray(e[a]),u=Array.isArray(o),c=!l&&u;c?e[a]=this._interpolationFunction(o,i):typeof o=="object"&&o?this._updateProperties(e[a],s,o,i):(o=this._handleRelativeValue(s,o),typeof o=="number"&&(e[a]=s+(o-s)*i))}},r.prototype._handleRelativeValue=function(e,t){return typeof t!="string"?t:t.charAt(0)==="+"||t.charAt(0)==="-"?e+parseFloat(t):parseFloat(t)},r.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],n=this._valuesEnd[e];typeof n=="string"?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(n):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},r.autoStartOnUpdate=!1,r}();c5.nextId;var us=bS;us.getAll.bind(us);us.removeAll.bind(us);us.add.bind(us);us.remove.bind(us);us.update.bind(us);var ES="http://www.w3.org/1999/xhtml";const vU={svg:"http://www.w3.org/2000/svg",xhtml:ES,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function h5(r){var e=r+="",t=e.indexOf(":");return t>=0&&(e=r.slice(0,t))!=="xmlns"&&(r=r.slice(t+1)),vU.hasOwnProperty(e)?{space:vU[e],local:r}:r}function wme(r){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===ES&&e.documentElement.namespaceURI===ES?e.createElement(r):e.createElementNS(t,r)}}function Sme(r){return function(){return this.ownerDocument.createElementNS(r.space,r.local)}}function f5(r){var e=h5(r);return(e.local?Sme:wme)(e)}function Ame(){}function d5(r){return r==null?Ame:function(){return this.querySelector(r)}}function Mme(r){typeof r!="function"&&(r=d5(r));for(var e=this._groups,t=e.length,n=new Array(t),i=0;i<t;++i)for(var a=e[i],s=a.length,o=n[i]=new Array(s),l,u,c=0;c<s;++c)(l=a[c])&&(u=r.call(l,l.__data__,c,a))&&("__data__"in l&&(u.__data__=l.__data__),o[c]=u);return new ha(n,this._parents)}function Cme(r){return r==null?[]:Array.isArray(r)?r:Array.from(r)}function Rme(){return[]}function Nme(r){return r==null?Rme:function(){return this.querySelectorAll(r)}}function Pme(r){return function(){return Cme(r.apply(this,arguments))}}function Dme(r){typeof r=="function"?r=Pme(r):r=Nme(r);for(var e=this._groups,t=e.length,n=[],i=[],a=0;a<t;++a)for(var s=e[a],o=s.length,l,u=0;u<o;++u)(l=s[u])&&(n.push(r.call(l,l.__data__,u,s)),i.push(l));return new ha(n,i)}function Lme(r){return function(){return this.matches(r)}}function p5(r){return function(e){return e.matches(r)}}var Ime=Array.prototype.find;function Ome(r){return function(){return Ime.call(this.children,r)}}function Fme(){return this.firstElementChild}function Bme(r){return this.select(r==null?Fme:Ome(typeof r=="function"?r:p5(r)))}var Ume=Array.prototype.filter;function kme(){return Array.from(this.children)}function Gme(r){return function(){return Ume.call(this.children,r)}}function zme(r){return this.selectAll(r==null?kme:Gme(typeof r=="function"?r:p5(r)))}function Vme(r){typeof r!="function"&&(r=Lme(r));for(var e=this._groups,t=e.length,n=new Array(t),i=0;i<t;++i)for(var a=e[i],s=a.length,o=n[i]=[],l,u=0;u<s;++u)(l=a[u])&&r.call(l,l.__data__,u,a)&&o.push(l);return new ha(n,this._parents)}function g5(r){return new Array(r.length)}function Hme(){return new ha(this._enter||this._groups.map(g5),this._parents)}function vv(r,e){this.ownerDocument=r.ownerDocument,this.namespaceURI=r.namespaceURI,this._next=null,this._parent=r,this.__data__=e}vv.prototype={constructor:vv,appendChild:function(r){return this._parent.insertBefore(r,this._next)},insertBefore:function(r,e){return this._parent.insertBefore(r,e)},querySelector:function(r){return this._parent.querySelector(r)},querySelectorAll:function(r){return this._parent.querySelectorAll(r)}};function Wme(r){return function(){return r}}function qme(r,e,t,n,i,a){for(var s=0,o,l=e.length,u=a.length;s<u;++s)(o=e[s])?(o.__data__=a[s],n[s]=o):t[s]=new vv(r,a[s]);for(;s<l;++s)(o=e[s])&&(i[s]=o)}function $me(r,e,t,n,i,a,s){var o,l,u=new Map,c=e.length,h=a.length,d=new Array(c),f;for(o=0;o<c;++o)(l=e[o])&&(d[o]=f=s.call(l,l.__data__,o,e)+"",u.has(f)?i[o]=l:u.set(f,l));for(o=0;o<h;++o)f=s.call(r,a[o],o,a)+"",(l=u.get(f))?(n[o]=l,l.__data__=a[o],u.delete(f)):t[o]=new vv(r,a[o]);for(o=0;o<c;++o)(l=e[o])&&u.get(d[o])===l&&(i[o]=l)}function Xme(r){return r.__data__}function Yme(r,e){if(!arguments.length)return Array.from(this,Xme);var t=e?$me:qme,n=this._parents,i=this._groups;typeof r!="function"&&(r=Wme(r));for(var a=i.length,s=new Array(a),o=new Array(a),l=new Array(a),u=0;u<a;++u){var c=n[u],h=i[u],d=h.length,f=jme(r.call(c,c&&c.__data__,u,n)),p=f.length,m=o[u]=new Array(p),v=s[u]=new Array(p),g=l[u]=new Array(d);t(c,h,m,v,g,f,e);for(var y=0,_=0,x,E;y<p;++y)if(x=m[y]){for(y>=_&&(_=y+1);!(E=v[_])&&++_<p;);x._next=E||null}}return s=new ha(s,n),s._enter=o,s._exit=l,s}function jme(r){return typeof r=="object"&&"length"in r?r:Array.from(r)}function Kme(){return new ha(this._exit||this._groups.map(g5),this._parents)}function Qme(r,e,t){var n=this.enter(),i=this,a=this.exit();return typeof r=="function"?(n=r(n),n&&(n=n.selection())):n=n.append(r+""),e!=null&&(i=e(i),i&&(i=i.selection())),t==null?a.remove():t(a),n&&i?n.merge(i).order():i}function Zme(r){for(var e=r.selection?r.selection():r,t=this._groups,n=e._groups,i=t.length,a=n.length,s=Math.min(i,a),o=new Array(i),l=0;l<s;++l)for(var u=t[l],c=n[l],h=u.length,d=o[l]=new Array(h),f,p=0;p<h;++p)(f=u[p]||c[p])&&(d[p]=f);for(;l<i;++l)o[l]=t[l];return new ha(o,this._parents)}function Jme(){for(var r=this._groups,e=-1,t=r.length;++e<t;)for(var n=r[e],i=n.length-1,a=n[i],s;--i>=0;)(s=n[i])&&(a&&s.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(s,a),a=s);return this}function eye(r){r||(r=tye);function e(h,d){return h&&d?r(h.__data__,d.__data__):!h-!d}for(var t=this._groups,n=t.length,i=new Array(n),a=0;a<n;++a){for(var s=t[a],o=s.length,l=i[a]=new Array(o),u,c=0;c<o;++c)(u=s[c])&&(l[c]=u);l.sort(e)}return new ha(i,this._parents).order()}function tye(r,e){return r<e?-1:r>e?1:r>=e?0:NaN}function nye(){var r=arguments[0];return arguments[0]=this,r.apply(null,arguments),this}function rye(){return Array.from(this)}function iye(){for(var r=this._groups,e=0,t=r.length;e<t;++e)for(var n=r[e],i=0,a=n.length;i<a;++i){var s=n[i];if(s)return s}return null}function aye(){let r=0;for(const e of this)++r;return r}function sye(){return!this.node()}function oye(r){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],a=0,s=i.length,o;a<s;++a)(o=i[a])&&r.call(o,o.__data__,a,i);return this}function lye(r){return function(){this.removeAttribute(r)}}function uye(r){return function(){this.removeAttributeNS(r.space,r.local)}}function cye(r,e){return function(){this.setAttribute(r,e)}}function hye(r,e){return function(){this.setAttributeNS(r.space,r.local,e)}}function fye(r,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(r):this.setAttribute(r,t)}}function dye(r,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(r.space,r.local):this.setAttributeNS(r.space,r.local,t)}}function pye(r,e){var t=h5(r);if(arguments.length<2){var n=this.node();return t.local?n.getAttributeNS(t.space,t.local):n.getAttribute(t)}return this.each((e==null?t.local?uye:lye:typeof e=="function"?t.local?dye:fye:t.local?hye:cye)(t,e))}function v5(r){return r.ownerDocument&&r.ownerDocument.defaultView||r.document&&r||r.defaultView}function gye(r){return function(){this.style.removeProperty(r)}}function vye(r,e,t){return function(){this.style.setProperty(r,e,t)}}function mye(r,e,t){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(r):this.style.setProperty(r,n,t)}}function yye(r,e,t){return arguments.length>1?this.each((e==null?gye:typeof e=="function"?mye:vye)(r,e,t==null?"":t)):_ye(this.node(),r)}function _ye(r,e){return r.style.getPropertyValue(e)||v5(r).getComputedStyle(r,null).getPropertyValue(e)}function xye(r){return function(){delete this[r]}}function bye(r,e){return function(){this[r]=e}}function Eye(r,e){return function(){var t=e.apply(this,arguments);t==null?delete this[r]:this[r]=t}}function Tye(r,e){return arguments.length>1?this.each((e==null?xye:typeof e=="function"?Eye:bye)(r,e)):this.node()[r]}function m5(r){return r.trim().split(/^|\s+/)}function YM(r){return r.classList||new y5(r)}function y5(r){this._node=r,this._names=m5(r.getAttribute("class")||"")}y5.prototype={add:function(r){var e=this._names.indexOf(r);e<0&&(this._names.push(r),this._node.setAttribute("class",this._names.join(" ")))},remove:function(r){var e=this._names.indexOf(r);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(r){return this._names.indexOf(r)>=0}};function _5(r,e){for(var t=YM(r),n=-1,i=e.length;++n<i;)t.add(e[n])}function x5(r,e){for(var t=YM(r),n=-1,i=e.length;++n<i;)t.remove(e[n])}function wye(r){return function(){_5(this,r)}}function Sye(r){return function(){x5(this,r)}}function Aye(r,e){return function(){(e.apply(this,arguments)?_5:x5)(this,r)}}function Mye(r,e){var t=m5(r+"");if(arguments.length<2){for(var n=YM(this.node()),i=-1,a=t.length;++i<a;)if(!n.contains(t[i]))return!1;return!0}return this.each((typeof e=="function"?Aye:e?wye:Sye)(t,e))}function Cye(){this.textContent=""}function Rye(r){return function(){this.textContent=r}}function Nye(r){return function(){var e=r.apply(this,arguments);this.textContent=e==null?"":e}}function Pye(r){return arguments.length?this.each(r==null?Cye:(typeof r=="function"?Nye:Rye)(r)):this.node().textContent}function Dye(){this.innerHTML=""}function Lye(r){return function(){this.innerHTML=r}}function Iye(r){return function(){var e=r.apply(this,arguments);this.innerHTML=e==null?"":e}}function Oye(r){return arguments.length?this.each(r==null?Dye:(typeof r=="function"?Iye:Lye)(r)):this.node().innerHTML}function Fye(){this.nextSibling&&this.parentNode.appendChild(this)}function Bye(){return this.each(Fye)}function Uye(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function kye(){return this.each(Uye)}function Gye(r){var e=typeof r=="function"?r:f5(r);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function zye(){return null}function Vye(r,e){var t=typeof r=="function"?r:f5(r),n=e==null?zye:typeof e=="function"?e:d5(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),n.apply(this,arguments)||null)})}function Hye(){var r=this.parentNode;r&&r.removeChild(this)}function Wye(){return this.each(Hye)}function qye(){var r=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(r,this.nextSibling):r}function $ye(){var r=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(r,this.nextSibling):r}function Xye(r){return this.select(r?$ye:qye)}function Yye(r){return arguments.length?this.property("__data__",r):this.node().__data__}function jye(r){return function(e){r.call(this,e,this.__data__)}}function Kye(r){return r.trim().split(/^|\s+/).map(function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}})}function Qye(r){return function(){var e=this.__on;if(!!e){for(var t=0,n=-1,i=e.length,a;t<i;++t)a=e[t],(!r.type||a.type===r.type)&&a.name===r.name?this.removeEventListener(a.type,a.listener,a.options):e[++n]=a;++n?e.length=n:delete this.__on}}}function Zye(r,e,t){return function(){var n=this.__on,i,a=jye(e);if(n){for(var s=0,o=n.length;s<o;++s)if((i=n[s]).type===r.type&&i.name===r.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=a,i.options=t),i.value=e;return}}this.addEventListener(r.type,a,t),i={type:r.type,name:r.name,value:e,listener:a,options:t},n?n.push(i):this.__on=[i]}}function Jye(r,e,t){var n=Kye(r+""),i,a=n.length,s;if(arguments.length<2){var o=this.node().__on;if(o){for(var l=0,u=o.length,c;l<u;++l)for(i=0,c=o[l];i<a;++i)if((s=n[i]).type===c.type&&s.name===c.name)return c.value}return}for(o=e?Zye:Qye,i=0;i<a;++i)this.each(o(n[i],e,t));return this}function b5(r,e,t){var n=v5(r),i=n.CustomEvent;typeof i=="function"?i=new i(e,t):(i=n.document.createEvent("Event"),t?(i.initEvent(e,t.bubbles,t.cancelable),i.detail=t.detail):i.initEvent(e,!1,!1)),r.dispatchEvent(i)}function e0e(r,e){return function(){return b5(this,r,e)}}function t0e(r,e){return function(){return b5(this,r,e.apply(this,arguments))}}function n0e(r,e){return this.each((typeof e=="function"?t0e:e0e)(r,e))}function*r0e(){for(var r=this._groups,e=0,t=r.length;e<t;++e)for(var n=r[e],i=0,a=n.length,s;i<a;++i)(s=n[i])&&(yield s)}var i0e=[null];function ha(r,e){this._groups=r,this._parents=e}function a0e(){return this}ha.prototype={constructor:ha,select:Mme,selectAll:Dme,selectChild:Bme,selectChildren:zme,filter:Vme,data:Yme,enter:Hme,exit:Kme,join:Qme,merge:Zme,selection:a0e,order:Jme,sort:eye,call:nye,nodes:rye,node:iye,size:aye,empty:sye,each:oye,attr:pye,style:yye,property:Tye,classed:Mye,text:Pye,html:Oye,raise:Bye,lower:kye,append:Gye,insert:Vye,remove:Wye,clone:Xye,datum:Yye,on:Jye,dispatch:n0e,[Symbol.iterator]:r0e};function s0e(r){return typeof r=="string"?new ha([[document.querySelector(r)]],[document.documentElement]):new ha([[r]],i0e)}function o0e(r){let e;for(;e=r.sourceEvent;)r=e;return r}function l0e(r,e){if(r=o0e(r),e===void 0&&(e=r.currentTarget),e){var t=e.ownerSVGElement||e;if(t.createSVGPoint){var n=t.createSVGPoint();return n.x=r.clientX,n.y=r.clientY,n=n.matrixTransform(e.getScreenCTM().inverse()),[n.x,n.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[r.clientX-i.left-e.clientLeft,r.clientY-i.top-e.clientTop]}}return[r.pageX,r.pageY]}var Wd,Sn,E5,T5,Ll,mU,w5,S5,A5,jM,TS,wS,hd={},M5=[],u0e=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Fm=Array.isArray;function rs(r,e){for(var t in e)r[t]=e[t];return r}function KM(r){r&&r.parentNode&&r.parentNode.removeChild(r)}function c0e(r,e,t){var n,i,a,s={};for(a in e)a=="key"?n=e[a]:a=="ref"?i=e[a]:s[a]=e[a];if(arguments.length>2&&(s.children=arguments.length>3?Wd.call(arguments,2):t),typeof r=="function"&&r.defaultProps!=null)for(a in r.defaultProps)s[a]==null&&(s[a]=r.defaultProps[a]);return Tf(r,s,n,i,null)}function Tf(r,e,t,n,i){var a={type:r,props:e,key:t,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i==null?++E5:i,__i:-1,__u:0};return i==null&&Sn.vnode!=null&&Sn.vnode(a),a}function Bm(r){return r.children}function Lg(r,e){this.props=r,this.context=e}function Yc(r,e){if(e==null)return r.__?Yc(r.__,r.__i+1):null;for(var t;e<r.__k.length;e++)if((t=r.__k[e])!=null&&t.__e!=null)return t.__e;return typeof r.type=="function"?Yc(r):null}function C5(r){var e,t;if((r=r.__)!=null&&r.__c!=null){for(r.__e=r.__c.base=null,e=0;e<r.__k.length;e++)if((t=r.__k[e])!=null&&t.__e!=null){r.__e=r.__c.base=t.__e;break}return C5(r)}}function yU(r){(!r.__d&&(r.__d=!0)&&Ll.push(r)&&!mv.__r++||mU!=Sn.debounceRendering)&&((mU=Sn.debounceRendering)||w5)(mv)}function mv(){for(var r,e,t,n,i,a,s,o=1;Ll.length;)Ll.length>o&&Ll.sort(S5),r=Ll.shift(),o=Ll.length,r.__d&&(t=void 0,i=(n=(e=r).__v).__e,a=[],s=[],e.__P&&((t=rs({},n)).__v=n.__v+1,Sn.vnode&&Sn.vnode(t),QM(e.__P,t,n,e.__n,e.__P.namespaceURI,32&n.__u?[i]:null,a,i==null?Yc(n):i,!!(32&n.__u),s),t.__v=n.__v,t.__.__k[t.__i]=t,P5(a,t,s),t.__e!=i&&C5(t)));mv.__r=0}function R5(r,e,t,n,i,a,s,o,l,u,c){var h,d,f,p,m,v,g=n&&n.__k||M5,y=e.length;for(l=h0e(t,e,g,l,y),h=0;h<y;h++)(f=t.__k[h])!=null&&(d=f.__i==-1?hd:g[f.__i]||hd,f.__i=h,v=QM(r,f,d,i,a,s,o,l,u,c),p=f.__e,f.ref&&d.ref!=f.ref&&(d.ref&&ZM(d.ref,null,f),c.push(f.ref,f.__c||p,f)),m==null&&p!=null&&(m=p),4&f.__u||d.__k===f.__k?l=N5(f,l,r):typeof f.type=="function"&&v!==void 0?l=v:p&&(l=p.nextSibling),f.__u&=-7);return t.__e=m,l}function h0e(r,e,t,n,i){var a,s,o,l,u,c=t.length,h=c,d=0;for(r.__k=new Array(i),a=0;a<i;a++)(s=e[a])!=null&&typeof s!="boolean"&&typeof s!="function"?(l=a+d,(s=r.__k[a]=typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?Tf(null,s,null,null,null):Fm(s)?Tf(Bm,{children:s},null,null,null):s.constructor==null&&s.__b>0?Tf(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s).__=r,s.__b=r.__b+1,o=null,(u=s.__i=f0e(s,t,l,h))!=-1&&(h--,(o=t[u])&&(o.__u|=2)),o==null||o.__v==null?(u==-1&&(i>c?d--:i<c&&d++),typeof s.type!="function"&&(s.__u|=4)):u!=l&&(u==l-1?d--:u==l+1?d++:(u>l?d--:d++,s.__u|=4))):r.__k[a]=null;if(h)for(a=0;a<c;a++)(o=t[a])!=null&&(2&o.__u)==0&&(o.__e==n&&(n=Yc(o)),L5(o,o));return n}function N5(r,e,t){var n,i;if(typeof r.type=="function"){for(n=r.__k,i=0;n&&i<n.length;i++)n[i]&&(n[i].__=r,e=N5(n[i],e,t));return e}r.__e!=e&&(e&&r.type&&!t.contains(e)&&(e=Yc(r)),t.insertBefore(r.__e,e||null),e=r.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function f0e(r,e,t,n){var i,a,s=r.key,o=r.type,l=e[t];if(l===null&&r.key==null||l&&s==l.key&&o==l.type&&(2&l.__u)==0)return t;if(n>(l!=null&&(2&l.__u)==0?1:0))for(i=t-1,a=t+1;i>=0||a<e.length;){if(i>=0){if((l=e[i])&&(2&l.__u)==0&&s==l.key&&o==l.type)return i;i--}if(a<e.length){if((l=e[a])&&(2&l.__u)==0&&s==l.key&&o==l.type)return a;a++}}return-1}function _U(r,e,t){e[0]=="-"?r.setProperty(e,t==null?"":t):r[e]=t==null?"":typeof t!="number"||u0e.test(e)?t:t+"px"}function ag(r,e,t,n,i){var a;e:if(e=="style")if(typeof t=="string")r.style.cssText=t;else{if(typeof n=="string"&&(r.style.cssText=n=""),n)for(e in n)t&&e in t||_U(r.style,e,"");if(t)for(e in t)n&&t[e]==n[e]||_U(r.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")a=e!=(e=e.replace(A5,"$1")),e=e.toLowerCase()in r||e=="onFocusOut"||e=="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),r.l||(r.l={}),r.l[e+a]=t,t?n?t.u=n.u:(t.u=jM,r.addEventListener(e,a?wS:TS,a)):r.removeEventListener(e,a?wS:TS,a);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in r)try{r[e]=t==null?"":t;break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?r.removeAttribute(e):r.setAttribute(e,e=="popover"&&t==1?"":t))}}function xU(r){return function(e){if(this.l){var t=this.l[e.type+r];if(e.t==null)e.t=jM++;else if(e.t<t.u)return;return t(Sn.event?Sn.event(e):e)}}}function QM(r,e,t,n,i,a,s,o,l,u){var c,h,d,f,p,m,v,g,y,_,x,E,T,b,w,A,S,C=e.type;if(e.constructor!=null)return null;128&t.__u&&(l=!!(32&t.__u),a=[o=e.__e=t.__e]),(c=Sn.__b)&&c(e);e:if(typeof C=="function")try{if(g=e.props,y="prototype"in C&&C.prototype.render,_=(c=C.contextType)&&n[c.__c],x=c?_?_.props.value:c.__:n,t.__c?v=(h=e.__c=t.__c).__=h.__E:(y?e.__c=h=new C(g,x):(e.__c=h=new Lg(g,x),h.constructor=C,h.render=p0e),_&&_.sub(h),h.props=g,h.state||(h.state={}),h.context=x,h.__n=n,d=h.__d=!0,h.__h=[],h._sb=[]),y&&h.__s==null&&(h.__s=h.state),y&&C.getDerivedStateFromProps!=null&&(h.__s==h.state&&(h.__s=rs({},h.__s)),rs(h.__s,C.getDerivedStateFromProps(g,h.__s))),f=h.props,p=h.state,h.__v=e,d)y&&C.getDerivedStateFromProps==null&&h.componentWillMount!=null&&h.componentWillMount(),y&&h.componentDidMount!=null&&h.__h.push(h.componentDidMount);else{if(y&&C.getDerivedStateFromProps==null&&g!==f&&h.componentWillReceiveProps!=null&&h.componentWillReceiveProps(g,x),!h.__e&&h.shouldComponentUpdate!=null&&h.shouldComponentUpdate(g,h.__s,x)===!1||e.__v==t.__v){for(e.__v!=t.__v&&(h.props=g,h.state=h.__s,h.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(R){R&&(R.__=e)}),E=0;E<h._sb.length;E++)h.__h.push(h._sb[E]);h._sb=[],h.__h.length&&s.push(h);break e}h.componentWillUpdate!=null&&h.componentWillUpdate(g,h.__s,x),y&&h.componentDidUpdate!=null&&h.__h.push(function(){h.componentDidUpdate(f,p,m)})}if(h.context=x,h.props=g,h.__P=r,h.__e=!1,T=Sn.__r,b=0,y){for(h.state=h.__s,h.__d=!1,T&&T(e),c=h.render(h.props,h.state,h.context),w=0;w<h._sb.length;w++)h.__h.push(h._sb[w]);h._sb=[]}else do h.__d=!1,T&&T(e),c=h.render(h.props,h.state,h.context),h.state=h.__s;while(h.__d&&++b<25);h.state=h.__s,h.getChildContext!=null&&(n=rs(rs({},n),h.getChildContext())),y&&!d&&h.getSnapshotBeforeUpdate!=null&&(m=h.getSnapshotBeforeUpdate(f,p)),A=c,c!=null&&c.type===Bm&&c.key==null&&(A=D5(c.props.children)),o=R5(r,Fm(A)?A:[A],e,t,n,i,a,s,o,l,u),h.base=e.__e,e.__u&=-161,h.__h.length&&s.push(h),v&&(h.__E=h.__=null)}catch(R){if(e.__v=null,l||a!=null)if(R.then){for(e.__u|=l?160:128;o&&o.nodeType==8&&o.nextSibling;)o=o.nextSibling;a[a.indexOf(o)]=null,e.__e=o}else for(S=a.length;S--;)KM(a[S]);else e.__e=t.__e,e.__k=t.__k;Sn.__e(R,e,t)}else a==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):o=e.__e=d0e(t.__e,e,t,n,i,a,s,l,u);return(c=Sn.diffed)&&c(e),128&e.__u?void 0:o}function P5(r,e,t){for(var n=0;n<t.length;n++)ZM(t[n],t[++n],t[++n]);Sn.__c&&Sn.__c(e,r),r.some(function(i){try{r=i.__h,i.__h=[],r.some(function(a){a.call(i)})}catch(a){Sn.__e(a,i.__v)}})}function D5(r){return typeof r!="object"||r==null||r.__b&&r.__b>0?r:Fm(r)?r.map(D5):rs({},r)}function d0e(r,e,t,n,i,a,s,o,l){var u,c,h,d,f,p,m,v=t.props,g=e.props,y=e.type;if(y=="svg"?i="http://www.w3.org/2000/svg":y=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),a!=null){for(u=0;u<a.length;u++)if((f=a[u])&&"setAttribute"in f==!!y&&(y?f.localName==y:f.nodeType==3)){r=f,a[u]=null;break}}if(r==null){if(y==null)return document.createTextNode(g);r=document.createElementNS(i,y,g.is&&g),o&&(Sn.__m&&Sn.__m(e,a),o=!1),a=null}if(y==null)v===g||o&&r.data==g||(r.data=g);else{if(a=a&&Wd.call(r.childNodes),v=t.props||hd,!o&&a!=null)for(v={},u=0;u<r.attributes.length;u++)v[(f=r.attributes[u]).name]=f.value;for(u in v)if(f=v[u],u!="children"){if(u=="dangerouslySetInnerHTML")h=f;else if(!(u in g)){if(u=="value"&&"defaultValue"in g||u=="checked"&&"defaultChecked"in g)continue;ag(r,u,null,f,i)}}for(u in g)f=g[u],u=="children"?d=f:u=="dangerouslySetInnerHTML"?c=f:u=="value"?p=f:u=="checked"?m=f:o&&typeof f!="function"||v[u]===f||ag(r,u,f,v[u],i);if(c)o||h&&(c.__html==h.__html||c.__html==r.innerHTML)||(r.innerHTML=c.__html),e.__k=[];else if(h&&(r.innerHTML=""),R5(e.type=="template"?r.content:r,Fm(d)?d:[d],e,t,n,y=="foreignObject"?"http://www.w3.org/1999/xhtml":i,a,s,a?a[0]:t.__k&&Yc(t,0),o,l),a!=null)for(u=a.length;u--;)KM(a[u]);o||(u="value",y=="progress"&&p==null?r.removeAttribute("value"):p!=null&&(p!==r[u]||y=="progress"&&!p||y=="option"&&p!=v[u])&&ag(r,u,p,v[u],i),u="checked",m!=null&&m!=r[u]&&ag(r,u,m,v[u],i))}return r}function ZM(r,e,t){try{if(typeof r=="function"){var n=typeof r.__u=="function";n&&r.__u(),n&&e==null||(r.__u=r(e))}else r.current=e}catch(i){Sn.__e(i,t)}}function L5(r,e,t){var n,i;if(Sn.unmount&&Sn.unmount(r),(n=r.ref)&&(n.current&&n.current!=r.__e||ZM(n,null,e)),(n=r.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(a){Sn.__e(a,e)}n.base=n.__P=null}if(n=r.__k)for(i=0;i<n.length;i++)n[i]&&L5(n[i],e,t||typeof r.type!="function");t||KM(r.__e),r.__c=r.__=r.__e=void 0}function p0e(r,e,t){return this.constructor(r,t)}function g0e(r,e,t){var n,i,a,s;e==document&&(e=document.documentElement),Sn.__&&Sn.__(r,e),i=(n=typeof t=="function")?null:t&&t.__k||e.__k,a=[],s=[],QM(e,r=(!n&&t||e).__k=c0e(Bm,null,[r]),i||hd,hd,e.namespaceURI,!n&&t?[t]:i?null:e.firstChild?Wd.call(e.childNodes):null,a,!n&&t?t:i?i.__e:e.firstChild,n,s),P5(a,r,s)}function I5(r,e,t){var n,i,a,s,o=rs({},r.props);for(a in r.type&&r.type.defaultProps&&(s=r.type.defaultProps),e)a=="key"?n=e[a]:a=="ref"?i=e[a]:o[a]=e[a]==null&&s!=null?s[a]:e[a];return arguments.length>2&&(o.children=arguments.length>3?Wd.call(arguments,2):t),Tf(r.type,o,n||r.key,i||r.ref,null)}Wd=M5.slice,Sn={__e:function(r,e,t,n){for(var i,a,s;e=e.__;)if((i=e.__c)&&!i.__)try{if((a=i.constructor)&&a.getDerivedStateFromError!=null&&(i.setState(a.getDerivedStateFromError(r)),s=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(r,n||{}),s=i.__d),s)return i.__E=i}catch(o){r=o}throw r}},E5=0,T5=function(r){return r!=null&&r.constructor==null},Lg.prototype.setState=function(r,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=rs({},this.state),typeof r=="function"&&(r=r(rs({},t),this.props)),r&&rs(t,r),r!=null&&this.__v&&(e&&this._sb.push(e),yU(this))},Lg.prototype.forceUpdate=function(r){this.__v&&(this.__e=!0,r&&this.__h.push(r),yU(this))},Lg.prototype.render=Bm,Ll=[],w5=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,S5=function(r,e){return r.__v.__b-e.__v.__b},mv.__r=0,A5=/(PointerCapture)$|Capture$/i,jM=0,TS=xU(!1),wS=xU(!0);function bU(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=Array(e);t<e;t++)n[t]=r[t];return n}function v0e(r){if(Array.isArray(r))return r}function m0e(r,e,t){return(e=T0e(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function y0e(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var n,i,a,s,o=[],l=!0,u=!1;try{if(a=(t=t.call(r)).next,e!==0)for(;!(l=(n=a.call(t)).done)&&(o.push(n.value),o.length!==e);l=!0);}catch(c){u=!0,i=c}finally{try{if(!l&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(u)throw i}}return o}}function _0e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EU(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function x0e(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?EU(Object(t),!0).forEach(function(n){m0e(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):EU(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function b0e(r,e){return v0e(r)||y0e(r,e)||w0e(r,e)||_0e()}function E0e(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function T0e(r){var e=E0e(r,"string");return typeof e=="symbol"?e:e+""}function yv(r){return yv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yv(r)}function w0e(r,e){if(r){if(typeof r=="string")return bU(r,e);var t={}.toString.call(r).slice(8,-1);return t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set"?Array.from(r):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?bU(r,e):void 0}}var SS=function(e){if(yv(e)!=="object")return e;var t=I5(e);if(t.props){var n;t.props=x0e({},t.props),t!=null&&(n=t.props)!==null&&n!==void 0&&n.children&&(t.props.children=Array.isArray(t.props.children)?t.props.children.map(SS):SS(t.props.children))}return t},S0e=function(e){return T5(I5(e))},A0e=function(e,t){delete t.__k,g0e(SS(e),t)};function M0e(r,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=r:i.appendChild(document.createTextNode(r))}}var C0e=`.float-tooltip-kap {
  position: absolute;
  width: max-content; /* prevent shrinking near right edge */
  max-width: max(50%, 150px);
  padding: 3px 5px;
  border-radius: 3px;
  font: 12px sans-serif;
  color: #eee;
  background: rgba(0,0,0,0.6);
  pointer-events: none;
}
`;M0e(C0e);var R0e=vm({props:{content:{default:!1},offsetX:{triggerUpdate:!1},offsetY:{triggerUpdate:!1}},init:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=n.style,a=i===void 0?{}:i,s=!!e&&yv(e)==="object"&&!!e.node&&typeof e.node=="function",o=s0e(s?e.node():e);o.style("position")==="static"&&o.style("position","relative"),t.tooltipEl=o.append("div").attr("class","float-tooltip-kap"),Object.entries(a).forEach(function(u){var c=b0e(u,2),h=c[0],d=c[1];return t.tooltipEl.style(h,d)}),t.tooltipEl.style("left","-10000px").style("display","none");var l="tooltip-".concat(Math.round(Math.random()*1e12));t.mouseInside=!1,o.on("mousemove.".concat(l),function(u){t.mouseInside=!0;var c=l0e(u),h=o.node(),d=h.offsetWidth,f=h.offsetHeight,p=[t.offsetX===null||t.offsetX===void 0?"-".concat(c[0]/d*100,"%"):typeof t.offsetX=="number"?"calc(-50% + ".concat(t.offsetX,"px)"):t.offsetX,t.offsetY===null||t.offsetY===void 0?f>130&&f-c[1]<100?"calc(-100% - 6px)":"21px":typeof t.offsetY=="number"?t.offsetY<0?"calc(-100% - ".concat(Math.abs(t.offsetY),"px)"):"".concat(t.offsetY,"px"):t.offsetY];t.tooltipEl.style("left",c[0]+"px").style("top",c[1]+"px").style("transform","translate(".concat(p.join(","),")")),t.content&&t.tooltipEl.style("display","inline")}),o.on("mouseover.".concat(l),function(){t.mouseInside=!0,t.content&&t.tooltipEl.style("display","inline")}),o.on("mouseout.".concat(l),function(){t.mouseInside=!1,t.tooltipEl.style("display","none")})},update:function(e){e.tooltipEl.style("display",!!e.content&&e.mouseInside?"inline":"none"),e.content?e.content instanceof HTMLElement?(e.tooltipEl.text(""),e.tooltipEl.append(function(){return e.content})):typeof e.content=="string"?e.tooltipEl.html(e.content):S0e(e.content)?(e.tooltipEl.text(""),A0e(e.content,e.tooltipEl.node())):(e.tooltipEl.style("display","none"),console.warn("Tooltip content is invalid, skipping.",e.content,e.content.toString())):e.tooltipEl.text("")}});function N0e(r,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=r:i.appendChild(document.createTextNode(r))}}var P0e=`.scene-nav-info {
  position: absolute;
  bottom: 5px;
  width: 100%;
  text-align: center;
  color: slategrey;
  opacity: 0.7;
  font-size: 10px;
  font-family: sans-serif;
  pointer-events: none;
  user-select: none;
}

.scene-container canvas:focus {
  outline: none;
}`;N0e(P0e);function AS(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=Array(e);t<e;t++)n[t]=r[t];return n}function D0e(r){if(Array.isArray(r))return r}function L0e(r){if(Array.isArray(r))return AS(r)}function I0e(r,e,t){return(e=z0e(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function O0e(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function F0e(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var n,i,a,s,o=[],l=!0,u=!1;try{if(a=(t=t.call(r)).next,e!==0)for(;!(l=(n=a.call(t)).done)&&(o.push(n.value),o.length!==e);l=!0);}catch(c){u=!0,i=c}finally{try{if(!l&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(u)throw i}}return o}}function B0e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function U0e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function k0e(r,e){return D0e(r)||F0e(r,e)||O5(r,e)||B0e()}function yl(r){return L0e(r)||O0e(r)||O5(r)||U0e()}function G0e(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function z0e(r){var e=G0e(r,"string");return typeof e=="symbol"?e:e+""}function O5(r,e){if(r){if(typeof r=="string")return AS(r,e);var t={}.toString.call(r).slice(8,-1);return t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set"?Array.from(r):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?AS(r,e):void 0}}var Tn=window.THREE?window.THREE:{WebGLRenderer:jre,Scene:cm,PerspectiveCamera:yr,Raycaster:Sz,SRGBColorSpace:ft,TextureLoader:rJ,Vector2:He,Vector3:re,Box3:lu,Color:ct,Mesh:Yn,SphereGeometry:Od,MeshBasicMaterial:Za,BackSide:dn,Clock:wz},F5=vm({props:{width:{default:window.innerWidth,onChange:function(e,t,n){isNaN(e)&&(t.width=n)}},height:{default:window.innerHeight,onChange:function(e,t,n){isNaN(e)&&(t.height=n)}},viewOffset:{default:[0,0]},backgroundColor:{default:"#000011"},backgroundImageUrl:{},onBackgroundImageLoaded:{},showNavInfo:{default:!0},skyRadius:{default:5e4},objects:{default:[]},lights:{default:[]},enablePointerInteraction:{default:!0,onChange:function(e,t){t.hoverObj=null,t.tooltip&&t.tooltip.content(null)},triggerUpdate:!1},pointerRaycasterThrottleMs:{default:50,triggerUpdate:!1},lineHoverPrecision:{default:1,triggerUpdate:!1},pointsHoverPrecision:{default:1,triggerUpdate:!1},hoverOrderComparator:{triggerUpdate:!1},hoverFilter:{default:function(){return!0},triggerUpdate:!1},tooltipContent:{triggerUpdate:!1},hoverDuringDrag:{default:!1,triggerUpdate:!1},clickAfterDrag:{default:!1,triggerUpdate:!1},onHover:{default:function(){},triggerUpdate:!1},onClick:{default:function(){},triggerUpdate:!1},onRightClick:{triggerUpdate:!1}},methods:{tick:function(e){if(e.initialised){e.controls.update&&e.controls.update(Math.min(1,e.clock.getDelta())),e.postProcessingComposer?e.postProcessingComposer.render():e.renderer.render(e.scene,e.camera),e.extraRenderers.forEach(function(s){return s.render(e.scene,e.camera)});var t=+new Date;if(e.enablePointerInteraction&&t-e.lastRaycasterCheck>=e.pointerRaycasterThrottleMs){e.lastRaycasterCheck=t;var n=null;if(e.hoverDuringDrag||!e.isPointerDragging){var i=this.intersectingObjects(e.pointerPos.x,e.pointerPos.y);e.hoverOrderComparator&&i.sort(function(s,o){return e.hoverOrderComparator(s.object,o.object)});var a=i.find(function(s){return e.hoverFilter(s.object)})||null;n=a?a.object:null,e.intersection=a||null}n!==e.hoverObj&&(e.onHover(n,e.hoverObj,e.intersection),e.tooltip.content(n&&Ht(e.tooltipContent)(n,e.intersection)||null),e.hoverObj=n)}e.tweenGroup.update()}return this},getPointerPos:function(e){var t=e.pointerPos,n=t.x,i=t.y;return{x:n,y:i}},cameraPosition:function(e,t,n,i){var a=e.camera;if(t&&e.initialised){var s=t,o=n||{x:0,y:0,z:0};if(!i)c(s),h(o);else{var l=Object.assign({},a.position),u=d();e.tweenGroup.add(new gU(l).to(s,i).easing(Gl.Quadratic.Out).onUpdate(c).start()),e.tweenGroup.add(new gU(u).to(o,i/3).easing(Gl.Quadratic.Out).onUpdate(h).start())}return this}return Object.assign({},a.position,{lookAt:d()});function c(f){var p=f.x,m=f.y,v=f.z;p!==void 0&&(a.position.x=p),m!==void 0&&(a.position.y=m),v!==void 0&&(a.position.z=v)}function h(f){var p=new Tn.Vector3(f.x,f.y,f.z);e.controls.target?e.controls.target=p:a.lookAt(p)}function d(){return Object.assign(new Tn.Vector3(0,0,-1e3).applyQuaternion(a.quaternion).add(a.position))}},zoomToFit:function(e){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:10,i=arguments.length,a=new Array(i>3?i-3:0),s=3;s<i;s++)a[s-3]=arguments[s];return this.fitToBbox(this.getBbox.apply(this,a),t,n)},fitToBbox:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:10,a=e.camera;if(t){var s=new Tn.Vector3(0,0,0),o=Math.max.apply(Math,yl(Object.entries(t).map(function(f){var p=k0e(f,2),m=p[0],v=p[1];return Math.max.apply(Math,yl(v.map(function(g){return Math.abs(s[m]-g)})))})))*2,l=(1-i*2/e.height)*a.fov,u=o/Math.atan(l*Math.PI/180),c=u/a.aspect,h=Math.max(u,c);if(h>0){var d=s.clone().sub(a.position).normalize().multiplyScalar(-h);this.cameraPosition(d,s,n)}}return this},getBbox:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){return!0},n=new Tn.Box3(new Tn.Vector3(0,0,0),new Tn.Vector3(0,0,0)),i=e.objects.filter(t);return i.length?(i.forEach(function(a){return n.expandByObject(a)}),Object.assign.apply(Object,yl(["x","y","z"].map(function(a){return I0e({},a,[n.min[a],n.max[a]])})))):null},getScreenCoords:function(e,t,n,i){var a=new Tn.Vector3(t,n,i);return a.project(this.camera()),{x:(a.x+1)*e.width/2,y:-(a.y-1)*e.height/2}},getSceneCoords:function(e,t,n){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,a=new Tn.Vector2(t/e.width*2-1,-(n/e.height)*2+1),s=new Tn.Raycaster;return s.setFromCamera(a,e.camera),Object.assign({},s.ray.at(i,new Tn.Vector3))},intersectingObjects:function(e,t,n){var i=new Tn.Vector2(t/e.width*2-1,-(n/e.height)*2+1),a=new Tn.Raycaster;return a.params.Line.threshold=e.lineHoverPrecision,a.params.Points.threshold=e.pointsHoverPrecision,a.setFromCamera(i,e.camera),a.intersectObjects(e.objects,!0)},renderer:function(e){return e.renderer},scene:function(e){return e.scene},camera:function(e){return e.camera},postProcessingComposer:function(e){return e.postProcessingComposer},controls:function(e){return e.controls},tbControls:function(e){return e.controls}},stateInit:function(){return{scene:new Tn.Scene,camera:new Tn.PerspectiveCamera,clock:new Tn.Clock,tweenGroup:new u5,lastRaycasterCheck:0}},init:function(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=n.controlType,a=i===void 0?"trackball":i,s=n.useWebGPU,o=s===void 0?!1:s,l=n.rendererConfig,u=l===void 0?{}:l,c=n.extraRenderers,h=c===void 0?[]:c,d=n.waitForLoadComplete,f=d===void 0?!0:d;e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.className="scene-container",t.container.style.position="relative",t.container.appendChild(t.navInfo=document.createElement("div")),t.navInfo.className="scene-nav-info",t.navInfo.textContent={orbit:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",trackball:"Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan",fly:"WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw"}[a]||"",t.navInfo.style.display=t.showNavInfo?null:"none",t.tooltip=new R0e(t.container),t.pointerPos=new Tn.Vector2,t.pointerPos.x=-2,t.pointerPos.y=-2,["pointermove","pointerdown"].forEach(function(p){return t.container.addEventListener(p,function(m){if(p==="pointerdown"&&(t.isPointerPressed=!0),!t.isPointerDragging&&m.type==="pointermove"&&(m.pressure>0||t.isPointerPressed)&&(m.pointerType!=="touch"||m.movementX===void 0||[m.movementX,m.movementY].some(function(y){return Math.abs(y)>1}))&&(t.isPointerDragging=!0),t.enablePointerInteraction){var v=g(t.container);t.pointerPos.x=m.pageX-v.left,t.pointerPos.y=m.pageY-v.top}function g(y){var _=y.getBoundingClientRect(),x=window.pageXOffset||document.documentElement.scrollLeft,E=window.pageYOffset||document.documentElement.scrollTop;return{top:_.top+E,left:_.left+x}}},{passive:!0})}),t.container.addEventListener("pointerup",function(p){t.isPointerPressed=!1,!(t.isPointerDragging&&(t.isPointerDragging=!1,!t.clickAfterDrag))&&requestAnimationFrame(function(){p.button===0&&t.onClick(t.hoverObj||null,p,t.intersection),p.button===2&&t.onRightClick&&t.onRightClick(t.hoverObj||null,p,t.intersection)})},{passive:!0,capture:!0}),t.container.addEventListener("contextmenu",function(p){t.onRightClick&&p.preventDefault()}),t.renderer=new(o?qge:Tn.WebGLRenderer)(Object.assign({antialias:!0,alpha:!0},u)),t.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),t.container.appendChild(t.renderer.domElement),t.extraRenderers=h,t.extraRenderers.forEach(function(p){p.domElement.style.position="absolute",p.domElement.style.top="0px",p.domElement.style.pointerEvents="none",t.container.appendChild(p.domElement)}),t.postProcessingComposer=new Uve(t.renderer),t.postProcessingComposer.addPass(new kve(t.scene,t.camera)),t.controls=new{trackball:Xge,orbit:uve,fly:Tve}[a](t.camera,t.renderer.domElement),a==="fly"&&(t.controls.movementSpeed=300,t.controls.rollSpeed=Math.PI/6,t.controls.dragToLook=!0),(a==="trackball"||a==="orbit")&&(t.controls.minDistance=.1,t.controls.maxDistance=t.skyRadius,t.controls.addEventListener("start",function(){t.controlsEngaged=!0}),t.controls.addEventListener("change",function(){t.controlsEngaged&&(t.controlsDragging=!0)}),t.controls.addEventListener("end",function(){t.controlsEngaged=!1,t.controlsDragging=!1})),[t.renderer,t.postProcessingComposer].concat(yl(t.extraRenderers)).forEach(function(p){return p.setSize(t.width,t.height)}),t.camera.aspect=t.width/t.height,t.camera.updateProjectionMatrix(),t.camera.position.z=1e3,t.scene.add(t.skysphere=new Tn.Mesh),t.skysphere.visible=!1,t.loadComplete=t.scene.visible=!f,window.scene=t.scene},update:function(e,t){if(e.width&&e.height&&(t.hasOwnProperty("width")||t.hasOwnProperty("height"))){var n,i=e.width,a=e.height;e.container.style.width="".concat(i,"px"),e.container.style.height="".concat(a,"px"),[e.renderer,e.postProcessingComposer].concat(yl(e.extraRenderers)).forEach(function(f){return f.setSize(i,a)}),e.camera.aspect=i/a;var s=e.viewOffset.slice(0,2);s.some(function(f){return f})&&(n=e.camera).setViewOffset.apply(n,[i,a].concat(yl(s),[i,a])),e.camera.updateProjectionMatrix()}if(t.hasOwnProperty("viewOffset")){var o,l=e.width,u=e.height,c=e.viewOffset.slice(0,2);c.some(function(f){return f})?(o=e.camera).setViewOffset.apply(o,[l,u].concat(yl(c),[l,u])):e.camera.clearViewOffset()}if(t.hasOwnProperty("skyRadius")&&e.skyRadius&&(e.controls.hasOwnProperty("maxDistance")&&t.skyRadius&&(e.controls.maxDistance=Math.min(e.controls.maxDistance,e.skyRadius)),e.camera.far=e.skyRadius*2.5,e.camera.updateProjectionMatrix(),e.skysphere.geometry=new Tn.SphereGeometry(e.skyRadius)),t.hasOwnProperty("backgroundColor")){var h=eu(e.backgroundColor).alpha;h===void 0&&(h=1),e.renderer.setClearColor(new Tn.Color(vme(1,e.backgroundColor)),h)}t.hasOwnProperty("backgroundImageUrl")&&(e.backgroundImageUrl?new Tn.TextureLoader().load(e.backgroundImageUrl,function(f){f.colorSpace=Tn.SRGBColorSpace,e.skysphere.material=new Tn.MeshBasicMaterial({map:f,side:Tn.BackSide}),e.skysphere.visible=!0,e.onBackgroundImageLoaded&&setTimeout(e.onBackgroundImageLoaded),!e.loadComplete&&d()}):(e.skysphere.visible=!1,e.skysphere.material.map=null,!e.loadComplete&&d())),t.hasOwnProperty("showNavInfo")&&(e.navInfo.style.display=e.showNavInfo?null:"none"),t.hasOwnProperty("lights")&&((t.lights||[]).forEach(function(f){return e.scene.remove(f)}),e.lights.forEach(function(f){return e.scene.add(f)})),t.hasOwnProperty("objects")&&((t.objects||[]).forEach(function(f){return e.scene.remove(f)}),e.objects.forEach(function(f){return e.scene.add(f)}));function d(){e.loadComplete=e.scene.visible=!0}}});function V0e(r,e){e===void 0&&(e={});var t=e.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=r:i.appendChild(document.createTextNode(r))}}var H0e=`.graph-info-msg {
  top: 50%;
  width: 100%;
  text-align: center;
  color: lavender;
  opacity: 0.7;
  font-size: 22px;
  position: absolute;
  font-family: Sans-serif;
}

.scene-container .clickable {
  cursor: pointer;
}

.scene-container .grabbable {
  cursor: move;
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}

.scene-container .grabbable:active {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
}`;V0e(H0e);function MS(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=Array(e);t<e;t++)n[t]=r[t];return n}function W0e(r){if(Array.isArray(r))return MS(r)}function qd(r,e,t){return(e=Y0e(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function q0e(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function $0e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function TU(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function sg(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?TU(Object(t),!0).forEach(function(n){qd(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):TU(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function Um(r){return W0e(r)||q0e(r)||j0e(r)||$0e()}function X0e(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Y0e(r){var e=X0e(r,"string");return typeof e=="symbol"?e:e+""}function j0e(r,e){if(r){if(typeof r=="string")return MS(r,e);var t={}.toString.call(r).slice(8,-1);return t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set"?Array.from(r):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?MS(r,e):void 0}}function B5(r,e){var t=new e;return t._destructor&&t._destructor(),{linkProp:function(i){return{default:t[i](),onChange:function(s,o){o[r][i](s)},triggerUpdate:!1}},linkMethod:function(i){return function(a){for(var s=a[r],o=arguments.length,l=new Array(o>1?o-1:0),u=1;u<o;u++)l[u-1]=arguments[u];var c=s[i].apply(s,l);return c===s?this:c}}}}var vw=window.THREE?window.THREE:{AmbientLight:Ez,DirectionalLight:bz,REVISION:oh},K0e=170,U5=B5("forceGraph",yV),Q0e=Object.assign.apply(Object,Um(["jsonUrl","graphData","numDimensions","dagMode","dagLevelDistance","dagNodeFilter","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","nodePositionUpdate","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","forceEngine","d3AlphaDecay","d3VelocityDecay","d3AlphaMin","ngraphPhysics","warmupTicks","cooldownTicks","cooldownTime","onEngineTick","onEngineStop"].map(function(r){return qd({},r,U5.linkProp(r))}))),Z0e=Object.assign.apply(Object,Um(["refresh","getGraphBbox","d3Force","d3ReheatSimulation","emitParticle"].map(function(r){return qd({},r,U5.linkMethod(r))}))),Ig=B5("renderObjs",F5),J0e=Object.assign.apply(Object,Um(["width","height","backgroundColor","showNavInfo","enablePointerInteraction"].map(function(r){return qd({},r,Ig.linkProp(r))}))),e_e=Object.assign.apply(Object,Um(["lights","cameraPosition","postProcessingComposer"].map(function(r){return qd({},r,Ig.linkMethod(r))})).concat([{graph2ScreenCoords:Ig.linkMethod("getScreenCoords"),screen2GraphCoords:Ig.linkMethod("getSceneCoords")}])),t_e=vm({props:sg(sg({nodeLabel:{default:"name",triggerUpdate:!1},linkLabel:{default:"name",triggerUpdate:!1},linkHoverPrecision:{default:1,onChange:function(e,t){return t.renderObjs.lineHoverPrecision(e)},triggerUpdate:!1},enableNavigationControls:{default:!0,onChange:function(e,t){var n=t.renderObjs.controls();n&&(n.enabled=e,e&&n.domElement&&n.domElement.dispatchEvent(new PointerEvent("pointerup")))},triggerUpdate:!1},enableNodeDrag:{default:!0,triggerUpdate:!1},onNodeDrag:{default:function(){},triggerUpdate:!1},onNodeDragEnd:{default:function(){},triggerUpdate:!1},onNodeClick:{triggerUpdate:!1},onNodeRightClick:{triggerUpdate:!1},onNodeHover:{triggerUpdate:!1},onLinkClick:{triggerUpdate:!1},onLinkRightClick:{triggerUpdate:!1},onLinkHover:{triggerUpdate:!1},onBackgroundClick:{triggerUpdate:!1},onBackgroundRightClick:{triggerUpdate:!1}},Q0e),J0e),methods:sg(sg({zoomToFit:function(e,t,n){for(var i,a=arguments.length,s=new Array(a>3?a-3:0),o=3;o<a;o++)s[o-3]=arguments[o];return e.renderObjs.fitToBbox((i=e.forceGraph).getGraphBbox.apply(i,s),t,n),this},pauseAnimation:function(e){return e.animationFrameRequestId!==null&&(cancelAnimationFrame(e.animationFrameRequestId),e.animationFrameRequestId=null),this},resumeAnimation:function(e){return e.animationFrameRequestId===null&&this._animationCycle(),this},_animationCycle:function(e){e.enablePointerInteraction&&(this.renderer().domElement.style.cursor=null),e.forceGraph.tickFrame(),e.renderObjs.tick(),e.animationFrameRequestId=requestAnimationFrame(this._animationCycle)},scene:function(e){return e.renderObjs.scene()},camera:function(e){return e.renderObjs.camera()},renderer:function(e){return e.renderObjs.renderer()},controls:function(e){return e.renderObjs.controls()},tbControls:function(e){return e.renderObjs.tbControls()},_destructor:function(){this.pauseAnimation(),this.graphData({nodes:[],links:[]})}},Z0e),e_e),stateInit:function(e){var t=e.controlType,n=e.rendererConfig,i=e.extraRenderers,a=new yV;return{forceGraph:a,renderObjs:F5({controlType:t,rendererConfig:n,extraRenderers:i}).objects([a]).lights([new vw.AmbientLight(13421772,Math.PI),new vw.DirectionalLight(16777215,.6*Math.PI)])}},init:function(e,t){e.innerHTML="",e.appendChild(t.container=document.createElement("div")),t.container.style.position="relative";var n=document.createElement("div");t.container.appendChild(n),t.renderObjs(n);var i=t.renderObjs.camera(),a=t.renderObjs.renderer(),s=t.renderObjs.controls();s.enabled=!!t.enableNavigationControls,t.lastSetCameraZ=i.position.z;var o;t.container.appendChild(o=document.createElement("div")),o.className="graph-info-msg",o.textContent="",t.forceGraph.onLoading(function(){o.textContent="Loading..."}).onFinishLoading(function(){o.textContent=""}).onUpdate(function(){t.graphData=t.forceGraph.graphData(),i.position.x===0&&i.position.y===0&&i.position.z===t.lastSetCameraZ&&t.graphData.nodes.length&&(i.lookAt(t.forceGraph.position),t.lastSetCameraZ=i.position.z=Math.cbrt(t.graphData.nodes.length)*K0e)}).onFinishUpdate(function(){if(t._dragControls){var l=t.graphData.nodes.find(function(c){return c.__initialFixedPos&&!c.__disposeControlsAfterDrag});l?l.__disposeControlsAfterDrag=!0:t._dragControls.dispose(),t._dragControls=void 0}if(t.enableNodeDrag&&t.enablePointerInteraction&&t.forceEngine==="d3"){var u=t._dragControls=new Kre(t.graphData.nodes.map(function(c){return c.__threeObj}).filter(function(c){return c}),i,a.domElement);u.addEventListener("dragstart",function(c){var h=Ts(c.object);if(!!h){s.enabled=!1,c.object.__initialPos=c.object.position.clone(),c.object.__prevPos=c.object.position.clone();var d=h.__data;!d.__initialFixedPos&&(d.__initialFixedPos={fx:d.fx,fy:d.fy,fz:d.fz}),!d.__initialPos&&(d.__initialPos={x:d.x,y:d.y,z:d.z}),["x","y","z"].forEach(function(f){return d["f".concat(f)]=d[f]}),a.domElement.classList.add("grabbable")}}),u.addEventListener("drag",function(c){var h=Ts(c.object);if(!!h){if(!c.object.hasOwnProperty("__graphObjType")){var d=c.object.__initialPos,f=c.object.__prevPos,p=c.object.position;h.position.add(p.clone().sub(f)),f.copy(p),p.copy(d)}var m=h.__data,v=h.position,g={x:v.x-m.x,y:v.y-m.y,z:v.z-m.z};["x","y","z"].forEach(function(y){return m["f".concat(y)]=m[y]=v[y]}),t.forceGraph.d3AlphaTarget(.3).resetCountdown(),m.__dragged=!0,t.onNodeDrag(m,g)}}),u.addEventListener("dragend",function(c){var h=Ts(c.object);if(!!h){delete c.object.__initialPos,delete c.object.__prevPos;var d=h.__data;d.__disposeControlsAfterDrag&&(u.dispose(),delete d.__disposeControlsAfterDrag);var f=d.__initialFixedPos,p=d.__initialPos,m={x:p.x-d.x,y:p.y-d.y,z:p.z-d.z};f&&(["x","y","z"].forEach(function(v){var g="f".concat(v);f[g]===void 0&&delete d[g]}),delete d.__initialFixedPos,delete d.__initialPos,d.__dragged&&(delete d.__dragged,t.onNodeDragEnd(d,m))),t.forceGraph.d3AlphaTarget(0).resetCountdown(),t.enableNavigationControls&&(s.enabled=!0,s.domElement&&s.domElement.ownerDocument&&s.domElement.ownerDocument.dispatchEvent(new PointerEvent("pointerup",{pointerType:"touch"}))),a.domElement.classList.remove("grabbable")}})}}),vw.REVISION<155&&(t.renderObjs.renderer().useLegacyLights=!1),t.renderObjs.hoverOrderComparator(function(l,u){var c=Ts(l);if(!c)return 1;var h=Ts(u);if(!h)return-1;var d=function(p){return p.__graphObjType==="node"};return d(h)-d(c)}).tooltipContent(function(l){var u=Ts(l);return u&&Ht(t["".concat(u.__graphObjType,"Label")])(u.__data)||""}).hoverDuringDrag(!1).onHover(function(l){var u=Ts(l);if(u!==t.hoverObj){var c=t.hoverObj?t.hoverObj.__graphObjType:null,h=t.hoverObj?t.hoverObj.__data:null,d=u?u.__graphObjType:null,f=u?u.__data:null;if(c&&c!==d){var p=t["on".concat(c==="node"?"Node":"Link","Hover")];p&&p(null,h)}if(d){var m=t["on".concat(d==="node"?"Node":"Link","Hover")];m&&m(f,c===d?h:null)}a.domElement.classList[u&&t["on".concat(d==="node"?"Node":"Link","Click")]||!u&&t.onBackgroundClick?"add":"remove"]("clickable"),t.hoverObj=u}}).clickAfterDrag(!1).onClick(function(l,u){var c=Ts(l);if(c){var h=t["on".concat(c.__graphObjType==="node"?"Node":"Link","Click")];h&&h(c.__data,u)}else t.onBackgroundClick&&t.onBackgroundClick(u)}).onRightClick(function(l,u){var c=Ts(l);if(c){var h=t["on".concat(c.__graphObjType==="node"?"Node":"Link","RightClick")];h&&h(c.__data,u)}else t.onBackgroundRightClick&&t.onBackgroundRightClick(u)}),this._animationCycle()}});function Ts(r){for(var e=r;e&&!e.hasOwnProperty("__graphObjType");)e=e.parent;return e}/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const k5="151",G5=300,wU=1e3,og=1001,SU=1002,n_e=1006,r_e=1008,i_e=1009,a_e=1023,s_e=3e3;class z5{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const a=i.indexOf(t);a!==-1&&i.splice(a,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let a=0,s=i.length;a<s;a++)i[a].call(this,e);e.target=null}}}const Fr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function JM(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Fr[r&255]+Fr[r>>8&255]+Fr[r>>16&255]+Fr[r>>24&255]+"-"+Fr[e&255]+Fr[e>>8&255]+"-"+Fr[e>>16&15|64]+Fr[e>>24&255]+"-"+Fr[t&63|128]+Fr[t>>8&255]+"-"+Fr[t>>16&255]+Fr[t>>24&255]+Fr[n&255]+Fr[n>>8&255]+Fr[n>>16&255]+Fr[n>>24&255]).toLowerCase()}function Rs(r,e,t){return Math.max(e,Math.min(t,r))}class yc{constructor(e=0,t=0){yc.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Rs(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),a=this.x-e.x,s=this.y-e.y;return this.x=a*n-s*i+e.x,this.y=a*i+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class $d{constructor(){$d.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,i,a,s,o,l,u){const c=this.elements;return c[0]=e,c[1]=i,c[2]=o,c[3]=t,c[4]=a,c[5]=l,c[6]=n,c[7]=s,c[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,a=this.elements,s=n[0],o=n[3],l=n[6],u=n[1],c=n[4],h=n[7],d=n[2],f=n[5],p=n[8],m=i[0],v=i[3],g=i[6],y=i[1],_=i[4],x=i[7],E=i[2],T=i[5],b=i[8];return a[0]=s*m+o*y+l*E,a[3]=s*v+o*_+l*T,a[6]=s*g+o*x+l*b,a[1]=u*m+c*y+h*E,a[4]=u*v+c*_+h*T,a[7]=u*g+c*x+h*b,a[2]=d*m+f*y+p*E,a[5]=d*v+f*_+p*T,a[8]=d*g+f*x+p*b,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],a=e[3],s=e[4],o=e[5],l=e[6],u=e[7],c=e[8];return t*s*c-t*o*u-n*a*c+n*o*l+i*a*u-i*s*l}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],a=e[3],s=e[4],o=e[5],l=e[6],u=e[7],c=e[8],h=c*s-o*u,d=o*l-c*a,f=u*a-s*l,p=t*h+n*d+i*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=h*m,e[1]=(i*u-c*n)*m,e[2]=(o*n-i*s)*m,e[3]=d*m,e[4]=(c*t-i*l)*m,e[5]=(i*a-o*t)*m,e[6]=f*m,e[7]=(n*l-u*t)*m,e[8]=(s*t-n*a)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,a,s,o){const l=Math.cos(a),u=Math.sin(a);return this.set(n*l,n*u,-n*(l*s+u*o)+s+e,-i*u,i*l,-i*(-u*s+l*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(mw.makeScale(e,t)),this}rotate(e){return this.premultiply(mw.makeRotation(-e)),this}translate(e,t){return this.premultiply(mw.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const mw=new $d;function AU(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function yw(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}let qu;class o_e{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{qu===void 0&&(qu=AU("canvas")),qu.width=e.width,qu.height=e.height;const n=qu.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=qu}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=AU("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),a=i.data;for(let s=0;s<a.length;s++)a[s]=yw(a[s]/255)*255;return n.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(yw(t[n]/255)*255):t[n]=yw(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class l_e{constructor(e=null){this.isSource=!0,this.uuid=JM(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let a;if(Array.isArray(i)){a=[];for(let s=0,o=i.length;s<o;s++)i[s].isDataTexture?a.push(_w(i[s].image)):a.push(_w(i[s]))}else a=_w(i);n.url=a}return t||(e.images[this.uuid]=n),n}}function _w(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?o_e.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let u_e=0;class zl extends z5{constructor(e=zl.DEFAULT_IMAGE,t=zl.DEFAULT_MAPPING,n=og,i=og,a=n_e,s=r_e,o=a_e,l=i_e,u=zl.DEFAULT_ANISOTROPY,c=s_e){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:u_e++}),this.uuid=JM(),this.name="",this.source=new l_e(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=a,this.minFilter=s,this.anisotropy=u,this.format=o,this.internalFormat=null,this.type=l,this.offset=new yc(0,0),this.repeat=new yc(1,1),this.center=new yc(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new $d,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==G5)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case wU:e.x=e.x-Math.floor(e.x);break;case og:e.x=e.x<0?0:1;break;case SU:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case wU:e.y=e.y-Math.floor(e.y);break;case og:e.y=e.y<0?0:1;break;case SU:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}zl.DEFAULT_IMAGE=null;zl.DEFAULT_MAPPING=G5;zl.DEFAULT_ANISOTROPY=1;class Xd{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,a,s,o){let l=n[i+0],u=n[i+1],c=n[i+2],h=n[i+3];const d=a[s+0],f=a[s+1],p=a[s+2],m=a[s+3];if(o===0){e[t+0]=l,e[t+1]=u,e[t+2]=c,e[t+3]=h;return}if(o===1){e[t+0]=d,e[t+1]=f,e[t+2]=p,e[t+3]=m;return}if(h!==m||l!==d||u!==f||c!==p){let v=1-o;const g=l*d+u*f+c*p+h*m,y=g>=0?1:-1,_=1-g*g;if(_>Number.EPSILON){const E=Math.sqrt(_),T=Math.atan2(E,g*y);v=Math.sin(v*T)/E,o=Math.sin(o*T)/E}const x=o*y;if(l=l*v+d*x,u=u*v+f*x,c=c*v+p*x,h=h*v+m*x,v===1-o){const E=1/Math.sqrt(l*l+u*u+c*c+h*h);l*=E,u*=E,c*=E,h*=E}}e[t]=l,e[t+1]=u,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,i,a,s){const o=n[i],l=n[i+1],u=n[i+2],c=n[i+3],h=a[s],d=a[s+1],f=a[s+2],p=a[s+3];return e[t]=o*p+c*h+l*f-u*d,e[t+1]=l*p+c*d+u*h-o*f,e[t+2]=u*p+c*f+o*d-l*h,e[t+3]=c*p-o*h-l*d-u*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,i=e._y,a=e._z,s=e._order,o=Math.cos,l=Math.sin,u=o(n/2),c=o(i/2),h=o(a/2),d=l(n/2),f=l(i/2),p=l(a/2);switch(s){case"XYZ":this._x=d*c*h+u*f*p,this._y=u*f*h-d*c*p,this._z=u*c*p+d*f*h,this._w=u*c*h-d*f*p;break;case"YXZ":this._x=d*c*h+u*f*p,this._y=u*f*h-d*c*p,this._z=u*c*p-d*f*h,this._w=u*c*h+d*f*p;break;case"ZXY":this._x=d*c*h-u*f*p,this._y=u*f*h+d*c*p,this._z=u*c*p+d*f*h,this._w=u*c*h-d*f*p;break;case"ZYX":this._x=d*c*h-u*f*p,this._y=u*f*h+d*c*p,this._z=u*c*p-d*f*h,this._w=u*c*h+d*f*p;break;case"YZX":this._x=d*c*h+u*f*p,this._y=u*f*h+d*c*p,this._z=u*c*p-d*f*h,this._w=u*c*h-d*f*p;break;case"XZY":this._x=d*c*h-u*f*p,this._y=u*f*h-d*c*p,this._z=u*c*p+d*f*h,this._w=u*c*h+d*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],a=t[8],s=t[1],o=t[5],l=t[9],u=t[2],c=t[6],h=t[10],d=n+o+h;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(c-l)*f,this._y=(a-u)*f,this._z=(s-i)*f}else if(n>o&&n>h){const f=2*Math.sqrt(1+n-o-h);this._w=(c-l)/f,this._x=.25*f,this._y=(i+s)/f,this._z=(a+u)/f}else if(o>h){const f=2*Math.sqrt(1+o-n-h);this._w=(a-u)/f,this._x=(i+s)/f,this._y=.25*f,this._z=(l+c)/f}else{const f=2*Math.sqrt(1+h-n-o);this._w=(s-i)/f,this._x=(a+u)/f,this._y=(l+c)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Rs(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,a=e._z,s=e._w,o=t._x,l=t._y,u=t._z,c=t._w;return this._x=n*c+s*o+i*u-a*l,this._y=i*c+s*l+a*o-n*u,this._z=a*c+s*u+n*l-i*o,this._w=s*c-n*o-i*l-a*u,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,i=this._y,a=this._z,s=this._w;let o=s*e._w+n*e._x+i*e._y+a*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=s,this._x=n,this._y=i,this._z=a,this;const l=1-o*o;if(l<=Number.EPSILON){const f=1-t;return this._w=f*s+t*this._w,this._x=f*n+t*this._x,this._y=f*i+t*this._y,this._z=f*a+t*this._z,this.normalize(),this._onChangeCallback(),this}const u=Math.sqrt(l),c=Math.atan2(u,o),h=Math.sin((1-t)*c)/u,d=Math.sin(t*c)/u;return this._w=s*h+this._w*d,this._x=n*h+this._x*d,this._y=i*h+this._y*d,this._z=a*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),a=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(a),n*Math.cos(a),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Fn{constructor(e=0,t=0,n=0){Fn.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(MU.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(MU.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,a=e.elements;return this.x=a[0]*t+a[3]*n+a[6]*i,this.y=a[1]*t+a[4]*n+a[7]*i,this.z=a[2]*t+a[5]*n+a[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,a=e.elements,s=1/(a[3]*t+a[7]*n+a[11]*i+a[15]);return this.x=(a[0]*t+a[4]*n+a[8]*i+a[12])*s,this.y=(a[1]*t+a[5]*n+a[9]*i+a[13])*s,this.z=(a[2]*t+a[6]*n+a[10]*i+a[14])*s,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,a=e.x,s=e.y,o=e.z,l=e.w,u=l*t+s*i-o*n,c=l*n+o*t-a*i,h=l*i+a*n-s*t,d=-a*t-s*n-o*i;return this.x=u*l+d*-a+c*-o-h*-s,this.y=c*l+d*-s+h*-a-u*-o,this.z=h*l+d*-o+u*-s-c*-a,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i,this.y=a[1]*t+a[5]*n+a[9]*i,this.z=a[2]*t+a[6]*n+a[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,a=e.z,s=t.x,o=t.y,l=t.z;return this.x=i*l-a*o,this.y=a*s-n*l,this.z=n*o-i*s,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return xw.copy(this).projectOnVector(e),this.sub(xw)}reflect(e){return this.sub(xw.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Rs(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const xw=new Fn,MU=new Xd;class Oa{constructor(){Oa.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,i,a,s,o,l,u,c,h,d,f,p,m,v){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=a,g[5]=s,g[9]=o,g[13]=l,g[2]=u,g[6]=c,g[10]=h,g[14]=d,g[3]=f,g[7]=p,g[11]=m,g[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Oa().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/$u.setFromMatrixColumn(e,0).length(),a=1/$u.setFromMatrixColumn(e,1).length(),s=1/$u.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,a=e.z,s=Math.cos(n),o=Math.sin(n),l=Math.cos(i),u=Math.sin(i),c=Math.cos(a),h=Math.sin(a);if(e.order==="XYZ"){const d=s*c,f=s*h,p=o*c,m=o*h;t[0]=l*c,t[4]=-l*h,t[8]=u,t[1]=f+p*u,t[5]=d-m*u,t[9]=-o*l,t[2]=m-d*u,t[6]=p+f*u,t[10]=s*l}else if(e.order==="YXZ"){const d=l*c,f=l*h,p=u*c,m=u*h;t[0]=d+m*o,t[4]=p*o-f,t[8]=s*u,t[1]=s*h,t[5]=s*c,t[9]=-o,t[2]=f*o-p,t[6]=m+d*o,t[10]=s*l}else if(e.order==="ZXY"){const d=l*c,f=l*h,p=u*c,m=u*h;t[0]=d-m*o,t[4]=-s*h,t[8]=p+f*o,t[1]=f+p*o,t[5]=s*c,t[9]=m-d*o,t[2]=-s*u,t[6]=o,t[10]=s*l}else if(e.order==="ZYX"){const d=s*c,f=s*h,p=o*c,m=o*h;t[0]=l*c,t[4]=p*u-f,t[8]=d*u+m,t[1]=l*h,t[5]=m*u+d,t[9]=f*u-p,t[2]=-u,t[6]=o*l,t[10]=s*l}else if(e.order==="YZX"){const d=s*l,f=s*u,p=o*l,m=o*u;t[0]=l*c,t[4]=m-d*h,t[8]=p*h+f,t[1]=h,t[5]=s*c,t[9]=-o*c,t[2]=-u*c,t[6]=f*h+p,t[10]=d-m*h}else if(e.order==="XZY"){const d=s*l,f=s*u,p=o*l,m=o*u;t[0]=l*c,t[4]=-h,t[8]=u*c,t[1]=d*h+m,t[5]=s*c,t[9]=f*h-p,t[2]=p*h-f,t[6]=o*c,t[10]=m*h+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(c_e,e,h_e)}lookAt(e,t,n){const i=this.elements;return Di.subVectors(e,t),Di.lengthSq()===0&&(Di.z=1),Di.normalize(),bo.crossVectors(n,Di),bo.lengthSq()===0&&(Math.abs(n.z)===1?Di.x+=1e-4:Di.z+=1e-4,Di.normalize(),bo.crossVectors(n,Di)),bo.normalize(),lg.crossVectors(Di,bo),i[0]=bo.x,i[4]=lg.x,i[8]=Di.x,i[1]=bo.y,i[5]=lg.y,i[9]=Di.y,i[2]=bo.z,i[6]=lg.z,i[10]=Di.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,a=this.elements,s=n[0],o=n[4],l=n[8],u=n[12],c=n[1],h=n[5],d=n[9],f=n[13],p=n[2],m=n[6],v=n[10],g=n[14],y=n[3],_=n[7],x=n[11],E=n[15],T=i[0],b=i[4],w=i[8],A=i[12],S=i[1],C=i[5],R=i[9],P=i[13],M=i[2],N=i[6],D=i[10],I=i[14],L=i[3],z=i[7],B=i[11],k=i[15];return a[0]=s*T+o*S+l*M+u*L,a[4]=s*b+o*C+l*N+u*z,a[8]=s*w+o*R+l*D+u*B,a[12]=s*A+o*P+l*I+u*k,a[1]=c*T+h*S+d*M+f*L,a[5]=c*b+h*C+d*N+f*z,a[9]=c*w+h*R+d*D+f*B,a[13]=c*A+h*P+d*I+f*k,a[2]=p*T+m*S+v*M+g*L,a[6]=p*b+m*C+v*N+g*z,a[10]=p*w+m*R+v*D+g*B,a[14]=p*A+m*P+v*I+g*k,a[3]=y*T+_*S+x*M+E*L,a[7]=y*b+_*C+x*N+E*z,a[11]=y*w+_*R+x*D+E*B,a[15]=y*A+_*P+x*I+E*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],a=e[12],s=e[1],o=e[5],l=e[9],u=e[13],c=e[2],h=e[6],d=e[10],f=e[14],p=e[3],m=e[7],v=e[11],g=e[15];return p*(+a*l*h-i*u*h-a*o*d+n*u*d+i*o*f-n*l*f)+m*(+t*l*f-t*u*d+a*s*d-i*s*f+i*u*c-a*l*c)+v*(+t*u*h-t*o*f-a*s*h+n*s*f+a*o*c-n*u*c)+g*(-i*o*c-t*l*h+t*o*d+i*s*h-n*s*d+n*l*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],a=e[3],s=e[4],o=e[5],l=e[6],u=e[7],c=e[8],h=e[9],d=e[10],f=e[11],p=e[12],m=e[13],v=e[14],g=e[15],y=h*v*u-m*d*u+m*l*f-o*v*f-h*l*g+o*d*g,_=p*d*u-c*v*u-p*l*f+s*v*f+c*l*g-s*d*g,x=c*m*u-p*h*u+p*o*f-s*m*f-c*o*g+s*h*g,E=p*h*l-c*m*l-p*o*d+s*m*d+c*o*v-s*h*v,T=t*y+n*_+i*x+a*E;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/T;return e[0]=y*b,e[1]=(m*d*a-h*v*a-m*i*f+n*v*f+h*i*g-n*d*g)*b,e[2]=(o*v*a-m*l*a+m*i*u-n*v*u-o*i*g+n*l*g)*b,e[3]=(h*l*a-o*d*a-h*i*u+n*d*u+o*i*f-n*l*f)*b,e[4]=_*b,e[5]=(c*v*a-p*d*a+p*i*f-t*v*f-c*i*g+t*d*g)*b,e[6]=(p*l*a-s*v*a-p*i*u+t*v*u+s*i*g-t*l*g)*b,e[7]=(s*d*a-c*l*a+c*i*u-t*d*u-s*i*f+t*l*f)*b,e[8]=x*b,e[9]=(p*h*a-c*m*a-p*n*f+t*m*f+c*n*g-t*h*g)*b,e[10]=(s*m*a-p*o*a+p*n*u-t*m*u-s*n*g+t*o*g)*b,e[11]=(c*o*a-s*h*a-c*n*u+t*h*u+s*n*f-t*o*f)*b,e[12]=E*b,e[13]=(c*m*i-p*h*i+p*n*d-t*m*d-c*n*v+t*h*v)*b,e[14]=(p*o*i-s*m*i-p*n*l+t*m*l+s*n*v-t*o*v)*b,e[15]=(s*h*i-c*o*i+c*n*l-t*h*l-s*n*d+t*o*d)*b,this}scale(e){const t=this.elements,n=e.x,i=e.y,a=e.z;return t[0]*=n,t[4]*=i,t[8]*=a,t[1]*=n,t[5]*=i,t[9]*=a,t[2]*=n,t[6]*=i,t[10]*=a,t[3]*=n,t[7]*=i,t[11]*=a,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),a=1-n,s=e.x,o=e.y,l=e.z,u=a*s,c=a*o;return this.set(u*s+n,u*o-i*l,u*l+i*o,0,u*o+i*l,c*o+n,c*l-i*s,0,u*l-i*o,c*l+i*s,a*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,a,s){return this.set(1,n,a,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,a=t._x,s=t._y,o=t._z,l=t._w,u=a+a,c=s+s,h=o+o,d=a*u,f=a*c,p=a*h,m=s*c,v=s*h,g=o*h,y=l*u,_=l*c,x=l*h,E=n.x,T=n.y,b=n.z;return i[0]=(1-(m+g))*E,i[1]=(f+x)*E,i[2]=(p-_)*E,i[3]=0,i[4]=(f-x)*T,i[5]=(1-(d+g))*T,i[6]=(v+y)*T,i[7]=0,i[8]=(p+_)*b,i[9]=(v-y)*b,i[10]=(1-(d+m))*b,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let a=$u.set(i[0],i[1],i[2]).length();const s=$u.set(i[4],i[5],i[6]).length(),o=$u.set(i[8],i[9],i[10]).length();this.determinant()<0&&(a=-a),e.x=i[12],e.y=i[13],e.z=i[14],xa.copy(this);const u=1/a,c=1/s,h=1/o;return xa.elements[0]*=u,xa.elements[1]*=u,xa.elements[2]*=u,xa.elements[4]*=c,xa.elements[5]*=c,xa.elements[6]*=c,xa.elements[8]*=h,xa.elements[9]*=h,xa.elements[10]*=h,t.setFromRotationMatrix(xa),n.x=a,n.y=s,n.z=o,this}makePerspective(e,t,n,i,a,s){const o=this.elements,l=2*a/(t-e),u=2*a/(n-i),c=(t+e)/(t-e),h=(n+i)/(n-i),d=-(s+a)/(s-a),f=-2*s*a/(s-a);return o[0]=l,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=u,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,n,i,a,s){const o=this.elements,l=1/(t-e),u=1/(n-i),c=1/(s-a),h=(t+e)*l,d=(n+i)*u,f=(s+a)*c;return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const $u=new Fn,xa=new Oa,c_e=new Fn(0,0,0),h_e=new Fn(1,1,1),bo=new Fn,lg=new Fn,Di=new Fn,CU=new Oa,RU=new Xd;class km{constructor(e=0,t=0,n=0,i=km.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,a=i[0],s=i[4],o=i[8],l=i[1],u=i[5],c=i[9],h=i[2],d=i[6],f=i[10];switch(t){case"XYZ":this._y=Math.asin(Rs(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-s,a)):(this._x=Math.atan2(d,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Rs(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,f),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,a),this._z=0);break;case"ZXY":this._x=Math.asin(Rs(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-s,u)):(this._y=0,this._z=Math.atan2(l,a));break;case"ZYX":this._y=Math.asin(-Rs(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-s,u));break;case"YZX":this._z=Math.asin(Rs(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-h,a)):(this._x=0,this._y=Math.atan2(o,f));break;case"XZY":this._z=Math.asin(-Rs(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,u),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-c,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return CU.makeRotationFromQuaternion(e),this.setFromRotationMatrix(CU,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return RU.setFromEuler(this),this.setFromQuaternion(RU,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}km.DEFAULT_ORDER="XYZ";class f_e{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let d_e=0;const NU=new Fn,Xu=new Xd,ws=new Oa,ug=new Fn,Yh=new Fn,p_e=new Fn,g_e=new Xd,PU=new Fn(1,0,0),DU=new Fn(0,1,0),LU=new Fn(0,0,1),v_e={type:"added"},IU={type:"removed"};class Fo extends z5{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:d_e++}),this.uuid=JM(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Fo.DEFAULT_UP.clone();const e=new Fn,t=new km,n=new Xd,i=new Fn(1,1,1);function a(){n.setFromEuler(t,!1)}function s(){t.setFromQuaternion(n,void 0,!1)}t._onChange(a),n._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Oa},normalMatrix:{value:new $d}}),this.matrix=new Oa,this.matrixWorld=new Oa,this.matrixAutoUpdate=Fo.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Fo.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new f_e,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Xu.setFromAxisAngle(e,t),this.quaternion.multiply(Xu),this}rotateOnWorldAxis(e,t){return Xu.setFromAxisAngle(e,t),this.quaternion.premultiply(Xu),this}rotateX(e){return this.rotateOnAxis(PU,e)}rotateY(e){return this.rotateOnAxis(DU,e)}rotateZ(e){return this.rotateOnAxis(LU,e)}translateOnAxis(e,t){return NU.copy(e).applyQuaternion(this.quaternion),this.position.add(NU.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(PU,e)}translateY(e){return this.translateOnAxis(DU,e)}translateZ(e){return this.translateOnAxis(LU,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ws.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?ug.copy(e):ug.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),Yh.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ws.lookAt(Yh,ug,this.up):ws.lookAt(ug,Yh,this.up),this.quaternion.setFromRotationMatrix(ws),i&&(ws.extractRotation(i.matrixWorld),Xu.setFromRotationMatrix(ws),this.quaternion.premultiply(Xu.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(v_e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(IU)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(IU)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),ws.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),ws.multiply(e.parent.matrixWorld)),e.applyMatrix4(ws),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const s=this.children[n].getObjectByProperty(e,t);if(s!==void 0)return s}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let i=0,a=this.children.length;i<a;i++){const s=this.children[i].getObjectsByProperty(e,t);s.length>0&&(n=n.concat(s))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Yh,e,p_e),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Yh,g_e,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const a=t[n];(a.matrixWorldAutoUpdate===!0||e===!0)&&a.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const i=this.children;for(let a=0,s=i.length;a<s;a++){const o=i[a];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON()));function a(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=a(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let u=0,c=l.length;u<c;u++){const h=l[u];a(e.shapes,h)}else a(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(a(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,u=this.material.length;l<u;l++)o.push(a(e.materials,this.material[l]));i.material=o}else i.material=a(e.materials,this.material);if(this.children.length>0){i.children=[];for(let o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];i.animations.push(a(e.animations,l))}}if(t){const o=s(e.geometries),l=s(e.materials),u=s(e.textures),c=s(e.images),h=s(e.shapes),d=s(e.skeletons),f=s(e.animations),p=s(e.nodes);o.length>0&&(n.geometries=o),l.length>0&&(n.materials=l),u.length>0&&(n.textures=u),c.length>0&&(n.images=c),h.length>0&&(n.shapes=h),d.length>0&&(n.skeletons=d),f.length>0&&(n.animations=f),p.length>0&&(n.nodes=p)}return n.object=i,n;function s(o){const l=[];for(const u in o){const c=o[u];delete c.metadata,l.push(c)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const i=e.children[n];this.add(i.clone())}return this}}Fo.DEFAULT_UP=new Fn(0,1,0);Fo.DEFAULT_MATRIX_AUTO_UPDATE=!0;Fo.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:k5}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=k5);class OU extends Fo{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new yc(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}}const Yu=new Fn,FU=new Oa,BU=new Oa,UU=new Fn,kU=new Fn;class m_e{constructor(e={}){const t=this;let n,i,a,s;const o={objects:new WeakMap},l=e.element!==void 0?e.element:document.createElement("div");l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:n,height:i}},this.render=function(f,p){f.matrixWorldAutoUpdate===!0&&f.updateMatrixWorld(),p.parent===null&&p.matrixWorldAutoUpdate===!0&&p.updateMatrixWorld(),FU.copy(p.matrixWorldInverse),BU.multiplyMatrices(p.projectionMatrix,FU),u(f,f,p),d(f)},this.setSize=function(f,p){n=f,i=p,a=n/2,s=i/2,l.style.width=f+"px",l.style.height=p+"px"};function u(f,p,m){if(f.isCSS2DObject){Yu.setFromMatrixPosition(f.matrixWorld),Yu.applyMatrix4(BU);const v=f.visible===!0&&Yu.z>=-1&&Yu.z<=1&&f.layers.test(m.layers)===!0;if(f.element.style.display=v===!0?"":"none",v===!0){f.onBeforeRender(t,p,m);const y=f.element;y.style.transform="translate("+-100*f.center.x+"%,"+-100*f.center.y+"%)translate("+(Yu.x*a+a)+"px,"+(-Yu.y*s+s)+"px)",y.parentNode!==l&&l.appendChild(y),f.onAfterRender(t,p,m)}const g={distanceToCameraSquared:c(m,f)};o.objects.set(f,g)}for(let v=0,g=f.children.length;v<g;v++)u(f.children[v],p,m)}function c(f,p){return UU.setFromMatrixPosition(f.matrixWorld),kU.setFromMatrixPosition(p.matrixWorld),UU.distanceToSquared(kU)}function h(f){const p=[];return f.traverse(function(m){m.isCSS2DObject&&p.push(m)}),p}function d(f){const p=h(f).sort(function(v,g){if(v.renderOrder!==g.renderOrder)return g.renderOrder-v.renderOrder;const y=o.objects.get(v).distanceToCameraSquared,_=o.objects.get(g).distanceToCameraSquared;return y-_}),m=p.length;for(let v=0,g=p.length;v<g;v++)p[v].element.style.zIndex=m-v}}}const y_e=["#F6D2A8","#ACE9C4","#ABE8EC","#A3DAF1","#A6BBF2","#EFC4BA","#97CBF0","#C7A1EC","#E1ECA1","#97B4E0","#EDB6B6","#F5DD9F","#F6A8E0","#CDEEB8","#D0C3EC","#82D9FF","#EFF0BA","#FFD2D2","#D4FFD3","#FFA4CA","#B6DFD8","#EFE6B8"];const __e=["id"],x_e={__name:"ForceGraph3D",props:{graphData:{type:Object,default:()=>({nodes:[],edges:[]})}},emits:["nodeAndEdgeClick","nodeDbclick"],setup(r,{emit:e}){const t=r,n={};n.whichComponent=si("whichComponentProps");const i=e,a=ea(null),s=Wr({types:[],typeColors:{}}),o=t_e({extraRenderers:[new m_e]}),l=function(){o.width(a.value.clientWidth),o.height(a.value.clientHeight),window.addEventListener("resize",()=>{o.width(a.value.clientWidth),o.height(a.value.clientHeight)})},u=new Set,c=new Set;let h=null;const d=function(){o.nodeColor(o.nodeColor()).linkWidth(o.linkWidth()).linkDirectionalParticles(o.linkDirectionalParticles())},f=function(g){!g&&!u.size||g&&h===g||(u.clear(),c.clear(),g&&g.neighbors&&(u.add(g),g.neighbors.forEach(y=>u.add(y)),g.links.forEach(y=>c.add(y))),h=g||null,d())},p=function(){s.types=Array.from(new Set(t.graphData.nodes.map(y=>"class"+ta.exports(y.label||y.id)))),s.types.forEach((y,_)=>{s.typeColors[y]=_});const g=v({nodes:t.graphData.nodes,links:t.graphData.edges});o(a.value).graphData(g).nodeAutoColorBy("id").nodeOpacity(.9).nodeResolution(16).nodeColor((y,_)=>{const x="class"+ta.exports(y.label||y.id);return u.has(y)?h===y?"rgba(255,0,0,1)":"rgba(255,160,0,0.8)":s.typeColors&&s.typeColors[x]&&y_e[s.typeColors[x]]||"rgba(0,255,255,1)"}).linkDirectionalParticles(y=>c.has(y)?2:0).linkWidth(y=>c.has(y)?2:1).linkColor("#fff").linkOpacity(.8).linkDirectionalParticleWidth(2).linkDirectionalParticleColor("#ff0000").nodeThreeObject(y=>{const _=document.createElement("div");return _.textContent=y.name,_.style.color=y.color,_.className="threeGraph-node-label",new OU(_)}).linkThreeObject(y=>{const _=document.createElement("div");return _.textContent=y.type,_.style.color="#fff",_.className="threeGraph-link-label",new OU(_)}).linkPositionUpdate((y,{start:_,end:x})=>{const E=Object.assign(...["x","y","z"].map(T=>({[T]:_[T]+(x[T]-_[T])/2})));Object.assign(y.position,E)}).nodeThreeObjectExtend(!0).linkThreeObjectExtend(!0).onNodeDragEnd(y=>{y.fx=y.x,y.fy=y.y,y.fz=y.z}).onNodeRightClick(y=>{i("nodeDbclick",y)}).onNodeClick((y,_)=>{i("nodeAndEdgeClick",[y])}).onLinkClick(y=>{const _=[y.source,y.target];i("nodeAndEdgeClick",_,{properties:y.properties,label:y.label})}).onNodeHover(y=>{f(y)}).onLinkHover(y=>{c.clear(),u.clear(),y&&(c.add(y),u.add(y.source),u.add(y.target)),d()}).d3Force("charge").strength(-12)};function m(g){let y;try{y=g.push?[]:{}}catch{y={}}for(let _ in g)typeof g[_]=="object"?y[_]=m(g[_]):y[_]=g[_];return y}const v=function(g){const y=m(g);return y.links.forEach(_=>{const x=y.nodes.find(T=>T.id===_.source),E=y.nodes.find(T=>T.id===_.target);x&&!x.neighbors&&(x.neighbors=[]),E&&!E.neighbors&&(E.neighbors=[]),x.neighbors.push(E),E.neighbors.push(x),!x.links&&(x.links=[]),!E.links&&(E.links=[]),x.links.push(_),E.links.push(_)}),y};return Og(()=>t.graphData,function(){const g=v({nodes:t.graphData.nodes,links:t.graphData.edges});o.graphData(g)},{deep:!0}),br(()=>{_v(()=>{const g=document.getElementsByClassName("threeGraph")[0];g.style.width=document.body.clientWidth+"px",g.style.height=document.body.clientHeight+50+"px",l(),p()})}),(g,y)=>(Ye(),tt("div",{ref_key:"threeGraphRef",ref:a,class:"threeGraph",id:`threeDom${n.whichComponent}`},null,8,__e))}},b_e=Nr(x_e,[["__scopeId","data-v-a7489016"]]),E_e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADLSURBVHgB7VUxCsJAEJwNGltrQYidpRBLLaysBJ/g0/yBASs7QbAQC7Gy9AcxUQu1OHdFJELMxdyVGVhuWYa5uYPdpTAM6wAmHHKa4MgRUBzHM6XUGBZAREuKokjBIhxYRilojoqOcLs/MF+sXvlo2EfNrWbynTxirWYDHofkUivkMCnmd9qfutSynDr/iHU51zlN7ZT1Zs8O3C+xJLa7A86XKwY9P5+g3K77/F+c1CfrxLI4ZetZEJQpC0vgyR/Qe6fICvBghhPH9AmcmlZ9SoP46AAAAABJRU5ErkJggg==",T_e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAADCSURBVHgB7ZWxCsIwEIb/E6yrq4t0dRFBcBFnJ8FH8NF8AwtOboLgIDro4lpcHGuyWYd4hwqC1USaoUM/ODLcn28ISY6SJKkDmHDJmoeYKyKt9cwYM4YHiGhJSikDj1TgmVL44Jre4FW43hyw2x+/btpyTzLOwn6vjfh0zpSKTHrdTstdGARVjIaDD+lLJr0aZ7L4ebFTPsv5YoWw2YCEbDKr8F0qIZvMSfgv5UspolB+WXiCf/6InjNFRkCIfFy4pneX9losqzsocAAAAABJRU5ErkJggg==",w_e=""+new URL("1.4f01ab49.png",import.meta.url).href,S_e=""+new URL("2.0f42f6cb.png",import.meta.url).href,A_e=""+new URL("3.41d2d3af.png",import.meta.url).href,M_e=""+new URL("4.f1e30bd9.png",import.meta.url).href,C_e=""+new URL("5.81856faa.png",import.meta.url).href,GU=""+new URL("6.64028c08.png",import.meta.url).href,R_e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAQ3SURBVHgB7VhNcts2FH4g6cx4uqh7grAnqHOCyCdobiDyAJasha1murC8ytheyHK6J3WC2ieocgP1BFVOUK/aTC0S/R5AUBBNyR6B3GTyzdgCiSfg4b3v/UBE3+AGQQ3h6jaJhBBdKamDRR+koFm2lIP3g3hBDmhEwavbNMFHVDcnpYiG/e6UdoSzgmw5LJNsEXn4J5M/jgbxA+0AjxwBt/bNOJdyAmV+yKAQHhfF64N9v966L4GzguDcoRl/yWnEltK8kxfmvSDxE+0IZwWB0nV7RKEZC+G9pgYQkCNA4rkk6vB4zxe/X98mExLe9zDtiZHJSH6iHeGs4DKTF74vOsVjKEmM2e8GGC3e9+KUdoSzi8G3GYIiJsvVBqxcnskjckBjifrDOAkDXyTG3Vj45rQXDcgRTQSJAkcu0sxn8yxJ/kkN4AkHXUqW54nXhn5ZRs/Kw+qdIBDnOM0hvnYAs8/B38mZxVlvXTkuWXCT1G5SX5L0DkHw1+Vk2qUGcfnbtIt1/+C91D56w0Pevyid6wrqkrU54wshb0bj5GDTPM9hs9A85zVBY8B89XJ5Q5sRFfqsFHQpWdcfp+ffwcpkJWoEzDkrUifv+fTOWI0j/TGTb3g/du9KSiiPlVEMs5bJi4VNca80AwsI3XkkPy8zmnOKub5Nx3h3QvVYYK031UbhcpKkzHOtoBwMe7Gy5hheePTF30burBcJO0h4EXWqomTN1QlQsuQq8YY40QmSMfm+OhRJawGBgFKbFhxm+X1PKT+iTZBU0uYL9vfX9VlF8UtK1jNIT48jTtgqOjkAtNLKUqM1SY/uoFi3mO/DoiRyUAm0MCKg2SctWoBLlrWEKlmw3MjmCjh5xC7Bae6E0Ba2TFHWW3a9vRZVMDyO78jiNpQ8h3KJLStzTZvAXhQnj3HyMRGtRaspWUUunOFPceZqktxQGVziLf6l6v3Had/UY0n1+ZAPW1g5rEw9oLko8+6TUqdSAKJMeLqHk4/yfjhQJ6Ya2dKVBRaw7MLiICMF2eO6769dFcBfeOz+34xSO6jcW/41Kz5Fpi0/o3oFOWKVtzjV/DqI51UZ51p81o9PcPKLTfOwcFKX4ItEXPK7TrlGFGQM+/GoSOxHhNYrE6rFMm4K9/26S5X4eTW2E3RFiloC+Bn5lmKI1NHpcfeimAt9XXkUuGJtakZaU5DxhJ86kVuNgX53dhxtbGob6wfrwPwUOi1RoVRHKWbdBDMpt17qW1VQ67S9LwyeuZK26uIq17hL8nJKpYc8K1ZlzW5OqnC+1W2DFyh3aoBrv/RiU9fn6ILemtq/H6jP2mLQuotLyMrzC33XqgVfLWn2uOqfOtzY/rfM71/5+s5jJvIlzTet0SoHGc+VQtpSqxmtu3gPPyjBvbUW4gYXAbL17ty6BQ0+oPYG+job8vUS+e/e5SeRb/hq8D8BzP734bfRaAAAAABJRU5ErkJggg==",N_e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAASbSURBVHgB7VjNbttGEJ4lKRdNC0RvUOYJ6j5B5Cdwcu7B5L2RIqCWa/Rg+dLCTgFLdu6kDj3HeYKqT1C9Qdg3UIEi/ZHJzTdLLrmiqEgmlVPyAYaH3NXu7OzMNzMk+oRmELRD/HwVdByb9hNJ7SSh6Wnfn1JD7ERBKOY6jgikpE5pKIpjeQBFI6qJxgoOr4L2A1v8AdFdMyV6G8tvhn1/TjVgUUM8sOkJFcrNEynHUsqJMcX93KLnVBMONYQQ4ghXqxCT7J/2/JDli3EQYewsm/OYaqKxBaGcq+WWtfeblu8Sus0nCWpTTTRWEJhpQSaL/CpbtuhpOUnkn1QTja8YUTq2bcF+SLjp5y+uQy+Tc6tJYVjznmhsQeY6MyhYMVM5DprTbuqXdbCLK6aTnu9ByXOIkfF6LhE0P/T82hH8QcCkzX+0I2ztg0zIXzgWHF92siuMEMKvB1teH6dB20HgSNpHVPNvJ29jut1E4FtlErYIAoEpxK1YYHTc9fqXN5OekHJo+B/zYHj87Oj88joM8OxVLL0xFW6lIDZ4Q+tTGa8yU5a571iK6aDrHawb3BgkfDWmcioYkFuX0tmyAvPsb2WMI5p/i4zjG3M62R6V2OiDlrVUoYSI2GEme7DsIZUoRUft5TgYIcf1TMWNiJ5hfF+PW7Y6xLRyf9oEUVgDCvz1vqlxQqGWF4Zcva54mMtyfSrcaMEkppltp7KFwuDyOpjFMU0dpDKTkNVilqpsVOprOdZj0lVEijYHywKZZ8+xDuEiXr5HUm09dQ56DxS12ORJUlXJtgk/hFpzLLwVQWNudNL1HtF9FUROvZJbbMLBkpVTbuU40w34suSPJqI00qs51aqp3ByL3jKHcZrj/7Sc5hSEoGmCsQGCQ0VuWjSU57k4BVxDBLzvyhrlFxkpv1naJJG/c2FKhZVWuEv9zhGvclqBVeI7+bRMwps4lfP3Sdcf6ecVC1ppCa+AqH19/MxjKw0zK+Xcxf6p5128nBw53JeYfAiZD3oxnhwZh+jQBk4Vqb/TWgVLIR9pIbNETjlftvYeZpu6IpGhXBNEQsiRLh6qOHXQ92fsJsba7V9e/vrVWgWFKJQCrRzqxX+6CczmiP5e/K84EVY6K86W5taST7aFbpruwakaKzzYQoWxsImdlS2i/BF+g+pjyW9CXYXgQPua7hAQvm7WcTA/KzBgubRp2oZT+ZDff/dt3iKsWLCPjWGBfum1q4XMSudUA6y8KFJamyOXDbDEGMstazXNYKGQr0mIoiGi1EfCpFQeSUS4lrFZwIGgaj/IxabFOnexKhSiqn05WIxcr7Cx3OJo/Qyn/Q8KVhWXGS3xl4W1mQaHfWQe6gpr/gu2cNKe2s0oaVz1LWdX32a8JYsVmKtmvkHT1FjBFzeTM1yNCytNQCMeAuJrfh/j6iWad7sljoQUEVfWVAONFLwA9WDzV9ljBC86XyBS4dhzfIZ7giKD86+bDkt/UMOSjRr35I7mmjZSRUTQyp5laS4rTjXQqC9WTXssn9KaqMzAtHXwIzIG1cDOPmCSTZ08KinNSFxk/JPQqO63wU/4KPAO1JpTy+WM/8YAAAAASUVORK5CYII=",P_e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAA4+SURBVHgB7Z1RbhtHEoarh1KwwD6scgPqBHFOEPkEiU8Q8jFY2xSBWEKeIj8FlgRQlrzI44xOYOcElk8Q5QTmDVaA7QSISPZ2kaKXlofD7pnunqLm/wBHjjQculX8p7u6uqqIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABxKAK1MEjTrdF7ukdKfas17ShNbU20xT8zRrky/7nkPxOt3+w/6r4iUAsQSGRmwkh6pPXuXBAWDJVS2cbG5Lz/Q3dIIBoQSESOz857WusDB2HcZkikn+497mYEogCBROLoNBsYYeySB1RCJ08edvoEggOBROD4NEsnRB3ySJJQ9uPDTpdAUBICQeGZw7c4mMmEOkcvsgGBoGAGCcjhadoxv+KUAqJJ9/cfd08IBAECCcTg17R9fa1em7+2KSxXm2O93e93rwh4B0usQIxGyfcUXhzM1t+JH+cffA4EEgiznduhSJgYSW8wSMtuHYMCIJAAHJ+l35HD7KEUXSil7/851l/uPe4o/rsR2DnZszXaMFF54J0NAt4xO0w7tt6dEQIH/g4Wv/fkUffCfLl49jzlCPrPVveZEIvygoBXMIMEQCXqK8tLs/3ep+JYhH/GswvZvec3BLwDgYRA2y13zFLKYhmln5IFWkfZEGgcEEgAbM9a3SylCtkY0SXZASc9ABBIjdjsPCG+US8QSACm+RwW2Ow8HZ2lO2QHhBQACCQEio+lW124cofK7GJ9TxYoZb0UAw5AIAHQE/3G6jpNO0dn50tFwj/jQ4lk955/EPAO4iABUAm9Mh/+ns21nEB1/CJrc2CQnfaPqbhmdjHf2yFLkgQxkBDgsGIA2PketdRbHW9naWgi8NsEvIMlVgB452mi9XOKhOOxFOAABBKILyZ0ouLsLA2Nn5IRCAIEEojpLGIZBa+GfvpTH5VOQgGBBGSa6RdyqWXujQonYYGTHgET7Mu0totn2KJ416vX7RAICmaQCJjt247XmcTcC+KIAwQSib1ed9d8srlMz5BKwk4/F2mY3QvEAEusyPwySNsmqNe5OULStnkNC4O3jf8yO2MHOLwYFQikRg5PM21zHafiQhj1gCXWGgBx1AcEAkABEAgABUAgABQAgQBQAAQCQAEQCAAFQCAAFACBAFAABAJAARAIAAVAIAAUAIEAUAAEAkABEAgABUAgABQAgQBQAAQCQAEQCAAFQCAAFACB1AS3OSAgHlQ1icys/0fSI613HdojcL/0bGNjct7/AXV4YwKBROT47LzHDXMq9A0ZcrFq1OONBwQSiaPTbGCE4aUiokro5MnDTp9AcCCQCByfZumE7HoN2pIklP34sNMlEBQ46YHhmcO3OBhu7nn0IhsQCApmkIAcnqYd8ytOKSBczHrahwQEAQIJxODXtH19rV6TZYHqClxtjvV2H+VJg4AlViBGo8S6entFtv5OCO0QAgGBBMJs53YoEiZG0uPW0wS8A4EE4Pgs/Y4cZg+l6EIpfZ/bHOw95tYh+r5ja+et0QbdI+CdDQLeMTtMO7benRECB/4OFr/35FH3wny5ePY85Qj6z1b3mRCL8oKAVzCDBEAl6ivLS7P93qfiWIR/xrML2b3nNwS8A4GEQNstd8xSymIZZddrXesoGwKNAwIJgO1Zq5ulVCEbI7okO+CkBwACqRGbnSfEN+oFAgkAd6W1uc5m5+noLN0hOyCkAEAgIVC2vdBX71DdtItefSdlvRQDDkAgAdAT/cbqOk07R2fnS0XCP+NDiWT3nn8Q8A7iIAFQCb0yH/6ezbWcQHX8ImtzYJCd9lnGIS+91M/meztkSdJS/yLgHRxWDAA/+fmDT7Exy6zNDf0Aabn+gEA8U5s4/s9wc1Pfh0j8AIF4gpdG4/cqnejpkY+6udJKd/cfdV8RqAQE4oGIuR9OmB2wgyePvreKxIN8IJCKDP6T3rseq5ckTBxzUOChGhBIBbiMz0Rr+emucN5LA4GURIAz7gqc9xJAII7U6YzzERYzY/1mG13PAc67I4ikOzB1xt+p38uKQ3GWYEt/zUlSRLbHUWbC4Nd8GOvt/V63w/dwef0CW0qrl0XRe/ApmEEsqeqM8wf8dnIUp+aOJrTT4gQrTffmx+Snhx0VDccT/aZlovIfRnR5cOtU7y+DtN1qld85g/NuBwRiQRVnfPr0J90PUU+Xj8tfb6iUyi734LyvBAJZQUVnfEhj/WCv3w160vbZ8/TANnc9BzjvBUAgS6jsjJun83ikH/zUj/PBe3aa7ipSZUuRwnlfAgSSQ9XIODvjHya0exA5G/DQ+ElUwU9C5P1zIJBbhHDGYwLn3S8QyAJSnXFX4Lz7AwK5YR2ccVfgvFen8QJZN2fcFTjv1Wi0QNbVGXcFznt5GiuQdXfGXYHzXo61E8jHogZKfctVQZSm9q0jGpf8xzjbb5YtDe6KM+5KCOfdhz0kszYC8dVf/C464674cN7pH3TVhH7vayEQX/3FE/OUu6vOuCtVnXf+4DSh37t4gfjsL16WdXHGXanqvFdlHfwa0QIJ0V/clXVzxl2p6rxXRXq/d7EJU6H6i9syK0BtYgB3WBwMLxk3x/prM+BaHGjp/d5FziAx+ouv4E44465UdN4rIbXfuziB1F5j6o45465UdN6rILLfu7glVsT+4p/BzvifI32/qeJgpk/x8jnvVRDZ713cDHJ4mr2lGgRy151xV2py3sXNIqJmkBr6izfGGXeFZ9FEaact2LvY711Uf5Ba+osbA+711u/YSAzQ713YDIL+4rKAPaQ56egvLgvYQ5ZA0F9cFrDHmpYeRX9xWdxle8jyQdBfXBSwh7QZBP3FZQF7CPNB0F9cFLCHsDhILf3FEzl77tKAPYQdNWFnb9RSb3W8nYwrE/H9kkAuNdiDNjf1tqR0XFk+yNZ0azGmk7Zlnnp1HqsXDe88aRX3ic4nuflENwlBjEB4Sr5+H/+YO6+NIZJ8pn5F/FZzbUkiEbHE+igOXd9BNempn7ER0KRUROnT2gUiQRxzIJIZgjr41i6SWgUiSRxzmi4Sge2taxVJbQKRKI45TRWJ4N7vtYmkFoFIFsecpolEsDjm1CKS6LtYlcQxK00ztL981l/8pi+5E03a3Sorjpscj6H19Tf24ExD5b6dX8vuVtQZpNrMobvzUpWHp5m2eQWnfs6rIZYtaXPXZ5Ky4ljM4T86y37XFjZlYcyPxnNVRzVWr0sEIaPOJKUF4lrV25c4GFuBcF704v9XEUnrn7ovuYp5mSrrPsQxu0/2mt9z1esWBcJUEQm19AM1Ma8LbA9ngZStsn7ztU3OfCoOpqxAmEjF0aJVMS9f9Z6GNh/q2+RVfykrEKaCSFwobQ8nH4SrrI/eqbclKq23yZM4qsLGLeOTOMKH9g54zTyrEhmGKvbwJY6q7P27e6lbpXwSF0rbw1og01q5Wp/EO7jmXxxzIomEaXMJ1RC1Z2PbQwesGxZJJEzb1R5WAuEq63FbEIQTx5yIIuFSNrs+d8Ri2yOkOOZEFImTPVYKJH6V9fDimBNTJL6qmMe2RwxxzIkpElt7FAqE12t3bea4TeyZhItDU0li26OOcqyxZ5JV9lgqkFlAJmYp/PjimDP9EGj9nCKgzO/UpgrIbWLbow5xzGGRmB2vKLGnVfZYKpDIVdazuvvVqST5L8WhVBXzqPbQ+re6axVrSmyrOlal0B5LBWKeIB2Kx3dlnqo+iTlesyffcx1vVHso9Q3sMSNXIDVUWa+1qrf08cIexYQcb25Vk6ZV9ZY+XthjOaHHmzuDNK2qt/Txwh5LCT7efB+kaVW9pY8X9sglxnhzBdK0qt7Sxwt75BNjvJUSpppWZV36eGGPz6k63nwfpGFVvaWPF/bIJ8Z482eQplX1lj5e2GPZhcHHm++DNKyqt/Txwh5Lrosw3tw4SNOqeksfL+yxnNDjzQ3H1FDVe2gioNs2F05z298pq3NTeSm3ufcUPF5Guj1G79XLsim3ufcUNN7cJRZ7/pNIp1sZm2MBbAieMjnFlCw5PM3e8mtWlYqRON5FpNvDNn1Xa5Wumz2WbvN+MaETFWcnY2jWiVnRBdVyr+1ykSWNNw/YIxiF410qkKmKKUYikX76U395pQlPudftVbnIUsa7DNgjFMXjLQwU7j/ungRNJDL3LsoD8Z17vSoXue7xrgL28IyFPaycWBNsycz60Wo/2RbFuw69bmfZz/lJFSq91OySnDx52Okv+3kd43UB9vDwnpb2sDpqYnYeOl6VbO5V9I8LnXu9Khc59nhdgT2qvqG9PSxP3c+YOVbT6GWbSsBOF68rp1PnEniHg524su/hwNXmWG8XndWJMd4qwB5ulLGH02FFXq+Nx9NsLXaehravm1f1/mB+Aav+cRFzr1fmhscYbxVgDzuq2MNpBrkNp0aOJrTT4gQXTfduFQ8ejif6TctERT+M6PLA8lQlxy4oXrGIlU+tRUKM1yewh397VBKIb3jAE61e2l4/yxYzT4abXwCf3OSzN7YH1Gb3sIvuNhHYY8lZrLpoWu61dGAPQX3SmablXksH9hAmkMblXksH9pAlkKblXksH9pA2g1jStNxr6dxle8jyQRqWey0d2EPaDNK03GvpwB7CfJCG5V5LB/YQFgdpWu61dGAPYZF06bnhTQP2ELbEkp4b3jRgD4HbvNJzw5tG0+0hTiDSc8ObRtPtITJQKD03vGk02R6inPTbSM8NbxpNtIfooybSc8ObRhPtIf4s1l6vu8s91MkhxfI205RL0v3ZvUAVmmYP0UusRX4ZpG0TRJpnp7VtXjNN0jdPqb/MTswBDi96pSn2WBuBLCI9N7xpwB4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQFT+Bzz+xkF0U3qvAAAAAElFTkSuQmCC",zU="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAGBSURBVHgB7VRNToNAFH7DQNNUEz2C3qDeoN5AT1C4gISNxriALoyxLIjhAMANuIHeoN5Aj1AT00VhGN+zDhnoAmJ11y+BvPnmvS8z834A/gv3UTKGX0KPNRRhcbYI48xXG2GcLh6iZNIODuNkMse9IEqON+vMp1glatLvznNeH5+SGZoBOkBZVpmUMOYcTtqCyBM3PrQGR+jrSikD/GakUZ+QcOM63xvkwDnzoQNVVQRKjGIbVybQFaoKUnTIcGlDN8gnpRh1/Ybggcme8WRvjLEp9IdNMUMDUkWYyliX0rHwbXTvFUDeVrAE5AXIBoerd9jjz8CUQV3BoVnIlJTAc5Y6RyUyArjQOYFJufWcF7LrLGP6XWg5jjbZTBscJx+W6BxnQF1yRnZdh9dX9qUQ8vSnsPsipZhVKc8VYei7pmlMqbD7iKqOohj9WWpBmhqqN7Gdgi5Bzge+6n19StXjS2/0IcCS4bsItt0BQiDHIP8s1h/6QNmap/MdBuwusZ34AqqeySypGlPUAAAAAElFTkSuQmCC",VU=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Ws=(()=>{if(typeof document>"u")return!1;const r=VU[0],e={};for(const t of VU)if((t==null?void 0:t[1])in document){for(const[i,a]of t.entries())e[r[i]]=a;return e}return!1})(),HU={change:Ws.fullscreenchange,error:Ws.fullscreenerror};let Ii={request(r=document.documentElement,e){return new Promise((t,n)=>{const i=()=>{Ii.off("change",i),t()};Ii.on("change",i);const a=r[Ws.requestFullscreen](e);a instanceof Promise&&a.then(i).catch(n)})},exit(){return new Promise((r,e)=>{if(!Ii.isFullscreen){r();return}const t=()=>{Ii.off("change",t),r()};Ii.on("change",t);const n=document[Ws.exitFullscreen]();n instanceof Promise&&n.then(t).catch(e)})},toggle(r,e){return Ii.isFullscreen?Ii.exit():Ii.request(r,e)},onchange(r){Ii.on("change",r)},onerror(r){Ii.on("error",r)},on(r,e){const t=HU[r];t&&document.addEventListener(t,e,!1)},off(r,e){const t=HU[r];t&&document.removeEventListener(t,e,!1)},raw:Ws};Object.defineProperties(Ii,{isFullscreen:{get:()=>Boolean(document[Ws.fullscreenElement])},element:{enumerable:!0,get:()=>{var r;return(r=document[Ws.fullscreenElement])!=null?r:void 0}},isEnabled:{enumerable:!0,get:()=>Boolean(document[Ws.fullscreenEnabled])}});Ws||(Ii={isEnabled:!1});const cg=Ii,D_e={class:"graph_container"},L_e=["src"],I_e=["src"],O_e=["src"],F_e=["src"],B_e=["src"],U_e=["src"],k_e=["src"],G_e=["src"],z_e=["src"],V_e=["src"],H_e={key:3,class:"konwlege_tools"},W_e=["src"],q_e={class:"item_label"},$_e={class:"item_self"},X_e={class:"item_value"},Y_e={class:"item_name"},j_e={class:"item_value"},K_e={key:0,class:"drawer_item"},Q_e={class:"item_self"},Z_e={class:"item_value"},J_e={class:"item_name"},exe={class:"item_value"},txe=Hr({__name:"GraphPage",props:{graphData:{type:Object,default:()=>({nodes:[],edges:[]})},whichComponent:{type:Number,default:()=>0},isShowOptions:{type:Boolean,default:()=>!0},isAddEvents:{type:Boolean,default:()=>!0},isDbclickEvents:{type:Boolean,default:()=>!1},isDbclickhandle:{type:Boolean,default:()=>!1},prevData:{type:Object,default:()=>({nodes:[],edges:[]})},isKnowlegeModel:{type:Boolean,default:()=>!1},isShowHeader:{type:Boolean,default:()=>!1},customPosition:{type:Boolean,default:()=>!1},isCalcColors:{type:Boolean,default:()=>!1},isCxttapstart:{type:Boolean,default:()=>!1},bluePrintId:{type:String,default:()=>""},currentPathIdx:{type:Number,default:()=>-1},pathsData:{type:Array,default:()=>[]},startEndPoints:{type:Array,default:()=>[]}},emits:["regetGraphData","initGraphData","getMoreDataFn","updatePosition","sendGraphRenderFinish"],setup(r,{expose:e,emit:t}){const n=r;Mi("isShowOptionsProps",n.isShowOptions),Mi("whichComponentProps",n.whichComponent),Mi("isAddEventsProps",n.isAddEvents),Mi("isDbclickEventsProps",n.isDbclickEvents),Mi("isDbclickhandleProps",mh(()=>n.isDbclickhandle)),Mi("isKnowlegeModelProps",n.isKnowlegeModel),Mi("customPositionProps",n.customPosition),Mi("isCalcColorsProps",n.isCalcColors),Mi("isCxttapstartProps",n.isCxttapstart),Mi("bluePrintIdProps",mh(()=>n.bluePrintId)),Mi("currentPathIdxProps",mh(()=>n.currentPathIdx)),Mi("pathsDataProps",mh(()=>n.pathsData)),Mi("startEndPointsProps",n.startEndPoints);const i=t,a=mh(()=>l.toggleView==="2d"),s=ea(null),o=ea(null),l=Wr({cy:null,initLoading:!1,toggleView:"2d",toolbarActive:!0,currentNode:[],currentEdge:{},isFullscreen:!1,layout:"fcose",graphWidth:"",graphHeight:"",manualFullscreen:!1});Og(()=>n.graphData,g=>{g.nodes.length&&(l.initLoading=!1)},{deep:!0});const u=(g=[],y={})=>{g.length&&g[0].__threeObj?(l.currentNode=[],l.currentEdge={},l.currentNode.push(...g),y&&(l.currentEdge=y)):(l.currentNode=g,l.currentEdge=y)},c=async g=>{if(l.isFullscreen=!l.isFullscreen,g){const _=document.getElementsByClassName("graph_container")[n.whichComponent];cg.isEnabled&&cg.toggle(_)}const y=document.getElementsByClassName("graph_container")[n.whichComponent];if(y.style.position=l.isFullscreen?"static":"relative",l.isFullscreen)l.manualFullscreen=!l.manualFullscreen;else{const _=document.getElementsByClassName("graph_container")[n.whichComponent].parentNode;_.style.width=l.graphWidth+"px",_.style.height=l.graphHeight+"px",l.manualFullscreen=!l.manualFullscreen}setTimeout(()=>{d(l.layout,!0)},200)},h=()=>{cg.on("change",()=>{setTimeout(()=>{!cg.isFullscreen&&l.manualFullscreen&&c(!1)},500)})},d=(g,y)=>{l.layout=g,s.value.switchLayout(g,y)},f=g=>{l.currentNode=[],l.currentEdge={},g?l.toggleView==="2d"?l.toggleView="3d":l.toggleView="2d":l.toggleView==="3d"&&(l.toggleView="2d"),l.toggleView==="2d"&&(l.initLoading=!0,i("initGraphData",n.whichComponent),setTimeout(()=>{i("regetGraphData",n.whichComponent)},200))},p=(g,y)=>{i("getMoreDataFn",g,y)};br(()=>{_v(()=>{setTimeout(()=>{l.graphWidth=document.getElementsByClassName("graph_container")[0].parentNode.clientWidth,l.graphHeight=document.getElementsByClassName("graph_container")[0].parentNode.clientHeight,h()},0)})});const m=g=>{l.cy=g,i("sendGraphRenderFinish",g)},v=(g,y)=>{i("updatePosition",g,y)};return e({state:l}),(g,y)=>{const _=Hn("el-tooltip"),x=jH("loading");return Is((Ye(),tt("div",D_e,[a.value?(Ye(),hi(hQ,{key:0,ref_key:"Cytoscape2DRef",ref:s,graphData:n.graphData,prevData:n.prevData,onNodeAndEdgeClick:u,onGetMoreData:p,onToggleMask:g.toggleMaskFn,onUpdatePosition:v,onSendCy:m},null,8,["graphData","prevData","onToggleMask"])):(Ye(),hi(b_e,{key:1,ref_key:"ForceGraph3DRef",ref:o,graphData:n.graphData,onNodeAndEdgeClick:u},null,8,["graphData"])),n.graphData.nodes&&n.graphData.nodes.length&&!n.isKnowlegeModel&&!n.isShowHeader?(Ye(),tt("div",{key:2,class:Mo(["graph_tools",l.toolbarActive?"":"close"])},[Ue("img",{class:"tool_img",src:l.toolbarActive?Nt(E_e):Nt(T_e),onClick:y[0]||(y[0]=E=>l.toolbarActive=!l.toolbarActive)},null,8,L_e),a.value&&l.toolbarActive?(Ye(),tt($n,{key:0},[kt(_,{class:"box-item",effect:"dark",content:"\u5E7F\u5EA6\u4F18\u5148\u5E03\u5C40",placement:"right-start"},{default:zt(()=>[Ue("img",{src:Nt(w_e),class:"tool_img",onClick:y[1]||(y[1]=E=>d("breadthfirst"))},null,8,I_e)]),_:1}),kt(_,{class:"box-item",effect:"dark",content:"\u7F51\u683C\u5E03\u5C40",placement:"right-start"},{default:zt(()=>[Ue("img",{src:Nt(S_e),class:"tool_img",onClick:y[2]||(y[2]=E=>d("grid"))},null,8,O_e)]),_:1}),kt(_,{class:"box-item",effect:"dark",content:"\u540C\u5FC3\u5706\u5E03\u5C40",placement:"right-start"},{default:zt(()=>[Ue("img",{src:Nt(A_e),class:"tool_img",onClick:y[3]||(y[3]=E=>d("concentric"))},null,8,F_e)]),_:1}),kt(_,{class:"box-item",effect:"dark",content:"\u73AF\u5F62\u5E03\u5C40",placement:"right-start"},{default:zt(()=>[Ue("img",{src:Nt(C_e),class:"tool_img",onClick:y[4]||(y[4]=E=>d("circle"))},null,8,B_e)]),_:1}),kt(_,{class:"box-item",effect:"dark",content:"\u529B\u5BFC\u5E03\u5C40",placement:"right-start"},{default:zt(()=>[Ue("img",{src:Nt(N_e),class:"tool_img",onClick:y[5]||(y[5]=E=>d("d3-force"))},null,8,U_e)]),_:1}),kt(_,{class:"box-item",effect:"dark",content:"\u5F39\u7C27\u5185\u7F6E\u5E03\u5C40",placement:"right-start"},{default:zt(()=>[Ue("img",{src:Nt(R_e),class:"tool_img",onClick:y[6]||(y[6]=E=>d("fcose"))},null,8,k_e)]),_:1}),kt(_,{class:"box-item",effect:"dark",content:"\u6811\u5F62\u56FE\u5E03\u5C40",placement:"right-start"},{default:zt(()=>[Ue("img",{src:Nt(P_e),class:"tool_img",onClick:y[7]||(y[7]=E=>d("dagre"))},null,8,G_e)]),_:1}),kt(_,{class:"box-item",effect:"dark",content:"\u968F\u673A\u5E03\u5C40",placement:"right-start"},{default:zt(()=>[Ue("img",{src:Nt(M_e),class:"tool_img",onClick:y[8]||(y[8]=E=>d("random"))},null,8,z_e)]),_:1}),kt(_,{class:"box-item",effect:"dark",content:l.isFullScreen?"\u7F29\u5C0F":"\u653E\u5927",placement:"right-start"},{default:zt(()=>[Is(Ue("img",{src:l.isFullScreen?Nt(zU):Nt(GU),class:"tool_img",onClick:y[9]||(y[9]=E=>c(!0))},null,8,V_e),[[Co,a.value]])]),_:1},8,["content"])],64)):on("",!0),l.toolbarActive?Is((Ye(),tt("span",{key:1,class:"tool_img tool_font",onClick:y[10]||(y[10]=E=>f(!0))},Kt(a.value?"3d":"2d"),513)),[[Co,l.isFullscreen]]):on("",!0)],2)):on("",!0),n.isKnowlegeModel&&!n.isShowHeader?(Ye(),tt("div",H_e,[Ue("img",{src:l.isFullScreen?Nt(zU):Nt(GU),class:"tool_img",onClick:y[11]||(y[11]=E=>c(!0))},null,8,W_e)])):on("",!0),Is(Ue("div",{class:"graph_drawer",style:ia({backgroundColor:a.value?"transparent":"rgba(255, 255, 255, 0.8)"})},[(Ye(!0),tt($n,null,_r(l.currentNode,(E,T)=>(Ye(),tt("div",{class:"drawer_item",key:T},[y[13]||(y[13]=Ue("div",{class:"item_title"},"\u5B9E\u4F53\u5C5E\u6027",-1)),Ue("div",q_e,Kt(E.name||g.name.type),1),Ue("div",$_e,[y[12]||(y[12]=Ue("span",{class:"item_name"},"\u6982\u5FF5\u672C\u4F53\uFF1A",-1)),Ue("span",X_e,Kt(E.label),1)]),(Ye(!0),tt($n,null,_r(Object.keys(E.properties),(b,w)=>(Ye(),tt("div",{class:"item_property",key:w},[Ue("span",Y_e,Kt(b)+"\uFF1A",1),Ue("span",j_e,Kt(decodeURIComponent(encodeURIComponent(E.properties[b]))),1)]))),128))]))),128)),Object.keys(l.currentEdge).length?(Ye(),tt("div",K_e,[y[15]||(y[15]=Ue("div",{class:"item_title"},"\u5173\u7CFB\u5C5E\u6027",-1)),Ue("div",Q_e,[y[14]||(y[14]=Ue("span",{class:"item_name"},"\u5173\u7CFB\u672C\u4F53\uFF1A",-1)),Ue("span",Z_e,Kt(l.currentEdge.label),1)]),(Ye(!0),tt($n,null,_r(Object.keys(l.currentEdge.properties),(E,T)=>(Ye(),tt("div",{class:"item_property",key:T},[Ue("span",J_e,Kt(E)+"\uFF1A",1),Ue("span",exe,Kt(l.currentEdge.properties[E]),1)]))),128))])):on("",!0)],4),[[Co,l.currentNode.length]])])),[[x,l.initLoading]])}}});const nxe=Nr(txe,[["__scopeId","data-v-9a585a7b"]]),rxe=r=>(!r.nodes||r.edges||(r.nodes=r.nodes.map((e,t)=>({...e,id:ta.exports(e.id),uuid:e.id,name:e.properties.name||e.properties.label,rootId:`${t+1}000`,isExpand:!1})),r.edges=r.relationships.map((e,t)=>({...e,source:ta.exports(e.start),target:ta.exports(e.end),rootId:`${t+1}000`}))),r),ixe={class:"llmGraph"},axe=Hr({__name:"index",props:["componentProps","listIdx"],setup(r){const e=r,t=Wr({graphData:{nodes:[],edges:[]}});return br(()=>{t.graphData=rxe(e.componentProps.graphData[e.listIdx])}),(n,i)=>(Ye(),tt("div",ixe,[kt(nxe,{graphData:t.graphData,class:Mo(`graph_container_${e.listIdx}`),listIdx:e.listIdx,style:{width:"370px",height:"400px"}},null,8,["graphData","class","listIdx"])]))}});const sxe=Nr(axe,[["__scopeId","data-v-1d1b08be"]]),oxe=["innerHTML"],lxe=Hr({__name:"index",props:["componentProps"],setup(r){const e=r;return Wr({}),br(()=>{}),(t,n)=>(Ye(),tt("div",{class:"llmHtml",style:ia({width:e.componentProps.unifyWidth})},[Ue("div",{innerHTML:e.componentProps.htmlData.html},null,8,oxe)],4))}});const uxe=Nr(lxe,[["__scopeId","data-v-fd464f57"]]),cxe=["src"],hxe={key:1,class:"imageFlex"},fxe=["src"],dxe=Hr({__name:"index",props:["componentProps"],setup(r){const e=r;return Wr({}),br(()=>{}),(t,n)=>{const i=Hn("el-carousel-item"),a=Hn("el-carousel");return Ye(),tt("div",{class:"llmIamgePreview",style:ia({width:e.componentProps.unifyWidth})},[e.componentProps.imageData.type==="Carousel"?(Ye(),hi(a,{key:0,height:"400px"},{default:zt(()=>[(Ye(!0),tt($n,null,_r(e.componentProps.imageData.images,(s,o)=>(Ye(),hi(i,{key:o},{default:zt(()=>[Ue("img",{class:"carouselImg",src:s},null,8,cxe)]),_:2},1024))),128))]),_:1})):(Ye(),tt("div",hxe,[(Ye(!0),tt($n,null,_r(e.componentProps.imageData.images,(s,o)=>(Ye(),tt("img",{key:o,src:s},null,8,fxe))),128))]))],4)}}});const pxe=Nr(dxe,[["__scopeId","data-v-9a6c4dec"]]),gxe=["src"],vxe={key:1,class:"llmLink_links"},mxe=Hr({__name:"index",props:["componentProps"],setup(r){const e=r;Wr({type:"out"});const t=()=>{window.open(e.componentProps.linkData.url)};return br(()=>{}),(n,i)=>(Ye(),tt("div",{class:"llmLink",style:ia({width:e.componentProps.unifyWidth})},[e.componentProps.linkData.type==="iframe"?(Ye(),tt("iframe",{key:0,src:e.componentProps.linkData.url,frameborder:"0"},null,8,gxe)):(Ye(),tt("div",vxe,[i[0]||(i[0]=ji(" \u94FE\u63A5\uFF1A ")),Ue("span",{onClick:t},Kt(e.componentProps.linkData.title),1)]))],4))}});const yxe=Nr(mxe,[["__scopeId","data-v-6967e5a4"]]),_xe={mapInstance:null,INIT_MAP:function(r,e){this.mapInstance=zm.map(r,{minZoom:6,maxZoom:13,center:e.center,zoom:e.level,zoomControl:!1,attributionControl:!1,crs:zm.CRS.EPSG3857}),zm.tileLayer(`${e.url}/{z}/{x}/{y}`).addTo(this.mapInstance)}},xxe=["id"],bxe=Hr({__name:"index",props:["componentProps"],setup(r){const e=r;Wr({});const t=()=>{_xe.INIT_MAP(`mapContainer${e.componentProps.mapData.randomNum}`,e.componentProps.mapData.options)};return br(()=>{setTimeout(()=>{t()},500)}),(n,i)=>(Ye(),tt("div",{class:"llmMap",style:ia({width:e.componentProps.mapData.unifyWidth})},[Ue("div",{class:"mapContainer",id:`mapContainer${e.componentProps.mapData.randomNum}`},null,8,xxe)],4))}});const Exe=Nr(bxe,[["__scopeId","data-v-65f4977d"]]),Txe={class:"llmMarkdown"},wxe=["innerHTML"],Sxe=Hr({__name:"index",props:["componentProps"],setup(r){const e=r;return KH(),ea("<p>hello</p>"),ea("default"),br(()=>{console.log("props",e)}),(t,n)=>(Ye(),tt("div",Txe,[Ue("div",{class:"llmMarkdown_content",innerHTML:Nt(bw)({content:e.componentProps.markdownData})},null,8,wxe)]))}});const Axe=Nr(Sxe,[["__scopeId","data-v-719ad235"]]),Mxe=Hr({__name:"index",props:["componentProps","listIdx"],setup(r){const e=r;return Wr({}),br(()=>{}),(t,n)=>{const i=Hn("el-table-column"),a=Hn("el-table");return Ye(),tt("div",{class:"llmTable",style:ia({width:e.componentProps.unifyWidth})},[kt(a,{data:e.componentProps.tableData.rows,border:"",style:{width:"100%"}},{default:zt(()=>[(Ye(!0),tt($n,null,_r(e.componentProps.tableData.headers,(s,o)=>(Ye(),hi(i,{prop:s,label:s,width:"180",key:o},null,8,["prop","label"]))),128))]),_:1},8,["data"])],4)}}});const Cxe=Nr(Mxe,[["__scopeId","data-v-83518b83"]]),Rxe={class:"desc"},Nxe=Hr({__name:"index",props:["componentProps","listIdx"],setup(r){const e=r,t=Wr({data:[]}),n=i=>{t.data=[];let a=Object.keys(i.data),s=Object.values(i.data);a.map((o,l)=>{t.data.push({label:o,value:s[l]})})};return br(()=>{Object.keys(e.componentProps.descData).length&&n(e.componentProps.descData)}),(i,a)=>{const s=Hn("el-descriptions-item"),o=Hn("el-descriptions");return Ye(),tt("div",Rxe,[kt(o,{direction:e.componentProps.descData.direction,border:e.componentProps.descData.border,column:e.componentProps.descData.column||3,size:"default"},{default:zt(()=>[(Ye(!0),tt($n,null,_r(t.data,(l,u)=>(Ye(),hi(s,{label:l.label,key:u},{default:zt(()=>[ji(Kt(l.value),1)]),_:2},1032,["label"]))),128))]),_:1},8,["direction","border","column"])])}}}),Pxe={class:"time_line"},Dxe={class:"timeline_title"},Lxe={class:"text"},Ixe={class:"url_icon"},Oxe=["src","onClick"],Fxe=["src","onClick"],Bxe={class:"content"},Uxe=Hr({__name:"index",props:["componentProps","listIdx"],setup(r){const e=r,t=Wr({data:{},content:"",showDialog:!1}),n=a=>{window.open(a,"_blank")},i=a=>{t.showDialog=!0,t.content=a.content};return br(()=>{t.data=e.componentProps.timeLineData,console.log(t.data)}),(a,s)=>{const o=Hn("el-tooltip"),l=Hn("el-timeline-item"),u=Hn("el-timeline"),c=Hn("el-dialog");return Ye(),tt("div",Pxe,[kt(u,{style:{"max-width":"100%","padding-top":"10px"}},{default:zt(()=>[(Ye(!0),tt($n,null,_r(t.data.data,(h,d)=>(Ye(),hi(l,{key:d,placement:t.data.placement,hollow:t.data.hollow==="true",center:t.data.center,size:t.data.size,timestamp:h.datatime,type:t.data.type||"info"},{default:zt(()=>[Ue("div",Dxe,[Ue("div",Lxe,Kt(h.title),1),Ue("div",Ixe,[h.url&&h.url.length>0?(Ye(),hi(o,{key:0,content:"\u67E5\u770B\u94FE\u63A5"},{default:zt(()=>[Ue("img",{src:Nt(Fg).getAssetsFile("icon/jump_url.png"),onClick:f=>n(h.url)},null,8,Oxe)]),_:2},1024)):on("",!0),h.content&&h.content.length>0?(Ye(),hi(o,{key:1,content:"\u67E5\u770B\u8BE6\u60C5"},{default:zt(()=>[Ue("img",{src:Nt(Fg).getAssetsFile("icon/detail.png"),onClick:f=>i(h)},null,8,Fxe)]),_:2},1024)):on("",!0)])])]),_:2},1032,["placement","hollow","center","size","timestamp","type"]))),128))]),_:1}),kt(c,{modelValue:t.showDialog,"onUpdate:modelValue":s[0]||(s[0]=h=>t.showDialog=h),title:"\u8BE6\u60C5"},{default:zt(()=>[Ue("div",Bxe,Kt(t.content),1)]),_:1},8,["modelValue"])])}}});const kxe=Nr(Uxe,[["__scopeId","data-v-4439c193"]]),Gxe={class:"llmReentry"},zxe={key:0,class:"llmReentry_normal"},Vxe={class:"llmReentry_card_and_link_box"},Hxe={key:0,class:"llmReentry_link"},Wxe={class:"llmReentry_link_title"},qxe={class:"llmReentry_link_targetList"},$xe=["onClick"],Xxe=["src"],Yxe={class:"triangle"},jxe={key:1,class:"llmReentry_card"},Kxe={class:"llmReentry_card_title"},Qxe={class:"llmReentry_card_list"},Zxe=["onClick"],Jxe={class:"llmReentry_card_item_header"},ebe={class:"title"},tbe={class:"llmReentry_card_item_content"},nbe={class:"triangle"},rbe=["src"],ibe=Hr({__name:"index",props:["componentProps","listIdx"],emits:["reentryQuest"],setup(r,{emit:e}){const t=r,n=e,i=Wr({selections:[]}),a=l=>{i.selections.indexOf(l.value)>-1?i.selections.splice(i.selections.indexOf(l.value),1):i.selections.push(l.value),t.componentProps.reentryObj[t.listIdx].template.multiple||o(l)},s=()=>{let l="";t.componentProps.reentryObj[t.listIdx].template.option.map(u=>{i.selections.indexOf(u.value)>-1&&(l+=`${u.title}${t.componentProps.reentryObj[t.listIdx].type==="CARD"?"-"+u.text:""};`)}),console.log("paramsparamsparamsparamsparams",{text:`\u5DF2\u9009\u62E9\uFF1A ${l}`,value:i.selections.join("|*|"),reentryParams:t.componentProps.reentryObj[t.listIdx]}),n("reentryQuest",{text:`\u5DF2\u9009\u62E9\uFF1A ${l}`,value:i.selections.join("|*|"),reentryParams:t.componentProps.reentryObj[t.listIdx]})},o=l=>{n("reentryQuest",{text:`\u5DF2\u9009\u62E9\uFF1A ${l.title}${t.componentProps.reentryObj[t.listIdx].type==="CARD"?"-"+l.text:""}`,value:l.value,reentryParams:t.componentProps.reentryObj[t.listIdx]})};return br(()=>{}),(l,u)=>{const c=Hn("svg-icon"),h=Hn("el-button");return Ye(),tt("div",Gxe,[t.componentProps.reentryObj[t.listIdx].type==="NORMAL"?(Ye(),tt("div",zxe,Kt(t.componentProps.reentryObj[t.listIdx].message),1)):on("",!0),Ue("div",Vxe,[t.componentProps.reentryObj[t.listIdx].type==="LINK"?(Ye(),tt("div",Hxe,[Ue("div",Wxe,Kt(t.componentProps.reentryObj[t.listIdx].message)+"\uFF1A",1),Ue("div",qxe,[(Ye(!0),tt($n,null,_r(t.componentProps.reentryObj[t.listIdx].template.option,(d,f)=>(Ye(),tt("div",{key:f,class:Mo(["llmReentry_link_targetList_item llmPage_common_flex_default",i.selections.indexOf(d.value)>-1?"llmReentry_link_targetList_item_active":""]),onClick:p=>t.componentProps.reentryObj[t.listIdx].template.multiple?a(d):o(d)},[Ue("img",{src:Nt(Fg).getAssetsFile("icon/icon_target.png")},null,8,Xxe),Ue("span",null,Kt(d.title),1),Is(Ue("div",Yxe,[kt(Nt(nC))],512),[[Co,i.selections.indexOf(d.value)>-1]])],10,$xe))),128))])])):on("",!0),t.componentProps.reentryObj[t.listIdx].type==="CARD"?(Ye(),tt("div",jxe,[Ue("div",Kxe,Kt(t.componentProps.reentryObj[t.listIdx].message)+"\uFF1A",1),Ue("div",Qxe,[(Ye(!0),tt($n,null,_r(t.componentProps.reentryObj[t.listIdx].template.option,(d,f)=>(Ye(),tt("div",{class:"llmReentry_card_item",key:f,onClick:p=>t.componentProps.reentryObj[t.listIdx].template.multiple?a(d):o(d)},[Ue("div",Jxe,[Ue("div",ebe,Kt(d.title),1),kt(c,{iconName:"icon-chongru",className:"svg_icon_default",color:"#1776ff"})]),Ue("div",tbe,Kt(d.text),1),Is(Ue("div",nbe,[kt(Nt(nC))],512),[[Co,i.selections.indexOf(d.value)>-1]])],8,Zxe))),128))])])):on("",!0),t.componentProps.reentryObj[t.listIdx].template&&Object.keys(t.componentProps.reentryObj[t.listIdx].template).length&&t.componentProps.reentryObj[t.listIdx].template.multiple?(Ye(),hi(h,{key:2,type:"primary",class:"llmReentry_confirm_btn",onClick:s},{default:zt(()=>[Ue("img",{src:Nt(Fg).getAssetsFile("icon/confirm_btn.png"),style:{"margin-right":"5px"}},null,8,rbe),u[0]||(u[0]=ji("\u786E\u8BA4"))]),_:1})):on("",!0)])])}}});const abe=Nr(ibe,[["__scopeId","data-v-e3d9f495"]]),sbe={class:"llmText"},obe=Hr({__name:"index",props:["componentProps"],setup(r){const e=r;return br(()=>{}),(t,n)=>(Ye(),tt("div",sbe,Kt(e.componentProps.textData),1))}});const lbe=Nr(obe,[["__scopeId","data-v-a735937d"]]);function ube(r){switch(r){case"Echarts":return lW;case"FilePreview":return hW;case"Graph":return sxe;case"HtmlView":return uxe;case"Image":return pxe;case"Link":return yxe;case"Map":return Exe;case"Markdown":return Axe;case"Table":return Cxe;case"Video":return Video;case"Desc":return Nxe;case"TimeLine":return kxe;case"Reentry":return abe;case"Text":return lbe}}const cbe={class:"task_page"},hbe={style:{display:"flex","justify-content":"space-between"}},fbe={style:{display:"flex"}},dbe=["src"],pbe=["src"],gbe={key:0,style:{display:"flex","justify-content":"flex-end"}},vbe={style:{display:"flex","align-items":"center"}},mbe={style:{display:"flex","align-items":"center"}},ybe={style:{display:"flex","align-items":"center"}},_be={style:{color:"#1776FF"}},xbe={style:{display:"flex","justify-content":"flex-end"}},bbe={key:1,class:"flow_task_list_box",style:{height:"calc(100% - 310px)"}},Ebe=["onClick"],Tbe=["src"],wbe={class:"task_item_text"},Sbe={class:"color-5198FF",style:{"line-height":"18px"}},Abe={class:"color-999999",style:{"font-size":"12px"}},Mbe={style:{display:"flex","justify-content":"space-between","margin-top":"10px"}},Cbe={key:0,class:"color-999999",style:{"margin-top":"5px"}},Rbe={key:1,class:"color-999999",style:{"margin-top":"5px"}},Nbe={style:{display:"flex"}},Pbe=["src","onClick"],Dbe={style:{display:"flex","align-items":"center"}},Lbe={style:{display:"flex","align-items":"center"}},Ibe={style:{display:"flex","align-items":"center"}},Obe={style:{color:"#1776FF"}},Fbe={style:{display:"flex","justify-content":"flex-end"}},Bbe=["src"],Ube={key:2,class:"flow_task_list_pager_box"},kbe={key:3,class:"llmPage_chatZone"},Gbe={class:"llmPage_chatZone_chatList"},zbe={class:"llmPage_controlZone"},Vbe={key:0},Hbe={key:0,class:"llmPage_chatQuestion llmPage_item_common"},Wbe={class:"chatUserQ"},qbe=["src"],$be=["onClick"],Xbe={key:1,class:"llmPage_chatAnswer llmPage_item_common"},Ybe={class:"chatUserA"},jbe=["src"],Kbe={class:"answerCont"},Qbe={class:"loader"},Zbe=["innerHTML"],Jbe=["innerHTML"],eEe={key:0,class:"renderMsg"},tEe={key:4,class:"answerCont_noAnswer"},nEe={key:0,class:"llmPage_item_common_handle"},rEe={key:2,class:"llmPage_relativeQuestion"},iEe={class:"llmPage_relativeQuestion_list"},aEe=["onClick"],sEe={class:"choosing_question_tab"},oEe={style:{display:"flex"}},lEe=["src"],uEe={class:"flow_task_search_box"},cEe={class:"flow_task_search_box_btn"},hEe=["src"],fEe=Hr({__name:"index",setup(r){const e=JH(),t=nW(),n=QH(),{proxy:i}=rW(),a=Wr({searchInput:"",taskPage:{total:0,pageNum:1,pageSize:10},taskList:[],showNewTask:!1,newTaskForm:{title:"",description:"",time:"",lat:"",lng:""},questionInput:"",showArrangedTaskList:!1,isEditTask:!1,currentEditIndex:0,questionType:0,loading:!1,currentFlag:!1,abortController:null,conversationId:"",questionId:"",reentryFlag:!1,showLLM:!1});let s={},o={},l={imageComponentNum:0,tableComponentNum:0,echartsComponentNum:0,htmlViewComponentNum:0,mapComponentNum:0,videoComponentNum:0,markdownComponentNum:0,fileComponentNum:0,descComponentNum:0,timelineComponentNum:0,textComponentNum:0,linkComponentNum:0};const u=()=>{t.push("/")},c=U=>{a.taskPage.pageNum=U,h()},h=()=>{du({url:"/task/list",method:"GET",params:{page:a.taskPage.pageNum,page_size:a.taskPage.pageSize,order_by:"desc"}}).then(U=>{a.taskList=U.tasks,a.taskPage.total=U.total,n.flows.taskList=U.tasks,a.showArrangedTaskList=!1}),p()},d=()=>{x(),a.showNewTask=!0},f=()=>{let U=a.newTaskForm;if(U.time=new Date().getTime(),a.isEditTask){du({url:`/task/update/${a.newTaskForm.id}`,method:"PUT",data:U}).then(G=>{p(),h()});return}else du({url:"/task/add",method:"POST",data:U}).then(G=>{p(),h()})},p=()=>{a.showNewTask=!1,a.newTaskForm={title:"",description:"",time:"",lat:"",lng:""},a.isEditTask=!1,i.mittBus.off("showContextMenu")},m=(U,G)=>{a.newTaskForm={title:U.title,description:U.description,time:U.time,lat:U.lat,lng:U.lng,id:U.id},a.currentEditIndex=G,a.isEditTask=!0,x()},v=(U,G)=>{a.showArrangedTaskList?du({url:"/task/delete_qa",method:"DELETE",data:{id:U.id}}).then(O=>{O.status&&O.status=="success"&&(yh.success("\u5220\u9664\u6210\u529F"),_())}):du({url:`/task/delete/${U.id}`,method:"DELETE"}).then(O=>{O.status&&O.status=="success"&&(yh.success("\u5220\u9664\u6210\u529F"),h())})},g=(U,G)=>{console.log("item",U),U?(i.mittBus.emit("render",{data:{output:{render:{msg_type:"focus_on_point",data:{lat:U.lat,lng:U.lng,level:7}}}}}),t.push({name:"flow",query:{title:U.title||U.question,index:G,type:"item",domainId:U.domain_id}})):a.questionType==0?a.questionInput.length>0?t.push({name:"flow",query:{title:a.questionInput,type:"item"}}):yh.warning("\u8BF7\u8F93\u5165\u67E5\u8BE2\u5185\u5BB9"):(a.showLLM=!0,S(a.questionInput))},y=()=>{t.push({name:"flow",query:{type:"origin"}})},_=()=>{du({url:"/task/list_qa",method:"GET",params:{limit:100}}).then(U=>{a.taskList=U.data,a.showArrangedTaskList=!0})},x=()=>{i.mittBus.on("showContextMenu",U=>{(a.showNewTask||a.isEditTask)&&(a.newTaskForm.lat=U.data.lat.toFixed(4),a.newTaskForm.lng=U.data.lng.toFixed(4))})},E=U=>{a.questionType=U},T=U=>U.replace(/[\r\n]+/gm,""),b=U=>U.includes("\u8BF7\u8865\u5168")?U.replace("\u8BF7\u8865\u5168","\u5DF2\u8865\u5168"):U,w=()=>document.getElementById("reentryTemplateDom").innerHTML.replace(/<[^>]+>/g,""),A=U=>{if(!U){const G=document.getElementById("reentryTemplateDom"),O=document.getElementById("llmQaInput");O.style.textIndent=G.clientWidth+"px"}},S=(U,G)=>{if(a.loading){yh.warning("\u6B63\u5728\u56DE\u7B54\u4E2D\uFF0C\u8BF7\u52FF\u53D1\u9001");return}const O=typeof U=="string";if(a.questionInput=T(O?U:a.questionInput),!a.questionInput)return yh.warning("\u8BF7\u8F93\u5165\u95EE\u9898");a.currentFlag=!1,a.loading=!0,D(G)},C=ea([]),R=ea(null),P=ea(0),M=ea([]),N=ea({unifyWidth:"50%",echartsDataObj:{type:"",options:{}},fileData:{fileName:"",url:"",msg:""},graphData:{},htmlData:{html:"",msg:""},imageData:{type:"",images:[],msg:""},linkData:{},mapData:{options:{},msg:""},markdownData:{},descData:{},timeLineData:{},tableData:{headers:null,rows:null},videoData:{url:"",msg:""},reentryObj:{},textData:""}),D=async U=>{a.questionId=Vm(32,16),a.conversationId=Vm(32,16),a.abortController=new AbortController;const G={id:a.questionId,project_id:"10001",user_id:"1",conversation_id:a.conversationId,question:a.questionInput,llm_config:window.config.task.llm_config,llm_disposable_config:{max_tokens:1024,temperature:.1,top_k:50,repetition_penalty:1,max_history:1},plugins_list:window.config.task.pluginList};let O="";if(a.reentryFlag||U){if(U)G.reentry=U.reentryParams,G.question="{{"+U.value+"}}";else{const V=C.value.length-1;G.reentry=C.value[V].contentObj.reentryParams,G.question=w()}O=G.question}a.reentryFlag&&(a.questionInput=O),C.value.push({type:"question",content:b(a.questionInput)}),C.value.push({type:"answer",contentObj:{renderObjArr:[],renderStr:[],reentryObjArr:[],reentryParams:{plugin:"",context:""},traceSourceObj:{traceFile:{},traceFileDetail:{}}},isChatting:!0,isLoading:!0}),a.questionInput="",a.reentryFlag=!1,a.chattingFlag=!0,A(!0);const F={headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(G),signal:a.abortController.signal,onopen(){console.log("open")},onmessage(V){["message_end","END","end"].includes(V.event)||V.data==="message_end"?(console.log("STOP-STOP-STOP-STOP-STOP-STOP-STOP-STOP-STOP-STOP-STOP-STOP-STOP-STOP-STOP-STOP-STOP-STOP-STOP-STOP-STOP-STOP-"),I(),C.value[C.value.length-1].isChatting=!1):V&&(a.currentFlag?L(V,!1):(a.currentFlag=!0,C.value[C.value.length-1].isLoading=!1,V.event!=="ANSWER"&&L(V,!1))),_v(()=>{const $=document.querySelector(".llmPage_controlZone");P.value=$.scrollHeight,R.value.setScrollTop(P.value)})},onerror(V){console.error(V)},onclose(V){a.chattingFlag=!1,C.value[C.value.length-1].isChatting=!1,console.log("onclose",V)},openWhenHidden(){}};eW("/v2/warpdrive/chat",F)},I=()=>{a.abortController.abort(),a.abortController=null,a.chattingFlag=!1,a.loading=!1,console.log("close")},L=(U,G)=>{console.log("msg",U);const O=C.value.length-1;if(U.event==="ANSWER"){const F=G?U.data.result:JSON.parse(U.data).result;if(F.indexOf("<think>")>-1){if(F.indexOf("</think>")>-1){const V=F.split("</think>");C.value[O].contentObj.thinkText=V[0],C.value[O].contentObj.answerText=V[1]}else C.value[O].contentObj.thinkText=F;C.value[O].contentObj.thinkText===`<think>

`&&(C.value[O].contentObj.thinkText="")}else C.value[O].contentObj.answerText=F}else if(U.event==="RENDER"){const F=G?U.data:JSON.parse(U.data);F.type==="IMAGE"?(l.imageComponentNum++,z(O,"Image",F.message,l.imageComponentNum),s[`Image${l.imageComponentNum}`]={imageData:{type:null,images:null,unifyWidth:"50%"}},s[`Image${l.imageComponentNum}`].imageData.type=F.render.type,s[`Image${l.imageComponentNum}`].imageData.images=F.render.images):F.type==="TABLE"?(F.render.headers.length||F.render.data.length)&&(l.tableComponentNum++,z(O,"Table",F.message,l.tableComponentNum),s[`Table${l.tableComponentNum}`]={tableData:{headers:null,rows:null,unifyWidth:"50%"}},s[`Table${l.tableComponentNum}`].tableData.headers=F.render.headers,s[`Table${l.tableComponentNum}`].tableData.rows=F.render.data):F.type==="ECHARTS"?(l.echartsComponentNum++,z(O,"Echarts",F.message,l.echartsComponentNum),s[`Echarts${l.echartsComponentNum}`]={echartsDataObj:{options:null,unifyWidth:"50%"}},s[`Echarts${l.echartsComponentNum}`].echartsDataObj.options=F.render):F.type==="HTML_TAG"?(l.htmlViewComponentNum++,z(O,"HtmlView",F.message,l.htmlViewComponentNum),s[`HtmlView${l.htmlViewComponentNum}`]={htmlData:{html:null,unifyWidth:"50%"}},s[`HtmlView${l.htmlViewComponentNum}`].htmlData.html=F.render.html):F.type==="MAP"?(l.mapComponentNum++,z(O,"Map",F.message,l.mapComponentNum),s[`Map${l.mapComponentNum}`]={mapData:{options:null,unifyWidth:"50%",randomNum:Vm(16,16)}},s[`Map${l.mapComponentNum}`].mapData.options={...F.render}):F.type==="VIDEO"||(F.type==="GRAPH"?F.render.nodes&&F.render.nodes.length>0&&(z(O,"Graph",F.message),N.value.graphData[O]=F.render,console.log("renderObj",F)):F.type==="MARKDOWN"?Object.keys(F.render).length?(l.markdownComponentNum++,z(O,"Markdown",F.message,l.markdownComponentNum),s[`Markdown${l.markdownComponentNum}`]={markdownData:null,unifyWidth:"50%"},s[`Markdown${l.markdownComponentNum}`].markdownData=F.render.markdown):C.value[O].contentObj.answerText=F.message:F.type==="FILE_PREVIEW"?(l.fileComponentNum++,z(O,"FilePreview",F.message,l.fileComponentNum),s[`FilePreview${l.fileComponentNum}`]={fileData:{url:"",fileName:"",unifyWidth:"50%"}},s[`FilePreview${l.fileComponentNum}`].fileData.fileName=F.render.file_name,s[`FilePreview${l.fileComponentNum}`].fileData.url=F.render.url):F.type==="DESC"?(l.descComponentNum++,z(O,"Desc",F.message,l.descComponentNum),s[`Desc${l.descComponentNum}`]={descData:null,unifyWidth:"50%"},s[`Desc${l.descComponentNum}`].descData=F.render):F.type==="TIME_LINE"?(l.timelineComponentNum++,z(O,"TimeLine",F.message,l.timelineComponentNum),s[`TimeLine${l.timelineComponentNum}`]={timeLineData:null,unifyWidth:"50%"},s[`TimeLine${l.timelineComponentNum}`].timeLineData=F.render):F.type==="TEXT"?(l.textComponentNum++,z(O,"Text",F.message,l.textComponentNum),s[`Text${l.textComponentNum}`]={textData:"",unifyWidth:"50%"},s[`Text${l.textComponentNum}`].textData=F.render.text):F.type==="LINK"&&(l.linkComponentNum++,z(O,"Link",F.message,l.linkComponentNum),s[`Link${l.linkComponentNum}`]={linkData:"",unifyWidth:"100%"},s[`Link${l.linkComponentNum}`].linkData=F.render))}else if(U.event!=="REENTRY"){if(U.event==="TRACE_SOURCE"){const F=typeof U.data=="object"?U.data:JSON.parse(U.data);if(console.log("traceSourceObj",F),F.task_type==="TRACE"){if(!F.answer_relative_info.length||!F.retrieval_results.length)return;C.value[O].contentObj.traceSourceObj.traceFile=F,F.answer_relative_info.forEach((V,$)=>{const Z=V.relative_raw_text_index.map(Y=>{const X={metadata:JSON.parse(F.retrieval_results[Y].metadata)};return`<sup class="${getContextType(X.metadata.file)}" onmouseenter="handleTraceFileRes(event, ${O},${Y})" onmouseout="handleTraceCornerMarkOut(event)">${Y+1}</sup>`});C.value[O].contentObj.answerText=C.value[O].contentObj.answerText.replace(V.text,V.text+"&nbsp;"+Z.join("")+"&nbsp;")}),C.value[O].contentObj.traceSourceObj.traceFile.retrieval_results.map(V=>{V.fileObj=JSON.parse(V.metadata)}),C.value[O].contentObj.traceSourceObj.traceFile.retrieval_results.show=!0}}else if(U.event==="RECOMMEND_Q")M.value=typeof U.data=="object"?U.data.question:JSON.parse(U.data).question;else if(U.event==="ERROR"){const F=G?U.data.result:JSON.parse(U.data).result;C.value[O].contentObj.answerText=F,I(),C.value[C.value.length-1].isChatting=!1}}},z=(U,G,O,F)=>{C.value[U].contentObj.renderObjArr.push({componentVal:tW(ube(G)),msg:O}),o[U]||(o[U]=[]),o[U].push(`${G}${F}`),C.value[U].contentObj.renderStr.push(G)},B=U=>{a.questionInput=U},k=()=>{a.abortController&&I(),a.showLLM=!1,a.questionType=0,a.questionInput=""};return br(()=>{h(),x(),e.params.question&&(a.showLLM=!0,a.questionType=1,S(e.params.question))}),(U,G)=>{const O=Hn("el-button"),F=Hn("el-input"),V=Hn("el-popover"),$=Hn("el-popconfirm"),Z=Hn("el-scrollbar"),Y=Hn("el-pagination"),X=Hn("el-divider");return Ye(),tt("div",cbe,[Ue("div",hbe,[G[21]||(G[21]=Ue("div",{class:"flow_page_title color-5198FF"}," \u4EFB\u52A1\u5217\u8868 ",-1)),Ue("div",fbe,[a.showLLM?(Ye(),tt("div",{key:0,class:"flow_detail_content_title_box_return",onClick:G[0]||(G[0]=K=>k()),style:{color:"#1776FF",cursor:"pointer","margin-right":"15px","margin-top":"-3px"}},[Ue("img",{src:Nt(gs).getAssetsFile("flip-left.png"),style:{"margin-right":"10px"}},null,8,dbe),G[20]||(G[20]=ji("\u8FD4\u56DE\u4EFB\u52A1\u5217\u8868 "))])):on("",!0),Ue("img",{src:Nt(gs).getAssetsFile("close.png"),style:{width:"15px",height:"15px","margin-top":"-5px",cursor:"pointer"},onClick:G[1]||(G[1]=K=>u())},null,8,pbe)])]),a.showLLM?on("",!0):(Ye(),tt("div",gbe,[kt(V,{placement:"right",width:400,trigger:"click",hide:p,visible:a.showNewTask},{reference:zt(()=>[kt(O,{type:"primary",style:{"margin-top":"20px","margin-left":"10px"},onClick:G[2]||(G[2]=K=>d())},{default:zt(()=>G[22]||(G[22]=[ji("\u65B0\u5EFA\u4EFB\u52A1")])),_:1})]),default:zt(()=>[Ue("div",vbe,[G[23]||(G[23]=Ue("div",{style:{width:"100px","margin-top":"-10px"}},"\u4EFB\u52A1\u540D\u79F0:",-1)),kt(F,{placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0",modelValue:a.newTaskForm.title,"onUpdate:modelValue":G[3]||(G[3]=K=>a.newTaskForm.title=K),style:{"margin-bottom":"10px",width:"calc(100% - 100px)"}},null,8,["modelValue"])]),Ue("div",mbe,[G[24]||(G[24]=Ue("div",{style:{width:"100px","margin-top":"-10px"}},"\u4EFB\u52A1\u63CF\u8FF0:",-1)),kt(F,{placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u63CF\u8FF0",modelValue:a.newTaskForm.description,"onUpdate:modelValue":G[4]||(G[4]=K=>a.newTaskForm.description=K),type:"textarea",style:{"margin-bottom":"10px",width:"calc(100% - 100px)"}},null,8,["modelValue"])]),Ue("div",ybe,[G[25]||(G[25]=Ue("div",{style:{width:"100px","margin-top":"-10px"}},"\u7ECF\u7EAC\u5EA6:",-1)),Ue("div",_be,Kt(a.newTaskForm.lat)+", "+Kt(a.newTaskForm.lng),1)]),G[28]||(G[28]=Ue("div",{class:"source_info",style:{"margin-top":"5px"}},"\u8BF7\u4F7F\u7528\u9F20\u6807\u53F3\u952E\u70B9\u51FB\u5730\u56FE\u9009\u53D6\u4EFB\u52A1\u53D1\u751F\u7ECF\u7EAC\u5EA6",-1)),Ue("div",xbe,[kt(O,{onClick:G[5]||(G[5]=K=>p())},{default:zt(()=>G[26]||(G[26]=[ji("\u53D6\u6D88")])),_:1}),kt(O,{onClick:G[6]||(G[6]=K=>f()),type:"primary"},{default:zt(()=>G[27]||(G[27]=[ji("\u786E\u5B9A")])),_:1})])]),_:1},8,["visible"]),kt(O,{type:"primary",onClick:G[7]||(G[7]=K=>y()),style:{"margin-top":"20px","margin-left":"10px"}},{default:zt(()=>G[29]||(G[29]=[ji("\u667A\u80FD\u4F53\u5217\u8868")])),_:1}),a.showArrangedTaskList?(Ye(),hi(O,{key:1,type:"primary",onClick:G[9]||(G[9]=K=>h()),style:{"margin-top":"20px","margin-left":"10px"}},{default:zt(()=>G[31]||(G[31]=[ji("\u4EFB\u52A1\u5217\u8868")])),_:1})):(Ye(),hi(O,{key:0,type:"primary",onClick:G[8]||(G[8]=K=>_()),style:{"margin-top":"20px","margin-left":"10px"}},{default:zt(()=>G[30]||(G[30]=[ji("\u5DF2\u7F16\u6392\u4EFB\u52A1")])),_:1}))])),a.showLLM?on("",!0):(Ye(),tt("div",bbe,[kt(Z,{style:{height:"100%"},height:"100%"},{default:zt(()=>[(Ye(!0),tt($n,null,_r(a.taskList,(K,se)=>(Ye(),tt("div",{class:"task_item",onClick:oe=>g(K,se)},[Ue("img",{src:Nt(gs).getAssetsFile("fileImg.png")},null,8,Tbe),Ue("div",wbe,[Ue("div",Sbe,Kt(a.showArrangedTaskList?K.question:K.title),1),Ue("div",Abe,Kt(a.showArrangedTaskList?K.answer:K.description),1),Ue("div",Mbe,[a.showArrangedTaskList?(Ye(),tt("div",Rbe)):(Ye(),tt("div",Cbe,Kt(Nt(iW)(K.time,"YYYY-mm-dd HH:MM:SS")),1)),Ue("div",Nbe,[kt(V,{placement:"right",width:400,trigger:"click",hide:p,visible:a.isEditTask&&a.currentEditIndex===se},{reference:zt(()=>[a.showArrangedTaskList?on("",!0):(Ye(),tt("img",{key:0,src:Nt(gs).getAssetsFile("edit.png"),class:"task_item_edit_img",onClick:eC(oe=>m(K,se),["stop"])},null,8,Pbe))]),default:zt(()=>[Ue("div",Dbe,[G[32]||(G[32]=Ue("div",{style:{width:"100px","margin-top":"-10px"}},"\u4EFB\u52A1\u540D\u79F0:",-1)),kt(F,{placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u540D\u79F0",modelValue:a.newTaskForm.title,"onUpdate:modelValue":G[10]||(G[10]=oe=>a.newTaskForm.title=oe),style:{"margin-bottom":"10px",width:"calc(100% - 100px)"}},null,8,["modelValue"])]),Ue("div",Lbe,[G[33]||(G[33]=Ue("div",{style:{width:"100px","margin-top":"-10px"}},"\u4EFB\u52A1\u63CF\u8FF0:",-1)),kt(F,{placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u63CF\u8FF0",modelValue:a.newTaskForm.description,"onUpdate:modelValue":G[11]||(G[11]=oe=>a.newTaskForm.description=oe),type:"textarea",style:{"margin-bottom":"10px",width:"calc(100% - 100px)"}},null,8,["modelValue"])]),Ue("div",Ibe,[G[34]||(G[34]=Ue("div",{style:{width:"100px","margin-top":"-10px"}},"\u7ECF\u7EAC\u5EA6:",-1)),Ue("div",Obe,Kt(a.newTaskForm.lat)+", "+Kt(a.newTaskForm.lng),1)]),G[37]||(G[37]=Ue("div",{class:"source_info",style:{"margin-top":"5px"}},"\u8BF7\u4F7F\u7528\u9F20\u6807\u53F3\u952E\u70B9\u51FB\u5730\u56FE\u9009\u53D6\u4EFB\u52A1\u53D1\u751F\u7ECF\u7EAC\u5EA6",-1)),Ue("div",Fbe,[kt(O,{onClick:G[12]||(G[12]=oe=>p())},{default:zt(()=>G[35]||(G[35]=[ji("\u53D6\u6D88")])),_:1}),kt(O,{onClick:G[13]||(G[13]=oe=>f()),type:"primary"},{default:zt(()=>G[36]||(G[36]=[ji("\u786E\u5B9A")])),_:1})])]),_:2},1032,["visible"]),kt($,{"confirm-button-text":"\u786E\u5B9A","cancel-button-text":"\u53D6\u6D88",title:"\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664\u8BE5\u4EFB\u52A1, \u662F\u5426\u7EE7\u7EED?",onConfirm:oe=>v(K,se)},{reference:zt(()=>[Ue("img",{src:Nt(gs).getAssetsFile("delete.png"),class:"task_item_edit_img",onClick:G[14]||(G[14]=eC(()=>{},["stop"]))},null,8,Bbe)]),_:2},1032,["onConfirm"])])])])],8,Ebe))),256))]),_:1})])),!a.showArrangedTaskList&&!a.showLLM?(Ye(),tt("div",Ube,[kt(Y,{layout:"total, prev, pager, next",total:a.taskPage.total,"page-number":a.taskPage.pageNum,"page-size":a.taskPage.pageSize,"pager-count":"5",onCurrentChange:c},null,8,["total","page-number","page-size"])])):on("",!0),a.showLLM?(Ye(),tt("div",kbe,[Ue("div",Gbe,[kt(Z,{ref_key:"scrollbarRef",ref:R},{default:zt(()=>[Ue("div",zbe,[C.value.length?(Ye(),tt("div",Vbe,[(Ye(!0),tt($n,null,_r(C.value,(K,se)=>(Ye(),tt("div",{key:se,class:"llmPage_chatItem"},[K.type==="question"?(Ye(),tt("div",Hbe,[Ue("div",Wbe,[Ue("img",{src:Nt(gs).getAssetsFile("icon/icon_user.png")},null,8,qbe)]),Ue("div",{class:"questionCont",onClick:oe=>B(K.content)},Kt(K.content),9,$be)])):(Ye(),tt("div",Xbe,[Ue("div",Ybe,[Ue("img",{src:Nt(gs).getAssetsFile("icon/icon_robot.png")},null,8,jbe)]),Ue("div",Kbe,[Is(Ue("div",Qbe,G[38]||(G[38]=[Ue("div",{class:"loader-inner ball-beat"},[Ue("div"),Ue("div"),Ue("div")],-1)]),512),[[Co,K.isLoading]]),K.contentObj.thinkText?(Ye(),tt("div",{key:0,class:"thinkText",innerHTML:Nt(bw)({content:K.contentObj.thinkText})},null,8,Zbe)):on("",!0),K.contentObj.answerText?(Ye(),tt("div",{key:1,class:"answerText",innerHTML:Nt(bw)({content:K.contentObj.answerText})},null,8,Jbe)):on("",!0),K.contentObj.renderObjArr.length?(Ye(!0),tt($n,{key:2},_r(K.contentObj.renderObjArr,(oe,W)=>(Ye(),tt("div",{key:W},[(Ye(),hi(tC(oe.componentVal),{componentProps:Object.keys(Nt(o)).length&&Nt(s)[Nt(o)[se][W]]||N.value,listIdx:se,onTargetQuestion:U.targetQuestion},null,40,["componentProps","listIdx","onTargetQuestion"])),oe.msg?(Ye(),tt("div",eEe,[kt(X),Ue("p",null,Kt(oe.msg),1)])):on("",!0)]))),128)):on("",!0),K.contentObj.reentryObjArr.length?(Ye(!0),tt($n,{key:3},_r(K.contentObj.reentryObjArr,(oe,W)=>(Ye(),hi(tC(oe.componentVal),{key:W,componentProps:N.value,listIdx:se,onReentryQuest:U.reentryQuest},null,40,["componentProps","listIdx","onReentryQuest"]))),128)):on("",!0),!K.contentObj.answerText&&!K.contentObj.renderObjArr.length&&!K.contentObj.reentryObjArr.length&&!Object.keys(K.contentObj.traceSourceObj.traceFileDetail).length&&!K.isChatting?(Ye(),tt("div",tEe," \u6682\u65E0\u56DE\u7B54\uFF0C\u8BF7\u8BD5\u5176\u4ED6\u95EE\u9898 ")):on("",!0)]),K.isChatting?on("",!0):(Ye(),tt("div",nEe))])),K.type==="answer"&&!a.chattingFlag&&se===C.value.length-1&&M.value&&M.value.length?(Ye(),tt("div",rEe,[G[40]||(G[40]=Ue("div",{class:"llmPage_relativeQuestion_title"},"\u76F8\u5173\u95EE\u9898\uFF1A",-1)),Ue("div",iEe,[(Ye(!0),tt($n,null,_r(M.value,(oe,W)=>(Ye(),tt("div",{key:W,class:"llmPage_relativeQuestion_listItem",onClick:Ne=>S(oe)},[G[39]||(G[39]=Ue("span",null,null,-1)),Ue("span",null,Kt(oe),1)],8,aEe))),128))])])):on("",!0)]))),128))])):on("",!0)])]),_:1},512)])])):on("",!0),Ue("div",sEe,[Ue("div",oEe,[Ue("div",{class:Mo(["choosing_question_tab_btn",a.questionType==0?"choosing_question_tab_btn_active":""]),onClick:G[15]||(G[15]=K=>E(0))}," \u4EFB\u52A1\u63CF\u8FF0 ",2),Ue("div",{class:Mo(["choosing_question_tab_btn",a.questionType==1?"choosing_question_tab_btn_active":""]),onClick:G[16]||(G[16]=K=>E(1))}," \u6218\u573A\u57FA\u7840\u77E5\u8BC6\u95EE\u7B54 ",2)]),Is(Ue("div",{class:"choosing_question_tab_btn",style:{width:"100px"},onClick:I},[Ue("img",{src:Nt(gs).getAssetsFile("icon/icon_stop.png"),style:{"margin-right":"5px"}},null,8,lEe),G[41]||(G[41]=Ue("span",null,"\u505C\u6B62\u751F\u6210",-1))],512),[[Co,a.chattingFlag]])]),Ue("div",uEe,[kt(F,{placeholder:a.questionType==0?"\u8BF7\u8F93\u5165\u60A8\u7684\u9700\u6C42\uFF0C\u5982:\u67E5\u770B\u5357\u6D77\u6D77\u57DF\u6001\u52BF":"\u8BF7\u8F93\u5165\u60A8\u7684\u95EE\u9898",modelValue:a.questionInput,"onUpdate:modelValue":G[17]||(G[17]=K=>a.questionInput=K),type:"textarea",style:{"margin-top":"20px",width:"100%"},onKeyup:G[18]||(G[18]=ZH(K=>g(),["enter"]))},null,8,["placeholder","modelValue"]),Ue("div",cEe,[Ue("img",{src:Nt(gs).getAssetsFile("send.png"),onClick:G[19]||(G[19]=K=>g())},null,8,hEe)])])])}}});const vEe=Nr(fEe,[["__scopeId","data-v-a0667d50"]]);export{vEe as default};
